{"version":3,"sources":["helpers.js","init.js","options.js","layout.js","tripwire.js","active.js","addSignature.js","api.js","automapper.js","comments.js","deleteSignature.js","editSignature.js","esi.js","eve.js","parse.js","paste.js","redo.js","serverStatus.js","sync.js","systemChange.js","undo.js","activity-graph.js","chain-map.js","ckeditor.js","global-hooks.js","guidance.js","dialogs/admin-dialog.js","dialogs/base-dialog.js","dialogs/options-dialog.js","dialogs/signature-add-dialog.js","dialogs/signature-delete-dialog.js","dialogs/signature-dialog.js","dialogs/signature-edit-dialog.js"],"names":["Object","sort","obj","prop","swapped","prev","i","Number","tmp","index","val","key","find","maxTime","maxTimeString","Date","size","hasOwnProperty","time","dates","push","length","getTime","$","fn","serializeObject","self","this","json","push_counters","patterns","validate","fixed","named","build","base","value","push_counter","undefined","each","serializeArray","test","name","k","keys","match","merge","reverse_key","pop","replace","RegExp","extend","jQuery","numFormat","num","n","toString","split","join","letterToNumbers","string","toUpperCase","letters","sum","Math","pow","indexOf","substr","sigFormat","input","type","alpha","numeric","format","options","chain","typeFormat","classFormat","x","l","sigClass","id","map","tripwire","systems","system","class","security","systemType","wormholes","leadsTo","isEmpty","getCookie","c_name","c_value","document","cookie","c_start","c_end","unescape","substring","setCookie","exdays","exdate","setDate","getDate","escape","toUTCString","location","protocol","viewingSystem","attr","viewingSystemID","server","html","localOverrides","localOptions","JSON","parse","localStorage","getItem","userID","init","character","characterID","characterName","background","favorites","grid","tracking","active","masks","corporationID","gridlines","tabs","node-reference","signatures","pasteLife","alignment","sigID","sigType","sigAge","sigLife","sigMass","buttons","follow","chainWidget","viewing","signaturesWidget","autoMapper","save","stringify","get","setItem","ajax","url","data","mode","dataType","load","set","apply","local","constructor","reset","defaults","oog","data-col","col","data-row","row","data-sizex","size_x","data-sizey","size_y","css","width","height","favorite","parseInt","addClass","home","kspace","evescout","inArray","a","href","hostname","pathname","search","filter","$tab","clone","systemID","append","redraw","gridster","widget_selector","avoid_overlapped_widgets","widget_base_dimensions","widget_margins","autogrow_cols","helper","draggable","start","e","ui","resize","enabled","handle_class","max_size","min_size","stop","$widget","setTimeout","serialize_params","$w","wgd","disable","disable_resize","visibility","click","hasClass","removeClass","serialize","enable","enable_resize","timer","xhr","version","client","list","undo","sessionStorage","redo","activity","esi","refreshRate","connected","ageFormat","instance","window","clearTimeout","sync","setAgeFormat","countdown","serverTime","chainMap","draw","pastEOL","since","layout","whTooltip","sig","item","tooltip","sig2Type","whType","life","mass","jump","ageTooltip","date","lifeTime","localOffset","getTimezoneOffset","getMonth","getHours","getMinutes","refresh","successCallback","alwaysCallback","editSigs","editComments","editSig","editComment","animate","backgroundColor","fadeIn","fadeOut","addSig","add","option","disabled","nth","nth2","signatureID","sig2ID","sigtype","sigTypeBM","typeBM","type2BM","connectionID","connection","lifeClass","massClass","tr","linkSig","Tooltips","attach","trigger","until","lifeLeft","onExpiry","alwaysExpire","compact","serverSync","wrapInner","parent","slideDown","$set","replaceWith","contents","delay","API","indicator","APIrefresh","expire","cache","done","periodsToSeconds","onTick","t","from","to","pods","EVE","shipTypeID","shortest","rawMap","request","update","toClass","dialog","autoOpen","Cancel","Ok","side","systemName","connectionName","whLife","whMass","lifeLength","result","open","class2","signature","resultSet","action","comments","modified","$comment","comment","err","show","message","hide","modifiedBy","sticky","commentID","before","createdBy","created","remove","deleteSig","slideUp","edit","effect","baseUrl","userAgent","navigator","characters","scopeError","moment","tokenExpire","subtract","isBefore","expired","param","token","accessToken","user_agent","status","locationDate","getResponseHeader","solar_system_id","stationID","stationName","shipID","shipName","shipTypeName","station_id","stationLookup","always","reference","detach","fail","Notify","ship","shipDate","ship_item_id","ship_name","ship_type_id","typeLookup","online","characterStatus","typeID","setDestination","destinationID","clear_waypoints","beginning","destination_id","clear_other_waypoints","add_to_beginning","headers","Authorization","X-User-Agent","showInfo","targetID","target_id","eveStatus","$clone","removeAttr","characterChange","systemChange","isAfter","mask","column","sigEditing","editing","pasteSignatures","paste","processing","rowParse","scanner","group","columns","validScanGroups","validGroups","scanGroup","parsePaste","rows","ids","wormholeGroups","siteGroups","otherGroups","Gas Site","Data Site","Relic Site","Ore Site","Gasgebiet","Datengebiet","Reliktgebiet","Mineraliengebiet","ГАЗ: район добычи газа","ДАННЫЕ: район сбора данных","АРТЕФАКТЫ: район поиска артефактов","РУДА: район добычи руды","sigName","keydown","metaKey","ctrlKey","keyCode","activeElement","is","focus","on","preventDefault","pasteIDs","deletes","scan","delete","clipboardData","getData","originalEvent","blur","lastIndex","redoItem","concat","serverStatus","players","times","abort","sigCount","sigTime","chainCount","chainTime","flareCount","flares","flareTime","last_modified","commentCount","commentTime","async","responseJSON","aSystems","aSigSystems","slice","notify","empty","history","replaceState","title","text","effects","bad","whClass","modifier","abs","statics","wormhole","color","factionID","factions","regions","regionID","undoItem","graph","view","span","label","role","calc","d","r","getValue","sourceColumn","reverse","google","visualization","DataView","DataTable","setColumns","selectHandler","selections","getSelection","c","animation","duration","AreaChart","getElementById","isStacked","hAxis","textStyle","fontName","fontSize","showTextEvery","vAxis","viewWindowMode","viewWindow","min","maxValue","gridlineColor","pointSize","lineWidth","chartArea","left","top","legend","position","easing","showColorCode","annotations","style","domain","focusTarget","events","addListener","setOnLoadCallback","drawing","newView","shipJumps","podKills","shipKills","npcKills","$node","jBox","y","occupied","count","OccupiedToolTips","flare","next","lines","nodeIndex","ceil","cellIndex","$connector","children","$parent","nodeCol","connectorCell","colSpan","parentIndex","newparentIndex","checkSystem","node","v","$connecte","me","tempCol","breaker","skip","nodes","topLevel","effectClass","chainNode","f","findLinks","parentID","childID","chainList","chainData","link","usedLinks","classBM","class2BM","child","chainLinks","jumps","guidance","findShortestPath","calcNode","cols","frigTypes","connections","nodeClass","nodeSecurity","Array","collapsed","collapse","WormholeTypeToolTips","getCollapsedNodes","OrgChart","allowHtml","allowCollapse","CKConfig","skin","allowedContent","extraPlugins","enterMode","CKEDITOR","ENTER_BR","removeDialogTabs","autoGrow_onStartup","autoGrow_minHeight","toolbar_minToolbar","items","toolbar_maxToolbar","toolbar","smallToolbar","maximizedToolbar","fontSize_style","element","styles","font-size","overrides","attributes","cke","editor","closest","domEvent","altKey","s","selected_ranges","getRanges","startContainer","parents","getParents","getFirst","getNext","selectElement","selectRanges","ev","definition","getContents","removeAllRanges","$this","instances","modifiedDate","createdDate","destroy","resizable","minHeight","my","at","of","dialogClass","Delete","button","knob","angleArc","max","readOnly","displayInput","fgColor","bgColor","splice","toggle","select","display","stopPropagation","content","stick","offset","autoClose","ValidationTooltips","fade","getContent","outside","pointer","repositionOnOpen","onOpen","source","setContent","chars","occupants","sortable","axis","tolerance","containment","newTabs","Remove Tab","OK","submit","close","create","inlinecomplete","maxSize","thera","checked","target","eq","contextmenu","delegate","menu","colName","cmd","beforeOpen","uiMenuOptions","Close","totalMass","parseFloat","toID","shipType","Save","rename","moogle","prototype","setFlare","removeFlare","widget","autocomplete","_create","_selectInit","_super","_value","originalReturn","_superApply","arguments","change","_suggest","_initSource","isArray","response","matcher","escapeRegex","term","results","_close","event","input_source","wrapper","select_source","trim","toArray","_createShowAllButton","that","wasOpen","appendTo","icons","primary","_search","tablesorter","sortReset","widgets","textExtraction","2","whList","extractKeys","call","sorter","b","findPaths","end","infinity","Infinity","costs","0","predecessors","bucket","shift","currentCost","adjacentNodes","vertex","totalCost","vertexCost","cost","extractShortest","u","predecessor","path","Guidance","refreshWindow","$ajax","$total","$row","$col","refreshTimer","modal","$menuItem","sortList","parentElement","selectmenu","maskChange","Reset","stat","owner","admin","img","optional","accordion","heightStyle","collapsible","error","direction","Add","corporationName","allianceName","Remove","send","Create","toLowerCase","form","aSigWormholes","durationPicker","not","valid","isNaN","console","log","payload","signatureType","signatureID_Alpha","signatureID_Numeric","wormholeName","signature2","signatureID2_Alpha","signatureID2_Numeric","wormholeName2","wormholeType","wormholeType2","wormholeLife","wormholeMass","signatureName","method","openSigEdit"],"mappings":"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","file":"app.min.js","sourcesContent":["Object.sort = function(obj, prop) {\r\n\tvar swapped, prev;\r\n\tdo {\r\n\t\tswapped = false, prev = null;\r\n\t\tfor (var i in obj) {\r\n\t\t\tif (prev && Number(obj[i][prop]) < Number(obj[prev][prop])) {\r\n\t\t\t\tvar tmp = obj[i];\r\n\t\t\t\tobj[i] = obj[prev];\r\n\t\t\t\tobj[prev] = tmp;\r\n\t\t\t\tswapped = true;\r\n\t\t\t}\r\n\t\t\tprev = i;\r\n\t\t}\r\n\t} while (swapped);\r\n}\r\n\r\nObject.index = function(obj, prop, val) {\r\n\tfor (var key in obj) {\r\n\t\tif (obj[key][prop] == val) {\r\n\t\t\treturn key;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nObject.find = function(obj, prop, val) {\r\n\tfor (var key in obj) {\r\n\t\tif (obj[key][prop] == val) {\r\n\t\t\treturn obj[key];\r\n\t\t}\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\nObject.maxTime = function(obj, prop) {\r\n\tvar maxTimeString = \"\", maxTime;\r\n\r\n\tfor (var key in obj) {\r\n\t\tif (!maxTime || maxTime < new Date(obj[key][prop])) {\r\n\t\t\tmaxTime = new Date(obj[key][prop]);\r\n\t\t\tmaxTimeString = obj[key][prop];\r\n\t\t}\r\n\t}\r\n\treturn maxTimeString;\r\n}\r\n\r\nObject.size = function(obj) {\r\n    var size = 0, key;\r\n    for (key in obj) {\r\n        if (obj.hasOwnProperty(key)) size++;\r\n    }\r\n\r\n    return size;\r\n};\r\n\r\nObject.time = function(obj) {\r\n\tvar dates = [], key;\r\n\tfor (key in obj) {\r\n\t\tdates.push(new Date(obj[key].time));\r\n\t}\r\n\r\n\treturn dates.length ? dates.sort()[dates.length -1].getTime() /1000 : 0;\r\n};\r\n\r\n(function($){\r\n    $.fn.serializeObject = function(){\r\n\r\n        var self = this,\r\n            json = {},\r\n            push_counters = {},\r\n            patterns = {\r\n                \"validate\": /^[a-zA-Z][a-zA-Z0-9_]*(?:\\[(?:\\d*|[a-zA-Z0-9_]+)\\])*$/,\r\n                \"key\":      /[a-zA-Z0-9_]+|(?=\\[\\])/g,\r\n                \"push\":     /^$/,\r\n                \"fixed\":    /^\\d+$/,\r\n                \"named\":    /^[a-zA-Z0-9_]+$/\r\n            };\r\n\r\n\r\n        this.build = function(base, key, value){\r\n            base[key] = value;\r\n            return base;\r\n        };\r\n\r\n        this.push_counter = function(key){\r\n            if(push_counters[key] === undefined){\r\n                push_counters[key] = 0;\r\n            }\r\n            return push_counters[key]++;\r\n        };\r\n\r\n        $.each($(this).serializeArray(), function(){\r\n\r\n            // skip invalid keys\r\n            if(!patterns.validate.test(this.name)){\r\n                return;\r\n            }\r\n\r\n            var k,\r\n                keys = this.name.match(patterns.key),\r\n                merge = this.value,\r\n                reverse_key = this.name;\r\n\r\n            while((k = keys.pop()) !== undefined){\r\n\r\n                // adjust reverse_key\r\n                reverse_key = reverse_key.replace(new RegExp(\"\\\\[\" + k + \"\\\\]$\"), '');\r\n\r\n                // push\r\n                if(k.match(patterns.push)){\r\n                    merge = self.build([], self.push_counter(reverse_key), merge);\r\n                }\r\n\r\n                // fixed\r\n                else if(k.match(patterns.fixed)){\r\n                    merge = self.build([], k, merge);\r\n                }\r\n\r\n                // named\r\n                else if(k.match(patterns.named)){\r\n                    merge = self.build({}, k, merge);\r\n                }\r\n            }\r\n\r\n            json = $.extend(true, json, merge);\r\n        });\r\n\r\n        return json;\r\n    };\r\n})(jQuery);\r\n\r\nvar numFormat = function(num) {\r\n\t//Seperates the components of the number\r\n\tvar n = num.toString().split(\".\");\r\n\t//Comma-fies the first part\r\n\tn[0] = n[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\r\n\t//Combines the two sections\r\n\treturn n.join(\".\");\r\n}\r\n\r\nvar letterToNumbers = function(string) {\r\n    string = string.toUpperCase();\r\n    var letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', sum = 0, i;\r\n    for (i = 0; i < string.length; i++) {\r\n        sum += Math.pow(letters.length, i) * (letters.indexOf(string.substr(((i + 1) * -1), 1)) + 1);\r\n    }\r\n    return sum;\r\n}\r\n\r\nvar sigFormat = function(input, type) {\r\n\tif (!input) return \"\";\r\n\r\n\tvar alpha = /^[a-zA-Z]+$/;\r\n\tvar numeric = /^[0-9]+$/;\r\n\tvar format = type == \"type\" ? options.chain.typeFormat || \"\" : options.chain.classFormat || \"\";\r\n\r\n\tfor (var x = 0, l = format.length; x < l; x++) {\r\n\t\tif (format[x].match(alpha)) {\r\n\t\t\tif (format[x].toUpperCase() == \"B\" && input == \"a\") {\r\n\t\t\t\treturn \"\";\r\n\t\t\t} else {\r\n\t\t\t\tif (format[x] == format[x].toUpperCase()) {\r\n\t\t\t\t\tformat = format.substr(0, x) + input.toUpperCase() + format.substr(x + 1, l);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tformat = format.substr(0, x) + input + format.substr(x + 1, l);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (format[x].match(numeric)) {\r\n\t\t\tif (format[x] == 2 && input == \"a\") {\r\n\t\t\t\treturn \"\";\r\n\t\t\t} else {\r\n\t\t\t\tformat = format.substr(0, x) + letterToNumbers(input) + format.substr(x +1, l);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn format;\r\n}\r\n\r\nvar sigClass = function(name, type) {\r\n\tvar id = $.map(tripwire.systems, function(system, id) { return system.name == name ? id : null })[0];\r\n\tvar system = {\r\n\t\t\"name\": name,\r\n\t\t\"class\": id ? tripwire.systems[id].class : null,\r\n\t\t\"security\":  id ? tripwire.systems[id].security : null,\r\n\t\t\"type\": type};\r\n\tvar systemType = null;\r\n\r\n\tif (system.class == 6 || system.name == \"Class-6\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 6\"))\r\n\t\tsystemType = \"C6\";\r\n\telse if (system.class == 5 || system.name == \"Class-5\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 5\"))\r\n\t\tsystemType = \"C5\";\r\n\telse if (system.class == 4 || system.name == \"Class-4\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 4\"))\r\n\t\tsystemType = \"C4\";\r\n\telse if (system.class == 3 || system.name == \"Class-3\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 3\"))\r\n\t\tsystemType = \"C3\";\r\n\telse if (system.class == 2 || system.name == \"Class-2\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 2\"))\r\n\t\tsystemType = \"C2\";\r\n\telse if (system.class == 1 || system.name == \"Class-1\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 1\"))\r\n\t\tsystemType = \"C1\";\r\n\telse if (system.security >= 0.45 || system.name == \"High-Sec\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"High-Sec\" && !system.security))\r\n\t\tsystemType = \"HS\";\r\n\telse if (system.security > 0.0 || system.name == \"Low-Sec\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Low-Sec\" && !system.security))\r\n\t\tsystemType = \"LS\";\r\n\telse if ((system.security <= 0.0 && system.security != null) || system.name == \"Null-Sec\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Null-Sec\"))\r\n\t\tsystemType = \"NS\";\r\n\r\n\treturn systemType;\r\n}\r\n\r\nvar isEmpty = function(obj) {\r\n    for(var key in obj) {\r\n        if(obj.hasOwnProperty(key))\r\n            return false;\r\n    }\r\n    return true;\r\n}\r\n\r\nvar getCookie = function(c_name) {\r\n\tvar c_value = document.cookie;\r\n\r\n\tvar c_start = c_value.indexOf(\" \" + c_name + \"=\");\r\n\tif (c_start == -1) {\r\n\t\tc_start = c_value.indexOf(c_name + \"=\");\r\n\t}\r\n\r\n\tif (c_start == -1) {\r\n\t\tc_value = null;\r\n\t} else {\r\n\t\tc_start = c_value.indexOf(\"=\", c_start) + 1;\r\n\t\tvar c_end = c_value.indexOf(\";\", c_start);\r\n\r\n\t\tif (c_end == -1) {\r\n\t\t\tc_end = c_value.length;\r\n\t\t}\r\n\r\n\t\tc_value = unescape(c_value.substring(c_start, c_end));\r\n\t}\r\n\r\n\treturn c_value;\r\n}\r\n\r\nvar setCookie = function(c_name, value, exdays) {\r\n\tvar exdate = new Date();\r\n\texdate.setDate(exdate.getDate() + exdays);\r\n\tvar c_value = escape(value) + ((exdays == null) ? \"\" : \"; expires=\"+exdate.toUTCString());\r\n\r\n\tdocument.cookie = c_name + \"=\" + c_value + \";\" + (document.location.protocol == \"https:\" ? \"secure;\" : \"\");\r\n}\r\n","var viewingSystem = $(\"meta[name=system]\").attr(\"content\");\r\nvar viewingSystemID = $(\"meta[name=systemID]\").attr(\"content\");\r\nvar server = $(\"meta[name=server]\").attr(\"content\");\r\n\r\n// Page cache indicator\r\nif (getCookie(\"loadedFromBrowserCache\") == \"true\") {\r\n\t$(\"#pageTime\").html(\"Page is Cached\");\r\n}\r\n\r\nsetCookie('loadedFromBrowserCache', true);\r\n","var options = new function() {\r\n\tvar localOverrides = [\"grid\"];\r\n\tvar localOptions = JSON.parse(localStorage.getItem(\"tripwire_options\"));\r\n\r\n\tthis.userID = init.userID;\r\n\tthis.character = {id: init.characterID, name: init.characterName};\r\n\tthis.background = null;\r\n\tthis.favorites = [];\r\n\tthis.grid = {};\r\n\tthis.tracking = {active: \"new\"};\r\n\tthis.masks = {active: init.corporationID + \".2\"};\r\n\tthis.chain = {typeFormat: null, classFormat: null, gridlines: true, active: 0, tabs: [], \"node-reference\": \"type\"};\r\n\tthis.signatures = {pasteLife: 72, alignment: {sigID: \"centerAlign\", sigType: \"centerAlign\", sigAge: \"centerAlign\", leadsTo: \"centerAlign\", sigLife: \"centerAlign\", sigMass: \"centerAlign\"}};\r\n\tthis.buttons = {follow: false, chainWidget: {viewing: false, favorites: false}, signaturesWidget: {autoMapper: false}};\r\n\r\n\t// Saves options in both cookie and database\r\n\tthis.save = function() {\r\n\t\tvar options = JSON.stringify(this.get());\r\n\r\n\t\tlocalStorage.setItem(\"tripwire_options\", options);\r\n\r\n\t\treturn $.ajax({\r\n\t\t\turl: \"options.php\",\r\n\t\t\tdata: {mode: \"set\", options: options},\r\n\t\t\ttype: \"POST\",\r\n\t\t\tdataType: \"JSON\"\r\n\t\t});\r\n\t}\r\n\r\n\t// Loads options via passed object else cookie\r\n\tthis.load = function(data) {\r\n\t\tif (data && typeof(data) != \"undefined\") {\r\n\t\t\tthis.set(this, data);\r\n\t\t} else if (localOptions) {\r\n\t\t\tthis.set(this, localOptions);\r\n\t\t}\r\n\r\n\t\tthis.apply();\r\n\t}\r\n\r\n\t// Gets options from this by exluding types == function\r\n\tthis.get = function() {\r\n\t\tvar data = {};\r\n\r\n\t\tfor (var x in this) {\r\n\t\t\tif (typeof(this[x]) != \"function\") {\r\n\t\t\t\tdata[x] = this[x];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\t// Sets this from passed object\r\n\tthis.set = function(local, data) {\r\n\t\tfor (var prop in data) {\r\n\t\t\tif (data[prop] && data[prop].constructor && data[prop].constructor === Object) {\r\n\t\t\t\tif (local) {\r\n\t\t\t\t\tthis.set(local[prop], data[prop]);\r\n\t\t\t\t}\r\n\t\t\t} else if (local && typeof(local[prop]) != \"undefined\") {\r\n\t\t\t\tlocal[prop] = data[prop];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tthis.reset = function() {\r\n\t\tfor (var x in this) {\r\n\t\t\tif (typeof(this[x]) != \"function\") {\r\n\t\t\t\tthis[x] = JSON.parse(JSON.stringify(this.reset.defaults[x]));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Applies settings\r\n\tthis.apply = function() {\r\n\t\t// Local browser overrides\r\n\t\tif (localOptions) {\r\n            for (key in localOverrides) {\r\n                this[localOverrides[key]] = localOptions[localOverrides[key]];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Grid layout (detect old IGB setting options)\r\n\t\tif (this.grid.hasOwnProperty(\"oog\") && !isEmpty(this.grid.oog)) {\r\n\t\t\t$.each(this.grid.oog, function() {\r\n\t\t\t\t$(\"#\"+this.id).attr({\"data-col\": this.col, \"data-row\": this.row, \"data-sizex\": this.size_x, \"data-sizey\": this.size_y})\r\n\t\t\t\t\t.css({width: this.width, height: this.height});\r\n\t\t\t});\r\n\t\t} else if (!isEmpty(this.grid)) {\r\n\t\t\t$.each(this.grid, function() {\r\n\t\t\t\t$(\"#\"+this.id).attr({\"data-col\": this.col, \"data-row\": this.row, \"data-sizex\": this.size_x, \"data-sizey\": this.size_y})\r\n\t\t\t\t\t.css({width: this.width, height: this.height});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Make sure favorites are all ints and not strings\r\n\t\tthis.favorites = $.map(this.favorites, function(favorite) {\r\n\t\t\treturn parseInt(favorite);\r\n\t\t});\r\n\r\n\t\t// Buttons\r\n\t\tif (this.buttons.follow) $(\"#follow\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.home) $(\"#home\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.kspace) $(\"#k-space\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.viewing) $(\"#show-viewing\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.favorites) $(\"#show-favorite\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.evescout) $(\"#eve-scout\").addClass(\"active\");\r\n\t\tif ($.inArray(parseInt(viewingSystemID), this.favorites) !== -1) $(\"#system-favorite\").attr(\"data-icon\", \"star\").addClass(\"active\");\r\n\t\tif (this.buttons.signaturesWidget.autoMapper) $(\"#toggle-automapper\").addClass(\"active\");\r\n\r\n\t\t// Background\r\n\t\tif (this.background) {\r\n\t\t\tvar a = $('<a>', { href:this.background } )[0];\r\n\t\t\t$(\"#wrapper\").attr(\"style\", \"background-image: url(https://\" + a.hostname + a.pathname + a.search + \");\");\r\n\t\t} else {\r\n\t\t\t$(\"#wrapper\").attr(\"style\", \"\");\r\n\t\t}\r\n\r\n\t\t// Characters in Options\r\n\t\t$(\"#dialog-options #characters\").html(\"<img src='https://image.eveonline.com/Character/\"+init.characterID+\"_64.jpg' />\");\r\n\r\n\t\t// Active mask\r\n\t\t$(\"#dialog-options input[name='mask']\").filter(\"[value='\"+this.masks.active+\"']\").attr(\"checked\", true);\r\n\r\n\t\t// Chain tabs\r\n\t\t$(\"#chainTabs\").html(\"\");\r\n\t\tfor (var x in this.chain.tabs) {\r\n\t\t\tif (this.chain.tabs[x]) {\r\n\t\t\t\tvar $tab = $(\"#chainTab .tab\").clone();\r\n\r\n\t\t\t\t$tab.attr(\"id\", x).find(\".name\").data(\"tab\", this.chain.tabs[x].systemID).html(this.chain.tabs[x].name);\r\n\t\t\t\tif (x == this.chain.active) { $tab.addClass(\"current\"); }\r\n\r\n\t\t\t\t$(\"#chainTabs\").append($tab);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Draw chain if Tripwire is initialized\r\n\t\tif (typeof(tripwire) !== \"undefined\") {\r\n\t\t\tchain.redraw();\r\n\t\t}\r\n\t}\r\n\r\n\tthis.reset.defaults = JSON.parse(JSON.stringify(this.get()));\r\n\tthis.load(init && init.options ? init.options : null);\r\n}\r\n","var grid = $(\".gridster ul\").gridster({\r\n\twidget_selector: \"li.gridWidget\",\r\n\tavoid_overlapped_widgets: false,\r\n\twidget_base_dimensions: [50, 50],\r\n\twidget_margins: [5, 5],\r\n\tautogrow_cols: true,\r\n\thelper: \"clone\",\r\n\tdraggable: {\r\n\t\tstart: function(e, ui) {\r\n\t\t\t$(\"div.gridster\").width($(\"div.gridster ul\").width());\r\n\t\t}\r\n\t},\r\n\tresize: {\r\n    \tenabled: true,\r\n    \thandle_class: \"grid-resize\",\r\n    \tmax_size: [30, 30],\r\n    \tmin_size: [4, 4],\r\n    \tstart: function(e) {\r\n    \t\t$(\"div.gridster\").width($(\"div.gridster ul\").width());\r\n    \t},\r\n    \tstop: function(e, ui, $widget) {\r\n    \t\t//var width = parseInt($(\".gridster\").css(\"margin-left\")) + this.container_width;\r\n    \t\t//$(\"#wrapper\").css({width: width + \"px\"})\r\n    \t\tswitch ($widget.attr(\"id\")) {\r\n    \t\t\tcase \"infoWidget\":\r\n    \t\t\t\tsetTimeout(\"activity.redraw();\", 300);\r\n    \t\t\t\tbreak;\r\n    \t\t}\r\n    \t}\r\n\t},\r\n\tserialize_params: function($w, wgd) {\r\n\t\treturn {\r\n\t\t\tid: $w.attr(\"id\"),\r\n\t\t\tcol: wgd.col,\r\n\t\t\trow: wgd.row,\r\n\t\t\tsize_x: wgd.size_x,\r\n\t\t\tsize_y: wgd.size_y,\r\n\t\t\twidth: $w.width(),\r\n\t\t\theight: $w.height()\r\n\t\t}\r\n\t}\r\n}).data(\"gridster\").disable();\r\n\r\ngrid.disable_resize();\r\n$(\".grid-resize\").addClass(\"hidden\").attr(\"data-icon\", \"resize\");\r\n\r\n$(\".gridster\").css({visibility: \"visible\"});\r\n$(\".gridster > *\").addClass(\"gridster-transition\");\r\n\r\n$(\"#layout\").click(function() {\r\n\tif (!$(this).hasClass(\"active\")) {\r\n\t\tgrid.enable();\r\n\t\tgrid.enable_resize();\r\n\t\t$(\".grid-resize\").removeClass(\"hidden\");\r\n\r\n\t\t$(this).addClass(\"active\");\r\n\t} else {\r\n\t\tgrid.disable();\r\n\t\tgrid.disable_resize();\r\n\t\t$(\".grid-resize\").addClass(\"hidden\");\r\n\r\n\t\t$(this).removeClass(\"active\");\r\n\r\n\t\toptions.grid = grid.serialize();\r\n\r\n\t\toptions.save();\r\n\t}\r\n});\r\n","var tripwire = new function() {\r\n    this.timer, this.xhr;\r\n\tthis.version = \"0.8.6\";\r\n\tthis.client = {signatures: {}};\r\n\tthis.server = {signatures: {}};\r\n\tthis.signatures = {list: {}, undo: JSON.parse(sessionStorage.getItem(\"tripwire_undo\")) || {}, redo: JSON.parse(sessionStorage.getItem(\"tripwire_redo\")) || {}};\r\n\tthis.activity = {};\r\n\tthis.data = {tracking: {}, esi: {}};\r\n\tthis.refreshRate = 5000;\r\n\tthis.connected = true;\r\n\tthis.ageFormat = \"HM\";\r\n\tthis.instance = window.name ? window.name : (new Date().getTime() / 1000, window.name = new Date().getTime() / 1000);\r\n\r\n    // Command to start/stop tripwire updates\r\n\t// ToDo: Include API and Server timers\r\n\tthis.stop = function() {\r\n\t\tclearTimeout(this.timer);\r\n\t\treturn this.timer;\r\n\t};\r\n\r\n\tthis.start = function() {\r\n\t\treturn this.sync();\r\n\t}\r\n\r\n    // Command to change Age format\r\n\t// ToDo: Cookie change to keep\r\n\tthis.setAgeFormat = function(format) {\r\n\t\tvar format = typeof(format) !== 'undefined' ? format : this.ageFormat;\r\n\r\n\t\t$(\"span[data-age]\").each(function() {\r\n\t\t\t$(this).countdown(\"option\", {format: format});\r\n\t\t});\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n    this.serverTime = function() {\r\n\t\tthis.time;\r\n\r\n\t\tthis.serverTime.getTime = function() {\r\n\t\t\treturn tripwire.serverTime.time;\r\n\t\t}\r\n\t}\r\n    this.serverTime();\r\n\r\n    // Handles putting chain together\r\n\tthis.chainMap = function() {\r\n\t\tthis.chainMap.parse = function(data) {\r\n\t\t\tchain.draw(data);\r\n\t\t}\r\n\t}\r\n    this.chainMap();\r\n\r\n    this.pastEOL = function() {\r\n\t\tvar options = {since: $(this).countdown('option', 'until'), format: \"HM\", layout: \"-{hnn}{sep}{mnn}&nbsp;\"};\r\n\t\t$(this).countdown(\"option\", options);\r\n\t}\r\n\r\n    // Handles WH Type hover-over tooltip\r\n\t// ToDo: Use native JS\r\n\tthis.whTooltip = function(sig) {\r\n\t\tif (viewingSystemID == sig.systemID) {\r\n\t\t\tif ($.inArray(sig.type, $.map(tripwire.wormholes, function(item, index) { return index;})) >= 0) {\r\n\t\t\t\tvar type = sig.type;\r\n\t\t\t\tvar tooltip = '';\r\n\t\t\t} else {\r\n\t\t\t\tvar type = sig.sig2Type;\r\n\t\t\t\tvar tooltip = \"<b>Type:</b> \"+type+\"<br/>\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif ($.inArray(sig.sig2Type, $.map(tripwire.wormholes, function(item, index) { return index;})) >= 0) {\r\n\t\t\t\tvar type = sig.sig2Type;\r\n\t\t\t\tvar tooltip = '';\r\n\t\t\t} else {\r\n\t\t\t\tvar type = sig.type;\r\n\t\t\t\tvar tooltip = \"<b>Type:</b> \"+type+\"<br/>\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($.inArray(type, $.map(tripwire.wormholes, function(item, index) { return index;})) >= 0) {\r\n\t\t\tvar whType = true;\r\n\t\t} else {\r\n\t\t\tvar whType = false;\r\n\t\t}\r\n\r\n\t\ttooltip += \"<b>Life:</b> \"+(whType?tripwire.wormholes[type].life:\"Unknown\")+\"<br/>\";\r\n\r\n\t\tif (whType) {\r\n\t\t\tswitch (tripwire.wormholes[type].leadsTo.split(\" \")[0]) {\r\n\t\t\t\tcase 'High-Sec':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='hisec'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Low-Sec':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='lowsec'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Null-Sec':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='nullsec'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Class':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='wh'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\ttooltip += \"<b>Leads To:</b> <span>Unknown</span><br/>\";\r\n\t\t}\r\n\r\n\t\ttooltip += \"<b>Max Mass</b>: \"+(whType?numFormat(tripwire.wormholes[type].mass):\"Unknown\")+\" Kg<br/>\";\r\n\r\n\t\ttooltip += \"<b>Max Jumpable</b>: \"+(whType?numFormat(tripwire.wormholes[type].jump):\"Unknown\")+\" Kg<br/>\";\r\n\r\n\t\treturn tooltip;\r\n\t}\r\n\r\n\t// Handles Age hover-over tooltip\r\n\t// ToDo: Use native JS\r\n\tthis.ageTooltip = function(sig) {\r\n\t\tvar date = new Date(sig.lifeTime);\r\n\t\tvar localOffset = date.getTimezoneOffset() * 60000;\r\n\t\tdate = new Date(date.getTime() + localOffset);\r\n\r\n\t\tvar tooltip = \"<table class=\\\"age-tooltip-table\\\"><tr><th>Created:</th><td>\"+(date.getMonth()+1)+\"/\"+date.getDate()+\" \"+(date.getHours() < 10?'0':'')+date.getHours()+\":\"+(date.getMinutes() < 10?'0':'')+date.getMinutes()+\"</td></tr>\";\r\n\r\n\t\tif (sig.lifeTime != sig.time) {\r\n\t\t\tdate = new Date(sig.time);\r\n\t\t\tlocalOffset = date.getTimezoneOffset() * 60000;\r\n\t\t\tdate = new Date(date.getTime() + localOffset);\r\n\r\n\t\t\ttooltip += \"<tr><th>Last Modified:</th><td>\"+(date.getMonth()+1)+\"/\"+date.getDate()+\" \"+(date.getHours() < 10?'0':'')+date.getHours()+\":\"+(date.getMinutes() < 10?'0':'')+date.getMinutes()+\"</td></tr>\";\r\n\t\t}\r\n\r\n\t\ttooltip += \"</table>\";\r\n\r\n\t\treturn tooltip;\r\n\t}\r\n\r\n    this.refresh = function(mode, data, successCallback, alwaysCallback) {\r\n\t\tvar mode = mode || 'refresh';\r\n\r\n\t\tthis.sync(mode, data, successCallback, alwaysCallback);\r\n\t}\r\n}\r\n","tripwire.active = function(data) {\r\n    var editSigs = [];\r\n    var editComments = [];\r\n\r\n    for (var x in data) {\r\n        var activity = JSON.parse(data[x].activity);\r\n        editSigs.push(parseInt(activity.editSig));\r\n        editComments.push(parseInt(activity.editComment));\r\n\r\n        if (activity.editSig) {\r\n            $(\"#sigTable tr[data-id='\"+activity.editSig+\"']\")\r\n                //.attr('data-tooltip', sig.editing)\r\n                //.attr(\"title\", sig.editing)\r\n                .addClass(\"editing\")\r\n                .find(\"td\")\r\n                .animate({backgroundColor: \"#001b47\"}, 1000); //35240A - Yellow\r\n        }\r\n\r\n        if (activity.editComment && $(\"#commentWrapper .comment[data-id='\"+activity.editComment+\"'] .cke\").length > 0) {\r\n            $(\"#commentWrapper .comment[data-id='\"+activity.editComment+\"']\")\r\n                .addClass(\"editing\")\r\n                .find(\".commentStatus\").html(data[x].characterName + \" is editing\").fadeIn();\r\n        }\r\n    }\r\n\r\n    $(\"#sigTable tr.editing\").each(function() {\r\n        if ($.inArray($(this).data(\"id\"), editSigs) == -1) {\r\n            $(\"#sigTable tr[data-id='\"+$(this).data(\"id\")+\"']\")\r\n                //.attr('data-tooltip', '')\r\n                //.removeAttr(\"title\")\r\n                .removeClass(\"editing\")\r\n                .find(\"td\")\r\n                .animate({backgroundColor: \"#111\"}, 1000, null, function() {$(this).css({backgroundColor: \"\"});});\r\n        }\r\n    });\r\n\r\n    $(\"#commentWrapper .editing\").each(function() {\r\n        if ($.inArray($(this).data(\"id\"), editComments) == -1) {\r\n            $(\"#commentWrapper .editing[data-id='\"+$(this).data(\"id\")+\"']\")\r\n                .removeClass(\"editing\")\r\n                .find(\".commentStatus\").fadeOut(function() {$(this).html(\"\")});\r\n        }\r\n    });\r\n}\r\n","// Hanldes adding to Signatures section\r\n// ToDo: Use native JS\r\ntripwire.addSig = function(add, option, disabled) {\r\n    var option = option || {};\r\n    var animate = typeof(option.animate) !== 'undefined' ? option.animate : true;\r\n    var disabled = disabled || false;\r\n\r\n    if (add.mass) {\r\n        var nth = add.systemID == viewingSystemID ? add.nth : add.nth2;\r\n        var sigID = add.systemID == viewingSystemID ? add.signatureID : add.sig2ID;\r\n        var sigtype = add.systemID == viewingSystemID ? add.type : add.sig2Type;\r\n        var sigTypeBM = add.systemID == viewingSystemID ? add.typeBM : add.type2BM;\r\n        var systemID = add.systemID == viewingSystemID ? add.connectionID : add.systemID;\r\n        var name = add.systemID == viewingSystemID ? add.connection : add.system;\r\n        var system = tripwire.systems[systemID] ? \"<a href='.?system=\"+tripwire.systems[systemID].name+\"'>\"+(name ? name : tripwire.systems[systemID].name)+\"</a>\" : name;\r\n\r\n        switch (add.life) {\r\n            case \"Stable\":\r\n                var lifeClass = \"stable\";\r\n                break;\r\n            case \"Critical\":\r\n                var lifeClass = \"critical\";\r\n                break;\r\n            default:\r\n                var lifeClass = \"\";\r\n        }\r\n\r\n        switch (add.mass) {\r\n            case \"Stable\":\r\n                var massClass = \"stable\";\r\n                break;\r\n            case \"Destab\":\r\n                var massClass = \"destab\";\r\n                break;\r\n            case \"Critical\":\r\n                var massClass = \"critical\";\r\n                break;\r\n            default:\r\n                var massClass = \"\";\r\n        }\r\n\r\n        var row = \"<tr data-id='\"+add.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+sigID+\"</td>\"\r\n            //+ \"<td class='type-tooltip' title=\\\"\"+this.whTooltip(add)+\"\\\">\"+(nth>1?'&nbsp;&nbsp;&nbsp;':'')+(sigtype)+(nth>1?' '+nth:'')+\"</td>\"\r\n            + \"<td class='type-tooltip \"+ options.signatures.alignment.sigType +\"' data-tooltip=\\\"\"+this.whTooltip(add)+\"\\\">\"+sigtype+sigFormat(sigTypeBM, \"type\")+\"</td>\"\r\n            + \"<td class=\\\"age-tooltip \"+ options.signatures.alignment.sigAge +\"\\\" data-tooltip='\"+this.ageTooltip(add)+\"'><span data-age='\"+add.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"'>\"+system+\"</td>\"\r\n            + \"<td class='\"+lifeClass+\" \"+ options.signatures.alignment.sigLife +\"'>\"+add.life+\"</td>\"\r\n            + \"<td class='\"+massClass+\" \"+ options.signatures.alignment.sigMass +\"'>\"+add.mass+\"</td>\"\r\n            + \"<td><a href='' class='sigDelete' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">X</a></td>\"\r\n            + \"<td><a href='' class='sigEdit' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\"><</a></td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    } else {\r\n        var row = \"<tr data-id='\"+add.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+add.signatureID+\"</td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigType +\"'>\"+add.type+\"</td>\"\r\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge +\"' data-tooltip='\"+this.ageTooltip(add)+\"'><span data-age='\"+add.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"' colspan='3'>\"+(add.name?linkSig(add.name):'')+\"</td>\"\r\n            + \"<td><a href='' class='sigDelete' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">X</a></td>\"\r\n            + \"<td><a href='' class='sigEdit' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\"><</a></td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    }\r\n\r\n    Tooltips.attach($(tr).find(\"[data-tooltip]\"));\r\n    //Tooltips.attach($(tr))\r\n\r\n    $(\"#sigTable\").append(tr);\r\n\r\n    $(\"#sigTable\").trigger(\"update\");\r\n\r\n    // Add counter\r\n    if (add.life == \"Critical\") {\r\n        $(tr).find('span[data-age]').countdown({until: new Date(add.lifeLeft), onExpiry: this.pastEOL, alwaysExpire: true, compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime})\r\n            .countdown('pause')\r\n            .addClass('critical')\r\n            .countdown('resume');\r\n    } else {\r\n        $(tr).find('span[data-age]').countdown({since: new Date(add.lifeTime), compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime})\r\n            .countdown('pause')\r\n            .countdown('resume');\r\n    }\r\n\r\n    if (animate) {\r\n        $(tr)\r\n            .find('td')\r\n            .wrapInner('<div class=\"hidden\" />')\r\n            .parent()\r\n            .find('td > div')\r\n            .slideDown(700, function(){\r\n                $set = $(this);\r\n                $set.replaceWith($set.contents());\r\n            });\r\n\r\n        $(tr).find(\"td\").animate({backgroundColor: \"#004D16\"}, 1000).delay(1000).animate({backgroundColor: \"#111\"}, 1000, null, function() {$(this).css({backgroundColor: \"\"});});\r\n    }\r\n}\r\n","// Handles API updates\r\ntripwire.API = function() {\r\n    this.indicator;\r\n    this.APIrefresh;\r\n\r\n    this.API.expire = function() {\r\n        var options = {since: tripwire.API.APIrefresh, until: null, format: \"MS\", layout: \"-{mnn}{sep}{snn}\"};\r\n        $(\"#APItimer\").countdown(\"option\", options);\r\n    }\r\n\r\n    this.API.refresh = function() {\r\n        $.ajax({\r\n            url: \"api_update.php\",\r\n            cache: false,\r\n            dataType: \"JSON\",\r\n            data: \"indicator=\"+tripwire.API.indicator\r\n        }).done(function(data) {\r\n            if (data && data.APIrefresh) {\r\n                tripwire.API.indicator = data.indicator;\r\n                tripwire.API.APIrefresh = new Date(data.APIrefresh);\r\n                activity.refresh(); //Refresh graph\r\n\r\n                var options = {until: tripwire.API.APIrefresh, since: null, layout: \"{mnn}{sep}{snn}\"};\r\n                $(\"#APItimer\").countdown(\"option\", options);\r\n                setTimeout(\"tripwire.API.refresh();\", $.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) - 30);\r\n\r\n                // Node activity\r\n                if (data.chain)\r\n                    tripwire.chainMap.parse(data.chain);\r\n            } else if ($(\"#APItimer\").countdown(\"option\", \"layout\") !== \"-{mnn}{sep}{snn}\" && $.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) > 120) {\r\n                setTimeout(\"tripwire.API.refresh();\", ($.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) - 30) * 1000);\r\n            } else {\r\n                setTimeout(\"tripwire.API.refresh();\", 5000);\r\n            }\r\n        });\r\n    }\r\n\r\n    this.API.init = function() {\r\n        $.ajax({\r\n            url: \"api_update.php\",\r\n            cache: true,\r\n            dataType: \"JSON\",\r\n            data: \"init=true\"\r\n        }).done(function(data) {\r\n            tripwire.API.indicator = data.indicator;\r\n            tripwire.API.APIrefresh = new Date(data.APIrefresh);\r\n\r\n            $(\"#APItimer\").countdown({until: tripwire.API.APIrefresh, onExpiry: tripwire.API.expire, alwaysExpire: true, compact: true, format: \"MS\", serverSync: tripwire.serverTime.getTime, onTick: function(t) { $(\"#APIclock\").val(t[5] + 1).trigger(\"change\"); }})\r\n            var timer = $(\"#APItimer\").countdown(\"option\", \"layout\") === \"-{mnn}{sep}{snn}\" ? 15 : $.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) - 30;\r\n            setTimeout(\"tripwire.API.refresh();\", timer * 1000);\r\n\r\n            // Node activity\r\n            if (data.chain)\r\n                tripwire.chainMap.parse(data.chain);\r\n        });\r\n    }\r\n\r\n    this.API.init();\r\n}\r\n","tripwire.autoMapper = function(from, to) {\r\n    // Testing\r\n    // from = $.map(tripwire.systems, function(system, id) { return system.name == from ? id : null; })[0];\r\n    // to = $.map(tripwire.systems, function(system, id) { return system.name == to ? id : null; })[0];\r\n    var pods = [33328, 670];\r\n\r\n    // Make sure from and to are valid systems\r\n    if (!tripwire.systems[from] || !tripwire.systems[to])\r\n        return false;\r\n\r\n    // Is auto-mapper toggled?\r\n    if (!$(\"#toggle-automapper\").hasClass(\"active\"))\r\n        return false;\r\n\r\n    // Is pilot in a pod?\r\n    if ($.inArray(parseInt(tripwire.client.EVE.shipTypeID), pods) >= 0)\r\n        return false;\r\n\r\n    // Is this a gate?\r\n    if (typeof(tripwire.map.shortest[from - 30000000]) != \"undefined\" && typeof(tripwire.map.shortest[from - 30000000][to - 30000000]) != \"undefined\")\r\n        return false;\r\n\r\n    // Is this an existing connection?\r\n    if ($.map(chain.data.rawMap, function(sig) { return (sig.systemID == from && sig.connectionID == to) || (sig.connectionID == from && sig.systemID == to) ? sig : null })[0])\r\n        return false;\r\n\r\n    var data = {\"request\": {\"signatures\": {\"add\": [], \"update\": []}}};\r\n    var sig, toClass = null;\r\n\r\n    if (tripwire.systems[to].class)\r\n        toClass = \"Class \" + tripwire.systems[to].class;\r\n    else if (tripwire.systems[to].security >= 0.45)\r\n        toClass = \"High-Sec\";\r\n    else if (tripwire.systems[to].security > 0)\r\n        toClass = \"Low-Sec\";\r\n    else\r\n        toClass = \"Null-Sec\";\r\n\r\n    sig = $.map(chain.data.rawMap, function(sig) { return sig.systemID == from && sig.mass && ((tripwire.wormholes[sig.type] && tripwire.wormholes[sig.type].leadsTo == toClass && sig.connectionID <= 0) || sig.connection == toClass) ? sig : null; })\r\n    if (sig.length) {\r\n        if (sig.length > 1) {\r\n            $(\"#dialog-msg\").dialog({\r\n                autoOpen: true,\r\n                buttons: {\r\n                    Cancel: function() {\r\n                        $(this).dialog(\"close\");\r\n                    },\r\n                    Ok: function() {\r\n                        var x = $(\"#dialog-msg #msg [name=sig]:checked\").val();\r\n\r\n                        data.request.signatures.update.push({\r\n                            id: sig[x].id,\r\n                            side: \"parent\",\r\n                            signatureID: sig[x].signatureID,\r\n                            systemID: sig[x].systemID,\r\n                            systemName: sig[x].system,\r\n                            type: \"Wormhole\",\r\n                            whType: sig[x].type,\r\n                            sig2ID: sig[x].sig2ID,\r\n                            sig2Type: sig[x].sig2Type,\r\n                            connectionName: tripwire.systems[to].name,\r\n                            connectionID: to,\r\n                            whLife: sig[x].life,\r\n                            whMass: sig[x].mass,\r\n                            lifeLength: sig[x].lifeLength\r\n                        });\r\n\r\n                        data.systemID = viewingSystemID;\r\n\r\n                        var success = function(data) {\r\n                            if (data && data.result == true) {\r\n                                $(\"#dialog-msg\").dialog(\"close\");\r\n                            }\r\n                        }\r\n\r\n                        tripwire.refresh('refresh', data, success);\r\n                    }\r\n                },\r\n                open: function() {\r\n                    $(\"#dialog-msg #msg\").html(\"Which signature would you like to update?<br/><br/>\");\r\n\r\n                    $.each(sig, function(index) {\r\n                        $(\"#dialog-msg #msg\").append(\"<input type='radio' name='sig' value='\"+index+\"' />\"+this.signatureID+\"<br/>\");\r\n                    });\r\n                }\r\n            });\r\n        } else if (sig.length) {\r\n            sig = sig[0];\r\n\r\n            data.request.signatures.update.push({\r\n                id: sig.id,\r\n                side: \"parent\",\r\n                signatureID: sig.signatureID,\r\n                systemID: sig.systemID,\r\n                systemName: sig.system,\r\n                type: \"Wormhole\",\r\n                whType: sig.type,\r\n                sig2ID: sig.sig2ID,\r\n                sig2Type: sig.sig2Type,\r\n                connectionName: tripwire.systems[to].name,\r\n                connectionID: to,\r\n                whLife: sig.life,\r\n                whMass: sig.mass,\r\n                lifeLength: sig.lifeLength\r\n            });\r\n        }\r\n    } else if (sig = $.map(chain.data.rawMap, function(sig) { return sig.systemID == from && sig.connectionID <= 0 && (sig.type == \"???\" || sig.type == \"K162\") ? sig : null; })) {\r\n        if (sig.length > 1) {\r\n            $(\"#dialog-msg\").dialog({\r\n                autoOpen: true,\r\n                buttons: {\r\n                    Cancel: function() {\r\n                        $(this).dialog(\"close\");\r\n                    },\r\n                    Ok: function() {\r\n                        var x = $(\"#dialog-msg #msg [name=sig]:checked\").val();\r\n\r\n                        data.request.signatures.update.push({\r\n                            id: sig[x].id,\r\n                            side: \"parent\",\r\n                            signatureID: sig[x].signatureID,\r\n                            systemID: sig[x].systemID,\r\n                            systemName: sig[x].system,\r\n                            type: \"Wormhole\",\r\n                            whType: sig[x].type,\r\n                            sig2ID: sig[x].sig2ID,\r\n                            sig2Type: sig[x].sig2Type,\r\n                            connectionName: tripwire.systems[to].name,\r\n                            connectionID: to,\r\n                            whLife: sig[x].life,\r\n                            whMass: sig[x].mass,\r\n                            lifeLength: sig[x].lifeLength\r\n                        });\r\n\r\n                        data.systemID = viewingSystemID;\r\n\r\n                        var success = function(data) {\r\n                            if (data && data.result == true) {\r\n                                $(\"#dialog-msg\").dialog(\"close\");\r\n                            }\r\n                        }\r\n\r\n                        tripwire.refresh('refresh', data, success);\r\n                    }\r\n                },\r\n                open: function() {\r\n                    $(\"#dialog-msg #msg\").html(\"Which signature would you like to update?<br/><br/>\");\r\n\r\n                    $.each(sig, function(index) {\r\n                        $(\"#dialog-msg #msg\").append(\"<input type='radio' name='sig' value='\"+index+\"' /> \"+this.signatureID+\"<br/>\");\r\n                    });\r\n                }\r\n            });\r\n        } else if (sig.length) {\r\n            sig = sig[0];\r\n\r\n            data.request.signatures.update.push({\r\n                id: sig.id,\r\n                side: \"parent\",\r\n                signatureID: sig.signatureID,\r\n                systemID: sig.systemID,\r\n                systemName: sig.system,\r\n                type: \"Wormhole\",\r\n                whType: sig.type,\r\n                sig2ID: sig.sig2ID,\r\n                sig2Type: sig.sig2Type,\r\n                connectionName: tripwire.systems[to].name,\r\n                connectionID: to,\r\n                whLife: sig.life,\r\n                whMass: sig.mass,\r\n                lifeLength: sig.lifeLength\r\n            });\r\n        }\r\n    }\r\n\r\n    if (sig.length == 0) {\r\n        data.request.signatures.add.push({\r\n            signatureID: \"???\",\r\n            systemID: from,\r\n            type: \"Wormhole\",\r\n            whType: \"???\",\r\n            class: sigClass(tripwire.systems[from].name, \"???\"),\r\n            class2: sigClass(tripwire.systems[to].name, null),\r\n            connectionName: \"\",\r\n            connectionID: to\r\n        });\r\n    }\r\n\r\n    if (data.request.signatures.add.length || data.request.signatures.update.length) {\r\n        data.systemID = viewingSystemID;\r\n\r\n        var update = $.map(data.request.signatures.update, function(signature) { return tripwire.client.signatures[signature.id]; });\r\n        var success = function(data) {\r\n            if (data.result == true) {\r\n                $(\"#undo\").removeClass(\"disabled\");\r\n                if (viewingSystemID in tripwire.signatures.undo) {\r\n                    if (data.resultSet) {\r\n                        tripwire.signatures.undo[viewingSystemID].push({action: \"add\", signatures: $.map(data.resultSet, function(id) { return data.signatures[id]; })});\r\n                    }\r\n\r\n                    if (update.length) {\r\n                        tripwire.signatures.undo[viewingSystemID].push({action: \"update\", signatures: update});\r\n                    }\r\n                } else {\r\n                    if (data.resultSet) {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{action: \"add\", signatures: $.map(data.resultSet, function(id) { return data.signatures[id]; })}];\r\n                    }\r\n\r\n                    if (update.length) {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{action: \"update\", signatures: update}];\r\n                    }\r\n                }\r\n\r\n                sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n            }\r\n        }\r\n\r\n        tripwire.refresh('refresh', data, success);\r\n    }\r\n}\r\n","$(\"body\").on(\"dblclick\", \".comment\", function(e) {\r\n\te.preventDefault();\r\n\tdocument.getSelection().removeAllRanges();\r\n\t$(this).find(\".commentEdit\").click();\r\n})\r\n\r\n$(\"body\").on(\"click\", \".commentEdit\", function(e) {\r\n\te.preventDefault();\r\n\r\n\t// Prevent multiple editors\r\n\tif ($(\".cke\").length) return false;\r\n\r\n\tvar $comment = $(this).closest(\".comment\");\r\n\r\n\t$comment.find(\".commentToolbar\").hide();\r\n\r\n\tCKEDITOR.replace($comment.find(\".commentBody\").attr(\"id\"), CKConfig).on(\"instanceReady\", function() {\r\n\t\t$comment.find(\".commentStatus\").html(\"\");\r\n\t\t$comment.find(\".commentFooter\").show();\r\n\t\t$comment.find(\".commentFooter .commentControls\").show();\r\n\t});\r\n\r\n\ttripwire.activity.editComment = $comment.data(\"id\");\r\n\ttripwire.refresh('refresh');\r\n});\r\n\r\n$(\"body\").on(\"click\", \".commentSave, .commentCancel\", function(e) {\r\n\te.preventDefault();\r\n\tvar $this = $(this);\r\n\tif ($this.attr(\"disabled\")) return false;\r\n\r\n\tvar $comment = $this.closest(\".comment\");\r\n\t$this.attr(\"disabled\", \"true\");\r\n\r\n\tif ($this.hasClass(\"commentSave\")) {\r\n\t\tvar data = {\"mode\": \"save\", \"commentID\": $comment.data(\"id\"), \"systemID\": $comment.find(\".commentSticky\").hasClass(\"active\") ? 0 : viewingSystemID, \"comment\": CKEDITOR.instances[$comment.find(\".commentBody\").attr(\"id\")].getData()};\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: \"comments.php\",\r\n\t\t\ttype: \"POST\",\r\n\t\t\tdata: data,\r\n\t\t\tdataType: \"JSON\"\r\n\t\t}).done(function(data) {\r\n\t\t\tif (data && data.result == true) {\r\n\t\t\t\t$comment.find(\".commentModified\").html(\"Edited by \" + data.comment.modifiedBy + \" at \" + data.comment.modifiedDate);\r\n\t\t\t\t$comment.find(\".commentCreated\").html(\"Posted by \" + data.comment.createdBy + \" at \" + data.comment.createdDate);\r\n\t\t\t\tTooltips.attach($comment.find(\"[data-tooltip]\"));\r\n\r\n\t\t\t\tCKEDITOR.instances[$comment.find(\".commentBody\").attr(\"id\")].destroy(false);\r\n\t\t\t\t$comment.attr(\"data-id\", data.comment.id);\r\n\t\t\t\t$comment.find(\".commentToolbar\").show();\r\n\t\t\t\t$comment.find(\".commentFooter\").hide();\r\n\t\t\t\t$this.removeAttr(\"disabled\");\r\n\t\t\t}\r\n\t\t});\r\n\t} else {\r\n\t\tCKEDITOR.instances[$comment.find(\".commentBody\").attr(\"id\")].destroy(true);\r\n\r\n\t\tif (!$comment.attr(\"data-id\")) {\r\n\t\t\t$comment.remove();\r\n\t\t} else {\r\n\t\t\t$comment.find(\".commentToolbar\").show();\r\n\t\t\t$comment.find(\".commentFooter\").hide();\r\n\t\t\t$this.removeAttr(\"disabled\");\r\n\t\t}\r\n\t}\r\n\r\n\t$comment.find(\".commentStatus\").html(\"\");\r\n\r\n\tdelete tripwire.activity.editComment;\r\n\ttripwire.refresh('refresh');\r\n});\r\n\r\n$(\"body\").on(\"click\", \".commentDelete\", function(e) {\r\n\te.preventDefault();\r\n\tvar $comment = $(this).closest(\".comment\");\r\n\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-deleteComment\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-deleteComment\").data(\"comment\", $comment).dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tposition: {my: \"center\", at: \"center\", of: $(\"#notesWidget\")},\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tDelete: function() {\r\n\t\t\t\t\t// Prevent duplicate submitting\r\n\t\t\t\t\t$(\"#dialog-deleteComment\").parent().find(\":button:contains('Delete')\").button(\"disable\");\r\n\r\n\t\t\t\t\tvar $comment = $(this).data(\"comment\");\r\n\t\t\t\t\tvar data = {\"mode\": \"delete\", \"commentID\": $comment.data(\"id\")};\r\n\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: \"comments.php\",\r\n\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\tdata: data,\r\n\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t}).done(function(data) {\r\n\t\t\t\t\t\tif (data && data.result == true) {\r\n\t\t\t\t\t\t\t$(\"#dialog-deleteComment\").dialog(\"close\");\r\n\t\t\t\t\t\t\t$comment.remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).always(function() {\r\n\t\t\t\t\t\t$(\"#dialog-deleteComment\").parent().find(\":button:contains('Delete')\").button(\"enable\");\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-deleteComment\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-deleteComment\").data(\"comment\", $comment).dialog(\"open\");\r\n\t}\r\n});\r\n\r\n$(\"body\").on(\"click\", \"#add-comment\", function(e) {\r\n\te.preventDefault();\r\n\r\n\t// Prevent multiple editors\r\n\tif ($(\".cke\").length) return false;\r\n\r\n\tvar $comment = $(\".comment:last\").clone();\r\n\tvar commentID = $(\".comment:visible:last .commentBody\").attr(\"id\") ? $(\".comment:visible:last .commentBody\").attr(\"id\").replace(\"comment\", \"\") + 1 : 0;\r\n\t$(\".comment:last\").before($comment);\r\n\r\n\t$comment.find(\".commentBody\").attr(\"id\", \"comment\" + commentID);\r\n\t$comment.removeClass(\"hidden\").find(\".commentEdit\").click();\r\n});\r\n\r\n$(\"body\").on(\"click\", \".commentSticky\", function(e) {\r\n\te.preventDefault();\r\n\tvar $comment = $(this).closest(\".comment\");\r\n\r\n\tvar data = {\"mode\": \"sticky\", \"commentID\": $comment.data(\"id\"), \"systemID\": $comment.find(\".commentSticky\").hasClass(\"active\") ? viewingSystemID : 0};\r\n\r\n\t$.ajax({\r\n\t\turl: \"comments.php\",\r\n\t\ttype: \"POST\",\r\n\t\tdata: data,\r\n\t\tdataType: \"JSON\"\r\n\t}).done(function(data) {\r\n\t\tif (data && data.result == true) {\r\n\t\t\t$comment.find(\".commentSticky\").hasClass(\"active\") ? $comment.find(\".commentSticky\").removeClass(\"active\") : $comment.find(\".commentSticky\").addClass(\"active\");\r\n\t\t}\r\n\t});\r\n});\r\n","// Handles removing from Signatures section\r\ntripwire.deleteSig = function(key) {\r\n    var tr = $(\"#sigTable tr[data-id='\"+key+\"']\");\r\n\r\n    //Append empty space to prevent non-coloring\r\n    $(tr).find('td:empty, a:empty').append(\"&nbsp;\");\r\n\r\n    $(tr)\r\n        .find('td')\r\n        .wrapInner('<div />')\r\n        .parent()\r\n        .find('td > div').animate({backgroundColor: \"#4D0000\"}, 1000).delay(1000).animate({backgroundColor: \"#111\"}, 1000)\r\n        .slideUp(700, function(){\r\n            // Remove countdown reference\r\n            $(tr).find('span[data-age]').countdown(\"destroy\");\r\n\r\n            $(this).parent().parent().remove();\r\n            $(\"#sigTable\").trigger(\"update\");\r\n        });\r\n}\r\n","// Handles changing Signatures section\r\n// ToDo: Use native JS\r\ntripwire.editSig = function(edit, disabled) {\r\n    var disabled = disabled || false;\r\n\r\n    if (edit.mass) {\r\n        var nth = edit.systemID == viewingSystemID ? edit.nth : edit.nth2;\r\n        var sigID = edit.systemID == viewingSystemID ? edit.signatureID : edit.sig2ID;\r\n        var sigtype = edit.systemID == viewingSystemID ? edit.type : edit.sig2Type;\r\n        var sigTypeBM = edit.systemID == viewingSystemID ? edit.typeBM : edit.type2BM;\r\n        var systemID = edit.systemID == viewingSystemID ? edit.connectionID : edit.systemID;\r\n        var name = edit.systemID == viewingSystemID ? edit.connection : edit.system;\r\n        var system = tripwire.systems[systemID] ? \"<a href='.?system=\"+tripwire.systems[systemID].name+\"'>\"+(name ? name : tripwire.systems[systemID].name)+\"</a>\" : name;\r\n\r\n        switch (edit.life) {\r\n            case \"Stable\":\r\n                var lifeClass = \"stable\";\r\n                break;\r\n            case \"Critical\":\r\n                var lifeClass = \"critical\";\r\n                break;\r\n            default:\r\n                var lifeClass = \"\";\r\n        }\r\n\r\n        switch (edit.mass) {\r\n            case \"Stable\":\r\n                var massClass = \"stable\";\r\n                break;\r\n            case \"Destab\":\r\n                var massClass = \"destab\";\r\n                break;\r\n            case \"Critical\":\r\n                var massClass = \"critical\";\r\n                break;\r\n            default:\r\n                var massClass = \"\";\r\n        }\r\n\r\n        var row = \"<tr data-id='\"+edit.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+sigID+\"</td>\"\r\n            //+ \"<td class='type-tooltip' title=\\\"\"+this.whTooltip(edit)+\"\\\">\"+(nth>1?'&nbsp;&nbsp;&nbsp;':'')+(sigtype)+(nth>1?' '+nth:'')+\"</td>\"\r\n            + \"<td class='type-tooltip \"+ options.signatures.alignment.sigType +\"' data-tooltip=\\\"\"+this.whTooltip(edit)+\"\\\">\"+sigtype+sigFormat(sigTypeBM, \"type\")+\"</td>\"\r\n            + \"<td class=\\\"age-tooltip \"+ options.signatures.alignment.sigAge +\"\\\" data-tooltip='\"+this.ageTooltip(edit)+\"'><span data-age='\"+edit.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"'>\"+system+\"</td>\"\r\n            + \"<td class='\"+lifeClass+\" \"+ options.signatures.alignment.sigLife +\"'>\"+edit.life+\"</td>\"\r\n            + \"<td class='\"+massClass+\" \"+ options.signatures.alignment.sigMass +\"'>\"+edit.mass+\"</td>\"\r\n            + \"<td><a href='' class='sigDelete' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">X</a></td>\"\r\n            + \"<td><a href='' class='sigEdit' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\"><</a></td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    } else {\r\n        var row = \"<tr data-id='\"+edit.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+edit.signatureID+\"</td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigType +\"'>\"+edit.type+\"</td>\"\r\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge +\"' data-tooltip='\"+this.ageTooltip(edit)+\"'><span data-age='\"+edit.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"' colspan='3'>\"+(edit.name?linkSig(edit.name):'')+\"</td>\"\r\n            + \"<td><a href='' class='sigDelete' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">X</a></td>\"\r\n            + \"<td><a href='' class='sigEdit' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\"><</a></td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    }\r\n\r\n    Tooltips.attach($(tr).find(\"[data-tooltip]\"));\r\n\r\n    $(\"#sigTable tr[data-id='\"+edit.id+\"']\").replaceWith(tr);\r\n\r\n    //coloring();\r\n    $(\"#sigTable\").trigger(\"update\");\r\n    // Add counter\r\n    $(tr).find('span[data-age]').countdown(\"destroy\");\r\n    if (edit.life == \"Critical\") {\r\n        $(tr).find('span[data-age]').countdown({until: new Date(edit.lifeLeft), onExpiry: this.pastEOL, alwaysExpire: true, compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime})\r\n            .addClass('critical');\r\n    } else {\r\n        $(tr).find('span[data-age]').countdown({since: new Date(edit.lifeTime), compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime});\r\n    }\r\n\r\n    $(tr).effect(\"pulsate\");\r\n}\r\n","tripwire.esi = function() {\r\n    var baseUrl = \"https://esi.tech.ccp.is\";\r\n    var userAgent = \"Tripwire Client \" + tripwire.version + \" (\" + window.location.hostname + \") - \" + window.navigator.userAgent;\r\n    this.esi.connection = true;\r\n    this.esi.characters = {};\r\n\r\n    var scopeError = function(characterID) {\r\n        $(\"#tracking .tracking-clone[data-characterid='\"+ characterID +\"']\").find(\".alert\").show();\r\n    }\r\n\r\n    var location = function() {\r\n        location.timer;\r\n\r\n        clearTimeout(location.timer);\r\n\r\n        for (characterID in tripwire.esi.characters) {\r\n            var character = tripwire.esi.characters[characterID];\r\n\r\n            // Check for expiring token\r\n            if (moment(character.tokenExpire).subtract(5, \"minutes\").isBefore(moment())) {\r\n                tripwire.data.esi = {\"expired\": true};\r\n                continue;\r\n            }\r\n\r\n            $.ajax({\r\n                url: baseUrl + \"/v1/characters/\"+ characterID +\"/location/?\" + $.param({\"token\": character.accessToken, \"user_agent\": userAgent}),\r\n                // headers: {\"Authorization\": \"Bearer \"+ character.accessToken, \"X-User-Agent\": userAgent},\r\n                type: \"GET\",\r\n                dataType: \"JSON\",\r\n                characterID: characterID\r\n            }).done(function(data, status, xhr) {\r\n                var character = tripwire.esi.characters[this.characterID];\r\n\r\n                if (character) {\r\n                    character.locationDate = xhr.getResponseHeader(\"last-modified\");\r\n\r\n                    if (character.systemID != data.solar_system_id) {\r\n                        character.systemID = data.solar_system_id || null;\r\n                        character.systemName = tripwire.systems[data.solar_system_id] ? tripwire.systems[data.solar_system_id].name : null;\r\n\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".system\").html(character.systemName || \"&nbsp;\");\r\n\r\n                        // Send to Tripwire server on next refresh call\r\n                        tripwire.data.tracking[this.characterID] = {\r\n                            characterID: character.characterID,\r\n                            characterName: character.characterName,\r\n                            systemID: character.systemID,\r\n                            systemName: character.systemName,\r\n                            stationID: character.stationID,\r\n                            stationName: character.stationName,\r\n                            shipID: character.shipID,\r\n                            shipName: character.shipName,\r\n                            shipTypeID: character.shipTypeID,\r\n                            shipTypeName: character.shipTypeName};\r\n                    }\r\n\r\n                    if (character.stationID != data.station_id) {\r\n                        character.stationID = data.station_id || null;\r\n\r\n                        if (data.station_id) {\r\n                            tripwire.esi.stationLookup(data.station_id, this.characterID)\r\n                                .always(function(data) {\r\n                                    var character = tripwire.esi.characters[this.reference];\r\n\r\n                                    character.stationName = data.name || null;\r\n                                    $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference +\"']\").find(\".station\").html(data.name.substring(0, 17) + \"...\" || \"&nbsp;\").attr(\"data-tooltip\", data.name);\r\n                                    Tooltips.attach($(\"#tracking .tracking-clone[data-characterid='\"+ this.reference +\"'] .station[data-tooltip]\"));\r\n\r\n                                    // Send to Tripwire server on next refresh call\r\n                                    tripwire.data.tracking[characterID] = {\r\n                                        characterID: character.characterID,\r\n                                        characterName: character.characterName,\r\n                                        systemID: character.systemID,\r\n                                        systemName: character.systemName,\r\n                                        stationID: character.stationID,\r\n                                        stationName: character.stationName,\r\n                                        shipID: character.shipID,\r\n                                        shipName: character.shipName,\r\n                                        shipTypeID: character.shipTypeID,\r\n                                        shipTypeName: character.shipTypeName};\r\n                                });\r\n                        } else {\r\n                            character.stationName = null;\r\n                            // $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".station\").html(\"&nbsp;\").attr(\"data-tooltip\", \"&nbsp;\");\r\n                            Tooltips.detach($(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"'] .station[data-tooltip]\"));\r\n\r\n                            // Send to Tripwire server on next refresh call\r\n                            tripwire.data.tracking[this.characterID] = {\r\n                                characterID: character.characterID,\r\n                                characterName: character.characterName,\r\n                                systemID: character.systemID,\r\n                                systemName: character.systemName,\r\n                                stationID: character.stationID,\r\n                                stationName: character.stationName,\r\n                                shipID: character.shipID,\r\n                                shipName: character.shipName,\r\n                                shipTypeID: character.shipTypeID,\r\n                                shipTypeName: character.shipTypeName};\r\n                        }\r\n                    }\r\n\r\n                    if (options.tracking.active == this.characterID) {\r\n                        tripwire.EVE(tripwire.esi.characters[options.tracking.active]);\r\n                    }\r\n                }\r\n            }).fail(function(data) {\r\n                if (data.status == 403) {\r\n                    tripwire.refresh(\"refresh\", {\"esi\": {\"expired\": true}});\r\n                }\r\n            }).always(function(data, status) {\r\n                if (status != \"success\" && status != \"abort\" && tripwire.esi.connection == true) {\r\n                    tripwire.esi.connection = false;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Failed\", \"red\", false, \"esiConnectionError\");\r\n                } else if (status == \"success\" && tripwire.esi.connection == false) {\r\n                    tripwire.esi.connection = true;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Resumed\", \"green\", 5000, \"esiConnectionSuccess\");\r\n                }\r\n            });\r\n        }\r\n\r\n        location.timer = setTimeout(location, 5000);\r\n    }\r\n\r\n    var ship = function() {\r\n        ship.timer;\r\n\r\n        clearTimeout(ship.timer);\r\n\r\n        for (characterID in tripwire.esi.characters) {\r\n            var character = tripwire.esi.characters[characterID];\r\n\r\n            // Check for expiring token\r\n            if (moment(character.tokenExpire).subtract(5, \"minutes\").isBefore(moment())) {\r\n                tripwire.data.esi = {\"expired\": true};\r\n                continue;\r\n            }\r\n\r\n            $.ajax({\r\n                url: baseUrl + \"/v1/characters/\"+ characterID +\"/ship/?\" + $.param({\"token\": character.accessToken, \"user_agent\": userAgent}),\r\n                // headers: {\"Authorization\": \"Bearer \"+ character.accessToken, \"X-User-Agent\": userAgent},\r\n                type: \"GET\",\r\n                dataType: \"JSON\",\r\n                characterID: characterID\r\n            }).done(function(data, status, xhr) {\r\n                var character = tripwire.esi.characters[this.characterID];\r\n\r\n                if (character) {\r\n                    character.shipDate = xhr.getResponseHeader(\"last-modified\");\r\n\r\n                    if (character.shipID != data.ship_item_id) {\r\n                        character.shipID = data.ship_item_id || null;\r\n\r\n                        // Send to Tripwire server on next refresh call\r\n                        tripwire.data.tracking[this.characterID] = {\r\n                            characterID: character.characterID,\r\n                            characterName: character.characterName,\r\n                            systemID: character.systemID,\r\n                            systemName: character.systemName,\r\n                            stationID: character.stationID,\r\n                            stationName: character.stationName,\r\n                            shipID: character.shipID,\r\n                            shipName: character.shipName,\r\n                            shipTypeID: character.shipTypeID,\r\n                            shipTypeName: character.shipTypeName};\r\n                    }\r\n\r\n                    if (character.shipName != data.ship_name) {\r\n                        character.shipName = data.ship_name || null;\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".shipname\").html(data.ship_name || \"&nbsp;\");\r\n\r\n                        // Send to Tripwire server on next refresh call\r\n                        tripwire.data.tracking[this.characterID] = {\r\n                            characterID: character.characterID,\r\n                            characterName: character.characterName,\r\n                            systemID: character.systemID,\r\n                            systemName: character.systemName,\r\n                            stationID: character.stationID,\r\n                            stationName: character.stationName,\r\n                            shipID: character.shipID,\r\n                            shipName: character.shipName,\r\n                            shipTypeID: character.shipTypeID,\r\n                            shipTypeName: character.shipTypeName};\r\n                    }\r\n\r\n                    if (character.shipTypeID != data.ship_type_id) {\r\n                        character.shipTypeID = data.ship_type_id || null;\r\n\r\n                        if (data.ship_type_id) {\r\n                            tripwire.esi.typeLookup(data.ship_type_id, this.characterID)\r\n                                .always(function(data) {\r\n                                    var character = tripwire.esi.characters[this.reference];\r\n\r\n                                    character.shipTypeName = data.name || null;\r\n                                    $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference +\"']\").find(\".ship\").html(data.name || \"&nbsp;\");\r\n\r\n                                    // Send to Tripwire server on next refresh call\r\n                                    tripwire.data.tracking[this.characterID] = {\r\n                                        characterID: character.characterID,\r\n                                        characterName: character.characterName,\r\n                                        systemID: character.systemID,\r\n                                        systemName: character.systemName,\r\n                                        stationID: character.stationID,\r\n                                        stationName: character.stationName,\r\n                                        shipID: character.shipID,\r\n                                        shipName: character.shipName,\r\n                                        shipTypeID: character.shipTypeID,\r\n                                        shipTypeName: character.shipTypeName};\r\n                                });\r\n                        } else {\r\n                            character.shipTypeName = null;\r\n                            $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".ship\").html(\"&nbsp;\");\r\n\r\n                            // Send to Tripwire server on next refresh call\r\n                            tripwire.data.tracking[this.characterID] = {\r\n                                characterID: character.characterID,\r\n                                characterName: character.characterName,\r\n                                systemID: character.systemID,\r\n                                systemName: character.systemName,\r\n                                stationID: character.stationID,\r\n                                stationName: character.stationName,\r\n                                shipID: character.shipID,\r\n                                shipName: character.shipName,\r\n                                shipTypeID: character.shipTypeID,\r\n                                shipTypeName: character.shipTypeName};\r\n                        }\r\n                    }\r\n                }\r\n            }).fail(function(data) {\r\n                if (data.status == 403) {\r\n                    tripwire.refresh(\"refresh\", {\"esi\": {\"expired\": true}});\r\n                }\r\n            }).always(function(data, status) {\r\n                if (status != \"success\" && status != \"abort\" && tripwire.esi.connection == true) {\r\n                    tripwire.esi.connection = false;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Failed\", \"red\", false, \"esiConnectionError\");\r\n                } else if (status == \"success\" && tripwire.esi.connection == false) {\r\n                    tripwire.esi.connection = true;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Resumed\", \"green\", 5000, \"esiConnectionSuccess\");\r\n                }\r\n            });\r\n        }\r\n\r\n        ship.timer = setTimeout(ship, 5000);\r\n    }\r\n\r\n    var online = function() {\r\n        online.timer;\r\n\r\n        clearTimeout(online.timer);\r\n\r\n        for (characterID in tripwire.esi.characters) {\r\n            var character = tripwire.esi.characters[characterID];\r\n\r\n            tripwire.esi.characterStatus(character.characterID, character)\r\n                .done(function(data) {\r\n                    if (data) {\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference.characterID +\"']\").find(\".online\").removeClass(\"critical\").addClass(\"stable\");\r\n                    } else {\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference.characterID +\"']\").find(\".online\").removeClass(\"stable\").addClass(\"critical\");\r\n                    }\r\n                }).fail(function(data) {\r\n                    if (data && data.status == 403) {\r\n                        scopeError(this.reference.characterID);\r\n                    }\r\n                    $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference.characterID +\"']\").find(\".online\").removeClass(\"stable\").addClass(\"critical\");\r\n                });\r\n        }\r\n\r\n        online.timer = setTimeout(online, 60000);\r\n    }\r\n\r\n    this.esi.typeLookup = function(typeID, reference) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/universe/types/\"+ typeID +\"/?\" + $.param({\"user_agent\": userAgent}),\r\n            // headers: {\"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            reference: reference\r\n        });\r\n    }\r\n\r\n    this.esi.stationLookup = function(stationID, reference) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/universe/stations/\"+ stationID +\"/?\" + $.param({\"user_agent\": userAgent}),\r\n            // headers: {\"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            reference: reference\r\n        });\r\n    }\r\n\r\n    this.esi.setDestination = function(destinationID, characterID, clear_waypoints, beginning) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/ui/autopilot/waypoint/?\" + $.param({destination_id: destinationID, clear_other_waypoints: clear_waypoints, add_to_beginning: beginning}),\r\n            headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.characters[characterID].accessToken, \"X-User-Agent\": userAgent},\r\n            type: \"POST\",\r\n            dataType: \"JSON\"\r\n        });\r\n    }\r\n\r\n    this.esi.showInfo = function(targetID, characterID) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v1/ui/openwindow/information/?\" + $.param({target_id: targetID}),\r\n            headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.characters[characterID].accessToken, \"X-User-Agent\": userAgent},\r\n            type: \"POST\",\r\n            dataType: \"JSON\"\r\n        });\r\n    }\r\n\r\n    this.esi.characterStatus = function(characterID, reference) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v1/characters/\" + characterID + \"/online/?\" + $.param({\"token\": tripwire.esi.characters[characterID].accessToken, \"user_agent\": userAgent}),\r\n            // headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.characters[characterID].accessToken, \"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            reference: reference\r\n        });\r\n    }\r\n\r\n    this.esi.eveStatus = function() {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v1/status/?\" + $.param({\"user_agent\": userAgent}),\r\n            // headers: {\"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\"\r\n        });\r\n    }\r\n\r\n    this.esi.parse = function(characters) {\r\n        for (characterID in tripwire.esi.characters) {\r\n            if (!(characterID in characters)) {\r\n                delete tripwire.esi.characters[characterID];\r\n                $(\"#tracking .tracking-clone[data-characterid='\"+ characterID +\"']\").remove();\r\n                if (options.tracking.active == characterID) {\r\n                    tripwire.EVE(false, true);\r\n                    $(\"#removeESI\").attr(\"disabled\", \"disabled\");\r\n                }\r\n            }\r\n        }\r\n\r\n        for (characterID in characters) {\r\n            if (options.tracking.active == \"new\") {\r\n                options.tracking.active = characterID;\r\n            }\r\n\r\n            if (!(characterID in tripwire.esi.characters)) {\r\n                var $clone = $(\"#tracking-clone\").clone();\r\n                $clone.attr(\"data-characterid\", characterID);\r\n                $clone.find(\".avatar img\").attr(\"src\", \"https://image.eveonline.com/Character/\"+ characterID +\"_32.jpg\");\r\n                $clone.find(\".name\").html(characters[characterID].characterName);\r\n                $clone.removeAttr(\"id\");\r\n                $clone.removeClass(\"hidden\");\r\n                $clone.addClass(\"tracking-clone\");\r\n\r\n                if (options.tracking.active == characterID) {\r\n                    $clone.addClass(\"active\");\r\n                    $(\"#removeESI\").removeAttr(\"disabled\");\t\t\t\t}\r\n\r\n                $(\"#tracking\").append($clone);\r\n                // Tooltips.attach($clone.find(\"[data-tooltip]\"));\r\n            }\r\n\r\n            tripwire.esi.characters[characterID] = characters[characterID];\r\n        }\r\n\r\n        ship();\r\n        location();\r\n        online();\r\n    }\r\n}\r\ntripwire.esi();\r\n","// Handles data from EVE in-game data\r\ntripwire.EVE = function(EVE, characterChange) {\r\n    var systemChange = this.client.EVE && this.client.EVE.systemChange || false;\r\n\r\n    if (EVE) {\r\n        // Automapper\r\n        if (!characterChange) {\r\n            // Did the system change or did it previously and we have yet to try an autoMapper call?\r\n            if ((this.client.EVE && this.client.EVE.systemID != EVE.systemID) || systemChange == true) {\r\n                systemChange = true;\r\n\r\n                // Check if location was updated after the last ship update\r\n                if (moment(EVE.locationDate).isAfter(moment(this.client.EVE.shipDate))) {\r\n                    systemChange = false;\r\n                    tripwire.autoMapper(this.client.EVE.systemID, EVE.systemID);\r\n                }\r\n            }\r\n        }\r\n\r\n        // System follower\r\n        if (!characterChange && options.buttons.follow && (this.client.EVE && this.client.EVE.systemID != EVE.systemID) && $(\".ui-dialog:visible\").length == 0) {\r\n            tripwire.systemChange(EVE.systemID);\r\n        }\r\n\r\n        if (!$(\"#search\").hasClass(\"active\")) {\r\n            $(\"#currentSpan\").show();\r\n        }\r\n\r\n        // Update current system\r\n        if (EVE.systemID) {\r\n            $(\"#EVEsystem\").html(tripwire.systems[EVE.systemID].name).attr(\"href\", \".?system=\"+ tripwire.systems[EVE.systemID].name);\r\n        }\r\n    } else {\r\n        // Update current system\r\n        $(\"#EVEsystem\").html(\"\");\r\n        $(\"#currentSpan\").hide();\r\n    }\r\n\r\n    this.client.EVE = {\r\n        characterID: EVE.characterID,\r\n        characterName: EVE.characterName,\r\n        systemID: EVE.systemID,\r\n        systemName: EVE.systemName,\r\n        shipTypeID: EVE.shipTypeID,\r\n        shipTypeName: EVE.shipTypeName,\r\n        stationID: EVE.stationID,\r\n        stationName: EVE.stationName,\r\n        locationDate: EVE.locationDate,\r\n        shipDate: EVE.shipDate,\r\n        systemChange: systemChange\r\n    };\r\n}\r\n","tripwire.parse = function(server, mode) {\r\n    var data = $.extend(true, {}, server);\r\n\r\n    if (options.chain.active == null || (options.chain.tabs[options.chain.active] && options.chain.tabs[options.chain.active].evescout != true)) {\r\n        if (options.masks.active != \"273.0\") {\r\n            for (var key in data.signatures) {\r\n                if (data.signatures[key].mask == \"273.0\") {\r\n                    delete data.signatures[key];\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    if (mode == 'refresh') {\r\n        for (var key in data.signatures) {\r\n            var disabled = data.signatures[key].mask == \"273.0\" && options.masks.active != \"273.0\" ? true : false;\r\n\r\n            // Check for differences\r\n            if (!tripwire.signatures.list[key]) {\r\n                this.addSig(data.signatures[key], {animate: true}, disabled);\r\n            } else if (tripwire.signatures.list[key].time !== data.signatures[key].time) {\r\n                var edit = false;\r\n                for (column in data.signatures[key]) {\r\n                    if (data.signatures[key][column] != tripwire.signatures.list[key][column] && column != \"time\" && column != \"editing\") {\r\n                        edit = true;\r\n                    }\r\n                }\r\n\r\n                if (edit) {\r\n                    this.editSig(data.signatures[key], disabled);\r\n                } else {\r\n                    this.sigEditing(data.signatures[key]);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Sigs needing removal\r\n        for (var key in tripwire.signatures.list) {\r\n            if (!data.signatures[key]) {\r\n                this.deleteSig(key);\r\n            }\r\n        }\r\n\r\n        //client and server should now match\r\n        this.client = server;\r\n    } else if (mode == 'init' || mode == 'change') {\r\n\r\n        for (var key in data.signatures) {\r\n            var disabled = data.signatures[key].mask == \"273.0\" && options.masks.active != \"273.0\" ? true : false;\r\n\r\n            this.addSig(data.signatures[key], {animate: false}, disabled);\r\n\r\n            if (data.signatures[key].editing) {\r\n                this.sigEditing(data.signatures[key]);\r\n            }\r\n        }\r\n\r\n        this.client = server;\r\n    }\r\n\r\n    tripwire.signatures.list = data.signatures;\r\n\r\n    // set the sig count in the UI\r\n    $(\"#signature-count\").html(data.signatures.length || Object.size(data.signatures) || 0);\r\n}\r\n","// Handles pasting sigs from EVE\r\ntripwire.pasteSignatures = function() {\r\n    var processing = false;\r\n    var paste;\r\n\r\n    var rowParse = function(row) {\r\n        var scanner = {group: \"\", type: \"\"};\r\n        var columns = row.split(\"\t\"); // Split by tab\r\n        var validScanGroups = [\"Cosmic Signature\", \"Cosmic Anomaly\", \"Kosmische Anomalie\", \"Kosmische Signatur\",\r\n                                \"Источники сигналов\", \"Космическая аномалия\"];\r\n        var validGroups = [\"Wormhole\", \"Relic Site\", \"Gas Site\", \"Ore Site\", \"Data Site\", \"Combat Site\",\r\n                            \"Wurmloch\", \"Reliktgebiet\", \"Gasgebiet\", \"Mineraliengebiet\", \"Datengebiet\", \"Kampfgebiet\",\r\n                            \"Червоточина\", \"АРТЕФАКТЫ: район поиска артефактов\", \"ГАЗ: район добычи газа\", \"РУДА: район добычи руды\", \"ДАННЫЕ: район сбора данных\", \"ОПАСНО: район повышенной опасности\"];\r\n\r\n        for (var x in columns) {\r\n            if (columns[x].match(/([A-Z]{3}[-]\\d{3})/)) {\r\n                scanner.id = columns[x].split(\"-\");\r\n                continue;\r\n            }\r\n\r\n            if (columns[x].match(/(\\d([.|,]\\d)?[ ]?(%))/) || columns[x].match(/(\\d[.|,]?\\d+\\s(AU|AE|km|m|а.е.|км|м))/i)) { // Exclude scan % || AU\r\n                continue;\r\n            }\r\n\r\n            if ($.inArray(columns[x], validScanGroups) != -1) {\r\n                scanner.scanGroup = columns[x];\r\n                continue;\r\n            }\r\n\r\n            if ($.inArray(columns[x], validGroups) != -1) {\r\n                scanner.group = columns[x];\r\n                continue;\r\n            }\r\n\r\n            if (columns[x] != \"\") {\r\n                scanner.type = columns[x];\r\n            }\r\n        }\r\n\r\n        if (!scanner.id || scanner.id.length !== 2) {\r\n            return false;\r\n        }\r\n\r\n        return scanner;\r\n    }\r\n\r\n    this.pasteSignatures.parsePaste = function(data) {\r\n        var rows = data.split(\"\\n\");\r\n        var data = {\"request\": {\"signatures\": {\"add\": [], \"update\": []}}};\r\n        var ids = $.map(tripwire.client.signatures, function(sig) {return sig.mask == \"273.0\" && ((options.chain.active != null && !options.chain.tabs[options.chain.active].evescout) || options.chain.active == null) ? null : (viewingSystemID == sig.systemID ? sig.signatureID : sig.sig2ID)});\r\n        var wormholeGroups = [\"Wormhole\", \"Wurmloch\", \"Червоточина\"];\r\n        var siteGroups = [\"Combat Site\", \"Kampfgebiet\", \"ОПАСНО: район повышенной опасности\"];\r\n        var otherGroups = {\"Gas Site\": \"Gas\", \"Data Site\": \"Data\", \"Relic Site\": \"Relic\", \"Ore Site\": \"Ore\",\r\n                            \"Gasgebiet\": \"Gas\", \"Datengebiet\": \"Data\", \"Reliktgebiet\": \"Relic\", \"Mineraliengebiet\": \"Ore\",\r\n                            \"ГАЗ: район добычи газа\": \"Gas\", \"ДАННЫЕ: район сбора данных\": \"Data\", \"АРТЕФАКТЫ: район поиска артефактов\": \"Relic\", \"РУДА: район добычи руды\": \"Ore\"};\r\n\r\n        for (var row in rows) {\r\n            var scanner = rowParse(rows[row]);\r\n\r\n            if (scanner.id) {\r\n                if ($.inArray(scanner.group, wormholeGroups) != -1) {\r\n                    type = \"Wormhole\";\r\n                    whType = \"???\";\r\n                    sigName = null;\r\n                } else if ($.inArray(scanner.group, siteGroups) != -1) {\r\n                    type = 'Sites';\r\n                    sigName = scanner.type;\r\n                } else if (otherGroups[scanner.group]) {\r\n                    type = otherGroups[scanner.group];\r\n                    sigName = scanner.type;\r\n                } else {\r\n                    type = null;\r\n                    sigName = null;\r\n                }\r\n\r\n                if (ids.indexOf(scanner.id[0]) !== -1) {\r\n                    // Update signature\r\n                    sig = $.map(tripwire.client.signatures, function(sig) {return sig.mask == \"273.0\" && ((options.chain.active != null && !options.chain.tabs[options.chain.active].evescout) || options.chain.active == null) ? null : (viewingSystemID == sig.systemID ? (sig.signatureID == scanner.id[0]?sig:null):(sig.sig2ID == scanner.id[0]?sig:null))})[0];\r\n                    if (sig && viewingSystemID == sig.systemID) {\r\n                        // Parent side\r\n                        if ((type && sig.type != type) || (sigName && sig.name != sigName)) {\r\n                            if ((type == \"Wormhole\" && sig.life == null) || type !== \"Wormhole\") {\r\n                                data.request.signatures.update.push({\r\n                                    id: sig.id,\r\n                                    side: \"parent\",\r\n                                    signatureID: scanner.id[0],\r\n                                    systemID: viewingSystemID,\r\n                                    systemName: \"\",\r\n                                    type: type || sig.type || \"???\",\r\n                                    name: sigName || sig.name,\r\n                                    sig2ID: sig.sig2ID || \"???\",\r\n                                    connectionName: sig.connection || null,\r\n                                    connectionID: sig.connectionID || null,\r\n                                    whLife: sig.life || \"New Stable\",\r\n                                    whMass: sig.mass || \"Stable\",\r\n                                    lifeLength: sig.lifeLength || 24,\r\n                                    life: sig.lifeLength || 24\r\n                                });\r\n                            }\r\n                        }\r\n                    } else {\r\n                        // Child side\r\n                        if (sig && ((type && sig.sig2Type != type) || (sigName && sig.name != sigName))) {\r\n                            if ((type == \"Wormhole\" && sig.life == null) || type !== \"Wormhole\") {\r\n                                data.request.signatures.update.push({\r\n                                    id: sig.id,\r\n                                    side: \"child\",\r\n                                    sig2ID: scanner.id[0],\r\n                                    systemID: sig.connectionID || null,\r\n                                    systemName: sig.connectionName || null,\r\n                                    type: type || sig.sig2Type || \"???\",\r\n                                    name: sigName || sig.name,\r\n                                    connectionName: \"\",\r\n                                    connectionID: viewingSystemID,\r\n                                    whLife: sig.life || \"New Stable\",\r\n                                    whMass: sig.mass || \"Stable\",\r\n                                    lifeLength: sig.lifeLength || 24,\r\n                                    life: sig.lifeLength || 24\r\n                                });\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    // Add signature\r\n                    ids.push(scanner.id[0]);\r\n\r\n                    data.request.signatures.add.push({\r\n                        signatureID: scanner.id[0],\r\n                        systemID: viewingSystemID,\r\n                        connectionName: \"\",\r\n                        type: type || \"???\",\r\n                        name: sigName,\r\n                        life: options.signatures.pasteLife,\r\n                        lifeLength: options.signatures.pasteLife\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        if (data.request.signatures.add.length || data.request.signatures.update.length) {\r\n            data.systemID = viewingSystemID;\r\n\r\n            var update = $.map(data.request.signatures.update, function(signature) { return tripwire.client.signatures[signature.id]; });\r\n            var success = function(data) {\r\n                if (data.result == true) {\r\n                    $(\"#undo\").removeClass(\"disabled\");\r\n                    if (viewingSystemID in tripwire.signatures.undo) {\r\n                        if (data.resultSet) {\r\n                            tripwire.signatures.undo[viewingSystemID].push({action: \"add\", signatures: $.map(data.resultSet, function(id) { return data.signatures[id]; })});\r\n                        }\r\n\r\n                        if (update.length) {\r\n                            tripwire.signatures.undo[viewingSystemID].push({action: \"update\", signatures: update});\r\n                        }\r\n                    } else {\r\n                        if (data.resultSet) {\r\n                            tripwire.signatures.undo[viewingSystemID] = [{action: \"add\", signatures: $.map(data.resultSet, function(id) { return data.signatures[id]; })}];\r\n                        }\r\n\r\n                        if (update.length) {\r\n                            tripwire.signatures.undo[viewingSystemID] = [{action: \"update\", signatures: update}];\r\n                        }\r\n                    }\r\n\r\n                    sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n                }\r\n            }\r\n\r\n            var always = function(data) {\r\n                processing = false;\r\n            }\r\n\r\n            tripwire.refresh('refresh', data, success, always);\r\n        } else {\r\n            processing = false;\r\n        }\r\n    }\r\n\r\n    this.pasteSignatures.init = function() {\r\n        $(document).keydown(function(e)\t{\r\n            if ((e.metaKey || e.ctrlKey) && (e.keyCode == 86 || e.keyCode == 91) && !processing) {\r\n                //Abort - user is in input or textarea\r\n                if ($(document.activeElement).is(\"textarea, input\")) return;\r\n\r\n                $(\"#clipboard\").focus();\r\n            }\r\n        });\r\n\r\n        $(\"body\").on(\"click\", \"#fullPaste\", function(e) {\r\n            e.preventDefault();\r\n\r\n            var rows = paste.split(\"\\n\");\r\n            var pasteIDs = [];\r\n            var deletes = [];\r\n            var undo = [];\r\n\r\n            for (var x in rows) {\r\n                if (scan = rowParse(rows[x])) {\r\n                    pasteIDs.push(scan.id[0]);\r\n                }\r\n            }\r\n\r\n            for (var i in tripwire.client.signatures) {\r\n                var sig = tripwire.client.signatures[i];\r\n\r\n                if (sig.systemID == viewingSystemID && $.inArray(sig.signatureID, pasteIDs) == -1 && sig.type !== \"GATE\" && sig.signatureID !== \"???\") {\r\n                    deletes.push(sig.id);\r\n                    undo.push(sig);\r\n                } else if (sig.connectionID == viewingSystemID && $.inArray(sig.sig2ID, pasteIDs) == -1 && sig.sig2Type !== \"GATE\" && sig.sig2ID !== \"???\") {\r\n                    deletes.push(sig.id);\r\n                    undo.push(sig);\r\n                }\r\n            }\r\n\r\n            if (deletes.length > 0) {\r\n                var data = {\"request\": {\"signatures\": {\"delete\": deletes}}};\r\n\r\n                var success = function(data) {\r\n                    if (data.result == true) {\r\n                        $(\"#undo\").removeClass(\"disabled\");\r\n                        if (viewingSystemID in tripwire.signatures.undo) {\r\n                            tripwire.signatures.undo[viewingSystemID].push({action: \"delete\", signatures: undo});\r\n                        } else {\r\n                            tripwire.signatures.undo[viewingSystemID] = [{action: \"delete\", signatures: undo}];\r\n                        }\r\n\r\n                        sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n                    }\r\n                }\r\n\r\n                tripwire.refresh('refresh', data, success);\r\n            }\r\n        });\r\n\r\n        $(\"#clipboard\").on(\"paste\", function(e) {\r\n            e.preventDefault();\r\n            var data = window.clipboardData ? window.clipboardData.getData(\"Text\") : (e.originalEvent || e).clipboardData.getData('text/plain');\r\n\r\n            $(\"#clipboard\").blur();\r\n\r\n            processing = true;\r\n            paste = data;\r\n            Notify.trigger(\"Paste detected<br/>(<a id='fullPaste' href=''>Click to delete missing sigs</a>)\");\r\n            tripwire.pasteSignatures.parsePaste(data);\r\n        });\r\n    }\r\n\r\n    this.pasteSignatures.init();\r\n}\r\ntripwire.pasteSignatures();\r\n","tripwire.redo = function() {\r\n    if (tripwire.signatures.redo[viewingSystemID].length > 0) {\r\n        $(\"#redo\").addClass(\"disabled\");\r\n        var lastIndex = tripwire.signatures.redo[viewingSystemID].length -1;\r\n        var data = {\"systemID\": viewingSystemID, \"request\": {\"signatures\": {\"add\": [], \"delete\": [], \"update\": []}}};\r\n\r\n        var redoItem = tripwire.signatures.redo[viewingSystemID][lastIndex];\r\n\r\n        switch(redoItem.action) {\r\n            case \"add\":\r\n                data.request.signatures.add = data.request.signatures.add.concat(redoItem.signatures);\r\n                break;\r\n            case \"delete\":\r\n                data.request.signatures.delete = data.request.signatures.delete.concat($.map(redoItem.signatures, function(signature) { return signature.id }));\r\n                break;\r\n            case \"update\":\r\n                data.request.signatures.update = data.request.signatures.update.concat(redoItem.signatures);\r\n                break;\r\n        }\r\n\r\n        var signatures = tripwire.client.signatures;\r\n\r\n        var success = function(data) {\r\n            if (data.result == true) {\r\n                tripwire.signatures.redo[viewingSystemID].pop();\r\n\r\n                $(\"#undo\").removeClass(\"disabled\");\r\n                if (viewingSystemID in tripwire.signatures.undo) {\r\n                    if (redoItem.action == \"update\") {\r\n                        tripwire.signatures.undo[viewingSystemID].push({\"action\": redoItem.action, \"signatures\": $.map(redoItem.signatures, function(signature) { return signatures[signature.id]; })});\r\n                    } else {\r\n                        tripwire.signatures.undo[viewingSystemID].push({action: redoItem.action, signatures: redoItem.signatures});\r\n                    }\r\n                } else {\r\n                    if (redoItem.action == \"update\") {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{\"action\": redoItem.action, \"signatures\": $.map(redoItem.signatures, function(signature) { return signatures[signature.id]; })}];\r\n                    } else {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{action: redoItem.action, signatures: redoItem.signatures}];\r\n                    }\r\n                }\r\n\r\n                sessionStorage.setItem(\"tripwire_redo\", JSON.stringify(tripwire.signatures.redo));\r\n                sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n            }\r\n        }\r\n\r\n        var always = function(data) {\r\n            if (tripwire.signatures.redo[viewingSystemID].length > 0) {\r\n                $(\"#redo\").removeClass(\"disabled\");\r\n            }\r\n        }\r\n\r\n        tripwire.refresh('refresh', data, success, always);\r\n    }\r\n}\r\n","// Handles pulling TQ status & player count\r\ntripwire.serverStatus = function() {\r\n    this.data;\r\n    this.timer;\r\n\r\n    clearTimeout(tripwire.serverStatus.timer);\r\n\r\n    tripwire.esi.eveStatus()\r\n        .always(function(data) {\r\n            if (data && data.players && data.players > 0) {\r\n                if (!tripwire.serverStatus.data || tripwire.serverStatus.data.players !== data.players) {\r\n                    $('#serverStatus').html(\"<span class='\"+(data.players > 0 ? 'stable' : 'critical')+\"'>TQ</span>: \"+numFormat(data.players));\r\n\r\n                    if (tripwire.serverStatus.data) {\r\n                        $(\"#serverStatus\").effect('pulsate', {times: 5});\r\n                    }\r\n                }\r\n\r\n                tripwire.serverStatus.data = data;\r\n            } else {\r\n                $('#serverStatus').html(\"<span class='critical'>TQ</span>\");\r\n            }\r\n\r\n            tripwire.serverStatus.timer = setTimeout(\"tripwire.serverStatus();\", 15000);\r\n        });\r\n}\r\ntripwire.serverStatus();\r\n","tripwire.sync = function(mode, data, successCallback, alwaysCallback) {\r\n    var data = typeof(data) === \"object\" ? data : {};\r\n\r\n    // Grab any pending changes\r\n    $.extend(true, data, tripwire.data);\r\n\r\n    // Remove old timer to prevent multiple\r\n    if (this.timer) clearTimeout(this.timer);\r\n    if (this.xhr) this.xhr.abort();\r\n\r\n    if (mode == 'refresh' || mode == 'change') {\r\n        data.sigCount = Object.size(this.client.signatures);\r\n        data.sigTime = Object.maxTime(this.client.signatures, \"time\");\r\n\r\n        data.chainCount = Object.size(chain.data.rawMap);\r\n        data.chainTime = Object.maxTime(chain.data.rawMap, \"time\");\r\n\r\n        data.flareCount = chain.data.flares ? chain.data.flares.flares.length : 0;\r\n        data.flareTime = chain.data.flares ? chain.data.flares.last_modified : 0;\r\n\r\n        data.commentCount = Object.size(this.comments.data);\r\n        data.commentTime = Object.maxTime(this.comments.data, \"modified\");\r\n\r\n        data.activity = this.activity;\r\n    } else {\r\n        $.extend(this, $.ajax({url: \"//\"+ server +\"/js/combine.json?v=2017-01-30\", async: false, dataType: \"JSON\"}).responseJSON);\r\n\r\n        //this.wormholes = $.ajax({url: \"js/wormholes.json\", async: false, dataType: \"JSON\"}).responseJSON;\r\n        //this.map = $.ajax({url: \"js/map.json\", async: false, dataType: \"JSON\"}).responseJSON;\r\n        //this.systems = $.ajax({url: \"js/systems.json\", async: false, dataType: \"JSON\"}).responseJSON;\r\n        //this.regions = $.ajax({url: \"js/regions.json\", async: false, dataType: \"JSON\"}).responseJSON;\r\n        //this.factions = $.ajax({url: \"js/factions.json\", async: false, dataType: \"JSON\"}).responseJSON;\r\n        this.aSystems = $.map(this.systems, function(system) { return system.name; });\r\n        this.aSigSystems = [\"Null-Sec\", \"Low-Sec\", \"High-Sec\", \"Class-1\", \"Class-2\", \"Class-3\", \"Class-4\", \"Class-5\", \"Class-6\"];\r\n        $.merge(this.aSigSystems, this.aSystems.slice());\r\n    }\r\n\r\n    data.mode = mode != \"init\" ? \"refresh\" : \"init\";\r\n    data.systemID = viewingSystemID;\r\n    data.systemName = viewingSystem;\r\n    data.instance = tripwire.instance;\r\n    data.version = tripwire.version;\r\n\r\n    this.xhr = $.ajax({\r\n        url: \"refresh.php\",\r\n        data: data,\r\n        type: \"POST\",\r\n        dataType: \"JSON\",\r\n        cache: false\r\n    }).done(function(data) {\r\n        if (data) {\r\n            tripwire.server = data;\r\n\r\n            if (data.esi) {\r\n                tripwire.esi.parse(data.esi);\r\n            }\r\n\r\n            if (data.sync) {\r\n                tripwire.serverTime.time = new Date(data.sync);\r\n                tripwire.API();\r\n            }\r\n\r\n            if (data.signatures)\r\n                tripwire.parse(data, mode);\r\n\r\n            if (data.chain)\r\n                tripwire.chainMap.parse(data.chain);\r\n\r\n            if (data.comments)\r\n                tripwire.comments.parse(data.comments)\r\n\r\n            tripwire.active(data.activity);\r\n\r\n            if (data.notify && !$(\"#serverNotification\")[0]) Notify.trigger(data.notify, \"yellow\", false, \"serverNotification\");\r\n        }\r\n\r\n        tripwire.data = {tracking: {}, esi: {}};\r\n        successCallback ? successCallback(data) : null;\r\n    }).always(function(data, status) {\r\n        tripwire.timer = setTimeout(\"tripwire.refresh();\", tripwire.refreshRate);\r\n\r\n        alwaysCallback ? alwaysCallback(data) : null;\r\n\r\n        if (data.status == 403) {\r\n            window.location.href = \".\";\r\n        } else if (status != \"success\" && status != \"abort\" && tripwire.connected == true) {\r\n            tripwire.connected = false;\r\n            $(\"#ConnectionSuccess\").click();\r\n            Notify.trigger(\"Error syncing with server\", \"red\", false, \"connectionError\");\r\n        } else if (status == \"success\" && tripwire.connected == false) {\r\n            tripwire.connected = true;\r\n            $(\"#connectionError\").click();\r\n            Notify.trigger(\"Successfully reconnected with server\", \"green\", 5000, \"connectionSuccess\");\r\n        }\r\n    });\r\n\r\n    return true;\r\n}\r\ntripwire.sync(\"init\");\r\n","// Change the currently viewed system\r\ntripwire.systemChange = function(systemID, mode) {\r\n    if (mode != \"init\") {\r\n        $(\"#infoSecurity\").removeClass();\r\n        $(\"#infoStatics\").empty();\r\n\r\n        viewingSystem = tripwire.systems[systemID].name;\r\n        viewingSystemID = systemID;\r\n\r\n        // Reset activity\r\n        activity.refresh(true);\r\n\r\n        // Reset signatures\r\n        $(\"#sigTable span[data-age]\").countdown(\"destroy\");\r\n        $(\"#sigTable tbody\").empty();\r\n        $(\"#signature-count\").html(0);\r\n        tripwire.signatures.list = {};\r\n        tripwire.client.signatures = [];\r\n\r\n        // Reset chain map\r\n        chain.redraw();\r\n\r\n        // Reset comments\r\n        $(\"#notesWidget .content .comment:visible\").remove();\r\n        tripwire.comments.data = null;\r\n\r\n        // Change the URL & history\r\n        history.replaceState(null, null, \"?system=\"+viewingSystem);\r\n\r\n        tripwire.refresh(\"change\");\r\n    }\r\n\r\n    // Change the title\r\n    document.title = tripwire.systems[systemID].name + \" - \" + (server == \"static.eve-apps.com\" ? \"Tripwire\" : \"Galileo\");\r\n\r\n    $(\"#infoSystem\").text(tripwire.systems[systemID].name);\r\n\r\n    // Current system favorite\r\n    $.inArray(parseInt(viewingSystemID), options.favorites) != -1 ? $(\"#system-favorite\").attr(\"data-icon\", \"star\").addClass(\"active\") : $(\"#system-favorite\").attr(\"data-icon\", \"star-empty\").removeClass(\"active\");\r\n\r\n    if (tripwire.systems[systemID].class) {\r\n        // Security\r\n        $(\"#infoSecurity\").html(\"<span class='wh pointer'>Class \" + tripwire.systems[systemID].class + \"</span>\");\r\n\r\n        // Effects\r\n        if (tripwire.systems[systemID].effect) {\r\n            var tooltip = \"<table cellpadding=\\\"0\\\" cellspacing=\\\"1\\\">\";\r\n            for (var x in tripwire.effects[tripwire.systems[systemID].effect]) {\r\n                var effect = tripwire.effects[tripwire.systems[systemID].effect][x].name;\r\n                var base = tripwire.effects[tripwire.systems[systemID].effect][x].base;\r\n                var bad = tripwire.effects[tripwire.systems[systemID].effect][x].bad;\r\n                var whClass = tripwire.systems[systemID].class > 6 ? 6 : tripwire.systems[systemID].class;\r\n                var modifier = 0;\r\n\r\n                switch (Math.abs(base)) {\r\n                    case 15:\r\n                        modifier = base > 0 ? 7 : -7;\r\n                        break;\r\n                    case 30:\r\n                        modifier = base > 0 ? 14 : -14;\r\n                        break;\r\n                    case 60:\r\n                        modifier = base > 0 ? 28 : -28;\r\n                        break;\r\n                }\r\n\r\n                tooltip += \"<tr><td>\" + effect + \"</td><td style=\\\"padding-left: 25px; text-align: right;\\\" class=\\\"\" + (bad ? \"critical\" : \"stable\") + \"\\\">\";\r\n                tooltip += base + (modifier * (whClass -1)) + \"%</td></tr>\";\r\n            }\r\n            tooltip += \"</table>\";\r\n            $(\"#infoSecurity\").append(\"&nbsp;<span class='pointer' data-tooltip='\" + tooltip + \"'>\" + tripwire.systems[systemID].effect + \"</span>\");\r\n            Tooltips.attach($(\"#infoSecurity [data-tooltip]\"));\r\n        }\r\n\r\n        // Statics\r\n        for (var x in tripwire.systems[systemID].statics) {\r\n            var type = tripwire.systems[systemID].statics[x];\r\n            var wormhole = tripwire.wormholes[type];\r\n            var color = \"wh\";\r\n\r\n            switch (wormhole.leadsTo) {\r\n                case \"High-Sec\":\r\n                    color = \"hisec\";\r\n                    break;\r\n                case \"Low-Sec\":\r\n                    color = \"lowsec\";\r\n                    break;\r\n                case \"Null-Sec\":\r\n                    color = \"nullsec\";\r\n                    break;\r\n            }\r\n\r\n            $(\"#infoStatics\").append(\"<div><span class='\"+ color +\"'>&#9679;</span> <b>\"+ wormhole.leadsTo +\"</b> via <span class='\"+ color +\"'>\"+ type +\"</span></div>\");\r\n        }\r\n\r\n        // Faction\r\n        $(\"#infoFaction\").html(\"&nbsp;\");\r\n    } else {\r\n        // Security\r\n        if (tripwire.systems[systemID].security >= 0.45) {\r\n            $(\"#infoSecurity\").addClass(\"hisec\").text(\"High-Sec \" + tripwire.systems[systemID].security);\r\n        } else if (tripwire.systems[systemID].security > 0.0) {\r\n            $(\"#infoSecurity\").addClass(\"lowsec\").text(\"Low-Sec \" + tripwire.systems[systemID].security);\r\n        } else {\r\n            $(\"#infoSecurity\").addClass(\"nullsec\").text(\"Null-Sec \" + tripwire.systems[systemID].security);\r\n        }\r\n\r\n        // Faction\r\n        $(\"#infoFaction\").html(tripwire.systems[systemID].factionID ? tripwire.factions[tripwire.systems[systemID].factionID].name : \"&nbsp;\");\r\n    }\r\n\r\n    // Region\r\n    $(\"#infoRegion\").text(tripwire.regions[tripwire.systems[systemID].regionID].name);\r\n\r\n    // Info Links\r\n    $(\"#infoWidget .infoLink\").each(function() {\r\n        this.href = $(this).data(\"href\").replace(/\\$systemName/gi, tripwire.systems[systemID].name).replace(/\\$systemID/gi, systemID);\r\n    });\r\n\r\n    // Reset undo/redo\r\n    tripwire.signatures.undo[systemID] && tripwire.signatures.undo[systemID].length > 0 ? $(\"#undo\").removeClass(\"disabled\") : $(\"#undo\").addClass(\"disabled\");\r\n    tripwire.signatures.redo[systemID] && tripwire.signatures.redo[systemID].length > 0 ? $(\"#redo\").removeClass(\"disabled\") : $(\"#redo\").addClass(\"disabled\");\r\n}\r\ntripwire.systemChange(viewingSystemID, \"init\");\r\n","tripwire.undo = function() {\r\n    if (tripwire.signatures.undo[viewingSystemID].length > 0) {\r\n        $(\"#undo\").addClass(\"disabled\");\r\n        var lastIndex = tripwire.signatures.undo[viewingSystemID].length -1;\r\n        var data = {\"systemID\": viewingSystemID,\"request\": {\"signatures\": {\"add\": [], \"delete\": [], \"update\": []}}};\r\n\r\n        var undoItem = tripwire.signatures.undo[viewingSystemID][lastIndex];\r\n\r\n        switch(undoItem.action) {\r\n            case \"add\":\r\n                data.request.signatures.delete = data.request.signatures.delete.concat($.map(undoItem.signatures, function(signature) { return signature.id }));\r\n                break;\r\n            case \"delete\":\r\n                data.request.signatures.add = data.request.signatures.add.concat(undoItem.signatures);\r\n                break;\r\n            case \"update\":\r\n                data.request.signatures.update = data.request.signatures.update.concat(undoItem.signatures);\r\n                break;\r\n        }\r\n\r\n        var signatures = tripwire.client.signatures;\r\n\r\n        var success = function(data) {\r\n            if (data.result == true) {\r\n                tripwire.signatures.undo[viewingSystemID].pop();\r\n\r\n                $(\"#redo\").removeClass(\"disabled\");\r\n                if (viewingSystemID in tripwire.signatures.redo) {\r\n                    if (undoItem.action == \"update\") {\r\n                        tripwire.signatures.redo[viewingSystemID].push({\"action\": undoItem.action, \"signatures\": $.map(undoItem.signatures, function(signature) { return signatures[signature.id]; })});\r\n                    } else {\r\n                        tripwire.signatures.redo[viewingSystemID].push({\"action\": undoItem.action, \"signatures\": undoItem.signatures});\r\n                    }\r\n                } else {\r\n                    if (undoItem.action == \"update\") {\r\n                        tripwire.signatures.redo[viewingSystemID] = [{\"action\": undoItem.action, \"signatures\": $.map(undoItem.signatures, function(signature) { return signatures[signature.id]; })}];\r\n                    } else {\r\n                        tripwire.signatures.redo[viewingSystemID] = [{\"action\": undoItem.action, \"signatures\": undoItem.signatures}];\r\n                    }\r\n                }\r\n\r\n                sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n                sessionStorage.setItem(\"tripwire_redo\", JSON.stringify(tripwire.signatures.redo));\r\n            }\r\n        }\r\n\r\n        var always = function(data) {\r\n            if (tripwire.signatures.undo[viewingSystemID].length > 0) {\r\n                $(\"#undo\").removeClass(\"disabled\");\r\n            }\r\n        }\r\n\r\n        tripwire.refresh('refresh', data, success, always);\r\n    }\r\n}\r\n","var activity = new function() {\r\n\tthis.graph;\r\n\tthis.options;\r\n\tthis.view;\r\n\tthis.span = 24;\r\n\tthis.columns = [\r\n\t\t{id: \"time\", label: \"Time\", role: \"domain\", type: \"string\", calc: function(d, r) { return d.getValue(r, 0) + \"h\"; }},\r\n\t\t{id: \"jumps\", label: \"Jumps\", role: \"data\", type: \"number\", sourceColumn: 1, column: 1, title: \"Jumps\"},\r\n\t\t{id: \"podkills\", label: \"Pod Kills\", role: \"data\", type: \"number\", sourceColumn: 2, column: 2, title: \"Pod Kills\"},\r\n\t\t{id: \"shipkills\", label: \"Ship Kills\", role: \"data\", type: \"number\", sourceColumn: 3, column: 3, title: \"Ship Kills\"},\r\n\t\t{id: \"npckills\", label: \"NPC Kills\", role: \"data\", type: \"number\", sourceColumn: 4, column: 4, title: \"NPC Kills\"},\r\n\t\t//{id: \"annotationLabel\", label: \"Test\", role: \"annotation\", type: \"string\", sourceColumn: 5, title: \"Test\"},\r\n\t\t//{id: \"annotationText\", label: \"Test\", role: \"annotationText\", type: \"string\", sourceColumn: 6, title: \"Test\"}\r\n\t];\r\n\r\n\tthis.getData = function(span, cache) {\r\n\t\tvar span = typeof(span) !== \"undefined\" ? span : this.span;\r\n\t\tvar cache = typeof(cache) !== \"undefined\" ? cache : true;\r\n\r\n\t\tvar json = $.ajax({\r\n\t\t\t\t\turl: \"activity_graph.php\",\r\n\t\t\t\t\tdata: {systemID: viewingSystemID, time: span},\r\n\t\t\t\t\ttype: \"GET\",\r\n\t\t\t\t\tdataType: \"JSON\",\r\n\t\t\t\t\tasync: false,\r\n\t\t\t\t\tcache: cache\r\n\t\t\t\t}).responseJSON;\r\n\r\n\t\tjson.rows.reverse();\r\n\r\n\t\tthis.view = new google.visualization.DataView(new google.visualization.DataTable(json));\r\n\t\tthis.view.setColumns(this.columns);\r\n\t\treturn this.view;\r\n\t};\r\n\r\n\tthis.selectHandler = function() {\r\n\t\tvar selections = activity.graph.getSelection();\r\n\r\n\t\tif (selections[0] && selections[0].row == null) {\r\n\t\t\tvar c = selections[0].column;\r\n\r\n\t\t\tif (activity.columns[c].sourceColumn) {\r\n\t\t\t\t//activity.columns[c].calc = function() { return null };\r\n\t\t\t\tactivity.columns[c].label = activity.columns[c].title + \" (off)\";\r\n\t\t\t\tdelete activity.columns[c].sourceColumn;\r\n\t\t\t} else {\r\n\t\t\t\tactivity.columns[c].sourceColumn = activity.columns[c].column;\r\n\t\t\t\tactivity.columns[c].label = activity.columns[c].title;\r\n\t\t\t\t//delete activity.columns[c].calc;\r\n\t\t\t}\r\n\r\n\t\t\tactivity.view.setColumns(activity.columns);\r\n\t\t\tactivity.options.animation.duration = 0;\r\n\t\t\tactivity.graph.draw(activity.view, activity.options);\r\n\t\t\tactivity.options.animation.duration = 500;\r\n\t\t}\r\n\t}\r\n\r\n\tthis.init = function() {\r\n\t\tthis.graph = new google.visualization.AreaChart(document.getElementById(\"activityGraph\"));\r\n\t\tthis.options = {\r\n\t\t\tisStacked: false,\r\n\t\t\tbackgroundColor: \"transparent\",\r\n\t\t\thAxis: {textStyle: {color: \"#999\", fontName: \"Verdana\", fontSize: 10}, showTextEvery: 3},\r\n\t\t\tvAxis: {textStyle: {color: \"#666\", fontName: \"Verdana\", fontSize: 10}, viewWindowMode: \"maximized\", viewWindow: {min: 0}, maxValue: 5},\r\n\t\t\tgridlineColor: \"#454545\",\r\n\t\t\tpointSize: 2,\r\n\t\t\tlineWidth: 1,\r\n\t\t\tchartArea: {left: \"10%\", top: \"5%\", width: \"88%\", height: \"85%\"},\r\n\t\t\tlegend: {position: \"in\", textStyle: {color: \"#CCC\", fontName: \"Verdana\", fontSize: 8.5}},\r\n\t\t\tanimation: {duration: 500, easing: \"inAndout\"},\r\n\t\t\ttooltip: {showColorCode: true},\r\n\t\t\tannotations: {style: \"line\", textStyle: {fontSize: 12, color: \"#ccc\"}, domain: 0},\r\n\t\t\tfocusTarget: \"category\"\r\n\t\t}\r\n\r\n\t\tgoogle.visualization.events.addListener(this.graph, \"select\", this.selectHandler);\r\n\r\n\t\tthis.graph.draw(this.getData(this.span), this.options);\r\n\t}\r\n\r\n\tthis.time = function(span) {\r\n\t\tswitch(span) {\r\n\t\t\tcase 24:\r\n\t\t\t\tthis.options.hAxis.showTextEvery = 3;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 48:\r\n\t\t\t\tthis.options.hAxis.showTextEvery = 6;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 168:\r\n\t\t\t\tthis.options.hAxis.showTextEvery = 24;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tthis.span = span;\r\n\t\tthis.graph.draw(this.getData(span), this.options);\r\n\t}\r\n\r\n\tthis.redraw = function() {\r\n\t\tthis.graph.draw(this.view, this.options);\r\n\t}\r\n\r\n\tthis.refresh = function(cache) {\r\n\t\tthis.graph.draw(this.getData(this.span, cache), this.options);\r\n\t}\r\n\r\n\tgoogle.setOnLoadCallback(this.init());\r\n\t//this.init();\r\n}\r\n","var chain = new function() {\r\n\tthis.map, this.view, this.options, this.drawing, this.data = {};\r\n\r\n\tthis.newView = function(json) {\r\n\t\tthis.view = new google.visualization.DataView(new google.visualization.DataTable(json));\r\n\t\treturn this.view;\r\n\t};\r\n\r\n\tthis.activity = function(data) {\r\n\t\t/*\tfunction for adding recent activity to chain map nodes\t*/\r\n\t\t//var data = typeof(data) !== \"undefined\" ? data : this.data.activity;\r\n\r\n\t\t// Hide all activity colored dots instead of checking each one\r\n\t\t$(\"#chainMap .nodeActivity > span:not(.invisible)\").addClass(\"invisible\");\r\n\r\n\t\t// Loop through passed data and show dots by system\r\n\t\tfor (var x in data) {\r\n\t\t\tvar systemID = data[x].systemID;\r\n\t\t\tvar shipJumps = data[x].shipJumps;\r\n\t\t\tvar podKills = data[x].podKills;\r\n\t\t\tvar shipKills = data[x].shipKills;\r\n\t\t\tvar npcKills = data[x].npcKills;\r\n\t\t\tvar $node = $(\"#chainMap [data-nodeid=\"+systemID+\"] > .nodeActivity\");\r\n\r\n\t\t\tif (shipJumps > 0) {\r\n\t\t\t\t$node.find(\".jumps\").removeClass(\"invisible\").attr(\"title\", shipJumps+\" Jumps\");\r\n\t\t\t}\r\n\r\n\t\t\tif (podKills > 0) {\r\n\t\t\t\t$node.find(\".pods\").removeClass(\"invisible\").attr(\"title\", podKills+\" Pod Kills\");\r\n\t\t\t}\r\n\r\n\t\t\tif (shipKills > 0) {\r\n\t\t\t\t$node.find(\".ships\").removeClass(\"invisible\").attr(\"title\", shipKills+\" Ship Kills\");\r\n\t\t\t}\r\n\r\n\t\t\tif (npcKills > 0) {\r\n\t\t\t\t$node.find(\".npcs\").removeClass(\"invisible\").attr(\"title\", npcKills+\" NPC Kills\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t$(\"#chainMap .nodeActivity > span[title]\").jBox(\"Tooltip\", {position: {y: \"bottom\"}});\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tthis.occupied = function(data) {\r\n\t\t/*\tfunction for showing occupied icon  */\r\n\r\n\t\t// Hide all icons instead of checking each one\r\n\t\t$(\"#chainMap [data-icon='user'], #chainMap [data-icon='user'] + .badge\").addClass(\"invisible\");\r\n\r\n\t\t// Loop through passed data and show icons\r\n\t\tfor (var x in data) {\r\n\t\t\t$(\"#chainMap [data-nodeid='\"+data[x].systemID+\"'] [data-icon='user']\").removeClass(\"invisible\")\r\n\t\t\t$(\"#chainMap [data-nodeid='\"+data[x].systemID+\"'] [data-icon='user'] + .badge\").removeClass(\"invisible\").html(data[x].count);\r\n\t\t}\r\n\r\n\t\tOccupiedToolTips.attach($(\"#chainMap [data-icon='user']:not(.invisible)\"));\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tthis.flares = function(data) {\r\n\t\t/*\tfunction for coloring chain map nodes via flares  */\r\n\t\t//var data = typeof(data) !== \"undefined\" ? data : this.data.flares;\r\n\r\n\t\t// Remove all current node coloring instead of checking each one\r\n\t\t$(\"#chainMap td.node\").removeClass(\"redNode yellowNode greenNode\");\r\n\r\n\t\t// Remove all coloring from chain grid\r\n\t\t$(\"#chainGrid tr\").removeClass(\"red yellow green\");\r\n\r\n\t\t// Loop through passed data and add classes by system\r\n\t\tif (data) {\r\n\t\t\tfor (var x in data.flares) {\r\n\t\t\t\tvar systemID = data.flares[x].systemID;\r\n\t\t\t\tvar flare = data.flares[x].flare;\r\n\r\n\t\t\t\tvar row = ($(\"#chainMap [data-nodeid=\"+systemID+\"]\").parent().addClass(flare+\"Node\").parent().index() - 1) / 3 * 2;\r\n\r\n\t\t\t\tif (row > 0) {\r\n\t\t\t\t\t$(\"#chainGrid tr:eq(\"+row+\")\").addClass(flare).next().addClass(flare);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tthis.grid = function() {\r\n\t\t/*  function for showing/hiding grid lines  */\r\n\t\tif (options.chain.gridlines == false) { $(\"#chainGrid tr\").addClass(\"hidden\"); return false; }\r\n\r\n\t\t$(\"#chainGrid tr\").removeClass(\"hidden\");\r\n\t\t//$(\"#chainGrid\").css(\"width\", \"100%\");\r\n\r\n\t\tvar rows = $(\".google-visualization-orgchart-table tr:has(.node)\").length * 2 - 1;\r\n\r\n\t\t$(\"#chainGrid tr:gt(\"+rows+\")\").addClass(\"hidden\");\r\n\t}\r\n\r\n\tthis.lines = function(data) {\r\n\t\t//var data = typeof(data) !== \"undefined\" ? data : this.data.lines;\r\n\r\n\t\tfunction drawNodeLine(system, parent, mode, signatureID) {\r\n\t\t\t/*\tfunction for drawing colored lines  */\r\n\r\n\t\t\t// Find node in chainmap\r\n\t\t\t//var $node = $(\"#chainMap [data-nodeid='\"+system+\"']\").parent();\r\n\t\t\tvar $node = $(\"#chainMap #node\"+system).parent();\r\n\r\n\t\t\tif ($node.length == 0) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\t// Get node # in this line\r\n\t\t\tvar nodeIndex = Math.ceil(($node[0].cellIndex + 1) / 2 - 1);\r\n\r\n\t\t\t// applly to my top line\r\n\t\t\tvar $connector = $($node.parent().prev().children(\"td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright\")[nodeIndex]).addClass(\"left-\"+mode+\" right-\"+mode);\r\n\t\t\t//var $connector = $($node.parent().prev().find(\"td:not([colspan])\")[nodeIndex]).addClass(\"left-\"+mode+\" right-\"+mode).attr(\"data-signatureid\", signatureID);\r\n\r\n\t\t\t// Find parent node\r\n\t\t\t//var $parent = $(\"#chainMap [data-nodeid='\"+parent+\"']\").parent();\r\n\t\t\tvar $parent = $(\"#chainMap #node\"+parent).parent();\r\n\r\n\t\t\tif ($parent.length == 0 || $connector.length == 0)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t// Find the col of my top line\r\n\t\t\tvar nodeCol = 0, connectorCell = $connector[0].cellIndex;\r\n\t\t\t$node.parent().prev().find(\"td\").each(function(index) {\r\n\t\t\t\tnodeCol += this.colSpan;\r\n\r\n\t\t\t\tif (index == connectorCell) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Get node # in this line\r\n\t\t\tvar parentIndex = Math.ceil(($parent[0].cellIndex + 1) / 2 - 1);\r\n\r\n\t\t\t// Compensate for non-parent nodes (slight performance hit ~10ms)\r\n\t\t\tvar newparentIndex = parentIndex;\r\n\t\t\tfor (var i = 0; i <= parentIndex; i++) {\r\n\t\t\t\tvar checkSystem = 0;//$node.parent().prev().prev().prev().find(\"td:has([data-nodeid]):eq(\"+i+\")\").find(\"[data-nodeid]\").data(\"nodeid\");\r\n\t\t\t\t$node.parent().prev().prev().prev().find(\"td > [data-nodeid]\").each(function(index) {\r\n\t\t\t\t\tif (index == i) {\r\n\t\t\t\t\t\tcheckSystem = $(this).attr(\"id\").replace(\"node\", \"\");//$(this).data(\"nodeid\");\r\n\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif ($.map(data.map.rows, function(node) { return node.c[1].v == checkSystem ? node : null; }).length <= 0) {\r\n\t\t\t\t\tnewparentIndex--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tparentIndex = newparentIndex;\r\n\r\n\t\t\t// Apply to parent bottom line\r\n\t\t\tvar $connecte = $($node.parent().prev().prev().children(\"td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright\")[parentIndex]).addClass(\"left-\"+mode+\" right-\"+mode);\r\n\t\t\t//var $connecte = $($node.parent().prev().prev().find(\"td:not([colspan])\")[parentIndex]).addClass(\"left-\"+mode+\" right-\"+mode).attr(\"data-signatureid\", signatureID);\r\n\r\n\t\t\t// the beans\r\n\t\t\tvar col = 0, parent = false, me = false;\r\n\t\t\t$node.parent().prev().prev().find(\"td\").each(function(index, value) {\r\n\t\t\t\tcol += this.colSpan;\r\n\r\n\t\t\t\tif (me && parent) {\r\n\t\t\t\t\t// All done - get outta here\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else if (typeof($connecte[0]) != \"undefined\" && $connecte[0].cellIndex == index) {\r\n\t\t\t\t\tparent = true;\r\n\r\n\t\t\t\t\t$(this).addClass(\"left-\"+mode);\r\n\r\n\t\t\t\t\t// remove bottom border that points to the right\r\n\t\t\t\t\tif (!me && col != nodeCol) {\r\n\t\t\t\t\t\t$(this).addClass(\"bottom-\"+mode);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// parent and node are same - we are done\r\n\t\t\t\t\tif (nodeCol == col) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (col == nodeCol) {\r\n\t\t\t\t\tme = true;\r\n\r\n\t\t\t\t\t$(this).addClass(\"bottom-\"+mode);\r\n\t\t\t\t} else if (me || parent) {\r\n\t\t\t\t\tvar tempCol = 0, breaker = false, skip = false;\r\n\r\n\t\t\t\t\t$node.parent().prev().find(\"td\").each(function(index) {\r\n\t\t\t\t\t\ttempCol += this.colSpan;\r\n\r\n\t\t\t\t\t\tif (tempCol == col && ($(this).hasClass(\"google-visualization-orgchart-lineleft\") || $(this).hasClass(\"google-visualization-orgchart-lineright\"))) {\r\n\t\t\t\t\t\t\tif (parent == false) {\r\n\t\t\t\t\t\t\t\t// Stop looking cuz there is another node between us and parent\r\n\t\t\t\t\t\t\t\tbreaker = true;\r\n\t\t\t\t\t\t\t\t$connecte.removeClass(\"left-\"+mode+\" right-\"+mode);\r\n\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t} else if (parent == true) {\r\n\t\t\t\t\t\t\t\t// Lets make sure there isnt a node between the parent and me\r\n\t\t\t\t\t\t\t\t$connecte.removeClass(\"left-\"+mode+\" right-\"+mode);\r\n\r\n\t\t\t\t\t\t\t\t$node.parent().prev().prev().find(\"td\").each(function(index) {\r\n\t\t\t\t\t\t\t\t\tif (index >= $connecte[0].cellIndex) {\r\n\t\t\t\t\t\t\t\t\t\t// there is a node after parent but before me\r\n\t\t\t\t\t\t\t\t\t\t$(this).removeClass(\"bottom-\"+mode);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tskip = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (breaker) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!skip) {\r\n\t\t\t\t\t\t$(this).addClass(\"bottom-\"+mode);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfor (var x in data.lines) {\r\n\t\t\tdrawNodeLine(data.lines[x][0], data.lines[x][1], data.lines[x][2], data.lines[x][3]);\r\n\t\t}\r\n\t}\r\n\r\n\tthis.nodes = function(map) {\r\n\t\tvar chain = {cols: [{label: \"System\", type: \"string\"}, {label: \"Parent\", type: \"string\"}], rows: []};\r\n\t\tvar frigTypes = [\"Q003\", \"E004\", \"L005\", \"Z006\", \"M001\", \"C008\", \"G008\", \"A009\"];\r\n\t\tvar connections = [];\r\n\r\n\t\tfunction topLevel(systemID, id) {\r\n\t\t\tif (!systemID || !tripwire.systems[systemID])\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t// System type switch\r\n\t\t\tvar systemType;\r\n\t\t\tif (tripwire.systems[systemID].class)\r\n\t\t\t\tsystemType = \"<span class='wh'>C\" + tripwire.systems[systemID].class + \"</span>\";\r\n\t\t\telse if (tripwire.systems[systemID].security >= 0.45)\r\n\t\t\t\tsystemType = \"<span class='hisec'>HS</span>\";\r\n\t\t\telse if (tripwire.systems[systemID].security > 0.0)\r\n\t\t\t\tsystemType = \"<span class='lowsec'>LS</span>\";\r\n\t\t\telse if (tripwire.systems[systemID].security <= 0.0)\r\n\t\t\t\tsystemType = \"<span class='nullsec'>NS</span>\";\r\n\r\n\t\t\tvar effectClass = null, effect = null;\r\n\t\t\tif (tripwire.systems[systemID].class) {\r\n\t\t\t\tswitch(tripwire.systems[systemID].effect) {\r\n\t\t\t\t\tcase \"Black Hole\":\r\n\t\t\t\t\t\teffectClass = \"blackhole\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Cataclysmic Variable\":\r\n\t\t\t\t\t\teffectClass = \"cataclysmic-variable\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Magnetar\":\r\n\t\t\t\t\t\teffectClass = \"magnetar\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Pulsar\":\r\n\t\t\t\t\t\teffectClass = \"pulsar\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Red Giant\":\r\n\t\t\t\t\t\teffectClass = \"red-giant\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Wolf-Rayet Star\":\r\n\t\t\t\t\t\teffectClass = \"wolf-rayet\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\teffect = tripwire.systems[systemID].effect;\r\n\t\t\t}\r\n\r\n\t\t\tvar system = {v: id};\r\n\t\t\tvar chainNode = \"<div id='node\"+id+\"' data-nodeid='\"+systemID+\"'>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='nodeIcons'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<div style='float: left;'>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<i class='whEffect' \"+(effectClass ? \"data-icon='\"+effectClass+\"' data-tooltip='\"+effect+\"'\" : null)+\"></i>\"\r\n\t\t\t\t\t\t\t+\t\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\t\"<div style='float: right;'>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<i data-icon='user' class='invisible'></i>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<span class='badge' class='invisible'></span>\"\r\n\t\t\t\t\t\t\t+\t\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeClass'>\"+systemType+\"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeSystem'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<a href='.?system=\"+tripwire.systems[systemID].name+\"'>\"+(options.chain.tabs[options.chain.active] && options.chain.tabs[options.chain.active].systemID != 0 ? options.chain.tabs[options.chain.active].name : tripwire.systems[systemID].name)+\"</a>\"\r\n\t\t\t\t\t\t\t+\t\"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeType'>&nbsp;</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='nodeActivity'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span>\"\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\"</div>\"\r\n\r\n\t\t\tsystem.f = chainNode;\r\n\r\n\t\t\treturn system;\r\n\t\t}\r\n\r\n\t\tfunction findLinks(system) {\r\n\t\t\tif (system[0] <= 0) return false;\r\n\r\n\t\t\tvar parentID = parseInt(system[1]), childID = chainList.length;\r\n\r\n\t\t\tfor (var x in chainData) {\r\n\t\t\t\tvar link = chainData[x];\r\n\r\n\t\t\t\tif ($.inArray(link.id, usedLinks) == -1) {\r\n\t\t\t\t\tif (link.systemID == system[0]) {\r\n\t\t\t\t\t\tvar node = {};\r\n\t\t\t\t\t\tnode.id = link.id;\r\n\t\t\t\t\t\tnode.life = link.life;\r\n\t\t\t\t\t\tnode.mass = link.mass;\r\n\t\t\t\t\t\tnode.time = link.time;\r\n\r\n\t\t\t\t\t\tnode.parent = {};\r\n\t\t\t\t\t\tnode.parent.id = parentID;\r\n\t\t\t\t\t\tnode.parent.systemID = link.systemID;\r\n\t\t\t\t\t\tnode.parent.name = link.system;\r\n\t\t\t\t\t\tnode.parent.type = link.sig2Type;\r\n\t\t\t\t\t\tnode.parent.typeBM = link.type2BM;\r\n\t\t\t\t\t\tnode.parent.classBM = link.class2BM;\r\n\t\t\t\t\t\tnode.parent.nth = link.nth2;\r\n\t\t\t\t\t\tnode.parent.signatureID = link.sig2ID;\r\n\r\n\t\t\t\t\t\tnode.child = {};\r\n\t\t\t\t\t\tnode.child.id = ++childID;\r\n\t\t\t\t\t\tnode.child.systemID = link.connectionID;\r\n\t\t\t\t\t\tnode.child.name = link.connection;\r\n\t\t\t\t\t\tnode.child.type = link.type;\r\n\t\t\t\t\t\tnode.child.typeBM = link.typeBM;\r\n\t\t\t\t\t\tnode.child.classBM = link.classBM;\r\n\t\t\t\t\t\tnode.child.nth = link.nth;\r\n\t\t\t\t\t\tnode.child.signatureID = link.signatureID;\r\n\r\n\t\t\t\t\t\tchainLinks.push(node);\r\n\t\t\t\t\t\tchainList.push([node.child.systemID, node.child.id, system[2]]);\r\n\t\t\t\t\t\tusedLinks.push(node.id);\r\n\t\t\t\t\t\t//usedLinks[system[2]].push(node.id);\r\n\r\n\t\t\t\t\t\tif ($(\"#show-viewing\").hasClass(\"active\") && tripwire.systems[node.child.systemID] && !tripwire.systems[viewingSystemID].class && !tripwire.systems[node.child.systemID].class) {\r\n\t\t\t\t\t\t\tvar jumps = guidance.findShortestPath(tripwire.map.shortest, [viewingSystemID - 30000000, node.child.systemID - 30000000]).length - 1;\r\n\r\n\t\t\t\t\t\t\tvar calcNode = {};\r\n\t\t\t\t\t\t\tcalcNode.life = \"Gate\";\r\n\t\t\t\t\t\t\tcalcNode.parent = {};\r\n\t\t\t\t\t\t\tcalcNode.parent.id = node.child.id;\r\n\t\t\t\t\t\t\tcalcNode.parent.systemID = node.child.systemID;\r\n\t\t\t\t\t\t\tcalcNode.parent.name = node.child.name;\r\n\t\t\t\t\t\t\tcalcNode.parent.type = node.child.type;\r\n\t\t\t\t\t\t\tcalcNode.parent.nth = node.child.nth;\r\n\r\n\t\t\t\t\t\t\tcalcNode.child = {};\r\n\t\t\t\t\t\t\tcalcNode.child.id = ++childID;\r\n\t\t\t\t\t\t\tcalcNode.child.systemID = viewingSystemID\r\n\t\t\t\t\t\t\tcalcNode.child.name = tripwire.systems[viewingSystemID].name;\r\n\t\t\t\t\t\t\tcalcNode.child.type = jumps;\r\n\t\t\t\t\t\t\tcalcNode.child.nth = null;\r\n\t\t\t\t\t\t\tcalcNode.child.signatureID = jumps;\r\n\r\n\t\t\t\t\t\t\tchainLinks.push(calcNode);\r\n\t\t\t\t\t\t\tchainList.push([0, childID]);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ($(\"#show-favorite\").hasClass(\"active\") && tripwire.systems[node.child.systemID]) {\r\n\t\t\t\t\t\t\tfor (x in options.favorites) {\r\n\t\t\t\t\t\t\t\tif (tripwire.systems[options.favorites[x]].regionID >= 11000000 || tripwire.systems[node.child.systemID].regionID >= 11000000)\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t\t\t\tvar jumps = guidance.findShortestPath(tripwire.map.shortest, [options.favorites[x] - 30000000, node.child.systemID - 30000000]).length - 1;\r\n\r\n\t\t\t\t\t\t\t\tvar calcNode = {};\r\n\t\t\t\t\t\t\t\tcalcNode.life = \"Gate\";\r\n\t\t\t\t\t\t\t\tcalcNode.parent = {};\r\n\t\t\t\t\t\t\t\tcalcNode.parent.id = node.child.id;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.systemID = node.child.systemID;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.name = node.child.name;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.type = node.child.type;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.nth = node.child.nth;\r\n\r\n\t\t\t\t\t\t\t\tcalcNode.child = {};\r\n\t\t\t\t\t\t\t\tcalcNode.child.id = ++childID;\r\n\t\t\t\t\t\t\t\tcalcNode.child.systemID = options.favorites[x];\r\n\t\t\t\t\t\t\t\tcalcNode.child.name = tripwire.systems[options.favorites[x]].name;\r\n\t\t\t\t\t\t\t\tcalcNode.child.type = jumps;\r\n\t\t\t\t\t\t\t\tcalcNode.child.nth = null;\r\n\t\t\t\t\t\t\t\tcalcNode.child.signatureID = jumps;\r\n\r\n\t\t\t\t\t\t\t\tchainLinks.push(calcNode);\r\n\t\t\t\t\t\t\t\tchainList.push([0, childID]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (link.connectionID == system[0]) {\r\n\t\t\t\t\t\tvar node = {};\r\n\t\t\t\t\t\tnode.id = link.id;\r\n\t\t\t\t\t\tnode.life = link.life;\r\n\t\t\t\t\t\tnode.mass = link.mass;\r\n\t\t\t\t\t\tnode.time = link.time;\r\n\r\n\t\t\t\t\t\tnode.parent = {};\r\n\t\t\t\t\t\tnode.parent.id = parentID;\r\n\t\t\t\t\t\tnode.parent.systemID = link.connectionID;\r\n\t\t\t\t\t\tnode.parent.name = link.connection;\r\n\t\t\t\t\t\tnode.parent.type = link.type;\r\n\t\t\t\t\t\tnode.parent.typeBM = link.typeBM;\r\n\t\t\t\t\t\tnode.parent.classBM = link.classBM;\r\n\t\t\t\t\t\tnode.parent.nth = link.nth;\r\n\t\t\t\t\t\tnode.parent.signatureID = link.signatureID;\r\n\r\n\t\t\t\t\t\tnode.child = {};\r\n\t\t\t\t\t\tnode.child.id = ++childID;\r\n\t\t\t\t\t\tnode.child.systemID = link.systemID;\r\n\t\t\t\t\t\tnode.child.name = link.system;\r\n\t\t\t\t\t\tnode.child.type = link.sig2Type;\r\n\t\t\t\t\t\tnode.child.typeBM = link.type2BM;\r\n\t\t\t\t\t\tnode.child.classBM = link.class2BM;\r\n\t\t\t\t\t\tnode.child.nth = link.nth2;\r\n\t\t\t\t\t\tnode.child.signatureID = link.sig2ID;\r\n\r\n\t\t\t\t\t\tchainLinks.push(node);\r\n\t\t\t\t\t\tchainList.push([node.child.systemID, node.child.id, system[2]]);\r\n\t\t\t\t\t\tusedLinks.push(node.id);\r\n\t\t\t\t\t\t//usedLinks[system[2]].push(node.id);\r\n\r\n\t\t\t\t\t\tif ($(\"#show-viewing\").hasClass(\"active\") && tripwire.systems[node.child.systemID] && !tripwire.systems[viewingSystemID].class && !tripwire.systems[node.child.systemID].class) {\r\n\t\t\t\t\t\t\tvar jumps = guidance.findShortestPath(tripwire.map.shortest, [viewingSystemID - 30000000, node.child.systemID - 30000000]).length - 1;\r\n\r\n\t\t\t\t\t\t\tvar calcNode = {};\r\n\t\t\t\t\t\t\tcalcNode.life = \"Gate\";\r\n\t\t\t\t\t\t\tcalcNode.parent = {};\r\n\t\t\t\t\t\t\tcalcNode.parent.id = node.child.id;\r\n\t\t\t\t\t\t\tcalcNode.parent.systemID = node.child.systemID;\r\n\t\t\t\t\t\t\tcalcNode.parent.name = node.child.name;\r\n\t\t\t\t\t\t\tcalcNode.parent.type = node.child.type;\r\n\t\t\t\t\t\t\tcalcNode.parent.nth = node.child.nth;\r\n\r\n\t\t\t\t\t\t\tcalcNode.child = {};\r\n\t\t\t\t\t\t\tcalcNode.child.id = ++childID;\r\n\t\t\t\t\t\t\tcalcNode.child.systemID = viewingSystemID;\r\n\t\t\t\t\t\t\tcalcNode.child.name = tripwire.systems[viewingSystemID].name;\r\n\t\t\t\t\t\t\tcalcNode.child.type = jumps;\r\n\t\t\t\t\t\t\tcalcNode.child.nth = null;\r\n\t\t\t\t\t\t\tcalcNode.child.signatureID = jumps;\r\n\r\n\t\t\t\t\t\t\tchainLinks.push(calcNode);\r\n\t\t\t\t\t\t\tchainList.push([0, childID]);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ($(\"#show-favorite\").hasClass(\"active\") && tripwire.systems[node.child.systemID]) {\r\n\t\t\t\t\t\t\tfor (x in options.favorites) {\r\n\t\t\t\t\t\t\t\tif (tripwire.systems[options.favorites[x]].regionID >= 11000000 || tripwire.systems[node.child.systemID].regionID >= 11000000)\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t\t\t\tvar jumps = guidance.findShortestPath(tripwire.map.shortest, [options.favorites[x] - 30000000, node.child.systemID - 30000000]).length - 1;\r\n\r\n\t\t\t\t\t\t\t\tvar calcNode = {};\r\n\t\t\t\t\t\t\t\tcalcNode.life = \"Gate\";\r\n\t\t\t\t\t\t\t\tcalcNode.parent = {};\r\n\t\t\t\t\t\t\t\tcalcNode.parent.id = node.child.id;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.systemID = node.child.systemID;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.name = node.child.name;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.type = node.child.type;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.nth = node.child.nth;\r\n\r\n\t\t\t\t\t\t\t\tcalcNode.child = {};\r\n\t\t\t\t\t\t\t\tcalcNode.child.id = ++childID;\r\n\t\t\t\t\t\t\t\tcalcNode.child.systemID = options.favorites[x];\r\n\t\t\t\t\t\t\t\tcalcNode.child.name = tripwire.systems[options.favorites[x]].name;\r\n\t\t\t\t\t\t\t\tcalcNode.child.type = jumps;\r\n\t\t\t\t\t\t\t\tcalcNode.child.nth = null;\r\n\t\t\t\t\t\t\t\tcalcNode.child.signatureID = jumps;\r\n\r\n\t\t\t\t\t\t\t\tchainLinks.push(calcNode);\r\n\t\t\t\t\t\t\t\tchainList.push([0, childID]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (false && $(\"#home\").hasClass(\"active\")) {\r\n\t\t\t$(\"#chainError\").hide();\r\n\r\n\t\t\tvar row = {c: []};\r\n\t\t\tvar systemID = $.map(tripwire.systems, function(system, id) { return system.name == options.chain.home ? id : null; })[0];\r\n\r\n\t\t\trow.c.push(topLevel(systemID, 1), {v: null});\r\n\r\n\t\t\tchain.rows.push(row);\r\n\r\n\t\t\tvar chainList = [[systemID, 1]];\r\n\t\t\tvar chainData = map;\r\n\t\t\tvar chainLinks = [];\r\n\t\t\tvar usedLinks = [];\r\n\r\n\t\t\tfor (var i = 0; i < chainList.length; ++i) {\r\n\t\t\t\tfindLinks(chainList[i]);\r\n\t\t\t}\r\n\t\t} else if (false && $(\"#k-space\").hasClass(\"active\")) {\r\n\t\t\t$(\"#chainError\").hide();\r\n\r\n\t\t\tvar chainList = [];//$.map(tripwire.systems, function(system, id) { return system.class ? null : [id, 1]; });\r\n\t\t\tvar kspace = $.map(tripwire.systems, function(system, id) { return system.class ? null : id; });\r\n\t\t\tvar chainData = map;\r\n\t\t\tvar chainLinks = [];\r\n\t\t\tvar usedLinks = [];\r\n\r\n\t\t\tvar i = 0;\r\n\t\t\tfor (var x in map) {\r\n\t\t\t\tif ($.inArray(map[x].systemID, kspace) != -1) {\r\n\t\t\t\t\ti++;\r\n\t\t\t\t\tchain.rows.push({c: [topLevel(map[x].systemID, i), {v: null}]});\r\n\t\t\t\t\tchainList.push([map[x].systemID, i]);\r\n\t\t\t\t} else if ($.inArray(map[x].connectionID, kspace) != -1) {\r\n\t\t\t\t\ti++;\r\n\t\t\t\t\tchain.rows.push({c: [topLevel(map[x].connectionID, i), {v: null}]});\r\n\t\t\t\t\tchainList.push([map[x].connectionID, i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0; i < chainList.length; ++i) {\r\n\t\t\t\tfindLinks(chainList[i]);\r\n\t\t\t}\r\n\t\t} else if (false && $(\"#eve-scout\").hasClass(\"active\")) {\r\n\t\t\t$(\"#chainError\").hide();\r\n\r\n\t\t\tvar row = {c: []};\r\n\t\t\tvar systemID = 31000005;\r\n\r\n\t\t\trow.c.push(topLevel(systemID, 1), {v: null});\r\n\r\n\t\t\tchain.rows.push(row);\r\n\r\n\t\t\tvar chainList = [[systemID, 1]];\r\n\t\t\tvar chainData = map;\r\n\t\t\tvar chainLinks = [];\r\n\t\t\tvar usedLinks = [];\r\n\r\n\t\t\tfor (var i = 0; i < chainList.length; ++i) {\r\n\t\t\t\tfindLinks(chainList[i]);\r\n\t\t\t}\r\n\t\t} else if ($(\"#chainTabs .current\").length > 0) {\r\n\t\t\tvar systems = $(\"#chainTabs .current .name\").data(\"tab\").toString().split(\",\");\r\n\t\t\tvar chainList = [];\r\n\t\t\tvar chainData = map;\r\n\t\t\tvar chainLinks = [];\r\n\t\t\tvar usedLinks = [];\r\n\r\n\t\t\tif (systems == 0) {\r\n\t\t\t\tvar i = 0;\r\n\t\t\t\tfor (var x in map) {\r\n\t\t\t\t\tif (typeof(tripwire.systems[map[x].systemID].class) == \"undefined\") {\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t//usedLinks[map[x].systemID] = [];\r\n\t\t\t\t\t\tchain.rows.push({c: [topLevel(map[x].systemID, i), {v: null}]});\r\n\t\t\t\t\t\tchainList.push([map[x].systemID, i, map[x].systemID]);\r\n\t\t\t\t\t} else if (tripwire.systems[map[x].connectionID] && typeof(tripwire.systems[map[x].connectionID].class) == \"undefined\") {\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t//usedLinks[map[x].connectionID] = [];\r\n\t\t\t\t\t\tchain.rows.push({c: [topLevel(map[x].connectionID, i), {v: null}]});\r\n\t\t\t\t\t\tchainList.push([map[x].connectionID, i, map[x].connectionID]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor (var x in systems) {\r\n\t\t\t\t\t//usedLinks[systems[x]] = [];\r\n\t\t\t\t\tchain.rows.push({c: [topLevel(systems[x], parseInt(x) + 1), {v: null}]});\r\n\t\t\t\t\tchainList.push([systems[x], parseInt(x) + 1, systems[x]]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//var startTime = window.performance.now();\r\n\t\t\tfor (var i = 0; i < chainList.length; i++) {\r\n\t\t\t\tfindLinks(chainList[i]);\r\n\t\t\t}\r\n\t\t\t//console.log(\"stint: \"+ (window.performance.now() - startTime));\r\n\t\t} else {\r\n\t\t\t$(\"#chainError\").hide();\r\n\r\n\t\t\tvar row = {c: []};\r\n\t\t\tvar systemID = viewingSystemID;\r\n\r\n\t\t\trow.c.push(topLevel(systemID, 1), {v: null});\r\n\r\n\t\t\tchain.rows.push(row);\r\n\r\n\t\t\tvar chainList = [[systemID, 1]];\r\n\t\t\tvar chainData = map;\r\n\t\t\tvar chainLinks = [];\r\n\t\t\tvar usedLinks = [];\r\n\r\n\t\t\tfor (var i = 0; i < chainList.length; ++i) {\r\n\t\t\t\tfindLinks(chainList[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var x in chainLinks) {\r\n\t\t\tvar node = chainLinks[x];\r\n\t\t\tvar row = {c: []};\r\n\r\n\t\t\t// System type switch\r\n\t\t\tvar systemType;\r\n\t\t\tvar nodeClass = tripwire.systems[node.child.systemID] ? tripwire.systems[node.child.systemID].class : null;\r\n\t\t\tvar nodeSecurity = tripwire.systems[node.child.systemID] ? tripwire.systems[node.child.systemID].security : null;\r\n\t\t\tif (nodeClass == 6 || node.child.name == \"Class-6\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Class 6\"))\r\n\t\t\t\tsystemType = \"<span class='wh'>C6</span>\";\r\n\t\t\telse if (nodeClass == 5 || node.child.name == \"Class-5\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Class 5\"))\r\n\t\t\t\tsystemType = \"<span class='wh'>C5</span>\";\r\n\t\t\telse if (nodeClass == 4 || node.child.name == \"Class-4\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Class 4\"))\r\n\t\t\t\tsystemType = \"<span class='wh'>C4</span>\";\r\n\t\t\telse if (nodeClass == 3 || node.child.name == \"Class-3\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Class 3\"))\r\n\t\t\t\tsystemType = \"<span class='wh'>C3</span>\";\r\n\t\t\telse if (nodeClass == 2 || node.child.name == \"Class-2\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Class 2\"))\r\n\t\t\t\tsystemType = \"<span class='wh'>C2</span>\";\r\n\t\t\telse if (nodeClass == 1 || node.child.name == \"Class-1\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Class 1\"))\r\n\t\t\t\tsystemType = \"<span class='wh'>C1</span>\";\r\n\t\t\telse if (nodeClass > 6)\r\n\t\t\t\tsystemType = \"<span class='wh'>C\" + nodeClass + \"</span>\";\r\n\t\t\telse if (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo.split(\" \").length > 1)\r\n\t\t\t\tsystemType = \"<span class='wh'>C\" + tripwire.wormholes[node.child.type].leadsTo.split(\" \")[1] + \"</span>\";\r\n\t\t\telse if (nodeSecurity >= 0.45 || node.child.name == \"High-Sec\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"High-Sec\" && !nodeSecurity))\r\n\t\t\t\tsystemType = \"<span class='hisec'>HS</span>\";\r\n\t\t\telse if (nodeSecurity > 0.0 || node.child.name == \"Low-Sec\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Low-Sec\" && !nodeSecurity))\r\n\t\t\t\tsystemType = \"<span class='lowsec'>LS</span>\";\r\n\t\t\telse if ((nodeSecurity <= 0.0 && nodeSecurity != null) || node.child.name == \"Null-Sec\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Null-Sec\"))\r\n\t\t\t\tsystemType = \"<span class='nullsec'>NS</span>\";\r\n\t\t\telse\r\n\t\t\t\tsystemType = \"<span>&nbsp;</span>\";\r\n\r\n\t\t\tvar effectClass = null, effect = null;\r\n\t\t\tif (typeof(tripwire.systems[node.child.systemID]) != \"undefined\") {\r\n\t\t\t\tswitch(tripwire.systems[node.child.systemID].effect) {\r\n\t\t\t\t\tcase \"Black Hole\":\r\n\t\t\t\t\t\teffectClass = \"blackhole\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Cataclysmic Variable\":\r\n\t\t\t\t\t\teffectClass = \"cataclysmic-variable\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Magnetar\":\r\n\t\t\t\t\t\teffectClass = \"magnetar\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Pulsar\":\r\n\t\t\t\t\t\teffectClass = \"pulsar\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Red Giant\":\r\n\t\t\t\t\t\teffectClass = \"red-giant\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Wolf-Rayet Star\":\r\n\t\t\t\t\t\teffectClass = \"wolf-rayet\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\teffectClass = null;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\teffect = tripwire.systems[node.child.systemID].effect;\r\n\t\t\t}\r\n\r\n\t\t\tvar child = {v: node.child.id};\r\n\t\t\tvar chainNode = \"<div id='node\"+node.child.id+\"' data-nodeid='\"+node.child.systemID+\"' data-sigid='\"+node.id+\"'>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='nodeIcons'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<div style='float: left;'>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<i class='whEffect' \"+(effectClass ? \"data-icon='\"+effectClass+\"' data-tooltip='\"+effect+\"'\" : null)+\"></i>\"\r\n\t\t\t\t\t\t\t+\t\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\t\"<div style='float: right;'>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<i data-icon='user' class='invisible'></i>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<span class='badge' class='invisible'></span>\"\r\n\t\t\t\t\t\t\t+\t\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeClass'>\"+(systemType + sigFormat(node.child.classBM, \"class\"))+\"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeSystem'>\"\r\n\t\t\t\t\t\t\t+ \t(tripwire.systems[node.child.systemID] ? \"<a href='.?system=\"+tripwire.systems[node.child.systemID].name+\"'>\"+(node.child.name ? node.child.name : tripwire.systems[node.child.systemID].name)+\"</a>\" : \"<a class='invisible'>system</a>\")\r\n\t\t\t\t\t\t\t+\t\"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeType'>\"+(options.chain[\"node-reference\"] == \"id\" ? node.child.signatureID : node.child.type + sigFormat(node.child.typeBM, \"type\") || \"&nbsp;\")+\"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='nodeActivity'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span>\"\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\"</div>\"\r\n\r\n\t\t\tchild.f = chainNode;\r\n\r\n\t\t\tvar parent = {v: node.parent.id};\r\n\r\n\t\t\trow.c.push(child, parent);\r\n\t\t\tchain.rows.push(row);\r\n\r\n\t\t\tif (node.life == \"Critical\" && ($.inArray(node.parent.type, frigTypes) != -1 || $.inArray(node.child.type, frigTypes) != -1))\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"eol-frig\", node.id));\r\n\t\t\telse if (node.life == \"Critical\" && node.mass == \"Critical\")\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"eol-critical\", node.id));\r\n\t\t\telse if (node.life == \"Critical\" && node.mass == \"Destab\")\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"eol-destab\", node.id));\r\n\t\t\telse if ($.inArray(node.parent.type, frigTypes) != -1 || $.inArray(node.child.type, frigTypes) != -1)\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"frig\", node.id));\r\n\t\t\telse if (node.life == \"Critical\")\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"eol\", node.id));\r\n\t\t\telse if (node.mass == \"Critical\")\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"critical\", node.id));\r\n\t\t\telse if (node.mass == \"Destab\")\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"destab\", node.id));\r\n\t\t\telse if (node.life == \"Gate\" || node.parent.type == \"GATE\" || node.child.type == \"GATE\")\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"gate\", node.id));\r\n\t\t\t//else\r\n\t\t\t//\tconnections.push(Array(child.v, parent.v, \"\", node.id));\r\n\t\t}\r\n\r\n\t\t// Apply critical/destab line colors\r\n\t\tconnections.reverse(); // so we apply to outer systems first\r\n\r\n\t\t//this.data.map = chain;\r\n\t\t//this.data.lines = connections;\r\n\t\treturn {\"map\": chain, \"lines\": connections};\r\n\t}\r\n\r\n\tthis.redraw = function() {\r\n\t\tvar data = $.extend(true, {}, this.data);\r\n\t\tdata.map = $.extend(true, {}, data.rawMap);\r\n\r\n\t\tthis.draw(data);\r\n\t}\r\n\r\n\tthis.draw = function(data) {\r\n\t\tvar data = typeof(data) !== \"undefined\" ? data : {};\r\n\t\t//var startTime = window.performance.now();\r\n\r\n\t\tif (data.map) {\r\n\t\t\tthis.drawing = true;\r\n\r\n\t\t\tthis.data.rawMap = $.extend(true, {}, data.map);\r\n\r\n\t\t\tif (options.chain.active == null || (options.chain.tabs[options.chain.active] && options.chain.tabs[options.chain.active].evescout == false)) {\r\n\t\t\t\tif (options.masks.active != \"273.0\") {\r\n\t\t\t\t\tfor (var i in data.map) {\r\n\t\t\t\t\t\tif (data.map[i].mask == \"273.0\") {\r\n\t\t\t\t\t\t\tdelete data.map[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Sort so we keep the chain map order the same\r\n\t\t\tObject.sort(data.map, \"id\");\r\n\r\n\t\t\t$.extend(data, this.nodes(data.map)); // 250ms -> <100ms\r\n\t\t\t$.extend(this.data, data);\r\n\t\t\tthis.map.draw(this.newView(data.map), this.options); // 150ms\r\n\r\n\t\t\tif (options.chain.tabs[options.chain.active]) {\r\n\t\t\t\tfor (var x in options.chain.tabs[options.chain.active].collapsed) {\r\n\t\t\t\t\tvar node = $(\"#chainMap [data-nodeid='\"+options.chain.tabs[options.chain.active].collapsed[x]+\"']\").attr(\"id\");\r\n\r\n\t\t\t\t\tif (node) {\r\n\t\t\t\t\t\tnode = node.split(\"node\")[1];\r\n\t\t\t\t\t\tthis.map.collapse(node - 1, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.lines(data); // 300ms\r\n\t\t\tthis.grid(); // 4ms\r\n\r\n\t\t\t// Apply current system style\r\n\t\t\t$(\"#chainMap [data-nodeid='\"+viewingSystemID+\"']\").parent().addClass(\"currentNode\"); // 1ms\r\n\r\n\t\t\tWormholeTypeToolTips.attach($(\"#chainMap .whEffect\")); // 30ms\r\n\t\t\tthis.drawing = false;\r\n\t\t}\r\n\r\n\t\tif (data.activity) // 100ms\r\n\t\t\tthis.data.activity = this.activity(data.activity);\r\n\r\n\t\tif (data.occupied) // 3ms\r\n\t\t\tthis.data.occupied = this.occupied(data.occupied);\r\n\r\n\t\tif (data.flares) // 20ms\r\n\t\t\tthis.data.flares = this.flares(data.flares);\r\n\r\n\t\tif (data.last_modified)\r\n\t\t\tthis.data.last_modified = data.last_modified;\r\n\r\n\t\t//console.log(\"stint: \"+ (window.performance.now() - startTime));\r\n\t}\r\n\r\n\tthis.collapse = function(c) {\r\n\t\tif (chain.drawing) return false;\r\n\r\n\t\tvar collapsed = chain.map.getCollapsedNodes();\r\n\t\toptions.chain.tabs[options.chain.active].collapsed = [];\r\n\t\tfor (x in collapsed) {\r\n\t\t\tvar systemID = $(\"#chainMap #node\"+(collapsed[x] +1)).data(\"nodeid\");\r\n\t\t\toptions.chain.tabs[options.chain.active].collapsed.push(systemID);\r\n\t\t}\r\n\r\n\t\tchain.lines(chain.data);\r\n\r\n\t\t// Apply current system style\r\n\t\t$(\"#chainMap [data-nodeid='\"+viewingSystemID+\"']\").parent().addClass(\"currentNode\");\r\n\r\n\t\tWormholeTypeToolTips.attach($(\"#chainMap .whEffect\"));\r\n\r\n\t\tchain.activity(chain.data.activity);\r\n\r\n\t\tchain.occupied(chain.data.occupied);\r\n\r\n\t\tchain.flares(chain.data.flares);\r\n\r\n\t\tchain.grid();\r\n\r\n\t\toptions.save();\r\n\t}\r\n\r\n\tthis.init = function() {\r\n\t\tthis.map = new google.visualization.OrgChart(document.getElementById(\"chainMap\"));\r\n\t\tthis.options = {allowHtml: true, allowCollapse: true, size: \"medium\", nodeClass: \"node\"};\r\n\r\n\t\tgoogle.visualization.events.addListener(this.map, \"collapse\", this.collapse);\r\n\r\n\t\tthis.map.draw(new google.visualization.DataView(new google.visualization.DataTable({cols:[{label: \"System\", type: \"string\"}, {label: \"Parent\", type: \"string\"}]})), this.options);\r\n\t}\r\n\r\n\t//google.setOnLoadCallback(this.init());\r\n\tthis.init();\r\n}\r\n","var CKConfig = {\r\n\tskin: \"custom\",\r\n\theight: 100,\r\n\tallowedContent: true,\r\n\textraPlugins: \"toolbarswitch,autogrow,autolink\",\r\n\tenterMode: CKEDITOR.ENTER_BR,\r\n\tremoveDialogTabs: 'link:advanced',\r\n\tautoGrow_onStartup: true,\r\n\tautoGrow_minHeight: 100,\r\n\ttoolbar_minToolbar: [\r\n\t\t{name: \"basicstyles\", items: [\"Bold\", \"Italic\", \"Underline\", \"Strike\"]},\r\n\t\t{name: \"paragraph\", items: [\"BulletedList\", \"Outdent\", \"Indent\"]},\r\n\t\t{name: \"links\", items: [\"Link\"]},\r\n\t\t{name: \"colors\", items: [\"TextColor\", \"BGColor\"]},\r\n\t\t{name: \"styles\", items: [\"FontSize\"]},\r\n\t\t{name: \"tools\", items: [\"Toolbarswitch\"]}\r\n\t],\r\n\ttoolbar_maxToolbar: [\r\n\t\t{name: \"basicstyles\", items: [\"Bold\", \"Italic\", \"Underline\", \"Strike\", \"Subscript\", \"Superscript\"]},\r\n\t\t{name: \"paragraph\", items: [\"NumberedList\", \"BulletedList\", \"Outdent\", \"Indent\"]},\r\n\t\t{name: \"links\", items: [\"Link\"]},\r\n\t\t{name: \"colors\", items: [\"TextColor\", \"BGColor\"]},\r\n\t\t{name: \"styles\", items: [\"FontSize\", \"Font\"]},\r\n\t\t{name: \"tools\", items: [\"Source\", \"Toolbarswitch\"]}\r\n\t],\r\n\ttoolbar: \"minToolbar\",\r\n\tsmallToolbar: \"minToolbar\",\r\n\tmaximizedToolbar: \"maxToolbar\",\r\n\tfontSize_style: {\r\n\t    element:        'span',\r\n\t    styles:         { 'font-size': '#(size)' },\r\n\t    overrides:      [ { element :'font', attributes: { 'size': null } } ]\r\n\t}\r\n}\r\n\r\nCKEDITOR.on(\"instanceLoaded\", function(cke) {\r\n\tcke.editor.on(\"contentDom\", function() {\r\n\t\tcke.editor.on(\"key\", function(e) {\r\n\t\t\tif (e.data.keyCode == 27) {\r\n\t\t\t\t// escape key cancels\r\n\t\t\t\t$(cke.editor.element.$).closest(\".comment\").find(\".commentCancel\").click();\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (e.data.domEvent.$.altKey && e.data.domEvent.$.keyCode == 83) {\r\n\t\t\t\t// alt+s saves\r\n\t\t\t\t$(cke.editor.element.$).closest(\".comment\").find(\".commentSave\").click();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\t$(\".cke_combo__font a\")\r\n\t\t.removeClass(\"cke_combo_button\")\r\n\t\t.addClass(\"cke_button cke_button_off\")\r\n\t\t.html('<span class=\"cke_button_icon\">&nbsp;</span>')\r\n\r\n\t$(\".cke_combo__fontsize a\")\r\n\t\t.removeClass(\"cke_combo_button\")\r\n\t\t.addClass(\"cke_button cke_button_off\")\r\n\t\t.html('<span class=\"cke_button_icon\">&nbsp;</span>')\r\n});\r\n\r\nCKEDITOR.on(\"instanceReady\", function(cke) {\r\n\t// ensure focus on init\r\n\tcke.editor.focus();\r\n\r\n\tvar s = cke.editor.getSelection(); // getting selection\r\n\tvar selected_ranges = s.getRanges(); // getting ranges\r\n\tvar node = selected_ranges[0].startContainer; // selecting the starting node\r\n\tvar parents = node.getParents(true);\r\n\r\n\tnode = parents[parents.length - 2].getFirst();\r\n\r\n\tif (!node) return false;\r\n\r\n\twhile (true) {\r\n\t\tvar x = node.getNext();\r\n\t\tif (x == null) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tnode = x;\r\n\t}\r\n\r\n\ts.selectElement(node);\r\n\tselected_ranges = s.getRanges();\r\n\tselected_ranges[0].collapse(false);  //  false collapses the range to the end of the selected node, true before the node.\r\n\ts.selectRanges(selected_ranges);  // putting the current selection there\r\n});\r\n\r\nCKEDITOR.on(\"dialogDefinition\", function(ev) {\r\n\tif (ev.data.name == 'link') {\r\n\t\tev.data.definition.getContents('target').get('linkTargetType')['default'] = '_blank';\r\n\t}\r\n});\r\n","if (window.location.href.indexOf(\"galileo\") != -1) {\r\n\tNotify.trigger(\"This is the test version of Tripwire.<br/>Please use <a href='https://tripwire.cloud-things.com'>Tripwire</a>\")\r\n}\r\n\r\n$(\"body\").on(\"click\", \"a[href^='.?system=']\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tvar system = $(this).attr(\"href\").replace(\".?system=\", \"\");\r\n\tvar systemID = Object.index(tripwire.systems, \"name\", system);\r\n\r\n\ttripwire.systemChange(systemID);\r\n});\r\n\r\n$(\"body\").on(\"submit\", \"#systemSearch\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tvar system = $(this).find(\"[name='system']\").val();\r\n\tvar systemID = Object.index(tripwire.systems, \"name\", system) || false;\r\n\r\n\tif (systemID !== false) {\r\n\t\ttripwire.systemChange(systemID);\r\n\t\t$(this).find(\"[name='system']\").val(\"\");\r\n\t\t$(\"#search\").click();\r\n\t}\r\n});\r\n\r\n$(\"body\").on(\"click\", \"#undo:not(.disabled)\", function() {\r\n\ttripwire.undo();\r\n});\r\n\r\n$(\"body\").on(\"click\", \"#redo:not(.disabled)\", function() {\r\n\ttripwire.redo();\r\n});\r\n\r\n$(document).keydown(function(e)\t{\r\n\tif ((e.metaKey || e.ctrlKey) && (e.keyCode == 89 || e.keyCode == 90)) {\r\n\t\t//Abort - user is in input or textarea\r\n\t\tif ($(document.activeElement).is(\"textarea, input\")) return;\r\n\r\n\t\te.preventDefault();\r\n\r\n\t\tif (e.keyCode == 89 && !$(\"#redo\").hasClass(\"disabled\")) {\r\n\t\t\t$(\"#redo\").click();\r\n\t\t\tNotify.trigger(\"Redoing last undo\");\r\n\t\t} else if (e.keyCode == 90 && !$(\"#undo\").hasClass(\"disabled\")) {\r\n\t\t\t$(\"#undo\").click();\r\n\t\t\tNotify.trigger(\"Undoing last action\");\r\n\t\t}\r\n\t}\r\n});\r\n\r\n$(\"#APIclock\").knob({angleArc: 359.9, height: 20, width: 20, max: 60, readOnly: true, displayInput: false, fgColor: \"#CCC\", bgColor: \"#666\"});\r\n\r\n$(\"#follow\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\toptions.buttons.follow = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n})\r\n\r\n$(\"#show-viewing\").click(function() {\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\tchain.redraw();\r\n\r\n\toptions.buttons.chainWidget.viewing = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n});\r\n\r\n$(\"#show-favorite\").click(function() {\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\tchain.redraw();\r\n\r\n\toptions.buttons.chainWidget.favorites = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n});\r\n\r\n$(\"#system-favorite\").click(function() {\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\").attr(\"data-icon\", \"star-empty\");\r\n\r\n\t\toptions.favorites.splice(options.favorites.indexOf(parseInt(viewingSystemID)), 1);\r\n\t} else {\r\n\t\t$(this).attr(\"data-icon\", \"star\").addClass(\"active\");\r\n\r\n\t\toptions.favorites.push(parseInt(viewingSystemID));\r\n\t}\r\n\r\n\tif ($(\"#show-favorite\").hasClass(\"active\"))\r\n\t\tchain.redraw();\r\n\r\n\toptions.save();\r\n});\r\n\r\n$(\"#search\").click(function(e) {\r\n\t$(\"#searchSpan\").toggle();\r\n\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\");\r\n\t\tif (tripwire.client.EVE && tripwire.client.EVE.systemName)\r\n\t\t\t$(\"#currentSpan\").show();\r\n\t} else {\r\n\t\t$(this).addClass(\"active\");\r\n\t\t$(\"#currentSpan\").hide();\r\n\r\n\t\t$(\"#searchSpan input[name=system]\").focus().select();\r\n\t}\r\n});\r\n\r\n$(\"#toggle-automapper\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\toptions.buttons.signaturesWidget.autoMapper = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n});\r\n\r\n$(\"#track\").on(\"click\", \".tracking-clone\", function() {\r\n\tvar characterID =$(this).attr(\"data-characterid\");\r\n\t$(\"#tracking .tracking-clone\").removeClass(\"active\");\r\n\r\n\tif (options.tracking.active == characterID) {\r\n\t\toptions.tracking.active = null;\r\n\t\ttripwire.EVE(false, true);\r\n\t\t$(\"#removeESI\").attr(\"disabled\", \"disabled\");\r\n\t} else {\r\n\t\toptions.tracking.active = characterID;\r\n\r\n\t\tif (tripwire.esi.characters[options.tracking.active]) {\r\n\t\t\t$(\"#tracking .tracking-clone[data-characterid='\"+ options.tracking.active +\"']\").addClass(\"active\");\r\n\t\t\ttripwire.EVE(tripwire.esi.characters[options.tracking.active], true);\r\n\t\t}\r\n\r\n\t\t$(\"#removeESI\").removeAttr(\"disabled\");\r\n\t}\r\n\r\n\toptions.save();\r\n});\r\n\r\n$(\"#login\").on(\"click\", \"#removeESI\", function() {\r\n\tvar characterID = options.tracking.active;\r\n\r\n\toptions.tracking.active = null;\r\n\ttripwire.EVE(false, true);\r\n\toptions.save();\r\n\r\n\t$(\"#tracking .tracking-clone[data-characterid='\"+ characterID +\"']\").remove();\r\n\r\n\t$(\"#removeESI\").attr(\"disabled\", \"disabled\");\r\n\ttripwire.data.esi.delete = characterID;\r\n});\r\n\r\n$(\"#user\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\");\r\n\r\n\t\t$(\"#login > #panel\").css({display: \"none\"});\r\n\r\n\t\t//$(\"#wrapper\").unbind(\"click\");\r\n\t} else {\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\t\t$(\"#login > #panel\").css({display: \"inline\"});\r\n\t\t$(\"#loginForm input[name=username]\").focus().select();\r\n\r\n\t\t// Click outside closes\r\n\t\t$(\"#wrapper\").click(function(e) {\r\n\t\t\t$(\"#login > #panel\").css({display: \"none\"});\r\n\t\t\t$(\"#user\").removeClass(\"active\");\r\n\t\t});\r\n\r\n\t\t$(\"#login\").click(function(e) {\r\n\t\t\te.stopPropagation();\r\n\t\t})\r\n\t}\r\n});\r\n\r\n$(\"#logout\").click(function() {\r\n\twindow.location = \"logout.php\";\r\n});\r\n\r\nvar Notify = new function() {\r\n\r\n\tthis.trigger = function(content, color, stick, id) {\r\n\t\tvar color = typeof(color) !== \"undefined\" ? color : \"blue\";\r\n\t\tvar stick = typeof(stick) !== \"undefined\" ? stick : 10000;\r\n\t\tvar id = typeof(id) !== \"undefined\" ? id : null;\r\n\r\n\t\tnew jBox(\"Notice\", {\r\n\t\t\tid: id,\r\n\t\t\tcontent: content,\r\n\t\t\toffset: {y: 35},\r\n\t\t\tanimation: \"flip\",\r\n\t\t\tcolor: color,\r\n\t\t\tautoClose: stick\r\n\t\t});\r\n\t}\r\n}\r\n\r\n// Init valdiation tooltips\r\nvar ValidationTooltips = new jBox(\"Tooltip\", {\r\n\ttrigger: null,\r\n\taddClass: \"validation-tooltip\",\r\n\tanimation: \"flip\",\r\n\tfade: 0\r\n});\r\n\r\nvar Tooltips = new jBox(\"Tooltip\", {\r\n\tattach: $(\"[data-tooltip]\"),\r\n\tgetContent: \"data-tooltip\",\r\n\tposition: {x: \"right\", y: \"center\"},\r\n\toutside: \"x\"\r\n});\r\n\r\nvar WormholeTypeToolTips = new jBox(\"Tooltip\", {\r\n\tattach: $(\".whEffect[data-tooltip]\"),\r\n\tgetContent: \"data-tooltip\",\r\n\tposition: {x: \"left\", y: \"center\"},\r\n\toutside: \"x\"\r\n});\r\n\r\nvar OccupiedToolTips = new jBox(\"Tooltip\", {\r\n\tpointer: \"top:-3\",\r\n\tposition: {x: \"right\", y: \"center\"},\r\n\toutside: \"x\",\r\n\tanimation: \"move\",\r\n\trepositionOnOpen: true,\r\n\tonOpen: function() {\r\n\t\tvar tooltip = this;\r\n\t\tvar systemID = $(this.source).closest(\"[data-nodeid]\").data(\"nodeid\");\r\n\r\n\t\ttooltip.setContent(\"&nbsp;\");\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: \"occupants.php\",\r\n\t\t\tdataType: \"JSON\",\r\n\t\t\tdata: \"systemID=\"+systemID,\r\n\t\t\tcache: false\r\n\t\t}).done(function(data) {\r\n\t\t\tvar chars = \"<table>\";\r\n\r\n\t\t\tfor (var x in data.occupants) {\r\n\t\t\t\tchars += \"<tr><td>\"+data.occupants[x].characterName+\"</td><td style='padding-left: 10px;'>\"+(data.occupants[x].shipTypeName?data.occupants[x].shipTypeName:\"\")+\"</td></tr>\";\r\n\t\t\t}\r\n\r\n\t\t\tchars += \"</table>\";\r\n\t\t\ttooltip.setContent(chars);\r\n\t\t});\r\n\t}\r\n});\r\n\r\n$(\"#chainTabs\").sortable({\r\n\titems: \"> .tab\",\r\n\taxis: \"x\",\r\n\tdelay: 150,\r\n\ttolerance: \"pointer\",\r\n\tcontainment: \"parent\",\r\n\tupdate: function(e, ui) {\r\n\t\tvar result = $(\"#chainTabs\").sortable(\"toArray\");\r\n\t\tvar newTabs = [];\r\n\r\n\t\tfor (var x in result) {\r\n\t\t\tnewTabs.push(options.chain.tabs[result[x]]);\r\n\t\t\t$(\"#chainTabs .tab:eq(\"+x+\")\").attr(\"id\", x);\r\n\t\t}\r\n\r\n\t\toptions.chain.active = $(\".tab.current\").index();\r\n\t\toptions.chain.tabs = newTabs;\r\n\t\toptions.save();\r\n\t}\r\n});\r\n\r\n$(\"#chainTabs\").on(\"click\", \".tab\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"current\")) {\r\n\t\t$(\"#chainTabs .tab\").removeClass(\"current\");\r\n\t\toptions.chain.active = null;\r\n\t} else {\r\n\t\t$(\"#chainTabs .tab\").removeClass(\"current\");\r\n\t\t$(this).addClass(\"current\");\r\n\t\toptions.chain.active = $(this).index();\r\n\t}\r\n\r\n\toptions.save();\r\n\tchain.redraw();\r\n\ttripwire.parse(tripwire.client, \"refresh\");\r\n});\r\n\r\n$(\"#chainTabs\").on(\"click\", \".closeTab\", function(e) {\r\n\te.stopPropagation();\r\n\tvar $tab = $(this).closest(\".tab\");\r\n\r\n\t$(\"#dialog-confirm #msg\").html(\"This tab will be removed, are you sure?\");\r\n\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\tbuttons: {\r\n\t\t\t\"Remove Tab\": function() {\r\n\t\t\t\tvar i = $tab.index();\r\n\r\n\t\t\t\toptions.chain.active = $(\".tab.current\").index();\r\n\t\t\t\toptions.chain.tabs.splice(i, 1);\r\n\t\t\t\toptions.save();\r\n\r\n\t\t\t\t$tab.remove();\r\n\t\t\t\tif ($(\"#chainTabs .tab.current\").length == 0) {\r\n\t\t\t\t\t$(\"#chainTabs .tab:last\").click();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var x = 0, l = $(\"#chainTabs .tab\").length; x < l; x++) {\r\n\t\t\t\t\t$(\"#chainTabs .tab:eq(\"+x+\")\").attr(\"id\", x);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t},\r\n\t\t\tCancel: function() {\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t}\r\n\t\t}\r\n\t}).dialog(\"open\");\r\n});\r\n\r\n$(\"#newTab\").on(\"click\", function() {\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-newTab\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-newTab\").dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tOK: function() {\r\n\t\t\t\t\t$(\"#newTab_form\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$(\"#dialog-newTab #name\").val(viewingSystem).focus();\r\n\t\t\t\t$(\"#dialog-newTab #system\").val(viewingSystem);\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tValidationTooltips.close();\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t$(\"#dialog-newTab .sigSystemsAutocomplete\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0});\r\n\r\n\t\t\t\t$(\"#newTab_form\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar $tab = $(\"#chainTab .tab\").clone();\r\n\t\t\t\t\tvar name = $(\"#dialog-newTab #name\").val();\r\n\t\t\t\t\tvar systemID = Object.index(tripwire.systems, \"name\", $(\"#dialog-newTab #system\").val());\r\n\t\t\t\t\tvar thera = $(\"#tabThera\")[0].checked ? true : false;\r\n\r\n\t\t\t\t\tif (!name) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-newTab #name\")}).setContent(\"Must have a name!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if (!systemID && $(\"#tabType1\")[0].checked) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-newTab #system\")}).setContent(\"Must have a valid system!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if ($(\"#tabType2\")[0].checked) {\r\n\t\t\t\t\t\tsystemID = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$tab.attr(\"id\", $(\"#chainTabs .tab\").length).find(\".name\").data(\"tab\", systemID).html(name);\r\n\t\t\t\t\toptions.chain.tabs.push({systemID: systemID, name: name, evescout: thera});\r\n\t\t\t\t\toptions.save();\r\n\r\n\t\t\t\t\t$(\"#chainTabs\").append($tab);\r\n\r\n\t\t\t\t\t$(\"#dialog-newTab\").dialog(\"close\");\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-newTab #system\").click(function(e) {\r\n\t\t\t\t\t$(\"#dialog-newTab #tabType1\").click();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-newTab\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-newTab\").dialog(\"open\");\r\n\t}\r\n});\r\n\r\n$(\"#chainTabs\").on(\"click\", \".editTab\", function(e) {\r\n\te.stopPropagation();\r\n\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-editTab\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-editTab\").dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tOK: function() {\r\n\t\t\t\t\t$(\"#editTab_form\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$(\"#dialog-editTab #name\").val(options.chain.tabs[options.chain.active].name).focus();\r\n\t\t\t\t$(\"#dialog-editTab #system\").val(options.chain.tabs[options.chain.active].systemID > 0 ? tripwire.systems[options.chain.tabs[options.chain.active].systemID].name : \"\");\r\n\t\t\t\toptions.chain.tabs[options.chain.active].systemID > 0 ? $(\"#dialog-editTab #editTabType1\")[0].checked = true : $(\"#dialog-editTab #editTabType2\")[0].checked = true;\r\n\t\t\t\t$(\"#dialog-editTab #editTabThera\")[0].checked = options.chain.tabs[options.chain.active].evescout;\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tValidationTooltips.close();\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t$(\"#dialog-editTab .sigSystemsAutocomplete\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0});\r\n\r\n\t\t\t\t$(\"#editTab_form\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar $tab = $(\"#chainTabs .tab\").eq([options.chain.active]);\r\n\t\t\t\t\tvar name = $(\"#dialog-editTab #name\").val();\r\n\t\t\t\t\tvar systemID = Object.index(tripwire.systems, \"name\", $(\"#dialog-editTab #system\").val());\r\n\t\t\t\t\tvar thera = $(\"#editTabThera\")[0].checked ? true : false;\r\n\r\n\t\t\t\t\tif (!name) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-editTab #name\")}).setContent(\"Must have a name!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if (!systemID && $(\"#editTabType1\")[0].checked) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-editTab #system\")}).setContent(\"Must have a valid system!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if ($(\"#editTabType2\")[0].checked) {\r\n\t\t\t\t\t\tsystemID = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$tab.attr(\"id\", $(\"#chainTabs .tab\").length).find(\".name\").data(\"tab\", systemID).html(name);\r\n\t\t\t\t\toptions.chain.tabs[options.chain.active] = {systemID: systemID, name: name, evescout: thera};\r\n\t\t\t\t\toptions.save();\r\n\t\t\t\t\tchain.redraw();\r\n\r\n\t\t\t\t\ttripwire.parse(tripwire.client, \"refresh\");\r\n\r\n\t\t\t\t\t//$(\"#chainTabs\").append($tab);\r\n\r\n\t\t\t\t\t$(\"#dialog-editTab\").dialog(\"close\");\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-editTab #system\").click(function(e) {\r\n\t\t\t\t\t$(\"#dialog-editTab #editTabType1\").click();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-editTab\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-editTab\").dialog(\"open\");\r\n\t}\r\n});\r\n\r\n// Signature column context menu\r\n$(\"#signaturesWidget #sigTable thead\").contextmenu({\r\n\tdelegate: \"th.sortable\",\r\n\tmenu: \"#signatureColumnMenu\",\r\n\tselect: function(e, ui) {\r\n\t\tvar col = $(ui.target).parent().parent().children().index($(ui.target).parent()) + 1;\r\n\r\n\t\tswitch(col) {\r\n\t\t\tcase 1:\r\n\t\t\t\tcolName = \"sigID\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tcolName = \"sigType\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tcolName = \"sigAge\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tcolName = \"leadsTo\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tcolName = \"sigLife\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tcolName = \"sigMass\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tswitch(ui.cmd) {\r\n\t\t\tcase \"leftAlign\":\r\n\t\t\t\t$(\"#signaturesWidget #sigTable tbody td:nth-child(\"+ col +\")\").removeClass(\"centerAlign rightAlign\").addClass(\"leftAlign\");\r\n\t\t\t\toptions.signatures.alignment[colName] = \"leftAlign\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"centerAlign\":\r\n\t\t\t\t$(\"#signaturesWidget #sigTable tbody td:nth-child(\"+ col +\")\").removeClass(\"leftAlign rightAlign\").addClass(\"centerAlign\");\r\n\t\t\t\toptions.signatures.alignment[colName] = \"centerAlign\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"rightAlign\":\r\n\t\t\t\t$(\"#signaturesWidget #sigTable tbody td:nth-child(\"+ col +\")\").removeClass(\"centerAlign leftAlign\").addClass(\"rightAlign\");\r\n\t\t\t\toptions.signatures.alignment[colName] = \"rightAlign\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\toptions.save();\r\n\t},\r\n\tbeforeOpen: function(e, ui) {\r\n\t\tvar col = $(ui.target).parent().parent().children().index($(ui.target).parent()) + 1;\r\n\r\n\t\tswitch(col) {\r\n\t\t\tcase 1:\r\n\t\t\t\tcolName = \"sigID\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tcolName = \"sigType\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tcolName = \"sigAge\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tcolName = \"leadsTo\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tcolName = \"sigLife\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tcolName = \"sigMass\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t$(this).contextmenu(\"enableEntry\", \"leftAlign\", true);\r\n\t\t$(this).contextmenu(\"enableEntry\", \"centerAlign\", true);\r\n\t\t$(this).contextmenu(\"enableEntry\", \"rightAlign\", true);\r\n\r\n\t\t$(this).contextmenu(\"enableEntry\", options.signatures.alignment[colName], false);\r\n\t}\r\n});\r\n\r\n// Chain Map Context Menu\r\n$(\"#chainMap\").contextmenu({\r\n\tdelegate: \".node a\",\r\n\tuiMenuOptions: {position: {my: \"left top-1\", at: \"right top\"}},\r\n\tmenu: \"#chainMenu\",\r\n\tshow: {effect: \"slideDown\", duration: 150},\r\n\tselect: function(e, ui) {\r\n\t\tvar id = $(ui.target[0]).closest(\"[data-nodeid]\").data(\"nodeid\");\r\n\t\tvar row = $(ui.target[0]).closest(\"[data-nodeid]\").attr(\"id\").replace(\"node\", \"\") -1;\r\n\r\n\t\tswitch(ui.cmd) {\r\n\t\t\tcase \"showInfo\":\r\n\t\t\t\ttripwire.esi.showInfo(id, options.tracking.active);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"setDest\":\r\n\t\t\t\ttripwire.esi.setDestination(id, options.tracking.active);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"addWay\":\r\n\t\t\t\ttripwire.esi.setDestination(id, options.tracking.active, false);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"showMap\":\r\n\t\t\t\t// CCPEVE.showMap(id);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"red\":\r\n\t\t\t\t$(ui.target[0]).closest(\"td\").hasClass(\"redNode\") ? $(this).contextmenu(\"removeFlare\", id, ui) : $(this).contextmenu(\"setFlare\", id, ui.cmd, ui);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"yellow\":\r\n\t\t\t\t$(ui.target[0]).closest(\"td\").hasClass(\"yellowNode\") ? $(this).contextmenu(\"removeFlare\", id, ui) : $(this).contextmenu(\"setFlare\", id, ui.cmd, ui);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"green\":\r\n\t\t\t\t$(ui.target[0]).closest(\"td\").hasClass(\"greenNode\") ? $(this).contextmenu(\"removeFlare\", id, ui) : $(this).contextmenu(\"setFlare\", id, ui.cmd, ui);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"mass\":\r\n\t\t\t\t$(\"#dialog-mass\").data(\"id\", $(ui.target[0]).closest(\"[data-nodeid]\").data(\"sigid\")).data(\"systemID\", $(ui.target[0]).closest(\"[data-nodeid]\").data(\"nodeid\")).dialog(\"open\");\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"rename\":\r\n\t\t\t\t$(\"#dialog-rename\").data(\"id\", $(ui.target[0]).closest(\"[data-nodeid]\").data(\"sigid\")).data(\"systemID\", $(ui.target[0]).closest(\"[data-nodeid]\").data(\"nodeid\")).dialog(\"open\");\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"collapse\":\r\n\t\t\t\tvar toggle = options.chain.tabs[options.chain.active] ? ($.inArray(id, options.chain.tabs[options.chain.active].collapsed) == -1 ? true : false) : true;\r\n\t\t\t\tchain.map.collapse(row, toggle);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\tbeforeOpen: function(e, ui) {\r\n\t\tvar sigID = $(ui.target[0]).closest(\"[data-nodeid]\").data(\"sigid\") || null;\r\n\t\tvar id = $(ui.target[0]).closest(\"[data-nodeid]\").data(\"nodeid\");\r\n\r\n\t\t// Add check for k-space\r\n\t\tif (tripwire.systems[id].class || !tripwire.esi.characters[options.tracking.active]) {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"setDest\", false);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"addWay\", false);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"showMap\", false);\r\n\t\t} else {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"setDest\", true);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"addWay\", true);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"showMap\", false);\r\n\t\t}\r\n\r\n\t\tif (sigID) {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"rename\", true);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"mass\", true);\r\n\t\t} else {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"rename\", false);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"mass\", false);\r\n\t\t}\r\n\t},\r\n\tcreate: function(e, ui) {\r\n\t\t$(\"#dialog-mass\").dialog({\r\n\t\t\tautoOpen: false,\r\n\t\t\twidth: \"auto\",\r\n\t\t\theight: \"auto\",\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tClose: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\tvar sigID = $(this).data(\"id\");\r\n\t\t\t\tvar systemID = $(this).data(\"systemID\");\r\n\t\t\t\tvar sig = Object.find(chain.data.rawMap, \"id\", sigID);\r\n\r\n\t\t\t\t$(\"#dialog-mass\").dialog(\"option\", \"title\", \"From \"+(sig.systemID == systemID ? tripwire.systems[sig.connectionID].name : tripwire.systems[sig.systemID].name)+\" to \"+tripwire.systems[systemID].name);\r\n\r\n\t\t\t\t$(\"#dialog-mass #massTable tbody tr\").remove();\r\n\r\n\t\t\t\tvar data = {signatureID: sigID};\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: \"mass.php\",\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\tdata: data,\r\n\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t}).done(function(data) {\r\n\t\t\t\t\tif (data && data.mass) {\r\n                        var totalMass = 0;\r\n\t\t\t\t\t\tfor (x in data.mass) {\r\n                            totalMass += parseFloat(data.mass[x].mass);\r\n\t\t\t\t\t\t\t$(\"#dialog-mass #massTable tbody\").append(\"<tr><td>\"+data.mass[x].characterName+\"</td><td>\"+(data.mass[x].toID == systemID ? \"In\" : \"Out\")+\"</td><td>\"+data.mass[x].shipType+\"</td><td>\"+numFormat(data.mass[x].mass)+\"Kg</td><td>\"+data.mass[x].time+\"</td></tr>\");\r\n\t\t\t\t\t\t}\r\n                        $(\"#dialog-mass #massTable tbody\").append(\"<tr><td></td><td></td><td></td><th>\"+ numFormat(totalMass) +\"Kg</th><td></td></tr>\");\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$(\"#dialog-rename\").dialog({\r\n\t\t\tautoOpen: false,\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tSave: function() {\r\n\t\t\t\t\t$(\"#rename_form\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\tvar sigID = $(this).data(\"id\");\r\n\t\t\t\tvar systemID = $(this).data(\"systemID\");\r\n\t\t\t\tvar sig = Object.find(tripwire.client.chain.map, \"id\", sigID);\r\n\r\n\t\t\t\t$(this).find(\"#name\").val(sig.systemID == systemID ? sig.system : sig.connection);\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t$(\"#rename_form\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar sigID = $(\"#dialog-rename\").data(\"id\");\r\n\t\t\t\t\tvar systemID = $(\"#dialog-rename\").data(\"systemID\");\r\n\t\t\t\t\tvar sig = Object.find(tripwire.client.chain.map, \"id\", sigID);\r\n\r\n\t\t\t\t\t$(\"#dialog-rename\").parent().find(\":button:contains('Save')\").button(\"disable\");\r\n\r\n\t\t\t\t\tvar data = {\"request\": {\"signatures\": {\"rename\": {id: sigID, name: $(\"#dialog-rename\").find(\"#name\").val(), side: sig.systemID == systemID ? \"parent\" : \"child\"}}}};\r\n\r\n\t\t\t\t\tvar success = function(data) {\r\n\t\t\t\t\t\tif (data && data.result == true) {\r\n\t\t\t\t\t\t\t$(\"#dialog-rename\").dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar always = function(data) {\r\n\t\t\t\t\t\t$(\"#dialog-rename\").parent().find(\":button:contains('Save')\").button(\"enable\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttripwire.refresh('refresh', data, success, always);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$.moogle.contextmenu.prototype.setFlare = function(systemID, flare, ui) {\r\n\t\t\tvar data = {\"systemID\": systemID, \"flare\": flare};\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"flares.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: data,\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tif (data && data.result) {\r\n\t\t\t\t\t// $(ui.target[0]).closest(\"td\").removeClass(\"redNode yellowNode greenNode\").addClass(flare+\"Node\");\r\n\r\n\t\t\t\t\tchain.data.flares.flares.push({systemID: systemID, flare: flare, time: null});\r\n\t\t\t\t\tchain.flares(chain.data.flares);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t$.moogle.contextmenu.prototype.removeFlare = function(systemID, ui) {\r\n\t\t\tvar data = {\"systemID\": systemID};\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"flares.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: data,\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tif (data && data.result) {\r\n\t\t\t\t\t// $(ui.target[0]).closest(\"td\").removeClass(\"redNode yellowNode greenNode\");\r\n\r\n\t\t\t\t\tchain.data.flares.flares.splice(Object.index(chain.data.flares.flares, \"systemID\", systemID), 1);\r\n\t\t\t\t\tchain.flares(chain.data.flares);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n});\r\n\r\nfunction linkSig(sigName) {\r\n\tvar wormholeSignatures = [\r\n\t\t// Ore sites\r\n\t\t\"Average Frontier Deposit\",\r\n\t\t\"Unexceptional Frontier Deposit\",\r\n\t\t\"Common Perimeter Deposit\",\r\n\t\t\"Exceptional Core Deposit\",\r\n\t\t\"Infrequent Core Deposit\",\r\n\t\t\"Unusual Core Deposit\",\r\n\t\t\"Rarified Core Deposit\",\r\n\t\t\"Isolated Core Deposit\",\r\n\t\t\"Ordinary Permiter Deposit\",\r\n\t\t\"Uncommon Core Deposit\",\r\n\r\n\t\t// Gas Sites\r\n\t\t\"Barren Perimeter Reservoir\",\r\n\t\t\"Minor Perimeter Reservoir\",\r\n\t\t\"Ordinary Perimeter Reservoir\",\r\n\t\t\"Sizeable Perimeter Reservoir\",\r\n\t\t\"Token Perimeter Reservoir\",\r\n\t\t\"Bountiful Frontier Reservoir\",\r\n\t\t\"Vast Frontier Reservoir\",\r\n\t\t\"Instrumental Core Reservoir\",\r\n\t\t\"Vital Core Reservoir\",\r\n\r\n\t\t// Class 1\r\n\t\t\"Perimeter Ambush Point\",\r\n\t\t\"Perimeter Camp\",\r\n\t\t\"Phase Catalyst Node\",\r\n\t\t\"The Line\",\r\n\t\t\"Forgotten Perimeter Coronation Platform\",\r\n\t\t\"Forgotten Perimeter Power Array\",\r\n\t\t\"Unsecured Perimeter Amplifier\",\r\n\t\t\"Unsecured Perimeter Information Center\",\r\n\r\n\t\t// Class 2\r\n\t\t\"Perimeter Checkpoint\",\r\n\t\t\"Perimeter Hangar\",\r\n\t\t\"The Ruins of Enclave Cohort 27\",\r\n\t\t\"Sleeper Data Sanctuary\",\r\n\t\t\"Forgotten Perimeter Gateway\",\r\n\t\t\"Forgotten Perimeter Habitation Coils\",\r\n\t\t\"Unsecured Perimeter Comms Relay\",\r\n\t\t\"Unsecured Perimeter Transponder Farm\",\r\n\r\n\t\t// Class 3\r\n\t\t\"Fortification Frontier Stronghold\",\r\n\t\t\"Outpost Frontier Stronghold\",\r\n\t\t\"Solar Cell\",\r\n\t\t\"The Oruze Construct\",\r\n\t\t\"Forgotten Frontier Quarantine Outpost\",\r\n\t\t\"Forgotten Frontier Recursive Depot\",\r\n\t\t\"Unsecured Frontier Database\",\r\n\t\t\"Unsecured Frontier Receiver\",\r\n\r\n\t\t// Class 4\r\n\t\t\"Frontier Barracks\",\r\n\t\t\"Frontier Command Post\",\r\n\t\t\"Integrated Terminus\",\r\n\t\t\"Sleeper Information Sanctum\",\r\n\t\t\"Forgotten Frontier Conversion Module\",\r\n\t\t\"Forgotten Frontier Evacuation Center\",\r\n\t\t\"Unsecured Frontier Digital Nexus\",\r\n\t\t\"Unsecured Frontier Trinary Hub\",\r\n\r\n\t\t// Class 5\r\n\t\t\"Core Garrison\",\r\n\t\t\"Core Stronghold\",\r\n\t\t\"Oruze Osobnyk\",\r\n\t\t\"Quarantine Area\",\r\n\t\t\"Forgotten Core Data Field\",\r\n\t\t\"Forgotten Core Information Pen\",\r\n\t\t\"Unsecured Frontier Enclave Relay\",\r\n\t\t\"Unsecured Frontier Server Bank\",\r\n\r\n\t\t// Class 6\r\n\t\t\"Core Citadel\",\r\n\t\t\"Core Bastion\",\r\n\t\t\"Strange Energy Readings\",\r\n\t\t\"The Mirror\",\r\n\t\t\"Forgotten Core Assembly Hall\",\r\n\t\t\"Forgotten Core Circuitry Disassembler\",\r\n\t\t\"Unsecured Core Backup Array\",\r\n\t\t\"Unsecured Core Emergence\"\r\n\t];\r\n\r\n\tif (wormholeSignatures.indexOf(sigName) > -1) {\r\n\t\treturn '<a href=\"http://eve-survival.org/wikka.php?wakka='+sigName.replace(/ /g, '')+'\" target=\"_blank\" class=\"siteLink\">'+sigName+'</a>';\r\n\t}\r\n\r\n\treturn sigName;\r\n}\r\n\r\n$.widget(\"custom.inlinecomplete\", $.ui.autocomplete, {\r\n\t_create: function() {\r\n\t\tif (!this.element.is(\"input\")) {\r\n\t\t\tthis._selectInit();\r\n\t\t}\r\n\r\n\t\t// Invoke the parent function\r\n\t\treturn this._super();\r\n\t},\r\n\t_value: function() {\r\n\t\t// Invoke the parent function\r\n\t\tvar originalReturn = this._superApply(arguments);\r\n\r\n\t\tthis.element.change();\r\n\r\n\t\treturn originalReturn;\r\n\t},\r\n\t_suggest: function(items) {\r\n\t\tif (this.element.val() != items[0].value) {\r\n\t\t\tthis.element.val(items[0].value.substr(0, this.element.val().length));\r\n\t\t}\r\n\r\n\t\t// Invoke the parent function\r\n\t\treturn this._super(items);\r\n\t},\r\n\t_initSource: function() {\r\n\t\tif ($.isArray(this.options.source)) {\r\n\t\t\tthis.source = function(request, response) {\r\n\t\t\t\tvar matcher = new RegExp(\"^\" + $.ui.autocomplete.escapeRegex(request.term), \"i\");\r\n\t\t\t\tvar results = new Array(); // results array\r\n\t\t\t\tvar data = this.options.source;\r\n\t\t\t\tvar maxSize = this.options.maxSize || 25; // maximum result size\r\n\t\t\t\t// simple loop for the options\r\n\t\t\t\tfor (var i = 0, l = data.length; i < l; i++) {\r\n\t\t\t\t\tif (matcher.test(data[i])) {\r\n\t\t\t\t\t\tresults.push(data[i]);\r\n\r\n\t\t\t\t\t\tif (maxSize && results.length > maxSize) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t // send response\r\n\t\t\t\t response(results);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Invoke the parent function\r\n\t\t\treturn this._super();\r\n\t\t}\r\n\t},\r\n\t_close: function(event) {\r\n\t\tthis.options.source = this.options.input_source ? this.options.input_source : this.options.source;\r\n\r\n\t\t// Invoke the parent function\r\n\t\treturn this._super(event);\r\n\t},\r\n\t_selectInit: function() {\r\n\t\tthis.element.addClass(\"custom-combobox\");\r\n\t\tthis.wrapper = this.element;\r\n\t\tthis.element = this.wrapper.find(\"input:first\");\r\n\t\tthis.select = this.wrapper.find(\"select:first\").remove();\r\n\r\n\t\tthis.options.input_source = this.options.source;\r\n\t\tthis.options.select_source = this.select.children(\"option[value!='']\").map(function() {\r\n            return $.trim(this.text);\r\n        }).toArray();\r\n\r\n\t\tthis._createShowAllButton();\r\n\t},\r\n\t_createShowAllButton: function() {\r\n        var that = this,\r\n          wasOpen = false;\r\n\r\n        $(\"<a>\")\r\n\t\t\t.attr(\"tabIndex\", that.element.prop(\"tabindex\"))\r\n\t\t\t.attr(\"title\", \"\")\r\n\t\t\t.appendTo(that.wrapper)\r\n\t\t\t.button({icons: {primary: \"ui-icon-triangle-1-s\"}, text: false})\r\n\t\t\t.removeClass(\"ui-corner-all\")\r\n\t\t\t.addClass(\"custom-combobox-toggle ui-corner-right\")\r\n\t\t\t.on(\"mousedown\", function() {\r\n\t\t\t\twasOpen = that.widget().is(\":visible\");\r\n\t\t\t})\r\n\t\t\t.on(\"click\", function() {\r\n\t\t\t\tthat.element.trigger(\"focus\");\r\n\r\n\t\t\t\t// Close if already visible\r\n\t\t\t\tif (wasOpen) {\r\n\t\t\t\t  return;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Pass empty string as value to search for, displaying all results\r\n\t\t\t\tthat.options.source = that.options.select_source;\r\n\t\t\t\tthat._search(\"\")\r\n\t\t\t});\r\n      },\r\n});\r\n\r\n$(\"#sigTable\").tablesorter({\r\n\tsortReset: true,\r\n\twidgets: ['saveSort'],\r\n\ttextExtraction: {\r\n\t\t2: function(node) { return $(node).find(\"span\").data(\"age\"); }\r\n\t}\r\n});\r\n\r\nvar whList;\r\nwhList = $.map(tripwire.wormholes, function(item, index) { return index;});\r\nwhList.splice(26, 0, \"K162\");\r\nwhList.push(\"???\", \"GATE\");\r\n\r\n$(\".systemsAutocomplete\").inlinecomplete({source: tripwire.aSystems, maxSize: 10, delay: 0});\r\n\r\n$(\"#dialog-error\").dialog({\r\n\tautoOpen: false,\r\n\tresizable: false,\r\n\tminHeight: 0,\r\n\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\tbuttons: {\r\n\t\tOk: function() {\r\n\t\t\t$(this).dialog(\"close\");\r\n\t\t}\r\n\t},\r\n\tcreate: function() {\r\n\t\t$(this).dialog(\"option\", \"show\", {effect: \"shake\", duration: 150, easing: \"easeOutElastic\"});\r\n\t}\r\n});\r\n\r\n$(\"#dialog-msg\").dialog({\r\n\tautoOpen: false,\r\n\tresizable: false,\r\n\tminHeight: 0,\r\n\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\tbuttons: {\r\n\t\tOk: function() {\r\n\t\t\t$(this).dialog(\"close\");\r\n\t\t}\r\n\t}\r\n});\r\n\r\n$(\"#dialog-confirm\").dialog({\r\n\tautoOpen: false,\r\n\tresizable: false,\r\n\tminHeight: 0,\r\n\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\tbuttons: {\r\n\t\tCancel: function() {\r\n\t\t\t$(this).dialog(\"close\");\r\n\t\t}\r\n\t}\r\n});\r\n","var guidance = (function (undefined) {\r\n\r\n\tvar extractKeys = function (obj) {\r\n\t\tvar keys = [];\r\n\r\n\t\tfor (var key in obj) {\r\n\t\t    Object.prototype.hasOwnProperty.call(obj,key) && keys.push(key);\r\n\t\t}\r\n\r\n\t\treturn keys;\r\n\t}\r\n\r\n\tvar sorter = function (a, b) {\r\n\t\treturn parseFloat (a) - parseFloat (b);\r\n\t}\r\n\r\n\tvar findPaths = function (map, start, end, infinity) {\r\n\t\tinfinity = infinity || Infinity;\r\n\r\n\t\tvar costs = {},\r\n\t\t    open = {'0': [start]},\r\n\t\t    predecessors = {},\r\n\t\t    keys;\r\n\r\n\t\tvar addToOpen = function (cost, vertex) {\r\n\t\t\tvar key = \"\" + cost;\r\n\t\t\tif (!open[key]) open[key] = [];\r\n\t\t\topen[key].push(vertex);\r\n\t\t}\r\n\r\n\t\tcosts[start] = 0;\r\n\r\n\t\twhile (open) {\r\n\t\t\tif(!(keys = extractKeys(open)).length) break;\r\n\r\n\t\t\tkeys.sort(sorter);\r\n\r\n\t\t\tvar key = keys[0],\r\n\t\t\t    bucket = open[key],\r\n\t\t\t    node = bucket.shift(),\r\n\t\t\t    currentCost = parseFloat(key),\r\n\t\t\t    adjacentNodes = map[node] || {};\r\n\r\n\t\t\tif (!bucket.length) delete open[key];\r\n\r\n\t\t\tfor (var vertex in adjacentNodes) {\r\n\t\t\t    if (Object.prototype.hasOwnProperty.call(adjacentNodes, vertex)) {\r\n\t\t\t\t\tvar cost = adjacentNodes[vertex],\r\n\t\t\t\t\t    totalCost = cost + currentCost,\r\n\t\t\t\t\t    vertexCost = costs[vertex];\r\n\r\n\t\t\t\t\tif ((vertexCost === undefined) || (vertexCost > totalCost)) {\r\n\t\t\t\t\t\tcosts[vertex] = totalCost;\r\n\t\t\t\t\t\taddToOpen(totalCost, vertex);\r\n\t\t\t\t\t\tpredecessors[vertex] = node;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (costs[end] === undefined) {\r\n\t\t\treturn null;\r\n\t\t} else {\r\n\t\t\treturn predecessors;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tvar extractShortest = function (predecessors, end) {\r\n\t\tvar nodes = [],\r\n\t\t    u = end;\r\n\r\n\t\twhile (u) {\r\n\t\t\tnodes.push(u);\r\n\t\t\tpredecessor = predecessors[u];\r\n\t\t\tu = predecessors[u];\r\n\t\t}\r\n\r\n\t\tnodes.reverse();\r\n\t\treturn nodes;\r\n\t}\r\n\r\n\tvar findShortestPath = function (map, nodes) {\r\n\t\tvar start = nodes.shift(),\r\n\t\t    end,\r\n\t\t    predecessors,\r\n\t\t    path = [],\r\n\t\t    shortest;\r\n\r\n\t\twhile (nodes.length) {\r\n\t\t\tend = nodes.shift();\r\n\t\t\tpredecessors = findPaths(map, start, end);\r\n\r\n\t\t\tif (predecessors) {\r\n\t\t\t\tshortest = extractShortest(predecessors, end);\r\n\t\t\t\tif (nodes.length) {\r\n\t\t\t\t\tpath.push.apply(path, shortest.slice(0, -1));\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn path.concat(shortest);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tstart = end;\r\n\t\t}\r\n\t}\r\n\r\n\tvar toArray = function (list, offset) {\r\n\t\ttry {\r\n\t\t\treturn Array.prototype.slice.call(list, offset);\r\n\t\t} catch (e) {\r\n\t\t\tvar a = [];\r\n\t\t\tfor (var i = offset || 0, l = list.length; i < l; ++i) {\r\n\t\t\t\ta.push(list[i]);\r\n\t\t\t}\r\n\t\t\treturn a;\r\n\t\t}\r\n\t}\r\n\r\n\tvar Guidance = function (map) {\r\n\t\tthis.map = map;\r\n\t}\r\n\r\n\tGuidance.prototype.findShortestPath = function (start, end) {\r\n\t\tvar result;\r\n\r\n\t\tif (Object.prototype.toString.call(start) === '[object Array]') {\r\n\t\t\tresult = findShortestPath(this.map, start);\r\n\t\t} else if (arguments.length === 2) {\r\n\t\t\tresult = findShortestPath(this.map, [start, end]);\r\n\t\t} else {\r\n\t\t\tresult = findShortestPath(this.map, toArray(arguments));\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tGuidance.findShortestPath = function (map, start, end) {\r\n\t\tif (Object.prototype.toString.call(start) === '[object Array]') {\r\n\t\t\treturn findShortestPath(map, start);\r\n\t\t} else if (arguments.length === 3) {\r\n\t\t\treturn findShortestPath(map, [start, end]);\r\n\t\t} else {\r\n\t\t\treturn findShortestPath(map, toArray(arguments, 1));\r\n\t\t}\r\n\t}\r\n\r\n\treturn Guidance;\r\n})();\r\n","$(\"#admin\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"disabled\")) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif (!$(\"#dialog-admin\").hasClass(\"ui-dialog-content\")) {\r\n\t\tvar refreshTimer = null;\r\n\t\tvar $total = null;\r\n\t\tvar $ajax = null;\r\n\r\n\t\tfunction refreshWindow() {\r\n\t\t\tif ($ajax) $ajax.abort();\r\n\t\t\t$total.html(\"Total: \" + $(\"#dialog-admin .window .hasFocus table tr[data-id]\").length);\r\n\r\n\t\t\t$ajax = $.ajax({\r\n\t\t\t\turl: \"admin.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: {mode: $(\"#dialog-admin .menu .active\").attr(\"data-window\")},\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tif (data && data.results) {\r\n\t\t\t\t\tvar rows = data.results;\r\n\t\t\t\t\tvar ids = [];\r\n\r\n\t\t\t\t\tfor (var i = 0, l = rows.length; i < l; i++) {\r\n\t\t\t\t\t\tvar $row = $(\"#dialog-admin .window .hasFocus tbody tr[data-id='\"+ rows[i].id +\"']\");\r\n\t\t\t\t\t\tids.push(rows[i].id);\r\n\r\n\t\t\t\t\t\tif ($row.length) {\r\n\t\t\t\t\t\t\tfor (col in rows[i]) {\r\n\t\t\t\t\t\t\t\tvar $col = $row.find(\"[data-col='\"+col+\"']\");\r\n\t\t\t\t\t\t\t\t$col.html(($col.attr(\"data-format\") == \"number\" ? numFormat(rows[i][col]) : rows[i][col]) || \"&nbsp;\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t$row = $(\"#dialog-admin .window .hasFocus table tr.hidden\").clone();\r\n\t\t\t\t\t\t\t$row.attr(\"data-id\", rows[i].id);\r\n\r\n\t\t\t\t\t\t\tfor (col in rows[i]) {\r\n\t\t\t\t\t\t\t\tvar $col = $row.find(\"[data-col='\"+col+\"']\");\r\n\t\t\t\t\t\t\t\t$col.html(($col.attr(\"data-format\") == \"number\" ? numFormat(rows[i][col]) : rows[i][col]) || \"&nbsp;\");\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t$row.removeClass(\"hidden\");\r\n\r\n\t\t\t\t\t\t\t$(\"#dialog-admin .window .hasFocus tbody\").append($row);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .window .hasFocus table tr[data-id]\").each(function() {\r\n\t\t\t\t\t\tif ($.inArray($(this).data(\"id\").toString(), ids) == -1) {\r\n\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .window .hasFocus table\").trigger(\"update\", [true]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#dialog-admin .window .hasFocus table tr[data-id]\").remove();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$total.html(\"Total: \" + $(\"#dialog-admin .window .hasFocus table tr[data-id]\").length);\r\n\t\t\t});\r\n\r\n\t\t\tif ($(\"#dialog-admin\").dialog(\"isOpen\") && $(\"#dialog-admin .menu .active\").attr(\"data-refresh\")) {\r\n\t\t\t\trefreshTimer = setTimeout(refreshWindow, $(\"#dialog-admin .menu .active\").attr(\"data-refresh\"));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t$(\"#dialog-admin\").dialog({\r\n\t\t\tautoOpen: true,\r\n\t\t\tmodal: true,\r\n\t\t\theight: 350,\r\n\t\t\twidth: 800,\r\n\t\t\tbuttons: {\r\n\t\t\t\tClose: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t// menu toggle\r\n\t\t\t\t$(\"#dialog-admin\").on(\"click\", \".menu li\", function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t$menuItem = $(this);\r\n\t\t\t\t\tclearTimeout(refreshTimer);\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .menu .active\").removeClass(\"active\");\r\n\t\t\t\t\t$menuItem.addClass(\"active\");\r\n\t\t\t\t\t$(\"div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane\").html(\"\");\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .window [data-window]\").removeClass(\"hasFocus\").hide();\r\n\t\t\t\t\t$(\"#dialog-admin .window [data-window='\"+ $menuItem.data(\"window\") +\"']\").addClass(\"hasFocus\").show();\r\n\r\n\t\t\t\t\trefreshWindow();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-admin [data-sortable='true']\").tablesorter({\r\n\t\t\t\t\tsortReset: true,\r\n\t\t\t\t\twidgets: ['saveSort'],\r\n\t\t\t\t\tsortList: [[0,0]]\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// dialog bottom tray\r\n\t\t\t\t$($(this)[0].parentElement).find(\".ui-dialog-buttonpane\").append(\"<div class='ui-dialog-traypane'></div>\");\r\n\t\t\t\t$total = $(\"div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane\");\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$menuItem = $(\"#dialog-admin .menu li.active\");\r\n\t\t\t\trefreshWindow();\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tclearTimeout(refreshTimer);\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-admin\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-admin\").dialog(\"open\");\r\n\t}\r\n});\r\n","// Dialog effects\r\n$(\"#wrapper\").addClass(\"transition\");\r\n\r\n$(document).on(\"dialogopen\", \".ui-dialog\", function (event, ui) {\r\n\t// Add additional full screen overlay for 2nd level dialog\r\n\tif ($(\".ui-dialog:visible\").length == 2 && $(this).hasClass(\"dialog-modal\"))\r\n\t\t$(\"body\").append($(\"<div id='overlay' class='overlay' />\").css(\"z-index\", $(this).css(\"z-index\") - 1));\r\n\telse if ($(\"#overlay\"))\r\n\t\t$(\"#overlay\").css(\"z-index\", $(this).css(\"z-index\") - 1);\r\n\r\n\tif (!$(this).hasClass(\"dialog-noeffect\"))\r\n\t\t$(\"#wrapper\").addClass(\"blur\");\r\n});\r\n\r\n$(document).on(\"dialogclose\", \".ui-dialog\", function (event, ui) {\r\n\tif (!$(\".ui-dialog\").is(\":visible\"))\r\n\t\t$(\"#wrapper\").removeClass(\"blur\");\r\n\r\n\tif ($(\".ui-dialog:visible\").length == 1)\r\n\t\t$(\"#overlay\").remove();\r\n\telse if ($(\"#overlay\"))\r\n\t\t$(\"#overlay\").css(\"z-index\", $(this).css(\"z-index\") - 2);\r\n\r\n\t//if ($(\".ui-dialog:visible\").length == 0 && options.buttons.follow && viewingSystemID != tripwire.client.EVE.systemID)\r\n\t//\twindow.location = \"?system=\"+tripwire.client.EVE.systemName;\r\n});\r\n\r\n// Toggle dialog inputs based on sig type\r\n$(\"#dialog-sigAdd #sigType, #dialog-sigEdit #sigType\").on(\"selectmenuchange\", function() {\r\n\tif ($(this).val() == \"Wormhole\") {\r\n\t\t$(this).closest(\".ui-dialog\").find(\".sig-site\").find(\"td > div, th > div\").slideUp(200, function() { $(this).closest(\".sig-site\").hide(0); });\r\n\r\n\t\t$(this).closest(\".ui-dialog\").find(\"#sigLife\").attr(\"disabled\", \"disabled\").selectmenu(\"disable\");\r\n\t\t$(this).closest(\".ui-dialog\").find(\"#sigName\").attr(\"disabled\", \"disabled\");\r\n\r\n\t\t$(this).closest(\".ui-dialog\").find(\".sig-wormhole\").find(\"td > div, th > div\").slideDown(200, function() { $(this).closest(\".sig-wormhole\").show(200); });\r\n\r\n\t\t$(this).closest(\".ui-dialog\").find(\"#whType\").removeAttr(\"disabled\");\r\n\t\t$(this).closest(\".ui-dialog\").find(\"#connection\").removeAttr(\"disabled\");\r\n\t\t$(this).closest(\".ui-dialog\").find(\"#whLife\").removeAttr(\"disabled\").selectmenu(\"enable\");\r\n\t\t$(this).closest(\".ui-dialog\").find(\"#whMass\").removeAttr(\"disabled\").selectmenu(\"enable\");\r\n\t} else {\r\n\t\t$(this).closest(\".ui-dialog\").find(\".sig-site\").find(\"td > div, th > div\").slideDown(200, function() { $(this).closest(\".sig-site\").show(200); });\r\n\r\n\t\t$(this).closest(\".ui-dialog\").find(\"#sigLife\").removeAttr(\"disabled\").selectmenu(\"enable\");\r\n\t\t$(this).closest(\".ui-dialog\").find(\"#sigName\").removeAttr(\"disabled\");\r\n\r\n\t\t$(this).closest(\".ui-dialog\").find(\".sig-wormhole\").find(\"td > div, th > div\").slideUp(200, function() { $(this).closest(\".sig-wormhole\").hide(0); });\r\n\r\n\t\t$(this).closest(\".ui-dialog\").find(\"#whType\").attr(\"disabled\", \"disabled\");\r\n\t\t$(this).closest(\".ui-dialog\").find(\"#connection\").attr(\"disabled\", \"disabled\");\r\n\t\t$(this).closest(\".ui-dialog\").find(\"#whLife\").attr(\"disabled\", \"disabled\").selectmenu(\"disable\");\r\n\t\t$(this).closest(\".ui-dialog\").find(\"#whMass\").attr(\"disabled\", \"disabled\").selectmenu(\"disable\");\r\n\t}\r\n});\r\n\r\n// Signature overwrite\r\n$(document).on(\"click\", \"#overwrite\", function() {\r\n\tvar data = {request: {signatures: {\"delete\": [$(this).data(\"id\")]}}, systemID: viewingSystemID};\r\n\r\n\t$(\"#overwrite\").attr(\"disable\", true);\r\n\r\n\tvar success = function(data) {\r\n\t\t$(\"th.critical\").removeClass(\"critical\");\r\n\t\tValidationTooltips.close();\r\n\r\n\t\t$(\"#dialog-sigEdit\").parent().find(\".ui-button-text:contains(Save)\").click();\r\n\t}\r\n\r\n\tvar always = function(data) {\r\n\t\t$(\"#overwrite\").removeAttr(\"disable\");\r\n\t}\r\n\r\n\ttripwire.refresh('refresh', data, success, always);\r\n});\r\n","$(\".options\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"disabled\"))\r\n\t\treturn false;\r\n\r\n\t$(\"#dialog-options\").dialog({\r\n\t\tautoOpen: false,\r\n\t\twidth: 450,\r\n\t\tminHeight: 400,\r\n\t\tmodal: true,\r\n\t\tbuttons: {\r\n\t\t\tSave: function() {\r\n\t\t\t\t// Options\r\n\t\t\t\tvar data = {mode: \"set\", options: JSON.stringify(options)};\r\n\t\t\t\tvar maskChange = false;\r\n\r\n\t\t\t\t$(\"#dialog-options\").parent().find(\".ui-dialog-buttonpane button:contains('Save')\").attr(\"disabled\", true).addClass(\"ui-state-disabled\");\r\n\r\n\t\t\t\toptions.chain.typeFormat = $(\"#dialog-options #typeFormat\").val();\r\n\t\t\t\toptions.chain.classFormat = $(\"#dialog-options #classFormat\").val();\r\n\r\n\t\t\t\toptions.chain.gridlines = JSON.parse($(\"#dialog-options input[name=gridlines]:checked\").val());\r\n\r\n\t\t\t\toptions.chain[\"node-reference\"] = $(\"#dialog-options input[name=node-reference]:checked\").val();\r\n\r\n\t\t\t\toptions.signatures.pasteLife = $(\"#dialog-options #pasteLife\").val();\r\n\r\n\t\t\t\toptions.background = $(\"#dialog-options #background-image\").val();\r\n\r\n\t\t\t\tif (options.masks.active != $(\"#dialog-options input[name='mask']:checked\").val()) {\r\n\t\t\t\t\tmaskChange = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\toptions.masks.active = $(\"#dialog-options input[name='mask']:checked\").val();\r\n\r\n\t\t\t\toptions.apply();\r\n\t\t\t\toptions.save() // Performs AJAX\r\n\t\t\t\t\t.done(function() {\r\n\t\t\t\t\t\tif (maskChange) {\r\n\t\t\t\t\t\t\t// Reset signatures\r\n\t\t\t\t\t\t\t$(\"#sigTable span[data-age]\").countdown(\"destroy\");\r\n\t\t\t\t\t\t\t$(\"#sigTable tbody\").empty()\r\n\t\t\t\t\t\t\t$(\"#signature-count\").html(0);\r\n\t\t\t\t\t\t\ttripwire.signatures.list = {};\r\n\t\t\t\t\t\t\ttripwire.client.signatures = [];\r\n\r\n\t\t\t\t\t\t\ttripwire.refresh('change');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\r\n\t\t\t\t$(\"#dialog-options\").dialog(\"close\");\r\n\t\t\t\t$(\"#dialog-options\").parent().find(\".ui-dialog-buttonpane button:contains('Save')\").attr(\"disabled\", false).removeClass(\"ui-state-disabled\");\r\n\r\n\t\t\t\t// toggle mask admin icon\r\n\t\t\t\t$(\"#dialog-options input[name='mask']:checked\").data(\"admin\") ? $(\"#admin\").removeClass(\"disabled\") : $(\"#admin\").addClass(\"disabled\");\r\n\t\t\t},\r\n\t\t\tReset: function() {\r\n\t\t\t\t$(\"#dialog-confirm #msg\").html(\"Settings will be reset to defaults temporarily.<br/><br/><p><em>Save settings to make changes permanent.</em></p>\");\r\n\t\t\t\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tReset: function() {\r\n\t\t\t\t\t\t\toptions.reset();\r\n\t\t\t\t\t\t\toptions.apply();\r\n\r\n\t\t\t\t\t\t\t$(\"#dialog-options\").dialog(\"close\");\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}).dialog(\"open\");\r\n\t\t\t},\r\n\t\t\tClose: function() {\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t}\r\n\t\t},\r\n\t\topen: function() {\r\n\t\t\t// Get user stats data\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"user_stats.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tfor (stat in data) {\r\n\t\t\t\t\t$(\"#\"+stat).text(data[stat]);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Get masks\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"masks.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(response) {\r\n\t\t\t\tif (response && response.masks) {\r\n\t\t\t\t\t$(\"#dialog-options #masks #default\").html(\"\");\r\n\t\t\t\t\t$(\"#dialog-options #masks #personal\").html(\"\");\r\n\t\t\t\t\t$(\"#dialog-options #masks #corporate\").html(\"\");\r\n\r\n\t\t\t\t\tfor (var x in response.masks) {\r\n\t\t\t\t\t\tvar mask = response.masks[x];\r\n\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t+ '<input type=\"radio\" name=\"mask\" id=\"mask'+x+'\" value=\"'+mask.mask+'\" class=\"selector\" data-owner=\"'+mask.owner+'\" data-admin=\"'+mask.admin+'\" />'\r\n\t\t\t\t\t\t\t+ '<label for=\"mask'+x+'\"><img src=\"'+mask.img+'\" />'\r\n\t\t\t\t\t\t\t+  (mask.optional ? '<i class=\"closeIcon\" onclick=\"return false;\" data-icon=\"red-giant\"><i data-icon=\"times\"></i></i>' : '')\r\n\t\t\t\t\t\t\t+ '<span class=\"selector_label\">'+mask.label+'</span></label>');\r\n\r\n\t\t\t\t\t\t$(\"#dialog-options #masks #\"+mask.type).append(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findp\" value=\"personal\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t+ '<label for=\"findp\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t$(\"#dialog-options #masks #personal\").append(node);\r\n\r\n\t\t\t\t\tif (init.admin == \"1\") {\r\n\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findc\" value=\"corporate\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t\t+ '<label for=\"findc\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t\t$(\"#dialog-options #masks #corporate\").append(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$(\"#dialog-options input[name='mask']\").filter(\"[value='\"+response.masks[response.active].mask+\"']\").attr(\"checked\", true).trigger(\"change\");\r\n\r\n\t\t\t\t\t// toggle mask admin icon\r\n\t\t\t\t\tresponse.masks[response.active].admin ? $(\"#admin\").removeClass(\"disabled\") : $(\"#admin\").addClass(\"disabled\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-options #pasteLife\").val(options.signatures.pasteLife);\r\n\t\t\t$(\"#dialog-options #typeFormat\").val(options.chain.typeFormat);\r\n\t\t\t$(\"#dialog-options #classFormat\").val(options.chain.classFormat);\r\n\t\t\t$(\"#dialog-options input[name='node-reference'][value='\"+options.chain[\"node-reference\"]+\"']\").prop(\"checked\", true);\r\n\t\t\t$(\"#dialog-options input[name='gridlines'][value='\"+options.chain.gridlines+\"']\").prop(\"checked\", true);\r\n\t\t\t$(\"#dialog-options #background-image\").val(options.background);\r\n\t\t},\r\n\t\tcreate: function() {\r\n\t\t\t$(\"#optionsAccordion\").accordion({heightStyle: \"content\", collapsible: true, active: false});\r\n\r\n\t\t\t$(\"#dialog-pwChange\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tresizable: false,\r\n\t\t\t\tminHeight: 0,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tSave: function() {\r\n\t\t\t\t\t\t$(\"#pwForm\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#pwForm input[name='password'], #pwForm input[name='confirm']\").val(\"\");\r\n\t\t\t\t\t$(\"#pwError\").text(\"\").hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#pwChange\").click(function() {\r\n\t\t\t\t$(\"#dialog-pwChange\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#pwForm\").submit(function(e) {\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t$(\"#pwError\").text(\"\").hide();\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: \"options.php\",\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t$(\"#dialog-msg #msg\").text(\"Password changed\");\r\n\t\t\t\t\t\t$(\"#dialog-msg\").dialog(\"open\");\r\n\r\n\t\t\t\t\t\t$(\"#dialog-pwChange\").dialog(\"close\");\r\n\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t$(\"#pwError\").text(response.error).show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#pwError\").text(\"Unknown error\").show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-usernameChange\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tresizable: false,\r\n\t\t\t\tminHeight: 0,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tSave: function() {\r\n\t\t\t\t\t\t$(\"#usernameForm\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\topen: function() {\r\n\t\t\t\t\t$(\"#usernameForm #username\").html($(\"#dialog-options #username\").html());\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#usernameForm [name='username']\").val(\"\");\r\n\t\t\t\t\t$(\"#usernameError\").text(\"\").hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#usernameChange\").click(function() {\r\n\t\t\t\t$(\"#dialog-usernameChange\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#usernameForm\").submit(function(e) {\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t$(\"#usernameError\").text(\"\").hide();\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: \"options.php\",\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t$(\"#dialog-msg #msg\").text(\"Username changed\");\r\n\t\t\t\t\t\t$(\"#dialog-msg\").dialog(\"open\");\r\n\r\n\t\t\t\t\t\t$(\"#dialog-options #username\").html(response.result);\r\n\r\n\t\t\t\t\t\t$(\"#dialog-usernameChange\").dialog(\"close\");\r\n\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t$(\"#usernameError\").text(response.error).show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#usernameError\").text(\"Unknown error\").show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Mask selections\r\n\t\t\t$(\"#masks\").on(\"change\", \"input.selector:checked\", function() {\r\n\t\t\t\tif ($(this).data(\"owner\")) {\r\n\t\t\t\t\t$(\"#maskControls #edit\").removeAttr(\"disabled\");\r\n\t\t\t\t\t$(\"#maskControls #delete\").removeAttr(\"disabled\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#maskControls #edit\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t\t$(\"#maskControls #delete\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($(this).val() != 0.0 && $(this).val().split(\".\")[1] == 0) {\r\n\t\t\t\t\t$(\"#dialog-options #leave\").removeAttr(\"disabled\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#dialog-options #leave\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Mask join\r\n\t\t\t$(\"#dialog-joinMask\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tresizable: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tAdd: function() {\r\n\t\t\t\t\t\tvar mask = $(\"#dialog-joinMask #results input:checked\");\r\n\t\t\t\t\t\tvar label = $(\"#dialog-joinMask #results input:checked+label\");\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: {mask: mask.val(), mode: \"join\"},\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\tlabel.css(\"width\", \"\");\r\n\t\t\t\t\t\t\t\tlabel.find(\".info\").remove();\r\n\t\t\t\t\t\t\t\tlabel.append('<i class=\"closeIcon\" onclick=\"return false;\" data-icon=\"red-giant\"><i data-icon=\"times\"></i></i>');\r\n\r\n\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #\"+response.type+\" input.selector:last\").before(mask).before(label);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-joinMask\").dialog(\"close\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#dialog-joinMask form\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$(\"#dialog-joinMask #results\").html(\"\");\r\n\t\t\t\t\t\t$(\"#dialog-joinMask #loading\").show();\r\n\t\t\t\t\t\t$(\"#dialog-joinMask input[type='submit']\").attr(\"disabled\", \"disabled\");\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.results) {\r\n\t\t\t\t\t\t\t\tfor (var x in response.results) {\r\n\t\t\t\t\t\t\t\t\tvar mask = response.results[x];\r\n\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t+ '<input type=\"radio\" name=\"mask\" id=\"mask'+mask.mask+'\" value=\"'+mask.mask+'\" class=\"selector\" data-owner=\"false\" data-admin=\"'+mask.admin+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t+ '<label for=\"mask'+mask.mask+'\" style=\"width: 100%; margin-left: -5px;\">'\r\n\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"'+mask.img+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">'+mask.label+'</span>'\r\n\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(mask.characterName ? mask.characterName + '<br/>' : '')\r\n\t\t\t\t\t\t\t\t\t\t+ '\t\t'+mask.corporationName+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t+ '\t\t'+mask.allianceName\r\n\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t+ '</label>');\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-joinMask #results\").append(node);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(response.error);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unknown error\");\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).always(function() {\r\n\t\t\t\t\t\t\t$(\"#dialog-joinMask #loading\").hide();\r\n\t\t\t\t\t\t\t$(\"#dialog-joinMask input[type='submit']\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#dialog-joinMask #results\").html(\"\");\r\n\t\t\t\t\t$(\"#dialog-joinMask input[name='name']\").val(\"\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-options #masks\").on(\"click\", \"input[name='find']+label\", function() {\r\n\t\t\t\t$(\"#dialog-joinMask input[name='find']\").val($(this).prev().val());\r\n\t\t\t\t$(\"#dialog-joinMask\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// Mask leave\r\n\t\t\t$(\"#dialog-options #masks\").on(\"click\", \".closeIcon\", function() {\r\n\t\t\t\tvar mask = $(this).closest(\"input.selector+label\").prev();\r\n\r\n\t\t\t\t$(\"#dialog-confirm #msg\").text(\"Are you sure you want to remove this mask?\");\r\n\r\n\t\t\t\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tRemove: function() {\r\n\t\t\t\t\t\t\tvar send = {mode: \"leave\", mask: mask.val()};\r\n\r\n\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\t\tdata: send,\r\n\t\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t\tmask.next().remove();\r\n\t\t\t\t\t\t\t\t\tmask.remove();\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unable to delete\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}).dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// Mask delete\r\n\t\t\t$(\"#maskControls #delete\").click(function() {\r\n\t\t\t\tvar mask = $(\"#masks input.selector:checked\");\r\n\r\n\t\t\t\t$(\"#dialog-confirm #msg\").text(\"Are you sure you want to delete this mask?\");\r\n\t\t\t\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tDelete: function() {\r\n\t\t\t\t\t\t\tvar send = {mode: \"delete\", mask: mask.val()};\r\n\r\n\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\t\tdata: send,\r\n\t\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t\tmask.next().remove();\r\n\t\t\t\t\t\t\t\t\tmask.remove();\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unable to delete\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}).dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// User Create mask\r\n\t\t\t$(\"#dialog-createMask\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tCreate: function() {\r\n\t\t\t\t\t\t$(\"#dialog-createMask form\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#dialog-createMask #accessList\").on(\"click\", \"#create_add+label\", function() {\r\n\t\t\t\t\t\t$(\"#dialog-EVEsearch\").dialog(\"open\");\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-createMask form\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t// Get masks\r\n\t\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\t\t\tif (response && response.masks) {\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #default\").html(\"\");\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #personal\").html(\"\");\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #corporate\").html(\"\");\r\n\r\n\t\t\t\t\t\t\t\t\t\tfor (var x in response.masks) {\r\n\t\t\t\t\t\t\t\t\t\t\tvar mask = response.masks[x];\r\n\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"radio\" name=\"mask\" id=\"mask'+x+'\" value=\"'+mask.mask+'\" class=\"selector\" data-owner=\"'+mask.owner+'\" data-admin=\"'+mask.admin+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"mask'+x+'\"><img src=\"'+mask.img+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+  (mask.optional ? '<i class=\"closeIcon\" onclick=\"return false;\" data-icon=\"red-giant\"><i data-icon=\"times\"></i></i>' : '')\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<span class=\"selector_label\">'+mask.label+'</span></label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #\"+mask.type).append(node);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findp\" value=\"personal\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"findp\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #personal\").append(node);\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (init.admin == \"1\") {\r\n\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findc\" value=\"corporate\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"findc\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #corporate\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options input[name='mask']\").filter(\"[value='\"+response.masks[response.active].mask+\"']\").attr(\"checked\", true).trigger(\"change\");\r\n\r\n\t\t\t\t\t\t\t\t\t\t// toggle mask admin icon\r\n\t\t\t\t\t\t\t\t\t\tresponse.masks[response.active].admin ? $(\"#admin\").removeClass(\"disabled\") : $(\"#admin\").addClass(\"disabled\");\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t$(\"#dialog-createMask\").dialog(\"close\");\r\n\t\t\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(response.error);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unknown error\");\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-createMask select\").selectmenu({width: 100});\r\n\t\t\t\t},\r\n\t\t\t\topen: function() {\r\n\t\t\t\t\t$(\"#dialog-createMask input[name='name']\").val(\"\");\r\n\t\t\t\t\t$(\"#dialog-createMask #accessList :not(.static)\").remove();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#maskControls #create\").click(function() {\r\n\t\t\t\t$(\"#dialog-createMask\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-createMask #accessList\").on(\"click\", \".maskRemove\", function() {\r\n\t\t\t\t$(this).closest(\"input.selector+label\").prev().remove();\r\n\t\t\t\t$(this).closest(\"label\").remove();\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-editMask\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tSave: function() {\r\n\t\t\t\t\t\t$(\"#dialog-editMask form\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList\").on(\"click\", \".maskRemove\", function() {\r\n\t\t\t\t\t\t$(this).closest(\"input.selector+label\").prev().attr(\"name\", \"deletes[]\").hide();\r\n\t\t\t\t\t\t$(this).closest(\"label\").hide();\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList\").on(\"click\", \"#edit_add+label\", function() {\r\n\t\t\t\t\t\t$(\"#dialog-EVEsearch\").dialog(\"open\");\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-editMask form\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-editMask\").dialog(\"close\");\r\n\t\t\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(response.error);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unknown error\");\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\topen: function() {\r\n\t\t\t\t\tvar mask = $(\"#dialog-options input[name='mask']:checked\").val();\r\n\t\t\t\t\t$(\"#dialog-editMask input[name='mask']\").val(mask);\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList label.static\").hide();\r\n\t\t\t\t\t$(\"#dialog-editMask #loading\").show();\r\n\t\t\t\t\t$(\"#dialog-editMask #name\").text($(\"#dialog-options input[name='mask']:checked+label .selector_label\").text());\r\n\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\tdata: {mode: \"edit\", mask: mask},\r\n\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\tif (response && response.results) {\r\n\t\t\t\t\t\t\tfor (var x in response.results) {\r\n\t\t\t\t\t\t\t\tvar result = response.results[x];\r\n\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" checked=\"checked\" onclick=\"return false\" name=\"\" id=\"edit_'+(result.type == 2 ? result.corporationID : result.characterID)+'_'+result.type+'\" value=\"'+(result.type == 2 ? result.corporationID : result.characterID)+'_'+result.type+'\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t+ '<label for=\"edit_'+(result.type == 2 ? result.corporationID : result.characterID)+'_'+result.type+'\" style=\"width: 100%; margin-left: -5px;\">'\r\n\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/'+(result.type == 2 ? 'Corporation/'+result.corporationID+'_64.png' : 'Character/'+result.characterID+'_64.jpg')+'\" />'\r\n\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">'+(result.type == 2 ? 'Corporation' : 'Character')+'</span>'\r\n\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t+ '\t\t'+(result.type != 2 ? result.characterName + '<br/>' : '')\r\n\t\t\t\t\t\t\t\t\t+ '\t\t'+result.corporationName+'<br/>'\r\n\t\t\t\t\t\t\t\t\t+ '\t\t'+result.allianceName\r\n\t\t\t\t\t\t\t\t\t+ '\t\t<input type=\"button\" class=\"maskRemove\" value=\"Remove\" style=\"position: absolute; bottom: 3px; right: 3px;\" />'\r\n\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t+ '</label>');\r\n\r\n\t\t\t\t\t\t\t\t$(\"#dialog-editMask #accessList .static:first\").before(node);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t$(\"#dialog-editMask #accessList label.static\").show();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).always(function() {\r\n\t\t\t\t\t\t$(\"#dialog-editMask #loading\").hide();\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList :not(.static)\").remove();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#maskControls #edit\").click(function() {\r\n\t\t\t\t$(\"#dialog-editMask\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// EVE search dialog\r\n\t\t\t$(\"#dialog-EVEsearch\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tAdd: function() {\r\n\t\t\t\t\t\tif ($(\"#accessList input[value='\"+$(\"#EVESearchResults input\").val()+\"']\").length) {\r\n\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Already has access\");\r\n\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$(\"#EVESearchResults .info\").append('<input type=\"button\" class=\"maskRemove\" value=\"Remove\" style=\"position: absolute; bottom: 3px; right: 3px;\" />');\r\n\t\t\t\t\t\tvar node = $(\"#EVESearchResults\").html();\r\n\r\n\t\t\t\t\t\tif ($(\"#dialog-createMask\").dialog(\"isOpen\"))\r\n\t\t\t\t\t\t\t$(\"#dialog-createMask #accessList .static:first\").before(node);\r\n\t\t\t\t\t\telse if ($(\"#dialog-editMask\").dialog(\"isOpen\"))\r\n\t\t\t\t\t\t\t$(\"#dialog-editMask #accessList .static:first\").before(node);\r\n\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t},\r\n\t\t\t\t\tClose: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#EVEsearch\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$(\"#EVEsearch #searchSpinner\").show();\r\n\t\t\t\t\t\t$(\"#EVEsearch input[type='submit']\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t\t\t$(\"#dialog-EVEsearch\").parent().find(\".ui-dialog-buttonpane button:contains('Add')\").attr(\"disabled\", true).addClass(\"ui-state-disabled\");\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.results) {\r\n\t\t\t\t\t\t\t\tvar result = response.results[0];\r\n\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" checked=\"checked\" onclick=\"return false\" name=\"adds[]\" id=\"find_'+(result.type == 2 ? result.corporationID : result.characterID)+'_'+result.type+'\" value=\"'+(result.type == 2 ? result.corporationID : result.characterID)+'_'+result.type+'\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t+ '<label for=\"find_'+(result.type == 2 ? result.corporationID : result.characterID)+'_'+result.type+'\" style=\"width: 100%; margin-left: -5px;\">'\r\n\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/'+(result.type == 2 ? 'Corporation/'+result.corporationID+'_64.png' : 'Character/'+result.characterID+'_64.jpg')+'\" />'\r\n\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">'+(result.type == 2 ? 'Corporation' : 'Character')+'</span>'\r\n\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t+ '\t\t'+(result.type != 2 ? result.characterName + '<br/>' : '')\r\n\t\t\t\t\t\t\t\t\t+ '\t\t'+result.corporationName+'<br/>'\r\n\t\t\t\t\t\t\t\t\t+ '\t\t'+result.allianceName\r\n\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t+ '</label>');\r\n\r\n\t\t\t\t\t\t\t\t$(\"#EVESearchResults\").html(node);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"No Results\");\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).always(function() {\r\n\t\t\t\t\t\t\t$(\"#EVEsearch #searchSpinner\").hide();\r\n\t\t\t\t\t\t\t$(\"#EVEsearch input[type='submit']\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t\t$(\"#dialog-EVEsearch\").parent().find(\".ui-dialog-buttonpane button:contains('Add')\").removeAttr(\"disabled\").removeClass(\"ui-state-disabled\");\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#EVEsearch input[name='name']\").val(\"\");\r\n\t\t\t\t\t$(\"#EVESearchResults\").html(\"\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\t$(\"#dialog-options\").dialog(\"open\");\r\n});\r\n","$(\"#add-signature\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\t$(\"#dialog-sigAdd\").dialog({\r\n\t\tautoOpen: false,\r\n\t\tresizable: false,\r\n\t\tminHeight: 150,\r\n\t\tdialogClass: \"dialog-noeffect\",\r\n\t\tbuttons: {\r\n\t\t\tAdd: function() {\r\n\t\t\t\t$(\"#sigAddForm\").submit();\r\n\t\t\t},\r\n\t\t\tCancel: function() {\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t}\r\n\t\t},\r\n\t\topen: function() {\r\n\t\t\t$(\"#sigAddForm #sigID\").val('');\r\n\t\t\t$(\"#sigAddForm #sigType\").val(\"Sites\").selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t$(\"#sigAddForm #sigLife\").val(72).selectmenu(\"refresh\");\r\n\t\t\t$(\"#sigAddForm #sigName\").val('');\r\n\t\t\t$(\"#sigAddForm #whType\").val('');\r\n\t\t\t$(\"#sigAddForm #connection\").val('');\r\n\t\t\t$(\"#sigAddForm #autoAdd\")[0].checked = false;\r\n\t\t\t$(\"#sigAddForm #autoAdd\").button(\"refresh\");\r\n\t\t\t$(\"#sigAddForm #whLife\").val(\"Stable\").selectmenu(\"refresh\");\r\n\t\t\t$(\"#sigAddForm #whMass\").val(\"Stable\").selectmenu(\"refresh\");\r\n\r\n\t\t\tif (tripwire.client.EVE && tripwire.client.EVE.systemName) {\r\n\t\t\t\t$(\"#autoAdd\").button(\"enable\");\r\n\t\t\t} else {\r\n\t\t\t\t$(\"#autoAdd\").button(\"disable\");\r\n\t\t\t}\r\n\t\t},\r\n\t\tclose: function() {\r\n\t\t\t$(\"th.critical\").removeClass(\"critical\");\r\n\t\t\tValidationTooltips.close();\r\n\t\t},\r\n\t\tcreate: function() {\r\n\t\t\t$(\"#autoAdd\").button().click(function() {\r\n\t\t\t\t$(\"#sigAddForm #connection\").val(tripwire.client.EVE.systemName);\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#sigAddForm #sigType, #sigAddForm #sigLife\").selectmenu({width: 100});\r\n\t\t\t$(\"#sigAddForm #whLife, #sigAddForm #whMass\").selectmenu({width: 80});\r\n\t\t\t$(\"#sigAddForm .sigSystemsAutocomplete\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0});\r\n\t\t\t$(\"#sigAddForm .typesAutocomplete\").inlinecomplete({source: whList, maxSize: 10, delay: 0});\r\n\r\n\t\t\t$(\"#sigAddForm #whType, #sigAddForm #sigID\").blur(function(e) {\r\n\t\t\t\tif (this.value == \"\") {\r\n\t\t\t\t\tthis.value = \"???\";\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#sigAddForm #whType, #sigAddForm #sigID\").focus(function(e) {\r\n\t\t\t\t$(this).select();\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\t$(\"#dialog-sigAdd\").dialog(\"open\");\r\n});\r\n\r\n$(\"#sigAddForm\").submit(function(e) {\r\n\te.preventDefault();\r\n\r\n\t// Trim ending whitespace\r\n\t$(\"#sigAddForm #connection\").val($(\"#sigAddForm #connection\").val().trim());\r\n\r\n\t$(\"th.critical\").removeClass(\"critical\");\r\n\tValidationTooltips.close();\r\n\r\n\t// Check for !empty and length == 3\r\n\tif ($(\"#sigAddForm #sigID\").val() == '' || $(\"#sigAddForm #sigID\").val().length !== 3) {\r\n\t\t$(\"#sigAddForm #sigID\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\tValidationTooltips.open({target: $(\"#sigAddForm #sigID\")}).setContent(\"Must be 3 Letters in length!\");\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Check for letters only\r\n\tif ($(\"#sigAddForm #sigID\").val() !== \"???\") {\r\n\t\tvar i = $(\"#sigAddForm #sigID\").val().length;\r\n\t\twhile (i--) {\r\n\t\t\tif ($(\"#sigAddForm #sigID\").val()[i].toLowerCase() === $(\"#sigAddForm #sigID\").val()[i].toUpperCase()) {\r\n\t\t\t\t$(\"#sigAddForm #sigID\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\t\t\tValidationTooltips.open({target: $(\"#sigAddForm #sigID\")}).setContent(\"Must be only letters!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Check for existing ID\r\n\t\tif ($.map(tripwire.client.signatures, function(sig) {return sig.mask == \"273.0\" && ((options.chain.active != null && !options.chain.tabs[options.chain.active].evescout) || options.chain.active == null) ? null : (viewingSystemID == sig.systemID ? sig.signatureID : sig.sig2ID)}).indexOf($(\"#sigAddForm #sigID\").val().toUpperCase()) !== -1) {\r\n\t\t\t$(\"#sigAddForm #sigID\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\t\tValidationTooltips.open({target: $(\"#sigAddForm #sigID\")}).setContent(\"Signature ID already exists!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\t// Check for !empty WH type\r\n\tif ($(\"#sigAddForm #sigType\").val() == \"Wormhole\" && $(\"#sigAddForm #whType\").val() == '') {\r\n\t\t$(\"#sigAddForm #whType\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\tValidationTooltips.open({target: $(\"#sigAddForm #whType\")}).setContent(\"Must specify a wormhole type!\");\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Check for valid WH type\r\n\tif ($(\"#sigAddForm #sigType\").val() == \"Wormhole\" && whList.indexOf($(\"#sigAddForm #whType\").val()) == -1) {\r\n\t\t$(\"#sigAddForm #whType\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\tValidationTooltips.open({target: $(\"#sigAddForm #whType\")}).setContent(\"Not a valid wormhole type!\");\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Check for valid Leads To\r\n\tif ($(\"#sigAddForm #sigType\").val() == \"Wormhole\" && $(\"#sigAddForm #connection\").val() && tripwire.aSigSystems.indexOf($(\"#sigAddForm #connection\").val()) == -1) {\r\n\t\t$(\"#sigAddForm #connection\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\tValidationTooltips.open({target: $(\"#sigAddForm #connection\")}).setContent(\"Not a valid leads to system!\");\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar form = $(this).serializeObject();\r\n\tform.systemID = viewingSystemID;\r\n\tform.lifeLength = tripwire.wormholes[form.whType] ? tripwire.wormholes[form.whType].life.split(\" \")[0] : 72;\r\n\tform.class = sigClass(viewingSystem, form.whType);\r\n\tif (Object.index(tripwire.systems, \"name\", form.connectionName)) {\r\n\t\tform.connectionID = Object.index(tripwire.systems, \"name\", form.connectionName);\r\n\t\tform.class2 = sigClass(form.connectionName, null);\r\n\t\tform.connectionName = null;\r\n\t}\r\n\r\n\tvar data = {\"request\": {\"signatures\": {\"add\": form}}};\r\n\r\n\t// Prevent duplicate submitting\r\n\t$(\"#sigAddForm input[type=submit]\").attr(\"disabled\", true);\r\n\t$(\"#dialog-sigAdd\").parent().find(\":button:contains('Add')\").button(\"disable\");\r\n\r\n\tvar success = function(data) {\r\n\t\tif (data.result == true) {\r\n\t\t\t$(\"#dialog-sigAdd\").dialog(\"close\");\r\n\r\n\t\t\t$(\"#undo\").removeClass(\"disabled\");\r\n\t\t\tvar undo = $.map(data.resultSet, function(id) { return data.signatures[id] });\r\n\t\t\tif (viewingSystemID in tripwire.signatures.undo) {\r\n\t\t\t\ttripwire.signatures.undo[viewingSystemID].push({action: \"add\", signatures: undo});\r\n\t\t\t} else {\r\n\t\t\t\ttripwire.signatures.undo[viewingSystemID] = [{action: \"add\", signatures: undo}];\r\n\t\t\t}\r\n\r\n\t\t\tsessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n\t\t}\r\n\t}\r\n\r\n\tvar always = function(data) {\r\n\t\t$(\"#sigAddForm input[type=submit]\").removeAttr(\"disabled\");\r\n\t\t$(\"#dialog-sigAdd\").parent().find(\":button:contains('Add')\").button(\"enable\");\r\n\t}\r\n\r\n\ttripwire.refresh('refresh', data, success, always);\r\n});\r\n","$(\"#sigTable\").on(\"click\", \".sigDelete\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).closest(\"tr\").attr(\"disabled\")) {\r\n\t\treturn false;\r\n\t} else if ($(\"#dialog-sigEdit\").hasClass(\"ui-dialog-content\") && $(\"#dialog-sigEdit\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-sigEdit\").parent().effect(\"shake\", 300);\r\n\t\treturn false;\r\n\t}\r\n\r\n\t$(this).closest(\"tr\").addClass(\"selected\");\r\n\t//$(this).addClass(\"invisible\");\r\n\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-deleteSig\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-deleteSig\").dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tDelete: function() {\r\n\t\t\t\t\t// Prevent duplicate submitting\r\n\t\t\t\t\t$(\"#dialog-deleteSig\").parent().find(\":button:contains('Delete')\").button(\"disable\");\r\n\r\n\t\t\t\t\tvar ids = $.map($(\"#sigTable tr.selected\"), function(n) { return $(n).data(\"id\"); });\r\n\t\t\t\t\tvar data = {\"request\": {\"signatures\": {\"delete\": ids}}, \"systemID\": viewingSystemID};\r\n\t\t\t\t\tvar undo = $.map(ids, function(id) { return tripwire.client.signatures[id] });\r\n\r\n\t\t\t\t\tvar success = function(data) {\r\n\t\t\t\t\t\tif (data && data.result == true) {\r\n\t\t\t\t\t\t\t$(\"#dialog-deleteSig\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t$(\"#undo\").removeClass(\"disabled\");\r\n\t\t\t\t\t\t\tif (viewingSystemID in tripwire.signatures.undo) {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[viewingSystemID].push({action: \"delete\", signatures: undo});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[viewingSystemID] = [{action: \"delete\", signatures: undo}];\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tsessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar always = function(data) {\r\n\t\t\t\t\t\t$(\"#dialog-deleteSig\").parent().find(\":button:contains('Delete')\").button(\"enable\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttripwire.refresh('refresh', data, success, always);\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\t$(\"#sigTable tr.selected\").removeClass(\"selected\");\r\n\t\t\t\t//$(\"#sigTable .sigDelete\").removeClass(\"invisible\");\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-deleteSig\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-deleteSig\").dialog(\"open\");\r\n\t}\r\n});\r\n","$(\"#add-signature2\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif (!$(\"#dialog-signature\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-signature\").dialog({\r\n\t\t\tautoOpen: true,\r\n\t\t\tresizable: false,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tposition: {my: \"center\", at: \"center\", of: $(\"#signaturesWidget\")},\r\n\t\t\tbuttons: {\r\n\t\t\t\tAdd: function() {\r\n\t\t\t\t\t$(\"#form-signature\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\tvar aSigWormholes = $.map(tripwire.wormholes, function(item, index) { return index;});\r\n\t\t\t\taSigWormholes.splice(26, 0, \"K162\");\r\n\t\t\t\taSigWormholes.push(\"GATE\");\r\n\r\n\t\t\t\t$(\"#dialog-signature [name='signatureType'], #dialog-signature [name='signatureLife']\").selectmenu({width: 100});\r\n\t\t\t\t$(\"#dialog-signature [name='wormholeLife'], #dialog-signature [name='wormholeMass']\").selectmenu({width: 80});\r\n\t\t\t\t$(\"#dialog-signature [data-autocomplete='sigSystems']\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0});\r\n\t\t\t\t$(\"#dialog-signature [data-autocomplete='sigType']\").inlinecomplete({source: aSigWormholes, maxSize: 10, delay: 0});\r\n\r\n\t\t\t\t$(\"#dialog-signature #durationPicker\").durationPicker();\r\n\r\n\t\t\t\t// Ensure first signature ID field only accepts letters\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID_Alpha'], #dialog-signature [name='signatureID2_Alpha']\").on(\"input\", function() {\r\n\t\t\t\t\twhile (!/^[a-zA-Z?]*$/g.test(this.value)) {\r\n\t\t\t\t\t\tthis.value = this.value.substring(0, this.value.length -1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Ensure second signature ID field only accepts numbers\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID_Numeric'], #dialog-signature [name='signatureID2_Numeric']\").on(\"input\", function() {\r\n\t\t\t\t\twhile (!/^[0-9?]*$/g.test(this.value)) {\r\n\t\t\t\t\t\tthis.value = this.value.substring(0, this.value.length -1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Select value on click\r\n\t\t\t\t$(\"#dialog-signature .signatureID, #dialog-signature .wormholeType\").on(\"click\", function() {\r\n\t\t\t\t\t$(this).select();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Auto fill opposite side wormhole w/ K162\r\n\t\t\t\t$(\"#dialog-signature .wormholeType\").on(\"input, change\", function() {\r\n\t\t\t\t\tif ($(this).val().length > 0 && $.inArray($(this).val(), aSigWormholes) != -1 && $(this).val() != \"K162\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature .wormholeType\").not(this).val(\"K162\");\r\n\r\n\t\t\t\t\t\t// Also auto calculate duration\r\n\t\t\t\t\t\t$(\"#dialog-signature #durationPicker\").val(tripwire.wormholes[$(this).val()].life.substring(0, 2) * 60 * 60).change();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Toggle between wormhole and regular signatures\r\n\t\t\t\t$(\"#dialog-signature\").on(\"selectmenuchange\", \"[name='signatureType']\", function() {\r\n\t\t\t\t\tif (this.value == \"wormhole\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature #site\").slideUp(200, function() { $(this).hide(0); });\r\n\t\t\t\t\t\t$(\"#dialog-signature #wormhole\").slideDown(200, function() { $(this).show(200); });\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#dialog-signature #site\").slideDown(200, function() { $(this).show(200); });\r\n\t\t\t\t\t\t$(\"#dialog-signature #wormhole\").slideUp(200, function() { $(this).hide(0); });\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tValidationTooltips.close();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#form-signature\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar form = $(this).serializeObject();\r\n\t\t\t\t\tvar valid = true;\r\n\t\t\t\t\tValidationTooltips.close();\r\n\r\n\t\t\t\t\t// Validate full signature ID fields (blank | 3 characters)\r\n\t\t\t\t\t$.each($(\"#dialog-signature .signatureID:visible\"), function() {\r\n\t\t\t\t\t\tif ($(this).val().length > 0 && $(this).val().length < 3) {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Must be 3 characters in length!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate life length (> 5 minutes)\r\n\t\t\t\t\tif (isNaN(parseInt($(\"#dialog-signature #durationPicker\").val())) || !(parseInt($(\"#dialog-signature #durationPicker\").val()) >= 300)) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-signature #durationPicker + .bdp-input\")}).setContent(\"Must be at least 5 minutes!\");\r\n\t\t\t\t\t\t$(\"#dialog-signature #durationPicker\").select();\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Validate wormhole types (blank | wormhole)\r\n\t\t\t\t\t$.each($(\"#dialog-signature .wormholeType:visible\"), function() {\r\n\t\t\t\t\t\tif ($(this).val().length > 0 && $.inArray($(this).val(), aSigWormholes) == -1) {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Must be a valid wormhole type!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate first leads to (system)\r\n\t\t\t\t\tif ($(\"#dialog-signature .leadsTo:visible\")[0] && $.inArray($(\"#dialog-signature .leadsTo:visible:first\").val(), tripwire.aSigSystems) == -1) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-signature .leadsTo:visible:first\")}).setContent(\"Must be a valid leads to system!\");\r\n\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Validate leads to system (blank | system)\r\n\t\t\t\t\t$.each($(\"#dialog-signature .leadsTo:visible\"), function() {\r\n\t\t\t\t\t\tif ($(this).val().length > 0 && $.inArray($(this).val(), tripwire.aSigSystems) == -1) {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Must be a valid leads to system!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\tconsole.log(form);\r\n\r\n\t\t\t\t\tvar payload = {};\r\n\t\t\t\t\tif (form.signatureType === \"wormhole\") {\r\n\t\t\t\t\t\tvar signature = {\r\n\t\t\t\t\t\t\t\"signatureID\": form.signatureID_Alpha + form.signatureID_Numeric,\r\n\t\t\t\t\t\t\t\"systemID\": viewingSystemID,\r\n\t\t\t\t\t\t\t\"type\": \"wormhole\",\r\n\t\t\t\t\t\t\t\"name\": form.wormholeName\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tvar signature2 = {\r\n\t\t\t\t\t\t\t\"signatureID\": form.signatureID2_Alpha + form.signatureID2_Numeric,\r\n\t\t\t\t\t\t\t\"systemID\": Object.index(tripwire.systems, \"name\", form.leadsTo) ? Object.index(tripwire.systems, \"name\", form.leadsTo) : $.inArray(form.leadsTo, tripwire.aSigSystems),\r\n\t\t\t\t\t\t\t\"type\": \"wormhole\",\r\n\t\t\t\t\t\t\t\"name\": form.wormholeName2\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tvar wormhole = {\r\n\t\t\t\t\t\t\t// \"type\": $.inArray(form.wormholeType, tripwire.wormholes) !== -1 ? form.wormholeType : ($.inArray(form.wormholeType2, tripwire.wormholes) !== -1 ? form.wormholeType2 : \"\"),\r\n\t\t\t\t\t\t\t\"type\": tripwire.wormholes[form.wormholeType] ? form.wormholeType : (tripwire.wormholes[form.wormholeType2] ? form.wormholeType2 : \"\"),\r\n\t\t\t\t\t\t\t\"life\": form.wormholeLife,\r\n\t\t\t\t\t\t\t\"mass\": form.wormholeMass\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tpayload = {\"wormholes\": {\"add\": [{\"wormhole\": wormhole, \"signatures\": [signature, signature2]}]}};\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar signature = {\r\n\t\t\t\t\t\t\t\"signatureID\": form.signatureID_Alpha + form.signatureID_Numeric,\r\n\t\t\t\t\t\t\t\"systemID\": viewingSystemID,\r\n\t\t\t\t\t\t\t\"type\": form.signatureType,\r\n\t\t\t\t\t\t\t\"name\": form.signatureName\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tpayload = {\"signatures\": {\"add\": [signature]}};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: \"signatures2.php\",\r\n\t\t\t\t\t\tmethod: \"POST\",\r\n\t\t\t\t\t\tdata: payload,\r\n\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t}).done(function(result) {\r\n\t\t\t\t\t\tconsole.log(result);\r\n\t\t\t\t\t}).always(function(result) {\r\n\t\t\t\t\t\t// console.log(result);\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$(\"#dialog-signature input\").val(\"\");\r\n\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(\"combat\").selectmenu(\"refresh\");\r\n\r\n\t\t\t\t$(\"#dialog-signature #site\").show();\r\n\t\t\t\t$(\"#dialog-signature #wormhole\").hide();\r\n\r\n\t\t\t\t// Side labels\r\n\t\t\t\t$(\"#dialog-signature .sideLabel:first\").html(viewingSystem + \" Side\");\r\n\t\t\t\t$(\"#dialog-signature .sideLabel:last\").html(\"Other Side\");\r\n\r\n\t\t\t\t// Default signature life\r\n\t\t\t\t$(\"#dialog-signature #durationPicker\").val(options.signatures.pasteLife * 60 * 60).change();\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tValidationTooltips.close();\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-signature\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-signature\").dialog(\"open\");\r\n\t}\r\n});\r\n","function openSigEdit(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).closest(\"tr\").attr(\"disabled\")) {\r\n\t\treturn false;\r\n\t} else if ($(\"#dialog-deleteSig\").hasClass(\"ui-dialog-content\") && $(\"#dialog-deleteSig\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-deleteSig\").parent().effect(\"shake\", 300);\r\n\t\treturn false;\r\n\t} else if ($(\"#dialog-sigEdit\").hasClass(\"ui-dialog-content\") && $(\"#dialog-sigEdit\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-sigEdit\").parent().effect(\"shake\", 300);\r\n\t\treturn false;\r\n\t}\r\n\r\n\t$(this).closest(\"tr\").addClass(\"selected\");\r\n\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-sigEdit\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-sigEdit\").dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 150,\r\n\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tSave: function() {\r\n\t\t\t\t\t$(\"#sigEditForm\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\tvar id = $(\"#sigTable tr.selected\").data(\"id\");\r\n\t\t\t\t$(\"#sigEditForm\").data(\"id\", id);\r\n\t\t\t\tvar sig = tripwire.client.signatures[id];\r\n\t\t\t\ttripwire.activity.editSig = id;\r\n\t\t\t\ttripwire.refresh('refresh');\r\n\r\n\t\t\t\t$(\"#autoEdit\")[0].checked = false;\r\n\t\t\t\t$(\"#autoEdit\").button(\"refresh\");\r\n\r\n\t\t\t\t// First check if it is a WH\r\n\t\t\t\tif (sig.life || sig.mass) {\r\n\t\t\t\t\t// Check which side we are editing\r\n\t\t\t\t\tif (sig.systemID == viewingSystemID) {\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #sigID\").val(sig.signatureID);\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #sigType\").val(\"Wormhole\").selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #whType\").val(sig.type);\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #connection\").val(tripwire.systems[sig.connectionID] ? tripwire.systems[sig.connectionID].name : sig.connection);\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #whLife\").val(sig.life).selectmenu(\"refresh\");\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #whMass\").val(sig.mass).selectmenu(\"refresh\");\r\n\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit [name=side]\").val(\"parent\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #sigID\").val(sig.sig2ID);\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #sigType\").val(\"Wormhole\").selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #whType\").val(sig.sig2Type);\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #connection\").val(tripwire.systems[sig.systemID] ? tripwire.systems[sig.systemID].name : sig.system);\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #whLife\").val(sig.life).selectmenu(\"refresh\");\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #whMass\").val(sig.mass).selectmenu(\"refresh\");\r\n\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit [name=side]\").val(\"child\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$(\"#dialog-sigEdit #sigLife\").val(72).selectmenu(\"refresh\");\r\n\t\t\t\t\t$(\"#dialog-sigEdit #sigName\").val(\"\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Its not a WH\r\n\t\t\t\t\t$(\"#dialog-sigEdit #sigID\").val(sig.signatureID);//.attr(\"name\", \"signatureID\");\r\n\t\t\t\t\t$(\"#dialog-sigEdit #sigType\").val(sig.type == \"???\" ? \"Sites\" : sig.type).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t$(\"#dialog-sigEdit #sigLife\").val(sig.lifeLength).selectmenu(\"refresh\");\r\n\t\t\t\t\t$(\"#dialog-sigEdit #sigName\").val(sig.name);\r\n\r\n\t\t\t\t\t$(\"#dialog-sigEdit #whType\").val(\"\");\r\n\t\t\t\t\t$(\"#dialog-sigEdit #connection\").val(\"\");\r\n\t\t\t\t\t$(\"#dialog-sigEdit #whLife\").val(\"Stable\").selectmenu(\"refresh\");\r\n\t\t\t\t\t$(\"#dialog-sigEdit #whMass\").val(\"Stable\").selectmenu(\"refresh\");\r\n\r\n\t\t\t\t\t$(\"#dialog-sigEdit [name=side]\").val(\"parent\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (tripwire.client.EVE && tripwire.client.EVE.systemName) {\r\n\t\t\t\t\t$(\"#autoEdit\").button(\"enable\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#autoEdit\").button(\"disable\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Auto select ID field\r\n\t\t\t\t$(\"#dialog-sigEdit #sigID\").select();\r\n\t\t\t},\r\n\t\t\tclose: function(e, ui) {\r\n\t\t\t\tdelete tripwire.activity.editSig;\r\n\t\t\t\ttripwire.refresh('refresh');\r\n\r\n\t\t\t\t$(this).data(\"id\", \"\");\r\n\r\n\t\t\t\t$(\"th.critical\").removeClass(\"critical\");\r\n\t\t\t\tValidationTooltips.close();\r\n\r\n\t\t\t\t$(\"#sigTable tr.selected\").removeClass(\"selected\");\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t$(\"#autoEdit\").button().click(function() {\r\n\t\t\t\t\t$(\"#sigEditForm #connection\").val(tripwire.client.EVE.systemName);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#sigEditForm #sigType, #sigEditForm #sigLife\").selectmenu({width: 100});\r\n\t\t\t\t$(\"#sigEditForm #whLife, #sigEditForm #whMass\").selectmenu({width: 80});\r\n\t\t\t\t$(\"#sigEditForm .sigSystemsAutocomplete\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0});\r\n\t\t\t\t$(\"#sigEditForm .typesAutocomplete\").inlinecomplete({source: whList, maxSize: 10, delay: 0});\r\n\r\n\t\t\t\t$(\"#sigEditForm #whType, #sigEditForm #sigID\").blur(function(e) {\r\n\t\t\t\t\tif (this.value == \"\") {\r\n\t\t\t\t\t\tthis.value = \"???\";\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#sigEditForm #whType, #sigEditForm #sigID\").focus(function(e) {\r\n\t\t\t\t\t$(this).select();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-sigEdit\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-sigEdit\").dialog(\"open\");\r\n\t}\r\n}\r\n\r\n$(\"#sigTable\").on(\"click\", \".sigEdit\", openSigEdit);\r\n$(\"#sigTable tbody\").on(\"dblclick\", \"tr\", openSigEdit);\r\n\r\n$(\"#sigEditForm\").submit(function(e) {\r\n\te.preventDefault();\r\n\r\n\t// Trim ending whitespace\r\n\t$(\"#sigEditForm #connection\").val($(\"#sigEditForm #connection\").val().trim());\r\n\r\n\t$(\"th.critical\").removeClass(\"critical\");\r\n\tValidationTooltips.close();\r\n\r\n\t// Check for !empty and length == 3\r\n\tif ($(\"#sigEditForm #sigID\").val() == '' || $(\"#sigEditForm #sigID\").val().length !== 3) {\r\n\t\t$(\"#sigEditForm #sigID\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\tValidationTooltips.open({target: $(\"#sigEditForm #sigID\")}).setContent(\"Must be 3 letters in length!\");\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Check for letters only\r\n\tif ($(\"#sigEditForm #sigID\").val() !== \"???\") {\r\n\t\tvar i = $(\"#sigEditForm #sigID\").val().length;\r\n\t\twhile (i--) {\r\n\t\t\tif ($(\"#sigEditForm #sigID\").val()[i].toLowerCase() === $(\"#sigEditForm #sigID\").val()[i].toUpperCase()) {\r\n\t\t\t\t$(\"#sigEditForm #sigID\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\t\t\tValidationTooltips.open({target: $(\"#sigEditForm #sigID\")}).setContent(\"Must be only letters!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Check for existing ID\r\n\t\tif ($(\"#sigEditForm #sigID\").val().toUpperCase() !== (viewingSystemID == tripwire.client.signatures[$(this).data(\"id\")].systemID ? tripwire.client.signatures[$(this).data(\"id\")].signatureID : tripwire.client.signatures[$(this).data(\"id\")].sig2ID) && $.map(tripwire.client.signatures, function(sig) {return sig.mask == \"273.0\" && ((options.chain.active != null && !options.chain.tabs[options.chain.active].evescout) || options.chain.active == null) ? null : (viewingSystemID == sig.systemID ? sig.signatureID : sig.sig2ID)}).indexOf($(\"#sigEditForm #sigID\").val().toUpperCase()) !== -1) {\r\n\t\t\t$(\"#sigEditForm #sigID\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\t\tValidationTooltips.open({target: $(\"#sigEditForm #sigID\")}).setContent(\"Signature ID already exists! <input type='button' autofocus='true' id='overwrite' value='Overwrite' style='margin-bottom: -4px; margin-top: -4px; font-size: 0.8em;' data-id='\"+ $(\"#sigTable tr:has(td:first-child:contains(\"+$(\"#sigEditForm #sigID\").val().toUpperCase()+\"))\").data(\"id\") +\"' />\");\r\n\t\t\t$(\"#overwrite\").focus();\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\t// Check for empty WH type\r\n\tif ($(\"#sigEditForm #sigType\").val() == \"Wormhole\" && $(\"#sigEditForm #whType\").val() == '') {\r\n\t\t$(\"#sigEditForm #whType\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\tValidationTooltips.open({target: $(\"#sigEditForm #whType\")}).setContent(\"Must specify a wormhole type!\");\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Check for valid WH type\r\n\tif ($(\"#sigEditForm #sigType\").val() == \"Wormhole\" && whList.indexOf($(\"#sigEditForm #whType\").val()) == -1) {\r\n\t\t$(\"#sigEditForm #whType\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\tValidationTooltips.open({target: $(\"#sigEditForm #whType\")}).setContent(\"Not a valid wormhole type!\");\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Check for valid Leads To\r\n\tif ($(\"#sigEditForm #sigType\").val() == \"Wormhole\" && $(\"#sigEditForm #connection\").val() && tripwire.aSigSystems.indexOf($(\"#sigEditForm #connection\").val()) == -1) {\r\n\t\t$(\"#sigEditForm #connection\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\tValidationTooltips.open({target: $(\"#sigEditForm #connection\")}).setContent(\"Not a valid leads to system!\");\r\n\t\treturn;\r\n\t}\r\n\r\n\r\n\tvar form = $(this).serializeObject();\r\n\tform.id = $(this).data(\"id\");\r\n\tform.systemID = viewingSystemID; // needed??\r\n\r\n\tif (tripwire.wormholes[form.whType]) {\r\n\t\tform.lifeLength = tripwire.wormholes[form.whType].life.split(\" \")[0];\r\n\t} else if (form.side == \"parent\") {\r\n\t\tform.lifeLength = tripwire.wormholes[tripwire.client.signatures[form.id].sig2Type] ? tripwire.wormholes[tripwire.client.signatures[form.id].sig2Type].life.split(\" \")[0] : form.lifeLength;\r\n\t} else {\r\n\t\tform.lifeLength = tripwire.wormholes[tripwire.client.signatures[form.id].type] ? tripwire.wormholes[tripwire.client.signatures[form.id].type].life.split(\" \")[0] : form.lifeLength;\r\n\t}\r\n\r\n\tform.connectionID = form.connectionName ? Object.index(tripwire.systems, \"name\", form.connectionName) || null : null;\r\n\tform.connectionName = form.connectionID ? (form.side == \"parent\" ? (tripwire.client.signatures[form.id].connectionID > 0 ? tripwire.client.signatures[form.id].connection : null) : (tripwire.client.signatures[form.id].systemID > 0 ? tripwire.client.signatures[form.id].system : null)) : form.connectionName;\r\n\t//form.connectionName = tripwire.systems[form.connectionID] ? (form.side == \"parent\" ? tripwire.client.signatures[form.id].connection : tripwire.client.signatures[form.id].system) || null : form.connectionName;\r\n\tform.whLife = tripwire.client.signatures[form.id].life != form.whLife ? form.whLife : null;\r\n\tform.whLife = !tripwire.client.signatures[form.id].life ? \"New \" + form.whLife : form.whLife;\r\n\tform.sig2ID = form.side == \"parent\" ? tripwire.client.signatures[form.id].sig2ID : tripwire.client.signatures[form.id].signatureID;\r\n\tform.sig2Type = form.side == \"parent\" ? tripwire.client.signatures[form.id].sig2Type : tripwire.client.signatures[form.id].type;\r\n\tform.class = sigClass(viewingSystem, form.sig2Type);\r\n\tform.class2 = sigClass(form.connectionID ? tripwire.systems[form.connectionID].name : null, form.whType);\r\n\tvar data = {\"request\": {\"signatures\": {\"update\": form}}};\r\n\tvar undo = [tripwire.client.signatures[form.id]];\r\n\r\n\t// Prevent duplicate submitting\r\n\t$(\"#sigEditForm input[type=submit]\").attr(\"disabled\", true);\r\n\t$(\"#dialog-sigEdit\").parent().find(\":button:contains('Save')\").button(\"disable\");\r\n\r\n\tvar success = function(data) {\r\n\t\tif (data.result == true) {\r\n\t\t\t$(\"#dialog-sigEdit\").dialog(\"close\");\r\n\r\n\t\t\t$(\"#undo\").removeClass(\"disabled\");\r\n\t\t\tif (viewingSystemID in tripwire.signatures.undo) {\r\n\t\t\t\ttripwire.signatures.undo[viewingSystemID].push({action: \"update\", signatures: undo});\r\n\t\t\t} else {\r\n\t\t\t\ttripwire.signatures.undo[viewingSystemID] = [{action: \"update\", signatures: undo}];\r\n\t\t\t}\r\n\r\n\t\t\tsessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n\t\t}\r\n\t}\r\n\r\n\tvar always = function(data) {\r\n\t\t$(\"#sigEditForm input[type=submit]\").removeAttr(\"disabled\");\r\n\t\t$(\"#dialog-sigEdit\").parent().find(\":button:contains('Save')\").button(\"enable\");\r\n\t}\r\n\r\n\ttripwire.refresh('refresh', data, success, always);\r\n});\r\n"]}