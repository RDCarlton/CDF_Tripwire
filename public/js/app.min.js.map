{"version":3,"sources":["helpers.js","init.js","options.js","layout.js","tripwire.js","global-hooks.js","guidance.js","chain-map-renderer-orgchart.js","chain-map-renderer-radial.js","chain-map.js","active.js","addSignature.js","api.js","automapper.js","comments.js","deleteSignature.js","editSignature.js","esi.js","eve.js","parse.js","paste.js","redo.js","serverStatus.js","sync.js","systemChange.js","tutorials.js","undo.js","activity-graph.js","ckeditor.js","dialogs/admin-dialog.js","dialogs/base-dialog.js","dialogs/options-dialog.js","dialogs/signature-delete-dialog.js","dialogs/signature-dialog.js"],"names":["Object","sort","obj","prop","swapped","prev","i","Number","tmp","index","val","cs","key","toLowerCase","find","maxTime","maxTimeString","Date","size","hasOwnProperty","time","dates","push","length","getTime","$","fn","serializeObject","self","this","json","push_counters","patterns","validate","fixed","named","build","base","value","push_counter","undefined","each","serializeArray","test","name","k","keys","match","merge","reverse_key","pop","replace","RegExp","extend","jQuery","numFormat","num","n","toString","split","join","letterToNumbers","string","toUpperCase","letters","sum","Math","pow","indexOf","substr","sigFormat","input","type","alpha","numeric","format","options","chain","typeFormat","classFormat","x","l","sigClass","id","map","tripwire","systems","system","class","security","systemType","wormholes","leadsTo","isEmpty","positionRelativeTo","elem","ancestor","elemPos","getBoundingClientRect","ancestorPos","left","scrollLeft","top","scrollTop","lookupMultiple","propertyName","lookupString","suppress","values","results","v","r","lookupByPropertyMultiple","getCookie","c_name","c_value","document","cookie","c_start","c_end","unescape","substring","setCookie","exdays","exdate","setDate","getDate","escape","toUTCString","location","protocol","originalAddClassMethod","addClass","originalRemoveClassMethod","removeClass","className","result","apply","arguments","trigger","parseHeaders","headers","arr","trim","headerMap","forEach","line","parts","header","shift","viewingSystem","attr","viewingSystemID","server","app_name","version","html","saveTimer","localOverrides","localOptions","JSON","parse","localStorage","getItem","userID","init","character","characterID","characterName","background","uiscale","favorites","grid","tracking","active","masks","corporationID","gridlines","tabs","node-reference","zoom","sigNameLocation","routingLimit","routeSecurity","routeIgnore","enabled","renderer","signatures","editType","copySeparator","pasteLife","alignment","sigID","sigType","sigAge","sigLife","sigMass","buttons","follow","chainWidget","viewing","signaturesWidget","autoMapper","saveDelay","delay","clearTimeout","setTimeout","save","stringify","window","get","setItem","ajax","url","data","mode","dataType","load","set","local","constructor","reset","defaults","oog","data-col","col","data-row","row","data-sizex","size_x","data-sizey","size_y","css","width","height","favorite","parseInt","home","kspace","evescout","inArray","a","href","hostname","pathname","search","filter","$tab","clone","systemID","append","redraw","gridster","widget_selector","avoid_overlapped_widgets","widget_base_dimensions","widget_margins","autogrow_cols","helper","draggable","start","e","ui","resize","handle_class","max_size","min_size","stop","$widget","serialize_params","$w","wgd","disable","disable_resize","visibility","click","hasClass","serialize","enable","enable_resize","timer","xhr","client","list","undo","sessionStorage","redo","serverSignatureCount","activity","esi","refreshRate","connected","ageFormat","instance","sync","setAgeFormat","countdown","serverTime","chainMap","draw","pastEOL","since","layout","whTooltip","sig","item","tooltip","sig2Type","whType","life","mass","jump","ageTooltip","date","lifeTime","getMonth","getHours","getMinutes","createdByName","modifiedTime","modifiedByName","refresh","successCallback","alwaysCallback","on","preventDefault","systemChange","parseFloat","originalEvent","wheelDelta","fadeIn","timeout","keydown","activeElement","is","metaKey","ctrlKey","keyCode","getSelection","output","signature","signatureID","wormhole","initialID","secondaryID","otherSignature","aSigSystems","lifeLength","lifeLeft","text","focus","select","Notify","splice","toggle","EVE","systemName","show","hide","characters","removeAttr","remove","isArray","delete","esiDelete","display","stopPropagation","content","color","stick","jBox","offset","y","animation","autoClose","ValidationTooltips","fade","Tooltips","attach","getContent","position","outside","SystemActivityToolTips","appendTo","reposition","repositionOnOpen","createOnInit","onOpen","targetPos","target","getElementById","tooltipWidth","source","closest","container","parent","offsetHeight","WormholeRouteToolTips","WormholeTypeToolTips","adjustDistance","responsiveWidth","OccupiedToolTips","pointer","minWidth","repositionOnContent","offsetWidth","setContent","cache","done","occupants","chars","b","shipTypeName","linkSig","sigName","sortable","items","axis","tolerance","containment","update","newTabs","dialog","Remove Tab","Cancel","resizable","minHeight","dialogClass","OK","submit","open","close","create","inlinecomplete","maxSize","thera","checked","eq","contextmenu","delegate","menu","event","my","at","of","children","colName","cmd","beforeOpen","effect","duration","nodeElem","showInfo","setDestination","collapsed","collapse","wormholeID","autoOpen","Close","payload","totalMass","toID","shipType","moogle","prototype","setFlare","flare","flares","removeFlare","widget","autocomplete","_create","element","_selectInit","_super","_value","originalReturn","_superApply","change","_suggest","_initSource","request","response","matcher","escapeRegex","term","Array","_close","input_source","addToSelect","select_added_value","select_source","unshift","removeFromSelect","wrapper","toArray","_createShowAllButton","that","wasOpen","button","icons","primary","_search","tablesorter","sortReset","widgets","textExtraction","2","node","toggleClass","shiftKey","nextUntil","addBack","add","Ok","easing","guidance","extractKeys","call","sorter","adjustCostForOptions","mapCost","findPaths","end","infinity","Infinity","costs","0","predecessors","addToOpen","cost","vertex","bucket","currentCost","adjacentNodes","totalCost","vertexCost","extractShortest","nodes","u","predecessor","reverse","findShortestPath","shortest","path","concat","slice","Guidance","ChainMapRendererOrgchart","owner","_this","google","visualization","OrgChart","allowHtml","allowCollapse","nodeClass","events","addListener","collapseHandler","DataView","DataTable","cols","label","ready","drawing","switchTo","style","charts","setOnLoadCallback","switchFrom","lines","newView","s","nodeId","nodeVal","updateLines","drawNodeLine","addModes","jquerySelector","prefixes","doModeClasses","c","removeModes","classFunc","prefix","$node","nodeIndex","ceil","cellIndex","$connector","$parent","nodeCol","connectorCell","colSpan","parentIndex","newparentIndex","checkSystem","rows","$connecte","me","tempCol","breaker","skip","lastLineData","getCollapsedNodes","collapsedSystems","updateCollapsed","ChainMapRendererRadial","newDiv","createElement","appendChild","div","parentNode","removeChild","mapData","drawInner","CIRCLE_SIZE","first_ring_delta","ringX","ci","ringY","maps","nodesById","ri","inNode","mapNode","minArc","newMap","circles","arc","circle","connection","markup","f","mi","ni","mapDiv","innerHTML","innerContainer","firstChild","bounds","makeDivsForRing","PI","domNode","finalPositions","w","h","cx","cy","parentWidth","parentHeight","outerContainer","canvas","getElementsByTagName","ctx","getContext","scale","translate","maxCi","beginPath","ellipse","lineWidth","setLineDash","strokeStyle","propertyFromCssClass","stroke","reduce","moveTo","cp1","radToCartesian","radPosition","theta","cp2","bezierCurveTo","lineTo","dashed","minRad","maxRad","parentCollapsed","skipped","rads_per_arc","acc","rad_offset","alignment_delta","frag","createRange","createContextualFragment","dblclick","dr","rad_centre","excess","nextBounds","rad","sin","cos","property","cssText","body","getComputedStyle","getPropertyValue","view","renderers","orgChart","radial","useRenderer","elements","querySelectorAll","getAttribute","shipJumps","podKills","shipKills","npcKills","getElementsByClassName","jumps","setAttribute","pods","ships","npcs","attachedElements","detach","occupied","count","next","max","frigTypes","connections","topLevel","tab","makeSystemNode","whId","inSigId","nodeTypeMarkup","additionalClasses","leadsToPointer","nodeSecurity","getSystemType","effectClass","systemNameText","chainNode","statics","shortCodeMap","High-Sec","Low-Sec","Null-Sec","Class 1","Class 2","Class 3","Class 4","Class 5","Class 6","classMap","H","L","N","formatStatics","makeCalcChildNode","childID","targetSystem","child","calcNode","calculated","nth","findLinks","parentID","chainList","chainData","usedLinks","sig1","sig2","sig1Type","parentType","childType","floor","random","typeBM","classBM","sigIndex","chainLinks","regionID","systemsInChainMap","sigText","renderPath","modifiers","systemMarkup","appData","rawMap","drawRetryTimer","expires","universeJumps","status","getResponseHeader","system_id","ship_jumps","then","universeKills","pod_kills","ship_kills","npc_kills","editSigs","editComments","editSig","editComment","animate","backgroundColor","fadeOut","addSig","option","disabled","wh","tr","until","moment","utc","toDate","onExpiry","alwaysExpire","compact","serverSync","wrapInner","slideDown","$set","replaceWith","contents","API","indicator","APIrefresh","expire","periodsToSeconds","onTick","t","from","to","stationID","shipTypeID","initial","secondary","toClass","title","signature2","resultSet","empty","action","comments","modified","$comment","comment","err","message","sticky","commentID","before","created","deleteSig","slideUp","edit","locationTimer","shipTimer","onlineTimer","baseUrl","userAgent","navigator","isExpired","tokenExpire","subtract","isBefore","expired","param","token","accessToken","user_agent","locationDate","solar_system_id","stationName","shipID","shipName","station_id","stationLookup","always","reference","fail","getAllResponseHeaders","warning","console","log","ship","shipDate","ship_item_id","ship_name","ship_type_id","typeLookup","online","characterStatus","typeID","destinationID","clear_waypoints","beginning","destination_id","clear_other_waypoints","add_to_beginning","Authorization","X-User-Agent","targetID","target_id","eveStatus","idLookup","eveIDs","contentType","processData","characterLookup","eveID","async","corporationLookup","allianceLookup","searchString","categories","strict","fullLookup","promise","Deferred","category","characterData","corporation_id","corporationData","corporation","alliance_id","allianceData","alliance","resolve","$clone","characterChange","updateSignatureTable","mask","column","editing","sigEditing","signatureCount","pasteSignatures","processing","rowParse","scanner","columns","validScanGroups","validTypes","Gas Site","Data Site","Relic Site","Ore Site","Combat Site","Wormhole","Gasgebiet","Datengebiet","Reliktgebiet","Mineraliengebiet","Kampfgebiet","Wurmloch","Газовый район","Информационный район","Археологический район","Астероидный район","Боевой район","Червоточина","가스 사이트","데이터 사이트","유물 사이트","채광 사이트","전투 사이트","웜홀","scanGroup","parsePaste","paste","pasteIDs","removes","scan","clipboardData","getData","blur","lastIndex","redoItem","serverStatus","players","times","abort","signatureTime","flareCount","flareTime","last_modified","commentCount","commentTime","aSystems","wormholeInitialIDs","wormholeSecondaryIDs","notify","history","replaceState","effects","bad","whClass","modifier","abs","fi","factionID","factions","regions","tutorial","introJs","setOptions","showStepNumbers","steps","querySelector","intro","exitOnEsc","exitOnOverlayClick","skipLabel","onchange","_currentStep","previousMask","stepFunc","_options","setOption","exiting","exit","goToStep","off","onexit","undoItem","graph","span","role","calc","d","getValue","sourceColumn","setColumns","selectHandler","selections","AreaChart","isStacked","hAxis","textStyle","fontName","fontSize","showTextEvery","vAxis","viewWindowMode","viewWindow","min","maxValue","gridlineColor","pointSize","chartArea","legend","showColorCode","annotations","domain","focusTarget","CKConfig","skin","allowedContent","extraPlugins","enterMode","CKEDITOR","ENTER_BR","removeDialogTabs","autoGrow_onStartup","autoGrow_minHeight","toolbar_minToolbar","toolbar_maxToolbar","toolbar","smallToolbar","maximizedToolbar","fontSize_style","styles","font-size","overrides","attributes","cke","editor","domEvent","altKey","selected_ranges","getRanges","startContainer","parents","getParents","getFirst","getNext","selectElement","selectRanges","ev","definition","getContents","removeAllRanges","$this","instances","modifiedDate","createdDate","destroy","Delete","refreshTimer","$total","$ajax","refreshWindow","ids","$row","$col","modal","$menuItem","sortList","parentElement","Save","maskChange","slider","Reset","stats","system_visits","account","logins","lastLogin","username","admin","img","optional","accordion","heightStyle","collapsible","step","slide","error","direction","Add","Remove","send","Create","selectmenu","total","openSignatureDialog","sigDialogVM","sigId","aSigWormholes","durationPicker","not","form","valid","signatureID_Alpha","signatureID_Numeric","existingSignature","findIndex","signatureType","wormholeName","signatureLength","wormholeType","signatureID2_Alpha","signatureID2_Numeric","wormholeName2","wormholeType2","wormholeLife","wormholeMass","signatureName","sigAlpha"],"mappings":"AAAAA,OAAOC,KAAO,SAASC,EAAKC,GAC3B,IAAIC,EAASC,EACb,GAEC,IAAK,IAAIC,KADTF,GAAU,EAAOC,EAAO,KACVH,EAAK,CAClB,GAAIG,GAAQE,OAAOL,EAAII,GAAGH,IAASI,OAAOL,EAAIG,GAAMF,IAAQ,CAC3D,IAAIK,EAAMN,EAAII,GACdJ,EAAII,GAAKJ,EAAIG,GACbH,EAAIG,GAAQG,EACZJ,GAAU,EAEXC,EAAOC,SAEAF,IAGVJ,OAAOS,MAAQ,SAASP,EAAKC,EAAMO,EAAKC,GACvC,IAAK,IAAIC,KAAOV,EAAK,CACpB,IAAKS,GAAMT,EAAIU,GAAKT,IAASO,EAC5B,OAAOE,EACD,GAAIV,EAAIU,GAAKT,IAASD,EAAIU,GAAKT,GAAMU,eAAiBH,EAAIG,cAChE,OAAOD,IAKVZ,OAAOc,KAAO,SAASZ,EAAKC,EAAMO,EAAKC,GACtC,IAAK,IAAIC,KAAOV,EAAK,CACpB,IAAKS,GAAMT,EAAIU,GAAKT,IAASO,EAC5B,OAAOR,EAAIU,GACL,GAAIV,EAAIU,GAAKT,IAASD,EAAIU,GAAKT,GAAMU,eAAiBH,EAAIG,cAChE,OAAOX,EAAIU,GAIb,OAAO,GAGRZ,OAAOe,QAAU,SAASb,EAAKC,GAC9B,IAAwBY,EAApBC,EAAgB,GAEpB,IAAK,IAAIJ,KAAOV,IACVa,GAAWA,EAAU,IAAIE,KAAKf,EAAIU,GAAKT,OAC3CY,EAAU,IAAIE,KAAKf,EAAIU,GAAKT,IAC5Ba,EAAgBd,EAAIU,GAAKT,IAG3B,OAAOa,GAGRhB,OAAOkB,KAAO,SAAShB,GACnB,IAAcU,EAAVM,EAAO,EACX,IAAKN,KAAOV,EACJA,EAAIiB,eAAeP,IAAMM,IAGjC,OAAOA,GAGXlB,OAAOoB,KAAO,SAASlB,GACtB,IAAgBU,EAAZS,KACJ,IAAKT,KAAOV,EACXmB,EAAMC,KAAK,IAAIL,KAAKf,EAAIU,GAAKQ,OAG9B,OAAOC,EAAME,OAASF,EAAMpB,OAAOoB,EAAME,OAAQ,GAAGC,UAAW,IAAO,GAGvE,SAAUC,GACNA,EAAEC,GAAGC,gBAAkB,WAEnB,IAAIC,EAAOC,KACPC,KACAC,KACAC,GACIC,SAAY,wDACZrB,IAAY,0BACZU,KAAY,KACZY,MAAY,QACZC,MAAY,mBAoDpB,OAhDAN,KAAKO,MAAQ,SAASC,EAAMzB,EAAK0B,GAE7B,OADAD,EAAKzB,GAAO0B,EACLD,GAGXR,KAAKU,aAAe,SAAS3B,GAIzB,YAH0B4B,IAAvBT,EAAcnB,KACbmB,EAAcnB,GAAO,GAElBmB,EAAcnB,MAGzBa,EAAEgB,KAAKhB,EAAEI,MAAMa,iBAAkB,WAG7B,GAAIV,EAASC,SAASU,KAAKd,KAAKe,MAAhC,CASA,IALA,IAAIC,EACAC,EAAOjB,KAAKe,KAAKG,MAAMf,EAASpB,KAChCoC,EAAQnB,KAAKS,MACbW,EAAcpB,KAAKe,UAEIJ,KAApBK,EAAIC,EAAKI,QAGZD,EAAcA,EAAYE,QAAQ,IAAIC,OAAO,MAAQP,EAAI,QAAS,IAG/DA,EAAEE,MAAMf,EAASV,MAChB0B,EAAQpB,EAAKQ,SAAUR,EAAKW,aAAaU,GAAcD,GAInDH,EAAEE,MAAMf,EAASE,OACrBc,EAAQpB,EAAKQ,SAAUS,EAAGG,GAItBH,EAAEE,MAAMf,EAASG,SACrBa,EAAQpB,EAAKQ,SAAUS,EAAGG,IAIlClB,EAAOL,EAAE4B,QAAO,EAAMvB,EAAMkB,MAGzBlB,GA/Df,CAiEGwB,QAEH,IAAIC,UAAY,SAASC,GAExB,IAAIC,EAAID,EAAIE,WAAWC,MAAM,KAI7B,OAFAF,EAAE,GAAKA,EAAE,GAAGN,QAAQ,wBAAyB,KAEtCM,EAAEG,KAAK,MAGXC,gBAAkB,SAASC,GAC3BA,EAASA,EAAOC,cAChB,IAAqDzD,EAAjD0D,EAAU,6BAA8BC,EAAM,EAClD,IAAK3D,EAAI,EAAGA,EAAIwD,EAAOvC,OAAQjB,IAC3B2D,GAAOC,KAAKC,IAAIH,EAAQzC,OAAQjB,IAAM0D,EAAQI,QAAQN,EAAOO,QAAmB,GAAV/D,EAAI,GAAU,IAAM,GAE9F,OAAO2D,GAGPK,UAAY,SAASC,EAAOC,GAC/B,IAAKD,EAAO,MAAO,GAMnB,IAJA,IAAIE,EAAQ,cACRC,EAAU,WACVC,EAAiB,QAARH,EAAiBI,QAAQC,MAAMC,YAAc,GAAKF,QAAQC,MAAME,aAAe,GAEnFC,EAAI,EAAGC,EAAIN,EAAOpD,OAAQyD,EAAIC,EAAGD,IACzC,GAAIL,EAAOK,GAAGjC,MAAM0B,GAAQ,CAC3B,GAA+B,KAA3BE,EAAOK,GAAGjB,eAAiC,KAATQ,EACrC,MAAO,GAGNI,EADGA,EAAOK,IAAML,EAAOK,GAAGjB,cACjBY,EAAON,OAAO,EAAGW,GAAKT,EAAMR,cAAgBY,EAAON,OAAOW,EAAI,EAAGC,GAEjEN,EAAON,OAAO,EAAGW,GAAKT,EAAQI,EAAON,OAAOW,EAAI,EAAGC,QAGxD,GAAIN,EAAOK,GAAGjC,MAAM2B,GAAU,CACpC,GAAiB,GAAbC,EAAOK,IAAoB,KAATT,EACrB,MAAO,GAEPI,EAASA,EAAON,OAAO,EAAGW,GAAKnB,gBAAgBU,GAASI,EAAON,OAAOW,EAAG,EAAGC,GAK/E,OAAON,GAGJO,SAAW,SAAStC,EAAM4B,GAC7B,IAAIW,EAAK1D,EAAE2D,IAAIC,SAASC,QAAS,SAASC,EAAQJ,GAAM,OAAOI,EAAO3C,MAAQA,EAAOuC,EAAK,OAAQ,GAC9FI,EACK3C,EADL2C,EAEMJ,EAAKE,SAASC,QAAQH,GAAIK,MAAQ,KAFxCD,EAGUJ,EAAKE,SAASC,QAAQH,GAAIM,SAAW,KAH/CF,EAIKf,EACLkB,EAAa,KAqBjB,OAnBoB,GAAhBH,GAAoC,WAAfA,QAAwE,IAApCF,SAASM,UAAUJ,IAA2E,WAA3CF,SAASM,UAAUJ,GAAaK,QAC/IF,EAAa,KACW,GAAhBH,GAAoC,WAAfA,QAAwE,IAApCF,SAASM,UAAUJ,IAA2E,WAA3CF,SAASM,UAAUJ,GAAaK,QACpJF,EAAa,KACW,GAAhBH,GAAoC,WAAfA,QAAwE,IAApCF,SAASM,UAAUJ,IAA2E,WAA3CF,SAASM,UAAUJ,GAAaK,QACpJF,EAAa,KACW,GAAhBH,GAAoC,WAAfA,QAAwE,IAApCF,SAASM,UAAUJ,IAA2E,WAA3CF,SAASM,UAAUJ,GAAaK,QACpJF,EAAa,KACW,GAAhBH,GAAoC,WAAfA,QAAwE,IAApCF,SAASM,UAAUJ,IAA2E,WAA3CF,SAASM,UAAUJ,GAAaK,QACpJF,EAAa,KACW,GAAhBH,GAAoC,WAAfA,QAAwE,IAApCF,SAASM,UAAUJ,IAA2E,WAA3CF,SAASM,UAAUJ,GAAaK,QACpJF,EAAa,KACLH,GAAmB,KAAuB,YAAfA,QAAyE,IAApCF,SAASM,UAAUJ,IAA2E,YAA3CF,SAASM,UAAUJ,GAAaK,UAA0BL,EACrLG,EAAa,KACLH,EAAkB,GAAsB,WAAfA,QAAwE,IAApCF,SAASM,UAAUJ,IAA2E,WAA3CF,SAASM,UAAUJ,GAAaK,UAAyBL,EACjLG,EAAa,MACJH,GAAmB,GAA0B,MAAnBA,GAA2C,YAAfA,QAAyE,IAApCF,SAASM,UAAUJ,IAA2E,YAA3CF,SAASM,UAAUJ,GAAaK,WACvLF,EAAa,MAEPA,GAGJG,QAAU,SAAS3F,GACnB,IAAI,IAAIU,KAAOV,EACX,GAAGA,EAAIiB,eAAeP,GAClB,OAAO,EAEf,OAAO,GAIX,SAASkF,mBAAmBC,EAAMC,GACjC,MAAMC,EAAUF,EAAKG,wBACpBC,EAAcH,EAASE,wBACxB,OACCE,KAAMH,EAAQG,KAAOD,EAAYC,KAAOJ,EAASK,WACjDC,IAAKL,EAAQK,IAAMH,EAAYG,IAAMN,EAASO,WAQhD,SAASC,eAAepB,EAAKqB,EAAcC,EAAcC,GACxD,MAAMC,EAASF,EAAa/C,MAAM,KAC5BkD,KACN,IAAI,IAAIvG,EAAI,EAAGA,EAAIsG,EAAOrF,OAAQjB,IAAK,CACtC,MAAMwG,EAAIF,EAAOtG,GACXyG,EAAI3B,EAAI0B,GACd,IAAIC,EAAG,CACN,GAAGJ,EAAY,OACR,KAAM,SAAWG,EAAI,8BAAgC1B,EAE7DyB,EAAQvF,KAAKyF,EAAEN,IAEhB,OAAOI,EAAQjD,KAAK,KAOrB,SAASoD,yBAAyB5B,EAAKqB,EAAcC,EAAcC,GAClE,MAAMC,EAASF,EAAa/C,MAAM,KAC5BkD,KACN,IAAI,IAAIvG,EAAI,EAAGA,EAAIsG,EAAOrF,OAAQjB,IAAK,CACtC,MAAMwG,EAAIF,EAAOtG,GACXyG,EAAI/G,OAAOS,MAAM2E,EAAKqB,EAAcK,GAC1C,IAAIC,EAAG,CACN,GAAGJ,EAAY,OACR,KAAM,SAAWG,EAAI,uCAAyCL,EAAe,OAASrB,EAE9FyB,EAAQvF,KAAKyF,GAEd,OAAOF,EAAQjD,KAAK,KAGrB,IAAIqD,UAAY,SAASC,GACxB,IAAIC,EAAUC,SAASC,OAEnBC,EAAUH,EAAQ/C,QAAQ,IAAM8C,EAAS,KAK7C,IAJgB,GAAZI,IACHA,EAAUH,EAAQ/C,QAAQ8C,EAAS,OAGpB,GAAZI,EACHH,EAAU,SACJ,CACNG,EAAUH,EAAQ/C,QAAQ,IAAKkD,GAAW,EAC1C,IAAIC,EAAQJ,EAAQ/C,QAAQ,IAAKkD,IAEnB,GAAVC,IACHA,EAAQJ,EAAQ5F,QAGjB4F,EAAUK,SAASL,EAAQM,UAAUH,EAASC,IAG/C,OAAOJ,GAGJO,UAAY,SAASR,EAAQ5E,EAAOqF,GACvC,IAAIC,EAAS,IAAI3G,KACjB2G,EAAOC,QAAQD,EAAOE,UAAYH,GAClC,IAAIR,EAAUY,OAAOzF,IAAqB,MAAVqF,EAAkB,GAAK,aAAaC,EAAOI,eAE3EZ,SAASC,OAASH,EAAS,IAAMC,EAAU,KAAqC,UAA9BC,SAASa,SAASC,SAAuB,UAAY,MAIxG,SAAUzG,GACN,IAAI0G,EAAyB1G,EAAEC,GAAG0G,SACjCC,EAA4B5G,EAAEC,GAAG4G,YAElC7G,EAAEC,GAAG0G,SAAW,SAASG,GAErB,IAAIC,EAASL,EAAuBM,MAAM5G,KAAM6G,WAMhD,OAHA7G,KAAK8G,QAAQ,cAAeJ,GAGrBC,GAGd/G,EAAEC,GAAG4G,YAAc,SAASC,GAErB,IAAIC,EAASH,EAA0BI,MAAM5G,KAAM6G,WAMnD,OAHA7G,KAAK8G,QAAQ,cAAeJ,GAGrBC,GAvBf,CAyBGlF,QAEH,IAAIsF,aAAe,SAASC,GAG1B,IAAIC,EAAMD,EAAQE,OAAOpF,MAAM,WAG3BqF,KAOJ,OANAF,EAAIG,QAAQ,SAAUC,GACpB,IAAIC,EAAQD,EAAKvF,MAAM,MACnByF,EAASD,EAAME,QACf/G,EAAQ6G,EAAMvF,KAAK,MACvBoF,EAAUI,GAAU9G,IAEf0G;ACvVT,IAAIM,cAAgB7H,EAAE,qBAAqB8H,KAAK,WAC5CC,gBAAkB/H,EAAE,uBAAuB8H,KAAK,WAChDE,OAAShI,EAAE,qBAAqB8H,KAAK,WACrCG,SAAWjI,EAAE,uBAAuB8H,KAAK,WACzCI,QAAUlI,EAAE,sBAAsB8H,KAAK,WAGA,QAAvCtC,UAAU,2BACbxF,EAAE,aAAamI,KAAK;ACRrB,IAAIhF,QAAU,IAAI,WACjB,IAEIiF,EAFAC,GAAkB,QAClBC,EAAeC,KAAKC,MAAMC,aAAaC,QAAQ,qBAGnDtI,KAAKuI,OAASC,KAAKD,OACnBvI,KAAKyI,WAAanF,GAAIkF,KAAKE,YAAa3H,KAAMyH,KAAKG,eACnD3I,KAAK4I,WAAa,KAClB5I,KAAK6I,QAAU,EACf7I,KAAK8I,aACL9I,KAAK+I,QACL/I,KAAKgJ,UAAYC,OAAQ,OACzBjJ,KAAKkJ,OAASD,OAAQT,KAAKW,cAAgB,MAC3CnJ,KAAKgD,OAASC,WAAY,KAAMC,YAAa,KAAMkG,WAAW,EAAMH,OAAQ,EAAGI,QAAUC,iBAAkB,OAAQC,KAAM,EAAKC,gBAAiB,OAAQC,aAAc,GAAIC,cAAe,WAAYC,aAAeC,SAAS,EAAOnG,SAAW,OAAQ,WAAcoG,SAAU,YAC9Q7J,KAAK8J,YAAcC,SAAU,UAAWC,cAAe,IAAKC,UAAW,GAAIC,WAAYC,MAAO,cAAeC,QAAS,cAAeC,OAAQ,cAAetG,QAAS,cAAeuG,QAAS,cAAeC,QAAS,gBACrNvK,KAAKwK,SAAWC,QAAQ,EAAOC,aAAcC,SAAS,EAAO7B,WAAW,GAAQ8B,kBAAmBC,YAAY,IAE/G7K,KAAK8K,UAAY,SAASC,GACrB/C,GAAWgD,aAAahD,GAE5BA,EAAYiD,WAAW,iBAAkBF,IAI1C/K,KAAKkL,KAAO,WACX,IAAInI,EAAUoF,KAAKgD,UAAUC,OAAOrI,QAAQsI,OAI5C,OAFAhD,aAAaiD,QAAQ,mBAAoBvI,GAElCnD,EAAE2L,MACRC,IAAK,cACLC,MAAOC,KAAM,MAAO3I,QAASA,GAC7BJ,KAAM,OACNgJ,SAAU,UAKZ3L,KAAK4L,KAAO,SAASH,GAChBA,QAAwB,IAAV,EACjBzL,KAAK6L,IAAI7L,KAAMyL,GACLvD,GACVlI,KAAK6L,IAAI7L,KAAMkI,GAGhBlI,KAAK4G,SAIN5G,KAAKqL,IAAM,WACV,IAAII,KAEJ,IAAK,IAAItI,KAAKnD,KACU,mBAAZA,KAAKmD,KACfsI,EAAKtI,GAAKnD,KAAKmD,IAIjB,OAAOsI,GAIRzL,KAAK6L,IAAM,SAASC,EAAOL,GAC1B,IAAK,IAAInN,KAAQmN,EACZA,EAAKnN,IAASmN,EAAKnN,GAAMyN,aAAeN,EAAKnN,GAAMyN,cAAgB5N,OAClE2N,GACH9L,KAAK6L,IAAIC,EAAMxN,GAAOmN,EAAKnN,IAElBwN,QAAgC,IAAhBA,EAAMxN,KAChCwN,EAAMxN,GAAQmN,EAAKnN,KAKtB0B,KAAKgM,MAAQ,WACZ,IAAK,IAAI7I,KAAKnD,KACU,mBAAZA,KAAKmD,KACfnD,KAAKmD,GAAKgF,KAAKC,MAAMD,KAAKgD,UAAUnL,KAAKgM,MAAMC,SAAS9I,OAM3DnD,KAAK4G,MAAQ,WAEZ,GAAIsB,EACM,IAAKnJ,OAAOkJ,EACRjI,KAAKiI,EAAelJ,MAAQmJ,EAAaD,EAAelJ,MA2CtE,GAtCIiB,KAAK+I,KAAKzJ,eAAe,SAAW0E,QAAQhE,KAAK+I,KAAKmD,KACzDtM,EAAEgB,KAAKZ,KAAK+I,KAAKmD,IAAK,WACrBtM,EAAE,IAAII,KAAKsD,IAAIoE,MAAMyE,WAAYnM,KAAKoM,IAAKC,WAAYrM,KAAKsM,IAAKC,aAAcvM,KAAKwM,OAAQC,aAAczM,KAAK0M,SAC7GC,KAAKC,MAAO5M,KAAK4M,MAAOC,OAAQ7M,KAAK6M,WAE7B7I,QAAQhE,KAAK+I,OACxBnJ,EAAEgB,KAAKZ,KAAK+I,KAAM,WACjBnJ,EAAE,IAAII,KAAKsD,IAAIoE,MAAMyE,WAAYnM,KAAKoM,IAAKC,WAAYrM,KAAKsM,IAAKC,aAAcvM,KAAKwM,OAAQC,aAAczM,KAAK0M,SAC7GC,KAAKC,MAAO5M,KAAK4M,MAAOC,OAAQ7M,KAAK6M,WAKzC7M,KAAK8I,UAAYlJ,EAAE2D,IAAIvD,KAAK8I,UAAW,SAASgE,GAC/C,OAAOC,SAASD,KAIb9M,KAAKwK,QAAQC,QAAQ7K,EAAE,WAAW2G,SAAS,UAC3CvG,KAAKwK,QAAQE,YAAYsC,MAAMpN,EAAE,SAAS2G,SAAS,UACnDvG,KAAKwK,QAAQE,YAAYuC,QAAQrN,EAAE,YAAY2G,SAAS,UACxDvG,KAAKwK,QAAQE,YAAYC,SAAS/K,EAAE,iBAAiB2G,SAAS,UAC9DvG,KAAKwK,QAAQE,YAAY5B,WAAWlJ,EAAE,kBAAkB2G,SAAS,UACjEvG,KAAKwK,QAAQE,YAAYwC,UAAUtN,EAAE,cAAc2G,SAAS,WACF,IAA1D3G,EAAEuN,QAAQJ,SAASpF,iBAAkB3H,KAAK8I,YAAmBlJ,EAAE,oBAAoB8H,KAAK,YAAa,QAAQnB,SAAS,UACtHvG,KAAKwK,QAAQI,iBAAiBC,YAAYjL,EAAE,sBAAsB2G,SAAS,UAG3EvG,KAAK6I,SACRjJ,EAAE,QAAQ+M,IAAI,OAAQ3M,KAAK6I,SAIxB7I,KAAKgD,MAAMuG,MACd3J,EAAE,gBAAgB+M,IAAI,OAAQ3M,KAAKgD,MAAMuG,MAItCvJ,KAAK4I,WAAY,CACpB,IAAIwE,EAAIxN,EAAE,OAASyN,KAAKrN,KAAK4I,aAAe,GAC5ChJ,EAAE,YAAY8H,KAAK,QAAS,iCAAmC0F,EAAEE,SAAWF,EAAEG,SAAWH,EAAEI,OAAS,WAEpG5N,EAAE,YAAY8H,KAAK,QAAS,IAW7B,IAAK,IAAIvE,KAPTvD,EAAE,+BAA+BmI,KAAK,mDAAmDS,KAAKE,YAAY,eAG1G9I,EAAE,sCAAsC6N,OAAO,WAAWzN,KAAKkJ,MAAMD,OAAO,MAAMvB,KAAK,WAAW,GAGlG9H,EAAE,cAAcmI,KAAK,IACP/H,KAAKgD,MAAMqG,KACxB,GAAIrJ,KAAKgD,MAAMqG,KAAKlG,GAAI,CACvB,IAAIuK,EAAO9N,EAAE,kBAAkB+N,QAE/BD,EAAKhG,KAAK,KAAMvE,GAAGlE,KAAK,SAASwM,KAAK,MAAOzL,KAAKgD,MAAMqG,KAAKlG,GAAGyK,UAAU7F,KAAK/H,KAAKgD,MAAMqG,KAAKlG,GAAGpC,MAC9FoC,GAAKnD,KAAKgD,MAAMiG,QAAUyE,EAAKnH,SAAS,WAE5C3G,EAAE,cAAciO,OAAOH,GAKA,oBAAf,UACT1K,MAAM8K,UAIR9N,KAAKgM,MAAMC,SAAW9D,KAAKC,MAAMD,KAAKgD,UAAUnL,KAAKqL,QACrDrL,KAAK4L,KAAKpD,MAAQA,KAAKzF,QAAUyF,KAAKzF,QAAU;ACnKjD,IAAIgG,KAAOnJ,EAAE,gBAAgBmO,UAC5BC,gBAAiB,gBACjBC,0BAA0B,EAC1BC,wBAAyB,GAAI,IAC7BC,gBAAiB,EAAG,GACpBC,eAAe,EACfC,OAAQ,QACRC,WACCC,MAAO,SAASC,EAAGC,GAClB7O,EAAE,gBAAgBgN,MAAMhN,EAAE,mBAAmBgN,WAG/C8B,QACI9E,SAAS,EACT+E,aAAc,cACdC,UAAW,GAAI,IACfC,UAAW,EAAG,GACdN,MAAO,SAASC,GACf5O,EAAE,gBAAgBgN,MAAMhN,EAAE,mBAAmBgN,UAE9CkC,KAAM,SAASN,EAAGC,EAAIM,GAGrB,OAAQA,EAAQrH,KAAK,OACpB,IAAK,aACJuD,WAAW,qBAAsB,QAKxC+D,iBAAkB,SAASC,EAAIC,GAC9B,OACC5L,GAAI2L,EAAGvH,KAAK,MACZ0E,IAAK8C,EAAI9C,IACTE,IAAK4C,EAAI5C,IACTE,OAAQ0C,EAAI1C,OACZE,OAAQwC,EAAIxC,OACZE,MAAOqC,EAAGrC,QACVC,OAAQoC,EAAGpC,aAGXpB,KAAK,YAAY0D,UAEpBpG,KAAKqG,iBACLxP,EAAE,gBAAgB2G,SAAS,UAAUmB,KAAK,YAAa,UAEvD9H,EAAE,aAAa+M,KAAK0C,WAAY,YAChCzP,EAAE,iBAAiB2G,SAAS,uBAE5B3G,EAAE,WAAW0P,MAAM,WACb1P,EAAEI,MAAMuP,SAAS,WAOrBxG,KAAKoG,UACLpG,KAAKqG,iBACLxP,EAAE,gBAAgB2G,SAAS,UAE3B3G,EAAEI,MAAMyG,YAAY,UAEpB1D,QAAQgG,KAAOA,KAAKyG,YAEpBzM,QAAQmI,SAdRnC,KAAK0G,SACL1G,KAAK2G,gBACL9P,EAAE,gBAAgB6G,YAAY,UAE9B7G,EAAEI,MAAMuG,SAAS;ACvDnB,IAAI/C,SAAW,IAAI,WACfxD,KAAK2P,MAAO3P,KAAK4P,IACpB5P,KAAK8H,QAAUA,QACf9H,KAAK6P,QAAU/F,cAAgBhG,cAC/B9D,KAAK4H,QAAUkC,cAAgBhG,cAC/B9D,KAAK8J,YAAcgG,QAAUC,KAAM5H,KAAKC,MAAM4H,eAAe1H,QAAQ,sBAAyB2H,KAAM9H,KAAKC,MAAM4H,eAAe1H,QAAQ,uBACtItI,KAAKkQ,qBAAuB,EAC5BlQ,KAAKmQ,YACLnQ,KAAKyL,MAAQzC,YAAcoH,QAC3BpQ,KAAKqQ,YAAc,IACnBrQ,KAAKsQ,WAAY,EACjBtQ,KAAKuQ,UAAY,KACjBvQ,KAAKwQ,SAAWpF,OAAOrK,KAAOqK,OAAOrK,OAAQ,IAAI3B,MAAOO,UAAkByL,OAAOrK,MAAO,IAAI3B,MAAOO,UAAY,KAI/GK,KAAK8O,KAAO,WAEX,OADA9D,aAAahL,KAAK2P,OACX3P,KAAK2P,OAGb3P,KAAKuO,MAAQ,WACZ,OAAOvO,KAAKyQ,QAKbzQ,KAAK0Q,aAAe,SAAS5N,GACxBA,OAA4B,IAAb,EAA2BA,EAAS9C,KAAKuQ,UAM5D,OAJA3Q,EAAE,kBAAkBgB,KAAK,WACxBhB,EAAEI,MAAM2Q,UAAU,UAAW7N,OAAQA,OAG/B,GAGL9C,KAAK4Q,WAAa,WACpB5Q,KAAKT,KAELS,KAAK4Q,WAAWjR,QAAU,WACzB,OAAO6D,SAASoN,WAAWrR,OAG1BS,KAAK4Q,aAGR5Q,KAAK6Q,SAAW,WACf7Q,KAAK6Q,SAASzI,MAAQ,SAASqD,GAC9BzI,MAAM8N,KAAKrF,KAGVzL,KAAK6Q,WAEL7Q,KAAK+Q,QAAU,WACjB,IAAIhO,GAAWiO,MAAOpR,EAAEI,MAAM2Q,UAAU,SAAU,SAAU7N,OAAQ,KAAMmO,OAAQ,0BAClFrR,EAAEI,MAAM2Q,UAAU,SAAU5N,IAK7B/C,KAAKkR,UAAY,SAASC,GACzB,GAAIxJ,iBAAmBwJ,EAAIvD,SAC1B,GAAIhO,EAAEuN,QAAQgE,EAAIxO,KAAM/C,EAAE2D,IAAIC,SAASM,UAAW,SAASsN,EAAMxS,GAAS,OAAOA,MAAa,EAC7F,IAAI+D,EAAOwO,EAAIxO,KACX0O,EAAU,QAGVA,EAAU,iBADV1O,EAAOwO,EAAIG,UACoB,aAGpC,GAAI1R,EAAEuN,QAAQgE,EAAIG,SAAU1R,EAAE2D,IAAIC,SAASM,UAAW,SAASsN,EAAMxS,GAAS,OAAOA,MAAa,EAC7F+D,EAAOwO,EAAIG,SACXD,EAAU,QAGVA,EAAU,iBADV1O,EAAOwO,EAAIxO,MACoB,QAIrC,GAAI/C,EAAEuN,QAAQxK,EAAM/C,EAAE2D,IAAIC,SAASM,UAAW,SAASsN,EAAMxS,GAAS,OAAOA,MAAa,EACzF,IAAI2S,GAAS,OAETA,GAAS,EAKd,GAFAF,GAAW,iBAAiBE,EAAO/N,SAASM,UAAUnB,GAAM6O,KAAK,WAAW,QAExED,EACH,OAAQ/N,SAASM,UAAUnB,GAAMoB,QAAQjC,MAAM,KAAK,IACnD,IAAK,WACJuP,GAAW,wCAAwC7N,SAASM,UAAUnB,GAAMoB,QAAQ,eACpF,MACD,IAAK,UACJsN,GAAW,yCAAyC7N,SAASM,UAAUnB,GAAMoB,QAAQ,eACrF,MACD,IAAK,WACJsN,GAAW,0CAA0C7N,SAASM,UAAUnB,GAAMoB,QAAQ,eACtF,MACD,IAAK,QACJsN,GAAW,qCAAqC7N,SAASM,UAAUnB,GAAMoB,QAAQ,eACjF,MACD,QACCsN,GAAW,0BAA0B7N,SAASM,UAAUnB,GAAMoB,QAAQ,oBAGxEsN,GAAW,6CAOZ,OAJAA,GAAW,qBAAqBE,EAAO7P,UAAU8B,SAASM,UAAUnB,GAAM8O,MAAM,WAAW,WAE3FJ,GAAW,yBAAyBE,EAAO7P,UAAU8B,SAASM,UAAUnB,GAAM+O,MAAM,WAAW,YAOhG1R,KAAK2R,WAAa,SAASR,GAIpB,IAAIS,EAAO,IAAIxS,KAAK+R,EAAIU,UAE1BR,EAAU,8DACmBO,EAAKE,WAAW,GAAG,IAAIF,EAAK3L,UAAU,KAAK2L,EAAKG,WAAa,GAAG,IAAI,IAAIH,EAAKG,WAAW,KAAKH,EAAKI,aAAe,GAAG,IAAI,IAAIJ,EAAKI,aAAa,YAChKb,EAAIc,cAAc3Q,QAAQ,KAAM,SAASA,QAAQ,KAAM,SAAS,aAe/E,OAZI6P,EAAIU,UAAYV,EAAIe,eAKvBb,GAAW,oCAJXO,EAAO,IAAIxS,KAAK+R,EAAIe,eAI+BJ,WAAW,GAAG,IAAIF,EAAK3L,UAAU,KAAK2L,EAAKG,WAAa,GAAG,IAAI,IAAIH,EAAKG,WAAW,KAAKH,EAAKI,aAAe,GAAG,IAAI,IAAIJ,EAAKI,aAAa,YAC5Kb,EAAIgB,eAAe7Q,QAAQ,KAAM,SAASA,QAAQ,KAAM,SAAS,cAIlF+P,GAAW,YAKTrR,KAAKoS,QAAU,SAAS1G,EAAMD,EAAM4G,EAAiBC,GACnD5G,EAAOA,GAAQ,UAEnB1L,KAAKyQ,KAAK/E,EAAMD,EAAM4G,EAAiBC;ACnJzC1S,EAAE,QAAQ2S,GAAG,QAAS,uBAAwB,SAAS/D,GACtDA,EAAEgE,iBAEF,IAAI9O,EAAS9D,EAAEI,MAAM0H,KAAK,QAAQpG,QAAQ,YAAa,IACnDsM,EAAWzP,OAAOS,MAAM4E,SAASC,QAAS,OAAQC,GAEtDF,SAASiP,aAAa7E,KAGvBhO,EAAE,QAAQ2S,GAAG,SAAU,gBAAiB,SAAS/D,GAChDA,EAAEgE,iBAEF,IAAI9O,EAAS9D,EAAEI,MAAMf,KAAK,mBAAmBJ,MACzC+O,EAAWzP,OAAOS,MAAM4E,SAASC,QAAS,OAAQC,GAAQ,KAAS,GAEtD,IAAbkK,IACHpK,SAASiP,aAAa7E,GACtBhO,EAAEI,MAAMf,KAAK,mBAAmBJ,IAAI,IACpCe,EAAE,WAAW0P,WAIf1P,EAAE,QAAQ2S,GAAG,QAAS,uBAAwB,WAC7C/O,SAASuM,SAGVnQ,EAAE,QAAQ2S,GAAG,QAAS,uBAAwB,WAC7C/O,SAASyM,SAIVrQ,EAAE,gBAAgB2S,GAAG,aAAc,SAAS/D,GAC3CA,EAAEgE,iBACF,IAAIjJ,EAAOmJ,WAAW9S,EAAE,gBAAgB+M,IAAI,UAAY,EAIjD6B,EAAEmE,cAAcC,WAAa,IAAM,GAAKrJ,EAFrC,EAGT3J,EAAE,gBAAgB+M,IAAI,OAAQpD,EAAO,IACxBiF,EAAEmE,cAAcC,WAAa,IAAM,GAAKrJ,EAL5C,IAMT3J,EAAE,gBAAgB+M,IAAI,OAAQpD,EAAO,IAItC3J,EAAE,qBAAqBiT,OAAO,KAC1B7S,KAAK8S,SAAS9H,aAAahL,KAAK8S,SACpC9S,KAAK8S,QAAU7H,WAAW,uCAAwC,KAGlElI,QAAQC,MAAMuG,KAAOmJ,WAAW9S,EAAE,gBAAgB+M,IAAI,SACtD5J,QAAQ+H,UAAU,OAGnBlL,EAAE,qBAAqB2S,GAAG,QAAS,WAClC3S,EAAE,gBAAgB+M,IAAI,OAAQ,GAC9B5J,QAAQC,MAAMuG,KAAO,EACrBxG,QAAQ+H,UAAU,OAGnBlL,EAAE2F,UAAUwN,QAAQ,SAASvE,GAE5B,IAAI5O,EAAE2F,SAASyN,eAAeC,GAAG,mBAGjC,GAAIzE,EAAE0E,SAAW1E,EAAE2E,QAElB,GAAkB,KAAd3E,EAAE4E,SAAmBxT,EAAE,SAAS2P,SAAS,YAKtC,GAAkB,KAAdf,EAAE4E,SAAmBxT,EAAE,SAAS2P,SAAS,aAK7C,GAAkB,KAAdf,EAAE4E,QAEZ5E,EAAEgE,iBACF5S,EAAE,sBAAsB2G,SAAS,YACjC3G,EAAE,uCAAuCkH,QAAQ,uBAC3C,GAAkB,KAAd0H,EAAE4E,SAE6B,KAArChI,OAAOiI,eAAexR,WAAmB,CAC5C,IAAIyR,EAAS,GACb1T,EAAE,+BAA+BgB,KAAK,SAAS0L,GAC9C,IAAIiH,EAAY/P,SAASqM,OAAO/F,WAAWlK,EAAEI,MAAMyL,KAAK,OACpDa,KASJ,GAPIiH,EAAUC,YACblH,EAAI7M,KAAK8T,EAAUC,YAAY5N,UAAU,EAAG,GAAG1D,cAAgB,KAAOqR,EAAUC,YAAY5N,UAAU,EAAG,IAAM,QAE/G0G,EAAI7M,KAAK,QAGV6M,EAAI7M,KAAK8T,EAAU5Q,MACI,aAAnB4Q,EAAU5Q,KAAqB,CAClC,IAAI8Q,EAAW7T,EAAE2D,IAAIC,SAASqM,OAAO/L,UAAW,SAAS2P,GAAY,GAAIA,EAASC,WAAaH,EAAUjQ,IAAMmQ,EAASE,aAAeJ,EAAUjQ,GAAI,OAAOmQ,IAAa,GACrKG,EAAiBL,EAAUjQ,IAAMmQ,EAASC,UAAYlQ,SAASqM,OAAO/F,WAAW2J,EAASE,aAAenQ,SAASqM,OAAO/F,WAAW2J,EAASC,WACjJpH,EAAI7M,KAAKgU,EAAS9Q,MAAQ,QAC1B2J,EAAI7M,KAAK+D,SAASC,QAAQ8P,EAAU3F,UAAYpK,SAASC,QAAQ8P,EAAU3F,UAAU7M,KAAOyC,SAASqQ,YAAYN,EAAU3F,WAC3HtB,EAAI7M,KAAK+D,SAASC,QAAQmQ,EAAehG,UAAYpK,SAASC,QAAQmQ,EAAehG,UAAU7M,KAAOyC,SAASqQ,YAAYD,EAAehG,WAC1ItB,EAAI7M,KAAKgU,EAASjC,MAClBlF,EAAI7M,KAAKgU,EAAShC,WAElBnF,EAAI7M,KAAK8T,EAAUxS,MAGpBuL,EAAI7M,KAAK8T,EAAUtB,eACnB3F,EAAI7M,KAAK8T,EAAU1B,UACnBvF,EAAI7M,KAAK8T,EAAUO,YACnBxH,EAAI7M,KAAK8T,EAAUQ,UACnBzH,EAAI7M,KAAK8T,EAAUpB,gBACnB7F,EAAI7M,KAAK8T,EAAUrB,cACnBoB,GAAUhH,EAAIvK,KAAKgB,QAAQ+G,WAAWE,eAAiB,SAExDpK,EAAE,cAAcoU,KAAKV,GACrB1T,EAAE,cAAcqU,QAChBrU,EAAE,cAAcsU,eA7CjB1F,EAAEgE,iBACF5S,EAAE,SAAS0P,QACX6E,OAAOrN,QAAQ,4BAPf0H,EAAEgE,iBACF5S,EAAE,SAAS0P,QACX6E,OAAOrN,QAAQ,0BAqDC,IAAb0H,EAAE4E,SAAiBxT,EAAE,yBAAyBF,OAAS,GAC1DE,EAAE,qBAAqB0P,UAO1B1P,EAAE,WAAW0P,MAAM,SAASd,GAC3BA,EAAEgE,iBAEE5S,EAAEI,MAAMuP,SAAS,UACpB3P,EAAEI,MAAMyG,YAAY,UAEpB7G,EAAEI,MAAMuG,SAAS,UAElBxD,QAAQyH,QAAQC,OAAS7K,EAAEI,MAAMuP,SAAS,UAC1CxM,QAAQmI,SAGTtL,EAAE,iBAAiB0P,MAAM,WACpB1P,EAAEI,MAAMuP,SAAS,UACpB3P,EAAEI,MAAMyG,YAAY,UAEpB7G,EAAEI,MAAMuG,SAAS,UAElBvD,MAAM8K,SAEN/K,QAAQyH,QAAQE,YAAYC,QAAU/K,EAAEI,MAAMuP,SAAS,UACvDxM,QAAQmI,SAGTtL,EAAE,kBAAkB0P,MAAM,WACrB1P,EAAEI,MAAMuP,SAAS,UACpB3P,EAAEI,MAAMyG,YAAY,UAEpB7G,EAAEI,MAAMuG,SAAS,UAElBvD,MAAM8K,SAEN/K,QAAQyH,QAAQE,YAAY5B,UAAYlJ,EAAEI,MAAMuP,SAAS,UACzDxM,QAAQmI,SAGTtL,EAAE,oBAAoB0P,MAAM,WACvB1P,EAAEI,MAAMuP,SAAS,WACpB3P,EAAEI,MAAMyG,YAAY,UAAUiB,KAAK,YAAa,cAEhD3E,QAAQ+F,UAAUsL,OAAOrR,QAAQ+F,UAAUvG,QAAQwK,SAASpF,kBAAmB,KAE/E/H,EAAEI,MAAM0H,KAAK,YAAa,QAAQnB,SAAS,UAE3CxD,QAAQ+F,UAAUrJ,KAAKsN,SAASpF,mBAG7B/H,EAAE,kBAAkB2P,SAAS,WAChCvM,MAAM8K,SAEP/K,QAAQmI,SAGTtL,EAAE,WAAW0P,MAAM,SAASd,GAC3B5O,EAAE,eAAeyU,SAEbzU,EAAEI,MAAMuP,SAAS,WACpB3P,EAAEI,MAAMyG,YAAY,UAChBjD,SAASqM,OAAOyE,KAAO9Q,SAASqM,OAAOyE,IAAIC,YAC9C3U,EAAE,gBAAgB4U,SAEnB5U,EAAEI,MAAMuG,SAAS,UACjB3G,EAAE,gBAAgB6U,OAElB7U,EAAE,kCAAkCqU,QAAQC,YAI9CtU,EAAE,sBAAsB0P,MAAM,SAASd,GACtCA,EAAEgE,iBAEE5S,EAAEI,MAAMuP,SAAS,UACpB3P,EAAEI,MAAMyG,YAAY,UAEpB7G,EAAEI,MAAMuG,SAAS,UAGlBxD,QAAQyH,QAAQI,iBAAiBC,WAAajL,EAAEI,MAAMuP,SAAS,UAC/DxM,QAAQmI,SAGTtL,EAAE,UAAU2S,GAAG,QAAS,kBAAmB,WAC1C,IAAI7J,EAAa9I,EAAEI,MAAM0H,KAAK,oBAC9B9H,EAAE,6BAA6B6G,YAAY,UAEvC1D,QAAQiG,SAASC,QAAUP,GAC9B3F,QAAQiG,SAASC,OAAS,KAC1BzF,SAAS8Q,KAAI,GAAO,GACpB1U,EAAE,cAAc8H,KAAK,WAAY,cAEjC3E,QAAQiG,SAASC,OAASP,EAEtBlF,SAAS4M,IAAIsE,WAAW3R,QAAQiG,SAASC,UAC5CrJ,EAAE,+CAAgDmD,QAAQiG,SAASC,OAAQ,MAAM1C,SAAS,UAC1F/C,SAAS8Q,IAAI9Q,SAAS4M,IAAIsE,WAAW3R,QAAQiG,SAASC,SAAS,IAGhErJ,EAAE,cAAc+U,WAAW,aAG5B5R,QAAQmI,SAGTtL,EAAE,UAAU2S,GAAG,QAAS,aAAc,WACrC,IAAI7J,EAAc3F,QAAQiG,SAASC,OAEnClG,QAAQiG,SAASC,OAAS,KAC1BzF,SAAS8Q,KAAI,GAAO,GACpBvR,QAAQmI,OAERtL,EAAE,+CAAgD8I,EAAa,MAAMkM,SAErEhV,EAAE,cAAc8H,KAAK,WAAY,YAE7B9H,EAAEiV,QAAQrR,SAASiI,KAAK2E,IAAI0E,QAC/BtR,SAASiI,KAAKsJ,UAAUtV,KAAKiJ,GAE7BlF,SAASiI,KAAKsJ,WAAarM,KAI7B9I,EAAE,SAAS0P,MAAM,SAASd,GACzBA,EAAEgE,iBAEE5S,EAAEI,MAAMuP,SAAS,WACpB3P,EAAEI,MAAMyG,YAAY,UAEpB7G,EAAE,mBAAmB+M,KAAKqI,QAAS,WAInCpV,EAAEI,MAAMuG,SAAS,UAEjB3G,EAAE,mBAAmB+M,KAAKqI,QAAS,WACnCpV,EAAE,mCAAmCqU,QAAQC,SAG7CtU,EAAE,YAAY0P,MAAM,SAASd,GAC5B5O,EAAE,mBAAmB+M,KAAKqI,QAAS,SACnCpV,EAAE,SAAS6G,YAAY,YAGxB7G,EAAE,UAAU0P,MAAM,SAASd,GAC1BA,EAAEyG,uBAKLrV,EAAE,WAAW0P,MAAM,WAClBlE,OAAOhF,SAAW,eAGnB,IAAI+N,OAAS,IAAI,WAChBnU,KAAK8G,QAAU,SAASoO,EAASC,EAAOC,EAAO9R,GAC1C6R,OAA0B,IAAZ,EAA0BA,EAAQ,OAChDC,OAA0B,IAAZ,EAA0BA,EAAQ,IAChD9R,OAAoB,IAAT,EAAuBA,EAAK,KAE3C,IAAI+R,KAAK,UACR/R,GAAIA,EACJ4R,QAASA,EACTI,QAASC,EAAG,IACZC,UAAW,OACXL,MAAOA,EACPM,UAAWL,MAMVM,mBAAqB,IAAIL,KAAK,WACjCvO,QAAS,KACTP,SAAU,qBACViP,UAAW,OACXG,KAAM,IAGHC,SAAW,IAAIP,KAAK,WACvBQ,OAAQjW,EAAE,kBACVkW,WAAY,eACZC,UAAW5S,EAAG,QAASoS,EAAG,UAC1BS,QAAS,MAGNC,uBAAyB,IAAIZ,KAAK,WACrCS,WAAY,eACZC,UAAWR,EAAG,UACdW,SAAUtW,EAAE,gBACZuW,YAAY,EACZC,kBAAkB,EAClBC,cAAc,EACdC,OAAQ,WACP,IAAIC,EAAYtS,mBAAmBjE,KAAKwW,OAAO,GAAIjR,SAASkR,eAAe,gBAKvEC,GAJU1W,KAAK2W,OAAOC,QAAQ,iBAAiBb,WACnC/V,KAAK2W,OAAOC,QAAQ,iBAAiBb,WACpC/V,KAAK2W,OAAOC,QAAQ,iBAAiB/J,SAEnC7M,KAAK6W,UAAUC,SAASlK,SAG3C5M,KAAK+C,QAAQgT,UAAY5S,EAAGoT,EAAUhS,KAAO,EAAImS,EAAc,EAAInB,EAAGgB,EAAU9R,IAAMzE,KAAKwW,OAAO,GAAGO,iBAInGC,sBAAwB,IAAI3B,KAAK,WACpCS,WAAY,eACZC,UAAWR,EAAG,UACdW,SAAUtW,EAAE,gBACZuW,YAAY,EACZC,kBAAkB,EAClBC,cAAc,EACdC,OAAQ,WACP,IAAIC,EAAYtS,mBAAmBjE,KAAKwW,OAAO,GAAIjR,SAASkR,eAAe,gBAGvEC,GAFa1W,KAAK2W,OAAOC,QAAQ,iBAAiB/J,SAEnC7M,KAAK6W,UAAUC,SAASlK,SAG3C5M,KAAK+C,QAAQgT,UAAY5S,EAAGoT,EAAUhS,KAAO,EAAImS,EAAc,EAAInB,EAAGgB,EAAU9R,IAAMzE,KAAKwW,OAAO,GAAGO,iBAInGE,qBAAuB,IAAI5B,KAAK,WACnCQ,OAAQjW,EAAE,kCACVkW,WAAY,eACZC,UAAW5S,EAAG,OAAQoS,EAAG,UACzBW,SAAUtW,EAAE,gBACZoW,QAAS,IACTkB,eAAgB,IAChBC,iBAAiB,EACjBhB,YAAY,EACZC,kBAAkB,EAClBC,cAAc,EACdC,OAAQ,WACP,IAAIC,EAAYtS,mBAAmBjE,KAAKwW,OAAO,GAAIjR,SAASkR,eAAe,gBACvEC,EAAe1W,KAAK6W,UAAUC,SAASlK,QAE3C5M,KAAK+C,QAAQgT,UAAY5S,EAAGoT,EAAUhS,KAAOmS,EAAe,GAAInB,EAAGgB,EAAU9R,IAAM,MAIjF2S,iBAAmB,IAAI/B,KAAK,WAC/BgC,QAAS,SACTtB,UAAW5S,EAAG,QAASoS,EAAG,UAC1BW,SAAUtW,EAAE,gBACZoW,QAAS,IACTsB,SAAU,IACV9B,UAAW,OACX0B,eAAgB,IAChBC,iBAAiB,EACjBhB,YAAY,EACZC,kBAAkB,EAClBmB,qBAAqB,EACrBlB,cAAc,EACdC,OAAQ,WACP,IAAIjF,EAAUrR,KAEd,IAAI4N,EADc5N,KAAK2W,OAAOC,QAAQ,iBACbnL,KAAK,UAC1B8K,EAAYtS,mBAAmBjE,KAAKwW,OAAO,GAAIjR,SAASkR,eAAe,gBAE3EzW,KAAK+C,QAAQgT,UAAY5S,EAAGoT,EAAUhS,KAAOvE,KAAKwW,OAAO,GAAGgB,YAAajC,EAAGgB,EAAU9R,IAAM,GAE5F4M,EAAQoG,WAAW,UAEnB7X,EAAE2L,MACDC,IAAK,gBACLG,SAAU,OACVF,KAAM,YAAYmC,EAClB8J,OAAO,IACLC,KAAK,SAASlM,GAChB,GAAIA,GAAQA,EAAKmM,UAAW,CAC3B,IAAIC,EAAQ,UASZ,IAAK,IAAI1U,KANTsI,EAAKmM,UAAUxZ,KAAK,SAASgP,EAAG0K,GAC/B,OAAI1K,EAAEzE,cAAc3J,cAAgB8Y,EAAEnP,cAAc3J,eAAuB,EACvEoO,EAAEzE,cAAc3J,cAAgB8Y,EAAEnP,cAAc3J,cAAsB,EACnE,IAGMyM,EAAKmM,UAClBC,GAAS,WAAWpM,EAAKmM,UAAUzU,GAAGwF,cAAc,yCAAyC8C,EAAKmM,UAAUzU,GAAG4U,aAAatM,EAAKmM,UAAUzU,GAAG4U,aAAa,IAAI,aAGhKF,GAAS,WACTxG,EAAQoG,WAAWI,SAobvB,SAASG,QAAQC,GAsFhB,OAnFC,2BACA,iCACA,2BACA,2BACA,0BACA,uBACA,wBACA,wBACA,4BACA,wBAGA,6BACA,4BACA,+BACA,+BACA,4BACA,+BACA,0BACA,8BACA,uBAGA,yBACA,iBACA,sBACA,WACA,0CACA,kCACA,gCACA,yCAGA,uBACA,mBACA,iCACA,yBACA,8BACA,uCACA,kCACA,uCAGA,oCACA,8BACA,aACA,sBACA,wCACA,qCACA,8BACA,8BAGA,oBACA,wBACA,sBACA,8BACA,uCACA,uCACA,mCACA,iCAGA,gBACA,kBACA,gBACA,kBACA,4BACA,iCACA,mCACA,iCAGA,eACA,eACA,0BACA,aACA,+BACA,wCACA,8BACA,4BAGsB1V,QAAQ0V,IAAY,EACnC,oDAAoDA,EAAQ3W,QAAQ,KAAM,IAAI,sCAAsC2W,EAAQ,OAG7HA,EAxgBRrY,EAAE,cAAcsY,UACfC,MAAO,SACPC,KAAM,IACNrN,MAAO,IACPsN,UAAW,UACXC,YAAa,SACbC,OAAQ,SAAS/J,EAAGC,GACnB,IAAI9H,EAAS/G,EAAE,cAAcsY,SAAS,WAClCM,KAEJ,IAAK,IAAIrV,KAAKwD,EACb6R,EAAQ/Y,KAAKsD,QAAQC,MAAMqG,KAAK1C,EAAOxD,KACvCvD,EAAE,sBAAsBuD,EAAE,KAAKuE,KAAK,KAAMvE,GAG3CJ,QAAQC,MAAMiG,OAASrJ,EAAE,gBAAgBhB,QACzCmE,QAAQC,MAAMqG,KAAOmP,EACrBzV,QAAQmI,UAIVtL,EAAE,cAAc2S,GAAG,QAAS,OAAQ,SAAS/D,GAC5CA,EAAEgE,iBAEE5S,EAAEI,MAAMuP,SAAS,YACpB3P,EAAE,mBAAmB6G,YAAY,WACjC1D,QAAQC,MAAMiG,OAAS,OAEvBrJ,EAAE,mBAAmB6G,YAAY,WACjC7G,EAAEI,MAAMuG,SAAS,WACjBxD,QAAQC,MAAMiG,OAASrJ,EAAEI,MAAMpB,SAGhCmE,QAAQmI,OACRlI,MAAM8K,SACNtK,SAAS4E,MAAM5E,SAASqM,OAAQ,aAGjCjQ,EAAE,cAAc2S,GAAG,QAAS,YAAa,SAAS/D,GACjDA,EAAEyG,kBACF,IAAIvH,EAAO9N,EAAEI,MAAM4W,QAAQ,QAE3BhX,EAAE,wBAAwBmI,KAAK,2CAC/BnI,EAAE,mBAAmB6Y,OAAO,UAC3BjO,SACCkO,aAAc,WACb,IAAIja,EAAIiP,EAAK9O,QAEbmE,QAAQC,MAAMiG,OAASrJ,EAAE,gBAAgBhB,QACzCmE,QAAQC,MAAMqG,KAAK+K,OAAO3V,EAAG,GAC7BsE,QAAQmI,OAERwC,EAAKkH,SACsC,GAAvChV,EAAE,2BAA2BF,QAChCE,EAAE,wBAAwB0P,QAG3B,IAAK,IAAInM,EAAI,EAAGC,EAAIxD,EAAE,mBAAmBF,OAAQyD,EAAIC,EAAGD,IACvDvD,EAAE,sBAAsBuD,EAAE,KAAKuE,KAAK,KAAMvE,GAG3CvD,EAAEI,MAAMyY,OAAO,UAEhBE,OAAQ,WACP/Y,EAAEI,MAAMyY,OAAO,aAGfA,OAAO,UAGX7Y,EAAE,WAAW2S,GAAG,QAAS,WAEnB3S,EAAE,kBAAkB2P,SAAS,qBAsDtB3P,EAAE,kBAAkB6Y,OAAO,WACtC7Y,EAAE,kBAAkB6Y,OAAO,QAtD3B7Y,EAAE,kBAAkB6Y,QACnBG,WAAW,EACXC,UAAW,EACXC,YAAa,mCACbtO,SACCuO,GAAI,WACHnZ,EAAE,gBAAgBoZ,UAEnBL,OAAQ,WACP/Y,EAAEI,MAAMyY,OAAO,WAGjBQ,KAAM,WACLrZ,EAAE,wBAAwBf,IAAI4I,eAAewM,QAC7CrU,EAAE,0CAA0Cf,IAAI4I,gBAEjDyR,MAAO,WACNxD,mBAAmBwD,SAEpBC,OAAQ,WACPvZ,EAAE,0CAA0CwZ,gBAAgBzC,OAAQnT,SAASqQ,YAAawF,QAAS,GAAItO,MAAO,IAE9GnL,EAAE,gBAAgBoZ,OAAO,SAASxK,GACjCA,EAAEgE,iBACF,IAAI9E,EAAO9N,EAAE,kBAAkB+N,QAC3B5M,EAAOnB,EAAE,wBAAwBf,MACjC+O,EAAWzI,yBAAyB3B,SAASC,QAAS,OAAQ7D,EAAE,0CAA0Cf,OAAO,GACjHya,IAAQ1Z,EAAE,aAAa,GAAG2Z,QAE9B,OAAKxY,GAGO6M,GAAYhO,EAAE,aAAa,GAAG2Z,SACzC7D,mBAAmBuD,MAAMzC,OAAQ5W,EAAE,4CAA4C6X,WAAW,2DACnF,IACG7X,EAAE,aAAa,GAAG2Z,UAC5B3L,EAAW,GAGZF,EAAKhG,KAAK,KAAM9H,EAAE,mBAAmBF,QAAQT,KAAK,SAASwM,KAAK,MAAOmC,GAAU7F,KAAKhH,GACtFgC,QAAQC,MAAMqG,KAAK5J,MAAMmO,SAAUA,EAAU7M,KAAMA,EAAMmM,SAAUoM,IACnEvW,QAAQmI,OAERtL,EAAE,cAAciO,OAAOH,QAEvB9N,EAAE,kBAAkB6Y,OAAO,WAf1B/C,mBAAmBuD,MAAMzC,OAAQ5W,EAAE,0BAA0B6X,WAAW,sBACjE,KAiBT7X,EAAE,0CAA0C0P,MAAM,SAASd,GAC1D5O,EAAE,4BAA4B0P,eASnC1P,EAAE,cAAc2S,GAAG,QAAS,WAAY,SAAS/D,GAChDA,EAAEyG,kBAGGrV,EAAE,mBAAmB2P,SAAS,qBA2DvB3P,EAAE,mBAAmB6Y,OAAO,WACvC7Y,EAAE,mBAAmB6Y,OAAO,QA3D5B7Y,EAAE,mBAAmB6Y,QACpBG,WAAW,EACXC,UAAW,EACXC,YAAa,mCACbtO,SACCuO,GAAI,WACHnZ,EAAE,iBAAiBoZ,UAEpBL,OAAQ,WACP/Y,EAAEI,MAAMyY,OAAO,WAGjBQ,KAAM,WACLrZ,EAAE,yBAAyBf,IAAIkE,QAAQC,MAAMqG,KAAKtG,QAAQC,MAAMiG,QAAQlI,MAAMkT,QAC9ErU,EAAE,2CAA2Cf,IAAyD,GAArDkE,QAAQC,MAAMqG,KAAKtG,QAAQC,MAAMiG,QAAQ2E,SAAgBjJ,eAAenB,SAASC,QAAS,OAAQV,QAAQC,MAAMqG,KAAKtG,QAAQC,MAAMiG,QAAQ2E,UAAY,IACnJ,GAArD7K,QAAQC,MAAMqG,KAAKtG,QAAQC,MAAMiG,QAAQ2E,SAAgBhO,EAAE,iCAAiC,GAAG2Z,SAAU,EAAO3Z,EAAE,iCAAiC,GAAG2Z,SAAU,EAChK3Z,EAAE,iCAAiC,GAAG2Z,QAAUxW,QAAQC,MAAMqG,KAAKtG,QAAQC,MAAMiG,QAAQiE,UAE1FgM,MAAO,WACNxD,mBAAmBwD,SAEpBC,OAAQ,WACPvZ,EAAE,2CAA2CwZ,gBAAgBzC,OAAQnT,SAASqQ,YAAawF,QAAS,GAAItO,MAAO,IAE/GnL,EAAE,iBAAiBoZ,OAAO,SAASxK,GAClCA,EAAEgE,iBACF,IAAI9E,EAAO9N,EAAE,mBAAmB4Z,IAAIzW,QAAQC,MAAMiG,SAC9ClI,EAAOnB,EAAE,yBAAyBf,MAClC+O,EAAWzI,yBAAyB3B,SAASC,QAAS,OAAQ7D,EAAE,2CAA2Cf,OAAO,GAClHya,IAAQ1Z,EAAE,iBAAiB,GAAG2Z,QAElC,OAAKxY,GAGO6M,GAAYhO,EAAE,iBAAiB,GAAG2Z,SAC7C7D,mBAAmBuD,MAAMzC,OAAQ5W,EAAE,6CAA6C6X,WAAW,2DACpF,IACG7X,EAAE,iBAAiB,GAAG2Z,UAChC3L,EAAW,GAGZF,EAAKhG,KAAK,KAAM9H,EAAE,mBAAmBF,QAAQT,KAAK,SAASwM,KAAK,MAAOmC,GAAU7F,KAAKhH,GACtFgC,QAAQC,MAAMqG,KAAKtG,QAAQC,MAAMiG,SAAW2E,SAAUA,EAAU7M,KAAMA,EAAMmM,SAAUoM,GACtFvW,QAAQmI,OACRlI,MAAM8K,SAENtK,SAAS4E,MAAM5E,SAASqM,OAAQ,gBAIhCjQ,EAAE,mBAAmB6Y,OAAO,WAlB3B/C,mBAAmBuD,MAAMzC,OAAQ5W,EAAE,2BAA2B6X,WAAW,sBAClE,KAoBT7X,EAAE,2CAA2C0P,MAAM,SAASd,GAC3D5O,EAAE,iCAAiC0P,eAUxC1P,EAAE,qCAAqC6Z,aACtCC,SAAU,cACVC,KAAM,uBACN5D,SAAU,SAAS6D,EAAOnL,GACnB,OAAQoL,GAAI,WAAYC,GAAI,SAAUC,GAAItL,EAAG+H,SAEpDtC,OAAQ,SAAS1F,EAAGC,GACnB,IAAIrC,EAAMxM,EAAE6O,EAAG+H,QAAQM,SAASA,SAASkD,WAAWpb,MAAMgB,EAAE6O,EAAG+H,QAAQM,UAAY,EAEnF,OAAO1K,GACN,KAAK,EACJ6N,QAAU,QACV,MACD,KAAK,EACJA,QAAU,UACV,MACD,KAAK,EACJA,QAAU,SACV,MACD,KAAK,EACJA,QAAU,UACV,MACD,KAAK,EACJA,QAAU,UACV,MACD,KAAK,EACJA,QAAU,UAIZ,OAAOxL,EAAGyL,KACT,IAAK,YACJta,EAAE,kDAAmDwM,EAAK,KAAK3F,YAAY,0BAA0BF,SAAS,aAC9GxD,QAAQ+G,WAAWI,UAAU+P,SAAW,YACxC,MACD,IAAK,cACJra,EAAE,kDAAmDwM,EAAK,KAAK3F,YAAY,wBAAwBF,SAAS,eAC5GxD,QAAQ+G,WAAWI,UAAU+P,SAAW,cACxC,MACD,IAAK,aACJra,EAAE,kDAAmDwM,EAAK,KAAK3F,YAAY,yBAAyBF,SAAS,cAC7GxD,QAAQ+G,WAAWI,UAAU+P,SAAW,aAI1ClX,QAAQmI,QAETiP,WAAY,SAAS3L,EAAGC,GAGvB,OAFU7O,EAAE6O,EAAG+H,QAAQM,SAASA,SAASkD,WAAWpb,MAAMgB,EAAE6O,EAAG+H,QAAQM,UAAY,GAGlF,KAAK,EACJmD,QAAU,QACV,MACD,KAAK,EACJA,QAAU,UACV,MACD,KAAK,EACJA,QAAU,SACV,MACD,KAAK,EACJA,QAAU,UACV,MACD,KAAK,EACJA,QAAU,UACV,MACD,KAAK,EACJA,QAAU,UAIZra,EAAEI,MAAMyZ,YAAY,cAAe,aAAa,GAChD7Z,EAAEI,MAAMyZ,YAAY,cAAe,eAAe,GAClD7Z,EAAEI,MAAMyZ,YAAY,cAAe,cAAc,GAEjD7Z,EAAEI,MAAMyZ,YAAY,cAAe1W,QAAQ+G,WAAWI,UAAU+P,UAAU,MAK5Era,EAAE,gBAAgB6Z,aACjBvD,SAAU,eACVwD,SAAU,gBACV3D,SAAU,SAAS6D,EAAOnL,GACnB,OAAQoL,GAAI,aAAcC,GAAI,YAAaC,GAAItL,EAAG+H,SAEzDmD,KAAM,aACNnF,MAAO4F,OAAQ,YAAaC,SAAU,KACtCnG,OAAQ,SAAS1F,EAAGC,GACnB,MAAM6L,EAAW1a,EAAE6O,EAAG+H,OAAO,IAAII,QAAQ,iBACzC,IAAItT,EAAKgX,EAAS7O,KAAK,UACb6O,EAAS5S,KAAK,MAAMpG,QAAQ,OAAQ,IAE9C,OAAOmN,EAAGyL,KACT,IAAK,WACJ1W,SAAS4M,IAAImK,SAASjX,EAAIP,QAAQiG,SAASC,QAC3C,MACD,IAAK,UACJzF,SAAS4M,IAAIoK,eAAelX,EAAIP,QAAQiG,SAASC,QAAQ,GACzD,MACD,IAAK,SACJzF,SAAS4M,IAAIoK,eAAelX,EAAIP,QAAQiG,SAASC,QAAQ,GACzD,MACD,IAAK,UAEJ,MACD,IAAK,MACJqR,EAAS/K,SAAS,WAAa3P,EAAEI,MAAMyZ,YAAY,cAAenW,EAAImL,GAAM7O,EAAEI,MAAMyZ,YAAY,WAAYnW,EAAImL,EAAGyL,IAAKzL,GACxH,MACD,IAAK,SACJ6L,EAAS/K,SAAS,cAAgB3P,EAAEI,MAAMyZ,YAAY,cAAenW,EAAImL,GAAM7O,EAAEI,MAAMyZ,YAAY,WAAYnW,EAAImL,EAAGyL,IAAKzL,GAC3H,MACD,IAAK,QACJ6L,EAAS/K,SAAS,aAAe3P,EAAEI,MAAMyZ,YAAY,cAAenW,EAAImL,GAAM7O,EAAEI,MAAMyZ,YAAY,WAAYnW,EAAImL,EAAGyL,IAAKzL,GAC1H,MACD,IAAK,OACJ7O,EAAE,gBAAgB6L,KAAK,KAAM6O,EAAS7O,KAAK,UAAUA,KAAK,WAAY6O,EAAS7O,KAAK,WAAWgN,OAAO,QACtG,MACD,IAAK,WACJ,IAAIpE,GAAStR,QAAQC,MAAMqG,KAAKtG,QAAQC,MAAMiG,UAAiF,GAAtErJ,EAAEuN,QAAQ7J,EAAIP,QAAQC,MAAMqG,KAAKtG,QAAQC,MAAMiG,QAAQwR,WAChHzX,MAAM6G,SAAS6Q,SAASpX,EAAI+Q,KAI/B8F,WAAY,SAAS3L,EAAGC,GACvB,IAAIkM,EAAa/a,EAAE6O,EAAG+H,OAAO,IAAII,QAAQ,iBAAiBnL,KAAK,UAAY,KACvEmC,EAAWhO,EAAE6O,EAAG+H,OAAO,IAAII,QAAQ,iBAAiBnL,KAAK,UAGzDjI,SAASC,QAAQmK,GAAUjK,QAAUH,SAAS4M,IAAIsE,WAAW3R,QAAQiG,SAASC,SACjFrJ,EAAEI,MAAMyZ,YAAY,cAAe,WAAW,GAC9C7Z,EAAEI,MAAMyZ,YAAY,cAAe,UAAU,GAC7C7Z,EAAEI,MAAMyZ,YAAY,cAAe,WAAW,KAE9C7Z,EAAEI,MAAMyZ,YAAY,cAAe,WAAW,GAC9C7Z,EAAEI,MAAMyZ,YAAY,cAAe,UAAU,GAC7C7Z,EAAEI,MAAMyZ,YAAY,cAAe,WAAW,IAG3CkB,EACH/a,EAAEI,MAAMyZ,YAAY,cAAe,QAAQ,GAE3C7Z,EAAEI,MAAMyZ,YAAY,cAAe,QAAQ,IAG7CN,OAAQ,SAAS3K,EAAGC,GAEnB7O,EAAEI,MAAMf,KAAK,aAAa0N,IAAI,QAAS,QACvC/M,EAAEI,MAAMf,KAAK,aAAa0N,IAAI,WAAY,IAE1C/M,EAAE,gBAAgB6Y,QACjBmC,UAAU,EACVhO,MAAO,OACPC,OAAQ,OACRiM,YAAa,mCACbtO,SACCqQ,MAAO,WACNjb,EAAEI,MAAMyY,OAAO,WAGjBQ,KAAM,WACL,IAAI0B,EAAa/a,EAAEI,MAAMyL,KAAK,MAC1BmC,EAAWhO,EAAEI,MAAMyL,KAAK,YACxBgI,EAAWjQ,SAASqM,OAAO/L,UAAU6W,GACrCpH,EAAY/P,SAASqM,OAAO/F,WAAW2J,EAASC,WAChDE,EAAiBpQ,SAASqM,OAAO/F,WAAW2J,EAASE,aAEzD/T,EAAE,gBAAgB6Y,OAAO,SAAU,QAAS,QAAQjV,SAASC,QAAQ8P,EAAU3F,UAAU7M,KAAK,OAAOyC,SAASC,QAAQmQ,EAAehG,UAAU7M,MAE/InB,EAAE,oCAAoCgV,SAEtC,IAAIkG,GAAWH,WAAYlH,EAASnQ,IAEpC1D,EAAE2L,MACDC,IAAK,WACL7I,KAAM,OACN8I,KAAMqP,EACNnP,SAAU,SACRgM,KAAK,SAASlM,GAChB,GAAIA,GAAQA,EAAKgG,KAAM,CACJ,IAAIsJ,EAAY,EAClC,IAAK5X,KAAKsI,EAAKgG,KACOsJ,GAAarI,WAAWjH,EAAKgG,KAAKtO,GAAGsO,MAC1D7R,EAAE,iCAAiCiO,OAAO,WAAWpC,EAAKgG,KAAKtO,GAAGwF,cAAc,aAAa8C,EAAKgG,KAAKtO,GAAG6X,MAAQpN,EAAW,KAAO,OAAO,YAAYnC,EAAKgG,KAAKtO,GAAG8X,SAAS,YAAYvZ,UAAU+J,EAAKgG,KAAKtO,GAAGsO,MAAM,cAAchG,EAAKgG,KAAKtO,GAAG5D,KAAK,cAErOK,EAAE,iCAAiCiO,OAAO,sCAAuCnM,UAAUqZ,GAAY,+BAM7Hnb,EAAEsb,OAAOzB,YAAY0B,UAAUC,SAAW,SAASxN,EAAUyN,EAAO5M,GACnE,IAAIhD,GAAQmC,SAAYA,EAAUyN,MAASA,GAE3Czb,EAAE2L,MACDC,IAAK,aACL7I,KAAM,OACN8I,KAAMA,EACNE,SAAU,SACRgM,KAAK,SAASlM,GACZA,GAAQA,EAAK9E,SAGhB3D,MAAMyI,KAAK6P,OAAOA,OAAO7b,MAAMmO,SAAUA,EAAUyN,MAAOA,EAAO9b,KAAM,OACvEyD,MAAMsY,OAAOtY,MAAMyI,KAAK6P,YAK3B1b,EAAEsb,OAAOzB,YAAY0B,UAAUI,YAAc,SAAS3N,EAAUa,GAC/D,IAAIhD,GAAQmC,SAAYA,GAExBhO,EAAE2L,MACDC,IAAK,aACL7I,KAAM,OACN8I,KAAMA,EACNE,SAAU,SACRgM,KAAK,SAASlM,GACZA,GAAQA,EAAK9E,SAGhB3D,MAAMyI,KAAK6P,OAAOA,OAAOlH,OAAOjW,OAAOS,MAAMoE,MAAMyI,KAAK6P,OAAOA,OAAQ,WAAY1N,GAAW,GAC9F5K,MAAMsY,OAAOtY,MAAMyI,KAAK6P,eAsG7B1b,EAAE4b,OAAO,wBAAyB5b,EAAE6O,GAAGgN,cACtCC,QAAS,WAMR,OALK1b,KAAK2b,QAAQ1I,GAAG,UACpBjT,KAAK4b,cAIC5b,KAAK6b,UAEbC,OAAQ,WAEP,IAAIC,EAAiB/b,KAAKgc,YAAYnV,WAItC,OAFA7G,KAAK2b,QAAQM,SAENF,GAERG,SAAU,SAAS/D,GAMlB,OAAOnY,KAAK6b,OAAO1D,IAEpBgE,YAAa,WACZ,IAAIvc,EAAEiV,QAAQ7U,KAAK+C,QAAQ4T,QAqB1B,OAAO3W,KAAK6b,SApBZ7b,KAAK2W,OAAS,SAASyF,EAASC,GAM/B,IALA,IAAIC,EAAU,IAAI/a,OAAO,IAAM3B,EAAE6O,GAAGgN,aAAac,YAAYH,EAAQI,MAAO,KACxExX,EAAU,IAAIyX,MACdhR,EAAOzL,KAAK+C,QAAQ4T,OACpB0C,EAAUrZ,KAAK+C,QAAQsW,SAAW,GAE7B5a,EAAI,EAAG2E,EAAIqI,EAAK/L,OAAQjB,EAAI2E,KAChCkZ,EAAQxb,KAAK2K,EAAKhN,MACrBuG,EAAQvF,KAAKgM,EAAKhN,IAEd4a,GAAWrU,EAAQtF,OAAS2Z,IAJM5a,KAUvC4d,EAASrX,KAOb0X,OAAQ,SAAS9C,GAIhB,OAHA5Z,KAAK+C,QAAQ4T,OAAS3W,KAAK+C,QAAQ4Z,aAAe3c,KAAK+C,QAAQ4Z,aAAe3c,KAAK+C,QAAQ4T,OAGpF3W,KAAK6b,OAAOjC,IAEpBgD,YAAa,SAASnc,GACrBT,KAAK+C,QAAQ8Z,mBAAqBpc,EAClCT,KAAK+C,QAAQ+Z,cAAcC,QAAQtc,IAEpCuc,iBAAkB,SAASvc,GACtBA,EACHT,KAAK+C,QAAQ+Z,cAAc1I,OAAO3T,EAAO,GAC/BT,KAAK+C,QAAQ8Z,oBACvB7c,KAAK+C,QAAQ+Z,cAAc1I,OAAOpU,KAAK+C,QAAQ8Z,mBAAoB,GAEpE7c,KAAK+C,QAAQ8Z,mBAAqB,MAEnCjB,YAAa,WACZ5b,KAAK2b,QAAQpV,SAAS,mBACtBvG,KAAKid,QAAUjd,KAAK2b,QACpB3b,KAAK2b,QAAU3b,KAAKid,QAAQhe,KAAK,eACjCe,KAAKkU,OAASlU,KAAKid,QAAQhe,KAAK,gBAAgB2V,SAEhD5U,KAAK+C,QAAQ4Z,aAAe3c,KAAK+C,QAAQ4T,OACzC3W,KAAK+C,QAAQ+Z,cAAgB9c,KAAKkU,OAAO8F,SAAS,qBAAqBzW,IAAI,WACjE,OAAO3D,EAAEsH,KAAKlH,KAAKgU,QACpBkJ,UAETld,KAAKmd,wBAENA,qBAAsB,WACf,IAAIC,EAAOpd,KACTqd,GAAU,EAEZzd,EAAE,OACN8H,KAAK,WAAY0V,EAAKzB,QAAQrd,KAAK,aACnCoJ,KAAK,QAAS,IACdwO,SAASkH,EAAKH,SACdK,QAAQC,OAAQC,QAAS,wBAAyBxJ,MAAM,IACxDvN,YAAY,iBACZF,SAAS,0CACTgM,GAAG,YAAa,WAChB8K,EAAUD,EAAK5B,SAASvI,GAAG,cAE3BV,GAAG,QAAS,WACZ6K,EAAKzB,QAAQ7U,QAAQ,SAGjBuW,IAKJD,EAAKra,QAAQ4T,OAASyG,EAAKra,QAAQ+Z,cACnCM,EAAKK,QAAQ,UAMjB7d,EAAE,aAAa8d,aACdC,WAAW,EACXC,SAAU,YACVC,gBACCC,EAAG,SAASC,GAAQ,OAAOne,EAAEme,GAAM9e,KAAK,QAAQwM,KAAK,WAKvD7L,EAAE,mBAAmB2S,GAAG,QAAS,KAAM,SAAS/D,GAC3CA,EAAE0E,SAAW1E,EAAE2E,QAElBvT,EAAEI,MAAMge,YAAY,YACVxP,EAAEyP,UAEZre,EAAEI,MAAMuG,SAAS,YACjB3G,EAAE,qCAAqCse,UAAU,oCAAoCC,UAAUC,IAAI,oCAAoC7X,SAAS,cAEhJ3G,EAAE,+BAA+B6G,YAAY,YAC7C7G,EAAEI,MAAMuG,SAAS,eAKnB3G,EAAE2F,UAAU+J,MAAM,SAASd,GACnB5O,EAAE4O,EAAEgI,QAAQI,QAAQ,mBAAmBlX,QAAWE,EAAE4O,EAAEgI,QAAQI,QAAQ,mBAAmBlX,QAAWE,EAAE4O,EAAEgI,QAAQI,QAAQ,qBAAqBlX,QACnJE,EAAE,+BAA+B6G,YAAY,cAK/C7G,EAAE,mBAAmB2S,GAAG,cAAe,KAAM,SAAS/D,EAAG9H,GAEtC,aAAdA,GACH9G,EAAE,qBAAqBkH,QAAQ,qBAKjClH,EAAE,qBAAqB2S,GAAG,kBAAmB,WAEF,IAAtC3S,EAAE,yBAAyBF,OAC9BE,EAAE,uCAAuC2G,SAAS,YAElD3G,EAAE,uCAAuC6G,YAAY,YAIZ,IAAtC7G,EAAE,yBAAyBF,OAC9BE,EAAE,qCAAqC6G,YAAY,YAEnD7G,EAAE,qCAAqC2G,SAAS,cAIlD3G,EAAE,iBAAiB6Y,QAClBmC,UAAU,EACVhC,WAAW,EACXC,UAAW,EACXC,YAAa,gDACbtO,SACC6T,GAAI,WACHze,EAAEI,MAAMyY,OAAO,WAGjBU,OAAQ,WACPvZ,EAAEI,MAAMyY,OAAO,SAAU,QAAS2B,OAAQ,QAASC,SAAU,IAAKiE,OAAQ,sBAI5E1e,EAAE,eAAe6Y,QAChBmC,UAAU,EACVhC,WAAW,EACXC,UAAW,EACXC,YAAa,gDACbtO,SACC6T,GAAI,WACHze,EAAEI,MAAMyY,OAAO,aAKlB7Y,EAAE,mBAAmB6Y,QACpBmC,UAAU,EACVhC,WAAW,EACXC,UAAW,EACXC,YAAa,gDACbtO,SACCmO,OAAQ,WACP/Y,EAAEI,MAAMyY,OAAO,cAK8B,GAA5CrN,OAAOhF,SAASiH,KAAK9K,QAAQ,YAChC4R,OAAOrN,QAAQ;AChoChB,IAAIyX,SAAW,SAAW5d,GAEzB,IAAI6d,EAAc,SAAUngB,GAC3B,IAAI4C,KAEJ,IAAK,IAAIlC,KAAOV,EACZF,OAAOgd,UAAU7b,eAAemf,KAAKpgB,EAAIU,IAAQkC,EAAKxB,KAAKV,GAG/D,OAAOkC,GAGJyd,EAAS,SAAUtR,EAAG0K,GACzB,OAAOpF,WAAYtF,GAAKsF,WAAYoF,IAGrC,SAAS6G,EAAqBC,EAASlb,GAEtC,KADIA,EAASF,SAASC,QAAQ,IAAW,EAAIC,IAC/B,OAAOkb,EAIrB,OAHG7b,QAAQC,MAAM2G,YAAYC,SAAW7G,QAAQC,MAAM2G,YAAYlG,QAAQlB,QAAQmB,EAAO3C,OAAS,IACjG6d,GAAW,KAEL7b,QAAQC,MAAM0G,eACpB,IAAK,UAAW,OAAOkV,GAAWlb,EAAOE,SAAW,IAAO,IAAM,GACjE,IAAK,aAAc,OAAOgb,GAAWlb,EAAOE,UAAY,IAAO,IAAM,GACrE,IAAK,aAAc,OAAOgb,GAAWlb,EAAOE,UAAY,EAAM,IAAM,GACpE,QAAS,OAAOgb,GAIlB,IAAIC,EAAY,SAAUtb,EAAKgL,EAAOuQ,EAAKC,GAC1CA,EAAWA,GAAYC,EAAAA,EAEvB,IAGI/d,EAHAge,KACAhG,GAAQiG,GAAM3Q,IACd4Q,KAGAC,EAAY,SAAUC,EAAMC,GAC/B,IAAIvgB,EAAM,GAAKsgB,EACVpG,EAAKla,KAAMka,EAAKla,OACrBka,EAAKla,GAAKU,KAAK6f,IAKhB,IAFAL,EAAM1Q,GAAS,EAER0K,IAASgG,EAAMH,KAChB7d,EAAOud,EAAYvF,IAAOvZ,QADJ,CAG3BuB,EAAK7C,KAAKsgB,GAEV,IAAI3f,EAAMkC,EAAK,GACXse,EAAStG,EAAKla,GACdgf,EAAOwB,EAAO/X,QACdgY,EAAc9M,WAAW3T,GACzB0gB,EAAgBlc,EAAIwa,OAIxB,IAAK,IAAIuB,KAFJC,EAAO7f,eAAeuZ,EAAKla,GAEb0gB,EACf,GAAIthB,OAAOgd,UAAU7b,eAAemf,KAAKgB,EAAeH,GAAS,CACnE,IACII,EADOf,EAAqBc,EAAcH,GAASA,GAChCE,EACnBG,EAAaV,EAAMK,SA/Db,IAiELK,GAA8BA,EAAaD,KAC/CT,EAAMK,GAAUI,EAChBN,EAAUM,EAAWJ,GACrBH,EAAaG,GAAUvB,IAM3B,YA1Ea,IA0ETkB,EAAMH,GACF,KAEAK,GAKLS,EAAkB,SAAUT,EAAcL,GAI7C,IAHA,IAAIe,KACAC,EAAIhB,EAEDgB,GACND,EAAMpgB,KAAKqgB,GACXC,YAAcZ,EAAaW,GAC3BA,EAAIX,EAAaW,GAIlB,OADAD,EAAMG,UACCH,GAGJI,EAAmB,SAAU1c,EAAKsc,GAOrC,IANA,IACIf,EACAK,EAEAe,EAJA3R,EAAQsR,EAAMrY,QAGd2Y,KAGGN,EAAMngB,QAAQ,CAIpB,GAHAof,EAAMe,EAAMrY,UACZ2X,EAAeN,EAAUtb,EAAKgL,EAAOuQ,IAUpC,OAAO,KANP,GADAoB,EAAWN,EAAgBT,EAAcL,IACrCe,EAAMngB,OAGT,OAAOygB,EAAKC,OAAOF,GAFnBC,EAAK1gB,KAAKmH,MAAMuZ,EAAMD,EAASG,MAAM,GAAI,IAQ3C9R,EAAQuQ,IAIN5B,EAAU,SAAUpN,EAAMwF,GAC7B,IACC,OAAOmH,MAAMtB,UAAUkF,MAAM5B,KAAK3O,EAAMwF,GACvC,MAAO9G,GAER,IADA,IAAIpB,KACK3O,EAAI6W,GAAU,EAAGlS,EAAI0M,EAAKpQ,OAAQjB,EAAI2E,IAAK3E,EACnD2O,EAAE3N,KAAKqQ,EAAKrR,IAEb,OAAO2O,IAILkT,EAAW,SAAU/c,GACxBvD,KAAKuD,IAAMA,GA2BZ,OAxBA+c,EAASnF,UAAU8E,iBAAmB,SAAU1R,EAAOuQ,GAWtD,MAR8C,mBAA1C3gB,OAAOgd,UAAUtZ,SAAS4c,KAAKlQ,GACzB0R,EAAiBjgB,KAAKuD,IAAKgL,GACL,IAArB1H,UAAUnH,OACXugB,EAAiBjgB,KAAKuD,KAAMgL,EAAOuQ,IAEnCmB,EAAiBjgB,KAAKuD,IAAK2Z,EAAQrW,aAM9CyZ,EAASL,iBAAmB,SAAU1c,EAAKgL,EAAOuQ,GACjD,MAA8C,mBAA1C3gB,OAAOgd,UAAUtZ,SAAS4c,KAAKlQ,GAC3B0R,EAAiB1c,EAAKgL,GACE,IAArB1H,UAAUnH,OACbugB,EAAiB1c,GAAMgL,EAAOuQ,IAE9BmB,EAAiB1c,EAAK2Z,EAAQrW,UAAW,KAI3CyZ,EAlKO;ACAf,MAAMC,yBAA2B,SAASC,GACzC,MAAMC,EAAQzgB,KAGdA,KAAKwI,KAAO,WACXiY,EAAMld,IAAM,IAAImd,OAAOC,cAAcC,SAASrb,SAASkR,eAAe,aACtEgK,EAAM1d,SAAW8d,WAAW,EAAMC,eAAe,EAAMzhB,KAAM,SAAU0hB,UAAW,QAElFL,OAAOC,cAAcK,OAAOC,YAAYR,EAAMld,IAAK,WAAYkd,EAAMS,iBAErET,EAAMld,IAAIuN,KAAK,IAAI4P,OAAOC,cAAcQ,SAAS,IAAIT,OAAOC,cAAcS,WAAWC,OAAOC,MAAO,SAAU3e,KAAM,WAAY2e,MAAO,SAAU3e,KAAM,cAAe8d,EAAM1d,UAI5K/C,KAAKuhB,MAAQ,WAAa,OAAQvhB,KAAKwhB,WAAaxhB,KAAKuD,KAGzDvD,KAAKyhB,SAAW,WACflc,SAASkR,eAAe,aAAaiL,MAAM1M,QAAU,GACjDyL,EAAMld,KAAOmd,OAAOiB,OAAOC,kBAAkB5hB,KAAKwI,OAIvDxI,KAAK6hB,WAAa,WACjBtc,SAASkR,eAAe,aAAaiL,MAAM1M,QAAU,OACrDyL,EAAMld,IAAIuN,KAAK,IAAI4P,OAAOC,cAAcQ,SAAS,IAAIT,OAAOC,cAAcS,WAAWC,OAAOC,MAAO,SAAU3e,KAAM,WAAY2e,MAAO,SAAU3e,KAAM,cAAe8d,EAAM1d,UAI5K/C,KAAK8Q,KAAO,SAASvN,EAAKue,EAAOrH,GAIhC,IAAK,IAAItX,KAHTnD,KAAKwhB,SAAU,EACfxhB,KAAKuD,IAAIuN,KAAKiR,EAAQxe,GAAMvD,KAAK+C,SAEnB0X,EAAW,CACxB,MAAMuH,EAAIvH,EAAUtX,GACd8e,EAASriB,EAAE,2BAA2BoiB,EAAE,MAAMta,KAAK,MACzD,GAAIua,EAAQ,CACX,MAAMC,EAAUD,EAAOngB,MAAM,QAAQ,GACrC9B,KAAKuD,IAAImX,SAASwH,EAAU,GAAG,IAIjCC,EAAY5e,EAAKue,GACjB9hB,KAAKwhB,SAAU,GAGhB,MAAMO,EAAU,SAAS9hB,GAExB,OADa,IAAIygB,OAAOC,cAAcQ,SAAS,IAAIT,OAAOC,cAAcS,UAAUnhB,KAI7EkiB,EAAc,SAAS5e,EAAKue,GAEjC,SAASM,EAAa1e,EAAQoT,EAAQpL,EAAM8H,GAI3C,SAAS6O,EAASC,EAAgBC,GAAY,OAAOC,EAAcF,EAAgBC,EAAU,SAASP,EAAGS,GAAKT,EAAEzb,SAASkc,KACzH,SAASC,EAAYJ,EAAgBC,GAAY,OAAOC,EAAcF,EAAgBC,EAAU,SAASP,EAAGS,GAAKT,EAAEvb,YAAYgc,KAC/H,SAASD,EAAcF,EAAgBC,EAAUI,GAMhD,OALAJ,EAAWA,OACF9iB,KAAK,IACd8iB,EAASnb,QAAQ,SAASwb,GACzBlX,EAAKtE,QAAS,SAASsE,GAAQiX,EAAUL,GAAiBM,EAAOljB,OAASkjB,EAAS,IAAM,IAAMlX,OAEzF4W,EAVU,iBAAR5W,IAAoBA,GAAQA,IAetC,IAAImX,EAAQjjB,EAAE,kBAAkB8D,GAAQoT,SAExC,GAAoB,GAAhB+L,EAAMnjB,OACT,OAAO,EAIR,IAAIojB,EAAYzgB,KAAK0gB,MAAMF,EAAM,GAAGG,UAAY,GAAK,EAAI,GAGrDC,EAAaZ,EAASziB,EAAEijB,EAAM/L,SAAStY,OAAOwb,SAAS,yFAAyF8I,KAAe,OAAQ,UAIvKI,EAAUtjB,EAAE,kBAAkBkX,GAAQA,SAE1C,GAAsB,GAAlBoM,EAAQxjB,QAAoC,GAArBujB,EAAWvjB,OACrC,OAAO,EAGR,IAAIyjB,EAAU,EAAGC,EAAgBH,EAAW,GAAGD,UAC/CH,EAAM/L,SAAStY,OAAOS,KAAK,MAAM2B,KAAK,SAAShC,GAG9C,GAFAukB,GAAWnjB,KAAKqjB,QAEZzkB,GAASwkB,EACZ,OAAO,IAST,IAJA,IAAIE,EAAcjhB,KAAK0gB,MAAMG,EAAQ,GAAGF,UAAY,GAAK,EAAI,GAGzDO,EAAiBD,EACZ7kB,EAAI,EAAGA,GAAK6kB,EAAa7kB,IAAK,CACtC,IAAI+kB,EAAc,EAClBX,EAAM/L,SAAStY,OAAOA,OAAOA,OAAOS,KAAK,sBAAsB2B,KAAK,SAAShC,GAC5E,GAAIA,GAASH,EAGZ,OAFA+kB,EAAc5jB,EAAEI,MAAM0H,KAAK,MAAMpG,QAAQ,OAAQ,KAE1C,IAIL1B,EAAE2D,IAAIA,EAAIkgB,KAAM,SAAS1F,GAAQ,OAAOA,EAAK0E,EAAE,GAAGxd,GAAKue,EAAczF,EAAO,OAASre,QAAU,GAClG6jB,IAGFD,EAAcC,EAGd,IAAIG,EAAYrB,EAASziB,EAAEijB,EAAM/L,SAAStY,OAAOA,OAAOwb,SAAS,yFAAyFsJ,KAAiB,OAAQ,UAG/KlX,EAAM,EAAmBuX,GAAhB7M,GAAS,GAAY,GAClC+L,EAAM/L,SAAStY,OAAOA,OAAOS,KAAK,MAAM2B,KAAK,SAAShC,EAAO6B,GAG5D,GAFA2L,GAAOpM,KAAKqjB,QAERM,GAAM7M,EAET,OAAO,EACD,QAA4B,IAAjB4M,EAAU,IAAsBA,EAAU,GAAGV,WAAapkB,GAW3E,GAVAkY,GAAS,EAETuL,EAASziB,EAAEI,OAAQ,SAGd2jB,GAAMvX,GAAO+W,GACjBd,EAASziB,EAAEI,OAAQ,WAIhBmjB,GAAW/W,EACd,OAAO,OAEF,GAAIA,GAAO+W,EACjBQ,GAAK,EAELtB,EAASziB,EAAEI,OAAS,gBACd,GAAI2jB,GAAM7M,EAAQ,CACxB,IAAI8M,EAAU,EAAGC,GAAU,EAAOC,GAAO,EA0BzC,GAxBAjB,EAAM/L,SAAStY,OAAOS,KAAK,MAAM2B,KAAK,SAAShC,GAG9C,IAFAglB,GAAW5jB,KAAKqjB,UAEDjX,IAAQxM,EAAEI,MAAMuP,SAAS,2CAA6C3P,EAAEI,MAAMuP,SAAS,4CAA6C,CAClJ,GAAc,GAAVuH,EAIH,OAFA+M,GAAU,EACVnB,EAAYgB,GAAa,OAAQ,WAC1B,EACa,GAAV5M,IAEV4L,EAAYgB,GAAa,OAAQ,UAEjCb,EAAM/L,SAAStY,OAAOA,OAAOS,KAAK,MAAM2B,KAAK,SAAShC,GACjDA,GAAS8kB,EAAU,GAAGV,WAEzBN,EAAY9iB,EAAEI,OAAS,aAGzB8jB,GAAO,MAKND,EACH,OAAO,EAGHC,GACJzB,EAASziB,EAAEI,OAAQ,cAMvB,IAAK,IAAImD,KAvITsd,EAAMsD,cAAiBxgB,IAAKA,EAAKue,MAAOA,GAuI1BA,EACbM,EAAaN,EAAM3e,GAAG,GAAI2e,EAAM3e,GAAG,GAAI2e,EAAM3e,GAAG,GAAI2e,EAAM3e,GAAG,KAI/DnD,KAAKkhB,gBAAkB,WACtB,GAAGT,EAAMe,QAAW,OAEpB,MAAM/G,EAAYgG,EAAMld,IAAIygB,oBACtBC,KACN,IAAK9gB,KAAKsX,EAAW,CACpB,IAAI7M,EAAWhO,EAAE,mBAAmB6a,EAAUtX,GAAI,IAAIsI,KAAK,UAC3DwY,EAAiBxkB,KAAKmO,GAEvB4S,EAAM0D,gBAAgBD,GAEnBxD,EAAMsD,cAAgB5B,EAAY1B,EAAMsD,aAAaxgB,IAAKkd,EAAMsD,aAAajC;AC3MlF,MAAMqC,uBAAyB,SAAS3D,GAEvCxgB,KAAKuhB,MAAQ,WAAa,OAAQvhB,KAAKwhB,SAGvCxhB,KAAKyhB,SAAW,WACf,IAAIlc,SAASkR,eAAe,iBAAkB,CAC7C,MAAM2N,EAAS7e,SAAS8e,cAAc,OACtCD,EAAO9gB,GAAK,gBACZ8gB,EAAO1d,UAAY,aACnBnB,SAASkR,eAAe,YAAY6N,YAAYF,GAEjDpkB,KAAK6W,UAAYtR,SAASkR,eAAe,iBACzCzW,KAAK6W,UAAU6K,MAAM1M,QAAU,IAIhChV,KAAK6hB,WAAa,WACjB,MAAM0C,EAAMhf,SAASkR,eAAe,iBACjC8N,GAAOA,EAAIC,WAAWC,YAAYF,GACrCvkB,KAAK6W,UAAY,MAGlB7W,KAAK0a,SAAW,SAAS9M,EAAU8M,GAC/BA,EAAY1a,KAAK0kB,QAAQjK,UAAUhb,KAAKmO,GACnC5N,KAAK0kB,QAAQjK,UAAYza,KAAK0kB,QAAQjK,UAAUhN,OAAOtK,GAAKA,GAAKyK,GACzE4S,EAAM0D,gBAAgBlkB,KAAK0kB,QAAQjK,WACnCkK,EAAU3kB,KAAK0kB,QAAQnhB,IAAKvD,KAAK0kB,QAAQ5C,MAAO9hB,KAAK0kB,QAAQjK,YAI9Dza,KAAK8Q,KAAO,SAASvN,EAAKue,EAAOrH,GAChCza,KAAKwhB,SAAU,EACfxhB,KAAK0kB,SAAWnhB,IAAKA,EAAKue,MAAOA,EAAOrH,UAAWA,GAKnD,IAAMkK,EAAUphB,EAAKue,EAAOrH,GAC5B,QAAUza,KAAKwhB,SAAU,IAG1B,MAAMoD,GAAgBzhB,EAAG,GAAIoS,EAAG,GAAIsP,iBAAkB,GACrDC,MAAO,SAASC,GAAM,OAAa,GAANA,EAAU,GAAKA,EAAK/kB,KAAK6kB,kBAAoB7kB,KAAKmD,GAC/E6hB,MAAO,SAASD,GAAM,OAAa,GAANA,EAAU,GAAKA,EAAK/kB,KAAK6kB,kBAAoB7kB,KAAKuV,IAG1EkL,EAAQzgB,KACR2kB,EAAY,SAASphB,EAAKue,EAAOrH,GACtC,MAAMwK,KACAC,KAGN,IAAI,IAAIC,EAAK,EAAGA,EAAK5hB,EAAIkgB,KAAK/jB,OAAQylB,IAAM,CAC3C,MAAM/T,EAAO7N,EAAIkgB,KAAK0B,GAChBC,EAAShU,EAAKqR,EAAE,GAAInf,EAAK8hB,EAAOngB,EAAG6R,EAAS1F,EAAKqR,EAAE,GAAGxd,EAEtDogB,GAAY/hB,GAAIA,EAAI0W,YAAcpM,SAAUwX,EAAOxX,SAAU0X,OAAQ,GAE3E,GAAa,MAAVxO,EAAgB,CAClB,MAAMyO,GAAYC,UAAaC,IAAK,EAAG5F,OAASwF,MAChDA,EAAQ9hB,IAAMgiB,EACdF,EAAQK,OAAS,EACjBT,EAAKxlB,KAAK8lB,OACJ,CACN,MAAMf,EAAaU,EAAUpO,GAC7B,IAAI0N,EAAc,KAAM,aAAe1N,EAAS,kBAChD0N,EAAWxK,SAASva,KAAK4lB,GACzBA,EAAQvO,OAAS0N,EACjBa,EAAQM,WAAa7D,EAAMrU,OAAO,SAASrK,GAAK,OAAOA,EAAE,IAAME,IAAO,KAAOA,EAAIwT,KAAY,KAC7FuO,EAAQM,WAAW,GAAG5I,QAAQ,cAC9BsI,EAAQ9hB,IAAMihB,EAAWjhB,IACzB8hB,EAAQK,OAASlB,EAAWkB,OAAS,EAClCL,EAAQ9hB,IAAIiiB,QAAQ9lB,QAAU2lB,EAAQK,OACxCL,EAAQ9hB,IAAIiiB,QAAQ/lB,MAAOgmB,IAAK,EAAG5F,OAAOwF,KAClCA,EAAQ9hB,IAAIiiB,QAAQH,EAAQK,QAAQ7F,MAAMpgB,KAAK4lB,GAEzDH,EAAU5hB,GAAM+hB,EAChBA,EAAQO,OAASR,EAAOS,EAIzB,IAAI,IAAIC,EAAK,EAAGA,EAAKb,EAAKvlB,OAAQomB,IAAM,CACvC,MAAMviB,EAAM0hB,EAAKa,GACjB,IAAI,IAAIf,EAAKxhB,EAAIiiB,QAAQ9lB,OAAS,EAAGqlB,GAAM,EAAGA,IAC7C,IAAI,IAAIgB,EAAK,EAAGA,EAAKxiB,EAAIiiB,QAAQT,GAAIlF,MAAMngB,OAAQqmB,IAAM,CACxD,MAAMhI,EAAOxa,EAAIiiB,QAAQT,GAAIlF,MAAMkG,GACnChI,EAAKuH,QAAUP,GAAMA,EAAK,IACvBhH,EAAKuH,OAAS,GAAK7K,EAAUlY,QAAwB,EAAhBwb,EAAKnQ,WAAiB,KAAKmQ,EAAKuH,OAAS,GACjFvH,EAAKjH,OAAOwO,QAAUvH,EAAKuH,OAC3B/hB,EAAIiiB,QAAQT,GAAIU,KAAO1H,EAAKuH,QAM/B,IAAQQ,EAAK,EAAGA,EAAKb,EAAKvlB,OAAQomB,IAAM,CACvC,MAAMviB,EAAM0hB,EAAKa,GACjB,IAAIE,EAASzgB,SAASkR,eAAe,MAAQqP,GACzCE,KACHA,EAASzgB,SAAS8e,cAAc,QACzB/gB,GAAK,MAAQwiB,EACpBE,EAAOtf,UAAY,qBAEpBsf,EAAOC,UAAY,gHAAkHH,EAAK,kBAC1I,MAAMI,EAAiBF,EAAOG,WAAWA,WACzC5gB,SAASkR,eAAe,iBAAiB6N,YAAY0B,GAErDziB,EAAI6iB,OAASC,EAAgBH,EAAgB,EAAG3iB,EAAIiiB,QAAQ,GAAG3F,MAAO,EAAa,EAAVxd,KAAKikB,GAAQ7L,GACtFlX,EAAIgjB,QAAUP,EACdziB,EAAI2iB,eAAiBA,EAKtB,IAAQJ,EAAK,EAAGA,EAAKb,EAAKvlB,OAAQomB,IAAM,CACvC,MAAMviB,EAAM0hB,EAAKa,GACXU,GACLC,EAAG,IAAMljB,EAAI6iB,OAAOjjB,EAAE,GAAKI,EAAI6iB,OAAOjjB,EAAE,GACxCujB,EAAG,IAAMnjB,EAAI6iB,OAAO7Q,EAAE,GAAKhS,EAAI6iB,OAAO7Q,EAAE,GACxCoR,GAAI,IAAMpjB,EAAI6iB,OAAOjjB,EAAE,GACvByjB,GAAI,GAAKrjB,EAAI6iB,OAAO7Q,EAAE,IAIvB,GAAkB,GAAf0P,EAAKvlB,OAAa,CACpB,MAAMmnB,GAAe,GAAKpG,EAAM5J,UAAUW,YACvCgP,EAAeC,EAAII,IACrBL,EAAeG,IAAM,IAAOE,EAAcL,EAAeC,GACzDD,EAAeC,EAAII,GAGrB,MAAMC,EAAevhB,SAASkR,eAAe,eAAeM,aACzDyP,EAAeE,EAAII,IACrBN,EAAeI,IAAM,IAAOE,EAAeN,EAAeE,GAC1DF,EAAeE,EAAII,GAIjBN,EAAeE,GAAK,GAAKnjB,EAAI6iB,OAAO7Q,EAAE,IAAMhS,EAAI6iB,OAAO7Q,EAAE,GAAKhS,EAAI6iB,OAAO7Q,EAAE,IAAMhS,EAAI6iB,OAAO7Q,EAAE,MAChGiR,EAAeI,GAAKJ,EAAeE,EAAI,GAErCF,EAAeC,GAAK,GAAKljB,EAAI6iB,OAAOjjB,EAAE,IAAMI,EAAI6iB,OAAOjjB,EAAE,GAAKI,EAAI6iB,OAAOjjB,EAAE,IAAMI,EAAI6iB,OAAOjjB,EAAE,MAChGqjB,EAAeG,GAAKH,EAAeC,EAAI,GAExCljB,EAAIgjB,QAAQ7E,MAAM9U,MAAQ4Z,EAAeC,EAAI,KAC7CljB,EAAIgjB,QAAQ7E,MAAM7U,OAAS2Z,EAAeE,EAAI,KAC9C,MAAMK,EAAiBxjB,EAAIgjB,QAAQJ,WACnCY,EAAerF,MAAMnd,KAAOiiB,EAAeG,GAAK,KAChDI,EAAerF,MAAMjd,IAAM+hB,EAAeI,GAAK,KAC/C,MAAMI,EAASD,EAAeE,qBAAqB,UAAU,GAC7DD,EAAOpa,MArCa,EAqCU4Z,EAAeC,EAC7CO,EAAOtF,MAAM9U,MAAQ4Z,EAAeC,EAAI,KACxCO,EAAOna,OAvCa,EAuCW2Z,EAAeE,EAC9CM,EAAOtF,MAAM7U,OAAS2Z,EAAeE,EAAI,KACzCM,EAAOtF,MAAMnd,MAAQiiB,EAAeG,GAAK,KACzCK,EAAOtF,MAAMjd,KAAO+hB,EAAeI,GAAK,KACxC,MAAMM,EAAMF,EAAOG,WAAW,MAC9BD,EAAIE,MA5CgB,EAAA,GA6CpBF,EAAIG,UAAUb,EAAeG,GAAIH,EAAeI,IAEhD,IAAQ7B,EAAKxhB,EAAI6iB,OAAOkB,MAAOvC,GAAM,EAAGA,IAWvC,GAVGhiB,QAAQC,MAAMoG,YAChB8d,EAAIK,YACDL,EAAIM,UACNN,EAAIO,UAAY,GAChBP,EAAIQ,gBACJR,EAAIM,QAAQ,EAAG,EAAG5C,EAAYE,MAAMC,GAAKH,EAAYI,MAAMD,GAAK,EAAG,EAAa,EAAV1iB,KAAKikB,KAE5EY,EAAIS,YAAcC,EAAqB,eAAgB,SACvDV,EAAIW,YAEF9C,GAAMxhB,EAAIiiB,QAAQ9lB,QAErB,IAAQqmB,EAAK,EAAGA,EAAKxiB,EAAIiiB,QAAQT,GAAIlF,MAAMngB,OAAQqmB,IAAM,CACxD,MAAMhI,EAAOxa,EAAIiiB,QAAQT,GAAIlF,MAAMkG,GACnC,IAAIhI,EAAKhI,SAAY,SACrBmR,EAAIK,YACJL,EAAIO,UAAY1J,EAAK4H,WAAW,GAAGmC,OAAO,SAASrB,EAAGhE,GAAK,MAAY,QAALA,EAAc,EAAIgE,GAAM,GAC1FS,EAAIa,OAAOhK,EAAKhI,SAAS5S,EAAG4a,EAAKhI,SAASR,GAC1C,MAAMyS,EAAMC,GAAiB/iB,EAAG6Y,EAAKmK,YAAYhjB,EAAI,GAAKijB,OAAQpK,EAAKmK,YAAYC,MAAQ,EAAIpK,EAAKjH,OAAOoR,YAAYC,OAAS,IAC1HC,EAAMH,GAAiB/iB,EAAG6Y,EAAKmK,YAAYhjB,EAAI,GAAKijB,OAAQ,EAAIpK,EAAKmK,YAAYC,MAAQpK,EAAKjH,OAAOoR,YAAYC,OAAS,IAE7HpD,EAAK,EACPmC,EAAImB,cAAcD,EAAIjlB,EAAGilB,EAAI7S,EAAGyS,EAAI7kB,EAAG6kB,EAAIzS,EAAGwI,EAAKjH,OAAOf,SAAS5S,EAAG4a,EAAKjH,OAAOf,SAASR,GAE3F2R,EAAIoB,OAAOvK,EAAKjH,OAAOf,SAAS5S,EAAG4a,EAAKjH,OAAOf,SAASR,GAE1CwI,EAAKhI,SAASR,EAAIwI,EAAKjH,OAAOf,SAC7CmR,EAAIS,YAAcC,EAAqB7J,EAAK4H,WAAW,GAAI,oBAC3DuB,EAAIQ,aAAea,QAAS,EAAG,IAAKX,EAAqB7J,EAAK4H,WAAW,GAAI,0BAC7EuB,EAAIW,UAMP,IAAQ/B,EAAKb,EAAKvlB,QAAUomB,IAAM,CACjC,MAAMvB,EAAMhf,SAASkR,eAAe,MAAQqP,GAC5C,IAAGvB,EACI,MADGA,EAAIC,WAAWC,YAAYF,KAKvC,SAAS8B,EAAgBH,EAAgBnB,EAAIlF,EAAO2I,EAAQC,EAAQhO,GACnE,MAAM2L,GAAWjjB,GAAI,EAAG,GAAIoS,GAAI,EAAG,GAAI+R,MAAOvC,GAC9C,IAAIlF,EAAMngB,OAAU,OAAO0mB,EAC3B,MAAMsC,EAAkBjO,EAAUlY,QAAQ,GAAKsd,EAAM,GAAG/I,YAAclJ,WAAa,EAEnF,GAAGmX,EAAK,IAAM2D,EAEb,IADA,IAAIC,EAAU,IACNA,EAAU,GAAK9I,EAAMngB,OAHJ,IAGiCqlB,GAAM0D,EAASD,IAAWzD,IAErF,MACM6D,GAAgBH,EAASD,IADdE,EAAkB7I,EAAMngB,OAASmgB,EAAMiI,OAAO,SAASe,EAAK1lB,GAAK,OAAO0lB,EAAM1lB,EAAEmiB,QAAW,IAK5G,IAHA,IAAIwD,EAAaN,EACbO,EAAkB,EAEdhD,EAAK,EAAGA,EAAKlG,EAAMngB,OAAQqmB,IAAM,CACxC,MAAMhI,EAAO8B,EAAMkG,GAGbiD,EAAOzjB,SAAS0jB,cAAcC,yBAAyB,6BAA+BnL,EAAK6H,OAAS,UAC1G7H,EAAKwI,QAAUyC,EAAK7C,WACpBD,EAAe5B,YAAYvG,EAAKwI,SAChC,MAAM3Y,EAAW,EAAImQ,EAAKnQ,SAC1BhO,EAAEme,EAAKwI,SAAS4C,SAAS,IAAM1I,EAAM/F,SAAS9M,EAAU6M,EAAUlY,QAAQqL,GAAY,IAGtF,MAAMwb,GAAMV,EAAkB,EAAI3K,EAAKuH,QAAUsD,EAC3CS,EAAaP,EAAcM,EAAK,EAiBtC,GAfS,GAANrE,GAAiB,GAANgB,IACbgD,GAAmBM,GAGpBtL,EAAKmK,aAAgBhjB,EAAG6f,EAAIoD,MAAOkB,EAAaN,GAChDhL,EAAKhI,SAAWkS,EAAelK,EAAKmK,aAEjCnK,EAAKhI,SAAS5S,EAAIijB,EAAOjjB,EAAE,KAAMijB,EAAOjjB,EAAE,GAAK4a,EAAKhI,SAAS5S,GAC7D4a,EAAKhI,SAAS5S,EAAIijB,EAAOjjB,EAAE,KAAMijB,EAAOjjB,EAAE,GAAK4a,EAAKhI,SAAS5S,GAC7D4a,EAAKhI,SAASR,EAAI6Q,EAAO7Q,EAAE,KAAM6Q,EAAO7Q,EAAE,GAAKwI,EAAKhI,SAASR,GAC7DwI,EAAKhI,SAASR,EAAI6Q,EAAO7Q,EAAE,KAAM6Q,EAAO7Q,EAAE,GAAKwI,EAAKhI,SAASR,GAEhEwI,EAAKwI,QAAQ7E,MAAMnd,KAAOwZ,EAAKhI,SAAS5S,EAAI,KAC5C4a,EAAKwI,QAAQ7E,MAAMjd,IAAMsZ,EAAKhI,SAASR,EAAI,KAExCmT,EACF3K,EAAKwI,QAAQ7E,MAAM1M,QAAU,WACvB,CAEN,MAAMsU,EAAUvE,EAAK,GAAKqE,EAAKrL,EAAKuH,OAASP,EAAMqE,EAAKrL,EAAKuH,OAASP,EAAK,EAC3E,GAAGhH,EAAK/D,SAASta,OAAQ,CACxB,MAAM6pB,EAAalD,EAAgBH,EAAgBnB,EAAK,EAAGhH,EAAK/D,SAAU8O,EAAc,GAAMQ,EAAUP,EAAiBD,EAAc,GAAMQ,EAAUP,EAAkBK,EAAI3O,GAC1K8O,EAAWpmB,EAAE,GAAKijB,EAAOjjB,EAAE,KAAMijB,EAAOjjB,EAAE,GAAKomB,EAAWpmB,EAAE,IAC5DomB,EAAWpmB,EAAE,GAAKijB,EAAOjjB,EAAE,KAAMijB,EAAOjjB,EAAE,GAAKomB,EAAWpmB,EAAE,IAC5DomB,EAAWhU,EAAE,GAAK6Q,EAAO7Q,EAAE,KAAM6Q,EAAO7Q,EAAE,GAAKgU,EAAWhU,EAAE,IAC5DgU,EAAWhU,EAAE,GAAK6Q,EAAO7Q,EAAE,KAAM6Q,EAAO7Q,EAAE,GAAKgU,EAAWhU,EAAE,IAC5DgU,EAAWjC,MAAQlB,EAAOkB,QAASlB,EAAOkB,MAAQiC,EAAWjC,QAGlEwB,GAAcM,EAGf,OAAOhD,EAGR,SAAS6B,EAAeuB,GACvB,OACCrmB,EAAGyhB,EAAYE,MAAM0E,EAAItkB,GAAK7C,KAAKonB,IAAID,EAAIrB,OAC3C5S,EAAGqP,EAAYI,MAAMwE,EAAItkB,GAAK7C,KAAKqnB,IAAIF,EAAIrB,QAM7C,SAASP,EAAqBlhB,EAAWijB,GACrClN,MAAM5H,QAAQnO,KAAcA,EAAYA,EAAU3E,KAAK,MAC1D,IAAImC,EAAOqB,SAASkR,eAAe,YAAc/P,GAUhD,OATGxC,KACFA,EAAOqB,SAAS8e,cAAc,QACzB/gB,GAAK,YAAcoD,EACxBxC,EAAKwd,MAAMkI,QAAU,6DACrB1lB,EAAKwC,UAAYA,EAAY,QAC7BnB,SAASskB,KAAKvF,YAAYpgB,IAEb4lB,iBAAiB5lB,GAAM6lB,iBAAiBJ;AC9RzD,IAAI3mB,MAAQ,IAAI,WACf,IAAIA,EAAQhD,KACZA,KAAKuD,IAAKvD,KAAKgqB,KAAMhqB,KAAKwhB,QAASxhB,KAAKyL,QASxC,MAAMwe,GACLC,SAAU,IAAI3J,yBAAyBvgB,MACvCmqB,OAAQ,IAAIhG,uBAAuBnkB,OAGpCA,KAAK6J,SAAWogB,EAAUlnB,QAAQC,MAAM6G,UACxC7J,KAAK6J,SAAS4X,WAEdzhB,KAAKoqB,YAAc,SAASrpB,GAC3B,IAAIkpB,EAAUlpB,GAAS,KAAM,oBAAsBA,EAChDf,KAAK6J,UAAYogB,EAAUlpB,KAC7Bf,KAAK6J,SAASgY,aACd7hB,KAAK6J,SAAWogB,EAAUlpB,GAC1Bf,KAAK6J,SAAS4X,WACdzhB,KAAK8N,WAIP9N,KAAKmQ,SAAW,SAAS1E,GAMxB,IADA,IACShN,EAAI,EAAG2E,GADZinB,EAAW9kB,SAAS+kB,iBAAiB,iCACZ5qB,OAAQjB,EAAI2E,IAAK3E,EAC3C4rB,EAAS5rB,GAAGiI,UAAY2jB,EAAS5rB,GAAGiI,UAAY,aAInD,IAAI2jB,EACJ,IAAS5rB,EAAI,EAAG2E,GADZinB,EAAW9kB,SAAS+kB,iBAAiB,4BACZ5qB,OAAQjB,EAAI2E,IAAK3E,EAAG,CAC9C,IAAImP,EAAWyc,EAAS5rB,GAAG8rB,aAAa,eACxC,GAAI9e,EAAKmC,GAAW,CACnB,IAAI4c,EAAY/e,EAAKmC,GAAU4c,UAC3BC,EAAWhf,EAAKmC,GAAU6c,SAC1BC,EAAYjf,EAAKmC,GAAU8c,UAC3BC,EAAWlf,EAAKmC,GAAU+c,SAC1B5M,EAAOsM,EAAS5rB,GAAGmsB,uBAAuB,gBAAgB,GAE9D,GAAIJ,EAAY,EAAG,CAClB,IAAIK,EAAQ9M,EAAK6M,uBAAuB,SAAS,GACjDC,EAAMnkB,UAAYmkB,EAAMnkB,UAAUpF,QAAQ,aAAc,IACxDupB,EAAMC,aAAa,eAAgBN,EAAY,UAGhD,GAAIC,EAAW,EAAG,CACjB,IAAIM,EAAOhN,EAAK6M,uBAAuB,QAAQ,GAC/CG,EAAKrkB,UAAYqkB,EAAKrkB,UAAUpF,QAAQ,aAAc,IACtDypB,EAAKD,aAAa,eAAgBL,EAAW,cAG9C,GAAIC,EAAY,EAAG,CAClB,IAAIM,EAAQjN,EAAK6M,uBAAuB,SAAS,GACjDI,EAAMtkB,UAAYskB,EAAMtkB,UAAUpF,QAAQ,aAAc,IACxD0pB,EAAMF,aAAa,eAAgBJ,EAAY,eAGhD,GAAIC,EAAW,EAAG,CACjB,IAAIM,EAAOlN,EAAK6M,uBAAuB,QAAQ,GAC/CK,EAAKvkB,UAAYukB,EAAKvkB,UAAUpF,QAAQ,aAAc,IACtD2pB,EAAKH,aAAa,eAAgBH,EAAW,gBAUlD,OALI1U,uBAAuBiV,kBAAoBjV,uBAAuBiV,iBAAiBxrB,OAAS,GAC/FuW,uBAAuBkV,OAAOvrB,EAAE,wBAEjCqW,uBAAuBJ,OAAOjW,EAAE,iEAEzB6L,GAGRzL,KAAKorB,SAAW,SAAS3f,GAOxB,IAAK,IAAItI,KAHTvD,EAAE,uEAAuE2G,SAAS,aAGpEkF,EACb7L,EAAE,2BAA2B6L,EAAKtI,GAAGyK,SAAS,yBAAyBnH,YAAY,aACnF7G,EAAE,2BAA2B6L,EAAKtI,GAAGyK,SAAS,kCAAkCnH,YAAY,aAAasB,KAAK0D,EAAKtI,GAAGkoB,OAKvH,OAFAjU,iBAAiBvB,OAAOjW,EAAE,iDAEnB6L,GAGRzL,KAAKsb,OAAS,SAAS7P,GAWtB,GANA7L,EAAE,sBAAsB6G,YAAY,gCAGpC7G,EAAE,iBAAiB6G,YAAY,oBAG3BgF,EACH,IAAK,IAAItI,KAAKsI,EAAK6P,OAAQ,CAC1B,IAAI1N,EAAWnC,EAAK6P,OAAOnY,GAAGyK,SAC1ByN,EAAQ5P,EAAK6P,OAAOnY,GAAGkY,MAEvB/O,GAAO1M,EAAE,0BAA0BgO,EAAS,KAAKrH,SAAS8U,EAAM,QAAQvE,SAASlY,QAAU,GAAK,EAAI,EAEpG0N,EAAM,GACT1M,EAAE,oBAAoB0M,EAAI,KAAK/F,SAAS8U,GAAOiQ,OAAO/kB,SAAS8U,GAKlE,OAAO5P,GAGRzL,KAAK+I,KAAO,WAGX,GAA+B,GAA3BhG,QAAQC,MAAMoG,UAEjB,OADAxJ,EAAE,iBAAiB2G,SAAS,WACrB,EAGR3G,EAAE,iBAAiB6G,YAAY,UAI/B,IAAIgd,EAAOphB,KAAKkpB,IAAI,EAAoE,EAAjE3rB,EAAE,sDAAsDF,OAAa,GAC5FE,EAAE,oBAAoB6jB,EAAK,KAAKld,SAAS,WAG1CvG,KAAK6f,MAAQ,SAAStc,GACrB,IAAIP,GAASqe,OAAQC,MAAO,SAAU3e,KAAM,WAAY2e,MAAO,SAAU3e,KAAM,WAAY8gB,SACvF+H,GAAa,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAC7EC,KAiBJ,SAASC,EAAS9d,EAAUtK,GAC3B,IAAKsK,IAAapK,SAASC,QAAQmK,GAClC,OAAO,EACR,MAAM+d,EAAM5oB,QAAQC,MAAMqG,KAAKtG,QAAQC,MAAMiG,QAE7C,OAAO2iB,EAAehe,EAAUtK,EAAI,KAAM,KAD1BqoB,GAAuB,GAAhBA,EAAI/d,UAAiB,EAAI+d,EAAI/d,SAASrL,QAAQ,KAAOQ,QAAQC,MAAMqG,KAAKtG,QAAQC,MAAMiG,QAAQlI,UAAOJ,EACnE,UAAW,cAGrE,SAASirB,EAAehe,EAAUtK,EAAIuoB,EAAMC,EAASvX,EAAYwX,EAAgBC,GAEhF,IAAInoB,EA0FL,SAAuB+J,GACtB,MAAMlK,EAASF,SAASC,QAAQmK,GAChC,IAAIqe,EAAsC,iBAAf,GAA2Bre,EAASrL,QAAQ,MAAQ,EAAIiB,SAASqQ,YAAYjG,EAAShI,UAAU,EAAGgI,EAASrL,QAAQ,OAAS,KACxJ,MAAMwe,EAAYrd,EAASA,EAAOC,MACjCsoB,GAAoD,UAAlCA,EAAermB,UAAU,EAAG,GAAiB,EAAIqmB,EAAermB,UAAU,QAC5FjF,EACKurB,EAAexoB,EAASA,EAAOE,SAClB,YAAlBqoB,EAA+B,GACb,WAAlBA,EAA8B,GACZ,YAAlBA,GAAgC,QAChCtrB,EAED,OAAIogB,EACI,yBAA2BA,EAAY,MAAQA,EAAY,UAC1DmL,GAAgB,IACjB,gCACCA,EAAe,EAChB,iCACCA,GAAgB,EACjB,kCACI,SA9GKC,CAAcve,GAC/B,MAAMlK,EAASF,SAASC,QAAQmK,GAEhC,IAAIwe,EAAc,KAAMhS,EAAS,KACjC,GAAI1W,GAAUA,EAAO0W,OAAQ,CAC5B,OAAO1W,EAAO0W,QACb,IAAK,aACJgS,EAAc,YACd,MACD,IAAK,uBACJA,EAAc,uBACd,MACD,IAAK,WACJA,EAAc,WACd,MACD,IAAK,SACJA,EAAc,SACd,MACD,IAAK,YACJA,EAAc,YACd,MACD,IAAK,kBACJA,EAAc,aAIhBhS,EAAS1W,EAAO0W,OAGjB,MAAMiS,EAC4B,QAAjCtpB,QAAQC,MAAMwG,gBAA6B+K,IAA0B7Q,EAASA,EAAO3C,KAAO,UAC3D,eAAjCgC,QAAQC,MAAMwG,iBACZ+K,EAAaA,GAAc7Q,EAAS,MAAQA,EAAO3C,KAAO,IAC3D2C,EAASA,EAAO3C,KAAO,SAEzB,IAAIgd,GAAQ9Y,EAAG3B,EAAIsK,SAAUA,GACzB0e,EAAY,gBAAgBhpB,EAAG,kBAAkBsK,EAAS,KAC3Die,EAAO,gBAAgBA,EAAK,IAAM,KAClCC,EAAU,kBAAkBA,EAAQ,IAAM,IAC3C,iBAAoBE,OAAyBjqB,KAAK,KAAQ,2EAG5BqqB,EAAc,cAAcA,EAAY,mBAAmBhS,EAAO,IAAM,MAAM,0JAO/EvW,EAAW,gCAElCH,EAAS,qBAAqBA,EAAO3C,KAAK,KAAKsrB,EAAe,OAASA,GACzE,6BAC0BN,EAAiB,6BA7ElD,SAAuBQ,GACtB,IAAIA,EAAW,MAAO,GACtB,MAAMC,GAAiBC,WAAY,IAAKC,UAAW,IAAKC,WAAY,IACnEC,UAAW,IAAKC,UAAW,IAAKC,UAAW,IAAKC,UAAW,IAAKC,UAAY,EAAGC,UAAW,GAErFC,GAAaC,EAAG,QAASC,EAAG,SAAUC,EAAG,WAC/C,OAAOd,EAAQhpB,IAAI,SAASye,GAC3B,MAAMhO,EAAOwY,EAAahpB,SAASM,UAAUke,GAAGje,SAGhD,MAAO,iBAFWmpB,EAASlZ,IAAS,SAAYA,GAEX,mBADzBxQ,SAASM,UAAUke,GAAGje,QAAU,QAAUie,EACU,KAAOhO,EAAO,YAC5EjS,KAAK,IAoEFurB,CAAc5pB,EAASA,EAAO6oB,YAC9B,qPAQN,OAFAxO,EAAK8H,EAAIyG,EAEFvO,EAGR,SAASwP,EAAkBC,EAASzP,EAAM0P,GACzC,IAAItN,EAAO5B,SAAS0B,iBAAiBzc,SAASD,IAAI2c,UAAWuN,EAAe,IAAU1P,EAAK2P,MAAM9f,SAAW,MAExG+f,GAAaC,YAAY,EAC7Bpc,KAAgB,OAChBsF,WAeA,OAdA6W,EAAS7W,OAAOxT,GAAKya,EAAK2P,MAAMpqB,GAChCqqB,EAAS7W,OAAOlJ,SAAWmQ,EAAK2P,MAAM9f,SACtC+f,EAAS7W,OAAO/V,KAAOgd,EAAK2P,MAAM3sB,KAClC4sB,EAAS7W,OAAOnU,KAAOob,EAAK2P,MAAM/qB,KAClCgrB,EAAS7W,OAAO+W,IAAM9P,EAAK2P,MAAMG,IAEjCF,EAASD,SACTC,EAASD,MAAMpqB,KAAOkqB,EACtBG,EAASD,MAAM9f,SAAW6f,EAC1BE,EAASD,MAAM3sB,KAAOyC,SAASC,QAAQgqB,GAAc1sB,KACrD4sB,EAASD,MAAMvN,KAAOA,EACtBwN,EAASD,MAAM7C,MAAQ1K,EAAKzgB,OAAS,EACrCiuB,EAASD,MAAMG,IAAM,MAEZL,QAAAA,EAASG,SAAAA,GA0BnB,SAASG,EAAUpqB,GAClB,GAAIA,EAAO,IAAM,EAAG,OAAO,EAE3B,IAAIqqB,EAAWhhB,SAASrJ,EAAO,IAAK8pB,EAAUQ,EAAUtuB,OAExD,IAAK,IAAIyD,KAAK8qB,EAAW,CACxB,IAAIxa,EAAWwa,EAAU9qB,GACzB,IAA0C,GAAtCvD,EAAEuN,QAAQsG,EAASnQ,GAAI4qB,GAAkB,CAC5C,IAAIC,EAAMC,EAAMC,EACfvX,EAAQ4W,EAAOY,EAAYC,EAU5B,GATuB,aAAnB9a,EAASqD,QACZqX,EAAO3qB,SAASqM,OAAO/F,WAAW2J,EAASE,aAC3Cya,EAAO5qB,SAASqM,OAAO/F,WAAW2J,EAASC,aAE3Cya,EAAO3qB,SAASqM,OAAO/F,WAAW2J,EAASC,WAC3C0a,EAAO5qB,SAASqM,OAAO/F,WAAW2J,EAASE,cAE5C0a,EAAW5a,EAAS9Q,KAAiB,OAEjCwrB,GAAQA,EAAKvgB,UAAYlK,EAAO,GACnCoT,EAASqX,EAAMT,EAAQU,EACvBE,EAJoC,OAIbC,EAAYF,MAC7B,CAAA,IAAGD,GAAQA,EAAKxgB,UAAYlK,EAAO,GAGjC,SAFRoT,EAASsX,EAAMV,EAAQS,EACvBI,EAPoC,OAOdD,EAAaD,EAGpC,IAAItQ,KAiCJ,GAhCAA,EAAKza,GAAKmQ,EAASnQ,GACnBya,EAAKvM,KAAOiC,EAASjC,KACrBuM,EAAKtM,KAAOgC,EAAShC,KACrBsM,EAAKxe,KAAOuX,EAAO5E,aAEnB6L,EAAKjH,UACLiH,EAAKjH,OAAOxT,GAAKyqB,EACjBhQ,EAAKjH,OAAOlJ,SAAWpK,SAASC,QAAQqT,EAAOlJ,UAAYkJ,EAAOlJ,SAAWkJ,EAAOlJ,SAAW,IAAMvL,KAAKmsB,MAAMnsB,KAAKosB,SAAWpsB,KAAKmsB,MAAM,MAC3IzQ,EAAKjH,OAAO/V,KAAO+V,EAAO/V,KAC1Bgd,EAAKjH,OAAOnU,KAAO2rB,EACnBvQ,EAAKjH,OAAO4X,OAAS,KACrB3Q,EAAKjH,OAAO6X,QAAU,KACtB5Q,EAAKjH,OAAO+W,IAAM,KAClB9P,EAAKjH,OAAOtD,YAAcka,EAAMla,YAChCuK,EAAKjH,OAAO8X,SAAWlB,EAAMpqB,GAE7Bya,EAAK2P,SACL3P,EAAK2P,MAAMpqB,KAAOkqB,EAClBzP,EAAK2P,MAAM9f,SAAWpK,SAASC,QAAQiqB,EAAM9f,UAAY8f,EAAM9f,SAAW8f,EAAM9f,SAAW,IAAMvL,KAAKmsB,MAAMnsB,KAAKosB,SAAWpsB,KAAKmsB,MAAM,MACvIzQ,EAAK2P,MAAM3sB,KAAO2sB,EAAM3sB,KACxBgd,EAAK2P,MAAM/qB,KAAO4rB,EAClBxQ,EAAK2P,MAAMgB,OAAS,KACpB3Q,EAAK2P,MAAMiB,QAAU,KACrB5Q,EAAK2P,MAAMG,IAAM,KACjB9P,EAAK2P,MAAMla,YAAcsD,EAAOtD,YAChCuK,EAAK2P,MAAMkB,SAAW9X,EAAOxT,GAE7BurB,EAAWpvB,KAAKse,GAChBiQ,EAAUvuB,MAAMse,EAAK2P,MAAM9f,SAAUmQ,EAAK2P,MAAMpqB,GAAII,EAAO,KAC3DwqB,EAAUzuB,KAAKse,EAAKza,IAGhB1D,EAAE,iBAAiB2P,SAAS,WAAa/L,SAASC,QAAQsa,EAAK2P,MAAM9f,YAAcpK,SAASC,QAAQkE,iBAAiBhE,QAAUH,SAASC,QAAQsa,EAAK2P,MAAM9f,UAAUjK,OAASgE,iBAAmBoW,EAAK2P,MAAM9f,SAE/M4f,GADIG,EAAWJ,EAAkBC,EAASzP,EAAMpW,kBAC7B6lB,QAEnBqB,EAAWpvB,KAAKkuB,EAASA,UACzBK,EAAUvuB,MAAM,EAAG+tB,IAGpB,GAAI5tB,EAAE,kBAAkB2P,SAAS,WAAa/L,SAASC,QAAQsa,EAAK2P,MAAM9f,YAAcpK,SAASC,QAAQsa,EAAK2P,MAAM9f,UAAUjK,MAC7H,IAAK,IAAIR,KAAKJ,QAAQ+F,UAAW,CAIhC,IAAI6kB,EAHJ,KAAInqB,SAASC,QAAQV,QAAQ+F,UAAU3F,IAAI2rB,UAAY,MAAYtrB,SAASC,QAAQsa,EAAK2P,MAAM9f,UAAUkhB,UAAY,MAAY/rB,QAAQ+F,UAAU3F,IAAM4a,EAAK2P,MAAM9f,UAIpK4f,GADIG,EAAWJ,EAAkBC,EAASzP,EAAMhb,QAAQ+F,UAAU3F,KAC/CqqB,QAEnBqB,EAAWpvB,KAAKkuB,EAASA,UACzBK,EAAUvuB,MAAM,EAAG+tB,OAOxB,GAAI5tB,EAAE,uBAAuBF,OAAS,EAAG,CACxC,IAAI+D,EAAU7D,EAAE,6BAA6B6L,KAAK,OAAO5J,WAAWC,MAAM,KACtEksB,KACAC,EAAY1qB,EACZsrB,KACAX,KAEJ,GAAe,GAAXzqB,EAAc,CACW,IAAIhF,EAAI,EACRN,OAAO8C,KAAKsC,GAAK8c,QAAsBjZ,QAAQjE,IACnE,MAAM2T,EAAStT,SAASqM,OAAO/F,WAAWvG,EAAIJ,GAAGuQ,WAC3Cga,EAAQlqB,SAASqM,OAAO/F,WAAWvG,EAAIJ,GAAGwQ,aAChBmD,GAAUtT,SAASC,QAAQqT,EAAOlJ,gBAAgE,IAA5CpK,SAASC,QAAQqT,EAAOlJ,UAAe,OACnInP,IAEAuE,EAAMygB,KAAKhkB,MAAMgjB,GAAIiJ,EAAS5U,EAAOlJ,SAAUnP,IAAKwG,EAAG,SACvD+oB,EAAUvuB,MAAMqX,EAAOlJ,SAAUnP,EAAGqY,EAAOlJ,YACE8f,GAASlqB,SAASC,QAAQiqB,EAAM9f,gBAA+D,IAA3CpK,SAASC,QAAQiqB,EAAM9f,UAAe,QAC9HnP,IAETuE,EAAMygB,KAAKhkB,MAAMgjB,GAAIiJ,EAASgC,EAAM9f,SAAUnP,IAAKwG,EAAG,SACtD+oB,EAAUvuB,MAAMiuB,EAAM9f,SAAUnP,EAAGivB,EAAM9f,mBAI3C,IAAK,IAAIzK,KAAKM,EAEbT,EAAMygB,KAAKhkB,MAAMgjB,GAAIiJ,EAASjoB,EAAQN,GAAI4J,SAAS5J,GAAK,IAAK8B,EAAG,SAChE+oB,EAAUvuB,MAAMgE,EAAQN,GAAI4J,SAAS5J,GAAK,EAAGM,EAAQN,KAIvD,IAAK,IAAI1E,EAAI,EAAGA,EAAIuvB,EAAUtuB,OAAQjB,IACrCqvB,EAAUE,EAAUvvB,QAEf,CACNmB,EAAE,eAAe6U,OAEjB,IAAInI,GAAOmW,MACP7U,EAAWjG,gBAEf2E,EAAImW,EAAEhjB,KAAKisB,EAAS9d,EAAU,IAAK3I,EAAG,OAEtCjC,EAAMygB,KAAKhkB,KAAK6M,GAOhB,IALI0hB,IAAcpgB,EAAU,IACxBqgB,EAAY1qB,EACZsrB,KACAX,KAEKzvB,EAAI,EAAGA,EAAIuvB,EAAUtuB,SAAUjB,EACvCqvB,EAAUE,EAAUvvB,IAItB,MAAMswB,KACN,IAAK,IAAI5rB,KAAK0rB,EAAY,CACzB,IAAI9Q,EAAO8Q,EAAW1rB,GAClBmJ,GAAOmW,MAEX,MAAMuM,EAA6C,MAAnCjsB,QAAQC,MAAM,kBAA6B+a,EAAK2P,MAAMla,YAAcuK,EAAK2P,MAAMla,YAAY5N,UAAU,EAAG,GAAK,OAC1HmY,EAAK2P,MAAM/qB,MAAQ,OAASF,UAAUsb,EAAK2P,MAAMgB,OAAQ,QACtD3C,EAAiBhO,EAAK2P,MAAMvN,KA7RpBngB,KA8RJivB,WAAWlR,EAAK2P,MAAMvN,MAC/B,gEAAkEpC,EAAK2P,MAAMkB,SAAW,0CACvF7Q,EAAKjH,OAAO/V,MAAyC,OAAjCgC,QAAQC,MAAMwG,gBAA2BuU,EAAKjH,OAAO/V,KACzEgd,EAAKjH,OAAO/V,MAAyC,cAAjCgC,QAAQC,MAAMwG,gBAAkCuU,EAAKjH,OAAO/V,KAAO,MAAQiuB,EAC/FA,GACG,OACChD,EAAoBjO,EAAK6P,YAAc,QAAUmB,EAAkBhR,EAAK2P,MAAM9f,WAAc,WAC5F8f,EAAQ9B,EAAe7N,EAAK2P,MAAM9f,SAAUmQ,EAAK2P,MAAMpqB,GAAIya,EAAKza,GAAIya,EAAK2P,MAAMkB,SAAU7Q,EAAKjH,OAAO/V,KAAMgrB,EAAgBC,GAEjI,IAAIlV,GAAU7R,EAAG8Y,EAAKjH,OAAOxT,IAE7BgJ,EAAImW,EAAEhjB,KAAKiuB,EAAO5W,GAClB9T,EAAMygB,KAAKhkB,KAAK6M,GAEhB,IAAI4iB,KACa,YAAbnR,EAAKvM,MAAsB0d,EAAUzvB,KAAK,OAC7B,YAAbse,EAAKtM,KAAsByd,EAAUzvB,KAAK,YACxB,UAAbse,EAAKtM,MAAoByd,EAAUzvB,KAAK,WAEH,GAA3CG,EAAEuN,QAAQ4Q,EAAKjH,OAAOnU,KAAM6oB,KAA8D,GAA1C5rB,EAAEuN,QAAQ4Q,EAAK2P,MAAM/qB,KAAM6oB,IAAoB0D,EAAUzvB,KAAK,QAE9GyvB,EAAUxvB,QAAU+rB,EAAYhsB,KAAKgd,MAAMiR,EAAMzoB,EAAG6R,EAAO7R,EAAGiqB,EAAWnR,EAAKza,KAE7Eya,EAAK6P,aAAcmB,EAAkBhR,EAAK2P,MAAM9f,UAAYtB,GAQjE,OAJAmf,EAAYzL,WAIJzc,IAAOP,EAAO8e,MAAS2J,IAGhCzrB,KAAKivB,WAAa,SAAS9O,GAC1B,GAAGA,EAAKzgB,QAAU,GAAKygB,EAAKzgB,OAASqD,QAAQC,MAAMyG,aAAgB,MAAO,GAAK0W,EAAKzgB,OAAS,EAY5F,IAVA,IAAIyvB,EAAehP,EAClBE,MAAM,EAAGF,EAAKzgB,OAAS,GAAGsgB,UAC1Bzc,IAAI,SAASye,GACb,IAAIte,EAAS0rB,QAAQ3rB,QAAQ,IAAW,EAAIue,GAI5C,MAAO,iBAHate,EAAOE,UAAY,IAAO,QAC7CF,EAAOE,UAAY,EAAM,SACzB,WACwC,mBAAqBF,EAAO3C,KAAO,KAAO2C,EAAOE,SAAW,sBAElGsB,EAAI,sBACAzG,EAAI,EAAGA,EAAI0wB,EAAazvB,OAAQjB,IACpCA,EAAI,GAAK,GAAKA,EAAI,IAAKyG,GAAK,KAE/BA,GAAKiqB,EAAa1wB,GAEnB,OAAOyG,EAAI,WAIblF,KAAK8N,OAAS,WACb9N,KAAKoqB,YAAYrnB,QAAQC,MAAM6G,UAE/B,IAAI4B,EAAO7L,EAAE4B,QAAO,KAAUxB,KAAKyL,MACnCA,EAAKlI,IAAM3D,EAAE4B,QAAO,KAAUiK,EAAK4jB,QAEnCrvB,KAAK8Q,KAAKrF,IAGX,IAAI6jB,EAAiB,KAErBtvB,KAAK8Q,KAAO,SAASrF,GAChBA,OAAwB,IAAX,EAAyBA,KAI1C,GAHAT,aAAaskB,IAGRtvB,KAAK6J,SAAS0X,SAAYpjB,OAAOkB,KAAKoM,EAAKlI,OAASC,SAASqM,OAAO/F,WACxEwlB,EAAiBrkB,WAAW,WAAajI,EAAM8N,KAAKrF,IAAS,SAD9D,CAKA,GAAIA,EAAKlI,IAAK,CACbvD,KAAKwhB,SAAU,EAEfxhB,KAAKyL,KAAK4jB,OAASzvB,EAAE4B,QAAO,KAAUiK,EAAKlI,KAa3CpF,OAAOC,KAAKqN,EAAKlI,IAAK,MAEtB3D,EAAE4B,OAAOiK,EAAMzL,KAAK6f,MAAMpU,EAAKlI,MAC/B3D,EAAE4B,OAAOxB,KAAKyL,KAAMA,GAEpB,MAAMwY,EAAmBlhB,QAAQC,MAAMqG,KAAKtG,QAAQC,MAAMiG,SAAWlG,QAAQC,MAAMqG,KAAKtG,QAAQC,MAAMiG,QAAQwR,cAE9Gza,KAAK6J,SAASiH,KAAKrF,EAAKlI,IAAKkI,EAAKqW,MAAOmC,GAIzCjkB,KAAK+I,OAGLnJ,EAAE,2BAA2B+H,gBAAgB,MAAMmP,SAASvQ,SAAS,eAGjE0Q,qBAAqBiU,kBAAoBjU,qBAAqBiU,iBAAiBxrB,OAAS,GAC3FuX,qBAAqBkU,OAAOvrB,EAAE,wBAE/BqX,qBAAqBpB,OAAOjW,EAAE,mCAC9BoX,sBAAsBnB,OAAOjW,EAAE,uCAE/BI,KAAKwhB,SAAU,GAIXxhB,KAAKyL,KAAK0E,UAAY,IAAI/Q,KAASY,KAAKyL,KAAK0E,SAASof,SAC1D9jB,EAAK0E,YACL3M,SAAS4M,IAAIof,gBACX7X,KAAK,SAAS3S,EAASyqB,EAAQrT,GAC/B3Q,EAAK0E,SAASof,QAAU,IAAInwB,KAAKgd,EAAQsT,kBAAkB,YAC3D9vB,EAAEgB,KAAKoE,EAAS,SAAS7B,GACxBsI,EAAK0E,SAASnL,EAAQ7B,GAAGwsB,YACxB/hB,SAAU5I,EAAQ7B,GAAGwsB,UACrBnF,UAAWxlB,EAAQ7B,GAAGysB,gBAIxBC,KAAK,WACJ,OAAOrsB,SAAS4M,IAAI0f,gBACnBnY,KAAK,SAAS3S,GACdpF,EAAEgB,KAAKoE,EAAS,SAAS7B,GACpBsI,EAAK0E,SAASnL,EAAQ7B,GAAGwsB,YAC5BlkB,EAAK0E,SAASnL,EAAQ7B,GAAGwsB,WAAWlF,SAAWzlB,EAAQ7B,GAAG4sB,UAC1DtkB,EAAK0E,SAASnL,EAAQ7B,GAAGwsB,WAAWjF,UAAY1lB,EAAQ7B,GAAG6sB,WAC3DvkB,EAAK0E,SAASnL,EAAQ7B,GAAGwsB,WAAWhF,SAAW3lB,EAAQ7B,GAAG8sB,WAE1DxkB,EAAK0E,SAASnL,EAAQ7B,GAAGwsB,YACxB/hB,SAAU5I,EAAQ7B,GAAGwsB,UACrBlF,SAAUzlB,EAAQ7B,GAAG4sB,UACrBrF,UAAW1lB,EAAQ7B,GAAG6sB,WACtBrF,SAAU3lB,EAAQ7B,GAAG8sB,iBAM1BJ,KAAK,WACL7sB,EAAMyI,KAAK0E,SAAWnN,EAAMmN,SAAS1E,EAAK0E,aAElC1E,EAAKlI,KACfP,EAAMmN,SAASnQ,KAAKyL,KAAK0E,UAGtB1E,EAAK2f,WACRprB,KAAKyL,KAAK2f,SAAWprB,KAAKorB,SAAS3f,EAAK2f,WAGrC3f,EAAK6P,SACRtb,KAAKyL,KAAK6P,OAAStb,KAAKsb,OAAO7P,EAAK6P,WAItCtb,KAAKkkB,gBAAkB,SAASD,GAC3BlhB,QAAQC,MAAMqG,KAAKtG,QAAQC,MAAMiG,UACpClG,QAAQC,MAAMqG,KAAKtG,QAAQC,MAAMiG,QAAQwR,UAAYwJ,GAItDrkB,EAAE,2BAA2B+H,gBAAgB,MAAMmP,SAASvQ,SAAS,eAEjE0Q,qBAAqBiU,kBAAoBjU,qBAAqBiU,iBAAiBxrB,OAAS,GAC3FuX,qBAAqBkU,OAAOvrB,EAAE,wBAE/BqX,qBAAqBpB,OAAOjW,EAAE,mCAE9BoD,EAAMmN,SAASnN,EAAMyI,KAAK0E,UAE1BnN,EAAMooB,SAASpoB,EAAMyI,KAAK2f,UAE1BpoB,EAAMsY,OAAOtY,EAAMyI,KAAK6P,QAExBtY,EAAM+F,OAENhG,QAAQmI;AC9mBV1H,SAASyF,OAAS,SAASwC,GACvB,IAAIykB,KACAC,KAEJ,IAAK,IAAIhtB,KAAKsI,EAAM,CAChB,IAAI0E,EAAWhI,KAAKC,MAAMqD,EAAKtI,GAAGgN,UAClC+f,EAASzwB,KAAKsN,SAASoD,EAASigB,UAChCD,EAAa1wB,KAAKsN,SAASoD,EAASkgB,cAEhClgB,EAASigB,SACTxwB,EAAE,yBAAyBuQ,EAASigB,QAAQ,MAGvC7pB,SAAS,WACTtH,KAAK,MACLqxB,SAASC,gBAAiB,WAAY,KAG3CpgB,EAASkgB,aAAezwB,EAAE,qCAAqCuQ,EAASkgB,YAAY,WAAW3wB,OAAS,GACxGE,EAAE,qCAAqCuQ,EAASkgB,YAAY,MACvD9pB,SAAS,WACTtH,KAAK,kBAAkB8I,KAAK0D,EAAKtI,GAAGwF,cAAgB,eAAekK,SAIhFjT,EAAE,wBAAwBgB,KAAK,YACqB,GAA5ChB,EAAEuN,QAAQvN,EAAEI,MAAMyL,KAAK,MAAOykB,IAC9BtwB,EAAE,yBAAyBA,EAAEI,MAAMyL,KAAK,MAAM,MAGzChF,YAAY,WACZxH,KAAK,MACLqxB,SAASC,gBAAiB,QAAS,IAAM,KAAM,WAAY3wB,EAAEI,MAAM2M,KAAK4jB,gBAAiB,SAItG3wB,EAAE,4BAA4BgB,KAAK,YACqB,GAAhDhB,EAAEuN,QAAQvN,EAAEI,MAAMyL,KAAK,MAAO0kB,IAC9BvwB,EAAE,qCAAqCA,EAAEI,MAAMyL,KAAK,MAAM,MACrDhF,YAAY,WACZxH,KAAK,kBAAkBuxB,QAAQ,WAAY5wB,EAAEI,MAAM+H,KAAK;ACtCzEvE,SAASitB,OAAS,SAASrS,EAAKsS,EAAQC,GACpC,IACIL,OAAqC,KADrCI,EAASA,OACsB,SAAoBA,EAAOJ,QAE1D7c,GADAkd,EAAWA,IAAY,MAG3B,GAAgB,YAAZvS,EAAIzb,KAAoB,CAExB,KADI8Q,EAAWtV,OAAO4G,OAAOvB,SAASqM,OAAO/L,WAAW7E,KAAK,SAAU2xB,GAAM,OAAOA,EAAGld,WAAa0K,EAAI9a,IAAMstB,EAAGjd,aAAeyK,EAAI9a,MACrH,OAAO,EACtB,IAAIsQ,EAAiBwK,EAAI9a,IAAMmQ,EAASC,UAAYlQ,SAASqM,OAAO/F,WAAW2J,EAASE,aAAenQ,SAASqM,OAAO/F,WAAW2J,EAASC,WAC3I,IAAKE,EAAgB,OAAO,EAExBwK,EAAIrd,KACNgD,QAAUP,SAASC,QAAQmQ,EAAehG,UAAY,qBAAqBpK,SAASC,QAAQmQ,EAAehG,UAAU7M,KAAK,KAAKqd,EAAIrd,KAAK,OAASqd,EAAIrd,KAC5IyC,SAASqQ,YAAYD,EAAehG,UAC3C7J,QAAUP,SAASqQ,YAAYD,EAAehG,UACvCpK,SAASC,QAAQmQ,EAAehG,UACvC7J,QAAU,qBAAqBP,SAASC,QAAQmQ,EAAehG,UAAU7M,KAAK,KAAKyC,SAASC,QAAQmQ,EAAehG,UAAU7M,KAAK,OAElIgD,QAAU,GAGd,IAAIuI,EAAM,gBAAgB8R,EAAI9a,GAAG,sBAAuBqtB,EAAW,sBAAwB,IAAK,eAC3E5tB,QAAQ+G,WAAWI,UAAUC,MAAO,MAAMiU,EAAI5K,YAAc4K,EAAI5K,YAAY5N,UAAU,EAAG,GAAG,KAAKwY,EAAI5K,YAAY5N,UAAU,EAAG,IAAM,OAAS,WAAW,gCAC3I7C,QAAQ+G,WAAWI,UAAUE,QAAS,oBAAoBpK,KAAKkR,UAAUuC,GAAU,MAAOA,EAASA,EAASqD,OAAO,OAASsH,EAAI9a,GAAKmQ,EAAS9Q,MAAQ,GAAM8Q,EAASqD,OAAS,OAAS,IAAK,+BAC7L/T,QAAQ+G,WAAWI,UAAUG,QAAuC,IAA7B0C,SAASqR,EAAItK,YAAoB,YAAc,IAAK,mBAAmB9T,KAAK2R,WAAWyM,GAAK,qBAAqBA,EAAIvM,SAAS,4BACjL9O,QAAQ+G,WAAWI,UAAUnG,QAAS,MAAMA,SAAW,IAAI,mBAC5D0P,EAASjC,KAAK,IAAKzO,QAAQ+G,WAAWI,UAAUI,QAAS,KAAKmJ,EAASjC,KAAK,mBAC5EiC,EAAShC,KAAK,IAAK1O,QAAQ+G,WAAWI,UAAUK,QAAS,KAAKkJ,EAAShC,KAAK,aAG5Fof,EAAKjxB,EAAE0M,QAEPA,EAAM,gBAAgB8R,EAAI9a,GAAG,sBAAuBqtB,EAAW,sBAAwB,IAAK,eAC3E5tB,QAAQ+G,WAAWI,UAAUC,MAAO,MAAMiU,EAAI5K,YAAc4K,EAAI5K,YAAY5N,UAAU,EAAG,GAAG,KAAKwY,EAAI5K,YAAY5N,UAAU,EAAG,IAAM,OAAS,WAAW,mBACxJ7C,QAAQ+G,WAAWI,UAAUE,QAAS,KAAKgU,EAAIzb,KAAK,+BACxCI,QAAQ+G,WAAWI,UAAUG,QAAuC,IAA7B0C,SAASqR,EAAItK,YAAoB,YAAc,IAAK,mBAAmB9T,KAAK2R,WAAWyM,GAAK,qBAAqBA,EAAIvM,SAAS,4BACjL9O,QAAQ+G,WAAWI,UAAUnG,QAAS,kBAAkBqa,EAAIrd,KAAKiX,QAAQoG,EAAIrd,MAAM,IAAI,aAGxG8vB,EAAKjxB,EAAE0M,GAGfsJ,SAASC,OAAOjW,EAAEixB,GAAI5xB,KAAK,mBAE3BW,EAAE,aAAaiO,OAAOgjB,GAGD,YAAjBpd,EAASjC,KACT5R,EAAEixB,GAAI5xB,KAAK,kBAAkB0R,WAAWmgB,MAAOC,OAAOC,IAAI5S,EAAIrK,UAAUkd,SAAUC,SAAUlxB,KAAK+Q,QAASogB,cAAc,EAAMC,SAAS,EAAMtuB,OAAQ9C,KAAKuQ,UAAW8gB,WAAYrxB,KAAK4Q,WAAWjR,UAE5L4G,SAAS,YAGd3G,EAAEixB,GAAI5xB,KAAK,kBAAkB0R,WAAWK,MAAO+f,OAAOC,IAAI5S,EAAIvM,UAAUof,SAAUG,SAAS,EAAMtuB,OAAQ9C,KAAKuQ,UAAW8gB,WAAYrxB,KAAK4Q,WAAWjR,UAGrJ2wB,IACA1wB,EAAEixB,GACG5xB,KAAK,MACLqyB,UAAU,0BACVxa,SACA7X,KAAK,YACLsyB,UAAU,IAAK,WACZC,KAAO5xB,EAAEI,MACTwxB,KAAKC,YAAYD,KAAKE,cAG9B9xB,EAAEixB,GAAI5xB,KAAK,MAAMqxB,SAASC,gBAAiB,WAAY,KAAMxlB,MAAM,KAAMulB,SAASC,gBAAiB,QAAS,IAAM,KAAM,WAAY3wB,EAAEI,MAAM2M,KAAK4jB,gBAAiB;ACrE1K/sB,SAASmuB,IAAM,WACX3xB,KAAK4xB,UACL5xB,KAAK6xB,WAEL7xB,KAAK2xB,IAAIG,OAAS,WACd,IAAI/uB,GAAWiO,MAAOxN,SAASmuB,IAAIE,WAAYf,MAAO,KAAMhuB,OAAQ,KAAMmO,OAAQ,oBAClFrR,EAAE,aAAa+Q,UAAU,SAAU5N,IAGvC/C,KAAK2xB,IAAIvf,QAAU,WACfxS,EAAE2L,MACEC,IAAK,iBACLkM,OAAO,EACP/L,SAAU,OACVF,KAAM,aAAajI,SAASmuB,IAAIC,YACjCja,KAAK,SAASlM,GACb,GAAIA,GAAQA,EAAKomB,WAAY,CACzBruB,SAASmuB,IAAIC,UAAYnmB,EAAKmmB,UAC9BpuB,SAASmuB,IAAIE,WAAa,IAAIzyB,KAAKqM,EAAKomB,YACxC1hB,SAASiC,UAET,IAAIrP,GAAW+tB,MAAOttB,SAASmuB,IAAIE,WAAY7gB,MAAO,KAAMC,OAAQ,mBACpErR,EAAE,aAAa+Q,UAAU,SAAU5N,GACnCkI,WAAW,0BAA2BrL,EAAE+Q,UAAUohB,iBAAiBnyB,EAAE,aAAa+Q,UAAU,aAAe,QACnD,qBAAjD/Q,EAAE,aAAa+Q,UAAU,SAAU,WAAoC/Q,EAAE+Q,UAAUohB,iBAAiBnyB,EAAE,aAAa+Q,UAAU,aAAe,IACnJ1F,WAAW,0BAAuG,KAA3ErL,EAAE+Q,UAAUohB,iBAAiBnyB,EAAE,aAAa+Q,UAAU,aAAe,KAE5G1F,WAAW,0BAA2B,SAKlDjL,KAAK2xB,IAAInpB,KAAO,WACZ5I,EAAE2L,MACEC,IAAK,iBACLkM,OAAO,EACP/L,SAAU,OACVF,KAAM,cACPkM,KAAK,SAASlM,GACbjI,SAASmuB,IAAIC,UAAYnmB,EAAKmmB,UAC9BpuB,SAASmuB,IAAIE,WAAa,IAAIzyB,KAAKqM,EAAKomB,YAExCjyB,EAAE,aAAa+Q,WAAWmgB,MAAOttB,SAASmuB,IAAIE,WAAYX,SAAU1tB,SAASmuB,IAAIG,OAAQX,cAAc,EAAMC,SAAS,EAAMtuB,OAAQ,KAAMuuB,WAAY7tB,SAASoN,WAAWjR,QAASqyB,OAAQ,SAASC,GAAKryB,EAAE,aAAaf,IAAIozB,EAAE,GAAK,GAAGnrB,QAAQ,aAC9O,IAAI6I,EAAyD,qBAAjD/P,EAAE,aAAa+Q,UAAU,SAAU,UAAmC,GAAK/Q,EAAE+Q,UAAUohB,iBAAiBnyB,EAAE,aAAa+Q,UAAU,aAAe,GAC5J1F,WAAW,0BAAmC,IAAR0E,MAI9C3P,KAAK2xB,IAAInpB;ACjDbhF,SAASqH,WAAa,SAASqnB,EAAMC,GACjC,IACIpiB,KAOJ,IAAKnQ,EAAE,sBAAsB2P,SAAS,WAAa3P,EAAE,sBAAsB2P,SAAS,YAChF,OAAO,EAGX,IAAK/L,SAASC,QAAQyuB,KAAU1uB,SAASC,QAAQ0uB,GAC7C,OAAO,EAGX,GAAID,GAAQC,EACR,OAAO,EAGX,GAAI3uB,SAASqM,OAAOyE,KAAO9Q,SAASqM,OAAOyE,IAAI8d,UAC3C,OAAO,EAGX,GAAI5uB,SAASqM,OAAOyE,KAAO9Q,SAASqM,OAAOyE,IAAI+d,YAAczyB,EAAEuN,QAAQJ,SAASvJ,SAASqM,OAAOyE,IAAI+d,aAxBxF,MAAO,OAwBuG,EACrH,OAAO,EAGZ,QAAsD,IAA3C7uB,SAASD,IAAI2c,SAASgS,EAAO,WAA8F,IAA1D1uB,SAASD,IAAI2c,SAASgS,EAAO,KAAUC,EAAK,KACpH,OAAO,EAGV,GAAIvyB,EAAE2D,IAAIC,SAASqM,OAAO/L,UAChB,SAAS2P,GACP,MAAM6e,EAAU9uB,SAASqM,OAAO/F,WAAW2J,EAASC,WAC9C6e,EAAY/uB,SAASqM,OAAO/F,WAAW2J,EAASE,aACtD,OAAO2e,GAAWC,IACdD,EAAQ1kB,UAAYskB,GAAQK,EAAU3kB,UAAYukB,GAClDG,EAAQ1kB,UAAYukB,GAAMI,EAAU3kB,UAAYskB,GAAUze,EAAW,OACxE/T,OAAS,EACpB,OAAO,EAGV,IACS8yB,EADL1X,GAAWhR,YAAesU,OAAW7F,YAIrCia,EADAhvB,SAASC,QAAQ0uB,GAAIxuB,MACX,SAAWH,SAASC,QAAQ0uB,GAAIxuB,MACrCH,SAASC,QAAQ0uB,GAAIvuB,UAAY,IAC5B,WACLJ,SAASC,QAAQ0uB,GAAIvuB,SAAW,EAC3B,UAEA,WAEd,IAAIE,EAAYlE,EAAE2D,IAAIC,SAASqM,OAAO/L,UAAW,SAAS2P,GAEtD,GAAIjQ,SAASqM,OAAO/F,WAAW2J,EAASC,WAAW9F,UAAYskB,IAAS1uB,SAASC,QAAQD,SAASqM,OAAO/F,WAAW2J,EAASE,aAAa/F,UAAW,CACjJ,GAAIpK,SAASqQ,YAAYrQ,SAASqM,OAAO/F,WAAW2J,EAASE,aAAa/F,WAAa4kB,EAEnF,OAAO/e,EACJ,GAAIA,EAAS9Q,MAAQa,SAASM,UAAU2P,EAAS9Q,OAASa,SAASM,UAAU2P,EAAS9Q,MAAMoB,QAAQzC,QAAQ,IAAK,MAAQkxB,EAE5H,OAAO/e,EACJ,KAAkE,OAA9DjQ,SAASqM,OAAO/F,WAAW2J,EAASE,aAAa/F,UAAuB6F,EAAS9Q,MAASa,SAASM,UAAU2P,EAAS9Q,OAE7H,OAAO8Q,KAKnB,GAAI3P,EAAUpE,OACV,GAAIoE,EAAUpE,OAAS,EACnBE,EAAE,4BAA4B6Y,QAC1BmC,UAAU,EACV6X,MAAO,mBACP7lB,MAAO,IACPpC,SACImO,OAAQ,WACJ/Y,EAAEI,MAAMyY,OAAO,UAEnB4F,GAAI,WACA,IAAI5f,EAAImB,EAAE,+CAA+Cf,MACrD4U,EAAW3P,EAAUrF,GACrB8U,EAAY/P,SAASqM,OAAO/F,WAAW2J,EAASC,WAChDgf,EAAalvB,SAASqM,OAAO/F,WAAW2J,EAASE,aAErDmH,EAAQhR,WAAWyO,OAAO9Y,MACtBgU,UACInQ,GAAMmQ,EAASnQ,IAEnBwG,aAEQxG,GAAMiQ,EAAUjQ,KAGhBA,GAAMovB,EAAWpvB,GACjBsK,SAAYukB,MAYxB3uB,SAAS4O,QAAQ,UAAW0I,EAPd,SAASrP,GACfA,EAAKknB,WAAyC,GAA5BlnB,EAAKknB,UAAU,GAAGhsB,SACpCoJ,EAAKtQ,MAAMgU,SAAYA,EAAU3J,YAAeyJ,EAAWmf,KAC3D9yB,EAAE,4BAA4B6Y,OAAO,cAOrDQ,KAAM,WACFrZ,EAAE,gDAAgDgzB,QAElDhzB,EAAEgB,KAAKkD,EAAW,SAASrF,GACvB,IAAI8U,EAAY/P,SAASqM,OAAO/F,WAAWhG,EAAUrF,GAAGiV,WAEpDmd,EAAK,iDACwCpyB,EAAE,YAAYA,EAAE,YAF9CmB,EAAE,yBAAyB2T,EAAUjQ,GAAG,MAAMyE,OAI7D,QAEJnI,EAAE,gDAAgDiO,OAAOgjB,GACzDjxB,EAAE,mDAAmD0xB,UAAU,kBAAkB7yB,EAAE,iBAI5F,CACH,IAAIgV,EAAW3P,EAAU,GACrByP,EAAY/P,SAASqM,OAAO/F,WAAW2J,EAASC,WAChDgf,EAAalvB,SAASqM,OAAO/F,WAAW2J,EAASE,aAErDmH,EAAQhR,WAAWyO,OAAO9Y,MACtBgU,UACInQ,GAAMmQ,EAASnQ,IAEnBwG,aAEQxG,GAAMiQ,EAAUjQ,KAGhBA,GAAMovB,EAAWpvB,GACjBsK,SAAYukB,MAIxBpiB,EAAKtQ,MAAMgU,SAAYA,EAAU3J,YAAeyJ,EAAWmf,UAI/D5X,EAAQhR,WAAWsU,IAAI3e,MACnBgU,UACI9Q,KAAQ,KACRmU,OAAU,UACVtF,KAAQ,SACRC,KAAQ,UAEZ3H,aAEQ8D,SAAYskB,EACZvvB,KAAQ,aAGRiL,SAAYukB,EACZxvB,KAAQ,eAMxB,GAAImY,EAAQhR,WAAWsU,IAAI1e,QAAUob,EAAQhR,WAAWyO,OAAO7Y,OAAQ,CAyBnE8D,SAAS4O,QAAQ,UAAW0I,EAxBd,SAASrP,GACfA,EAAKknB,WAAyC,GAA5BlnB,EAAKknB,UAAU,GAAGhsB,SACpC/G,EAAE,SAAS6G,YAAY,YAEnBgF,EAAKzG,UACD2C,mBAAmBnE,SAASsG,WAAWiG,KACvCvM,SAASsG,WAAWiG,KAAKpI,iBAAiBlI,MAAMozB,OAAQ,MAAO/oB,WAAY2B,EAAKzG,UAEhFxB,SAASsG,WAAWiG,KAAKpI,mBAAqBkrB,OAAQ,MAAO/oB,WAAY2B,EAAKzG,WAIlF+K,EAAKrQ,SACDiI,mBAAmBnE,SAASsG,WAAWiG,KACvCvM,SAASsG,WAAWiG,KAAKpI,iBAAiBlI,MAAMozB,OAAQ,SAAU/oB,WAAYiG,IAE9EvM,SAASsG,WAAWiG,KAAKpI,mBAAqBkrB,OAAQ,SAAU/oB,WAAYiG,KAIpFC,eAAe1E,QAAQ,gBAAiBnD,KAAKgD,UAAU3H,SAASsG,WAAWiG;ACjM3FvM,SAASsvB,SAAW,WAChB9yB,KAAK8yB,SAASrnB,QAEdzL,KAAK8yB,SAAS1qB,MAAQ,SAASqD,GAC3B,IAAK,IAAItI,KAAKsI,EAAM,CAChB,IAAInI,EAAKmI,EAAKtI,GAAGG,GAEjB,GAAKnF,OAAOc,KAAKuE,SAASsvB,SAASrnB,KAAM,KAAMnI,IAAiD,GAA1C1D,EAAE,qBAAqB0D,EAAG,MAAM5D,QAwB/E,GAAIvB,OAAOc,KAAKuE,SAASsvB,SAASrnB,KAAM,KAAMnI,IAAOnF,OAAOc,KAAKuE,SAASsvB,SAASrnB,KAAM,KAAMnI,GAAIyvB,UAAYtnB,EAAKtI,GAAG4vB,SAAU,CAChIC,EAAWpzB,EAAE,qBAAqB0D,EAAG,MAEzC,IACI0vB,EAAS/zB,KAAK,gBAAgB8I,KAAK0D,EAAKtI,GAAG8vB,SAC7C,MAAOC,GACLF,EAAS/zB,KAAK,kBAAkBuV,OAChCwe,EAAS/zB,KAAK,kBAAkB8I,KAAK,0BAA4BmrB,EAAInnB,YAAYhL,KAAO,KAAOmyB,EAAIC,QAAU,WAC7GH,EAAS/zB,KAAK,mCAAmCwV,OAGrDue,EAAS/zB,KAAK,oBAAoB8I,KAAK,aAAe0D,EAAKtI,GAAGgP,eAAiB,OAAS1G,EAAKtI,GAAG4vB,UAChGC,EAAS/zB,KAAK,kBAAkBsH,SAASkF,EAAKtI,GAAGiwB,OAAS,SAAW,SApC0B,CAC/F,IAAIJ,EAAWpzB,EAAE,iBAAiB+N,QAC9B0lB,EAAYzzB,EAAE,sCAAsC8H,KAAK,MAAQ9H,EAAE,sCAAsC8H,KAAK,MAAMpG,QAAQ,UAAW,IAAM,EAAI,EAGrJ1B,EAAE,iBAAiB0zB,OAAON,GAC1BA,EAAStrB,KAAK,UAAWpE,GAEzB,IACI0vB,EAAS/zB,KAAK,gBAAgB8I,KAAK0D,EAAKtI,GAAG8vB,SAC7C,MAAOC,GACLF,EAAS/zB,KAAK,kBAAkBuV,OAChCwe,EAAS/zB,KAAK,kBAAkB8I,KAAK,0BAA4BmrB,EAAInnB,YAAYhL,KAAO,KAAOmyB,EAAIC,QAAU,WAC7GH,EAAS/zB,KAAK,mCAAmCwV,OAGrDue,EAAS/zB,KAAK,oBAAoB8I,KAAK,aAAe0D,EAAKtI,GAAGgP,eAAiB,OAAS1G,EAAKtI,GAAG4vB,UAChGC,EAAS/zB,KAAK,mBAAmB8I,KAAK,aAAe0D,EAAKtI,GAAG8O,cAAgB,OAASxG,EAAKtI,GAAGowB,SAC9FP,EAAS/zB,KAAK,gBAAgByI,KAAK,KAAM,UAAY2rB,GACrDL,EAAS/zB,KAAK,kBAAkBsH,SAASkF,EAAKtI,GAAGiwB,OAAS,SAAW,IACrEJ,EAASvsB,YAAY,UACrBmP,SAASC,OAAOmd,EAAS/zB,KAAK,oBAqBtC,IAAK,IAAIkE,KAAKK,SAASsvB,SAASrnB,KAAM,CAC9BnI,EAAKE,SAASsvB,SAASrnB,KAAKtI,GAAGG,GAEnC,IAAKnF,OAAOc,KAAKwM,EAAM,KAAMnI,IACrB0vB,EAAWpzB,EAAE,qBAAqB0D,EAAG,OAChCsR,SAIjBpR,SAASsvB,SAASrnB,KAAOA,IAGjCjI,SAASsvB;AC5DTtvB,SAASgwB,UAAY,SAASz0B,GAC1B,IAAI8xB,EAAKjxB,EAAE,yBAAyBb,EAAI,MAGxCa,EAAEixB,GAAI5xB,KAAK,qBAAqB4O,OAAO,UAEvCjO,EAAEixB,GACG5xB,KAAK,MACLqyB,UAAU,WACVxa,SACA7X,KAAK,YAAYqxB,SAASC,gBAAiB,WAAY,KAAMxlB,MAAM,KAAMulB,SAASC,gBAAiB,QAAS,KAC5GkD,QAAQ,IAAK,WAEV7zB,EAAEixB,GAAI5xB,KAAK,kBAAkB0R,UAAU,WAEvC/Q,EAAEI,MAAM8W,SAASA,SAASlC,SAC1BhV,EAAE,aAAakH,QAAQ;ACfnCtD,SAAS4sB,QAAU,SAASsD,EAAM/C,GAC1BA,EAAWA,IAAY,EAA3B,IACIld,KAEJ,GAAiB,YAAbigB,EAAK/wB,KAAoB,CAEzB,KADI8Q,EAAW7T,EAAE2D,IAAIC,SAASqM,OAAO/L,UAAW,SAAS2P,GAAY,GAAIA,EAASC,WAAaggB,EAAKpwB,IAAMmQ,EAASE,aAAe+f,EAAKpwB,GAAI,OAAOmQ,IAAa,IAChJ,OAAO,EACtB,IAAIG,EAAiB8f,EAAKpwB,IAAMmQ,EAASC,UAAYlQ,SAASqM,OAAO/F,WAAW2J,EAASE,aAAenQ,SAASqM,OAAO/F,WAAW2J,EAASC,WAC5I,IAAKE,EAAgB,OAAO,EAExB8f,EAAK3yB,KACPgD,QAAUP,SAASC,QAAQmQ,EAAehG,UAAY,qBAAqBpK,SAASC,QAAQmQ,EAAehG,UAAU7M,KAAK,KAAK2yB,EAAK3yB,KAAK,OAAS2yB,EAAK3yB,KAC9IyC,SAASqQ,YAAYD,EAAehG,UAC3C7J,QAAUP,SAASqQ,YAAYD,EAAehG,UACvCpK,SAASC,QAAQmQ,EAAehG,UACvC7J,QAAU,qBAAqBP,SAASC,QAAQmQ,EAAehG,UAAU7M,KAAK,KAAKyC,SAASC,QAAQmQ,EAAehG,UAAU7M,KAAK,OAElIgD,QAAU,GAGd,IAAIuI,EAAM,gBAAgBonB,EAAKpwB,GAAG,sBAAuBqtB,EAAW,sBAAwB,IAAK,eAC5E5tB,QAAQ+G,WAAWI,UAAUC,MAAO,MAAMupB,EAAKlgB,YAAckgB,EAAKlgB,YAAY5N,UAAU,EAAG,GAAG,KAAK8tB,EAAKlgB,YAAY5N,UAAU,EAAG,IAAM,OAAS,WAAW,gCAC9I7C,QAAQ+G,WAAWI,UAAUE,QAAS,oBAAoBpK,KAAKkR,UAAUuC,GAAU,MAAOA,EAASA,EAASqD,OAAO,OAAS4c,EAAKpwB,GAAKmQ,EAAS9Q,MAAQ,GAAM8Q,EAASqD,OAAS,OAAS,IAAK,+BAC9L/T,QAAQ+G,WAAWI,UAAUG,QAAwC,IAA9B0C,SAAS2mB,EAAK5f,YAAoB,YAAc,IAAK,mBAAmB9T,KAAK2R,WAAW+hB,GAAM,qBAAqBA,EAAK7hB,SAAS,4BACpL9O,QAAQ+G,WAAWI,UAAUnG,QAAS,MAAMA,SAAW,IAAI,mBAC5D0P,EAASjC,KAAK,IAAKzO,QAAQ+G,WAAWI,UAAUI,QAAS,KAAKmJ,EAASjC,KAAK,mBAC5EiC,EAAShC,KAAK,IAAK1O,QAAQ+G,WAAWI,UAAUK,QAAS,KAAKkJ,EAAShC,KAAK,aAG5Fof,EAAKjxB,EAAE0M,QAEPA,EAAM,gBAAgBonB,EAAKpwB,GAAG,sBAAuBqtB,EAAW,sBAAwB,IAAK,eAC5E5tB,QAAQ+G,WAAWI,UAAUC,MAAO,MAAMupB,EAAKlgB,YAAckgB,EAAKlgB,YAAY5N,UAAU,EAAG,GAAG,KAAK8tB,EAAKlgB,YAAY5N,UAAU,EAAG,IAAM,OAAS,WAAW,mBAC3J7C,QAAQ+G,WAAWI,UAAUE,QAAS,KAAKspB,EAAK/wB,KAAK,+BACzCI,QAAQ+G,WAAWI,UAAUG,QAAwC,IAA9B0C,SAAS2mB,EAAK5f,YAAoB,YAAc,IAAK,mBAAmB9T,KAAK2R,WAAW+hB,GAAM,qBAAqBA,EAAK7hB,SAAS,4BACpL9O,QAAQ+G,WAAWI,UAAUnG,QAAS,kBAAkB2vB,EAAK3yB,KAAKiX,QAAQ0b,EAAK3yB,MAAM,IAAI,aAG1G8vB,EAAKjxB,EAAE0M,GAGfsJ,SAASC,OAAOjW,EAAEixB,GAAI5xB,KAAK,mBAG3BW,EAAE,yBAAyB8zB,EAAKpwB,GAAG,MAAMrE,KAAK,kBAAkB0R,UAAU,WAC1E/Q,EAAE,yBAAyB8zB,EAAKpwB,GAAG,MAAMmuB,YAAYZ,GAErDjxB,EAAE,aAAakH,QAAQ,UAEF,YAAjB2M,EAASjC,KACT5R,EAAEixB,GAAI5xB,KAAK,kBAAkB0R,WAAWmgB,MAAOC,OAAOC,IAAI0C,EAAK3f,UAAUkd,SAAUC,SAAUlxB,KAAK+Q,QAASogB,cAAc,EAAMC,SAAS,EAAMtuB,OAAQ9C,KAAKuQ,UAAW8gB,WAAYrxB,KAAK4Q,WAAWjR,UAC7L4G,SAAS,YAEd3G,EAAEixB,GAAI5xB,KAAK,kBAAkB0R,WAAWK,MAAO+f,OAAOC,IAAI0C,EAAK7hB,UAAUof,SAAUG,SAAS,EAAMtuB,OAAQ9C,KAAKuQ,UAAW8gB,WAAYrxB,KAAK4Q,WAAWjR,UAG1JC,EAAEixB,GAAIzW,OAAO;AC1DjB5W,SAAS4M,IAAM,WACX,IAEIujB,EAAeC,EAAWC,EAF1BC,EAAU,0BACVC,EAAY,mBAAqBvwB,SAASsE,QAAU,KAAOsD,OAAOhF,SAASkH,SAAW,OAASlC,OAAO4oB,UAAUD,UAEpH/zB,KAAKoQ,IAAIuV,YAAa,EACtB3lB,KAAKoQ,IAAIsE,cAET,IAICuf,EAAY,SAASC,GACxB,OAAOnD,OAAOC,IAAIkD,GAAaC,SAAS,EAAG,WAAWC,SAASrD,WAG7D/wB,KAAKoQ,IAAIhK,SAAW,WAGhB,IAAKsC,eAFLsC,aAAa2oB,GAEOnwB,SAAS4M,IAAIsE,WAAY,CACzC,IAAIjM,EAAYjF,SAAS4M,IAAIsE,WAAWhM,aAGpCurB,EAAUxrB,EAAUyrB,aACpB1wB,SAASiI,KAAK2E,KAAOikB,SAAW,GAIpCz0B,EAAE2L,MACEC,IAAKsoB,EAAU,kBAAmBprB,YAAa,cAAgB9I,EAAE00B,OAAOC,MAAS9rB,EAAU+rB,YAAaC,WAAcV,IAEtHpxB,KAAM,MACNgJ,SAAU,OACVjD,YAAaA,cACdiP,KAAK,SAASlM,EAAMgkB,EAAQ7f,GAC3B,IAAInH,EAAYjF,SAAS4M,IAAIsE,WAAW1U,KAAK0I,aAEzCD,IACAA,EAAUisB,aAAe3D,OAAOnhB,EAAI8f,kBAAkB,iBAAkB,8BAA8B5sB,SAElG2F,EAAUmF,UAAYnC,EAAKkpB,kBAC3BlsB,EAAUmF,SAAWnC,EAAKkpB,iBAAmB,KAC7ClsB,EAAU8L,WAAa/Q,SAASC,QAAQgI,EAAKkpB,iBAAmBnxB,SAASC,QAAQgI,EAAKkpB,iBAAiB5zB,KAAO,KAE9GnB,EAAE,+CAAgDI,KAAK0I,YAAa,MAAMzJ,KAAK,WAAW8I,KAAKU,EAAU8L,YAAc,UAGvH/Q,SAASiI,KAAKzC,SAAShJ,KAAK0I,cACxBA,YAAaD,EAAUC,YACvBC,cAAeF,EAAUE,cACzBiF,SAAUnF,EAAUmF,SACpB2G,WAAY9L,EAAU8L,WACtB6d,UAAW3pB,EAAU2pB,UACrBwC,YAAansB,EAAUmsB,YACvBC,OAAQpsB,EAAUosB,OAClBC,SAAUrsB,EAAUqsB,SACpBzC,WAAY5pB,EAAU4pB,WACtBta,aAActP,EAAUsP,eAG5BtP,EAAU2pB,WAAa3mB,EAAKspB,aAC5BtsB,EAAU2pB,UAAY3mB,EAAKspB,YAAc,KAErCtpB,EAAKspB,WACLvxB,SAAS4M,IAAI4kB,cAAcvpB,EAAKspB,WAAY/0B,KAAK0I,aAC5CusB,OAAO,SAASxpB,GACb,IAAIhD,EAAYjF,SAAS4M,IAAIsE,WAAW1U,KAAKk1B,WAE7CzsB,EAAUmsB,YAAcnpB,EAAK1K,MAAQ,KACrCnB,EAAE,+CAAgDI,KAAKk1B,UAAW,MAAMj2B,KAAK,YAAY8I,KAAK0D,EAAK1K,KAAK6E,UAAU,EAAG,IAAM,OAAS,UAAU8B,KAAK,eAAgB+D,EAAK1K,MACxK6U,SAASC,OAAOjW,EAAE,+CAAgDI,KAAKk1B,UAAW,8BAGlF1xB,SAASiI,KAAKzC,SAAShJ,KAAKk1B,YACxBxsB,YAAaD,EAAUC,YACvBC,cAAeF,EAAUE,cACzBiF,SAAUnF,EAAUmF,SACpB2G,WAAY9L,EAAU8L,WACtB6d,UAAW3pB,EAAU2pB,UACrBwC,YAAansB,EAAUmsB,YACvBC,OAAQpsB,EAAUosB,OAClBC,SAAUrsB,EAAUqsB,SACpBzC,WAAY5pB,EAAU4pB,WACtBta,aAActP,EAAUsP,iBAGpCtP,EAAUmsB,YAAc,KAExBhf,SAASuV,OAAOvrB,EAAE,+CAAgDI,KAAK0I,YAAa,8BAGpFlF,SAASiI,KAAKzC,SAAShJ,KAAK0I,cACxBA,YAAaD,EAAUC,YACvBC,cAAeF,EAAUE,cACzBiF,SAAUnF,EAAUmF,SACpB2G,WAAY9L,EAAU8L,WACtB6d,UAAW3pB,EAAU2pB,UACrBwC,YAAansB,EAAUmsB,YACvBC,OAAQpsB,EAAUosB,OAClBC,SAAUrsB,EAAUqsB,SACpBzC,WAAY5pB,EAAU4pB,WACtBta,aAActP,EAAUsP,gBAIhChV,QAAQiG,SAASC,QAAUjJ,KAAK0I,aAChClF,SAAS8Q,IAAI9Q,SAAS4M,IAAIsE,WAAW3R,QAAQiG,SAASC,YAG/DksB,KAAK,SAAS1pB,GACM,KAAfA,EAAKgkB,QACLjsB,SAAS4O,QAAQ,WAAYhC,KAAQikB,SAAW,OAErDY,OAAO,SAASxpB,EAAMgkB,EAAQ7f,GACf,WAAV6f,GAAiC,SAAVA,GAAgD,GAA3BjsB,SAAS4M,IAAIuV,YACzDniB,SAAS4M,IAAIuV,YAAa,EAC1B/lB,EAAE,8CAA8C0P,QAChD6E,OAAOrN,QAAQ,wBAAyB,OAAO,EAAO,uBACrC,WAAV2oB,GAAkD,GAA3BjsB,SAAS4M,IAAIuV,aAC3CniB,SAAS4M,IAAIuV,YAAa,EAC1B/lB,EAAE,8CAA8C0P,QAChD6E,OAAOrN,QAAQ,yBAA0B,QAAS,IAAM,yBAG5D,IAAIE,EAAUD,aAAa6I,EAAIwlB,yBAC3BpuB,EAAQquB,SACVC,QAAQC,IAAI,oBAAqBvuB,EAAQquB,QAASr1B,KAAKwL,OAKjEmoB,EAAgB1oB,WAAW,0BAA2B,MAG1DjL,KAAKoQ,IAAIolB,KAAO,WAGZ,IAAK9sB,eAFLsC,aAAa4oB,GAEOpwB,SAAS4M,IAAIsE,WAAY,CACzC,IAAIjM,EAAYjF,SAAS4M,IAAIsE,WAAWhM,aAGpCurB,EAAUxrB,EAAUyrB,aACpB1wB,SAASiI,KAAK2E,KAAOikB,SAAW,GAIpCz0B,EAAE2L,MACEC,IAAKsoB,EAAU,kBAAmBprB,YAAa,UAAY9I,EAAE00B,OAAOC,MAAS9rB,EAAU+rB,YAAaC,WAAcV,IAElHpxB,KAAM,MACNgJ,SAAU,OACVjD,YAAaA,cACdiP,KAAK,SAASlM,EAAMgkB,EAAQ7f,GAC3B,IAAInH,EAAYjF,SAAS4M,IAAIsE,WAAW1U,KAAK0I,aAEzCD,IACAA,EAAUgtB,SAAW1E,OAAOnhB,EAAI8f,kBAAkB,iBAAkB,8BAA8B5sB,SAE9F2F,EAAUosB,QAAUppB,EAAKiqB,eACzBjtB,EAAUosB,OAASppB,EAAKiqB,cAAgB,KAGxClyB,SAASiI,KAAKzC,SAAShJ,KAAK0I,cACxBA,YAAaD,EAAUC,YACvBC,cAAeF,EAAUE,cACzBiF,SAAUnF,EAAUmF,SACpB2G,WAAY9L,EAAU8L,WACtB6d,UAAW3pB,EAAU2pB,UACrBwC,YAAansB,EAAUmsB,YACvBC,OAAQpsB,EAAUosB,OAClBC,SAAUrsB,EAAUqsB,SACpBzC,WAAY5pB,EAAU4pB,WACtBta,aAActP,EAAUsP,eAG5BtP,EAAUqsB,UAAYrpB,EAAKkqB,YAC3BltB,EAAUqsB,SAAWrpB,EAAKkqB,WAAa,KACvC/1B,EAAE,+CAAgDI,KAAK0I,YAAa,MAAMzJ,KAAK,aAAa8I,KAAK0D,EAAKkqB,WAAa,UAGnHnyB,SAASiI,KAAKzC,SAAShJ,KAAK0I,cACxBA,YAAaD,EAAUC,YACvBC,cAAeF,EAAUE,cACzBiF,SAAUnF,EAAUmF,SACpB2G,WAAY9L,EAAU8L,WACtB6d,UAAW3pB,EAAU2pB,UACrBwC,YAAansB,EAAUmsB,YACvBC,OAAQpsB,EAAUosB,OAClBC,SAAUrsB,EAAUqsB,SACpBzC,WAAY5pB,EAAU4pB,WACtBta,aAActP,EAAUsP,eAG5BtP,EAAU4pB,YAAc5mB,EAAKmqB,eAC7BntB,EAAU4pB,WAAa5mB,EAAKmqB,cAAgB,KAExCnqB,EAAKmqB,aACLpyB,SAAS4M,IAAIylB,WAAWpqB,EAAKmqB,aAAc51B,KAAK0I,aAC3CusB,OAAO,SAASxpB,GACb,IAAIhD,EAAYjF,SAAS4M,IAAIsE,WAAW1U,KAAKk1B,WAE7CzsB,EAAUsP,aAAetM,EAAK1K,MAAQ,KACtCnB,EAAE,+CAAgDI,KAAKk1B,UAAW,MAAMj2B,KAAK,SAAS8I,KAAK0D,EAAK1K,MAAQ,UAGxGyC,SAASiI,KAAKzC,SAAShJ,KAAKk1B,YACxBxsB,YAAaD,EAAUC,YACvBC,cAAeF,EAAUE,cACzBiF,SAAUnF,EAAUmF,SACpB2G,WAAY9L,EAAU8L,WACtB6d,UAAW3pB,EAAU2pB,UACrBwC,YAAansB,EAAUmsB,YACvBC,OAAQpsB,EAAUosB,OAClBC,SAAUrsB,EAAUqsB,SACpBzC,WAAY5pB,EAAU4pB,WACtBta,aAActP,EAAUsP,iBAGpCtP,EAAUsP,aAAe,KACzBnY,EAAE,+CAAgDI,KAAK0I,YAAa,MAAMzJ,KAAK,SAAS8I,KAAK,UAG7FvE,SAASiI,KAAKzC,SAAShJ,KAAK0I,cACxBA,YAAaD,EAAUC,YACvBC,cAAeF,EAAUE,cACzBiF,SAAUnF,EAAUmF,SACpB2G,WAAY9L,EAAU8L,WACtB6d,UAAW3pB,EAAU2pB,UACrBwC,YAAansB,EAAUmsB,YACvBC,OAAQpsB,EAAUosB,OAClBC,SAAUrsB,EAAUqsB,SACpBzC,WAAY5pB,EAAU4pB,WACtBta,aAActP,EAAUsP,mBAIzCod,KAAK,SAAS1pB,GACM,KAAfA,EAAKgkB,QACLjsB,SAAS4O,QAAQ,WAAYhC,KAAQikB,SAAW,OAErDY,OAAO,SAASxpB,EAAMgkB,EAAQ7f,GACf,WAAV6f,GAAiC,SAAVA,GAAgD,GAA3BjsB,SAAS4M,IAAIuV,YACzDniB,SAAS4M,IAAIuV,YAAa,EAC1B/lB,EAAE,8CAA8C0P,QAChD6E,OAAOrN,QAAQ,wBAAyB,OAAO,EAAO,uBACrC,WAAV2oB,GAAkD,GAA3BjsB,SAAS4M,IAAIuV,aAC3CniB,SAAS4M,IAAIuV,YAAa,EAC1B/lB,EAAE,8CAA8C0P,QAChD6E,OAAOrN,QAAQ,yBAA0B,QAAS,IAAM,yBAG5D,IAAIE,EAAUD,aAAa6I,EAAIwlB,yBAC3BpuB,EAAQquB,SACVC,QAAQC,IAAI,oBAAqBvuB,EAAQquB,QAASr1B,KAAKwL,OAKjEooB,EAAY3oB,WAAW,sBAAuB,MAGlDjL,KAAKoQ,IAAI0lB,OAAS,WAGd,IAAKptB,eAFLsC,aAAa6oB,GAEOrwB,SAAS4M,IAAIsE,WAAY,CACzC,IAAIjM,EAAYjF,SAAS4M,IAAIsE,WAAWhM,aAExClF,SAAS4M,IAAI2lB,gBAAgBttB,EAAUC,YAAaD,GAC/CkP,KAAK,SAASlM,GACPA,EAAKqqB,OACLl2B,EAAE,+CAAgDI,KAAKk1B,UAAUxsB,YAAa,MAAMzJ,KAAK,WAAWwH,YAAY,YAAYF,SAAS,UAErI3G,EAAE,+CAAgDI,KAAKk1B,UAAUxsB,YAAa,MAAMzJ,KAAK,WAAWwH,YAAY,UAAUF,SAAS,cAExI4uB,KAAK,SAAS1pB,GA1QZ,IAAS/C,EA2QN+C,GAAuB,KAAfA,EAAKgkB,SA3QP/mB,EA4QK1I,KAAKk1B,UAAUxsB,YA3Q1C9I,EAAE,+CAAgD8I,EAAa,MAAMzJ,KAAK,UAAUuV,QA6QxE5U,EAAE,+CAAgDI,KAAKk1B,UAAUxsB,YAAa,MAAMzJ,KAAK,WAAWwH,YAAY,UAAUF,SAAS,cAI/IstB,EAAc5oB,WAAW,wBAAyB,MAGtDjL,KAAKoQ,IAAIylB,WAAa,SAASG,EAAQd,GACnC,OAAOt1B,EAAE2L,MACLC,IAAKsoB,EAAU,sBAAuBkC,EAAQ,KAAOp2B,EAAE00B,OAAOG,WAAcV,IAE5EpxB,KAAM,MACNgJ,SAAU,OACVupB,UAAWA,IACZD,OAAO,SAASjwB,EAASyqB,EAAQ7f,GAClC,IAAI5I,EAAUD,aAAa6I,EAAIwlB,yBAC3BpuB,EAAQquB,SACVC,QAAQC,IAAI,oBAAqBvuB,EAAQquB,QAASr1B,KAAKwL,QAK/DxL,KAAKoQ,IAAI4kB,cAAgB,SAAS5C,EAAW8C,GACzC,OAAOt1B,EAAE2L,MACLC,IAAKsoB,EAAU,yBAA0B1B,EAAW,KAAOxyB,EAAE00B,OAAOG,WAAcV,IAElFpxB,KAAM,MACNgJ,SAAU,OACVupB,UAAWA,IACZD,OAAO,SAASjwB,EAASyqB,EAAQ7f,GAClC,IAAI5I,EAAUD,aAAa6I,EAAIwlB,yBAC3BpuB,EAAQquB,SACVC,QAAQC,IAAI,oBAAqBvuB,EAAQquB,QAASr1B,KAAKwL,QAK/DxL,KAAKoQ,IAAIoK,eAAiB,SAASyb,EAAevtB,EAAawtB,EAAiBC,GAG5E,OAFAD,EAAkBA,IAAoC,EACtDC,EAAYA,IAAwB,EAC7Bv2B,EAAE2L,MACLC,IAAKsoB,EAAU,8BAAgCl0B,EAAE00B,OAAO8B,eAAgBH,EAAeI,sBAAuBH,EAAiBI,iBAAkBH,IACjJnvB,SAAUuvB,cAAiB,UAAW/yB,SAAS4M,IAAIsE,WAAWhM,GAAa8rB,YAAagC,eAAgBzC,GACxGpxB,KAAM,OACNgJ,SAAU,SACXspB,OAAO,SAASjwB,EAASyqB,EAAQ7f,GAClC,IAAI5I,EAAUD,aAAa6I,EAAIwlB,yBAC3BpuB,EAAQquB,SACVC,QAAQC,IAAI,oBAAqBvuB,EAAQquB,QAASr1B,KAAKwL,QAK/DxL,KAAKoQ,IAAImK,SAAW,SAASkc,EAAU/tB,GACnC,OAAO9I,EAAE2L,MACLC,IAAKsoB,EAAU,kCAAoCl0B,EAAE00B,OAAOoC,UAAWD,IACvEzvB,SAAUuvB,cAAiB,UAAW/yB,SAAS4M,IAAIsE,WAAWhM,GAAa8rB,YAAagC,eAAgBzC,GACxGpxB,KAAM,OACNgJ,SAAU,SACXspB,OAAO,SAASjwB,EAASyqB,EAAQ7f,GAClC,IAAI5I,EAAUD,aAAa6I,EAAIwlB,yBAC3BpuB,EAAQquB,SACVC,QAAQC,IAAI,oBAAqBvuB,EAAQquB,QAASr1B,KAAKwL,QAK/DxL,KAAKoQ,IAAI2lB,gBAAkB,SAASrtB,EAAawsB,GAC7C,OAAOt1B,EAAE2L,MACLC,IAAKsoB,EAAU,kBAAoBprB,EAAc,YAAc9I,EAAE00B,OAAOC,MAAS/wB,SAAS4M,IAAIsE,WAAWhM,GAAa8rB,YAAaC,WAAcV,IAEjJpxB,KAAM,MACNgJ,SAAU,OACVupB,UAAWA,IACZD,OAAO,SAASjwB,EAASyqB,EAAQ7f,GAClC,IAAI5I,EAAUD,aAAa6I,EAAIwlB,yBAC3BpuB,EAAQquB,SACVC,QAAQC,IAAI,oBAAqBvuB,EAAQquB,QAASr1B,KAAKwL,QAK/DxL,KAAKoQ,IAAIumB,UAAY,WACjB,OAAO/2B,EAAE2L,MACLC,IAAKsoB,EAAU,eAAiBl0B,EAAE00B,OAAOG,WAAcV,IAEvDpxB,KAAM,MACNgJ,SAAU,SACXspB,OAAO,SAASjwB,EAASyqB,EAAQ7f,GAClC,IAAI5I,EAAUD,aAAa6I,EAAIwlB,yBAC3BpuB,EAAQquB,SACVC,QAAQC,IAAI,oBAAqBvuB,EAAQquB,QAASr1B,KAAKwL,QAK/DxL,KAAKoQ,IAAIwmB,SAAW,SAASC,GACzB,OAAOj3B,EAAE2L,MACLC,IAAKsoB,EAAU,uBAAyBl0B,EAAE00B,OAAOG,WAAcV,IAC/DpxB,KAAM,OACNgJ,SAAU,OACVmrB,YAAa,mBACbC,aAAa,EACbtrB,KAAMtD,KAAKgD,UAAU0rB,KACtB5B,OAAO,SAASjwB,EAASyqB,EAAQ7f,GAClC,IAAI5I,EAAUD,aAAa6I,EAAIwlB,yBAC3BpuB,EAAQquB,SACVC,QAAQC,IAAI,oBAAqBvuB,EAAQquB,QAASr1B,KAAKwL,QAK/DxL,KAAKoQ,IAAI4mB,gBAAkB,SAASC,EAAO/B,EAAWgC,GAC9CA,OAA0B,IAAZ,GAA0BA,EAC5C,OAAOt3B,EAAE2L,MACLC,IAAKsoB,EAAU,kBAAoBmD,EAAQ,KAAOr3B,EAAE00B,OAAOG,WAAcV,IACzEpxB,KAAM,MACNgJ,SAAU,OACVurB,MAAOA,EACPD,MAAOA,EACP/B,UAAWA,IACZD,OAAO,SAASjwB,EAASyqB,EAAQ7f,GAClC,IAAI5I,EAAUD,aAAa6I,EAAIwlB,yBAC3BpuB,EAAQquB,SACVC,QAAQC,IAAI,oBAAqBvuB,EAAQquB,QAASr1B,KAAKwL,QAK/DxL,KAAKoQ,IAAI+mB,kBAAoB,SAASF,EAAO/B,EAAWgC,GAChDA,OAA0B,IAAZ,GAA0BA,EAC5C,OAAOt3B,EAAE2L,MACLC,IAAKsoB,EAAU,oBAAsBmD,EAAQ,KAAOr3B,EAAE00B,OAAOG,WAAcV,IAC3EpxB,KAAM,MACNgJ,SAAU,OACVurB,MAAOA,EACPD,MAAOA,EACP/B,UAAWA,IACZD,OAAO,SAASjwB,EAASyqB,EAAQ7f,GAClC,IAAI5I,EAAUD,aAAa6I,EAAIwlB,yBAC3BpuB,EAAQquB,SACVC,QAAQC,IAAI,oBAAqBvuB,EAAQquB,QAASr1B,KAAKwL,QAK/DxL,KAAKoQ,IAAIgnB,eAAiB,SAASH,EAAO/B,EAAWgC,GAC7CA,OAA0B,IAAZ,GAA0BA,EAC5C,OAAOt3B,EAAE2L,MACLC,IAAKsoB,EAAU,iBAAmBmD,EAAQ,KAAOr3B,EAAE00B,OAAOG,WAAcV,IACxEpxB,KAAM,MACNgJ,SAAU,OACVurB,MAAOA,EACPD,MAAOA,EACP/B,UAAWA,IACZD,OAAO,SAASjwB,EAASyqB,EAAQ7f,GAClC,IAAI5I,EAAUD,aAAa6I,EAAIwlB,yBAC3BpuB,EAAQquB,SACVC,QAAQC,IAAI,oBAAqBvuB,EAAQquB,QAASr1B,KAAKwL,QAK/DxL,KAAKoQ,IAAI5C,OAAS,SAAS6pB,EAAcC,EAAYC,GACjD,OAAO33B,EAAE2L,MACLC,IAAKsoB,EAAU,eAAiBl0B,EAAE00B,OAAOG,WAAcV,IACvDpxB,KAAM,MACNgJ,SAAU,OACVmrB,YAAa,mBACbrrB,MAAO+B,OAAU6pB,EAAcC,WAAcA,EAAYC,OAAUA,KACpEtC,OAAO,SAASjwB,EAASyqB,EAAQ7f,GAClC,IAAI5I,EAAUD,aAAa6I,EAAIwlB,yBAC3BpuB,EAAQquB,SACVC,QAAQC,IAAI,oBAAqBvuB,EAAQquB,QAASr1B,KAAKwL,QAK/DxL,KAAKoQ,IAAIof,cAAgB,WACrB,OAAO5vB,EAAE2L,MACLC,IAAKsoB,EAAU,8BAAgCl0B,EAAE00B,OAAOG,WAAcV,IACtEpxB,KAAM,MACNgJ,SAAU,SACXspB,OAAO,SAASjwB,EAASyqB,EAAQ7f,GAClC,IAAI5I,EAAUD,aAAa6I,EAAIwlB,yBAC3BpuB,EAAQquB,SACVC,QAAQC,IAAI,oBAAqBvuB,EAAQquB,QAASr1B,KAAKwL,QAK/DxL,KAAKoQ,IAAI0f,cAAgB,WACrB,OAAOlwB,EAAE2L,MACLC,IAAKsoB,EAAU,8BAAgCl0B,EAAE00B,OAAOG,WAAcV,IACtEpxB,KAAM,MACNgJ,SAAU,SACXspB,OAAO,SAASjwB,EAASyqB,EAAQ7f,GAClC,IAAI5I,EAAUD,aAAa6I,EAAIwlB,yBAC3BpuB,EAAQquB,SACVC,QAAQC,IAAI,oBAAqBvuB,EAAQquB,QAASr1B,KAAKwL,QAM/DxL,KAAKoQ,IAAIonB,WAAa,SAASX,GAC3B,IAAIY,EAAU73B,EAAE83B,WAqChB,OAnCAl0B,SAAS4M,IAAIwmB,SAASC,GACjBlf,KAAK,SAASlM,GACX,IAAK2F,QAAQ3F,EACkB,aAAvBA,EAAK2F,MAAMumB,SACXn0B,SAAS4M,IAAI4mB,gBAAgBvrB,EAAK2F,MAAM9N,GAAImI,EAAK2F,OAAO,GACnDuG,KAAK,SAASigB,GACXh4B,EAAE4B,OAAOiK,EAAK2F,MAAOwmB,GACrBp0B,SAAS4M,IAAI+mB,kBAAkBS,EAAcC,eAAgB73B,KAAKk1B,WAAW,GACxEvd,KAAK,SAASmgB,GACXrsB,EAAK2F,MAAM2mB,YAAcD,EACrBA,EAAgBE,aAChBx0B,SAAS4M,IAAIgnB,eAAeU,EAAgBE,YAAah4B,KAAKk1B,WAAW,GACpEvd,KAAK,SAASsgB,GACXxsB,EAAK2F,MAAM8mB,SAAWD,QAKpB,eAAvBxsB,EAAK2F,MAAMumB,UAClBn0B,SAAS4M,IAAI+mB,kBAAkB1rB,EAAK2F,MAAM9N,GAAImI,EAAK2F,OAAO,GACrDuG,KAAK,SAASmgB,GACXl4B,EAAE4B,OAAOiK,EAAK2F,MAAO0mB,GACjBA,EAAgBE,aAChBx0B,SAAS4M,IAAIgnB,eAAeU,EAAgBE,YAAah4B,KAAKk1B,WAAW,GACpEvd,KAAK,SAASsgB,GACXxsB,EAAK2F,MAAM8mB,SAAWD,MAOlDR,EAAQU,QAAQ1sB,KAGjBgsB,GAGXz3B,KAAKoQ,IAAIhI,MAAQ,SAASsM,GACtB,IAAKhM,eAAelF,SAAS4M,IAAIsE,WACvBhM,eAAegM,WACVlR,SAAS4M,IAAIsE,WAAWhM,aAC/B9I,EAAE,+CAAgD8I,YAAa,MAAMkM,SACjE7R,QAAQiG,SAASC,QAAUP,cAC3BlF,SAAS8Q,KAAI,GAAO,GACpB1U,EAAE,cAAc8H,KAAK,WAAY,cAK7C,IAAKgB,eAAegM,EAAY,CAK5B,GAJ+B,OAA3B3R,QAAQiG,SAASC,SACjBlG,QAAQiG,SAASC,OAASP,eAGxBA,eAAelF,SAAS4M,IAAIsE,YAAa,CAC3C,IAAI0jB,EAASx4B,EAAE,mBAAmB+N,QAClCyqB,EAAO1wB,KAAK,mBAAoBgB,aAChC0vB,EAAOn5B,KAAK,eAAeyI,KAAK,MAAO,yCAA0CgB,YAAa,WAC9F0vB,EAAOn5B,KAAK,SAAS8I,KAAK2M,EAAWhM,aAAaC,eAClDyvB,EAAOzjB,WAAW,MAClByjB,EAAO3xB,YAAY,UACnB2xB,EAAO7xB,SAAS,kBAEZxD,QAAQiG,SAASC,QAAUP,cAC3B0vB,EAAO7xB,SAAS,UAChB3G,EAAE,cAAc+U,WAAW,aAE/B/U,EAAE,aAAaiO,OAAOuqB,GAI1B50B,SAAS4M,IAAIsE,WAAWhM,aAAegM,EAAWhM,aAGtDlF,SAAS4M,IAAIolB,OACbhyB,SAAS4M,IAAIhK,WACb5C,SAAS4M,IAAI0lB,WAGrBtyB,SAAS4M;ACpjBT5M,SAAS8Q,IAAM,SAASA,EAAK+jB,GACzB,IAAI5lB,EAAezS,KAAK6P,OAAOyE,KAAOtU,KAAK6P,OAAOyE,IAAI7B,eAAgB,EAElE6B,GAEK+jB,IAEIr4B,KAAK6P,OAAOyE,KAAOtU,KAAK6P,OAAOyE,IAAI1G,UAAY0G,EAAI1G,UAA6B,GAAhB6E,KACjEA,GAAe,EAIXA,GAAe,EACfjP,SAASqH,WAAW7K,KAAK6P,OAAOyE,IAAI1G,SAAU0G,EAAI1G,YAMzDyqB,GAAmBt1B,QAAQyH,QAAQC,QAAWzK,KAAK6P,OAAOyE,KAAOtU,KAAK6P,OAAOyE,IAAI1G,UAAY0G,EAAI1G,UAA+C,GAAlChO,EAAE,sBAAsBF,QACvI8D,SAASiP,aAAa6B,EAAI1G,UAGzBhO,EAAE,WAAW2P,SAAS,WACvB3P,EAAE,gBAAgB4U,OAItB5U,EAAE,sBAAsB6G,YAAY,YAGhC6N,EAAI1G,WAEAhO,EAAE,sDAAsD2P,SAAS,qBACjE3P,EAAE,sDAAsDwZ,eAAe,oBACvExZ,EAAE,sDAAsDwZ,eAAe,cAAe5V,SAASC,QAAQ6Q,EAAI1G,UAAU7M,OAEzHnB,EAAE,cAAcmI,KAAKvE,SAASC,QAAQ6Q,EAAI1G,UAAU7M,MAAM2G,KAAK,OAAQ,YAAalE,SAASC,QAAQ6Q,EAAI1G,UAAU7M,SAIvHnB,EAAE,cAAcmI,KAAK,IACrBnI,EAAE,gBAAgB6U,OAElB7U,EAAE,sBAAsB2G,SAAS,YAE7B3G,EAAE,sDAAsD2P,SAAS,oBACjE3P,EAAE,sDAAsDwZ,eAAe,qBAI/EpZ,KAAK6P,OAAOyE,KACR5L,YAAa4L,EAAI5L,YACjBC,cAAe2L,EAAI3L,cACnBiF,SAAU0G,EAAI1G,SACd2G,WAAYD,EAAIC,WAChB8d,WAAY/d,EAAI+d,WAChBta,aAAczD,EAAIyD,aAClBqa,UAAW9d,EAAI8d,UACfwC,YAAatgB,EAAIsgB,YACjBF,aAAcpgB,EAAIogB,aAClBe,SAAUnhB,EAAImhB,SACdhjB,aAAcA;AC/DtBjP,SAAS4E,MAAQ,SAASR,EAAQ8D,GAC9B,IAAID,EAAO7L,EAAE4B,QAAO,KAAUoG,GAE1B0wB,GAAuB,EAE3B,IAA4B,MAAxBv1B,QAAQC,MAAMiG,QAAmBlG,QAAQC,MAAMqG,KAAKtG,QAAQC,MAAMiG,SAAgE,GAArDlG,QAAQC,MAAMqG,KAAKtG,QAAQC,MAAMiG,QAAQiE,WAC1F,SAAxBnK,QAAQmG,MAAMD,OACd,IAAK,IAAIlK,KAAO0M,EAAK3B,WACgB,SAA7B2B,EAAK3B,WAAW/K,GAAKw5B,aACd9sB,EAAK3B,WAAW/K,GAMvC,GAAY,WAAR2M,EAAmB,CAEnB,IAAI4I,EAAMtU,KAAK6P,OAAOyE,IAItB,IAAK,IAAIvV,KAHTiB,KAAK6P,OAASjI,EACd5H,KAAK6P,OAAOyE,IAAMA,EAEF7I,EAAK3B,WACjB,GAAI2B,EAAK3B,WAAW/K,GAAK6O,UAAYjG,gBAArC,CAGA,IAAIgpB,EAAwC,SAA7BllB,EAAK3B,WAAW/K,GAAKw5B,MAA2C,SAAxBx1B,QAAQmG,MAAMD,OAGrE,GAAKzF,SAASsG,WAAWgG,KAAK/Q,IAGvB,GAAIyE,SAASsG,WAAWgG,KAAK/Q,GAAKmT,eAAiBzG,EAAK3B,WAAW/K,GAAKmT,aAAc,CACzF,IAAIwhB,GAAO,EACX,IAAK8E,UAAU/sB,EAAK3B,WAAW/K,GACvB0M,EAAK3B,WAAW/K,GAAKy5B,SAAWh1B,SAASsG,WAAWgG,KAAK/Q,GAAKy5B,SAAqB,WAAVA,SACzE9E,GAAO,GAIXA,GACA1zB,KAAKowB,QAAQ3kB,EAAK3B,WAAW/K,GAAM4xB,SAXvC3wB,KAAKywB,OAAOhlB,EAAK3B,WAAW/K,IAAOuxB,SAAS,GAAOK,GACnD2H,GAAuB,EAkB/B,IAAK,IAAIv5B,KAAOyE,SAASsG,WAAWgG,KAC3BrE,EAAK3B,WAAW/K,IACjBiB,KAAKwzB,UAAUz0B,QAGpB,GAAY,QAAR2M,GAA0B,UAARA,EAGzB,IAAK,IAAI3M,KAFTiB,KAAK6P,OAASjI,EAEE6D,EAAK3B,WACjB,GAAI2B,EAAK3B,WAAW/K,GAAK6O,UAAYjG,gBAArC,CAGIgpB,EAAwC,SAA7BllB,EAAK3B,WAAW/K,GAAKw5B,MAA2C,SAAxBx1B,QAAQmG,MAAMD,OAErEjJ,KAAKywB,OAAOhlB,EAAK3B,WAAW/K,IAAOuxB,SAAS,GAAQK,GACpD2H,GAAuB,EAEnB7sB,EAAK3B,WAAW/K,GAAK05B,SACrBz4B,KAAK04B,WAAWjtB,EAAK3B,WAAW/K,IAKxCu5B,GACA14B,EAAE,aAAakH,QAAQ,UAE3BtD,SAASsG,WAAWgG,KAAOrE,EAAK3B,WAGhC,IAAI6uB,EAAiB,EACrB/4B,EAAE2D,IAAIkI,EAAK3B,WAAY,SAASyJ,GAAYA,EAAU3F,UAAYjG,iBAAkBgxB,MACpF/4B,EAAE,oBAAoBmI,KAAK4wB;AC9E/Bn1B,SAASo1B,gBAAkB,WACvB,IAAIC,GAAa,EAEbC,EAAW,SAASxsB,GACpB,IAAIysB,KACAC,EAAU1sB,EAAIxK,MAAM,MACpBm3B,GAAmB,mBAAoB,iBAAkB,qBAAsB,qBAC3D,iBAAkB,uBAAwB,WAAY,YAC1EC,GAAcC,WAAY,MAAOC,YAAa,OAAQC,aAAc,QAASC,WAAY,MAAOC,cAAe,SAAUC,SAAY,WACrHC,UAAa,MAAOC,YAAe,OAAQC,aAAgB,QAASC,iBAAoB,MAAOC,YAAe,SAAUC,SAAY,WACpIC,gBAAiB,MAAOC,uBAAwB,OAAQC,wBAAyB,QAASC,oBAAqB,MAAOC,eAAgB,SAAUC,cAAe,WAC/JC,SAAU,MAAOC,UAAW,OAAQC,SAAU,QAASC,SAAU,MAAOC,SAAU,SAAUC,KAAM,YAEtH,IAAK,IAAIv3B,KAAK61B,EACNA,EAAQ71B,GAAGjC,MAAM,wBACjB63B,EAAQz1B,GAAK01B,EAAQ71B,GAAGrB,MAAM,KAI9Bk3B,EAAQ71B,GAAGjC,MAAM,0BAA4B83B,EAAQ71B,GAAGjC,MAAM,6CAInB,GAA3CtB,EAAEuN,QAAQ6rB,EAAQ71B,GAAI81B,GAKtBC,EAAWF,EAAQ71B,IACnB41B,EAAQp2B,KAAOu2B,EAAWF,EAAQ71B,IAIpB,IAAd61B,EAAQ71B,KACR41B,EAAQh4B,KAAOi4B,EAAQ71B,GAAG+D,QAV1B6xB,EAAQ4B,UAAY3B,EAAQ71B,IAcpC,SAAK41B,EAAQz1B,IAA4B,IAAtBy1B,EAAQz1B,GAAG5D,SAIvBq5B,GAGX/4B,KAAK44B,gBAAgBgC,WAAa,SAASC,GACnCA,EAAQA,EAAM/4B,MAAM,MAAxB,IACIgZ,GAAWhR,YAAesU,OAAW7F,WAAe3K,SAAYjG,iBAChEoI,KAGJ,IAAK,IAAItR,KAFTo6B,GAAa,EAECgC,EAAO,CACjB,IAAI9B,EAAUD,EAAS+B,EAAMp8B,IAE7B,GAAIs6B,EAAQz1B,GAAI,CACZ,IAAIiQ,EAAY3T,EAAE2D,IAAIC,SAASqM,OAAO/F,WAAY,SAASyJ,GAAa,GAAIA,EAAUC,aAAeD,EAAUC,YAAYtR,eAAiB62B,EAAQz1B,GAAG,GAAKy1B,EAAQz1B,GAAG,GAAI,OAAOiQ,IAAc,GAChM,GAAIA,EAEA,GAAoB,YAAhBwlB,EAAQp2B,MAAwC,YAAlB4Q,EAAU5Q,KAAoB,CAC5D,IAAI8Q,EAAW7T,EAAE2D,IAAIC,SAASqM,OAAO/L,UAAW,SAAS2P,GAAY,GAAIA,EAASC,WAAaH,EAAUjQ,IAAMmQ,EAASE,aAAeJ,EAAUjQ,GAAI,OAAOmQ,IAAa,OACrKG,EAAiBH,EAASnQ,GAAMiQ,EAAUjQ,IAAMmQ,EAASC,UAAYlQ,SAASqM,OAAO/F,WAAW2J,EAASE,aAAenQ,SAASqM,OAAO/F,WAAW2J,EAASC,cAChKoH,EAAQhR,WAAWyO,OAAO9Y,MACtBgU,UACInQ,GAAMmQ,EAASnQ,IAAM,KACrBX,KAAQ8Q,EAAS9Q,MAAQ,KACzB6O,KAAQiC,EAASjC,MAAQ,SACzBC,KAAQgC,EAAShC,MAAQ,UAE7B3H,aAEQxG,GAAMiQ,EAAUjQ,GAChBkQ,YAAeD,EAAUC,YACzB5F,SAAYjG,gBACZhF,KAAQ,WACR5B,KAAQwS,EAAUxS,OAGlBuC,GAAMsQ,EAAetQ,IAAM,KAC3BkQ,YAAeI,EAAeJ,aAAe,KAC7C5F,SAAYgG,EAAehG,UAAY,KACvCjL,KAAQ,WACR5B,KAAQ6S,EAAe7S,SAK/ByC,SAASqM,OAAO/L,UAAU2P,EAASnQ,IACxDyM,EAAKtQ,MAAMgU,SAAYjQ,SAASqM,OAAO/L,UAAU2P,EAASnQ,IAAKwG,YAAetG,SAASqM,OAAO/F,WAAWyJ,EAAUjQ,IAAKE,SAASqM,OAAO/F,WAAW8J,EAAetQ,OAGlKyM,EAAKtQ,KAAK+D,SAASqM,OAAO/F,WAAWyJ,EAAUjQ,SAGL,YAAlBiQ,EAAU5Q,OAAwBo2B,EAAQp2B,MAAQo2B,EAAQp2B,KAAK3D,eAAiBuU,EAAU5Q,MAAUo2B,EAAQh4B,MAAQg4B,EAAQh4B,MAAQwS,EAAUxS,QACrJ+Z,EAAQhR,WAAWyO,OAAO9Y,MACtB6D,GAAMiQ,EAAUjQ,GAChBsK,SAAYjG,gBACZhF,KAAQo2B,EAAQp2B,MAAQ,UACxB5B,KAAQg4B,EAAQh4B,KAChB+S,WAA6C,GAA/B/Q,QAAQ+G,WAAWG,UAAiB,KAEtD8F,EAAKtQ,KAAK+D,SAASqM,OAAO/F,WAAWyJ,EAAUjQ,UAI/B,YAAhBy1B,EAAQp2B,KACRmY,EAAQhR,WAAWsU,IAAI3e,MACnBgU,UACI9Q,KAAQ,KACRmU,OAAU,UACVtF,KAAQ,SACRC,KAAQ,UAEZ3H,aAEQ0J,YAAeulB,EAAQz1B,GAAG,GAAKy1B,EAAQz1B,GAAG,GAC1CsK,SAAYjG,gBACZhF,KAAQ,WACRmR,WAA6C,GAA/B/Q,QAAQ+G,WAAWG,UAAiB,KAGlDuJ,YAAe,KACf5F,SAAY,KACZjL,KAAQ,WACRmR,WAA6C,GAA/B/Q,QAAQ+G,WAAWG,UAAiB,OAK9D6Q,EAAQhR,WAAWsU,IAAI3e,MACnB+T,YAAeulB,EAAQz1B,GAAG,GAAKy1B,EAAQz1B,GAAG,GAC1CsK,SAAYjG,gBACZhF,KAAQo2B,EAAQp2B,MAAQ,UACxB5B,KAAQg4B,EAAQh4B,KAChB+S,WAA6C,GAA/B/Q,QAAQ+G,WAAWG,UAAiB,MAOtE,GAAI6Q,EAAQhR,WAAWsU,IAAI1e,QAAUob,EAAQhR,WAAWyO,OAAO7Y,OAAQ,CA6BnE8D,SAAS4O,QAAQ,UAAW0I,EA5Bd,SAASrP,GACfA,EAAKknB,WAAyC,GAA5BlnB,EAAKknB,UAAU,GAAGhsB,SACpC/G,EAAE,SAAS6G,YAAY,YAEnBgF,EAAKzG,UACD2C,mBAAmBnE,SAASsG,WAAWiG,KACvCvM,SAASsG,WAAWiG,KAAKpI,iBAAiBlI,MAAMozB,OAAQ,MAAO/oB,WAAY2B,EAAKzG,UAEhFxB,SAASsG,WAAWiG,KAAKpI,mBAAqBkrB,OAAQ,MAAO/oB,WAAY2B,EAAKzG,WAIlF+K,EAAKrQ,SACDiI,mBAAmBnE,SAASsG,WAAWiG,KACvCvM,SAASsG,WAAWiG,KAAKpI,iBAAiBlI,MAAMozB,OAAQ,SAAU/oB,WAAYiG,IAE9EvM,SAASsG,WAAWiG,KAAKpI,mBAAqBkrB,OAAQ,SAAU/oB,WAAYiG,KAIpFC,eAAe1E,QAAQ,gBAAiBnD,KAAKgD,UAAU3H,SAASsG,WAAWiG,SAItE,SAAStE,GAClBotB,GAAa,SAKjBA,GAAa,GAIrB74B,KAAK44B,gBAAgBpwB,KAAO,WACxB5I,EAAE2F,UAAUwN,QAAQ,SAASvE,GACzB,IAAKA,EAAE0E,SAAW1E,EAAE2E,WAA0B,IAAb3E,EAAE4E,SAA8B,IAAb5E,EAAE4E,WAAmBylB,EAAY,CAEjF,GAAIj5B,EAAE2F,SAASyN,eAAeC,GAAG,mBAAoB,OAErDrT,EAAE,cAAcqU,WAIxBrU,EAAE,QAAQ2S,GAAG,QAAS,aAAc,SAAS/D,GACzCA,EAAEgE,iBAEF,IAAIqoB,EAAQj7B,EAAEI,MAAMyL,KAAK,SAAS3J,MAAM,MACpCg5B,KACAC,KACAhrB,KAEJ,IAAK,IAAItR,KAAKo8B,GACNG,KAAOlC,EAAS+B,EAAMp8B,MACtBq8B,EAASr7B,MAAMu7B,KAAK13B,GAAG,GAAK03B,KAAK13B,GAAG,IAAItE,eAIhD,IAAK,IAAIP,KAAK+E,SAASqM,OAAO/F,WAAY,CACtC,IAAIyJ,EAAY/P,SAASqM,OAAO/F,WAAWrL,GAE3C,GAAI8U,EAAU3F,UAAYjG,iBAAmB4L,EAAUC,cAA6E,IAA9D5T,EAAEuN,QAAQoG,EAAUC,YAAYxU,cAAe87B,IAA8C,QAA1BvnB,EAAUC,YAC/I,GAAsB,YAAlBD,EAAU5Q,KAAoB,CAC9B,IAAI8Q,EAAW7T,EAAE2D,IAAIC,SAASqM,OAAO/L,UAAW,SAAS2P,GAAY,GAAIA,EAASC,WAAaH,EAAUjQ,IAAMmQ,EAASE,aAAeJ,EAAUjQ,GAAI,OAAOmQ,IAAa,OACrKG,EAAiBH,EAASnQ,GAAMiQ,EAAUjQ,IAAMmQ,EAASC,UAAYlQ,SAASqM,OAAO/F,WAAW2J,EAASE,aAAenQ,SAASqM,OAAO/F,WAAW2J,EAASC,cAC1I,SAAlBD,EAAS9Q,OACTo4B,EAAQt7B,KAAKgU,GACb1D,EAAKtQ,MAAMgU,SAAYA,EAAU3J,YAAeyJ,EAAWK,WAG/DmnB,EAAQt7B,KAAK8T,EAAUjQ,IACvByM,EAAKtQ,KAAK8T,GAKtB,GAAIwnB,EAAQr7B,OAAS,EAAG,CACpB,IAAIob,GAAWhR,YAAe8K,OAAUmmB,IAexCv3B,SAAS4O,QAAQ,UAAW0I,EAbd,SAASrP,GACfA,EAAKknB,WAAyC,GAA5BlnB,EAAKknB,UAAU,GAAGhsB,SACpC/G,EAAE,SAAS6G,YAAY,YACnBkB,mBAAmBnE,SAASsG,WAAWiG,KACvCvM,SAASsG,WAAWiG,KAAKpI,iBAAiBlI,MAAMozB,OAAQ,SAAU/oB,WAAYiG,IAE9EvM,SAASsG,WAAWiG,KAAKpI,mBAAqBkrB,OAAQ,SAAU/oB,WAAYiG,IAGhFC,eAAe1E,QAAQ,gBAAiBnD,KAAKgD,UAAU3H,SAASsG,WAAWiG,aAQ3FnQ,EAAE,cAAc2S,GAAG,QAAS,SAAS/D,GACjCA,EAAEgE,iBACF,IAAIqoB,EAAQzvB,OAAO6vB,cAAgB7vB,OAAO6vB,cAAcC,QAAQ,SAAW1sB,EAAEmE,eAAiBnE,GAAGysB,cAAcC,QAAQ,cAEvHt7B,EAAE,cAAcu7B,OAChBhnB,OAAOrN,QAAQ,mFACflH,EAAE,cAAc6L,KAAK,QAASovB,GAC9Br3B,SAASo1B,gBAAgBgC,WAAWC,MAI5C76B,KAAK44B,gBAAgBpwB,QAEzBhF,SAASo1B;AC5PTp1B,SAASyM,KAAO,WACZ,GAAIzM,SAASsG,WAAWmG,KAAKtI,iBAAiBjI,OAAS,EAAG,CACtDE,EAAE,SAAS2G,SAAS,YACpB,IAAI60B,EAAY53B,SAASsG,WAAWmG,KAAKtI,iBAAiBjI,OAAQ,EAC9D+L,GAAQmC,SAAYjG,gBAAiBmC,YAAesU,OAAWxJ,UAAc2D,YAE7E8iB,EAAW73B,SAASsG,WAAWmG,KAAKtI,iBAAiByzB,GACrDrrB,EAAOnQ,EAAE2D,IAAI83B,EAASvxB,WAAY,SAASyJ,GAE3C,GAAIA,EAAUE,UAAYjQ,SAASqM,OAAO/L,UAAUyP,EAAUE,SAASnQ,IAEnE,OAAQmQ,SAAYjQ,SAASqM,OAAO/L,UAAUyP,EAAUE,SAASnQ,IAAKwG,YAAetG,SAASqM,OAAO/F,WAAWyJ,EAAUzJ,WAAW,GAAGxG,IAAKE,SAASqM,OAAO/F,WAAWyJ,EAAUzJ,WAAW,GAAGxG,MAC7L,GAAIE,SAASqM,OAAO/F,WAAWyJ,EAAUjQ,KAAwD,YAAjDE,SAASqM,OAAO/F,WAAWyJ,EAAUjQ,IAAIX,KAAoB,CAEhH,IAAI8Q,EAAW7T,EAAE2D,IAAIC,SAASqM,OAAO/L,UAAW,SAAS2P,GAAY,GAAIA,EAASC,WAAaH,EAAUjQ,IAAMmQ,EAASE,aAAeJ,EAAUjQ,GAAI,OAAOmQ,IAAa,GACzK,OAAQA,SAAYA,EAAU3J,YAAetG,SAASqM,OAAO/F,WAAW2J,EAASC,WAAYlQ,SAASqM,OAAO/F,WAAW2J,EAASE,eAC9H,OAAIJ,EAAUE,UAAYjQ,SAASqM,OAAO/F,WAAWyJ,EAAUzJ,WAAW,GAAGxG,IAEzEE,SAASqM,OAAO/F,WAAWyJ,EAAUzJ,WAAW,GAAGxG,IAGnDE,SAASqM,OAAO/F,WAAWyJ,EAAUjQ,MAIpD,OAAO+3B,EAASxI,QACZ,IAAK,MACDpnB,EAAK3B,WAAWsU,IAAM3S,EAAK3B,WAAWsU,IAAIgC,OAAOib,EAASvxB,YAC1D,MACJ,IAAK,SACD2B,EAAK3B,WAAW8K,OAASnJ,EAAK3B,WAAW8K,OAAOwL,OAAOxgB,EAAE2D,IAAI83B,EAASvxB,WAAY,SAASyJ,GAAa,OAAOA,EAAUE,SAAWF,EAAUE,SAAWF,EAAUjQ,MACnK,MACJ,IAAK,SACDmI,EAAK3B,WAAWyO,OAAS9M,EAAK3B,WAAWyO,OAAO6H,OAAOib,EAASvxB,YAuCxEtG,SAAS4O,QAAQ,UAAW3G,EAnCd,SAASA,GACfA,EAAKknB,WAAyC,GAA5BlnB,EAAKknB,UAAU,GAAGhsB,SACpCnD,SAASsG,WAAWmG,KAAKtI,iBAAiBtG,MAE1CzB,EAAE,SAAS6G,YAAY,YACnBkB,mBAAmBnE,SAASsG,WAAWiG,KAChB,OAAnBsrB,EAASxI,OAETrvB,SAASsG,WAAWiG,KAAKpI,iBAAiBlI,MAAMozB,OAAUwI,EAASxI,OAAQ/oB,WAAc2B,EAAKzG,UACpE,UAAnBq2B,EAASxI,OAChBrvB,SAASsG,WAAWiG,KAAKpI,iBAAiBlI,MAAMozB,OAAUwI,EAASxI,OAAQ/oB,WAAciG,IAEzFvM,SAASsG,WAAWiG,KAAKpI,iBAAiBlI,MAAMozB,OAAQwI,EAASxI,OAAQ/oB,WAAYuxB,EAASvxB,aAG3E,OAAnBuxB,EAASxI,OACTrvB,SAASsG,WAAWiG,KAAKpI,mBAAqBkrB,OAAUwI,EAASxI,OAAQ/oB,WAAc2B,EAAKzG,UAClE,UAAnBq2B,EAASxI,OAChBrvB,SAASsG,WAAWiG,KAAKpI,mBAAqBkrB,OAAUwI,EAASxI,OAAQ/oB,WAAciG,IAEvFvM,SAASsG,WAAWiG,KAAKpI,mBAAqBkrB,OAAQwI,EAASxI,OAAQ/oB,WAAYuxB,EAASvxB,aAIpGkG,eAAe1E,QAAQ,gBAAiBnD,KAAKgD,UAAU3H,SAASsG,WAAWmG,OAC3ED,eAAe1E,QAAQ,gBAAiBnD,KAAKgD,UAAU3H,SAASsG,WAAWiG,SAItE,SAAStE,GACdjI,SAASsG,WAAWmG,KAAKtI,iBAAiBjI,OAAS,GACnDE,EAAE,SAAS6G,YAAY;ACnEvCjD,SAAS83B,aAAe,WACpBt7B,KAAKyL,KACLzL,KAAK2P,MAEL3E,aAAaxH,SAAS83B,aAAa3rB,OAEnCnM,SAAS4M,IAAIumB,YACR1B,OAAO,SAASxpB,GACTA,GAAQA,EAAK8vB,SAAW9vB,EAAK8vB,QAAU,GAClC/3B,SAAS83B,aAAa7vB,MAAQjI,SAAS83B,aAAa7vB,KAAK8vB,UAAY9vB,EAAK8vB,UAC3E37B,EAAE,iBAAiBmI,KAAK,iBAAiB0D,EAAK8vB,QAAU,EAAI,SAAW,YAAY,gBAAgB75B,UAAU+J,EAAK8vB,UAE9G/3B,SAAS83B,aAAa7vB,MACtB7L,EAAE,iBAAiBwa,OAAO,WAAYohB,MAAO,KAIrDh4B,SAAS83B,aAAa7vB,KAAOA,GAE7B7L,EAAE,iBAAiBmI,KAAK,oCAG5BvE,SAAS83B,aAAa3rB,MAAQ1E,WAAW,2BAA4B,SAGjFzH,SAAS83B;AC1BT93B,SAASiN,KAAO,SAAS/E,EAAMD,EAAM4G,EAAiBC,GAC9C7G,EAAwB,iBAAX,EAAsB7L,EAAE4B,QAAO,KAAUiK,MAoH1D,OAjHA7L,EAAE4B,QAAO,EAAMiK,EAAMjI,SAASiI,MAG1BzL,KAAK2P,OAAO3E,aAAahL,KAAK2P,OAC9B3P,KAAK4P,KAAK5P,KAAK4P,IAAI6rB,QAEX,WAAR/vB,GAA6B,UAARA,GACrBD,EAAKktB,eAAiBn1B,SAAS0M,qBAC/BzE,EAAKiwB,cAAgBv9B,OAAOe,QAAQc,KAAK6P,OAAO/F,WAAY,gBAE5D2B,EAAKkwB,WAAa34B,MAAMyI,KAAK6P,OAAStY,MAAMyI,KAAK6P,OAAOA,OAAO5b,OAAS,EACxE+L,EAAKmwB,UAAY54B,MAAMyI,KAAK6P,OAAStY,MAAMyI,KAAK6P,OAAOugB,cAAgB,EAEvEpwB,EAAKqwB,aAAe39B,OAAOkB,KAAKW,KAAK8yB,SAASrnB,MAC9CA,EAAKswB,YAAc59B,OAAOe,QAAQc,KAAK8yB,SAASrnB,KAAM,YAEtDA,EAAK0E,SAAWnQ,KAAKmQ,WAGrBvQ,EAAE4B,OAAOxB,KAAMovB,SAEfpvB,KAAKg8B,SAAWp8B,EAAE2D,IAAIvD,KAAKyD,QAAS,SAASC,GAAU,OAAOA,EAAO3C,OACrEf,KAAK6T,aAAe,WAAY,UAAW,WAAY,UAAW,UAAW,UAAW,UAAW,UAAW,WAC9GjU,EAAEuB,MAAMnB,KAAK6T,YAAa7T,KAAKg8B,SAAS3b,SAExCzgB,EAAE,wBAAwBwZ,gBAAgBzC,OAAQ3W,KAAKg8B,SAAU3iB,QAAS,GAAItO,MAAO,KAGzFU,EAAKC,KAAe,QAARA,EAAiB,UAAY,OACzCD,EAAKmC,SAAWjG,gBAChB8D,EAAK8I,WAAa9M,cAClBgE,EAAK+E,SAAWhN,SAASgN,SACzB/E,EAAK3D,QAAUtE,SAASsE,QAExB9H,KAAK4P,IAAMhQ,EAAE2L,MACTC,IAAK,cACLC,KAAMA,EACN9I,KAAM,OACNgJ,SAAU,OACV+L,OAAO,IACRC,KAAK,SAASlM,GACb,GAAIA,EAAM,CAMN,GALAjI,SAASoE,OAAS6D,EACfA,EAAK3B,aACJtG,SAAS0M,qBAAuB/R,OAAOkB,KAAKoM,EAAK3B,aAGjD2B,EAAK3H,UAAW,CAEhB,IAAIm4B,KACAC,KAKJ,IAAK,IAAIz9B,KAJTN,OAAO4G,OAAO0G,EAAK3H,WAAWsD,QAAQ,SAAUwpB,GAC5CqL,EAAmBlvB,SAAS6jB,EAAGld,YAAckd,EAAGttB,GAChD44B,EAAqBnvB,SAAS6jB,EAAGjd,cAAgBid,EAAGttB,KAE1CmI,EAAK3B,WACjB,GAA+B,YAA3B2B,EAAK3B,WAAWrL,GAAGkE,KAAoB,CACzC,IAAIW,EAAKmI,EAAK3B,WAAWrL,GAAG6E,QACG3C,IAA3Bs7B,EAAmB34B,SAAkD3C,IAA7Bu7B,EAAqB54B,WACxDmI,EAAK3B,WAAWrL,IAM7BgN,EAAK2E,KACL5M,SAAS4M,IAAIhI,MAAMqD,EAAK2E,KAGxB3E,EAAKgF,OACLjN,SAASoN,WAAWrR,KAAO,IAAIH,KAAKqM,EAAKgF,OAGzChF,EAAK3B,YACLtG,SAAS4E,MAAMqD,EAAMC,GAGrBD,EAAKqnB,UACLtvB,SAASsvB,SAAS1qB,MAAMqD,EAAKqnB,UAG7BrnB,EAAK3H,WAAa2H,EAAK2f,UAAY3f,EAAK6P,OACxC9X,SAASqN,SAASzI,OAAO7E,IAAOkI,EAAK3H,WAAa,KAAMsnB,SAAY3f,EAAK2f,UAAY,KAAM9P,OAAU7P,EAAK6P,QAAU,OAC7GtY,MAAMyI,KAAK2f,UAAYpoB,MAAMyI,KAAK2f,SAAS1rB,SAAW+L,EAAK2f,UAElE5nB,SAASqN,SAASzI,OAAOgjB,cAG7B5nB,SAASyF,OAAOwC,EAAK0E,UAEjB1E,EAAK0wB,SAAWv8B,EAAE,uBAAuB,IAAIuU,OAAOrN,QAAQ2E,EAAK0wB,OAAQ,UAAU,EAAO,sBAGlG34B,SAASiI,MAAQzC,YAAcoH,QAC/BiC,GAAkBA,EAAgB5G,KACnCwpB,OAAO,SAASxpB,EAAMgkB,GACrBjsB,SAASmM,MAAQ1E,WAAW,sBAAuBzH,SAAS6M,aAE5DiC,GAAiBA,EAAe7G,GAEb,KAAfA,EAAKgkB,OACLrkB,OAAOhF,SAASiH,KAAO,IACN,WAAVoiB,GAAiC,SAAVA,GAA2C,GAAtBjsB,SAAS8M,WAC5D9M,SAAS8M,WAAY,EACrB1Q,EAAE,sBAAsB0P,QACxB6E,OAAOrN,QAAQ,4BAA6B,OAAO,EAAO,oBACzC,WAAV2oB,GAA6C,GAAtBjsB,SAAS8M,YACvC9M,SAAS8M,WAAY,EACrB1Q,EAAE,oBAAoB0P,QACtB6E,OAAOrN,QAAQ,uCAAwC,QAAS,IAAM,yBAIvE,GAEXtD,SAASiN,KAAK;ACtHdjN,SAASiP,aAAe,SAAS7E,EAAUlC,GAuCvC,GAtCY,QAARA,IACA9L,EAAE,iBAAiB6G,cACnB7G,EAAE,gBAAgBgzB,QAElBnrB,cAAgBjE,SAASC,QAAQmK,GAAU7M,KAC3C4G,gBAAkBiG,EAGlBuC,SAASiC,SAAQ,GAGjBxS,EAAE,4BAA4B+Q,UAAU,WACxC/Q,EAAE,mBAAmBgzB,QACrBhzB,EAAE,oBAAoBmI,KAAK,GAC3BvE,SAASsG,WAAWgG,QACpBtM,SAASqM,OAAO/F,WAAa,KAG7B9G,MAAM8K,SAGNlO,EAAE,0CAA0CgV,SAC5CpR,SAASsvB,SAASrnB,KAAO,KAGzB2wB,QAAQC,aAAa,KAAM,KAAM,WAAW50B,eAE5CjE,SAAS4O,QAAQ,WAIrB7M,SAASktB,MAAQjvB,SAASC,QAAQmK,GAAU7M,KAAO,MAAQ8G,SAE3DjI,EAAE,eAAeoU,KAAKxQ,SAASC,QAAQmK,GAAU7M,OAGW,GAA5DnB,EAAEuN,QAAQJ,SAASpF,iBAAkB5E,QAAQ+F,WAAmBlJ,EAAE,oBAAoB8H,KAAK,YAAa,QAAQnB,SAAS,UAAY3G,EAAE,oBAAoB8H,KAAK,YAAa,cAAcjB,YAAY,UAEnMjD,SAASC,QAAQmK,GAAUjK,MAAO,CAKlC,GAHA/D,EAAE,iBAAiBmI,KAAK,kCAAoCvE,SAASC,QAAQmK,GAAUjK,MAAQ,WAG3FH,SAASC,QAAQmK,GAAUwM,OAAQ,CACnC,IAAI/I,EAAU,0CACd,IAAK,IAAIlO,KAAKK,SAAS84B,QAAQ94B,SAASC,QAAQmK,GAAUwM,QAAS,CAC/D,IAAIA,EAAS5W,SAAS84B,QAAQ94B,SAASC,QAAQmK,GAAUwM,QAAQjX,GAAGpC,KAChEP,EAAOgD,SAAS84B,QAAQ94B,SAASC,QAAQmK,GAAUwM,QAAQjX,GAAG3C,KAC9D+7B,EAAM/4B,SAAS84B,QAAQ94B,SAASC,QAAQmK,GAAUwM,QAAQjX,GAAGo5B,IAC7DC,EAAUh5B,SAASC,QAAQmK,GAAUjK,MAAQ,EAAI,EAAIH,SAASC,QAAQmK,GAAUjK,MAChF84B,EAAW,EAEf,OAAQp6B,KAAKq6B,IAAIl8B,IACb,KAAK,GACDi8B,EAAWj8B,EAAO,EAAI,GAAK,EAC3B,MACJ,KAAK,GACDi8B,EAAWj8B,EAAO,EAAI,IAAM,GAC5B,MACJ,KAAK,GACDi8B,EAAWj8B,EAAO,EAAI,IAAM,GAIpC6Q,GAAW,WAAa+I,EAAS,mEAAwEmiB,EAAM,WAAa,UAAY,KACxIlrB,GAAW7Q,EAAQi8B,GAAYD,EAAS,GAAM,cAElDnrB,GAAW,WACXzR,EAAE,iBAAiBiO,OAAO,6CAA+CwD,EAAU,KAAO7N,SAASC,QAAQmK,GAAUwM,OAAS,WAC9HxE,SAASC,OAAOjW,EAAE,iCAItB,IAAK,IAAIuD,KAAKK,SAASC,QAAQmK,GAAU2e,QAAS,CAC9C,IAAI5pB,EAAOa,SAASC,QAAQmK,GAAU2e,QAAQppB,GAC1CsQ,EAAWjQ,SAASM,UAAUnB,GAC9BwS,EAAQ,KAEZ,OAAQ1B,EAAS1P,SACb,IAAK,WACDoR,EAAQ,QACR,MACJ,IAAK,UACDA,EAAQ,SACR,MACJ,IAAK,WACDA,EAAQ,UAIhBvV,EAAE,gBAAgBiO,OAAO,qBAAsBsH,EAAO,uBAAwB1B,EAAS1P,QAAS,yBAA0BoR,EAAO,KAAMxS,EAAM,iBAIjJ/C,EAAE,gBAAgBmI,KAAK,cACpB,CAcT,IAAK,IAAI40B,KAZCn5B,SAASC,QAAQmK,GAAUhK,UAAY,IACvChE,EAAE,iBAAiB2G,SAAS,SAASyN,KAAK,YAAcxQ,SAASC,QAAQmK,GAAUhK,UAC5EJ,SAASC,QAAQmK,GAAUhK,SAAW,EAC7ChE,EAAE,iBAAiB2G,SAAS,UAAUyN,KAAK,WAAaxQ,SAASC,QAAQmK,GAAUhK,UAEnFhE,EAAE,iBAAiB2G,SAAS,WAAWyN,KAAK,YAAcxQ,SAASC,QAAQmK,GAAUhK,UAIzFhE,EAAE,gBAAgBmI,KAAKvE,SAASC,QAAQmK,GAAUgvB,UAAYp5B,SAASq5B,SAASr5B,SAASC,QAAQmK,GAAUgvB,WAAW77B,KAAO,UAGpHgC,QAAQ+F,UAAW,CACjC,MAAM+c,EAAI9iB,QAAQ+F,UAAU6zB,GACtBxc,EAAO5B,SAAS0B,iBAAiBzc,SAASD,IAAI2c,SAAU2F,EAAI,IAAUle,gBAAkB,KAC3FwY,GAAQvgB,EAAE,gBAAgBiO,OAAO,SAAWrK,SAASC,QAAQoiB,GAAG9kB,KAAO,SAAWiC,MAAMisB,WAAW9O,GAAQ,QAEzGvK,SAASC,OAAOjW,EAAE,gCAItBA,EAAE,eAAeoU,KAAKxQ,SAASs5B,QAAQt5B,SAASC,QAAQmK,GAAUkhB,UAAU/tB,MAG5EnB,EAAE,yBAAyBgB,KAAK,WAC5BZ,KAAKqN,KAAOzN,EAAEI,MAAMyL,KAAK,QAAQnK,QAAQ,iBAAkBkC,SAASC,QAAQmK,GAAU7M,MAAMO,QAAQ,eAAgBsM,KAIxHpK,SAASsG,WAAWiG,KAAKnC,IAAapK,SAASsG,WAAWiG,KAAKnC,GAAUlO,OAAS,EAAIE,EAAE,SAAS6G,YAAY,YAAc7G,EAAE,SAAS2G,SAAS,YAC/I/C,SAASsG,WAAWmG,KAAKrC,IAAapK,SAASsG,WAAWmG,KAAKrC,GAAUlO,OAAS,EAAIE,EAAE,SAAS6G,YAAY,YAAc7G,EAAE,SAAS2G,SAAS,YAG1G,GAArC3G,EAAE,yBAAyBF,OAAcE,EAAE,uCAAuC2G,SAAS,YAAc3G,EAAE,uCAAuC6G,YAAY,aAElKjD,SAASiP,aAAa9K,gBAAiB;ACtIvC,IAAIo1B,SAGJn9B,EAAE,yBAAyB0P,MAAM,WAC7BytB,SAAWC,UAAUC,YACjBC,iBAAiB,EACjBC,QAEQxhB,QAASpW,SAAS63B,cAAc,eAChCC,MAAO,yHAGP1hB,QAASpW,SAAS63B,cAAc,gBAChCC,MAAO,qPAGP1hB,QAASpW,SAAS63B,cAAc,kBAChCC,MAAO,wSAGP1hB,QAAS/b,EAAE,2CAA2C,GACtDy9B,MAAO,0GAGP1hB,QAASpW,SAAS63B,cAAc,0BAChCC,MAAO,gHAGP1hB,QAASpW,SAAS63B,cAAc,gBAChCC,MAAO,oGAGP1hB,QAASpW,SAAS63B,cAAc,cAChCC,MAAO,iFAGP1hB,QAASpW,SAAS63B,cAAc,oBAChCC,MAAO,4OAGhB9uB,UAIP3O,EAAE,+BAA+B0P,MAAM,WACnCytB,SAAWC,UAAUC,YACjBC,iBAAiB,EACjBC,QAEQxhB,QAASpW,SAAS63B,cAAc,qBAChCC,MAAO,yIAGP1hB,QAASpW,SAAS63B,cAAc,kBAChCC,MAAO,8OAGP1hB,QAASpW,SAAS63B,cAAc,qBAChCC,MAAO,sQAGP1hB,QAASpW,SAAS63B,cAAc,oBAChCC,MAAO,oGAGP1hB,QAASpW,SAAS63B,cAAc,SAChCC,MAAO,qOAGP1hB,QAASpW,SAAS63B,cAAc,SAChCC,MAAO,sOAGP1hB,QAASpW,SAAS63B,cAAc,sBAChCC,MAAO,21BAGP1hB,QAASpW,SAAS63B,cAAc,aAChCC,MAAO,sLAGhB9uB,UAIP3O,EAAE,0BAA0B0P,MAAM,SAASd,GACvCA,EAAEgE,kBAEFuqB,SAAWC,UAAUC,YACjBC,iBAAiB,EACjBI,WAAW,EACXC,oBAAoB,EACpBC,UAAW,QACXL,QAEQxhB,QAASpW,SAAS63B,cAAc,gBAChCC,MAAO,yZAGP1hB,QAASpW,SAAS63B,cAAc,gBAChCC,MAAO,yEAA2E51B,cAAgB,WAGlGkU,QAASpW,SAAS63B,cAAc,gBAChCC,MAAO,oDAGP1hB,QAASpW,SAAS63B,cAAc,gBAChCC,MAAO,iIAGP1hB,QAASpW,SAAS63B,cAAc,gBAChCC,MAAO,6HAGP1hB,QAASpW,SAAS63B,cAAc,gBAChCC,MAAO,uLAGP1hB,QAASpW,SAAS63B,cAAc,gBAChCC,MAAO,wDAGP1hB,QAASpW,SAAS63B,cAAc,gBAChCC,MAAO,yYAGP1hB,QAASpW,SAAS63B,cAAc,gBAChCC,MAAO,wIAGhB9uB,SAEMkvB,SAAS,SAAS9hB,GACvB,OAAOohB,SAASW,cACZ,KAAK,EACD99B,EAAE,4CAA4C6U,OAE9C6gB,QAAQC,IAAI,0BACZwH,SAASY,aAAe56B,QAAQmG,MAAMD,OACtClG,QAAQmG,MAAMD,OAASlG,QAAQ0F,UAAUnF,GAAK,KAC9CP,QAAQmI,OAER6xB,SAASa,SAAW,WAChB3yB,WAAW,WACP8xB,SAASc,SAASV,MAAM,GAAGxhB,QAAU/b,EAAE,gBAAgBX,KAAK,8BAA8B,GAC1F89B,SAASe,UAAU,QAASf,SAASc,SAASV,OAE9CJ,SAASgB,SAAU,EACnBhB,SAASiB,OAAOzvB,QAAQ0vB,SAAS,GACjClB,SAASgB,SAAU,GACpB,MAGPn+B,EAAE,6BAA6B2S,GAAG,QAASwqB,SAASa,UACpD,MACJ,KAAK,EACDh+B,EAAE,4CAA4C6U,OAC9C7U,EAAE,6BAA6Bs+B,IAAI,QAASnB,SAASa,UAErDb,SAASa,SAAW,WAChBb,SAAS9J,QAAUrzB,EAAEI,MAAM4W,QAAQ,YACnC3L,WAAW,WACP8xB,SAASc,SAASV,MAAM,GAAGxhB,QAAUohB,SAAS9J,QAAQ,GACtD8J,SAASc,SAASV,MAAM,GAAGxhB,QAAUohB,SAAS9J,QAAQh0B,KAAK,kBAAkB,GAC7E89B,SAASc,SAASV,MAAM,GAAGxhB,QAAUohB,SAAS9J,QAAQh0B,KAAK,oBAAoB,GAC/E89B,SAASc,SAASV,MAAM,GAAGxhB,QAAUohB,SAAS9J,QAAQh0B,KAAK,oBAAoB,GAC/E89B,SAASe,UAAU,QAASf,SAASc,SAASV,OAE9CJ,SAASgB,SAAU,EACnBhB,SAASiB,OAAOzvB,QAAQ0vB,SAAS,GACjClB,SAASgB,SAAU,GACpB,MAGPn+B,EAAE,gBAAgB2S,GAAG,QAAS,eAAgBwqB,SAASa,UACvD,MACJ,KAAK,EACDh+B,EAAE,4CAA4C6U,OAC9C7U,EAAE,gBAAgBs+B,IAAI,QAAS,eAAgBnB,SAASa,UAExDb,SAASa,SAAW,WAChB3yB,WAAW,WACP8xB,SAASc,SAASV,MAAM,GAAGxhB,QAAU/b,EAAE,gBAAgBX,KAAK,8BAA8B,GAC1F89B,SAASc,SAASV,MAAM,GAAGxhB,QAAU/b,EAAE,gBAAgBX,KAAK,8BAA8B,GAC1F89B,SAASe,UAAU,QAASf,SAASc,SAASV,OAE9CJ,SAASgB,SAAU,EACnBhB,SAASiB,OAAOzvB,QAAQ0vB,SAAS,GACjClB,SAASgB,SAAU,GACpB,MAGPn+B,EAAE,gBAAgB2S,GAAG,QAAS,eAAgBwqB,SAASa,aAKnEb,SAASoB,OAAO,WACZ,GAAIpB,SAASgB,QAAS,CAGlB,GAFAn+B,EAAE,0BAA0B0P,QAExBytB,SAAS9J,QAAS,CAClB,IAAIxnB,GAAQC,KAAQ,SAAU2nB,UAAa0J,SAAS9J,QAAQxnB,KAAK,OAEjE7L,EAAE2L,MACEC,IAAK,eACL7I,KAAM,OACN8I,KAAMA,EACNE,SAAU,SACXgM,KAAK,SAASlM,GACTA,GAAuB,GAAfA,EAAK9E,QACbo2B,SAAS9J,QAAQre,WAKzBmoB,SAASY,cACT1yB,WAAW,WACPqqB,QAAQC,IAAI,mCAAoCwH,SAASY,cACzD56B,QAAQmG,MAAMD,OAAS8zB,SAASY,aAChC56B,QAAQmI,QACT,KAIPtL,EAAE,6BAA6Bs+B,IAAI,QAASnB,SAASa,UACrDh+B,EAAE,gBAAgBs+B,IAAI,QAAS,eAAgBnB,SAASa,UACxDh+B,EAAE,gBAAgBs+B,IAAI,QAAS,eAAgBnB,SAASa,UACxDh+B,EAAE,gBAAgBs+B,IAAI,QAAS,iDAAkDnB,SAASa,aAIlGb,SAASY,aACTZ,SAAS9J,QACT8J,SAASa,SACTb,SAASgB,SAAU;AC5OvBv6B,SAASuM,KAAO,WACZ,GAAIvM,SAASsG,WAAWiG,KAAKpI,iBAAiBjI,OAAS,EAAG,CACtDE,EAAE,SAAS2G,SAAS,YACpB,IAAI60B,EAAY53B,SAASsG,WAAWiG,KAAKpI,iBAAiBjI,OAAQ,EAC9D+L,GAAQmC,SAAYjG,gBAAiBmC,YAAesU,OAAWxJ,UAAc2D,YAE7E6lB,EAAW56B,SAASsG,WAAWiG,KAAKpI,iBAAiByzB,GACrDnrB,EAAOrQ,EAAE2D,IAAI66B,EAASt0B,WAAY,SAASyJ,GAE3C,GAAIA,EAAUE,UAAYjQ,SAASqM,OAAO/L,UAAUyP,EAAUE,SAASnQ,IAEnE,OAAQmQ,SAAYjQ,SAASqM,OAAO/L,UAAUyP,EAAUE,SAASnQ,IAAKwG,YAAetG,SAASqM,OAAO/F,WAAWyJ,EAAUzJ,WAAW,GAAGxG,IAAKE,SAASqM,OAAO/F,WAAWyJ,EAAUzJ,WAAW,GAAGxG,MAC7L,GAAIE,SAASqM,OAAO/F,WAAWyJ,EAAUjQ,KAAwD,YAAjDE,SAASqM,OAAO/F,WAAWyJ,EAAUjQ,IAAIX,KAAoB,CAEhH,IAAI8Q,EAAW7T,EAAE2D,IAAIC,SAASqM,OAAO/L,UAAW,SAAS2P,GAAY,GAAIA,EAASC,WAAaH,EAAUjQ,IAAMmQ,EAASE,aAAeJ,EAAUjQ,GAAI,OAAOmQ,IAAa,GACzK,OAAQA,SAAYA,EAAU3J,YAAetG,SAASqM,OAAO/F,WAAW2J,EAASC,WAAYlQ,SAASqM,OAAO/F,WAAW2J,EAASE,eAC9H,OAAIJ,EAAUE,UAAYjQ,SAASqM,OAAO/F,WAAWyJ,EAAUzJ,WAAW,GAAGxG,IAEzEE,SAASqM,OAAO/F,WAAWyJ,EAAUzJ,WAAW,GAAGxG,IAGnDE,SAASqM,OAAO/F,WAAWyJ,EAAUjQ,MAIpD,OAAO86B,EAASvL,QACZ,IAAK,MACDpnB,EAAK3B,WAAW8K,OAASnJ,EAAK3B,WAAW8K,OAAOwL,OAAOxgB,EAAE2D,IAAI66B,EAASt0B,WAAY,SAASyJ,GAAa,OAAOA,EAAUE,SAAWF,EAAUE,SAAWF,EAAUjQ,MACnK,MACJ,IAAK,SACDmI,EAAK3B,WAAWsU,IAAM3S,EAAK3B,WAAWsU,IAAIgC,OAAOge,EAASt0B,YAC1D,MACJ,IAAK,SACD2B,EAAK3B,WAAWyO,OAAS9M,EAAK3B,WAAWyO,OAAO6H,OAAOge,EAASt0B,YAuCxEtG,SAAS4O,QAAQ,UAAW3G,EAnCd,SAASA,GACfA,EAAKknB,WAAyC,GAA5BlnB,EAAKknB,UAAU,GAAGhsB,SACpCnD,SAASsG,WAAWiG,KAAKpI,iBAAiBtG,MAE1CzB,EAAE,SAAS6G,YAAY,YACnBkB,mBAAmBnE,SAASsG,WAAWmG,KAChB,UAAnBmuB,EAASvL,OAETrvB,SAASsG,WAAWmG,KAAKtI,iBAAiBlI,MAAMozB,OAAUuL,EAASvL,OAAQ/oB,WAAc2B,EAAKzG,UACpE,UAAnBo5B,EAASvL,OAChBrvB,SAASsG,WAAWmG,KAAKtI,iBAAiBlI,MAAMozB,OAAUuL,EAASvL,OAAQ/oB,WAAcmG,IAEzFzM,SAASsG,WAAWmG,KAAKtI,iBAAiBlI,MAAMozB,OAAUuL,EAASvL,OAAQ/oB,WAAcs0B,EAASt0B,aAG/E,UAAnBs0B,EAASvL,OACTrvB,SAASsG,WAAWmG,KAAKtI,mBAAqBkrB,OAAUuL,EAASvL,OAAQ/oB,WAAc2B,EAAKzG,UAClE,UAAnBo5B,EAASvL,OAChBrvB,SAASsG,WAAWmG,KAAKtI,mBAAqBkrB,OAAUuL,EAASvL,OAAQ/oB,WAAcmG,IAEvFzM,SAASsG,WAAWmG,KAAKtI,mBAAqBkrB,OAAUuL,EAASvL,OAAQ/oB,WAAcs0B,EAASt0B,aAIxGkG,eAAe1E,QAAQ,gBAAiBnD,KAAKgD,UAAU3H,SAASsG,WAAWiG,OAC3EC,eAAe1E,QAAQ,gBAAiBnD,KAAKgD,UAAU3H,SAASsG,WAAWmG,SAItE,SAASxE,GACdjI,SAASsG,WAAWiG,KAAKpI,iBAAiBjI,OAAS,GACnDE,EAAE,SAAS6G,YAAY;ACpEvC,IAAI0J,SAAW,IAAI,WAClBnQ,KAAKq+B,MACLr+B,KAAK+C,QACL/C,KAAKgqB,KACLhqB,KAAKs+B,KAAO,GACZt+B,KAAKg5B,UACH11B,GAAI,OAAQge,MAAO,OAAQid,KAAM,SAAU57B,KAAM,SAAU67B,KAAM,SAASC,EAAGv5B,GAAK,OAAOu5B,EAAEC,SAASx5B,EAAG,GAAK,OAC5G5B,GAAI,QAASge,MAAO,QAASid,KAAM,OAAQ57B,KAAM,SAAUg8B,aAAc,EAAGnG,OAAQ,EAAG/F,MAAO,UAC9FnvB,GAAI,WAAYge,MAAO,YAAaid,KAAM,OAAQ57B,KAAM,SAAUg8B,aAAc,EAAGnG,OAAQ,EAAG/F,MAAO,cACrGnvB,GAAI,YAAage,MAAO,aAAcid,KAAM,OAAQ57B,KAAM,SAAUg8B,aAAc,EAAGnG,OAAQ,EAAG/F,MAAO,eACvGnvB,GAAI,WAAYge,MAAO,YAAaid,KAAM,OAAQ57B,KAAM,SAAUg8B,aAAc,EAAGnG,OAAQ,EAAG/F,MAAO,cAKvGzyB,KAAKk7B,QAAU,SAASoD,EAAM5mB,GACzB4mB,OAAwB,IAAX,EAAyBA,EAAOt+B,KAAKs+B,KAClD5mB,OAA0B,IAAZ,GAA0BA,EAG5C,OAAKvH,SAASkuB,MAKPz+B,EAAE2L,MACRC,IAAK,qBACLC,MAAOmC,SAAUjG,gBAAiBpI,KAAM++B,GACxC37B,KAAM,MACNgJ,SAAU,OACV+L,MAAOA,IACLC,KAAK,SAAS1X,GACZA,IACHA,EAAKwjB,KAAKzD,UACV7P,SAAS6Z,KAAO,IAAItJ,OAAOC,cAAcQ,SAAS,IAAIT,OAAOC,cAAcS,UAAUnhB,IACrFkQ,SAAS6Z,KAAK4U,WAAWzuB,SAAS6oB,SAClC7oB,SAASkuB,MAAMvtB,KAAKX,SAAS6Z,KAAM7Z,SAASpN,aAf5CkI,WAAW,WAAYkF,SAAS+qB,QAAQoD,EAAM5mB,IAAS,MAChD,IAmBV1X,KAAK6+B,cAAgB,WACpB,IAAIC,EAAa3uB,SAASkuB,MAAMhrB,eAEhC,GAAIyrB,EAAW,IAA2B,MAArBA,EAAW,GAAGxyB,IAAa,CAC/C,IAAImW,EAAIqc,EAAW,GAAGtG,OAElBroB,SAAS6oB,QAAQvW,GAAGkc,cAEvBxuB,SAAS6oB,QAAQvW,GAAGnB,MAAQnR,SAAS6oB,QAAQvW,GAAGgQ,MAAQ,gBACjDtiB,SAAS6oB,QAAQvW,GAAGkc,eAE3BxuB,SAAS6oB,QAAQvW,GAAGkc,aAAexuB,SAAS6oB,QAAQvW,GAAG+V,OACvDroB,SAAS6oB,QAAQvW,GAAGnB,MAAQnR,SAAS6oB,QAAQvW,GAAGgQ,OAIjDtiB,SAAS6Z,KAAK4U,WAAWzuB,SAAS6oB,SAClC7oB,SAASpN,QAAQyS,UAAU6E,SAAW,EACtClK,SAASkuB,MAAMvtB,KAAKX,SAAS6Z,KAAM7Z,SAASpN,SAC5CoN,SAASpN,QAAQyS,UAAU6E,SAAW,MAIxCra,KAAKwI,KAAO,WACX2H,SAASkuB,MAAQ,IAAI3d,OAAOC,cAAcoe,UAAUx5B,SAASkR,eAAe,kBAC5EtG,SAASpN,SACRi8B,WAAW,EACXzO,gBAAiB,cACjB0O,OAAQC,WAAY/pB,MAAO,OAAQgqB,SAAU,UAAWC,SAAU,IAAKC,cAAe,GACtFC,OAAQJ,WAAY/pB,MAAO,OAAQgqB,SAAU,UAAWC,SAAU,IAAKG,eAAgB,YAAaC,YAAaC,IAAK,GAAIC,SAAU,GACpIC,cAAe,UACfC,UAAW,EACXnY,UAAW,EACXoY,WAAYt7B,KAAM,MAAOE,IAAK,KAAMmI,MAAO,MAAOC,OAAQ,OAC1DizB,QAAS/pB,SAAU,KAAMmpB,WAAY/pB,MAAO,OAAQgqB,SAAU,UAAWC,SAAU,MACnF5pB,WAAY6E,SAAU,IAAKiE,OAAQ,YACnCjN,SAAU0uB,eAAe,GACzBC,aAActe,MAAO,OAAQwd,WAAYE,SAAU,GAAIjqB,MAAO,QAAS8qB,OAAQ,GAC/EC,YAAa,YAGdxf,OAAOC,cAAcK,OAAOC,YAAY9Q,SAASkuB,MAAO,SAAUluB,SAAS0uB,eAE3E1uB,SAAS+qB,QAAQ/qB,SAASmuB,OAG3Bt+B,KAAKT,KAAO,SAAS++B,GACpB,OAAOA,GACN,KAAK,GACJt+B,KAAK+C,QAAQk8B,MAAMI,cAAgB,EACnC,MACD,KAAK,GACJr/B,KAAK+C,QAAQk8B,MAAMI,cAAgB,EACnC,MACD,KAAK,IACJr/B,KAAK+C,QAAQk8B,MAAMI,cAAgB,GAIrCr/B,KAAKs+B,KAAOA,EACZt+B,KAAKk7B,QAAQoD,IAGdt+B,KAAK8N,OAAS,WACb9N,KAAKq+B,MAAMvtB,KAAK9Q,KAAKgqB,KAAMhqB,KAAK+C,UAGjC/C,KAAKoS,QAAU,SAASsF,GACvB1X,KAAKk7B,QAAQl7B,KAAKs+B,KAAM5mB,IAGzBgJ,OAAOiB,OAAOC,kBAAkB5hB,KAAKwI;AChHtC,IAAI23B,UACHC,KAAM,SACNvzB,OAAQ,IACRwzB,gBAAgB,EAChBC,aAAc,kCACdC,UAAWC,SAASC,SACpBC,iBAAkB,gBAClBC,oBAAoB,EACpBC,mBAAoB,IACpBC,qBACE9/B,KAAM,cAAeoX,OAAQ,OAAQ,SAAU,YAAa,YAC5DpX,KAAM,YAAaoX,OAAQ,eAAgB,UAAW,YACtDpX,KAAM,QAASoX,OAAQ,UACvBpX,KAAM,SAAUoX,OAAQ,YAAa,aACrCpX,KAAM,SAAUoX,OAAQ,cACxBpX,KAAM,QAASoX,OAAQ,mBAEzB2oB,qBACE//B,KAAM,cAAeoX,OAAQ,OAAQ,SAAU,YAAa,SAAU,YAAa,iBACnFpX,KAAM,YAAaoX,OAAQ,eAAgB,eAAgB,UAAW,YACtEpX,KAAM,QAASoX,OAAQ,UACvBpX,KAAM,SAAUoX,OAAQ,YAAa,aACrCpX,KAAM,SAAUoX,OAAQ,WAAY,UACpCpX,KAAM,QAASoX,OAAQ,SAAU,mBAEnC4oB,QAAS,aACTC,aAAc,aACdC,iBAAkB,aAClBC,gBACIvlB,QAAgB,OAChBwlB,QAAkBC,YAAa,WAC/BC,YAAoB1lB,QAAS,OAAQ2lB,YAAcjiC,KAAQ,UAIhEmhC,SAASjuB,GAAG,iBAAkB,SAASgvB,GACtCA,EAAIC,OAAOjvB,GAAG,aAAc,WAC3BgvB,EAAIC,OAAOjvB,GAAG,MAAO,SAAS/D,GAC7B,OAAsB,IAAlBA,EAAE/C,KAAK2H,SAEVxT,EAAE2hC,EAAIC,OAAO7lB,QAAQ/b,GAAGgX,QAAQ,YAAY3X,KAAK,kBAAkBqQ,SAC5D,GACGd,EAAE/C,KAAKg2B,SAAS7hC,EAAE8hC,QAAuC,IAA7BlzB,EAAE/C,KAAKg2B,SAAS7hC,EAAEwT,SAExDxT,EAAE2hC,EAAIC,OAAO7lB,QAAQ/b,GAAGgX,QAAQ,YAAY3X,KAAK,gBAAgBqQ,SAC1D,QAHD,MAQT1P,EAAE,sBACA6G,YAAY,oBACZF,SAAS,6BACTwB,KAAK,+CAEPnI,EAAE,0BACA6G,YAAY,oBACZF,SAAS,6BACTwB,KAAK,iDAGRy4B,SAASjuB,GAAG,gBAAiB,SAASgvB,GAErCA,EAAIC,OAAOvtB,QAEX,IAAI+N,EAAIuf,EAAIC,OAAOnuB,eACfsuB,EAAkB3f,EAAE4f,YACpB7jB,EAAO4jB,EAAgB,GAAGE,eAC1BC,EAAU/jB,EAAKgkB,YAAW,GAI9B,KAFAhkB,EAAO+jB,EAAQA,EAAQpiC,OAAS,GAAGsiC,YAExB,OAAO,EAElB,OAAa,CACZ,IAAI7+B,EAAI4a,EAAKkkB,UACb,GAAS,MAAL9+B,EACH,MAED4a,EAAO5a,EAGR6e,EAAEkgB,cAAcnkB,IAChB4jB,EAAkB3f,EAAE4f,aACJ,GAAGlnB,UAAS,GAC5BsH,EAAEmgB,aAAaR,KAGhBnB,SAASjuB,GAAG,mBAAoB,SAAS6vB,GACpB,QAAhBA,EAAG32B,KAAK1K,OACXqhC,EAAG32B,KAAK42B,WAAWC,YAAY,UAAUj3B,IAAI,kBAA2B,QAAI;Ad1F9EzL,EAAE,QAAQ2S,GAAG,WAAY,WAAY,SAAS/D,GAC7CA,EAAEgE,iBACFjN,SAAS8N,eAAekvB,kBACxB3iC,EAAEI,MAAMf,KAAK,gBAAgBqQ,UAG9B1P,EAAE,QAAQ2S,GAAG,QAAS,eAAgB,SAAS/D,GAI9C,GAHAA,EAAEgE,iBAGE5S,EAAE,QAAQF,OAAQ,OAAO,EAE7B,IAAIszB,EAAWpzB,EAAEI,MAAM4W,QAAQ,YAE/Boc,EAAS/zB,KAAK,mBAAmBwV,OAEjC+rB,SAASl/B,QAAQ0xB,EAAS/zB,KAAK,gBAAgByI,KAAK,MAAOy4B,UAAU5tB,GAAG,gBAAiB,WACxFygB,EAAS/zB,KAAK,kBAAkB8I,KAAK,IACrCirB,EAAS/zB,KAAK,kBAAkBuV,OAChCwe,EAAS/zB,KAAK,mCAAmCuV,SAGlDhR,SAAS2M,SAASkgB,YAAc2C,EAASvnB,KAAK,MAC9CjI,SAAS4O,QAAQ,aAGlBxS,EAAE,QAAQ2S,GAAG,QAAS,+BAAgC,SAAS/D,GAC9DA,EAAEgE,iBACF,IAAIgwB,EAAQ5iC,EAAEI,MACd,GAAIwiC,EAAM96B,KAAK,YAAa,OAAO,EAEnC,IAAIsrB,EAAWwP,EAAM5rB,QAAQ,YAG7B,GAFA4rB,EAAM96B,KAAK,WAAY,QAEnB86B,EAAMjzB,SAAS,eAAgB,CAClC,IAAI9D,GAAQC,KAAQ,OAAQ2nB,UAAaL,EAASvnB,KAAK,MAAOmC,SAAYolB,EAAS/zB,KAAK,kBAAkBsQ,SAAS,UAAY,EAAI5H,gBAAiBsrB,QAAWuN,SAASiC,UAAUzP,EAAS/zB,KAAK,gBAAgByI,KAAK,OAAOwzB,WAE5Nt7B,EAAE2L,MACDC,IAAK,eACL7I,KAAM,OACN8I,KAAMA,EACNE,SAAU,SACRgM,KAAK,SAASlM,GACZA,GAAuB,GAAfA,EAAK9E,SAChBqsB,EAAS/zB,KAAK,oBAAoB8I,KAAK,aAAe0D,EAAKwnB,QAAQ9gB,eAAiB,OAAS1G,EAAKwnB,QAAQyP,cAC1G1P,EAAS/zB,KAAK,mBAAmB8I,KAAK,aAAe0D,EAAKwnB,QAAQhhB,cAAgB,OAASxG,EAAKwnB,QAAQ0P,aACxG/sB,SAASC,OAAOmd,EAAS/zB,KAAK,mBAE9BuhC,SAASiC,UAAUzP,EAAS/zB,KAAK,gBAAgByI,KAAK,OAAOk7B,SAAQ,GACrE5P,EAAStrB,KAAK,UAAW+D,EAAKwnB,QAAQ3vB,IACtC0vB,EAAS/zB,KAAK,mBAAmBuV,OACjCwe,EAAS/zB,KAAK,kBAAkBwV,OAChC+tB,EAAM7tB,WAAW,oBAInB6rB,SAASiC,UAAUzP,EAAS/zB,KAAK,gBAAgByI,KAAK,OAAOk7B,SAAQ,GAEhE5P,EAAStrB,KAAK,YAGlBsrB,EAAS/zB,KAAK,mBAAmBuV,OACjCwe,EAAS/zB,KAAK,kBAAkBwV,OAChC+tB,EAAM7tB,WAAW,aAJjBqe,EAASpe,SAQXoe,EAAS/zB,KAAK,kBAAkB8I,KAAK,WAE9BvE,SAAS2M,SAASkgB,YACzB7sB,SAAS4O,QAAQ,aAGlBxS,EAAE,QAAQ2S,GAAG,QAAS,iBAAkB,SAAS/D,GAChDA,EAAEgE,iBACF,IAAIwgB,EAAWpzB,EAAEI,MAAM4W,QAAQ,YAG1BhX,EAAE,yBAAyB2P,SAAS,qBAiC7B3P,EAAE,yBAAyB6Y,OAAO,WAC7C7Y,EAAE,yBAAyB6L,KAAK,UAAWunB,GAAUva,OAAO,QAjC5D7Y,EAAE,yBAAyB6L,KAAK,UAAWunB,GAAUva,QACpDG,WAAW,EACXC,UAAW,EACX9C,UAAW8D,GAAI,SAAUC,GAAI,SAAUC,GAAIna,EAAE,iBAC7CkZ,YAAa,mCACbtO,SACCq4B,OAAQ,WAEPjjC,EAAE,yBAAyBkX,SAAS7X,KAAK,8BAA8Bqe,OAAO,WAE9E,IAAI0V,EAAWpzB,EAAEI,MAAMyL,KAAK,WACxBA,GAAQC,KAAQ,SAAU2nB,UAAaL,EAASvnB,KAAK,OAEzD7L,EAAE2L,MACDC,IAAK,eACL7I,KAAM,OACN8I,KAAMA,EACNE,SAAU,SACRgM,KAAK,SAASlM,GACZA,GAAuB,GAAfA,EAAK9E,SAChB/G,EAAE,yBAAyB6Y,OAAO,SAClCua,EAASpe,YAERqgB,OAAO,WACTr1B,EAAE,yBAAyBkX,SAAS7X,KAAK,8BAA8Bqe,OAAO,aAGhF3E,OAAQ,WACP/Y,EAAEI,MAAMyY,OAAO,eASpB7Y,EAAE,QAAQ2S,GAAG,QAAS,eAAgB,SAAS/D,GAI9C,GAHAA,EAAEgE,iBAGE5S,EAAE,QAAQF,OAAQ,OAAO,EAE7B,IAAIszB,EAAWpzB,EAAE,iBAAiB+N,QAC9B0lB,EAAYzzB,EAAE,sCAAsC8H,KAAK,MAAQ9H,EAAE,sCAAsC8H,KAAK,MAAMpG,QAAQ,UAAW,IAAM,EAAI,EACrJ1B,EAAE,iBAAiB0zB,OAAON,GAE1BA,EAAS/zB,KAAK,gBAAgByI,KAAK,KAAM,UAAY2rB,GACrDL,EAASvsB,YAAY,UAAUxH,KAAK,gBAAgBqQ,UAGrD1P,EAAE,QAAQ2S,GAAG,QAAS,iBAAkB,SAAS/D,GAChDA,EAAEgE,iBACF,IAAIwgB,EAAWpzB,EAAEI,MAAM4W,QAAQ,YAE3BnL,GAAQC,KAAQ,SAAU2nB,UAAaL,EAASvnB,KAAK,MAAOmC,SAAYolB,EAAS/zB,KAAK,kBAAkBsQ,SAAS,UAAY5H,gBAAkB,GAEnJ/H,EAAE2L,MACDC,IAAK,eACL7I,KAAM,OACN8I,KAAMA,EACNE,SAAU,SACRgM,KAAK,SAASlM,GACZA,GAAuB,GAAfA,EAAK9E,SAChBqsB,EAAS/zB,KAAK,kBAAkBsQ,SAAS,UAAYyjB,EAAS/zB,KAAK,kBAAkBwH,YAAY,UAAYusB,EAAS/zB,KAAK,kBAAkBsH,SAAS;Ae/IzJ3G,EAAE,UAAU0P,MAAM,SAASd,GAG1B,GAFAA,EAAEgE,iBAEE5S,EAAEI,MAAMuP,SAAS,YACpB,OAAO,EAGR,GAAK3P,EAAE,iBAAiB2P,SAAS,qBA2GrB3P,EAAE,iBAAiB6Y,OAAO,WACrC7Y,EAAE,iBAAiB6Y,OAAO,YA5G4B,CACtD,IAAIqqB,EAAe,KACfC,EAAS,KACTC,EAAQ,KAEZ,SAASC,IACJD,GAAOA,EAAMvH,QACjBsH,EAAOh7B,KAAK,UAAYnI,EAAE,qDAAqDF,QAE/EsjC,EAAQpjC,EAAE2L,MACTC,IAAK,YACL7I,KAAM,OACN8I,MAAOC,KAAM9L,EAAE,+BAA+B8H,KAAK,gBACnDiE,SAAU,SACRgM,KAAK,SAASlM,GAChB,GAAIA,GAAQA,EAAKzG,QAAS,CAIzB,IAHA,IAAIye,EAAOhY,EAAKzG,QACZk+B,KAEKzkC,EAAI,EAAG2E,EAAIqgB,EAAK/jB,OAAQjB,EAAI2E,EAAG3E,IAAK,CAC5C,IAAI0kC,EAAOvjC,EAAE,qDAAsD6jB,EAAKhlB,GAAG6E,GAAI,MAG/E,GAFA4/B,EAAIzjC,KAAKgkB,EAAKhlB,GAAG6E,IAEb6/B,EAAKzjC,OACR,IAAK0M,OAAOqX,EAAKhlB,GAAI,EAChB2kC,EAAOD,EAAKlkC,KAAK,cAAcmN,IAAI,OAClCrE,MAAkC,UAA5Bq7B,EAAK17B,KAAK,eAA6BhG,UAAU+hB,EAAKhlB,GAAG2N,MAAQqX,EAAKhlB,GAAG2N,OAAS,cAExF,CAIN,IAAKA,OAHL+2B,EAAOvjC,EAAE,mDAAmD+N,SACvDjG,KAAK,UAAW+b,EAAKhlB,GAAG6E,IAEjBmgB,EAAKhlB,GAAI,CACpB,IAAI2kC,GAAAA,EAAOD,EAAKlkC,KAAK,cAAcmN,IAAI,OAClCrE,MAAkC,UAA5Bq7B,EAAK17B,KAAK,eAA6BhG,UAAU+hB,EAAKhlB,GAAG2N,MAAQqX,EAAKhlB,GAAG2N,OAAS,UAG9F+2B,EAAK18B,YAAY,UAEjB7G,EAAE,yCAAyCiO,OAAOs1B,IAIpDvjC,EAAE,qDAAqDgB,KAAK,YACL,GAAlDhB,EAAEuN,QAAQvN,EAAEI,MAAMyL,KAAK,MAAM5J,WAAYqhC,IAC5CtjC,EAAEI,MAAM4U,WAIVhV,EAAE,yCAAyCkH,QAAQ,WAAW,SAE9DlH,EAAE,qDAAqDgV,SAGxDmuB,EAAOh7B,KAAK,UAAYnI,EAAE,qDAAqDF,UAG5EE,EAAE,iBAAiB6Y,OAAO,WAAa7Y,EAAE,+BAA+B8H,KAAK,kBAChFo7B,EAAe73B,WAAWg4B,EAAerjC,EAAE,+BAA+B8H,KAAK,kBAIjF9H,EAAE,iBAAiB6Y,QAClBmC,UAAU,EACVyoB,OAAO,EACPx2B,OAAQ,IACRD,MAAO,IACPpC,SACCqQ,MAAO,WACNjb,EAAEI,MAAMyY,OAAO,WAGjBU,OAAQ,WAEPvZ,EAAE,iBAAiB2S,GAAG,QAAS,WAAY,SAAS/D,GACnDA,EAAEgE,iBACF8wB,UAAY1jC,EAAEI,MACdgL,aAAa83B,GAEbljC,EAAE,+BAA+B6G,YAAY,UAC7C68B,UAAU/8B,SAAS,UACnB3G,EAAE,sEAAsEmI,KAAK,IAE7EnI,EAAE,uCAAuC6G,YAAY,YAAYgO,OACjE7U,EAAE,uCAAwC0jC,UAAU73B,KAAK,UAAW,MAAMlF,SAAS,YAAYiO,OAE/FyuB,MAGDrjC,EAAE,wCAAwC8d,aACzCC,WAAW,EACXC,SAAU,YACV2lB,WAAY,EAAE,MAIf3jC,EAAEA,EAAEI,MAAM,GAAGwjC,eAAevkC,KAAK,yBAAyB4O,OAAO,0CACjEk1B,EAASnjC,EAAE,uEAEZqZ,KAAM,WACLqqB,UAAY1jC,EAAE,iCACdqjC,KAED/pB,MAAO,WACNlO,aAAa83B;AC9GjBljC,EAAE,YAAY2G,SAAS,cAEvB3G,EAAE2F,UAAUgN,GAAG,aAAc,aAAc,SAAUqH,EAAOnL,GAErB,GAAlC7O,EAAE,sBAAsBF,QAAeE,EAAEI,MAAMuP,SAAS,gBAC3D3P,EAAE,QAAQiO,OAAOjO,EAAE,wCAAwC+M,IAAI,UAAW/M,EAAEI,MAAM2M,IAAI,WAAa,IAC3F/M,EAAE,aACVA,EAAE,YAAY+M,IAAI,UAAW/M,EAAEI,MAAM2M,IAAI,WAAa,GAElD/M,EAAEI,MAAMuP,SAAS,oBACrB3P,EAAE,YAAY2G,SAAS,UAGzB3G,EAAE2F,UAAUgN,GAAG,cAAe,aAAc,SAAUqH,EAAOnL,GACvD7O,EAAE,cAAcqT,GAAG,aACvBrT,EAAE,YAAY6G,YAAY,QAEW,GAAlC7G,EAAE,sBAAsBF,OAC3BE,EAAE,YAAYgV,SACNhV,EAAE,aACVA,EAAE,YAAY+M,IAAI,UAAW/M,EAAEI,MAAM2M,IAAI,WAAa,KAOxD/M,EAAE2F,UAAUgN,GAAG,QAAS,aAAc,WACrC,IAAIuI,GAAWhR,YAAe8K,WAAehH,SAAYjG,iBACrDoI,KAEAwD,EAAY/P,SAASqM,OAAO/F,WAAWlK,EAAEI,MAAMyL,KAAK,OACxD,GAAsB,YAAlB8H,EAAU5Q,KACboN,EAAKtQ,KAAK8T,GACVuH,EAAQhR,WAAW8K,OAAOnV,KAAK8T,EAAUjQ,QACnC,CACN,IAAImQ,EAAW7T,EAAE2D,IAAIC,SAASqM,OAAO/L,UAAW,SAAS2P,GAAY,GAAIA,EAASC,WAAaH,EAAUjQ,IAAMmQ,EAASE,aAAeJ,EAAUjQ,GAAI,OAAOmQ,IAAa,GACzK1D,EAAKtQ,MAAMgU,SAAYA,EAAU3J,YAAetG,SAASqM,OAAO/F,WAAW2J,EAASC,WAAYlQ,SAASqM,OAAO/F,WAAW2J,EAASE,gBACpImH,EAAQhR,WAAW8K,OAAOnV,KAAKgU,GAGhC7T,EAAE,cAAc8H,KAAK,WAAW,GA2BhClE,SAAS4O,QAAQ,UAAW0I,EAzBd,SAASrP,GAClBA,EAAKknB,WAAyC,GAA5BlnB,EAAKknB,UAAU,GAAGhsB,SACvC+O,mBAAmBwD,QAEnBtZ,EAAE,SAAS6G,YAAY,YACnBkB,mBAAmBnE,SAASsG,WAAWiG,KAC1CvM,SAASsG,WAAWiG,KAAKpI,iBAAiBlI,MAAMozB,OAAQ,SAAU/oB,WAAYiG,IAE9EvM,SAASsG,WAAWiG,KAAKpI,mBAAqBkrB,OAAQ,SAAU/oB,WAAYiG,IAG7EC,eAAe1E,QAAQ,gBAAiBnD,KAAKgD,UAAU3H,SAASsG,WAAWiG,OAEvEnQ,EAAE,qBAAqBkX,SAAS7X,KAAK,4BACxCW,EAAE,qBAAqBkX,SAAS7X,KAAK,4BAA4BqQ,QAEjE1P,EAAE,qBAAqBkX,SAAS7X,KAAK,2BAA2BqQ,UAKtD,WACZ1P,EAAE,cAAc+U,WAAW;AClE7B/U,EAAE,YAAY0P,MAAM,SAASd,GAG5B,GAFAA,EAAEgE,iBAEE5S,EAAEI,MAAMuP,SAAS,YACpB,OAAO,EAER3P,EAAE,mBAAmB6Y,QACpBmC,UAAU,EACVhO,MAAO,IACPiM,UAAW,IACXwqB,OAAO,EACP74B,SACCi5B,KAAM,WAE6Bt7B,KAAKgD,UAAUpI,SAAjD,IACI2gC,GAAa,EAEjB9jC,EAAE,mBAAmBkX,SAAS7X,KAAK,iDAAiDyI,KAAK,YAAY,GAAMnB,SAAS,qBAEpHxD,QAAQC,MAAMC,WAAarD,EAAE,+BAA+Bf,MAC5DkE,QAAQC,MAAME,YAActD,EAAE,gCAAgCf,MAE9DkE,QAAQC,MAAMwG,gBAAkB5J,EAAE,yCAAyCf,MAC3EkE,QAAQC,MAAMyG,aAAe,EAAI7J,EAAE,sCAAsCf,MACzEkE,QAAQC,MAAM0G,cAAgB9J,EAAE,uCAAuCf,MACvEkE,QAAQC,MAAM2G,YAAYC,QAAUhK,EAAE,yCAAyCtB,KAAK,WACpFyE,QAAQC,MAAM2G,YAAYlG,QAAU7D,EAAE,iCAAiCf,MAAMiD,MAAM,KAAKyB,IAAIJ,GAAKA,EAAE+D,QAEnGnE,QAAQC,MAAMoG,UAAYjB,KAAKC,MAAMxI,EAAE,iDAAiDf,OAExFkE,QAAQC,MAAM,kBAAoBpD,EAAE,sDAAsDf,MAE1FkE,QAAQC,MAAM6G,SAAWjK,EAAE,6BAA6Bf,MAExDkE,QAAQ+G,WAAWC,SAAWnK,EAAE,6BAA6Bf,MAE7DkE,QAAQ+G,WAAWG,UAAYrK,EAAE,8BAA8Bf,MAE/DkE,QAAQ+G,WAAWE,cAAgBpK,EAAE,kCAAkCf,MAEvEkE,QAAQ6F,WAAahJ,EAAE,qCAAqCf,MAE5DkE,QAAQ8F,QAAUjJ,EAAE,mCAAmC+jC,OAAO,SAE1D5gC,QAAQmG,MAAMD,QAAUrJ,EAAE,8CAA8Cf,QAC3E6kC,GAAa,GAGd3gC,QAAQmG,MAAMD,OAASrJ,EAAE,8CAA8Cf,MAEvEkE,QAAQ6D,QACR7D,QAAQmI,OACNyM,KAAK,WACD+rB,IAEH9jC,EAAE,4BAA4B+Q,UAAU,WACxC/Q,EAAE,mBAAmBgzB,QACrBhzB,EAAE,oBAAoBmI,KAAK,GAC3BvE,SAASsG,WAAWgG,QACpBtM,SAASqM,OAAO/F,cAEhBtG,SAAS4O,QAAQ,aAKpBxS,EAAE,mBAAmB6Y,OAAO,SAC5B7Y,EAAE,mBAAmBkX,SAAS7X,KAAK,iDAAiDyI,KAAK,YAAY,GAAOjB,YAAY,qBAGxH7G,EAAE,8CAA8C6L,KAAK,SAAW7L,EAAE,UAAU6G,YAAY,YAAc7G,EAAE,UAAU2G,SAAS,aAE5Hq9B,MAAO,WACNhkC,EAAE,wBAAwBmI,KAAK,qHAC/BnI,EAAE,mBAAmB6Y,OAAO,UAC3BjO,SACCo5B,MAAO,WACN7gC,QAAQiJ,QACRjJ,QAAQ6D,QAERhH,EAAE,mBAAmB6Y,OAAO,SAC5B7Y,EAAEI,MAAMyY,OAAO,UAEhBE,OAAQ,WACP/Y,EAAEI,MAAMyY,OAAO,aAGfA,OAAO,SAEXoC,MAAO,WACNjb,EAAEI,MAAMyY,OAAO,WAGjBQ,KAAM,WAELrZ,EAAE2L,MACDC,IAAK,iBACL7I,KAAM,OACNgJ,SAAU,SACRgM,KAAK,SAASlM,GAChB,IAAKhN,KAAKgN,EAAKo4B,MACd,IAAK1gC,KAAKsI,EAAKo4B,MAAMplC,GACpBmB,EAAE,sBAAuBuD,GAAG6Q,KAAKvI,EAAKo4B,MAAMplC,GAAG0E,IAIjDvD,EAAE,sCAAsCoU,KAAKvI,EAAKq4B,eAClDlkC,EAAE,6BAA6BoU,KAAKvI,EAAKs4B,QAAQC,QACjDpkC,EAAE,gCAAgCoU,KAAKvI,EAAKs4B,QAAQE,WACpDrkC,EAAE,+BAA+BoU,KAAKvI,EAAKy4B,YAI5CtkC,EAAE2L,MACDC,IAAK,YACL7I,KAAM,OACNgJ,SAAU,SACRgM,KAAK,SAAS0E,GAChB,GAAIA,GAAYA,EAASnT,MAAO,CAK/B,IAAK,IAAI/F,KAJTvD,EAAE,mCAAmCmI,KAAK,IAC1CnI,EAAE,oCAAoCmI,KAAK,IAC3CnI,EAAE,qCAAqCmI,KAAK,IAE9BsU,EAASnT,MAAO,CAC7B,IAAIqvB,EAAOlc,EAASnT,MAAM/F,GACtB4a,EAAOne,EACR,2CAA2CuD,EAAE,YAAYo1B,EAAKA,KAAK,kCAAkCA,EAAK/X,MAAM,iBAAiB+X,EAAK4L,MAAM,uBACzHhhC,EAAE,eAAeo1B,EAAK6L,IAAI,QAC3C7L,EAAK8L,SAAW,mGAAqG,IACvH,gCAAgC9L,EAAKjX,MAAM,mBAE9C1hB,EAAE,2BAA2B24B,EAAK51B,MAAMkL,OAAOkQ,GAG5CA,EAAOne,EAAE,4OAKb,GAFAA,EAAE,oCAAoCiO,OAAOkQ,GAE3B,KAAdvV,KAAK27B,MAAc,CAClBpmB,EAAOne,EAAE,6OAGbA,EAAE,qCAAqCiO,OAAOkQ,GAG/Cne,EAAE,sCAAsC6N,OAAO,WAAW4O,EAASnT,MAAMmT,EAASpT,QAAQsvB,KAAK,MAAM7wB,KAAK,WAAW,GAAMZ,QAAQ,UAGnIuV,EAASnT,MAAMmT,EAASpT,QAAQk7B,MAAQvkC,EAAE,UAAU6G,YAAY,YAAc7G,EAAE,UAAU2G,SAAS,eAIrG3G,EAAE,6BAA6Bf,IAAIkE,QAAQ+G,WAAWC,UACtDnK,EAAE,8BAA8Bf,IAAIkE,QAAQ+G,WAAWG,WACvDrK,EAAE,kCAAkCf,IAAIkE,QAAQ+G,WAAWE,eAC3DpK,EAAE,+BAA+Bf,IAAIkE,QAAQC,MAAMC,YACnDrD,EAAE,sCAAsCf,IAAIkE,QAAQC,MAAMyG,cAC1D7J,EAAE,yCAAyCf,IAAIkE,QAAQC,MAAMwG,iBAC7D5J,EAAE,uCAAuCf,IAAIkE,QAAQC,MAAM0G,eAC3D9J,EAAE,yCAAyCtB,KAAK,UAAWyE,QAAQC,MAAM2G,YAAYC,SACrFhK,EAAE,iCAAiCf,IAAIkE,QAAQC,MAAM2G,YAAYlG,QAAQ1B,KAAK,MAC9EnC,EAAE,6BAA6Bf,IAAIkE,QAAQC,MAAM6G,UACjDjK,EAAE,gCAAgCf,IAAIkE,QAAQC,MAAME,aACpDtD,EAAE,uDAAuDmD,QAAQC,MAAM,kBAAkB,MAAM1E,KAAK,WAAW,GAC/GsB,EAAE,kDAAkDmD,QAAQC,MAAMoG,UAAU,MAAM9K,KAAK,WAAW,GAClGsB,EAAE,qCAAqCf,IAAIkE,QAAQ6F,aAEpDuQ,OAAQ,WACPvZ,EAAE,qBAAqB0kC,WAAWC,YAAa,UAAWC,aAAa,EAAMv7B,QAAQ,IAErFrJ,EAAE,mBAAmB+jC,QACpBlE,IAAK,GACLlU,IAAK,IACLkZ,KAAM,IACNhkC,MAAOsC,QAAQ8F,SAAW,EAC1BoT,OAAQ,SAASzN,EAAGC,GACnB7O,EAAE,QAAQ+M,IAAI,OAAQ8B,EAAGhO,QAE1BikC,MAAO,SAASl2B,EAAGC,GAClB7O,EAAE,+BAA+BmI,KAAK0G,EAAGhO,UAI3Cb,EAAE,+BAA+BmI,KAAKnI,EAAE,mBAAmB+jC,OAAO,UAElE/jC,EAAE,oBAAoB6Y,QACrBmC,UAAU,EACVhC,WAAW,EACXC,UAAW,EACXC,YAAa,gDACbtO,SACCi5B,KAAM,WACL7jC,EAAE,WAAWoZ,UAEdL,OAAQ,WACP/Y,EAAEI,MAAMyY,OAAO,WAGjBS,MAAO,WACNtZ,EAAE,iEAAiEf,IAAI,IACvEe,EAAE,YAAYoU,KAAK,IAAIS,UAIzB7U,EAAE,aAAa0P,MAAM,WACpB1P,EAAE,oBAAoB6Y,OAAO,UAG9B7Y,EAAE,WAAWoZ,OAAO,SAASxK,GAC5BA,EAAEgE,iBAEF5S,EAAE,YAAYoU,KAAK,IAAIS,OAEvB7U,EAAE2L,MACDC,IAAK,cACL7I,KAAM,OACN8I,KAAM7L,EAAEI,MAAMwP,YACd7D,SAAU,SACRgM,KAAK,SAAS0E,GACZA,GAAYA,EAAS1V,QACxB/G,EAAE,oBAAoBoU,KAAK,oBAC3BpU,EAAE,eAAe6Y,OAAO,QAExB7Y,EAAE,oBAAoB6Y,OAAO,UACnB4D,GAAYA,EAASsoB,MAC/B/kC,EAAE,YAAYoU,KAAKqI,EAASsoB,OAAOnwB,KAAK,SAAUowB,UAAW,OAE7DhlC,EAAE,YAAYoU,KAAK,iBAAiBQ,KAAK,SAAUowB,UAAW,WAKjEhlC,EAAE,0BAA0B6Y,QAC3BmC,UAAU,EACVhC,WAAW,EACXC,UAAW,EACXC,YAAa,gDACbtO,SACCi5B,KAAM,WACL7jC,EAAE,iBAAiBoZ,UAEpBL,OAAQ,WACP/Y,EAAEI,MAAMyY,OAAO,WAGjBQ,KAAM,WACLrZ,EAAE,2BAA2BmI,KAAKnI,EAAE,6BAA6BmI,SAElEmR,MAAO,WACNtZ,EAAE,mCAAmCf,IAAI,IACzCe,EAAE,kBAAkBoU,KAAK,IAAIS,UAI/B7U,EAAE,mBAAmB0P,MAAM,WAC1B1P,EAAE,0BAA0B6Y,OAAO,UAGpC7Y,EAAE,iBAAiBoZ,OAAO,SAASxK,GAClCA,EAAEgE,iBAEF5S,EAAE,kBAAkBoU,KAAK,IAAIS,OAE7B7U,EAAE2L,MACDC,IAAK,cACL7I,KAAM,OACN8I,KAAM7L,EAAEI,MAAMwP,YACd7D,SAAU,SACRgM,KAAK,SAAS0E,GACZA,GAAYA,EAAS1V,QACxB/G,EAAE,oBAAoBoU,KAAK,oBAC3BpU,EAAE,eAAe6Y,OAAO,QAExB7Y,EAAE,6BAA6BmI,KAAKsU,EAAS1V,QAE7C/G,EAAE,0BAA0B6Y,OAAO,UACzB4D,GAAYA,EAASsoB,MAC/B/kC,EAAE,kBAAkBoU,KAAKqI,EAASsoB,OAAOnwB,KAAK,SAAUowB,UAAW,OAEnEhlC,EAAE,kBAAkBoU,KAAK,iBAAiBQ,KAAK,SAAUowB,UAAW,WAMvEhlC,EAAE,UAAU2S,GAAG,SAAU,yBAA0B,WAC9C3S,EAAEI,MAAMyL,KAAK,UAChB7L,EAAE,uBAAuB+U,WAAW,YACpC/U,EAAE,yBAAyB+U,WAAW,cAEtC/U,EAAE,uBAAuB8H,KAAK,WAAY,YAC1C9H,EAAE,yBAAyB8H,KAAK,WAAY,aAGxB,GAAjB9H,EAAEI,MAAMnB,OAA+C,GAA/Be,EAAEI,MAAMnB,MAAMiD,MAAM,KAAK,GACpDlC,EAAE,0BAA0B+U,WAAW,YAEvC/U,EAAE,0BAA0B8H,KAAK,WAAY,cAK/C9H,EAAE,oBAAoB6Y,QACrBmC,UAAU,EACVhC,WAAW,EACXE,YAAa,gDACbtO,SACCq6B,IAAK,WACJ,IAAItM,EAAO34B,EAAE,2CACT0hB,EAAQ1hB,EAAE,iDAEdA,EAAE2L,MACDC,IAAK,YACL7I,KAAM,OACN8I,MAAO8sB,KAAMA,EAAK15B,MAAO6M,KAAM,QAC/BC,SAAU,SACRgM,KAAK,SAAS0E,GACZA,GAAYA,EAAS1V,SACxB2a,EAAM3U,IAAI,QAAS,IACnB2U,EAAMriB,KAAK,SAAS2V,SACpB0M,EAAMzT,OAAO,oGAEbjO,EAAE,2BAA2Byc,EAAS1Z,KAAK,wBAAwB2wB,OAAOiF,GAAMjF,OAAOhS,GACvF1hB,EAAE,oBAAoB6Y,OAAO,aAIhCE,OAAQ,WACP/Y,EAAEI,MAAMyY,OAAO,WAGjBU,OAAQ,WACPvZ,EAAE,yBAAyBoZ,OAAO,SAASxK,GAC1CA,EAAEgE,iBAEF5S,EAAE,6BAA6BmI,KAAK,IACpCnI,EAAE,6BAA6B4U,OAC/B5U,EAAE,yCAAyC8H,KAAK,WAAY,YAE5D9H,EAAE2L,MACDC,IAAK,YACL7I,KAAM,OACN8I,KAAM7L,EAAEI,MAAMwP,YACd7D,SAAU,SACRkkB,KAAK,SAASxT,GAChB,GAAIA,GAAYA,EAASrX,SAAWqX,EAASrX,QAAQtF,OACpD,OAAO8D,SAAS4M,IAAIonB,WAAWnb,EAASwa,QACtClf,KAAK,SAAS3S,GACd,GAAIA,EACH,IAAK,IAAI7B,KAAK6B,EAAS,CACtB,IAAIuzB,EAAOlc,EAASrX,QAAQ7B,GACxB4a,EAAOne,EACR,2CAA2C24B,EAAKA,KAAK,YAAYA,EAAKA,KAAK,qDAAqDA,EAAK4L,MAAM,uBACxH5L,EAAKA,KAAK,yDACfA,EAAK6L,IAAI,sCACU7L,EAAKjX,MAAM,kCAEvCtc,EAAQ7B,GAAGpC,KAAO,aACM,aAAvBiE,EAAQ7B,GAAGw0B,SAA0B3yB,EAAQ7B,GAAG40B,YAAYh3B,KAAM,QAAU,MAClF,QAAMiE,EAAQ7B,GAAG+0B,SAAWlzB,EAAQ7B,GAAG+0B,SAASn3B,KAAO,IAAI,yBAI9DnB,EAAE,6BAA6BiO,OAAOkQ,MAIhC1B,GAAYA,EAASsoB,OAC/B/kC,EAAE,sBAAsBoU,KAAKqI,EAASsoB,OACtC/kC,EAAE,iBAAiB6Y,OAAO,UAE1B7Y,EAAE,sBAAsBoU,KAAK,iBAC7BpU,EAAE,iBAAiB6Y,OAAO,WAEzBoX,KAAK,WACPjwB,EAAE,6BAA6B6U,OAC/B7U,EAAE,yCAAyC+U,WAAW,iBAIzDuE,MAAO,WACNtZ,EAAE,6BAA6BmI,KAAK,IACpCnI,EAAE,uCAAuCf,IAAI,OAI/Ce,EAAE,0BAA0B2S,GAAG,QAAS,2BAA4B,WACnE3S,EAAE,uCAAuCf,IAAIe,EAAEI,MAAMxB,OAAOK,OAC5De,EAAE,oBAAoB6Y,OAAO,UAI9B7Y,EAAE,0BAA0B2S,GAAG,QAAS,aAAc,WACrD,IAAIgmB,EAAO34B,EAAEI,MAAM4W,QAAQ,wBAAwBpY,OAEnDoB,EAAE,wBAAwBoU,KAAK,8CAE/BpU,EAAE,mBAAmB6Y,OAAO,UAC3BjO,SACCs6B,OAAQ,WACP,IAAIC,GAAQr5B,KAAM,QAAS6sB,KAAMA,EAAK15B,OAEtCe,EAAE2L,MACDC,IAAK,YACL7I,KAAM,OACN8I,KAAMs5B,EACNp5B,SAAU,SACRgM,KAAK,SAAS0E,GACZA,GAAYA,EAAS1V,QACxB4xB,EAAKjN,OAAO1W,SACZ2jB,EAAK3jB,SAELhV,EAAE,mBAAmB6Y,OAAO,WAE5B7Y,EAAE,mBAAmB6Y,OAAO,SAE5B7Y,EAAE,sBAAsBoU,KAAK,oBAC7BpU,EAAE,iBAAiB6Y,OAAO,YAI7BE,OAAQ,WACP/Y,EAAEI,MAAMyY,OAAO,aAGfA,OAAO,UAIX7Y,EAAE,yBAAyB0P,MAAM,WAChC,IAAIipB,EAAO34B,EAAE,iCAEbA,EAAE,wBAAwBoU,KAAK,8CAC/BpU,EAAE,mBAAmB6Y,OAAO,UAC3BjO,SACCq4B,OAAQ,WACP,IAAIkC,GAAQr5B,KAAM,SAAU6sB,KAAMA,EAAK15B,OAEvCe,EAAE2L,MACDC,IAAK,YACL7I,KAAM,OACN8I,KAAMs5B,EACNp5B,SAAU,SACRgM,KAAK,SAAS0E,GACZA,GAAYA,EAAS1V,QACxB4xB,EAAKjN,OAAO1W,SACZ2jB,EAAK3jB,SAELhV,EAAE,mBAAmB6Y,OAAO,WAE5B7Y,EAAE,mBAAmB6Y,OAAO,SAE5B7Y,EAAE,sBAAsBoU,KAAK,oBAC7BpU,EAAE,iBAAiB6Y,OAAO,YAI7BE,OAAQ,WACP/Y,EAAEI,MAAMyY,OAAO,aAGfA,OAAO,UAIX7Y,EAAE,sBAAsB6Y,QACvBmC,UAAU,EACV9B,YAAa,gDACbtO,SACCw6B,OAAQ,WACPplC,EAAE,2BAA2BoZ,UAE9BL,OAAQ,WACP/Y,EAAEI,MAAMyY,OAAO,WAGjBU,OAAQ,WACPvZ,EAAE,kCAAkC2S,GAAG,QAAS,oBAAqB,WACpE3S,EAAE,qBAAqB6Y,OAAO,UAG/B7Y,EAAE,2BAA2BoZ,OAAO,SAASxK,GAC5CA,EAAEgE,iBAEF5S,EAAE2L,MACDC,IAAK,YACL7I,KAAM,OACN8I,KAAM7L,EAAEI,MAAMwP,YACd7D,SAAU,SACRgM,KAAK,SAAS0E,GACZA,GAAYA,EAAS1V,QAExB/G,EAAE2L,MACDC,IAAK,YACL7I,KAAM,OACNgJ,SAAU,SACRgM,KAAK,SAAS0E,GAChB,GAAIA,GAAYA,EAASnT,MAAO,CAK/B,IAAK,IAAI/F,KAJTvD,EAAE,mCAAmCmI,KAAK,IAC1CnI,EAAE,oCAAoCmI,KAAK,IAC3CnI,EAAE,qCAAqCmI,KAAK,IAE9BsU,EAASnT,MAAO,CAC7B,IAAIqvB,EAAOlc,EAASnT,MAAM/F,GACtB4a,EAAOne,EACR,2CAA2CuD,EAAE,YAAYo1B,EAAKA,KAAK,kCAAkCA,EAAK/X,MAAM,iBAAiB+X,EAAK4L,MAAM,uBACzHhhC,EAAE,eAAeo1B,EAAK6L,IAAI,QAC3C7L,EAAK8L,SAAW,mGAAqG,IACvH,gCAAgC9L,EAAKjX,MAAM,mBAE9C1hB,EAAE,2BAA2B24B,EAAK51B,MAAMkL,OAAOkQ,GAG5CA,EAAOne,EAAE,4OAKb,GAFAA,EAAE,oCAAoCiO,OAAOkQ,GAE3B,KAAdvV,KAAK27B,MAAc,CAClBpmB,EAAOne,EAAE,6OAGbA,EAAE,qCAAqCiO,OAAOkQ,GAG/Cne,EAAE,sCAAsC6N,OAAO,WAAW4O,EAASnT,MAAMmT,EAASpT,QAAQsvB,KAAK,MAAM7wB,KAAK,WAAW,GAAMZ,QAAQ,UAGnIuV,EAASnT,MAAMmT,EAASpT,QAAQk7B,MAAQvkC,EAAE,UAAU6G,YAAY,YAAc7G,EAAE,UAAU2G,SAAS,eAIrG3G,EAAE,sBAAsB6Y,OAAO,UACrB4D,GAAYA,EAASsoB,OAC/B/kC,EAAE,sBAAsBoU,KAAKqI,EAASsoB,OACtC/kC,EAAE,iBAAiB6Y,OAAO,UAE1B7Y,EAAE,sBAAsBoU,KAAK,iBAC7BpU,EAAE,iBAAiB6Y,OAAO,aAK7B7Y,EAAE,6BAA6BqlC,YAAYr4B,MAAO,OAEnDqM,KAAM,WACLrZ,EAAE,yCAAyCf,IAAI,IAC/Ce,EAAE,gDAAgDgV,YAIpDhV,EAAE,yBAAyB0P,MAAM,WAChC1P,EAAE,sBAAsB6Y,OAAO,UAGhC7Y,EAAE,kCAAkC2S,GAAG,QAAS,cAAe,WAC9D3S,EAAEI,MAAM4W,QAAQ,wBAAwBpY,OAAOoW,SAC/ChV,EAAEI,MAAM4W,QAAQ,SAAShC,WAG1BhV,EAAE,oBAAoB6Y,QACrBmC,UAAU,EACV9B,YAAa,gDACbtO,SACCi5B,KAAM,WACL7jC,EAAE,yBAAyBoZ,UAE5BL,OAAQ,WACP/Y,EAAEI,MAAMyY,OAAO,WAGjBU,OAAQ,WACPvZ,EAAE,gCAAgC2S,GAAG,QAAS,cAAe,WAC5D3S,EAAEI,MAAM4W,QAAQ,wBAAwBpY,OAAOkJ,KAAK,OAAQ,aAAa+M,OACzE7U,EAAEI,MAAM4W,QAAQ,SAASnC,SAG1B7U,EAAE,gCAAgC2S,GAAG,QAAS,kBAAmB,WAChE3S,EAAE,qBAAqB6Y,OAAO,UAG/B7Y,EAAE,yBAAyBoZ,OAAO,SAASxK,GAC1CA,EAAEgE,iBAEF5S,EAAE2L,MACDC,IAAK,YACL7I,KAAM,OACN8I,KAAM7L,EAAEI,MAAMwP,YACd7D,SAAU,SACRgM,KAAK,SAAS0E,GACZA,GAAYA,EAAS1V,OACxB/G,EAAE,oBAAoB6Y,OAAO,SACnB4D,GAAYA,EAASsoB,OAC/B/kC,EAAE,sBAAsBoU,KAAKqI,EAASsoB,OACtC/kC,EAAE,iBAAiB6Y,OAAO,UAE1B7Y,EAAE,sBAAsBoU,KAAK,iBAC7BpU,EAAE,iBAAiB6Y,OAAO,cAK9BQ,KAAM,WACL,IAAIsf,EAAO34B,EAAE,8CAA8Cf,MAC3De,EAAE,uCAAuCf,IAAI05B,GAC7C34B,EAAE,6CAA6C6U,OAC/C7U,EAAE,6BAA6B4U,OAC/B5U,EAAE,0BAA0BoU,KAAKpU,EAAE,oEAAoEoU,QAEvGpU,EAAE2L,MACDC,IAAK,YACL7I,KAAM,OACN8I,MAAOC,KAAM,OAAQ6sB,KAAMA,GAC3B5sB,SAAU,SACRkkB,KAAK,SAASxT,GAChB,GAAIA,GAAYA,EAASrX,SAAWqX,EAASrX,QAAQtF,OACpD,OAAO8D,SAAS4M,IAAIonB,WAAWnb,EAASrX,SACtC2S,KAAK,SAAS3S,GACd,GAAIA,EACH,IAAK,IAAI7B,KAAK6B,EACb,GAA2B,aAAvBA,EAAQ7B,GAAGw0B,SAAyB,CACvC,IAAI5Z,EAAOne,EACR,oFAAoFoF,EAAQ7B,GAAGG,GAAG,iBAAiB0B,EAAQ7B,GAAGG,GAAG,8CAC7G0B,EAAQ7B,GAAGG,GAAG,4DACkB0B,EAAQ7B,GAAGG,GAAG,qFAG7D0B,EAAQ7B,GAAGpC,KAAO,YAClBiE,EAAQ7B,GAAG40B,YAAYh3B,KAAK,aAC3BiE,EAAQ7B,GAAG+0B,SAAWlzB,EAAQ7B,GAAG+0B,SAASn3B,KAAO,IAAI,2IAK9DnB,EAAE,8CAA8C0zB,OAAOvV,QACjD,GAA2B,eAAvB/Y,EAAQ7B,GAAGw0B,SAA2B,CAC5C5Z,EAAOne,EACR,oFAAoFoF,EAAQ7B,GAAGG,GAAG,cAAc0B,EAAQ7B,GAAGG,GAAG,2CAC1G0B,EAAQ7B,GAAGG,GAAG,2DACoB0B,EAAQ7B,GAAGG,GAAG,uFAG/D0B,EAAQ7B,GAAGpC,KAAK,aACfiE,EAAQ7B,GAAG+0B,SAAWlzB,EAAQ7B,GAAG+0B,SAASn3B,KAAO,IAAI,2IAK9DnB,EAAE,8CAA8C0zB,OAAOvV,QAM3D8R,KAAK,SAASxT,GAChBzc,EAAE,6CAA6C4U,OAC/C5U,EAAE,6BAA6B6U,UAGjCyE,MAAO,WACNtZ,EAAE,8CAA8CgV,YAIlDhV,EAAE,uBAAuB0P,MAAM,WAC9B1P,EAAE,oBAAoB6Y,OAAO,UAI9B7Y,EAAE,qBAAqB6Y,QACtBmC,UAAU,EACV9B,YAAa,gDACbtO,SACCq6B,IAAK,WACJ,GAAIjlC,EAAE,4BAA4BA,EAAE,2BAA2Bf,MAAM,MAAMa,OAG1E,OAFAE,EAAE,sBAAsBoU,KAAK,sBAC7BpU,EAAE,iBAAiB6Y,OAAO,SACnB,EAGR7Y,EAAE,2BAA2BiO,OAAO,kHACpCjO,EAAE,mCAAmC8H,KAAK,UAAW,WACrD9H,EAAE,mCAAmC8H,KAAK,UAAW,gBAErD,IAAImY,EAAQjgB,EAAE,kDAEVA,EAAE,sBAAsB6Y,OAAO,UAClC7Y,EAAE,gDAAgD0zB,OAAOzT,GACjDjgB,EAAE,oBAAoB6Y,OAAO,WACrC7Y,EAAE,8CAA8C0zB,OAAOzT,GAExDjgB,EAAEI,MAAMyY,OAAO,UAEhBoC,MAAO,WACNjb,EAAEI,MAAMyY,OAAO,WAGjBU,OAAQ,WACPvZ,EAAE,cAAcoZ,OAAO,SAASxK,GAG/B,GAFAA,EAAEgE,iBAE8C,IAA5C5S,EAAE,iCAAiCf,MACtC,OAAO,EAGRe,EAAE,mCAAmCmI,KAAK,IAC1CnI,EAAE,6BAA6B4U,OAC/B5U,EAAE,mCAAmC8H,KAAK,WAAY,YACtD9H,EAAE,qBAAqBkX,SAAS7X,KAAK,gDAAgDyI,KAAK,YAAY,GAAMnB,SAAS,qBAErH/C,SAAS4M,IAAI5C,OAAO5N,EAAE,iCAAiCf,MAAOe,EAAE,6CAA6Cf,MAAOe,EAAE,kCAAkC,GAAG2Z,SACzJ5B,KAAK,SAAS3S,GACd,GAAIA,IAAYA,EAAQyD,WAAazD,EAAQ+yB,aAK5C,OAHA/yB,EAAUpF,EAAEuB,MAAM6D,EAAQyD,cAAiBzD,EAAQ+yB,iBACnDmN,MAAQlgC,EAAQtF,OAChBsF,EAAUA,EAAQqb,MAAM,EAAG,IACpB7c,SAAS4M,IAAIonB,WAAWxyB,GAC7B2S,KAAK,SAAS3S,GAEd,GADApF,EAAE,2BAA2BmI,KAAK,UAAUm9B,MAAM,kBAAkBA,MAAM,GAAGA,MAAM,KAC/ElgC,EACH,IAAK,IAAI7B,KAAK6B,EACb,GAA2B,aAAvBA,EAAQ7B,GAAGw0B,SAAyB,CACvC,IAAI5Z,EAAOne,EACR,uEAAuEoF,EAAQ7B,GAAGG,GAAG,iBAAiB0B,EAAQ7B,GAAGG,GAAG,8CAChG0B,EAAQ7B,GAAGG,GAAG,4DACkB0B,EAAQ7B,GAAGG,GAAG,qFAG7D0B,EAAQ7B,GAAGpC,KAAO,YAClBiE,EAAQ7B,GAAG40B,YAAYh3B,KAAK,aAC3BiE,EAAQ7B,GAAG+0B,SAAWlzB,EAAQ7B,GAAG+0B,SAASn3B,KAAO,IAAI,+BAI9DnB,EAAE,qBAAqBiO,OAAOkQ,QACxB,GAA2B,eAAvB/Y,EAAQ7B,GAAGw0B,SAA2B,CAC5C5Z,EAAOne,EACR,uEAAuEoF,EAAQ7B,GAAGG,GAAG,cAAc0B,EAAQ7B,GAAGG,GAAG,2CAC7F0B,EAAQ7B,GAAGG,GAAG,2DACoB0B,EAAQ7B,GAAGG,GAAG,uFAG/D0B,EAAQ7B,GAAGpC,KAAK,aACfiE,EAAQ7B,GAAG+0B,SAAWlzB,EAAQ7B,GAAG+0B,SAASn3B,KAAO,IAAI,+BAI9DnB,EAAE,qBAAqBiO,OAAOkQ,MAI/BkX,OAAO,WACTr1B,EAAE,6BAA6B6U,OAC/B7U,EAAE,mCAAmC+U,WAAW,YAChD/U,EAAE,qBAAqBkX,SAAS7X,KAAK,gDAAgD0V,WAAW,YAAYlO,YAAY,uBAG1H7G,EAAE,sBAAsBoU,KAAK,cAC7BpU,EAAE,iBAAiB6Y,OAAO,QAE1B7Y,EAAE,6BAA6B6U,OAC/B7U,EAAE,mCAAmC+U,WAAW,YAChD/U,EAAE,qBAAqBkX,SAAS7X,KAAK,gDAAgD0V,WAAW,YAAYlO,YAAY,0BAK7HyS,MAAO,WACNtZ,EAAE,iCAAiCf,IAAI,IACvCe,EAAE,mCAAmCmI,KAAK,UAM9CnI,EAAE,mBAAmB6Y,OAAO;ACzwB7B7Y,EAAE,qBAAqB2S,GAAG,QAAS,oBAAqB,SAAS/D,GAGhE,OAFAA,EAAEgE,kBAEE5S,EAAEI,MAAM4W,QAAQ,MAAMlP,KAAK,cAEiB,GAArC9H,EAAE,yBAAyBF,SAE3BE,EAAE,mBAAmB2P,SAAS,sBAAwB3P,EAAE,mBAAmB6Y,OAAO,WAC5F7Y,EAAE,mBAAmBkX,SAASsD,OAAO,QAAS,MACvC,QAIHxa,EAAE,qBAAqB2P,SAAS,qBAuDzB3P,EAAE,qBAAqB6Y,OAAO,WACzC7Y,EAAE,qBAAqB6Y,OAAO,QAvD9B7Y,EAAE,qBAAqB6Y,QACtBG,WAAW,EACXC,UAAW,EACXC,YAAa,mCACbtO,SACCq4B,OAAQ,WAEPjjC,EAAE,qBAAqBkX,SAAS7X,KAAK,8BAA8Bqe,OAAO,WAC1E,IAAIxC,GAAWhR,YAAe8K,WAAehH,SAAYjG,iBACrDoI,KAEAjG,EAAalK,EAAE2D,IAAI3D,EAAE,yBAA0B,SAASgC,GAC3D,IAAI2R,EAAY/P,SAASqM,OAAO/F,WAAWlK,EAAEgC,GAAG6J,KAAK,OACrD,GAAsB,YAAlB8H,EAAU5Q,KAEb,OADAoN,EAAKtQ,KAAK8T,GACHA,EAAUjQ,GAEjB,IAAImQ,EAAW7T,EAAE2D,IAAIC,SAASqM,OAAO/L,UAAW,SAAS2P,GAAY,GAAIA,EAASC,WAAaH,EAAUjQ,IAAMmQ,EAASE,aAAeJ,EAAUjQ,GAAI,OAAOmQ,IAAa,GAEzK,OADA1D,EAAKtQ,MAAMgU,SAAYA,EAAU3J,YAAetG,SAASqM,OAAO/F,WAAW2J,EAASC,WAAYlQ,SAASqM,OAAO/F,WAAW2J,EAASE,gBAC7HF,IAGTqH,EAAQhR,WAAW8K,OAAS9K,EAqB5BtG,SAAS4O,QAAQ,UAAW0I,EAnBd,SAASrP,GAClBA,EAAKknB,WAAyC,GAA5BlnB,EAAKknB,UAAU,GAAGhsB,SACvC/G,EAAE,qBAAqB6Y,OAAO,SAE9B7Y,EAAE,SAAS6G,YAAY,YACnBkB,mBAAmBnE,SAASsG,WAAWiG,KAC1CvM,SAASsG,WAAWiG,KAAKpI,iBAAiBlI,MAAMozB,OAAQ,SAAU/oB,WAAYiG,IAE9EvM,SAASsG,WAAWiG,KAAKpI,mBAAqBkrB,OAAQ,SAAU/oB,WAAYiG,IAG7EC,eAAe1E,QAAQ,gBAAiBnD,KAAKgD,UAAU3H,SAASsG,WAAWiG,SAIhE,SAAStE,GACrB7L,EAAE,qBAAqBkX,SAAS7X,KAAK,8BAA8Bqe,OAAO,aAK5E3E,OAAQ,WACP/Y,EAAEI,MAAMyY,OAAO,WAGjBS,MAAO,WACNtZ,EAAE,yBAAyB6G,YAAY;AChE3C7G,EAAE,mBAAmB2S,GAAG,WAAY,MAAO7G,KAAM,SAAUiL,OAAO,WAAYwuB,qBAC9EvlC,EAAE,mBAAmB2S,GAAG,SAAU7G,KAAM,SAAUiL,OAAO,YAAawuB,qBACtEvlC,EAAE,kBAAkB0P,OAAO5D,KAAM,OAAQy5B,qBAEzC,MAAMC,eACN,SAASD,oBAAoB32B,GAI5B,OAHGA,EAAEgE,gBAAkBhE,EAAEgE,iBACzB4yB,YAAY15B,KAAO8C,EAAE/C,KAAKC,KAEnB05B,YAAY15B,MAClB,IAAK,SACJ,GAAqB,WAAjB8C,EAAE/C,KAAKkL,OACV/W,EAAE,yBAAyB6G,YAAY,YACvC7G,EAAEI,MAAM4W,QAAQ,MAAMrQ,SAAS,YAC/B6+B,YAAYC,MAAQzlC,EAAEI,MAAMyL,KAAK,WAC3B,GAAqB,YAAjB+C,EAAE/C,KAAKkL,OAAsB,CACvC,IAAI0T,EAAWzqB,EAAE,+BACjB,GAAwB,IAApByqB,EAAS3qB,OACZ,OAAO,EAEP0lC,YAAYC,MAAQzlC,EAAEyqB,EAAS,IAAI5e,KAAK,WAEjC25B,YAAYC,MAAQ72B,EAAE/C,KAAK8H,UACpC,MACD,eAAgB6xB,YAAYC,MAG7BD,YAAYz9B,iBAAmBnE,SAASqM,OAAO/F,WAAWs7B,YAAYC,SAAWz3B,SAAUjG,kBAAmBiG,SAC9Gw3B,YAAY39B,cAAgBjE,SAASC,QAAQ2hC,YAAYz9B,iBAEpD/H,EAAE,qBAAqB2P,SAAS,qBAuZzB3P,EAAE,qBAAqB6Y,OAAO,WACzC7Y,EAAE,qBAAqB6Y,OAAO,QAvZ9B7Y,EAAE,qBAAqB6Y,QACtBmC,UAAU,EACVhC,WAAW,EACXE,YAAa,mCACb/C,UAAW8D,GAAI,SAAUC,GAAI,SAAUC,GAAIna,EAAE,sBAC7C4K,SACCi5B,KAAM,WACL7jC,EAAE,mBAAmBoZ,UAEtB6rB,IAAK,WACJjlC,EAAE,mBAAmBoZ,UAEtBL,OAAQ,WACP/Y,EAAEI,MAAMyY,OAAO,WAGjBU,OAAQ,WACP,IAAImsB,EAAgB1lC,EAAE2D,IAAIC,SAASM,UAAW,SAASsN,EAAMxS,GAAS,OAAOA,IAC7E0mC,EAAclxB,OAAO,GAAI,EAAG,QAC5BkxB,EAAc7lC,KAAK,QACnB6lC,EAAc7lC,KAAK,OACnB6lC,EAAc7lC,KAAK,OACnB6lC,EAAc7lC,KAAK,OACnB6lC,EAAc7lC,KAAK,OAEnBG,EAAE,sFAAsFqlC,YAAYr4B,MAAO,MAC3GhN,EAAE,oFAAoFqlC,YAAYr4B,MAAO,KACzGhN,EAAE,sDAAsDwZ,gBAAgBzC,OAAQnT,SAASqQ,YAAawF,QAAS,GAAItO,MAAO,IAC1HnL,EAAE,mDAAmDwZ,gBAAgBzC,OAAQ2uB,EAAejsB,QAAS,GAAItO,MAAO,IAEhHnL,EAAE,qCAAqC2lC,iBACvC3lC,EAAE,qCAAqC2S,GAAG,SAAU,WAE/CvS,KAAKS,MAAQ,IAChBT,KAAKS,MAAQ,EACbb,EAAEI,MAAMic,YAKVrc,EAAE,+FAA+F2S,GAAG,QAAS,WAC5G,MAAQ,gBAAgBzR,KAAKd,KAAKS,QACjCT,KAAKS,MAAQT,KAAKS,MAAMmF,UAAU,EAAG5F,KAAKS,MAAMf,OAAQ,KAK1DE,EAAE,gDAAgD2S,GAAG,QAAS,WACnC,IAAtBvS,KAAKS,MAAMf,QACdE,EAAE,kDAAkDsU,WAItDtU,EAAE,iDAAiD2S,GAAG,QAAS,WACpC,IAAtBvS,KAAKS,MAAMf,QACdE,EAAE,mDAAmDsU,WAKvDtU,EAAE,mGAAmG2S,GAAG,QAAS,WAChH,MAAQ,aAAazR,KAAKd,KAAKS,QAC9BT,KAAKS,MAAQT,KAAKS,MAAMmF,UAAU,EAAG5F,KAAKS,MAAMf,OAAQ,KAK1DE,EAAE,mEAAmE2S,GAAG,QAAS,WAChF3S,EAAEI,MAAMkU,WAITtU,EAAE,mCAAmC2S,GAAG,gBAAiB,WACpDvS,KAAKS,MAAMf,OAAS,IAA4D,GAAvDE,EAAEuN,QAAQnN,KAAKS,MAAMyB,cAAeojC,IAAoD,QAA5BtlC,KAAKS,MAAMyB,eACnGtC,EAAE,mCAAmC4lC,IAAIxlC,MAAMnB,IAAI,QAG/C2E,SAASM,UAAU9D,KAAKS,MAAMyB,gBACjCtC,EAAE,qCAAqCf,IAAwE,GAApE2E,SAASM,UAAU9D,KAAKS,MAAMyB,eAAesP,KAAK5L,UAAU,EAAG,GAAU,IAAIqW,UAElF,SAA7Bjc,KAAKS,MAAMyB,eACiF,IAAlGtC,EAAEuN,QAAQvN,EAAE,mCAAmC4lC,IAAIxlC,MAAMnB,MAAMqD,cAAeojC,IAAgG,SAAvE1lC,EAAE,mCAAmC4lC,IAAIxlC,MAAMnB,MAAMqD,eAC/JtC,EAAE,mCAAmC4lC,IAAIxlC,MAAMnB,IAAI,QAE5B,QAAdmB,KAAKS,OACfb,EAAE,mCAAmC4lC,IAAIxlC,MAAMnB,IAAI,UAKrDe,EAAE,qBAAqB2S,GAAG,mBAAoB,yBAA0B,WACrD,YAAdvS,KAAKS,OACRb,EAAE,2BAA2B6zB,QAAQ,IAAK,WAAa7zB,EAAEI,MAAMyU,KAAK,KACpE7U,EAAE,+BAA+B2xB,UAAU,IAAK,WAAa3xB,EAAEI,MAAMwU,KAAK,SAE1E5U,EAAE,2BAA2B2xB,UAAU,IAAK,WAAa3xB,EAAEI,MAAMwU,KAAK,OACtE5U,EAAE,+BAA+B6zB,QAAQ,IAAK,WAAa7zB,EAAEI,MAAMyU,KAAK,MAGzEiB,mBAAmBwD,UAGpBtZ,EAAE,mBAAmBoZ,OAAO,SAASxK,GACpCA,EAAEgE,iBACF,IAAIizB,EAAO7lC,EAAEI,MAAMF,kBACf4lC,GAAQ,EAYZ,GAXAhwB,mBAAmBwD,QAGnBtZ,EAAEgB,KAAKhB,EAAE,0CAA2C,WACnD,GAAII,KAAKS,MAAMf,OAAS,GAAKM,KAAKS,MAAMf,OAAS,EAIhD,OAHAgW,mBAAmBuD,MAAMzC,OAAQ5W,EAAEI,QAAQyX,WAAW,mCACtD7X,EAAEI,MAAMkU,SACRwxB,GAAQ,GACD,KAGJA,EAAO,OAAO,EAGnB,GAAsC,IAAlCD,EAAKE,kBAAkBjmC,QAAoD,IAApC+lC,EAAKG,oBAAoBlmC,QAAmI,GAAnHvB,OAAOc,KAAKuE,SAASqM,OAAO/F,WAAY,cAAe27B,EAAKE,kBAAoBF,EAAKG,qBAAqB,IAAkBznC,OAAOc,KAAKuE,SAASqM,OAAO/F,WAAY,cAAe27B,EAAKE,kBAAoBF,EAAKG,qBAAqB,GAAMtiC,IAAM1D,EAAE,qBAAqB6L,KAAK,eAAgB,CACjX,IAAIo6B,EAAoB1nC,OAAOc,KAAKuE,SAASqM,OAAO/F,WAAY,cAAe27B,EAAKE,kBAAoBF,EAAKG,qBAI7G,OAHAlwB,mBAAmBuD,MAAMzC,OAAQ5W,EAAE,0CAA0C6X,WAAW,iLAAkLouB,EAAkBviC,GAAI,QAChS1D,EAAE,cAAcqU,QAChByxB,GAAQ,GACD,EAER,IAAKA,EAAO,OAAO,EAWnB,GARA9lC,EAAEgB,KAAKhB,EAAE,2CAA4C,WACpD,GAAII,KAAKS,MAAMf,OAAS,IAA4D,GAAvDE,EAAEuN,QAAQnN,KAAKS,MAAMyB,cAAeojC,IAAsC,QAAdtlC,KAAKS,MAI7F,OAHAiV,mBAAmBuD,MAAMzC,OAAQ5W,EAAEI,QAAQyX,WAAW,kCACtD7X,EAAEI,MAAMkU,SACRwxB,GAAQ,GACD,KAGJA,EAAO,OAAO,EAWnB,GARA9lC,EAAEgB,KAAKhB,EAAE,sCAAuC,WAC/C,GAAII,KAAKS,MAAMf,OAAS,IAAmG,GAA9F8D,SAASqQ,YAAYiyB,UAAW10B,GAASpR,KAAKS,MAAMzB,gBAAkBoS,EAAKpS,eAIvG,OAHA0W,mBAAmBuD,MAAMzC,OAAQ5W,EAAEI,QAAQyX,WAAW,oCACtD7X,EAAEI,MAAMkU,SACRwxB,GAAQ,GACD,KAGJA,EAAO,OAAO,EAWnB,GARA9lC,EAAEgB,KAAKhB,EAAE,sCAAuC,WAC/C,GAAII,KAAKS,MAAMf,OAAS,GAAKM,KAAKS,MAAMzB,gBAAkBomC,YAAY39B,cAAc1G,KAAK/B,cAIxF,OAHA0W,mBAAmBuD,MAAMzC,OAAQ5W,EAAEI,QAAQyX,WAAW,0DACtD7X,EAAEI,MAAMkU,SACRwxB,GAAQ,GACD,KAGJA,EAAO,OAAO,EAEnB,IAAI5qB,KACA/K,KACJ,GAA2B,aAAvB01B,EAAKM,cAA8B,CACtC,IAAIxyB,GACHC,YAAeiyB,EAAKE,kBAAoBF,EAAKG,oBAC7Ch4B,SAAYw3B,YAAYz9B,gBACxBhF,KAAQ,WACR5B,KAAQ0kC,EAAKO,aACblyB,WAAc2xB,EAAKQ,iBAEhBliC,EAAU,KACV5F,OAAOS,MAAM4E,SAASC,QAAS,OAAQgiC,EAAK1hC,SAAS,GAExDA,EAAU5F,OAAOS,MAAM4E,SAASC,QAAS,OAAQgiC,EAAK1hC,SAAS,GACrDP,SAASM,UAAU2hC,EAAKS,aAAahkC,eAE3CsB,SAASqQ,YAAYiyB,UAAW10B,GAAS5N,SAASM,UAAU2hC,EAAKS,aAAahkC,eAAe6B,QAAQzC,QAAQ,IAAK,KAAKtC,gBAAkBoS,EAAKpS,gBAAkB,IACnK+E,EAAUP,SAASqQ,YAAYiyB,UAAW10B,GAAS5N,SAASM,UAAU2hC,EAAKS,aAAahkC,eAAe6B,QAAQzC,QAAQ,IAAK,KAAKtC,gBAAkBoS,EAAKpS,iBAE9C,IAAjGwE,SAASqQ,YAAYiyB,UAAW10B,GAASq0B,EAAK1hC,QAAQ/E,gBAAkBoS,EAAKpS,iBAEvF+E,EAAUP,SAASqQ,YAAYiyB,UAAW10B,GAASq0B,EAAK1hC,QAAQ/E,gBAAkBoS,EAAKpS,gBAExF,IAAI0zB,GACHlf,YAAeiyB,EAAKU,mBAAqBV,EAAKW,qBAC9Cx4B,SAAY7J,EACZpB,KAAQ,WACR5B,KAAQ0kC,EAAKY,cACbvyB,WAAc2xB,EAAKQ,iBAEhBtjC,EAAO,KACPmU,EAAS,KACT2uB,EAAKS,aAAaxmC,OAAS,IAAmE,GAA9DE,EAAEuN,QAAQs4B,EAAKS,aAAahkC,cAAeojC,IAA2D,QAAnCG,EAAKS,aAAahkC,eACxH4U,EAAS,UACTnU,EAAO8iC,EAAKS,aAAahkC,eACfujC,EAAKa,cAAc5mC,OAAS,IAAoE,GAA/DE,EAAEuN,QAAQs4B,EAAKa,cAAcpkC,cAAeojC,IAA4D,QAApCG,EAAKa,cAAcpkC,eAClI4U,EAAS,YACTnU,EAAO8iC,EAAKa,cAAcpkC,eACmB,QAAnCujC,EAAKS,aAAahkC,eAC5B4U,EAAS,YACTnU,EAAO,QACuC,QAApC8iC,EAAKa,cAAcpkC,gBAC7B4U,EAAS,UACTnU,EAAO,QAER,IAAI8Q,GACH9Q,KAAQA,EACRmU,OAAUA,EACVtF,KAAQi0B,EAAKc,aACb90B,KAAQg0B,EAAKe,cAEU,UAApBpB,YAAY15B,MACf6H,EAAUjQ,GAAK1D,EAAE,qBAAqB6L,KAAK,eAC3CinB,EAAWpvB,GAAK1D,EAAE,qBAAqB6L,KAAK,gBAC5CgI,EAASnQ,GAAK1D,EAAE,qBAAqB6L,KAAK,cAGtCjI,SAASqM,OAAO/L,UAAU2P,EAASnQ,MAClCmiC,EAAKS,aAAaxmC,OAAS,IAAmE,GAA9DE,EAAEuN,QAAQs4B,EAAKS,aAAahkC,cAAeojC,IAA2D,QAAnCG,EAAKS,aAAahkC,eACxHuR,EAASqD,OAAStT,SAASqM,OAAO/L,UAAU2P,EAASnQ,IAAIoQ,WAAaH,EAAUjQ,GAAK,UAAY,YACjGmQ,EAAS9Q,KAAO8iC,EAAKS,aAAahkC,eACxBujC,EAAKa,cAAc5mC,OAAS,IAAoE,GAA/DE,EAAEuN,QAAQs4B,EAAKa,cAAcpkC,cAAeojC,IAA4D,QAApCG,EAAKa,cAAcpkC,eAClIuR,EAASqD,OAAStT,SAASqM,OAAO/L,UAAU2P,EAASnQ,IAAIoQ,WAAaH,EAAUjQ,GAAK,YAAc,UACnGmQ,EAAS9Q,KAAO8iC,EAAKa,cAAcpkC,eACU,QAAnCujC,EAAKS,aAAahkC,eAC5BuR,EAASqD,OAAStT,SAASqM,OAAO/L,UAAU2P,EAASnQ,IAAIoQ,WAAaH,EAAUjQ,GAAK,YAAc,UACnGmQ,EAAS9Q,KAAO,QAC8B,QAApC8iC,EAAKa,cAAcpkC,gBAC7BuR,EAASqD,OAAStT,SAASqM,OAAO/L,UAAU2P,EAASnQ,IAAIoQ,WAAaH,EAAUjQ,GAAK,UAAY,YACjGmQ,EAAS9Q,KAAO,SAIlBmY,GAAWhR,YAAeyO,SAAY9E,SAAYA,EAAU3J,YAAeyJ,EAAWmf,OAElFlvB,SAASqM,OAAO/L,UAAU2P,EAASnQ,IAErCyM,EAAKtQ,MAAMgU,SAAYjQ,SAASqM,OAAO/L,UAAU2P,EAASnQ,IAAKwG,YAAetG,SAASqM,OAAO/F,WAAWyJ,EAAUjQ,IAAKE,SAASqM,OAAO/F,WAAW4oB,EAAWpvB,OAG9JyM,EAAKtQ,KAAK+D,SAASqM,OAAO/F,WAAWyJ,EAAUjQ,MAGjDwX,GAAWhR,YAAesU,MAAS3K,SAAYA,EAAU3J,YAAeyJ,EAAWmf,WAE9E,CACN,GAAwB,UAApB0S,YAAY15B,KAWf,GAFAoP,GAAWhR,YAAeyO,QARtBhF,GACHjQ,GAAM1D,EAAE,qBAAqB6L,KAAK,eAClC+H,YAAeiyB,EAAKE,kBAAoBF,EAAKG,oBAC7Ch4B,SAAYw3B,YAAYz9B,gBACxBhF,KAAQ8iC,EAAKM,cACbhlC,KAAQ0kC,EAAKgB,cACb3yB,WAAc2xB,EAAKQ,oBAIiC,YAAjDziC,SAASqM,OAAO/F,WAAWyJ,EAAUjQ,IAAIX,KAAoB,CAE5D8Q,EAAW7T,EAAE2D,IAAIC,SAASqM,OAAO/L,UAAW,SAAS2P,GAAY,GAAIA,EAASC,WAAaH,EAAUjQ,IAAMmQ,EAASE,aAAeJ,EAAUjQ,GAAI,OAAOmQ,IAAa,GACrKif,EAAanf,EAAUjQ,IAAMmQ,EAASC,UAAYlQ,SAASqM,OAAO/F,WAAW2J,EAASE,aAAenQ,SAASqM,OAAO/F,WAAW2J,EAASC,WAC7I3D,EAAKtQ,MAAMgU,SAAYjQ,SAASqM,OAAO/L,UAAU2P,EAASnQ,IAAKwG,YAAetG,SAASqM,OAAO/F,WAAWyJ,EAAUjQ,IAAKE,SAASqM,OAAO/F,WAAW4oB,EAAWpvB,YAG9JyM,EAAKtQ,KAAK+D,SAASqM,OAAO/F,WAAWyJ,EAAUjQ,UAUhDwX,GAAWhR,YAAesU,KAPtB7K,GACHC,YAAeiyB,EAAKE,kBAAoBF,EAAKG,oBAC7Ch4B,SAAYw3B,YAAYz9B,gBACxBhF,KAAQ8iC,EAAKM,cACbhlC,KAAQ0kC,EAAKgB,cACb3yB,WAAc2xB,EAAKQ,oBAMtBrmC,EAAE,qBAAqBkX,SAAS7X,KAAK,4BAA4Bqe,OAAO,WA0BxE9Z,SAAS4O,QAAQ,UAAW0I,EAxBd,SAASrP,GAClBA,EAAKknB,WAAyC,GAA5BlnB,EAAKknB,UAAU,GAAGhsB,SACvC/G,EAAE,qBAAqB6Y,OAAO,SAE9B7Y,EAAE,SAAS6G,YAAY,YAEC,OAApB2+B,YAAY15B,OACfqE,EAAOtE,EAAKzG,SAETogC,YAAYz9B,mBAAmBnE,SAASsG,WAAWiG,KACtDvM,SAASsG,WAAWiG,KAAKq1B,YAAYz9B,iBAAiBlI,MAAMozB,OAAQuS,YAAY15B,KAAM5B,WAAYiG,IAElGvM,SAASsG,WAAWiG,KAAKq1B,YAAYz9B,mBAAqBkrB,OAAQuS,YAAY15B,KAAM5B,WAAYiG,IAGjGC,eAAe1E,QAAQ,gBAAiBnD,KAAKgD,UAAU3H,SAASsG,WAAWiG,SAIhE,WACZnQ,EAAE,mCAAmC+U,WAAW,YAChD/U,EAAE,qBAAqBkX,SAAS7X,KAAK,4BAA4Bqe,OAAO,eAM3ErE,KAAM,WACLrZ,EAAE,qBAAqB6L,KAAK,cAAe,IAC3C7L,EAAE,qBAAqB6L,KAAK,eAAgB,IAC5C7L,EAAE,qBAAqB6L,KAAK,aAAc,IAE1C7L,EAAE,2BAA2Bf,IAAI,IACjCe,EAAE,4CAA4Cf,IAAI,WAAWomC,WAAW,WAExErlC,EAAE,2CAA2Cf,IAAI,UAAUomC,WAAW,WACtErlC,EAAE,2CAA2Cf,IAAI,UAAUomC,WAAW,WAEtErlC,EAAE,2BAA2B4U,OAC7B5U,EAAE,+BAA+B6U,OAGjC7U,EAAE,sCAAsCmI,KAAKq9B,YAAY39B,cAAc1G,KAAO,SAC9EnB,EAAE,qCAAqCmI,KAAK,cAG5CnI,EAAE,qCAAqCf,IAAmC,GAA/BkE,QAAQ+G,WAAWG,UAAiB,IAAIgS,SAEnF,IAAI3Y,EAAK8hC,YAAYC,MACrB,GAAwB,UAApBD,YAAY15B,MAAoBpI,GAAME,SAASqM,OAAO/F,WAAWxG,GAAK,CACzE,IAAIiQ,EAAY/P,SAASqM,OAAO/F,WAAWxG,GAU3C,GATA1D,EAAE,qBAAqB6L,KAAK,cAAenI,GAG3C1D,EAAE,qBAAqBkX,SAAS7X,KAAK,0BAA0BwV,OAC/D7U,EAAE,qBAAqBkX,SAAS7X,KAAK,2BAA2BuV,OAGhE5U,EAAE,qBAAqB6Y,OAAO,SAAU,QAAS,kBAE3B,YAAlBlF,EAAU5Q,KAAoB,CACjC,IAAI8Q,EAAW7T,EAAE2D,IAAIC,SAASqM,OAAO/L,UAAW,SAAS2P,GAAY,GAAIA,EAASC,WAAapQ,GAAMmQ,EAASE,aAAerQ,EAAI,OAAOmQ,IAAa,GACjJG,EAAiBtQ,GAAMmQ,EAASC,UAAYlQ,SAASqM,OAAO/F,WAAW2J,EAASE,aAAenQ,SAASqM,OAAO/F,WAAW2J,EAASC,WACvI9T,EAAE,qBAAqB6L,KAAK,eAAgBmI,EAAetQ,IAC3D1D,EAAE,qBAAqB6L,KAAK,aAAcgI,EAASnQ,IAEnD,MAAMojC,EAAWnzB,EAAUC,YAAcD,EAAUC,YAAYhR,OAAO,EAAG,GAAK,MAC9E5C,EAAE,qDAAqDf,IAAI6nC,GAC3D9mC,EAAE,uDAAuDf,IAAI0U,EAAUC,YAAcD,EAAUC,YAAYhR,OAAO,EAAG,GAAK,IAC1H5C,EAAE,4CAA4Cf,IAAI0U,EAAU5Q,MAAMsiC,WAAW,WAAWn+B,QAAQ,oBAChGlH,EAAE,2CAA2Cf,IAAI0U,EAAUxS,MAC3DnB,EAAE,sCAAsCf,IAAI2E,SAASC,QAAQmQ,EAAehG,UAAYpK,SAASC,QAAQmQ,EAAehG,UAAU7M,KAAQyC,SAASqQ,YAAYD,EAAehG,UAAYpK,SAASqQ,YAAYD,EAAehG,UAAY,IAE1OhO,EAAE,sDAAsDf,IAAI+U,EAAeJ,YAAcI,EAAeJ,YAAYhR,OAAO,EAAG,GAAK,OACnI5C,EAAE,wDAAwDf,IAAI+U,EAAeJ,YAAcI,EAAeJ,YAAYhR,OAAO,EAAG,GAAK,IACrI5C,EAAE,4CAA4Cf,IAAI+U,EAAe7S,MACjEnB,EAAE,2CAA2Cf,IAAI4U,EAASjC,MAAMyzB,WAAW,WAAWn+B,QAAQ,oBAC9FlH,EAAE,2CAA2Cf,IAAI4U,EAAShC,MAAMwzB,WAAW,WAAWn+B,QAAQ,oBAE1F2M,EAASA,EAASqD,OAAO,OAASvD,EAAUjQ,GAC/C1D,EAAE,gDAAgDf,IAAI4U,EAAS9Q,MAAMsZ,SAC3DxI,EAASA,EAASqD,OAAO,OAASlD,EAAetQ,IAC3D1D,EAAE,iDAAiDf,IAAI4U,EAAS9Q,MAAMsZ,SAEvErc,EAAE,qCAAqCf,IAAI0U,EAAUO,YAAYmI,SAGlD,OAAZyqB,EAAqB9mC,EAAE,gDAAgDsU,SACnEtU,EAAE,qDAAqDsU,cAE9DtU,EAAE,qDAAqDf,IAAI0U,EAAUC,YAAcD,EAAUC,YAAYhR,OAAO,EAAG,GAAK,OACxH5C,EAAE,uDAAuDf,IAAI0U,EAAUC,YAAcD,EAAUC,YAAYhR,OAAO,EAAG,GAAK,IAC1H5C,EAAE,4CAA4Cf,IAAI0U,EAAU5Q,MAAMsiC,WAAW,WAAWn+B,QAAQ,oBAChGlH,EAAE,4CAA4Cf,IAAI0U,EAAUxS,MAC5DnB,EAAE,qCAAqCf,IAAI0U,EAAUO,YAAYmI,SAGjErc,EAAE,qDAAqDsU,cAMxDtU,EAAE,qBAAqBkX,SAAS7X,KAAK,0BAA0BuV,OAC/D5U,EAAE,qBAAqBkX,SAAS7X,KAAK,2BAA2BwV,OAGhE7U,EAAE,qBAAqB6Y,OAAO,SAAU,QAAS,iBAEjD7Y,EAAE,4CAA4Cf,IAAIkE,QAAQ+G,WAAWC,UAAY,WAAWk7B,WAAW,WAC3C,aAAxDrlC,EAAE,4CAA4Cf,QACjDe,EAAE,2BAA2B6U,OAC7B7U,EAAE,+BAA+B4U,SAIpC0E,MAAO,WACNxD,mBAAmBwD,QACnBtZ,EAAE,yBAAyB6G,YAAY,YACvC7G,EAAE,qBAAqB6L,KAAK,cAAe,IAC3C7L,EAAE,qBAAqB6L,KAAK,eAAgB,IAC5C7L,EAAE,qBAAqB6L,KAAK,aAAc","file":"app.min.js","sourcesContent":["Object.sort = function(obj, prop) {\r\n\tvar swapped, prev;\r\n\tdo {\r\n\t\tswapped = false, prev = null;\r\n\t\tfor (var i in obj) {\r\n\t\t\tif (prev && Number(obj[i][prop]) < Number(obj[prev][prop])) {\r\n\t\t\t\tvar tmp = obj[i];\r\n\t\t\t\tobj[i] = obj[prev];\r\n\t\t\t\tobj[prev] = tmp;\r\n\t\t\t\tswapped = true;\r\n\t\t\t}\r\n\t\t\tprev = i;\r\n\t\t}\r\n\t} while (swapped);\r\n}\r\n\r\nObject.index = function(obj, prop, val, cs) {\r\n\tfor (var key in obj) {\r\n\t\tif (!cs && obj[key][prop] == val) {\r\n\t\t\treturn key;\r\n\t\t} else if (obj[key][prop] && obj[key][prop].toLowerCase() == val.toLowerCase()) {\r\n\t\t\treturn key;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nObject.find = function(obj, prop, val, cs) {\r\n\tfor (var key in obj) {\r\n\t\tif (!cs && obj[key][prop] == val) {\r\n\t\t\treturn obj[key];\r\n\t\t} else if (obj[key][prop] && obj[key][prop].toLowerCase() == val.toLowerCase()) {\r\n\t\t\treturn obj[key];\r\n\t\t}\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\nObject.maxTime = function(obj, prop) {\r\n\tvar maxTimeString = \"\", maxTime;\r\n\r\n\tfor (var key in obj) {\r\n\t\tif (!maxTime || maxTime < new Date(obj[key][prop])) {\r\n\t\t\tmaxTime = new Date(obj[key][prop]);\r\n\t\t\tmaxTimeString = obj[key][prop];\r\n\t\t}\r\n\t}\r\n\treturn maxTimeString;\r\n}\r\n\r\nObject.size = function(obj) {\r\n    var size = 0, key;\r\n    for (key in obj) {\r\n        if (obj.hasOwnProperty(key)) size++;\r\n    }\r\n\r\n    return size;\r\n};\r\n\r\nObject.time = function(obj) {\r\n\tvar dates = [], key;\r\n\tfor (key in obj) {\r\n\t\tdates.push(new Date(obj[key].time));\r\n\t}\r\n\r\n\treturn dates.length ? dates.sort()[dates.length -1].getTime() /1000 : 0;\r\n};\r\n\r\n(function($){\r\n    $.fn.serializeObject = function(){\r\n\r\n        var self = this,\r\n            json = {},\r\n            push_counters = {},\r\n            patterns = {\r\n                \"validate\": /^[a-zA-Z][a-zA-Z0-9_]*(?:\\[(?:\\d*|[a-zA-Z0-9_]+)\\])*$/,\r\n                \"key\":      /[a-zA-Z0-9_]+|(?=\\[\\])/g,\r\n                \"push\":     /^$/,\r\n                \"fixed\":    /^\\d+$/,\r\n                \"named\":    /^[a-zA-Z0-9_]+$/\r\n            };\r\n\r\n\r\n        this.build = function(base, key, value){\r\n            base[key] = value;\r\n            return base;\r\n        };\r\n\r\n        this.push_counter = function(key){\r\n            if(push_counters[key] === undefined){\r\n                push_counters[key] = 0;\r\n            }\r\n            return push_counters[key]++;\r\n        };\r\n\r\n        $.each($(this).serializeArray(), function(){\r\n\r\n            // skip invalid keys\r\n            if(!patterns.validate.test(this.name)){\r\n                return;\r\n            }\r\n\r\n            var k,\r\n                keys = this.name.match(patterns.key),\r\n                merge = this.value,\r\n                reverse_key = this.name;\r\n\r\n            while((k = keys.pop()) !== undefined){\r\n\r\n                // adjust reverse_key\r\n                reverse_key = reverse_key.replace(new RegExp(\"\\\\[\" + k + \"\\\\]$\"), '');\r\n\r\n                // push\r\n                if(k.match(patterns.push)){\r\n                    merge = self.build([], self.push_counter(reverse_key), merge);\r\n                }\r\n\r\n                // fixed\r\n                else if(k.match(patterns.fixed)){\r\n                    merge = self.build([], k, merge);\r\n                }\r\n\r\n                // named\r\n                else if(k.match(patterns.named)){\r\n                    merge = self.build({}, k, merge);\r\n                }\r\n            }\r\n\r\n            json = $.extend(true, json, merge);\r\n        });\r\n\r\n        return json;\r\n    };\r\n})(jQuery);\r\n\r\nvar numFormat = function(num) {\r\n\t//Seperates the components of the number\r\n\tvar n = num.toString().split(\".\");\r\n\t//Comma-fies the first part\r\n\tn[0] = n[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\r\n\t//Combines the two sections\r\n\treturn n.join(\".\");\r\n};\r\n\r\nvar letterToNumbers = function(string) {\r\n    string = string.toUpperCase();\r\n    var letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', sum = 0, i;\r\n    for (i = 0; i < string.length; i++) {\r\n        sum += Math.pow(letters.length, i) * (letters.indexOf(string.substr(((i + 1) * -1), 1)) + 1);\r\n    }\r\n    return sum;\r\n};\r\n\r\nvar sigFormat = function(input, type) {\r\n\tif (!input) return \"\";\r\n\r\n\tvar alpha = /^[a-zA-Z]+$/;\r\n\tvar numeric = /^[0-9]+$/;\r\n\tvar format = type == \"type\" ? options.chain.typeFormat || \"\" : options.chain.classFormat || \"\";\r\n\r\n\tfor (var x = 0, l = format.length; x < l; x++) {\r\n\t\tif (format[x].match(alpha)) {\r\n\t\t\tif (format[x].toUpperCase() == \"B\" && input == \"a\") {\r\n\t\t\t\treturn \"\";\r\n\t\t\t} else {\r\n\t\t\t\tif (format[x] == format[x].toUpperCase()) {\r\n\t\t\t\t\tformat = format.substr(0, x) + input.toUpperCase() + format.substr(x + 1, l);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tformat = format.substr(0, x) + input + format.substr(x + 1, l);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (format[x].match(numeric)) {\r\n\t\t\tif (format[x] == 2 && input == \"a\") {\r\n\t\t\t\treturn \"\";\r\n\t\t\t} else {\r\n\t\t\t\tformat = format.substr(0, x) + letterToNumbers(input) + format.substr(x +1, l);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn format;\r\n};\r\n\r\nvar sigClass = function(name, type) {\r\n\tvar id = $.map(tripwire.systems, function(system, id) { return system.name == name ? id : null })[0];\r\n\tvar system = {\r\n\t\t\"name\": name,\r\n\t\t\"class\": id ? tripwire.systems[id].class : null,\r\n\t\t\"security\":  id ? tripwire.systems[id].security : null,\r\n\t\t\"type\": type};\r\n\tvar systemType = null;\r\n\r\n\tif (system.class == 6 || system.name == \"Class-6\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 6\"))\r\n\t\tsystemType = \"C6\";\r\n\telse if (system.class == 5 || system.name == \"Class-5\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 5\"))\r\n\t\tsystemType = \"C5\";\r\n\telse if (system.class == 4 || system.name == \"Class-4\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 4\"))\r\n\t\tsystemType = \"C4\";\r\n\telse if (system.class == 3 || system.name == \"Class-3\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 3\"))\r\n\t\tsystemType = \"C3\";\r\n\telse if (system.class == 2 || system.name == \"Class-2\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 2\"))\r\n\t\tsystemType = \"C2\";\r\n\telse if (system.class == 1 || system.name == \"Class-1\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 1\"))\r\n\t\tsystemType = \"C1\";\r\n\telse if (system.security >= 0.45 || system.name == \"High-Sec\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"High-Sec\" && !system.security))\r\n\t\tsystemType = \"HS\";\r\n\telse if (system.security > 0.0 || system.name == \"Low-Sec\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Low-Sec\" && !system.security))\r\n\t\tsystemType = \"LS\";\r\n\telse if ((system.security <= 0.0 && system.security != null) || system.name == \"Null-Sec\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Null-Sec\"))\r\n\t\tsystemType = \"NS\";\r\n\r\n\treturn systemType;\r\n};\r\n\r\nvar isEmpty = function(obj) {\r\n    for(var key in obj) {\r\n        if(obj.hasOwnProperty(key))\r\n            return false;\r\n    }\r\n    return true;\r\n};\r\n\r\n/** Find the relative position of one element within the hierarchy tree of another */\r\nfunction positionRelativeTo(elem, ancestor) {\r\n\tconst elemPos = elem.getBoundingClientRect(),\r\n\t\tancestorPos = ancestor.getBoundingClientRect();\r\n\treturn { \r\n\t\tleft: elemPos.left - ancestorPos.left + ancestor.scrollLeft,\r\n\t\ttop: elemPos.top - ancestorPos.top + ancestor.scrollTop\r\n\t};\r\n}\r\n\r\n/** Look up one or more values in a comma separated string as keys in a data map, and return a property from the results in a new comma separated string.\r\nConvenience function for UI mapping.\r\nWill throw a failure message, unless suppress=true in which case it will return undefined, if \r\nany of the lookups fail to resolve. */\r\nfunction lookupMultiple(map, propertyName, lookupString, suppress) {\r\n\tconst values = lookupString.split(',');\r\n\tconst results = [];\r\n\tfor(var i = 0; i < values.length; i++) {\r\n\t\tconst v = values[i];\r\n\t\tconst r = map[v];\r\n\t\tif(!r) { \r\n\t\t\tif(suppress) { return undefined;}\r\n\t\t\telse { throw 'Value ' + v + ' did not match anything in ' + map; }\r\n\t\t}\r\n\t\tresults.push(r[propertyName]);\r\n\t}\r\n\treturn results.join(',');\r\n}\r\n\r\n/** Look up one or more values in a comma separated string as property values in a data map, and return the key from the results in a new comma separated string.\r\nConvenience function for UI mapping.\r\nWill throw a failure message, unless suppress=true in which case it will return undefined, if \r\nany of the lookups fail to resolve. */\r\nfunction lookupByPropertyMultiple(map, propertyName, lookupString, suppress) {\r\n\tconst values = lookupString.split(',');\r\n\tconst results = [];\r\n\tfor(var i = 0; i < values.length; i++) {\r\n\t\tconst v = values[i];\r\n\t\tconst r = Object.index(map, propertyName, v);\r\n\t\tif(!r) { \r\n\t\t\tif(suppress) { return undefined;}\r\n\t\t\telse { throw 'Value ' + v + ' did not match anything by property ' + propertyName + ' in ' + map; }\r\n\t\t}\r\n\t\tresults.push(r);\r\n\t}\r\n\treturn results.join(',');\r\n}\r\n\r\nvar getCookie = function(c_name) {\r\n\tvar c_value = document.cookie;\r\n\r\n\tvar c_start = c_value.indexOf(\" \" + c_name + \"=\");\r\n\tif (c_start == -1) {\r\n\t\tc_start = c_value.indexOf(c_name + \"=\");\r\n\t}\r\n\r\n\tif (c_start == -1) {\r\n\t\tc_value = null;\r\n\t} else {\r\n\t\tc_start = c_value.indexOf(\"=\", c_start) + 1;\r\n\t\tvar c_end = c_value.indexOf(\";\", c_start);\r\n\r\n\t\tif (c_end == -1) {\r\n\t\t\tc_end = c_value.length;\r\n\t\t}\r\n\r\n\t\tc_value = unescape(c_value.substring(c_start, c_end));\r\n\t}\r\n\r\n\treturn c_value;\r\n};\r\n\r\nvar setCookie = function(c_name, value, exdays) {\r\n\tvar exdate = new Date();\r\n\texdate.setDate(exdate.getDate() + exdays);\r\n\tvar c_value = escape(value) + ((exdays == null) ? \"\" : \"; expires=\"+exdate.toUTCString());\r\n\r\n\tdocument.cookie = c_name + \"=\" + c_value + \";\" + (document.location.protocol == \"https:\" ? \"secure;\" : \"\");\r\n};\r\n\r\n// Global CSS class change event\r\n(function($) {\r\n    var originalAddClassMethod = $.fn.addClass;\r\n\tvar originalRemoveClassMethod = $.fn.removeClass;\r\n\r\n    $.fn.addClass = function(className) {\r\n        // Execute the original method.\r\n        var result = originalAddClassMethod.apply(this, arguments);\r\n\r\n        // trigger a custom event\r\n        this.trigger('classchange', className);\r\n\r\n        // return the original result\r\n        return result;\r\n    }\r\n\r\n\t$.fn.removeClass = function(className) {\r\n        // Execute the original method.\r\n        var result = originalRemoveClassMethod.apply(this, arguments);\r\n\r\n        // trigger a custom event\r\n        this.trigger('classchange', className);\r\n\r\n        // return the original result\r\n        return result;\r\n    }\r\n})(jQuery);\r\n\r\nvar parseHeaders = function(headers) {\r\n\t\t// Convert the header string into an array\r\n\t\t// of individual headers\r\n\t\tvar arr = headers.trim().split(/[\\r\\n]+/);\r\n\r\n\t\t// Create a map of header names to values\r\n\t\tvar headerMap = {};\r\n\t\tarr.forEach(function (line) {\r\n\t\t\t\tvar parts = line.split(': ');\r\n\t\t\t\tvar header = parts.shift();\r\n\t\t\t\tvar value = parts.join(': ');\r\n\t\t\t\theaderMap[header] = value;\r\n\t\t});\r\n\t\treturn headerMap;\r\n}\r\n","var viewingSystem = $(\"meta[name=system]\").attr(\"content\");\r\nvar viewingSystemID = $(\"meta[name=systemID]\").attr(\"content\");\r\nvar server = $(\"meta[name=server]\").attr(\"content\");\r\nvar app_name = $(\"meta[name=app_name]\").attr(\"content\");\r\nvar version = $(\"meta[name=version]\").attr(\"content\");\r\n\r\n// Page cache indicator\r\nif (getCookie(\"loadedFromBrowserCache\") == \"true\") {\r\n\t$(\"#pageTime\").html(\"Page is Cached\");\r\n}\r\n\r\n// setCookie('loadedFromBrowserCache', true);\r\n\r\n// Use this to test performance of javascript code lines\r\n// var startTime = window.performance.now();\r\n// console.log(\"stint: \"+ (window.performance.now() - startTime));\r\n","var options = new function() {\r\n\tvar localOverrides = [\"grid\"];\r\n\tvar localOptions = JSON.parse(localStorage.getItem(\"tripwire_options\"));\r\n\tvar saveTimer;\r\n\r\n\tthis.userID = init.userID;\r\n\tthis.character = {id: init.characterID, name: init.characterName};\r\n\tthis.background = null;\r\n\tthis.uiscale = 1.0;\r\n\tthis.favorites = [];\r\n\tthis.grid = {};\r\n\tthis.tracking = {active: \"new\"};\r\n\tthis.masks = {active: init.corporationID + \".2\"};\r\n\tthis.chain = {typeFormat: null, classFormat: null, gridlines: true, active: 0, tabs: [], \"node-reference\": \"type\", zoom: 1.0, sigNameLocation: 'name', routingLimit: 15, routeSecurity: 'shortest', routeIgnore: { enabled: false, systems: [ 'Tama', 'Rancer' ] }, renderer: 'orgChart' };\r\n\tthis.signatures = {editType: \"unknown\", copySeparator: \",\", pasteLife: 72, alignment: {sigID: \"centerAlign\", sigType: \"centerAlign\", sigAge: \"centerAlign\", leadsTo: \"centerAlign\", sigLife: \"centerAlign\", sigMass: \"centerAlign\"}};\r\n\tthis.buttons = {follow: false, chainWidget: {viewing: false, favorites: false}, signaturesWidget: {autoMapper: false}};\r\n\r\n\tthis.saveDelay = function(delay) {\r\n\t\tif (saveTimer) clearTimeout(saveTimer);\r\n\r\n\t\tsaveTimer = setTimeout(\"options.save()\", delay);\r\n\t};\r\n\r\n\t// Saves options in both cookie and database\r\n\tthis.save = function() {\r\n\t\tvar options = JSON.stringify(window.options.get());\r\n\r\n\t\tlocalStorage.setItem(\"tripwire_options\", options);\r\n\r\n\t\treturn $.ajax({\r\n\t\t\turl: \"options.php\",\r\n\t\t\tdata: {mode: \"set\", options: options},\r\n\t\t\ttype: \"POST\",\r\n\t\t\tdataType: \"JSON\"\r\n\t\t});\r\n\t};\r\n\r\n\t// Loads options via passed object else cookie\r\n\tthis.load = function(data) {\r\n\t\tif (data && typeof(data) != \"undefined\") {\r\n\t\t\tthis.set(this, data);\r\n\t\t} else if (localOptions) {\r\n\t\t\tthis.set(this, localOptions);\r\n\t\t}\r\n\r\n\t\tthis.apply();\r\n\t};\r\n\r\n\t// Gets options from this by exluding types == function\r\n\tthis.get = function() {\r\n\t\tvar data = {};\r\n\r\n\t\tfor (var x in this) {\r\n\t\t\tif (typeof(this[x]) != \"function\") {\r\n\t\t\t\tdata[x] = this[x];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t};\r\n\r\n\t// Sets this from passed object\r\n\tthis.set = function(local, data) {\r\n\t\tfor (var prop in data) {\r\n\t\t\tif (data[prop] && data[prop].constructor && data[prop].constructor === Object) {\r\n\t\t\t\tif (local) {\r\n\t\t\t\t\tthis.set(local[prop], data[prop]);\r\n\t\t\t\t}\r\n\t\t\t} else if (local && typeof(local[prop]) != \"undefined\") {\r\n\t\t\t\tlocal[prop] = data[prop];\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis.reset = function() {\r\n\t\tfor (var x in this) {\r\n\t\t\tif (typeof(this[x]) != \"function\") {\r\n\t\t\t\tthis[x] = JSON.parse(JSON.stringify(this.reset.defaults[x]));\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// Applies settings\r\n\tthis.apply = function() {\r\n\t\t// Local browser overrides\r\n\t\tif (localOptions) {\r\n            for (key in localOverrides) {\r\n                this[localOverrides[key]] = localOptions[localOverrides[key]];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Grid layout (detect old IGB setting options)\r\n\t\tif (this.grid.hasOwnProperty(\"oog\") && !isEmpty(this.grid.oog)) {\r\n\t\t\t$.each(this.grid.oog, function() {\r\n\t\t\t\t$(\"#\"+this.id).attr({\"data-col\": this.col, \"data-row\": this.row, \"data-sizex\": this.size_x, \"data-sizey\": this.size_y})\r\n\t\t\t\t\t.css({width: this.width, height: this.height});\r\n\t\t\t});\r\n\t\t} else if (!isEmpty(this.grid)) {\r\n\t\t\t$.each(this.grid, function() {\r\n\t\t\t\t$(\"#\"+this.id).attr({\"data-col\": this.col, \"data-row\": this.row, \"data-sizex\": this.size_x, \"data-sizey\": this.size_y})\r\n\t\t\t\t\t.css({width: this.width, height: this.height});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Make sure favorites are all ints and not strings\r\n\t\tthis.favorites = $.map(this.favorites, function(favorite) {\r\n\t\t\treturn parseInt(favorite);\r\n\t\t});\r\n\r\n\t\t// Buttons\r\n\t\tif (this.buttons.follow) $(\"#follow\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.home) $(\"#home\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.kspace) $(\"#k-space\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.viewing) $(\"#show-viewing\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.favorites) $(\"#show-favorite\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.evescout) $(\"#eve-scout\").addClass(\"active\");\r\n\t\tif ($.inArray(parseInt(viewingSystemID), this.favorites) !== -1) $(\"#system-favorite\").attr(\"data-icon\", \"star\").addClass(\"active\");\r\n\t\tif (this.buttons.signaturesWidget.autoMapper) $(\"#toggle-automapper\").addClass(\"active\");\r\n\r\n\t\t// UI Scale\r\n\t\tif (this.uiscale) {\r\n\t\t\t$(\"body\").css(\"zoom\", this.uiscale);\r\n\t\t}\r\n\r\n\t\t// Chain zoom\r\n\t\tif (this.chain.zoom) {\r\n\t\t\t$(\"#chainParent\").css(\"zoom\", this.chain.zoom);\r\n\t\t}\r\n\r\n\t\t// Background\r\n\t\tif (this.background) {\r\n\t\t\tvar a = $('<a>', { href:this.background } )[0];\r\n\t\t\t$(\"#wrapper\").attr(\"style\", \"background-image: url(https://\" + a.hostname + a.pathname + a.search + \");\");\r\n\t\t} else {\r\n\t\t\t$(\"#wrapper\").attr(\"style\", \"\");\r\n\t\t}\r\n\r\n\t\t// Characters in Options\r\n\t\t$(\"#dialog-options #characters\").html(\"<img src='https://image.eveonline.com/Character/\"+init.characterID+\"_64.jpg' />\");\r\n\r\n\t\t// Active mask\r\n\t\t$(\"#dialog-options input[name='mask']\").filter(\"[value='\"+this.masks.active+\"']\").attr(\"checked\", true);\r\n\r\n\t\t// Chain tabs\r\n\t\t$(\"#chainTabs\").html(\"\");\r\n\t\tfor (var x in this.chain.tabs) {\r\n\t\t\tif (this.chain.tabs[x]) {\r\n\t\t\t\tvar $tab = $(\"#chainTab .tab\").clone();\r\n\r\n\t\t\t\t$tab.attr(\"id\", x).find(\".name\").data(\"tab\", this.chain.tabs[x].systemID).html(this.chain.tabs[x].name);\r\n\t\t\t\tif (x == this.chain.active) { $tab.addClass(\"current\"); }\r\n\r\n\t\t\t\t$(\"#chainTabs\").append($tab);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Draw chain if Tripwire is initialized\r\n\t\tif (typeof(tripwire) !== \"undefined\") {\r\n\t\t\tchain.redraw();\r\n\t\t}\r\n\t};\r\n\r\n\tthis.reset.defaults = JSON.parse(JSON.stringify(this.get()));\r\n\tthis.load(init && init.options ? init.options : null);\r\n}\r\n","var grid = $(\".gridster ul\").gridster({\r\n\twidget_selector: \"li.gridWidget\",\r\n\tavoid_overlapped_widgets: false,\r\n\twidget_base_dimensions: [50, 50],\r\n\twidget_margins: [5, 5],\r\n\tautogrow_cols: true,\r\n\thelper: \"clone\",\r\n\tdraggable: {\r\n\t\tstart: function(e, ui) {\r\n\t\t\t$(\"div.gridster\").width($(\"div.gridster ul\").width());\r\n\t\t}\r\n\t},\r\n\tresize: {\r\n    \tenabled: true,\r\n    \thandle_class: \"grid-resize\",\r\n    \tmax_size: [30, 30],\r\n    \tmin_size: [4, 4],\r\n    \tstart: function(e) {\r\n    \t\t$(\"div.gridster\").width($(\"div.gridster ul\").width());\r\n    \t},\r\n    \tstop: function(e, ui, $widget) {\r\n    \t\t//var width = parseInt($(\".gridster\").css(\"margin-left\")) + this.container_width;\r\n    \t\t//$(\"#wrapper\").css({width: width + \"px\"})\r\n    \t\tswitch ($widget.attr(\"id\")) {\r\n    \t\t\tcase \"infoWidget\":\r\n    \t\t\t\tsetTimeout(\"activity.redraw();\", 300);\r\n    \t\t\t\tbreak;\r\n    \t\t}\r\n    \t}\r\n\t},\r\n\tserialize_params: function($w, wgd) {\r\n\t\treturn {\r\n\t\t\tid: $w.attr(\"id\"),\r\n\t\t\tcol: wgd.col,\r\n\t\t\trow: wgd.row,\r\n\t\t\tsize_x: wgd.size_x,\r\n\t\t\tsize_y: wgd.size_y,\r\n\t\t\twidth: $w.width(),\r\n\t\t\theight: $w.height()\r\n\t\t}\r\n\t}\r\n}).data(\"gridster\").disable();\r\n\r\ngrid.disable_resize();\r\n$(\".grid-resize\").addClass(\"hidden\").attr(\"data-icon\", \"resize\");\r\n\r\n$(\".gridster\").css({visibility: \"visible\"});\r\n$(\".gridster > *\").addClass(\"gridster-transition\");\r\n\r\n$(\"#layout\").click(function() {\r\n\tif (!$(this).hasClass(\"active\")) {\r\n\t\tgrid.enable();\r\n\t\tgrid.enable_resize();\r\n\t\t$(\".grid-resize\").removeClass(\"hidden\");\r\n\r\n\t\t$(this).addClass(\"active\");\r\n\t} else {\r\n\t\tgrid.disable();\r\n\t\tgrid.disable_resize();\r\n\t\t$(\".grid-resize\").addClass(\"hidden\");\r\n\r\n\t\t$(this).removeClass(\"active\");\r\n\r\n\t\toptions.grid = grid.serialize();\r\n\r\n\t\toptions.save();\r\n\t}\r\n});\r\n","var tripwire = new function() {\r\n    this.timer, this.xhr;\r\n\tthis.version = version;\r\n\tthis.client = {signatures: {}, wormholes: {}};\r\n\tthis.server = {signatures: {}, wormholes: {}};\r\n\tthis.signatures = {list: {}, undo: JSON.parse(sessionStorage.getItem(\"tripwire_undo\")) || {}, redo: JSON.parse(sessionStorage.getItem(\"tripwire_redo\")) || {}};\r\n\tthis.serverSignatureCount = 0;\r\n\tthis.activity = {};\r\n\tthis.data = {tracking: {}, esi: {}};\r\n\tthis.refreshRate = 5000;\r\n\tthis.connected = true;\r\n\tthis.ageFormat = \"HM\";\r\n\tthis.instance = window.name ? window.name : (new Date().getTime() / 1000, window.name = new Date().getTime() / 1000);\r\n\r\n    // Command to start/stop tripwire updates\r\n\t// ToDo: Include API and Server timers\r\n\tthis.stop = function() {\r\n\t\tclearTimeout(this.timer);\r\n\t\treturn this.timer;\r\n\t};\r\n\r\n\tthis.start = function() {\r\n\t\treturn this.sync();\r\n\t}\r\n\r\n    // Command to change Age format\r\n\t// ToDo: Cookie change to keep\r\n\tthis.setAgeFormat = function(format) {\r\n\t\tvar format = typeof(format) !== 'undefined' ? format : this.ageFormat;\r\n\r\n\t\t$(\"span[data-age]\").each(function() {\r\n\t\t\t$(this).countdown(\"option\", {format: format});\r\n\t\t});\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n    this.serverTime = function() {\r\n\t\tthis.time;\r\n\r\n\t\tthis.serverTime.getTime = function() {\r\n\t\t\treturn tripwire.serverTime.time;\r\n\t\t}\r\n\t}\r\n    this.serverTime();\r\n\r\n    // Handles putting chain together\r\n\tthis.chainMap = function() {\r\n\t\tthis.chainMap.parse = function(data) {\r\n\t\t\tchain.draw(data);\r\n\t\t}\r\n\t}\r\n    this.chainMap();\r\n\r\n    this.pastEOL = function() {\r\n\t\tvar options = {since: $(this).countdown('option', 'until'), format: \"HM\", layout: \"-{hnn}{sep}{mnn}&nbsp;\"};\r\n\t\t$(this).countdown(\"option\", options);\r\n\t}\r\n\r\n    // Handles WH Type hover-over tooltip\r\n\t// ToDo: Use native JS\r\n\tthis.whTooltip = function(sig) {\r\n\t\tif (viewingSystemID == sig.systemID) {\r\n\t\t\tif ($.inArray(sig.type, $.map(tripwire.wormholes, function(item, index) { return index;})) >= 0) {\r\n\t\t\t\tvar type = sig.type;\r\n\t\t\t\tvar tooltip = '';\r\n\t\t\t} else {\r\n\t\t\t\tvar type = sig.sig2Type;\r\n\t\t\t\tvar tooltip = \"<b>Type:</b> \"+type+\"<br/>\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif ($.inArray(sig.sig2Type, $.map(tripwire.wormholes, function(item, index) { return index;})) >= 0) {\r\n\t\t\t\tvar type = sig.sig2Type;\r\n\t\t\t\tvar tooltip = '';\r\n\t\t\t} else {\r\n\t\t\t\tvar type = sig.type;\r\n\t\t\t\tvar tooltip = \"<b>Type:</b> \"+type+\"<br/>\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($.inArray(type, $.map(tripwire.wormholes, function(item, index) { return index;})) >= 0) {\r\n\t\t\tvar whType = true;\r\n\t\t} else {\r\n\t\t\tvar whType = false;\r\n\t\t}\r\n\r\n\t\ttooltip += \"<b>Life:</b> \"+(whType?tripwire.wormholes[type].life:\"Unknown\")+\"<br/>\";\r\n\r\n\t\tif (whType) {\r\n\t\t\tswitch (tripwire.wormholes[type].leadsTo.split(\" \")[0]) {\r\n\t\t\t\tcase 'High-Sec':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='hisec'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Low-Sec':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='lowsec'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Null-Sec':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='nullsec'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Class':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='wh'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\ttooltip += \"<b>Leads To:</b> <span>Unknown</span><br/>\";\r\n\t\t}\r\n\r\n\t\ttooltip += \"<b>Max Mass</b>: \"+(whType?numFormat(tripwire.wormholes[type].mass):\"Unknown\")+\" Kg<br/>\";\r\n\r\n\t\ttooltip += \"<b>Max Jumpable</b>: \"+(whType?numFormat(tripwire.wormholes[type].jump):\"Unknown\")+\" Kg<br/>\";\r\n\r\n\t\treturn tooltip;\r\n\t}\r\n\r\n\t// Handles Age hover-over tooltip\r\n\t// ToDo: Use native JS\r\n\tthis.ageTooltip = function(sig) {\r\n\t\t// var date = new Date(sig.lifeTime);\r\n\t\t// var localOffset = date.getTimezoneOffset() * 60000;\r\n\t\t// date = new Date(date.getTime() + localOffset);\r\n        var date = new Date(sig.lifeTime);\r\n\r\n\t\tvar tooltip = \"<table class=\\\"age-tooltip-table\\\"><tr>\"\r\n        + \"<th>Created:</th><td>\"+(date.getMonth()+1)+\"/\"+date.getDate()+\" \"+(date.getHours() < 10?'0':'')+date.getHours()+\":\"+(date.getMinutes() < 10?'0':'')+date.getMinutes()+\"</td>\"\r\n        + \"<td>\"+sig.createdByName.replace(/'/g, '&#39;').replace(/\"/g, '&#34;')+\"</td>\"\r\n        + \"</tr>\";\r\n\r\n\t\tif (sig.lifeTime != sig.modifiedTime) {\r\n\t\t\tdate = new Date(sig.modifiedTime);\r\n\t\t\t// localOffset = date.getTimezoneOffset() * 60000;\r\n\t\t\t// date = new Date(date.getTime() + localOffset);\r\n      \r\n\t\t\ttooltip += \"<tr><th>Last Modified:</th><td>\"+(date.getMonth()+1)+\"/\"+date.getDate()+\" \"+(date.getHours() < 10?'0':'')+date.getHours()+\":\"+(date.getMinutes() < 10?'0':'')+date.getMinutes()+\"</td>\"\r\n          + \"<td>\"+sig.modifiedByName.replace(/'/g, '&#39;').replace(/\"/g, '&#34;')+\"</td>\"\r\n          + \"</tr>\";\r\n\t\t}\r\n\r\n\t\ttooltip += \"</table>\";\r\n\r\n\t\treturn tooltip;\r\n\t}\r\n\r\n    this.refresh = function(mode, data, successCallback, alwaysCallback) {\r\n\t\tvar mode = mode || 'refresh';\r\n\r\n\t\tthis.sync(mode, data, successCallback, alwaysCallback);\r\n\t}\r\n}\r\n","$(\"body\").on(\"click\", \"a[href^='.?system=']\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tvar system = $(this).attr(\"href\").replace(\".?system=\", \"\");\r\n\tvar systemID = Object.index(tripwire.systems, \"name\", system);\r\n\r\n\ttripwire.systemChange(systemID);\r\n});\r\n\r\n$(\"body\").on(\"submit\", \"#systemSearch\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tvar system = $(this).find(\"[name='system']\").val();\r\n\tvar systemID = Object.index(tripwire.systems, \"name\", system, true) || false;\r\n\r\n\tif (systemID !== false) {\r\n\t\ttripwire.systemChange(systemID);\r\n\t\t$(this).find(\"[name='system']\").val(\"\");\r\n\t\t$(\"#search\").click();\r\n\t}\r\n});\r\n\r\n$(\"body\").on(\"click\", \"#undo:not(.disabled)\", function() {\r\n\ttripwire.undo();\r\n});\r\n\r\n$(\"body\").on(\"click\", \"#redo:not(.disabled)\", function() {\r\n\ttripwire.redo();\r\n});\r\n\r\n// Chain map zooming (Gets funky if you push things too far)\r\n$(\"#chainParent\").on(\"mousewheel\", function(e) {\r\n\te.preventDefault();\r\n\tvar zoom = parseFloat($(\"#chainParent\").css(\"zoom\")) || 1.0;\r\n\tvar min = 0.6;\r\n\tvar max = 2.0;\r\n\r\n    if (e.originalEvent.wheelDelta / 120 > 0 && zoom < max) {\r\n\t\t$(\"#chainParent\").css(\"zoom\", zoom + 0.1);\r\n    } else if (e.originalEvent.wheelDelta / 120 < 0 && zoom > min) {\r\n\t\t$(\"#chainParent\").css(\"zoom\", zoom - 0.1);\r\n    }\r\n\r\n\t// Show the reset zoom button for awhile\r\n\t$(\"#chain-zoom-reset\").fadeIn(200);\r\n\tif (this.timeout) clearTimeout(this.timeout);\r\n\tthis.timeout = setTimeout('$(\"#chain-zoom-reset\").fadeOut(200);', 3000);\r\n\r\n\t// Save options\r\n\toptions.chain.zoom = parseFloat($(\"#chainParent\").css(\"zoom\"));\r\n\toptions.saveDelay(2000);\r\n});\r\n\r\n$(\"#chain-zoom-reset\").on(\"click\", function() {\r\n\t$(\"#chainParent\").css(\"zoom\", 1);\r\n\toptions.chain.zoom = 1;\r\n\toptions.saveDelay(2000);\r\n});\r\n\r\n$(document).keydown(function(e)\t{\r\n\t//Abort - user is in input or textarea\r\n\tif ($(document.activeElement).is(\"textarea, input\")) return;\r\n\r\n\t// Ctrl key hooks\r\n\tif (e.metaKey || e.ctrlKey) {\r\n\r\n\t\tif (e.keyCode === 89 && !$(\"#redo\").hasClass(\"disabled\")) {\r\n\t\t\t// Ctrl-y redo hook\r\n\t\t\te.preventDefault();\r\n\t\t\t$(\"#redo\").click();\r\n\t\t\tNotify.trigger(\"Redoing last undo\");\r\n\t\t} else if (e.keyCode === 90 && !$(\"#undo\").hasClass(\"disabled\")) {\r\n\t\t\t// Ctrl-z undo hook\r\n\t\t\te.preventDefault();\r\n\t\t\t$(\"#undo\").click();\r\n\t\t\tNotify.trigger(\"Undoing last action\");\r\n\t\t} else if (e.keyCode === 65) {\r\n\t\t\t// Ctrl-a select all (signatures) hook\r\n\t\t\te.preventDefault();\r\n\t\t\t$(\"#sigTable tbody tr\").addClass(\"selected\");\r\n\t\t\t$(\"#signaturesWidget #delete-signature\").trigger(\"delete:refresh\");\r\n\t\t} else if (e.keyCode === 67) {\r\n\t\t\t// Ctrl-c copy selected signatures hook\r\n\t\t\tif (window.getSelection().toString() === \"\") {\r\n\t\t\t\tvar output = \"\";\r\n\t\t\t\t$(\"#sigTable tbody tr.selected\").each(function(row) {\r\n\t\t\t\t\tvar signature = tripwire.client.signatures[$(this).data(\"id\")];\r\n\t\t\t\t\tvar row = [];\r\n\r\n\t\t\t\t\tif (signature.signatureID) {\r\n\t\t\t\t\t\trow.push(signature.signatureID.substring(0, 3).toUpperCase() + \"-\" + (signature.signatureID.substring(3, 6) || \"###\"));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trow.push(\"null\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trow.push(signature.type);\r\n\t\t\t\t\tif (signature.type === \"wormhole\") {\r\n\t\t\t\t\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n\t\t\t\t\t\tvar otherSignature = signature.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t\t\trow.push(wormhole.type || \"null\" );\r\n\t\t\t\t\t\trow.push(tripwire.systems[signature.systemID] ? tripwire.systems[signature.systemID].name : tripwire.aSigSystems[signature.systemID]);\r\n\t\t\t\t\t\trow.push(tripwire.systems[otherSignature.systemID] ? tripwire.systems[otherSignature.systemID].name : tripwire.aSigSystems[otherSignature.systemID]);\r\n\t\t\t\t\t\trow.push(wormhole.life);\r\n\t\t\t\t\t\trow.push(wormhole.mass);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trow.push(signature.name);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trow.push(signature.createdByName);\r\n\t\t\t\t\trow.push(signature.lifeTime);\r\n\t\t\t\t\trow.push(signature.lifeLength);\r\n\t\t\t\t\trow.push(signature.lifeLeft);\r\n\t\t\t\t\trow.push(signature.modifiedByName);\r\n\t\t\t\t\trow.push(signature.modifiedTime);\r\n\t\t\t\t\toutput += row.join(options.signatures.copySeparator) + \"\\r\\n\";\r\n\t\t\t\t});\r\n\t\t\t\t$(\"#clipboard\").text(output);\r\n\t\t\t\t$(\"#clipboard\").focus();\r\n\t\t\t\t$(\"#clipboard\").select();\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\t// delete key keyhooks\r\n\t\tif (e.keyCode == 46 && $(\"#sigTable tr.selected\").length > 0) {\r\n\t\t\t$(\"#delete-signature\").click();\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// $(\"#APIclock\").knob({angleArc: 359.9, height: 20, width: 20, max: 60, readOnly: true, displayInput: false, fgColor: \"#CCC\", bgColor: \"#666\"});\r\n\r\n$(\"#follow\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\toptions.buttons.follow = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n})\r\n\r\n$(\"#show-viewing\").click(function() {\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\tchain.redraw();\r\n\r\n\toptions.buttons.chainWidget.viewing = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n});\r\n\r\n$(\"#show-favorite\").click(function() {\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\tchain.redraw();\r\n\r\n\toptions.buttons.chainWidget.favorites = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n});\r\n\r\n$(\"#system-favorite\").click(function() {\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\").attr(\"data-icon\", \"star-empty\");\r\n\r\n\t\toptions.favorites.splice(options.favorites.indexOf(parseInt(viewingSystemID)), 1);\r\n\t} else {\r\n\t\t$(this).attr(\"data-icon\", \"star\").addClass(\"active\");\r\n\r\n\t\toptions.favorites.push(parseInt(viewingSystemID));\r\n\t}\r\n\r\n\tif ($(\"#show-favorite\").hasClass(\"active\"))\r\n\t\tchain.redraw();\r\n\r\n\toptions.save();\r\n});\r\n\r\n$(\"#search\").click(function(e) {\r\n\t$(\"#searchSpan\").toggle();\r\n\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\");\r\n\t\tif (tripwire.client.EVE && tripwire.client.EVE.systemName)\r\n\t\t\t$(\"#currentSpan\").show();\r\n\t} else {\r\n\t\t$(this).addClass(\"active\");\r\n\t\t$(\"#currentSpan\").hide();\r\n\r\n\t\t$(\"#searchSpan input[name=system]\").focus().select();\r\n\t}\r\n});\r\n\r\n$(\"#toggle-automapper\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\");\r\n\t} else {\r\n\t\t$(this).addClass(\"active\");\r\n\t}\r\n\r\n\toptions.buttons.signaturesWidget.autoMapper = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n});\r\n\r\n$(\"#track\").on(\"click\", \".tracking-clone\", function() {\r\n\tvar characterID =$(this).attr(\"data-characterid\");\r\n\t$(\"#tracking .tracking-clone\").removeClass(\"active\");\r\n\r\n\tif (options.tracking.active == characterID) {\r\n\t\toptions.tracking.active = null;\r\n\t\ttripwire.EVE(false, true);\r\n\t\t$(\"#removeESI\").attr(\"disabled\", \"disabled\");\r\n\t} else {\r\n\t\toptions.tracking.active = characterID;\r\n\r\n\t\tif (tripwire.esi.characters[options.tracking.active]) {\r\n\t\t\t$(\"#tracking .tracking-clone[data-characterid='\"+ options.tracking.active +\"']\").addClass(\"active\");\r\n\t\t\ttripwire.EVE(tripwire.esi.characters[options.tracking.active], true);\r\n\t\t}\r\n\r\n\t\t$(\"#removeESI\").removeAttr(\"disabled\");\r\n\t}\r\n\r\n\toptions.save();\r\n});\r\n\r\n$(\"#login\").on(\"click\", \"#removeESI\", function() {\r\n\tvar characterID = options.tracking.active;\r\n\r\n\toptions.tracking.active = null;\r\n\ttripwire.EVE(false, true);\r\n\toptions.save();\r\n\r\n\t$(\"#tracking .tracking-clone[data-characterid='\"+ characterID +\"']\").remove();\r\n\r\n\t$(\"#removeESI\").attr(\"disabled\", \"disabled\");\r\n\r\n\tif ($.isArray(tripwire.data.esi.delete)) {\r\n\t\ttripwire.data.esiDelete.push(characterID);\r\n\t} else {\r\n\t\ttripwire.data.esiDelete = [characterID];\r\n\t}\r\n});\r\n\r\n$(\"#user\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\");\r\n\r\n\t\t$(\"#login > #panel\").css({display: \"none\"});\r\n\r\n\t\t//$(\"#wrapper\").unbind(\"click\");\r\n\t} else {\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\t\t$(\"#login > #panel\").css({display: \"inline\"});\r\n\t\t$(\"#loginForm input[name=username]\").focus().select();\r\n\r\n\t\t// Click outside closes\r\n\t\t$(\"#wrapper\").click(function(e) {\r\n\t\t\t$(\"#login > #panel\").css({display: \"none\"});\r\n\t\t\t$(\"#user\").removeClass(\"active\");\r\n\t\t});\r\n\r\n\t\t$(\"#login\").click(function(e) {\r\n\t\t\te.stopPropagation();\r\n\t\t})\r\n\t}\r\n});\r\n\r\n$(\"#logout\").click(function() {\r\n\twindow.location = \"logout.php\";\r\n});\r\n\r\nvar Notify = new function() {\r\n\tthis.trigger = function(content, color, stick, id) {\r\n\t\tvar color = typeof(color) !== \"undefined\" ? color : \"blue\";\r\n\t\tvar stick = typeof(stick) !== \"undefined\" ? stick : 10000;\r\n\t\tvar id = typeof(id) !== \"undefined\" ? id : null;\r\n\r\n\t\tnew jBox(\"Notice\", {\r\n\t\t\tid: id,\r\n\t\t\tcontent: content,\r\n\t\t\toffset: {y: 35},\r\n\t\t\tanimation: \"flip\",\r\n\t\t\tcolor: color,\r\n\t\t\tautoClose: stick\r\n\t\t});\r\n\t}\r\n}\r\n\r\n// Init valdiation tooltips\r\nvar ValidationTooltips = new jBox(\"Tooltip\", {\r\n\ttrigger: null,\r\n\taddClass: \"validation-tooltip\",\r\n\tanimation: \"flip\",\r\n\tfade: 0\r\n});\r\n\r\nvar Tooltips = new jBox(\"Tooltip\", {\r\n\tattach: $(\"[data-tooltip]\"),\r\n\tgetContent: \"data-tooltip\",\r\n\tposition: {x: \"right\", y: \"center\"},\r\n\toutside: \"x\"\r\n});\r\n\r\nvar SystemActivityToolTips = new jBox(\"Tooltip\", {\r\n\tgetContent: \"data-tooltip\",\r\n\tposition: {y: \"bottom\"},\r\n\tappendTo: $(\"#chainParent\"),\r\n\treposition: true,\r\n\trepositionOnOpen: true,\r\n\tcreateOnInit: true,\r\n\tonOpen: function() {\r\n\t\tvar targetPos = positionRelativeTo(this.target[0], document.getElementById('chainParent'));\r\n\t\tvar nodePos = this.source.closest(\"[data-nodeid]\").position();\r\n\t\tvar parentPos = this.source.closest(\".nodeActivity\").position();\r\n\t\tvar nodeHeight = this.source.closest(\"[data-nodeid]\").height();\r\n\t\t// var nodeWidth = this.source.closest(\"[data-nodeid]\").width();\r\n\t\tvar tooltipWidth = this.container.parent().width();\r\n\t\t// var tooltipHeight = this.container.parent().height();\r\n\r\n\t\tthis.options.position = {x: targetPos.left + 3 - tooltipWidth /2 , y: targetPos.top + this.target[0].offsetHeight};\r\n\t}\r\n});\r\n\r\nvar WormholeRouteToolTips = new jBox(\"Tooltip\", {\r\n\tgetContent: \"data-tooltip\",\r\n\tposition: {y: \"bottom\"},\r\n\tappendTo: $(\"#chainParent\"),\r\n\treposition: true,\r\n\trepositionOnOpen: true,\r\n\tcreateOnInit: true,\r\n\tonOpen: function() {\r\n\t\tvar targetPos = positionRelativeTo(this.target[0], document.getElementById('chainParent'));\r\n\t\tvar nodeHeight = this.source.closest(\"[data-nodeid]\").height();\r\n\t\t// var nodeWidth = this.source.closest(\"[data-nodeid]\").width();\r\n\t\tvar tooltipWidth = this.container.parent().width();\r\n\t\t// var tooltipHeight = this.container.parent().height();\r\n\t\t\r\n\t\tthis.options.position = {x: targetPos.left + 3 - tooltipWidth /2 , y: targetPos.top + this.target[0].offsetHeight};\r\n\t}\r\n});\r\n\r\nvar WormholeTypeToolTips = new jBox(\"Tooltip\", {\r\n\tattach: $(\"#chainMap .whEffect[data-icon]\"),\r\n\tgetContent: \"data-tooltip\",\r\n\tposition: {x: \"left\", y: \"center\"},\r\n\tappendTo: $(\"#chainParent\"),\r\n\toutside: \"x\",\r\n\tadjustDistance: 100,\r\n\tresponsiveWidth: false,\r\n\treposition: true,\r\n\trepositionOnOpen: true,\r\n\tcreateOnInit: true,\r\n\tonOpen: function() {\r\n\t\tvar targetPos = positionRelativeTo(this.target[0], document.getElementById('chainParent'));\r\n\t\tvar tooltipWidth = this.container.parent().width();\r\n\r\n\t\tthis.options.position = {x: targetPos.left - tooltipWidth - 10, y: targetPos.top - 3};\r\n\t}\r\n});\r\n\r\nvar OccupiedToolTips = new jBox(\"Tooltip\", {\r\n\tpointer: \"top:-3\",\r\n\tposition: {x: \"right\", y: \"center\"},\r\n\tappendTo: $(\"#chainParent\"),\r\n\toutside: \"x\",\r\n\tminWidth: 100,\r\n\tanimation: \"move\",\r\n\tadjustDistance: 100,\r\n\tresponsiveWidth: false,\r\n\treposition: true,\r\n\trepositionOnOpen: true,\r\n\trepositionOnContent: true,\r\n\tcreateOnInit: true,\r\n\tonOpen: function() {\r\n\t\tvar tooltip = this;\r\n\t\tconst nodeElemJ = this.source.closest(\"[data-nodeid]\");\r\n\t\tvar systemID = nodeElemJ.data(\"nodeid\");\r\n\t\tvar targetPos = positionRelativeTo(this.target[0], document.getElementById('chainParent'));\r\n\r\n\t\tthis.options.position = {x: targetPos.left + this.target[0].offsetWidth, y: targetPos.top - 3};\r\n\r\n\t\ttooltip.setContent(\"&nbsp;\");\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: \"occupants.php\",\r\n\t\t\tdataType: \"JSON\",\r\n\t\t\tdata: \"systemID=\"+systemID,\r\n\t\t\tcache: false\r\n\t\t}).done(function(data) {\r\n\t\t\tif (data && data.occupants) {\r\n\t\t\t\tvar chars = \"<table>\";\r\n\r\n\t\t\t\t// Sort by characterName\r\n\t\t\t\tdata.occupants.sort(function(a, b) {\r\n\t\t\t\t\tif (a.characterName.toLowerCase() < b.characterName.toLowerCase()) return -1;\r\n\t\t\t\t\tif (a.characterName.toLowerCase() > b.characterName.toLowerCase()) return 1;\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tfor (var x in data.occupants) {\r\n\t\t\t\t\tchars += \"<tr><td>\"+data.occupants[x].characterName+\"</td><td style='padding-left: 10px;'>\"+(data.occupants[x].shipTypeName?data.occupants[x].shipTypeName:\"\")+\"</td></tr>\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tchars += \"</table>\";\r\n\t\t\t\ttooltip.setContent(chars);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n});\r\n\r\n$(\"#chainTabs\").sortable({\r\n\titems: \"> .tab\",\r\n\taxis: \"x\",\r\n\tdelay: 150,\r\n\ttolerance: \"pointer\",\r\n\tcontainment: \"parent\",\r\n\tupdate: function(e, ui) {\r\n\t\tvar result = $(\"#chainTabs\").sortable(\"toArray\");\r\n\t\tvar newTabs = [];\r\n\r\n\t\tfor (var x in result) {\r\n\t\t\tnewTabs.push(options.chain.tabs[result[x]]);\r\n\t\t\t$(\"#chainTabs .tab:eq(\"+x+\")\").attr(\"id\", x);\r\n\t\t}\r\n\r\n\t\toptions.chain.active = $(\".tab.current\").index();\r\n\t\toptions.chain.tabs = newTabs;\r\n\t\toptions.save();\r\n\t}\r\n});\r\n\r\n$(\"#chainTabs\").on(\"click\", \".tab\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"current\")) {\r\n\t\t$(\"#chainTabs .tab\").removeClass(\"current\");\r\n\t\toptions.chain.active = null;\r\n\t} else {\r\n\t\t$(\"#chainTabs .tab\").removeClass(\"current\");\r\n\t\t$(this).addClass(\"current\");\r\n\t\toptions.chain.active = $(this).index();\r\n\t}\r\n\r\n\toptions.save();\r\n\tchain.redraw();\r\n\ttripwire.parse(tripwire.client, \"refresh\");\r\n});\r\n\r\n$(\"#chainTabs\").on(\"click\", \".closeTab\", function(e) {\r\n\te.stopPropagation();\r\n\tvar $tab = $(this).closest(\".tab\");\r\n\r\n\t$(\"#dialog-confirm #msg\").html(\"This tab will be removed, are you sure?\");\r\n\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\tbuttons: {\r\n\t\t\t\"Remove Tab\": function() {\r\n\t\t\t\tvar i = $tab.index();\r\n\r\n\t\t\t\toptions.chain.active = $(\".tab.current\").index();\r\n\t\t\t\toptions.chain.tabs.splice(i, 1);\r\n\t\t\t\toptions.save();\r\n\r\n\t\t\t\t$tab.remove();\r\n\t\t\t\tif ($(\"#chainTabs .tab.current\").length == 0) {\r\n\t\t\t\t\t$(\"#chainTabs .tab:last\").click();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var x = 0, l = $(\"#chainTabs .tab\").length; x < l; x++) {\r\n\t\t\t\t\t$(\"#chainTabs .tab:eq(\"+x+\")\").attr(\"id\", x);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t},\r\n\t\t\tCancel: function() {\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t}\r\n\t\t}\r\n\t}).dialog(\"open\");\r\n});\r\n\r\n$(\"#newTab\").on(\"click\", function() {\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-newTab\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-newTab\").dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tOK: function() {\r\n\t\t\t\t\t$(\"#newTab_form\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$(\"#dialog-newTab .name\").val(viewingSystem).focus();\r\n\t\t\t\t$(\"#dialog-newTab .sigSystemsAutocomplete\").val(viewingSystem);\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tValidationTooltips.close();\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t$(\"#dialog-newTab .sigSystemsAutocomplete\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0});\r\n\r\n\t\t\t\t$(\"#newTab_form\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar $tab = $(\"#chainTab .tab\").clone();\r\n\t\t\t\t\tvar name = $(\"#dialog-newTab .name\").val();\r\n\t\t\t\t\tvar systemID = lookupByPropertyMultiple(tripwire.systems, \"name\", $(\"#dialog-newTab .sigSystemsAutocomplete\").val(), true);\r\n\t\t\t\t\tvar thera = $(\"#tabThera\")[0].checked ? true : false;\r\n\r\n\t\t\t\t\tif (!name) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-newTab .name\")}).setContent(\"Must have a name!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if (!systemID && $(\"#tabType1\")[0].checked) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-newTab .sigSystemsAutocomplete\")}).setContent(\"Must have valid systems (comma separated if multiple)!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if ($(\"#tabType2\")[0].checked) {\r\n\t\t\t\t\t\tsystemID = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$tab.attr(\"id\", $(\"#chainTabs .tab\").length).find(\".name\").data(\"tab\", systemID).html(name);\r\n\t\t\t\t\toptions.chain.tabs.push({systemID: systemID, name: name, evescout: thera});\r\n\t\t\t\t\toptions.save();\r\n\r\n\t\t\t\t\t$(\"#chainTabs\").append($tab);\r\n\r\n\t\t\t\t\t$(\"#dialog-newTab\").dialog(\"close\");\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-newTab .sigSystemsAutocomplete\").click(function(e) {\r\n\t\t\t\t\t$(\"#dialog-newTab #tabType1\").click();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-newTab\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-newTab\").dialog(\"open\");\r\n\t}\r\n});\r\n\r\n$(\"#chainTabs\").on(\"click\", \".editTab\", function(e) {\r\n\te.stopPropagation();\r\n\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-editTab\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-editTab\").dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tOK: function() {\r\n\t\t\t\t\t$(\"#editTab_form\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$(\"#dialog-editTab .name\").val(options.chain.tabs[options.chain.active].name).focus();\r\n\t\t\t\t$(\"#dialog-editTab .sigSystemsAutocomplete\").val(options.chain.tabs[options.chain.active].systemID != 0 ? lookupMultiple(tripwire.systems, 'name', options.chain.tabs[options.chain.active].systemID) : \"\");\r\n\t\t\t\toptions.chain.tabs[options.chain.active].systemID != 0 ? $(\"#dialog-editTab #editTabType1\")[0].checked = true : $(\"#dialog-editTab #editTabType2\")[0].checked = true;\r\n\t\t\t\t$(\"#dialog-editTab #editTabThera\")[0].checked = options.chain.tabs[options.chain.active].evescout;\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tValidationTooltips.close();\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t$(\"#dialog-editTab .sigSystemsAutocomplete\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0});\r\n\r\n\t\t\t\t$(\"#editTab_form\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar $tab = $(\"#chainTabs .tab\").eq([options.chain.active]);\r\n\t\t\t\t\tvar name = $(\"#dialog-editTab .name\").val();\r\n\t\t\t\t\tvar systemID = lookupByPropertyMultiple(tripwire.systems, \"name\", $(\"#dialog-editTab .sigSystemsAutocomplete\").val(), true);\r\n\t\t\t\t\tvar thera = $(\"#editTabThera\")[0].checked ? true : false;\r\n\r\n\t\t\t\t\tif (!name) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-editTab .name\")}).setContent(\"Must have a name!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if (!systemID && $(\"#editTabType1\")[0].checked) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-editTab .sigSystemsAutocomplete\")}).setContent(\"Must have valid systems (comma separated if multiple)!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if ($(\"#editTabType2\")[0].checked) {\r\n\t\t\t\t\t\tsystemID = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$tab.attr(\"id\", $(\"#chainTabs .tab\").length).find(\".name\").data(\"tab\", systemID).html(name);\r\n\t\t\t\t\toptions.chain.tabs[options.chain.active] = {systemID: systemID, name: name, evescout: thera};\r\n\t\t\t\t\toptions.save();\r\n\t\t\t\t\tchain.redraw();\r\n\r\n\t\t\t\t\ttripwire.parse(tripwire.client, \"refresh\");\r\n\r\n\t\t\t\t\t//$(\"#chainTabs\").append($tab);\r\n\r\n\t\t\t\t\t$(\"#dialog-editTab\").dialog(\"close\");\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-editTab .sigSystemsAutocomplete\").click(function(e) {\r\n\t\t\t\t\t$(\"#dialog-editTab #editTabType1\").click();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-editTab\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-editTab\").dialog(\"open\");\r\n\t}\r\n});\r\n\r\n// Signature column context menu\r\n$(\"#signaturesWidget #sigTable thead\").contextmenu({\r\n\tdelegate: \"th.sortable\",\r\n\tmenu: \"#signatureColumnMenu\",\r\n\tposition: function(event, ui) {\r\n        return {my: \"left top\", at: \"center\", of: ui.target};\r\n    },\r\n\tselect: function(e, ui) {\r\n\t\tvar col = $(ui.target).parent().parent().children().index($(ui.target).parent()) + 1;\r\n\r\n\t\tswitch(col) {\r\n\t\t\tcase 1:\r\n\t\t\t\tcolName = \"sigID\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tcolName = \"sigType\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tcolName = \"sigAge\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tcolName = \"leadsTo\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tcolName = \"sigLife\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tcolName = \"sigMass\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tswitch(ui.cmd) {\r\n\t\t\tcase \"leftAlign\":\r\n\t\t\t\t$(\"#signaturesWidget #sigTable tbody td:nth-child(\"+ col +\")\").removeClass(\"centerAlign rightAlign\").addClass(\"leftAlign\");\r\n\t\t\t\toptions.signatures.alignment[colName] = \"leftAlign\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"centerAlign\":\r\n\t\t\t\t$(\"#signaturesWidget #sigTable tbody td:nth-child(\"+ col +\")\").removeClass(\"leftAlign rightAlign\").addClass(\"centerAlign\");\r\n\t\t\t\toptions.signatures.alignment[colName] = \"centerAlign\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"rightAlign\":\r\n\t\t\t\t$(\"#signaturesWidget #sigTable tbody td:nth-child(\"+ col +\")\").removeClass(\"centerAlign leftAlign\").addClass(\"rightAlign\");\r\n\t\t\t\toptions.signatures.alignment[colName] = \"rightAlign\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\toptions.save();\r\n\t},\r\n\tbeforeOpen: function(e, ui) {\r\n\t\tvar col = $(ui.target).parent().parent().children().index($(ui.target).parent()) + 1;\r\n\r\n\t\tswitch(col) {\r\n\t\t\tcase 1:\r\n\t\t\t\tcolName = \"sigID\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tcolName = \"sigType\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tcolName = \"sigAge\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tcolName = \"leadsTo\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tcolName = \"sigLife\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tcolName = \"sigMass\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t$(this).contextmenu(\"enableEntry\", \"leftAlign\", true);\r\n\t\t$(this).contextmenu(\"enableEntry\", \"centerAlign\", true);\r\n\t\t$(this).contextmenu(\"enableEntry\", \"rightAlign\", true);\r\n\r\n\t\t$(this).contextmenu(\"enableEntry\", options.signatures.alignment[colName], false);\r\n\t}\r\n});\r\n\r\n// Chain Map Context Menu\r\n$(\"#chainParent\").contextmenu({\r\n\tappendTo: \"#chainParent\",\r\n\tdelegate: \".nodeSystem a\",\r\n\tposition: function(event, ui) {\r\n        return {my: \"left top-1\", at: \"right top\", of: ui.target};\r\n    },\r\n\tmenu: \"#chainMenu\",\r\n\tshow: {effect: \"slideDown\", duration: 150},\r\n\tselect: function(e, ui) {\r\n\t\tconst nodeElem = $(ui.target[0]).closest(\"[data-nodeid]\");\r\n\t\tvar id = nodeElem.data(\"nodeid\");\r\n\t\tvar row = nodeElem.attr(\"id\").replace(\"node\", \"\") -1;\r\n\r\n\t\tswitch(ui.cmd) {\r\n\t\t\tcase \"showInfo\":\r\n\t\t\t\ttripwire.esi.showInfo(id, options.tracking.active);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"setDest\":\r\n\t\t\t\ttripwire.esi.setDestination(id, options.tracking.active, true);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"addWay\":\r\n\t\t\t\ttripwire.esi.setDestination(id, options.tracking.active, false);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"showMap\":\r\n\t\t\t\t// CCPEVE.showMap(id);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"red\":\r\n\t\t\t\tnodeElem.hasClass(\"redNode\") ? $(this).contextmenu(\"removeFlare\", id, ui) : $(this).contextmenu(\"setFlare\", id, ui.cmd, ui);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"yellow\":\r\n\t\t\t\tnodeElem.hasClass(\"yellowNode\") ? $(this).contextmenu(\"removeFlare\", id, ui) : $(this).contextmenu(\"setFlare\", id, ui.cmd, ui);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"green\":\r\n\t\t\t\tnodeElem.hasClass(\"greenNode\") ? $(this).contextmenu(\"removeFlare\", id, ui) : $(this).contextmenu(\"setFlare\", id, ui.cmd, ui);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"mass\":\r\n\t\t\t\t$(\"#dialog-mass\").data(\"id\", nodeElem.data(\"sigid\")).data(\"systemID\", nodeElem.data(\"nodeid\")).dialog(\"open\");\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"collapse\":\r\n\t\t\t\tvar toggle = options.chain.tabs[options.chain.active] ? ($.inArray(id, options.chain.tabs[options.chain.active].collapsed) == -1 ? true : false) : true;\r\n\t\t\t\tchain.renderer.collapse(id, toggle);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\tbeforeOpen: function(e, ui) {\r\n\t\tvar wormholeID = $(ui.target[0]).closest(\"[data-nodeid]\").data(\"sigid\") || null;\r\n\t\tvar systemID = $(ui.target[0]).closest(\"[data-nodeid]\").data(\"nodeid\");\r\n\r\n\t\t// Add check for k-space\r\n\t\tif (tripwire.systems[systemID].class || !tripwire.esi.characters[options.tracking.active]) {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"setDest\", false);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"addWay\", false);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"showMap\", false);\r\n\t\t} else {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"setDest\", true);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"addWay\", true);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"showMap\", false);\r\n\t\t}\r\n\r\n\t\tif (wormholeID) {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"mass\", true);\r\n\t\t} else {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"mass\", false);\r\n\t\t}\r\n\t},\r\n\tcreate: function(e, ui) {\r\n\t\t// Fix some bad CSS from jQuery Position\r\n\t\t$(this).find(\".ui-front\").css(\"width\", \"10em\");\r\n\t\t$(this).find(\".ui-front\").css(\"position\", \"\");\r\n\r\n\t\t$(\"#dialog-mass\").dialog({\r\n\t\t\tautoOpen: false,\r\n\t\t\twidth: \"auto\",\r\n\t\t\theight: \"auto\",\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tClose: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\tvar wormholeID = $(this).data(\"id\");\r\n\t\t\t\tvar systemID = $(this).data(\"systemID\");\r\n\t\t\t\tvar wormhole = tripwire.client.wormholes[wormholeID];\r\n\t\t\t\tvar signature = tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\tvar otherSignature = tripwire.client.signatures[wormhole.secondaryID];\r\n\r\n\t\t\t\t$(\"#dialog-mass\").dialog(\"option\", \"title\", \"From \"+tripwire.systems[signature.systemID].name+\" to \"+tripwire.systems[otherSignature.systemID].name);\r\n\r\n\t\t\t\t$(\"#dialog-mass #massTable tbody tr\").remove();\r\n\r\n\t\t\t\tvar payload = {wormholeID: wormhole.id};\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: \"mass.php\",\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\tdata: payload,\r\n\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t}).done(function(data) {\r\n\t\t\t\t\tif (data && data.mass) {\r\n                        var totalMass = 0;\r\n\t\t\t\t\t\tfor (x in data.mass) {\r\n                            totalMass += parseFloat(data.mass[x].mass);\r\n\t\t\t\t\t\t\t$(\"#dialog-mass #massTable tbody\").append(\"<tr><td>\"+data.mass[x].characterName+\"</td><td>\"+(data.mass[x].toID == systemID ? \"In\" : \"Out\")+\"</td><td>\"+data.mass[x].shipType+\"</td><td>\"+numFormat(data.mass[x].mass)+\"Kg</td><td>\"+data.mass[x].time+\"</td></tr>\");\r\n\t\t\t\t\t\t}\r\n                        $(\"#dialog-mass #massTable tbody\").append(\"<tr><td></td><td></td><td></td><th>\"+ numFormat(totalMass) +\"Kg</th><td></td></tr>\");\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$.moogle.contextmenu.prototype.setFlare = function(systemID, flare, ui) {\r\n\t\t\tvar data = {\"systemID\": systemID, \"flare\": flare};\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"flares.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: data,\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tif (data && data.result) {\r\n\t\t\t\t\t// $(ui.target[0]).closest(\"td\").removeClass(\"redNode yellowNode greenNode\").addClass(flare+\"Node\");\r\n\r\n\t\t\t\t\tchain.data.flares.flares.push({systemID: systemID, flare: flare, time: null});\r\n\t\t\t\t\tchain.flares(chain.data.flares);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t$.moogle.contextmenu.prototype.removeFlare = function(systemID, ui) {\r\n\t\t\tvar data = {\"systemID\": systemID};\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"flares.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: data,\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tif (data && data.result) {\r\n\t\t\t\t\t// $(ui.target[0]).closest(\"td\").removeClass(\"redNode yellowNode greenNode\");\r\n\r\n\t\t\t\t\tchain.data.flares.flares.splice(Object.index(chain.data.flares.flares, \"systemID\", systemID), 1);\r\n\t\t\t\t\tchain.flares(chain.data.flares);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// Used to generate eve-survival guide link\r\nfunction linkSig(sigName) {\r\n\tvar wormholeSignatures = [\r\n\t\t// Ore sites\r\n\t\t\"Average Frontier Deposit\",\r\n\t\t\"Unexceptional Frontier Deposit\",\r\n\t\t\"Common Perimeter Deposit\",\r\n\t\t\"Exceptional Core Deposit\",\r\n\t\t\"Infrequent Core Deposit\",\r\n\t\t\"Unusual Core Deposit\",\r\n\t\t\"Rarified Core Deposit\",\r\n\t\t\"Isolated Core Deposit\",\r\n\t\t\"Ordinary Permiter Deposit\",\r\n\t\t\"Uncommon Core Deposit\",\r\n\r\n\t\t// Gas Sites\r\n\t\t\"Barren Perimeter Reservoir\",\r\n\t\t\"Minor Perimeter Reservoir\",\r\n\t\t\"Ordinary Perimeter Reservoir\",\r\n\t\t\"Sizeable Perimeter Reservoir\",\r\n\t\t\"Token Perimeter Reservoir\",\r\n\t\t\"Bountiful Frontier Reservoir\",\r\n\t\t\"Vast Frontier Reservoir\",\r\n\t\t\"Instrumental Core Reservoir\",\r\n\t\t\"Vital Core Reservoir\",\r\n\r\n\t\t// Class 1\r\n\t\t\"Perimeter Ambush Point\",\r\n\t\t\"Perimeter Camp\",\r\n\t\t\"Phase Catalyst Node\",\r\n\t\t\"The Line\",\r\n\t\t\"Forgotten Perimeter Coronation Platform\",\r\n\t\t\"Forgotten Perimeter Power Array\",\r\n\t\t\"Unsecured Perimeter Amplifier\",\r\n\t\t\"Unsecured Perimeter Information Center\",\r\n\r\n\t\t// Class 2\r\n\t\t\"Perimeter Checkpoint\",\r\n\t\t\"Perimeter Hangar\",\r\n\t\t\"The Ruins of Enclave Cohort 27\",\r\n\t\t\"Sleeper Data Sanctuary\",\r\n\t\t\"Forgotten Perimeter Gateway\",\r\n\t\t\"Forgotten Perimeter Habitation Coils\",\r\n\t\t\"Unsecured Perimeter Comms Relay\",\r\n\t\t\"Unsecured Perimeter Transponder Farm\",\r\n\r\n\t\t// Class 3\r\n\t\t\"Fortification Frontier Stronghold\",\r\n\t\t\"Outpost Frontier Stronghold\",\r\n\t\t\"Solar Cell\",\r\n\t\t\"The Oruze Construct\",\r\n\t\t\"Forgotten Frontier Quarantine Outpost\",\r\n\t\t\"Forgotten Frontier Recursive Depot\",\r\n\t\t\"Unsecured Frontier Database\",\r\n\t\t\"Unsecured Frontier Receiver\",\r\n\r\n\t\t// Class 4\r\n\t\t\"Frontier Barracks\",\r\n\t\t\"Frontier Command Post\",\r\n\t\t\"Integrated Terminus\",\r\n\t\t\"Sleeper Information Sanctum\",\r\n\t\t\"Forgotten Frontier Conversion Module\",\r\n\t\t\"Forgotten Frontier Evacuation Center\",\r\n\t\t\"Unsecured Frontier Digital Nexus\",\r\n\t\t\"Unsecured Frontier Trinary Hub\",\r\n\r\n\t\t// Class 5\r\n\t\t\"Core Garrison\",\r\n\t\t\"Core Stronghold\",\r\n\t\t\"Oruze Osobnyk\",\r\n\t\t\"Quarantine Area\",\r\n\t\t\"Forgotten Core Data Field\",\r\n\t\t\"Forgotten Core Information Pen\",\r\n\t\t\"Unsecured Frontier Enclave Relay\",\r\n\t\t\"Unsecured Frontier Server Bank\",\r\n\r\n\t\t// Class 6\r\n\t\t\"Core Citadel\",\r\n\t\t\"Core Bastion\",\r\n\t\t\"Strange Energy Readings\",\r\n\t\t\"The Mirror\",\r\n\t\t\"Forgotten Core Assembly Hall\",\r\n\t\t\"Forgotten Core Circuitry Disassembler\",\r\n\t\t\"Unsecured Core Backup Array\",\r\n\t\t\"Unsecured Core Emergence\"\r\n\t];\r\n\r\n\tif (wormholeSignatures.indexOf(sigName) > -1) {\r\n\t\treturn '<a href=\"http://eve-survival.org/wikka.php?wakka='+sigName.replace(/ /g, '')+'\" target=\"_blank\" class=\"siteLink\">'+sigName+'</a>';\r\n\t}\r\n\r\n\treturn sigName;\r\n}\r\n\r\n// Custom inlinecomplete + dropdown input\r\n$.widget(\"custom.inlinecomplete\", $.ui.autocomplete, {\r\n\t_create: function() {\r\n\t\tif (!this.element.is(\"input\")) {\r\n\t\t\tthis._selectInit();\r\n\t\t}\r\n\r\n\t\t// Invoke the parent function\r\n\t\treturn this._super();\r\n\t},\r\n\t_value: function() {\r\n\t\t// Invoke the parent function\r\n\t\tvar originalReturn = this._superApply(arguments);\r\n\r\n\t\tthis.element.change();\r\n\r\n\t\treturn originalReturn;\r\n\t},\r\n\t_suggest: function(items) {\r\n\t\t// if (this.element.val() != items[0].value) {\r\n\t\t\t// this.element.val(items[0].value.substr(0, this.element.val().length));\r\n\t\t// }\r\n\r\n\t\t// Invoke the parent function\r\n\t\treturn this._super(items);\r\n\t},\r\n\t_initSource: function() {\r\n\t\tif ($.isArray(this.options.source)) {\r\n\t\t\tthis.source = function(request, response) {\r\n\t\t\t\tvar matcher = new RegExp(\"^\" + $.ui.autocomplete.escapeRegex(request.term), \"i\");\r\n\t\t\t\tvar results = new Array(); // results array\r\n\t\t\t\tvar data = this.options.source;\r\n\t\t\t\tvar maxSize = this.options.maxSize || 25; // maximum result size\r\n\t\t\t\t// simple loop for the options\r\n\t\t\t\tfor (var i = 0, l = data.length; i < l; i++) {\r\n\t\t\t\t\tif (matcher.test(data[i])) {\r\n\t\t\t\t\t\tresults.push(data[i]);\r\n\r\n\t\t\t\t\t\tif (maxSize && results.length > maxSize) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t // send response\r\n\t\t\t\t response(results);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Invoke the parent function\r\n\t\t\treturn this._super();\r\n\t\t}\r\n\t},\r\n\t_close: function(event) {\r\n\t\tthis.options.source = this.options.input_source ? this.options.input_source : this.options.source;\r\n\r\n\t\t// Invoke the parent function\r\n\t\treturn this._super(event);\r\n\t},\r\n\taddToSelect: function(value) {\r\n\t\tthis.options.select_added_value = value;\r\n\t\tthis.options.select_source.unshift(value);\r\n\t},\r\n\tremoveFromSelect: function(value) {\r\n\t\tif (value) {\r\n\t\t\tthis.options.select_source.splice(value, 1);\r\n\t\t} else if (this.options.select_added_value) {\r\n\t\t\tthis.options.select_source.splice(this.options.select_added_value, 1);\r\n\t\t}\r\n\t\tthis.options.select_added_value = null;\r\n\t},\r\n\t_selectInit: function() {\r\n\t\tthis.element.addClass(\"custom-combobox\");\r\n\t\tthis.wrapper = this.element;\r\n\t\tthis.element = this.wrapper.find(\"input:first\");\r\n\t\tthis.select = this.wrapper.find(\"select:first\").remove();\r\n\r\n\t\tthis.options.input_source = this.options.source;\r\n\t\tthis.options.select_source = this.select.children(\"option[value!='']\").map(function() {\r\n            return $.trim(this.text);\r\n        }).toArray();\r\n\r\n\t\tthis._createShowAllButton();\r\n\t},\r\n\t_createShowAllButton: function() {\r\n        var that = this,\r\n          wasOpen = false;\r\n\r\n        $(\"<a>\")\r\n\t\t\t.attr(\"tabIndex\", that.element.prop(\"tabindex\"))\r\n\t\t\t.attr(\"title\", \"\")\r\n\t\t\t.appendTo(that.wrapper)\r\n\t\t\t.button({icons: {primary: \"ui-icon-triangle-1-s\"}, text: false})\r\n\t\t\t.removeClass(\"ui-corner-all\")\r\n\t\t\t.addClass(\"custom-combobox-toggle ui-corner-right\")\r\n\t\t\t.on(\"mousedown\", function() {\r\n\t\t\t\twasOpen = that.widget().is(\":visible\");\r\n\t\t\t})\r\n\t\t\t.on(\"click\", function() {\r\n\t\t\t\tthat.element.trigger(\"focus\");\r\n\r\n\t\t\t\t// Close if already visible\r\n\t\t\t\tif (wasOpen) {\r\n\t\t\t\t  return;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Pass empty string as value to search for, displaying all results\r\n\t\t\t\tthat.options.source = that.options.select_source;\r\n\t\t\t\tthat._search(\"\");\r\n\t\t\t});\r\n\t},\r\n});\r\n\r\n// Initialize tablesorter plugin on signaturesWidget table\r\n$(\"#sigTable\").tablesorter({\r\n\tsortReset: true,\r\n\twidgets: ['saveSort'],\r\n\ttextExtraction: {\r\n\t\t2: function(node) { return $(node).find(\"span\").data(\"age\"); }\r\n\t}\r\n});\r\n\r\n// Highlight signaturesWidget tr on click\r\n$(\"#sigTable tbody\").on(\"click\", \"tr\", function(e) {\r\n\tif (e.metaKey || e.ctrlKey) {\r\n\t\t// ctrl or cmd key\r\n\t\t$(this).toggleClass(\"selected\");\r\n\t} else if (e.shiftKey) {\r\n\t\t// shift key\r\n\t\t$(this).addClass(\"selected\");\r\n\t\t$(\"#sigTable tbody tr.selected:first\").nextUntil(\"#sigTable tbody tr.selected:last\").addBack().add(\"#sigTable tbody tr.selected:last\").addClass(\"selected\");\r\n\t} else {\r\n\t\t$(\"#sigTable tbody tr.selected\").removeClass(\"selected\");\r\n\t\t$(this).addClass(\"selected\");\r\n\t}\r\n});\r\n\r\n// Un-Highlight signaturesWidget tr on clicking outside\r\n$(document).click(function(e) {\r\n    if(!$(e.target).closest('#sigTable tbody').length && !$(e.target).closest('#edit-signature').length && !$(e.target).closest('#delete-signature').length) {\r\n\t\t$(\"#sigTable tbody tr.selected\").removeClass(\"selected\");\r\n    }\r\n});\r\n\r\n// Monitor custom 'classchange' event\r\n$(\"#sigTable tbody\").on(\"classchange\", \"tr\", function(e, className) {\r\n\t// Trigger signaturesWidget selected row change custom event\r\n\tif (className === \"selected\") {\r\n\t\t$(\"#signaturesWidget\").trigger(\"selected:change\");\r\n\t}\r\n});\r\n\r\n// Update signaturesWidget based on .selected rows change\r\n$(\"#signaturesWidget\").on(\"selected:change\", function() {\r\n\t// Enable/Disable delete icon\r\n\tif ($(\"#sigTable tr.selected\").length === 0) {\r\n\t\t$(\"#signaturesWidget #delete-signature\").addClass(\"disabled\");\r\n\t} else {\r\n\t\t$(\"#signaturesWidget #delete-signature\").removeClass(\"disabled\");\r\n\t}\r\n\r\n\t// Enable/Disable edit icon\r\n\tif ($(\"#sigTable tr.selected\").length === 1) {\r\n\t\t$(\"#signaturesWidget #edit-signature\").removeClass(\"disabled\");\r\n\t} else {\r\n\t\t$(\"#signaturesWidget #edit-signature\").addClass(\"disabled\");\r\n\t}\r\n})\r\n\r\n$(\"#dialog-error\").dialog({\r\n\tautoOpen: false,\r\n\tresizable: false,\r\n\tminHeight: 0,\r\n\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\tbuttons: {\r\n\t\tOk: function() {\r\n\t\t\t$(this).dialog(\"close\");\r\n\t\t}\r\n\t},\r\n\tcreate: function() {\r\n\t\t$(this).dialog(\"option\", \"show\", {effect: \"shake\", duration: 150, easing: \"easeOutElastic\"});\r\n\t}\r\n});\r\n\r\n$(\"#dialog-msg\").dialog({\r\n\tautoOpen: false,\r\n\tresizable: false,\r\n\tminHeight: 0,\r\n\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\tbuttons: {\r\n\t\tOk: function() {\r\n\t\t\t$(this).dialog(\"close\");\r\n\t\t}\r\n\t}\r\n});\r\n\r\n$(\"#dialog-confirm\").dialog({\r\n\tautoOpen: false,\r\n\tresizable: false,\r\n\tminHeight: 0,\r\n\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\tbuttons: {\r\n\t\tCancel: function() {\r\n\t\t\t$(this).dialog(\"close\");\r\n\t\t}\r\n\t}\r\n});\r\n\r\nif (window.location.href.indexOf(\"galileo\") != -1) {\r\n\tNotify.trigger(\"This is the test version of Tripwire.<br/>Please use <a href='https://tripwire.cloud-things.com'>Tripwire</a>\")\r\n}\r\n","var guidance = (function (undefined) {\r\n\r\n\tvar extractKeys = function (obj) {\r\n\t\tvar keys = [];\r\n\r\n\t\tfor (var key in obj) {\r\n\t\t    Object.prototype.hasOwnProperty.call(obj,key) && keys.push(key);\r\n\t\t}\r\n\r\n\t\treturn keys;\r\n\t}\r\n\r\n\tvar sorter = function (a, b) {\r\n\t\treturn parseFloat (a) - parseFloat (b);\r\n\t}\r\n\r\n\tfunction adjustCostForOptions(mapCost, system) {\r\n\t\tvar system = tripwire.systems[30000000 + 1 * system];\r\n\t\tif(!system) { return mapCost; }\r\n\t\tif(options.chain.routeIgnore.enabled && options.chain.routeIgnore.systems.indexOf(system.name) >= 0) {\r\n\t\t\tmapCost += 100;\t// Penalty for an avoided system\r\n\t\t}\r\n\t\tswitch(options.chain.routeSecurity) {\r\n\t\t\tcase 'highsec': return mapCost + (system.security < 0.45 ? 100 : 0);\r\n\t\t\tcase 'avoid-high': return mapCost + (system.security >= 0.45 ? 100 : 0);\r\n\t\t\tcase 'avoid-null': return mapCost + (system.security <= 0.0 ? 100 : 0);\r\n\t\t\tdefault: return mapCost;\t// in case of some invalid option, default to shortest\r\n\t\t}\r\n\t}\r\n\r\n\tvar findPaths = function (map, start, end, infinity) {\r\n\t\tinfinity = infinity || Infinity;\r\n\r\n\t\tvar costs = {},\r\n\t\t    open = {'0': [start]},\r\n\t\t    predecessors = {},\r\n\t\t    keys;\r\n\r\n\t\tvar addToOpen = function (cost, vertex) {\r\n\t\t\tvar key = \"\" + cost;\r\n\t\t\tif (!open[key]) open[key] = [];\r\n\t\t\topen[key].push(vertex);\r\n\t\t}\r\n\r\n\t\tcosts[start] = 0;\r\n\r\n\t\twhile (open && !costs[end]) {\r\n\t\t\tif(!(keys = extractKeys(open)).length) break;\r\n\r\n\t\t\tkeys.sort(sorter);\r\n\r\n\t\t\tvar key = keys[0],\r\n\t\t\t    bucket = open[key],\r\n\t\t\t    node = bucket.shift(),\r\n\t\t\t    currentCost = parseFloat(key),\r\n\t\t\t    adjacentNodes = map[node] || {};\r\n\r\n\t\t\tif (!bucket.length) delete open[key];\r\n\r\n\t\t\tfor (var vertex in adjacentNodes) {\r\n\t\t\t    if (Object.prototype.hasOwnProperty.call(adjacentNodes, vertex)) {\r\n\t\t\t\t\tvar cost = adjustCostForOptions(adjacentNodes[vertex], vertex),\r\n\t\t\t\t\t    totalCost = cost + currentCost,\r\n\t\t\t\t\t    vertexCost = costs[vertex];\r\n\r\n\t\t\t\t\tif ((vertexCost === undefined) || (vertexCost > totalCost)) {\r\n\t\t\t\t\t\tcosts[vertex] = totalCost;\r\n\t\t\t\t\t\taddToOpen(totalCost, vertex);\r\n\t\t\t\t\t\tpredecessors[vertex] = node;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (costs[end] === undefined) {\r\n\t\t\treturn null;\r\n\t\t} else {\r\n\t\t\treturn predecessors;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tvar extractShortest = function (predecessors, end) {\r\n\t\tvar nodes = [],\r\n\t\t    u = end;\r\n\r\n\t\twhile (u) {\r\n\t\t\tnodes.push(u);\r\n\t\t\tpredecessor = predecessors[u];\r\n\t\t\tu = predecessors[u];\r\n\t\t}\r\n\r\n\t\tnodes.reverse();\r\n\t\treturn nodes;\r\n\t}\r\n\r\n\tvar findShortestPath = function (map, nodes) {\r\n\t\tvar start = nodes.shift(),\r\n\t\t    end,\r\n\t\t    predecessors,\r\n\t\t    path = [],\r\n\t\t    shortest;\r\n\r\n\t\twhile (nodes.length) {\r\n\t\t\tend = nodes.shift();\r\n\t\t\tpredecessors = findPaths(map, start, end);\r\n\r\n\t\t\tif (predecessors) {\r\n\t\t\t\tshortest = extractShortest(predecessors, end);\r\n\t\t\t\tif (nodes.length) {\r\n\t\t\t\t\tpath.push.apply(path, shortest.slice(0, -1));\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn path.concat(shortest);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tstart = end;\r\n\t\t}\r\n\t}\r\n\r\n\tvar toArray = function (list, offset) {\r\n\t\ttry {\r\n\t\t\treturn Array.prototype.slice.call(list, offset);\r\n\t\t} catch (e) {\r\n\t\t\tvar a = [];\r\n\t\t\tfor (var i = offset || 0, l = list.length; i < l; ++i) {\r\n\t\t\t\ta.push(list[i]);\r\n\t\t\t}\r\n\t\t\treturn a;\r\n\t\t}\r\n\t}\r\n\r\n\tvar Guidance = function (map) {\r\n\t\tthis.map = map;\r\n\t}\r\n\r\n\tGuidance.prototype.findShortestPath = function (start, end) {\r\n\t\tvar result;\r\n\r\n\t\tif (Object.prototype.toString.call(start) === '[object Array]') {\r\n\t\t\tresult = findShortestPath(this.map, start);\r\n\t\t} else if (arguments.length === 2) {\r\n\t\t\tresult = findShortestPath(this.map, [start, end]);\r\n\t\t} else {\r\n\t\t\tresult = findShortestPath(this.map, toArray(arguments));\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tGuidance.findShortestPath = function (map, start, end) {\r\n\t\tif (Object.prototype.toString.call(start) === '[object Array]') {\r\n\t\t\treturn findShortestPath(map, start);\r\n\t\t} else if (arguments.length === 3) {\r\n\t\t\treturn findShortestPath(map, [start, end]);\r\n\t\t} else {\r\n\t\t\treturn findShortestPath(map, toArray(arguments, 1));\r\n\t\t}\r\n\t}\r\n\r\n\treturn Guidance;\r\n})();\r\n","const ChainMapRendererOrgchart = function(owner) {\r\n\tconst _this = this;\r\n\t\r\n\t/** Initialiser - callback from chart onload */\r\n\tthis.init = function() {\r\n\t\t_this.map = new google.visualization.OrgChart(document.getElementById(\"chainMap\"));\r\n\t\t_this.options = {allowHtml: true, allowCollapse: true, size: \"medium\", nodeClass: \"node\"};\r\n\r\n\t\tgoogle.visualization.events.addListener(_this.map, \"collapse\", _this.collapseHandler);\r\n\r\n\t\t_this.map.draw(new google.visualization.DataView(new google.visualization.DataTable({cols:[{label: \"System\", type: \"string\"}, {label: \"Parent\", type: \"string\"}]})), _this.options);\r\n\t}\r\n\t\r\n\t/** Is this renderer ready to accept draw calls? */\r\n\tthis.ready = function() { return !this.drawing && !!this.map; }\r\n\t\r\n\t/** Switch to this renderer. The renderer can be in a blank state; draw() will be called after */\r\n\tthis.switchTo = function() {\r\n\t\tdocument.getElementById('chainGrid').style.display = '';\r\n\t\tif(!_this.map) { google.charts.setOnLoadCallback(this.init); }\r\n\t}\r\n\t\r\n\t/** Switch away from this renderer. All node divs should be removed from the DOM */\r\n\tthis.switchFrom = function() {\r\n\t\tdocument.getElementById('chainGrid').style.display = 'none';\r\n\t\t_this.map.draw(new google.visualization.DataView(new google.visualization.DataTable({cols:[{label: \"System\", type: \"string\"}, {label: \"Parent\", type: \"string\"}]})), _this.options);\t\t\r\n\t}\r\n\t\r\n\t/** Redraw the map, based on the given node set, line overrides and list of collapsed systems */\r\n\tthis.draw = function(map, lines, collapsed) {\r\n\t\tthis.drawing = true;\r\n\t\tthis.map.draw(newView(map), this.options); \r\n\t\t\r\n\t\tfor (var x in collapsed) {\r\n\t\t\tconst s = collapsed[x];\r\n\t\t\tconst nodeId = $(\"#chainMap [data-nodeid='\"+s+\"']\").attr(\"id\");\r\n\t\t\tif (nodeId) {\r\n\t\t\t\tconst nodeVal = nodeId.split(\"node\")[1];\r\n\t\t\t\tthis.map.collapse(nodeVal - 1, true);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tupdateLines(map, lines);\r\n\t\tthis.drawing = false;\r\n\t};\r\n\t\r\n\tconst newView = function(json) {\r\n\t\tconst view = new google.visualization.DataView(new google.visualization.DataTable(json));\r\n\t\treturn view;\r\n\t};\r\n\t\r\n\tconst updateLines = function(map, lines) {\r\n\t\t_this.lastLineData = { map: map, lines: lines };\r\n\t\tfunction drawNodeLine(system, parent, mode, signatureID) {\r\n\t\t\t/*\tfunction for drawing colored lines  */\r\n\t\t\tif(typeof mode == 'string') { mode = [mode]; }\r\n\r\n\t\t\tfunction addModes(jquerySelector, prefixes) { return doModeClasses(jquerySelector, prefixes, function(s, c) { s.addClass(c); }); }\r\n\t\t\tfunction removeModes(jquerySelector, prefixes) { return doModeClasses(jquerySelector, prefixes, function(s, c) { s.removeClass(c); }); }\r\n\t\t\tfunction doModeClasses(jquerySelector, prefixes, classFunc) {\r\n\t\t\t\tprefixes = prefixes || [];\r\n\t\t\t\tprefixes.push('');\r\n\t\t\t\tprefixes.forEach(function(prefix) { \r\n\t\t\t\t\tmode.forEach( function(mode) { classFunc(jquerySelector, (prefix.length ? prefix + '-' : '') + mode); });\r\n\t\t\t\t});\r\n\t\t\t\treturn jquerySelector;\r\n\t\t\t}\r\n\r\n\t\t\t// Find node in chainmap\r\n\t\t\t//var $node = $(\"#chainMap [data-nodeid='\"+system+\"']\").parent();\r\n\t\t\tvar $node = $(\"#chainMap #node\"+system).parent();\r\n\r\n\t\t\tif ($node.length == 0) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\t// Get node # in this line\r\n\t\t\tvar nodeIndex = Math.ceil(($node[0].cellIndex + 1) / 2 - 1);\r\n\r\n\t\t\t// applly to my top line\r\n\t\t\tvar $connector = addModes($($node.parent().prev().children(\"td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright\")[nodeIndex]), [ 'left', 'right' ]);\r\n\r\n\t\t\t// Find parent node\r\n\t\t\t//var $parent = $(\"#chainMap [data-nodeid='\"+parent+\"']\").parent();\r\n\t\t\tvar $parent = $(\"#chainMap #node\"+parent).parent();\r\n\r\n\t\t\tif ($parent.length == 0 || $connector.length == 0)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t// Find the col of my top line\r\n\t\t\tvar nodeCol = 0, connectorCell = $connector[0].cellIndex;\r\n\t\t\t$node.parent().prev().find(\"td\").each(function(index) {\r\n\t\t\t\tnodeCol += this.colSpan;\r\n\r\n\t\t\t\tif (index == connectorCell) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Get node # in this line\r\n\t\t\tvar parentIndex = Math.ceil(($parent[0].cellIndex + 1) / 2 - 1);\r\n\r\n\t\t\t// Compensate for non-parent nodes (slight performance hit ~10ms)\r\n\t\t\tvar newparentIndex = parentIndex;\r\n\t\t\tfor (var i = 0; i <= parentIndex; i++) {\r\n\t\t\t\tvar checkSystem = 0;//$node.parent().prev().prev().prev().find(\"td:has([data-nodeid]):eq(\"+i+\")\").find(\"[data-nodeid]\").data(\"nodeid\");\r\n\t\t\t\t$node.parent().prev().prev().prev().find(\"td > [data-nodeid]\").each(function(index) {\r\n\t\t\t\t\tif (index == i) {\r\n\t\t\t\t\t\tcheckSystem = $(this).attr(\"id\").replace(\"node\", \"\");//$(this).data(\"nodeid\");\r\n\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif ($.map(map.rows, function(node) { return node.c[1].v == checkSystem ? node : null; }).length <= 0) {\r\n\t\t\t\t\tnewparentIndex--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tparentIndex = newparentIndex;\r\n\r\n\t\t\t// Apply to parent bottom line\r\n\t\t\tvar $connecte = addModes($($node.parent().prev().prev().children(\"td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright\")[parentIndex]), [ 'left', 'right'] );\r\n\r\n\t\t\t// the beans\r\n\t\t\tvar col = 0, parent = false, me = false;\r\n\t\t\t$node.parent().prev().prev().find(\"td\").each(function(index, value) {\r\n\t\t\t\tcol += this.colSpan;\r\n\r\n\t\t\t\tif (me && parent) {\r\n\t\t\t\t\t// All done - get outta here\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else if (typeof($connecte[0]) != \"undefined\" && $connecte[0].cellIndex == index) {\r\n\t\t\t\t\tparent = true;\r\n\r\n\t\t\t\t\taddModes($(this), ['left']);\r\n\r\n\t\t\t\t\t// remove bottom border that points to the right\r\n\t\t\t\t\tif (!me && col != nodeCol) {\r\n\t\t\t\t\t\taddModes($(this), ['bottom']);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// parent and node are same - we are done\r\n\t\t\t\t\tif (nodeCol == col) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (col == nodeCol) {\r\n\t\t\t\t\tme = true;\r\n\r\n\t\t\t\t\taddModes($(this), [ 'bottom' ]);\r\n\t\t\t\t} else if (me || parent) {\r\n\t\t\t\t\tvar tempCol = 0, breaker = false, skip = false;\r\n\r\n\t\t\t\t\t$node.parent().prev().find(\"td\").each(function(index) {\r\n\t\t\t\t\t\ttempCol += this.colSpan;\r\n\r\n\t\t\t\t\t\tif (tempCol == col && ($(this).hasClass(\"google-visualization-orgchart-lineleft\") || $(this).hasClass(\"google-visualization-orgchart-lineright\"))) {\r\n\t\t\t\t\t\t\tif (parent == false) {\r\n\t\t\t\t\t\t\t\t// Stop looking cuz there is another node between us and parent\r\n\t\t\t\t\t\t\t\tbreaker = true;\r\n\t\t\t\t\t\t\t\tremoveModes($connecte, [ 'left', 'right' ]);\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t} else if (parent == true) {\r\n\t\t\t\t\t\t\t\t// Lets make sure there isnt a node between the parent and me\r\n\t\t\t\t\t\t\t\tremoveModes($connecte, [ 'left', 'right' ]);\r\n\r\n\t\t\t\t\t\t\t\t$node.parent().prev().prev().find(\"td\").each(function(index) {\r\n\t\t\t\t\t\t\t\t\tif (index >= $connecte[0].cellIndex) {\r\n\t\t\t\t\t\t\t\t\t\t// there is a node after parent but before me\r\n\t\t\t\t\t\t\t\t\t\tremoveModes($(this), [ 'bottom' ]);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tskip = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (breaker) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!skip) {\r\n\t\t\t\t\t\taddModes($(this), ['bottom'] );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfor (var x in lines) {\r\n\t\t\tdrawNodeLine(lines[x][0], lines[x][1], lines[x][2], lines[x][3]);\r\n\t\t}\r\n\t};\r\n\r\n\tthis.collapseHandler = function() {\t\t\r\n\t\tif(_this.drawing) { return; }\r\n\t\t\r\n\t\tconst collapsed = _this.map.getCollapsedNodes();\r\n\t\tconst collapsedSystems = [];\r\n\t\tfor (x in collapsed) {\r\n\t\t\tvar systemID = $(\"#chainMap #node\"+(collapsed[x] +1)).data(\"nodeid\");\r\n\t\t\tcollapsedSystems.push(systemID);\r\n\t\t}\r\n\t\towner.updateCollapsed(collapsedSystems);\r\n\t\t\r\n\t\tif(_this.lastLineData) { updateLines(_this.lastLineData.map, _this.lastLineData.lines); }\r\n\t}\r\n\r\n\r\n};","const ChainMapRendererRadial = function(owner) {\r\n\t/** Is this renderer ready to accept draw calls? */\r\n\tthis.ready = function() { return !this.drawing; }\r\n\t\r\n\t/** Switch to this renderer. The renderer can be in a blank state; draw() will be called after */\r\n\tthis.switchTo = function() {\r\n\t\tif(!document.getElementById('map-container')) {\r\n\t\t\tconst newDiv = document.createElement('div');\r\n\t\t\tnewDiv.id = 'map-container';\r\n\t\t\tnewDiv.className = 'radial-map';\r\n\t\t\tdocument.getElementById('chainMap').appendChild(newDiv);\r\n\t\t}\r\n\t\tthis.container = document.getElementById('map-container');\r\n\t\tthis.container.style.display = '';\r\n\t}\r\n\t\r\n\t/** Switch away from this renderer. All node divs should be removed from the DOM */\r\n\tthis.switchFrom = function() {\r\n\t\tconst div = document.getElementById('map-container');\r\n\t\tif(div) { div.parentNode.removeChild(div); }\r\n\t\tthis.container = null;\r\n\t}\r\n\t\r\n\tthis.collapse = function(systemID, collapse) {\r\n\t\tif(collapse) { this.mapData.collapsed.push(systemID); }\r\n\t\telse {  this.mapData.collapsed = this.mapData.collapsed.filter(x => x != systemID); }\r\n\t\towner.updateCollapsed(this.mapData.collapsed);\r\n\t\tdrawInner(this.mapData.map, this.mapData.lines, this.mapData.collapsed);\r\n\t}\r\n\t\r\n\t/** Redraw the map, based on the given node set, line overrides and list of collapsed systems */\r\n\tthis.draw = function(map, lines, collapsed) {\r\n\t\tthis.drawing = true;\r\n\t\tthis.mapData = {map: map, lines: lines, collapsed: collapsed};\r\n\t\t\r\n\t\t// Clear the map for a new one\r\n\t\t//this.switchFrom(); this.switchTo();\r\n\r\n\t\ttry { drawInner(map, lines, collapsed); }\r\n\t\tfinally { this.drawing = false; }\r\n\t}\r\n\t\r\n\tconst CIRCLE_SIZE = { x: 70, y: 60, first_ring_delta: 0.3,\r\n\t\tringX: function(ci) { return ci == 0 ? 0 : (ci + this.first_ring_delta) * this.x},\r\n\t\tringY: function(ci) { return ci == 0 ? 0 : (ci + this.first_ring_delta) * this.y},\r\n\t };\r\n\r\n\tconst _this = this;\r\n\tconst drawInner = function(map, lines, collapsed) {\r\n\t\tconst maps = [];\r\n\t\tconst nodesById = {};\r\n\t\t\r\n\t\t// First pass: arrange nodes into rings\r\n\t\tfor(var ri = 0; ri < map.rows.length; ri++) {\r\n\t\t\tconst item = map.rows[ri];\r\n\t\t\tconst inNode = item.c[0], id = inNode.v, parent = item.c[1].v;\r\n\t\t\t\r\n\t\t\tconst mapNode = { id: id, children: [], systemID: inNode.systemID, minArc: 0 };\r\n\t\t\t\r\n\t\t\tif(parent == null) {\r\n\t\t\t\tconst newMap =  { circles: [ { arc: 0, nodes: [ mapNode ] } ] };\r\n\t\t\t\tmapNode.map = newMap;\r\n\t\t\t\tmapNode.circle = 0;\r\n\t\t\t\tmaps.push(newMap);\r\n\t\t\t} else {\r\n\t\t\t\tconst parentNode = nodesById[parent];\r\n\t\t\t\tif(!parentNode) { throw 'Parent id ' + parent + ' not on map yet'; }\r\n\t\t\t\tparentNode.children.push(mapNode);\r\n\t\t\t\tmapNode.parent = parentNode;\r\n\t\t\t\tmapNode.connection = lines.filter(function(l) { return l[0] == id; })[0] || [id, parent, [], '?'];\r\n\t\t\t\tmapNode.connection[2].unshift('connection');\r\n\t\t\t\tmapNode.map = parentNode.map;\r\n\t\t\t\tmapNode.circle = parentNode.circle + 1;\r\n\t\t\t\tif(mapNode.map.circles.length <= mapNode.circle) {\r\n\t\t\t\t\tmapNode.map.circles.push({ arc: 0, nodes:[mapNode] });\r\n\t\t\t\t} else { mapNode.map.circles[mapNode.circle].nodes.push(mapNode); }\r\n\t\t\t}\r\n\t\t\tnodesById[id] = mapNode;\r\n\t\t\tmapNode.markup = inNode.f;\r\n\t\t}\r\n\r\n\t\t// Second pass - for each map, find the allocation of arc needed for each node\r\n\t\tfor(var mi = 0; mi < maps.length; mi++) {\r\n\t\t\tconst map = maps[mi];\r\n\t\t\tfor(var ci = map.circles.length - 1; ci >= 1; ci--) {\t// don't need to calculate ring 0\r\n\t\t\t\tfor(var ni = 0; ni < map.circles[ci].nodes.length; ni++) {\r\n\t\t\t\t\tconst node = map.circles[ci].nodes[ni];\r\n\t\t\t\t\tnode.minArc *= ci / (ci + 1.0);\r\n\t\t\t\t\tif(node.minArc < 1 || collapsed.indexOf(node.systemID * 1) >= 0) { node.minArc = 1; }\r\n\t\t\t\t\tnode.parent.minArc += node.minArc;\r\n\t\t\t\t\tmap.circles[ci].arc += node.minArc;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Third pass - lay out each ring based on the arc values\r\n\t\tfor(var mi = 0; mi < maps.length; mi++) {\r\n\t\t\tconst map = maps[mi];\r\n\t\t\tvar mapDiv = document.getElementById(\"map\" + mi);\r\n\t\t\tif(!mapDiv) {\r\n\t\t\t\tmapDiv = document.createElement('div');\r\n\t\t\t\tmapDiv.id = \"map\" + mi;\r\n\t\t\t\tmapDiv.className = \"map-chain-wrapper\";\r\n\t\t\t}\r\n\t\t\tmapDiv.innerHTML = '<div class=\"map-outer-container\"><div class=\"map-inner-container\"><canvas class=\"map-drawing\" id=\"map-canvas-' + mi + '\"/></div></div>';\r\n\t\t\tconst innerContainer = mapDiv.firstChild.firstChild;\r\n\t\t\tdocument.getElementById('map-container').appendChild(mapDiv);\r\n\r\n\t\t\tmap.bounds = makeDivsForRing(innerContainer, 0, map.circles[0].nodes, 0, Math.PI * 2, collapsed);\r\n\t\t\tmap.domNode = mapDiv;\r\n\t\t\tmap.innerContainer = innerContainer;\r\n\t\t}\r\n\r\n\t\t// Fourth pass: update div and canvas bounds, and draw rings/links\r\n\t\tconst CANVAS_SCALE = 1;\r\n\t\tfor(var mi = 0; mi < maps.length; mi++) {\r\n\t\t\tconst map = maps[mi];\r\n\t\t\tconst finalPositions = {\r\n\t\t\t\tw: 200 + map.bounds.x[1] - map.bounds.x[0],\r\n\t\t\t\th: 100 + map.bounds.y[1] - map.bounds.y[0],\r\n\t\t\t\tcx: 100 - map.bounds.x[0],\r\n\t\t\t\tcy: 50 - map.bounds.y[0]\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// Fill the space available, if we didn't already\r\n\t\t\tif(maps.length == 1) {\r\n\t\t\t\tconst parentWidth = -38 + _this.container.offsetWidth;\t// 20px for map margins, 18 for scrollbar\r\n\t\t\t\tif(finalPositions.w < parentWidth) {\r\n\t\t\t\t\tfinalPositions.cx += 0.5 * (parentWidth - finalPositions.w);\r\n\t\t\t\t\tfinalPositions.w = parentWidth;\r\n\t\t\t\t}\r\n\t\t\t}\t\t\t\r\n\t\t\tconst parentHeight = document.getElementById('chainParent').offsetHeight;\r\n\t\t\tif(finalPositions.h < parentHeight) {\r\n\t\t\t\tfinalPositions.cy += 0.5 * (parentHeight - finalPositions.h);\r\n\t\t\t\tfinalPositions.h = parentHeight;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// If there's enough space to centre the top level node now, do it\r\n\t\t\tif(finalPositions.h >= 2 * (map.bounds.y[1] > -map.bounds.y[0] ? map.bounds.y[1] : -map.bounds.y[0])) {\r\n\t\t\t\tfinalPositions.cy = finalPositions.h / 2;\r\n\t\t\t}\r\n\t\t\tif(finalPositions.w >= 2 * (map.bounds.x[1] > -map.bounds.x[0] ? map.bounds.x[1] : -map.bounds.x[0])) {\r\n\t\t\t\tfinalPositions.cx = finalPositions.w / 2;\r\n\t\t\t}\t\t\t\r\n\t\t\tmap.domNode.style.width = finalPositions.w + 'px';\r\n\t\t\tmap.domNode.style.height = finalPositions.h + 'px';\r\n\t\t\tconst outerContainer = map.domNode.firstChild;\r\n\t\t\touterContainer.style.left = finalPositions.cx + 'px';\r\n\t\t\touterContainer.style.top = finalPositions.cy + 'px';\r\n\t\t\tconst canvas = outerContainer.getElementsByTagName('canvas')[0];\r\n\t\t\tcanvas.width = CANVAS_SCALE * finalPositions.w;\r\n\t\t\tcanvas.style.width = finalPositions.w + 'px';\r\n\t\t\tcanvas.height = CANVAS_SCALE * finalPositions.h;\r\n\t\t\tcanvas.style.height = finalPositions.h + 'px';\r\n\t\t\tcanvas.style.left = -finalPositions.cx + 'px';\r\n\t\t\tcanvas.style.top = -finalPositions.cy + 'px';\r\n\t\t\tconst ctx = canvas.getContext('2d');\r\n\t\t\tctx.scale(CANVAS_SCALE, CANVAS_SCALE);\r\n\t\t\tctx.translate(finalPositions.cx, finalPositions.cy);\r\n\t\t\t\t\r\n\t\t\tfor(var ci = map.bounds.maxCi; ci >= 1; ci--) {\t// don't need to draw ring 0\r\n\t\t\t\tif(options.chain.gridlines) {\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tif(ctx.ellipse) {\r\n\t\t\t\t\t\tctx.lineWidth = 0.5;\r\n\t\t\t\t\t\tctx.setLineDash([]);\r\n\t\t\t\t\t\tctx.ellipse(0, 0, CIRCLE_SIZE.ringX(ci), CIRCLE_SIZE.ringY(ci), 0, 0, Math.PI * 2);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tctx.strokeStyle = propertyFromCssClass('grid-default', 'color');\r\n\t\t\t\t\tctx.stroke();\t\t\r\n\t\t\t\t}\r\n\t\t\t\tif(ci >= map.circles.length) { continue; }\r\n\t\t\t\t\r\n\t\t\t\tfor(var ni = 0; ni < map.circles[ci].nodes.length; ni++) {\r\n\t\t\t\t\tconst node = map.circles[ci].nodes[ni];\r\n\t\t\t\t\tif(!node.position) { continue; }\t// not drawn on map\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.lineWidth = node.connection[2].reduce(function(w, c) { return c == 'frig' ? 1 : w; }, 3);\r\n\t\t\t\t\tctx.moveTo(node.position.x, node.position.y);\r\n\t\t\t\t\tconst cp1 = radToCartesian({ r: node.radPosition.r - 0.5, theta: (node.radPosition.theta + 2 * node.parent.radPosition.theta) / 3.0 });\r\n\t\t\t\t\tconst cp2 = radToCartesian({ r: node.radPosition.r - 0.5, theta: (2 * node.radPosition.theta + node.parent.radPosition.theta) / 3.0 });\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(ci > 1) {\t\t\t\t\r\n\t\t\t\t\t\tctx.bezierCurveTo(cp2.x, cp2.y, cp1.x, cp1.y, node.parent.position.x, node.parent.position.y);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tctx.lineTo(node.parent.position.x, node.parent.position.y);\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst dist2 = (node.position.y - node.parent.position);\r\n\t\t\t\t\tctx.strokeStyle = propertyFromCssClass(node.connection[2], 'border-top-color');\r\n\t\t\t\t\tctx.setLineDash ({ dashed: [3, 2] }[propertyFromCssClass(node.connection[2], 'border-top-style')] || []);\r\n\t\t\t\t\tctx.stroke();\r\n\t\t\t\t}\r\n\t\t\t}\t\r\n\t\t}\r\n\t\t\r\n\t\t// Remove any maps which aren't in use any more\r\n\t\tfor(var mi = maps.length; ; mi++) {\r\n\t\t\tconst div = document.getElementById('map' + mi);\r\n\t\t\tif(div) { div.parentNode.removeChild(div); }\r\n\t\t\telse { break; }\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction makeDivsForRing(innerContainer, ci, nodes, minRad, maxRad, collapsed) {\r\n\t\tconst bounds = { x: [0, 0], y: [0, 0], maxCi: ci };\r\n\t\tif(!nodes.length) { return bounds; }\r\n\t\tconst parentCollapsed = collapsed.indexOf(1 * (nodes[0].parent || {}).systemID) >= 0;\r\n\t\tconst max_nodes_per_rad = 1.4;\r\n\t\tif(ci > 0 && !parentCollapsed) {\r\n\t\t\tvar skipped = 0;\r\n\t\t\twhile(++skipped < 2 && nodes.length > max_nodes_per_rad * ci * (maxRad - minRad)) { ci++; }\r\n\t\t}\r\n\t\tconst totalArc = parentCollapsed ? nodes.length : nodes.reduce(function(acc, x) { return acc + x.minArc; }, 0);\r\n\t\tconst rads_per_arc = (maxRad - minRad) / totalArc;\r\n\t\tvar rad_offset = minRad;\r\n\t\tvar alignment_delta = 0;\r\n\t\t\r\n\t\tfor(var ni = 0; ni < nodes.length; ni++) {\r\n\t\t\tconst node = nodes[ni];\t\r\n\t\t\t\r\n\t\t\t// Make the node\r\n\t\t\tconst frag = document.createRange().createContextualFragment('<div class=\"node-wrapper\">' + node.markup + '</div>');\r\n\t\t\tnode.domNode = frag.firstChild;\r\n\t\t\tinnerContainer.appendChild(node.domNode);\r\n\t\t\tconst systemID = 1 * node.systemID;\r\n\t\t\t$(node.domNode).dblclick(() => _this.collapse(systemID, collapsed.indexOf(systemID) < 0));\r\n\t\t\t\r\n\t\t\t// Position the node\r\n\t\t\tconst dr = (parentCollapsed ? 1 : node.minArc) * rads_per_arc;\r\n\t\t\tconst rad_centre = rad_offset + (dr / 2);\r\n\t\t\t\r\n\t\t\tif(ci == 1 && ni == 0) { // First node on first ring should be axis aligned\r\n\t\t\t\talignment_delta -= rad_centre;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tnode.radPosition = { r: ci, theta: rad_centre + alignment_delta };\r\n\t\t\tnode.position = radToCartesian(node.radPosition);\r\n\t\t\t\r\n\t\t\tif(node.position.x < bounds.x[0]) { bounds.x[0] = node.position.x; }\r\n\t\t\tif(node.position.x > bounds.x[1]) { bounds.x[1] = node.position.x; }\r\n\t\t\tif(node.position.y < bounds.y[0]) { bounds.y[0] = node.position.y; }\r\n\t\t\tif(node.position.y > bounds.y[1]) { bounds.y[1] = node.position.y; }\r\n\t\t\t\r\n\t\t\tnode.domNode.style.left = node.position.x + 'px';\r\n\t\t\tnode.domNode.style.top = node.position.y + 'px';\r\n\t\t\t\r\n\t\t\tif(parentCollapsed) {\r\n\t\t\t\tnode.domNode.style.display = 'none';\r\n\t\t\t} else {\t\t\t\t\r\n\t\t\t\t// Do the segment of the next circle\r\n\t\t\t\tconst excess = (ci > 0 && dr > node.minArc * ci) ? dr - node.minArc * ci : 0;\r\n\t\t\t\tif(node.children.length) {\r\n\t\t\t\t\tconst nextBounds = makeDivsForRing(innerContainer, ci + 1, node.children, rad_offset + (0.5 * excess) + alignment_delta, rad_offset - (0.5 * excess) + alignment_delta + dr, collapsed);\r\n\t\t\t\t\tif(nextBounds.x[0] < bounds.x[0]) { bounds.x[0] = nextBounds.x[0]; }\r\n\t\t\t\t\tif(nextBounds.x[1] > bounds.x[1]) { bounds.x[1] = nextBounds.x[1]; }\r\n\t\t\t\t\tif(nextBounds.y[0] < bounds.y[0]) { bounds.y[0] = nextBounds.y[0]; }\r\n\t\t\t\t\tif(nextBounds.y[1] > bounds.y[1]) { bounds.y[1] = nextBounds.y[1]; }\r\n\t\t\t\t\tif(nextBounds.maxCi > bounds.maxCi) { bounds.maxCi = nextBounds.maxCi; }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\trad_offset += dr;\r\n\t\t}\r\n\t\t\r\n\t\treturn bounds;\r\n\t}\r\n\r\n\tfunction radToCartesian(rad) {\r\n\t\treturn { \r\n\t\t\tx: CIRCLE_SIZE.ringX(rad.r) * Math.sin(rad.theta), \r\n\t\t\ty: CIRCLE_SIZE.ringY(rad.r) * Math.cos(rad.theta)\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t/** https://stackoverflow.com/questions/40978050 */\r\n\tfunction propertyFromCssClass(className, property) {\r\n\t\tif(Array.isArray(className)) { className = className.join(' '); }\r\n\t\tvar elem = document.getElementById('temp-div-' + className);\r\n\t\tif(!elem) {\r\n\t\t  elem = document.createElement(\"div\");\r\n\t\t  elem.id = 'temp-div-' + className;\r\n\t\t  elem.style.cssText = \"position:fixed;left:-100px;top:-100px;width:1px;height:1px\";\r\n\t\t  elem.className = className + ' temp';\r\n\t\t  document.body.appendChild(elem);  // required in some browsers\r\n\t\t  }\r\n\t  const color = getComputedStyle(elem).getPropertyValue(property);\r\n\t  //document.body.removeChild(tmp);\r\n\t  return color;\r\n\t}\t\r\n};","var chain = new function() {\r\n\tvar chain = this;\r\n\tthis.map, this.view, this.drawing, this.data = {};\r\n\t// Renderer should have:\r\n\t//  ready() - Whether the renderer is initialised and can accept draw calls\r\n\t// switchTo() - Make this renderer active. The renderer can be in a blank state; draw() will be called after\r\n\t// switchFrom() - Switch away from this renderer. All node divs should be removed from the DOM, other items can be removed or made invisible\r\n\t// draw(map, lines, collapsedSystems) - Redraw the map, based on the given node set, line overrides and list of collapsed systems \r\n\t// collapse(systemID, toggle) - marks the system as collapsed/not collapsed\r\n\t// If the renderer allows collapsing of nodes then it will call updateCollapsed on the owner (the chain) with a list of collapsed systems in the current tab\r\n\t\r\n\tconst renderers = { \r\n\t\torgChart: new ChainMapRendererOrgchart(this),\r\n\t\tradial: new ChainMapRendererRadial(this)\r\n\t};\r\n\t\r\n\tthis.renderer = renderers[options.chain.renderer];\r\n\tthis.renderer.switchTo();\r\n\t\r\n\tthis.useRenderer = function(name) {\r\n\t\tif(!renderers[name]) { throw 'Unknown renderer ' + name; }\r\n\t\tif(this.renderer != renderers[name]) {\r\n\t\t\tthis.renderer.switchFrom();\r\n\t\t\tthis.renderer = renderers[name];\r\n\t\t\tthis.renderer.switchTo();\r\n\t\t\tthis.redraw();\r\n\t\t}\r\n\t}\r\n\r\n\tthis.activity = function(data) {\r\n\t\t/*\tfunction for adding recent activity to chain map nodes\t*/\r\n\t\t//var data = typeof(data) !== \"undefined\" ? data : this.data.activity;\r\n\r\n\t\t// Hide all activity colored dots instead of checking each one\r\n\t\tvar elements = document.querySelectorAll(\"#chainMap .nodeActivity span\");\r\n\t\tfor (var i = 0, l = elements.length; i < l; ++i) {\r\n\t\t   elements[i].className = elements[i].className + \" invisible\";\r\n\t\t}\r\n\r\n\t\t// Loop through passed data and show dots by system\r\n\t\tvar elements = document.querySelectorAll(\"#chainMap [data-nodeid]\");\r\n\t\tfor (var i = 0, l = elements.length; i < l; ++i) {\r\n\t\t   var systemID = elements[i].getAttribute(\"data-nodeid\");\r\n\t\t   if (data[systemID]) {\r\n\t\t\t   var shipJumps = data[systemID].shipJumps;\r\n\t\t\t   var podKills = data[systemID].podKills;\r\n\t\t\t   var shipKills = data[systemID].shipKills;\r\n\t\t\t   var npcKills = data[systemID].npcKills;\r\n\t\t\t   var node = elements[i].getElementsByClassName(\"nodeActivity\")[0];\r\n\r\n\t\t\t   if (shipJumps > 0) {\r\n\t\t\t\t   var jumps = node.getElementsByClassName(\"jumps\")[0];\r\n\t\t\t\t   jumps.className = jumps.className.replace(/invisible/g, \"\");\r\n\t\t\t\t   jumps.setAttribute(\"data-tooltip\", shipJumps + \" Jumps\");\r\n\t\t\t   }\r\n\r\n\t\t\t   if (podKills > 0) {\r\n\t\t\t\t   var pods = node.getElementsByClassName(\"pods\")[0];\r\n\t\t\t\t   pods.className = pods.className.replace(/invisible/g, \"\");\r\n\t\t\t\t   pods.setAttribute(\"data-tooltip\", podKills + \" Pod Kills\");\r\n\t\t\t   }\r\n\r\n\t\t\t   if (shipKills > 0) {\r\n\t\t\t\t   var ships = node.getElementsByClassName(\"ships\")[0];\r\n\t\t\t\t   ships.className = ships.className.replace(/invisible/g, \"\");\r\n\t\t\t\t   ships.setAttribute(\"data-tooltip\", shipKills + \" Ship Kills\");\r\n\t\t\t   }\r\n\r\n\t\t\t   if (npcKills > 0) {\r\n\t\t\t\t   var npcs = node.getElementsByClassName(\"npcs\")[0];\r\n\t\t\t\t   npcs.className = npcs.className.replace(/invisible/g, \"\");\r\n\t\t\t\t   npcs.setAttribute(\"data-tooltip\", npcKills + \" NPC Kills\");\r\n\t\t\t   }\r\n\t\t   }\r\n\t\t}\r\n\r\n\t\tif (SystemActivityToolTips.attachedElements && SystemActivityToolTips.attachedElements.length > 0) {\r\n\t\t\tSystemActivityToolTips.detach($(\"#chainMap .whEffect\"));\r\n\t\t}\r\n\t\tSystemActivityToolTips.attach($(\"#chainMap .nodeActivity > span[data-tooltip]:not(.invisible)\"));\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tthis.occupied = function(data) {\r\n\t\t/*\tfunction for showing occupied icon  */\r\n\r\n\t\t// Hide all icons instead of checking each one\r\n\t\t$(\"#chainMap [data-icon='user'], #chainMap [data-icon='user'] + .badge\").addClass(\"invisible\");\r\n\r\n\t\t// Loop through passed data and show icons\r\n\t\tfor (var x in data) {\r\n\t\t\t$(\"#chainMap [data-nodeid='\"+data[x].systemID+\"'] [data-icon='user']\").removeClass(\"invisible\");\r\n\t\t\t$(\"#chainMap [data-nodeid='\"+data[x].systemID+\"'] [data-icon='user'] + .badge\").removeClass(\"invisible\").html(data[x].count);\r\n\t\t}\r\n\r\n\t\tOccupiedToolTips.attach($(\"#chainMap [data-icon='user']:not(.invisible)\"));\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tthis.flares = function(data) {\r\n\t\t/*\tfunction for coloring chain map nodes via flares  */\r\n\t\t//var data = typeof(data) !== \"undefined\" ? data : this.data.flares;\r\n\r\n\t\t// Remove all current node coloring instead of checking each one\r\n\t\t$(\"#chainMap div.node\").removeClass(\"redNode yellowNode greenNode\");\r\n\r\n\t\t// Remove all coloring from chain grid\r\n\t\t$(\"#chainGrid tr\").removeClass(\"red yellow green\");\r\n\r\n\t\t// Loop through passed data and add classes by system\r\n\t\tif (data) {\r\n\t\t\tfor (var x in data.flares) {\r\n\t\t\t\tvar systemID = data.flares[x].systemID;\r\n\t\t\t\tvar flare = data.flares[x].flare;\r\n\r\n\t\t\t\tvar row = ($(\"#chainMap [data-nodeid=\"+systemID+\"]\").addClass(flare+\"Node\").parent().index() - 1) / 3 * 2;\r\n\r\n\t\t\t\tif (row > 0) {\r\n\t\t\t\t\t$(\"#chainGrid tr:eq(\"+row+\")\").addClass(flare).next().addClass(flare);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tthis.grid = function() {\r\n\t\t/*  function for showing/hiding grid lines  */\r\n\t\t// This is an optional feature\r\n\t\tif (options.chain.gridlines == false) {\r\n\t\t\t$(\"#chainGrid tr\").addClass(\"hidden\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t$(\"#chainGrid tr\").removeClass(\"hidden\");\r\n\t\t//$(\"#chainGrid\").css(\"width\", \"100%\");\r\n\r\n\t\t// Calculate how many rows have systems, max 0 hack to prevent negative numbers, and rows above this number get hidden\r\n\t\tvar rows = Math.max(0, $(\".google-visualization-orgchart-table tr:has(.node)\").length * 2 - 1);\r\n\t\t$(\"#chainGrid tr:gt(\"+rows+\")\").addClass(\"hidden\");\r\n\t}\r\n\r\n\tthis.nodes = function(map) {\r\n\t\tvar chain = {cols: [{label: \"System\", type: \"string\"}, {label: \"Parent\", type: \"string\"}], rows: []};\r\n\t\tvar frigTypes = [\"Q003\", \"E004\", \"L005\", \"Z006\", \"M001\", \"C008\", \"G008\", \"A009\", \"SML\" ];\r\n\t\tvar connections = [];\r\n\t\tvar chainMap = this;\r\n\r\n\t\tfunction formatStatics(statics) {\r\n\t\t\tif(!statics) { return ''; }\r\n\t\t\tconst shortCodeMap = { 'High-Sec': 'H', 'Low-Sec': 'L', 'Null-Sec': 'N',\r\n\t\t\t\t'Class 1': '1', 'Class 2': '2', 'Class 3': '3', 'Class 4': '4', 'Class 5' : 5, 'Class 6': 6\r\n\t\t\t};\r\n\t\t\tconst classMap = { H: 'hisec', L: 'lowsec', N: 'nullsec'};\r\n\t\t\treturn statics.map(function(s) {\r\n\t\t\t\tconst text = shortCodeMap[tripwire.wormholes[s].leadsTo];\r\n\t\t\t\tconst className = classMap[text] || 'class-' +  text;\r\n\t\t\t\tconst tip = tripwire.wormholes[s].leadsTo + ' via ' + s;\r\n\t\t\t\treturn '<span class=\"' + className + '\" data-tooltip=\"' + tip + '\">' + text + '</span>';\r\n\t\t\t}).join('');\r\n\t\t}\r\n\r\n\t\tfunction topLevel(systemID, id) {\r\n\t\t\tif (!systemID || !tripwire.systems[systemID])\r\n\t\t\t\treturn false;\r\n\t\t\tconst tab = options.chain.tabs[options.chain.active];\r\n\t\t\tconst tabName = tab && tab.systemID != 0 && 0 > tab.systemID.indexOf(',') ? options.chain.tabs[options.chain.active].name : undefined;\r\n\t\t\treturn makeSystemNode(systemID, id, null, null, tabName, '&nbsp;', ['top-level']);\r\n\t\t}\r\n\r\n\t\tfunction makeSystemNode(systemID, id, whId, inSigId, systemName, nodeTypeMarkup, additionalClasses) {\r\n\t\t\t// System type switch\r\n\t\t\tvar systemType = getSystemType(systemID);\r\n\t\t\tconst system = tripwire.systems[systemID];\r\n\r\n\t\t\tvar effectClass = null, effect = null;\r\n\t\t\tif (system && system.effect) {\r\n\t\t\t\tswitch(system.effect) {\r\n\t\t\t\t\tcase \"Black Hole\":\r\n\t\t\t\t\t\teffectClass = \"blackhole\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Cataclysmic Variable\":\r\n\t\t\t\t\t\teffectClass = \"cataclysmic-variable\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Magnetar\":\r\n\t\t\t\t\t\teffectClass = \"magnetar\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Pulsar\":\r\n\t\t\t\t\t\teffectClass = \"pulsar\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Red Giant\":\r\n\t\t\t\t\t\teffectClass = \"red-giant\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Wolf-Rayet Star\":\r\n\t\t\t\t\t\teffectClass = \"wolf-rayet\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\teffect = system.effect;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst systemNameText = \r\n\t\t\t\toptions.chain.sigNameLocation == 'name' ? (systemName ? systemName : system ? system.name : '&nbsp;') :\r\n\t\t\t\toptions.chain.sigNameLocation == 'name_prefix' ?\r\n\t\t\t\t\t(systemName ? systemName + (system ? ' - ' + system.name : '') : (system ? system.name : '&nbsp;')) :\r\n\t\t\t\t(system ? system.name : '&nbsp;');\t\r\n\r\n\t\t\tvar node = {v: id, systemID: systemID };\r\n\t\t\tvar chainNode = \"<div id='node\"+id+\"' data-nodeid='\"+systemID+\"'\"\r\n\t\t\t\t+(whId ? \" data-sigid='\"+whId+\"'\" : '')\r\n\t\t\t\t+(inSigId ? \" data-inSigid='\"+inSigId+\"'\" : '')\r\n\t\t\t\t+\" class='node \" + ((additionalClasses || []).join(' ')) + \"'>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='nodeIcons'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<div style='float: left;'>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<i class='whEffect' \"+(effectClass ? \"data-icon='\"+effectClass+\"' data-tooltip='\"+effect+\"'\" : null)+\"></i>\"\r\n\t\t\t\t\t\t\t+\t\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\t\"<div style='float: right;'>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<i data-icon='user' class='invisible'></i>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<span class='badge invisible'></span>\"\r\n\t\t\t\t\t\t\t+\t\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeClass'>\"+systemType+\"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeSystem'>\"\r\n\t\t\t\t\t\t\t+\t\t(system ? \"<a href='.?system=\"+system.name+\"'>\"+systemNameText+\"</a>\" : systemNameText)\r\n\t\t\t\t\t\t\t+\t\"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeType'>\" + nodeTypeMarkup + \"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='statics'>\"\r\n\t\t\t\t\t\t\t+ formatStatics(system ? system.statics : [])\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='nodeActivity'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span>\"\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\"</div>\";\r\n\r\n\t\t\tnode.f = chainNode;\r\n\r\n\t\t\treturn node;\r\n\t\t}\r\n\t\t\r\n\t\tfunction makeCalcChildNode(childID, node, targetSystem) {\r\n\t\t\tvar path = guidance.findShortestPath(tripwire.map.shortest, [targetSystem - 30000000, node.child.systemID - 30000000]);\r\n\t\t\t\r\n\t\t\tvar calcNode = { calculated: true};\r\n\t\t\tcalcNode.life = \"Gate\";\r\n\t\t\tcalcNode.parent = {};\r\n\t\t\tcalcNode.parent.id = node.child.id;\r\n\t\t\tcalcNode.parent.systemID = node.child.systemID;\r\n\t\t\tcalcNode.parent.name = node.child.name;\r\n\t\t\tcalcNode.parent.type = node.child.type;\r\n\t\t\tcalcNode.parent.nth = node.child.nth;\r\n\r\n\t\t\tcalcNode.child = {};\r\n\t\t\tcalcNode.child.id = ++childID;\r\n\t\t\tcalcNode.child.systemID = targetSystem;\r\n\t\t\tcalcNode.child.name = tripwire.systems[targetSystem].name;\r\n\t\t\tcalcNode.child.path = path;\r\n\t\t\tcalcNode.child.jumps = path.length - 1;\r\n\t\t\tcalcNode.child.nth = null;\t\t\t\r\n\t\t\t\r\n\t\t\treturn { childID, calcNode };\r\n\t\t}\r\n\t\t\r\n\t\tfunction getSystemType(systemID) {\r\n\t\t\tconst system = tripwire.systems[systemID];\r\n\t\t\tvar leadsToPointer = typeof(systemID) === \"string\" && systemID.indexOf(\"|\") >= 0 ? tripwire.aSigSystems[systemID.substring(0, systemID.indexOf(\"|\"))] : null;\r\n\t\t\tconst nodeClass = system ? system.class : \r\n\t\t\t\tleadsToPointer && leadsToPointer.substring(0, 6) == 'Class-' ? 1 * leadsToPointer.substring(6) :\r\n\t\t\t\tundefined;\r\n\t\t\tconst nodeSecurity = system ? system.security : \r\n\t\t\t\tleadsToPointer == \"High-Sec\" ? 0.8 :\r\n\t\t\t\tleadsToPointer == \"Low-Sec\" ? 0.4 :\r\n\t\t\t\tleadsToPointer == \"Null-Sec\" ? -0.1 :\r\n\t\t\t\tundefined;\r\n\t\t\t\t\r\n\t\t\tif (nodeClass)\r\n\t\t\t\treturn \"<span class='wh class-\" + nodeClass + \"'>C\" + nodeClass + \"</span>\";\r\n\t\t\telse if (nodeSecurity >= 0.45)\r\n\t\t\t\treturn \"<span class='hisec'>HS</span>\";\r\n\t\t\telse if (nodeSecurity > 0.0)\r\n\t\t\t\treturn \"<span class='lowsec'>LS</span>\";\r\n\t\t\telse if (nodeSecurity <= 0.0)\r\n\t\t\t\treturn \"<span class='nullsec'>NS</span>\";\r\n\t\t\telse return '&nbsp;';\t// unknown\r\n\t\t}\t\t\r\n\r\n\t\tfunction findLinks(system) {\r\n\t\t\tif (system[0] <= 0) return false;\r\n\r\n\t\t\tvar parentID = parseInt(system[1]), childID = chainList.length;\r\n\r\n\t\t\tfor (var x in chainData) {\r\n\t\t\t\tvar wormhole = chainData[x];\t\t\t\t\r\n\t\t\t\tif ($.inArray(wormhole.id, usedLinks) == -1) {\r\n\t\t\t\t\tvar sig1, sig2, sig1Type, sig2Type,\r\n\t\t\t\t\t\tparent, child, parentType, childType;\r\n\t\t\t\t\tif (wormhole.parent == \"secondary\") {\r\n\t\t\t\t\t\tsig1 = tripwire.client.signatures[wormhole.secondaryID];\r\n\t\t\t\t\t\tsig2 = tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsig1 = tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t\t\tsig2 = tripwire.client.signatures[wormhole.secondaryID];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsig1Type = wormhole.type; sig2Type = 'K162';\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (sig1 && sig1.systemID == system[0]) {\r\n\t\t\t\t\t\tparent = sig1; child = sig2;\r\n\t\t\t\t\t\tparentType = sig2Type; childType = sig1Type;\r\n\t\t\t\t\t} else if(sig2 && sig2.systemID == system[0]) {\r\n\t\t\t\t\t\tparent = sig2; child = sig1;\r\n\t\t\t\t\t\tchildType = sig2Type; parentType = sig1Type;\r\n\t\t\t\t\t} else { continue; }\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar node = {};\r\n\t\t\t\t\tnode.id = wormhole.id;\r\n\t\t\t\t\tnode.life = wormhole.life;\r\n\t\t\t\t\tnode.mass = wormhole.mass;\r\n\t\t\t\t\tnode.time = parent.modifiedTime;\r\n\r\n\t\t\t\t\tnode.parent = {};\r\n\t\t\t\t\tnode.parent.id = parentID;\r\n\t\t\t\t\tnode.parent.systemID = tripwire.systems[parent.systemID] ? parent.systemID : parent.systemID + \"|\" + Math.floor(Math.random() * Math.floor(10000));\r\n\t\t\t\t\tnode.parent.name = parent.name;\r\n\t\t\t\t\tnode.parent.type = parentType;\r\n\t\t\t\t\tnode.parent.typeBM = null;\r\n\t\t\t\t\tnode.parent.classBM = null;\r\n\t\t\t\t\tnode.parent.nth = null;\r\n\t\t\t\t\tnode.parent.signatureID = child.signatureID;\r\n\t\t\t\t\tnode.parent.sigIndex = child.id;\r\n\r\n\t\t\t\t\tnode.child = {};\r\n\t\t\t\t\tnode.child.id = ++childID;\r\n\t\t\t\t\tnode.child.systemID = tripwire.systems[child.systemID] ? child.systemID : child.systemID + \"|\" + Math.floor(Math.random() * Math.floor(10000));\r\n\t\t\t\t\tnode.child.name = child.name;\r\n\t\t\t\t\tnode.child.type = childType;\r\n\t\t\t\t\tnode.child.typeBM = null;\r\n\t\t\t\t\tnode.child.classBM = null;\r\n\t\t\t\t\tnode.child.nth = null;\r\n\t\t\t\t\tnode.child.signatureID = parent.signatureID;\r\n\t\t\t\t\tnode.child.sigIndex = parent.id;\r\n\r\n\t\t\t\t\tchainLinks.push(node);\r\n\t\t\t\t\tchainList.push([node.child.systemID, node.child.id, system[2]]);\r\n\t\t\t\t\tusedLinks.push(node.id);\r\n\t\t\t\t\t// usedLinks[system[2]].push(node.id);\r\n\r\n\t\t\t\t\tif ($(\"#show-viewing\").hasClass(\"active\") && tripwire.systems[node.child.systemID] && !tripwire.systems[viewingSystemID].class && !tripwire.systems[node.child.systemID].class && viewingSystemID != node.child.systemID ) {\r\n\t\t\t\t\t\tvar calcNode = makeCalcChildNode(childID, node, viewingSystemID);\r\n\t\t\t\t\t\tchildID = calcNode.childID;\r\n\r\n\t\t\t\t\t\tchainLinks.push(calcNode.calcNode);\r\n\t\t\t\t\t\tchainList.push([0, childID]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ($(\"#show-favorite\").hasClass(\"active\") && tripwire.systems[node.child.systemID] && !tripwire.systems[node.child.systemID].class) {\r\n\t\t\t\t\t\tfor (var x in options.favorites) {\r\n\t\t\t\t\t\t\tif (tripwire.systems[options.favorites[x]].regionID >= 11000000 || tripwire.systems[node.child.systemID].regionID >= 11000000 || options.favorites[x] == node.child.systemID)\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t\t\tvar calcNode = makeCalcChildNode(childID, node, options.favorites[x]);\r\n\t\t\t\t\t\t\tchildID = calcNode.childID;\r\n\r\n\t\t\t\t\t\t\tchainLinks.push(calcNode.calcNode);\r\n\t\t\t\t\t\t\tchainList.push([0, childID]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif ($(\"#chainTabs .current\").length > 0) {\r\n\t\t\tvar systems = $(\"#chainTabs .current .name\").data(\"tab\").toString().split(\",\");\r\n\t\t\tvar chainList = [];\r\n\t\t\tvar chainData = map;\r\n\t\t\tvar chainLinks = [];\r\n\t\t\tvar usedLinks = [];\r\n\r\n\t\t\tif (systems == 0) {\r\n                                let i = 0;\r\n                                Object.keys(map).slice()/*.reverse()*/.forEach(x => {\r\n\t\t\t\t        const parent = tripwire.client.signatures[map[x].initialID];\r\n\t\t\t\t        const child = tripwire.client.signatures[map[x].secondaryID];\r\n                                        if (parent && tripwire.systems[parent.systemID] && typeof(tripwire.systems[parent.systemID].class) == \"undefined\") {\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t// usedLinks[parent.systemID] = [];\r\n\t\t\t\t\t\tchain.rows.push({c: [topLevel(parent.systemID, i), {v: null}]});\r\n\t\t\t\t\t\tchainList.push([parent.systemID, i, parent.systemID]);\r\n                                        } else if (child && tripwire.systems[child.systemID] && typeof(tripwire.systems[child.systemID].class) == \"undefined\") {\r\n\t\t\t\t  \t        i++;\r\n\t\t\t\t  \t\t// usedLinks[child.systemID] = [];\r\n\t\t\t\t\t\tchain.rows.push({c: [topLevel(child.systemID, i), {v: null}]});\r\n\t\t\t\t\t\tchainList.push([child.systemID, i, child.systemID]);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tfor (var x in systems) {\r\n\t\t\t\t\t// usedLinks[systems[x]] = [];\r\n\t\t\t\t\tchain.rows.push({c: [topLevel(systems[x], parseInt(x) + 1), {v: null}]});\r\n\t\t\t\t\tchainList.push([systems[x], parseInt(x) + 1, systems[x]]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0; i < chainList.length; i++) {\r\n\t\t\t\tfindLinks(chainList[i]);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t$(\"#chainError\").hide();\r\n\r\n\t\t\tvar row = {c: []};\r\n\t\t\tvar systemID = viewingSystemID;\r\n\r\n\t\t\trow.c.push(topLevel(systemID, 1), {v: null});\r\n\r\n\t\t\tchain.rows.push(row);\r\n\r\n\t\t\tvar chainList = [[systemID, 1]];\r\n\t\t\tvar chainData = map;\r\n\t\t\tvar chainLinks = [];\r\n\t\t\tvar usedLinks = [];\r\n\r\n\t\t\tfor (var i = 0; i < chainList.length; ++i) {\r\n\t\t\t\tfindLinks(chainList[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst systemsInChainMap = {};\r\n\t\tfor (var x in chainLinks) {\r\n\t\t\tvar node = chainLinks[x];\r\n\t\t\tvar row = {c: []};\r\n\t\t\t\r\n\t\t\tconst sigText = options.chain[\"node-reference\"] == \"id\" ? (node.child.signatureID ? node.child.signatureID.substring(0, 3) : \"???\") :\r\n\t\t\t\t\t(node.child.type || \"(?)\") + sigFormat(node.child.typeBM, \"type\");\r\n\t\t\tconst nodeTypeMarkup = node.child.path ? \r\n\t\t\t\tchainMap.renderPath(node.child.path) :\r\n\t\t\t\t\"<a href='#' onclick='openSignatureDialog({data: { signature: \" + node.child.sigIndex + \", mode: \\\"update\\\" }}); return false;'>\" + (\r\n\t\t\t\t\tnode.parent.name && options.chain.sigNameLocation == 'ref' ? node.parent.name :\r\n\t\t\t\t\tnode.parent.name && options.chain.sigNameLocation == 'ref_prefix' ? node.parent.name + ' - ' + sigText :\r\n\t\t\t\t\tsigText\r\n\t\t\t\t) + '</a>';\r\n\t\t\tconst additionalClasses = node.calculated ? ['calc'] : systemsInChainMap[node.child.systemID] ? [ 'loop' ] : [];\r\n\t\t\tconst child = makeSystemNode(node.child.systemID, node.child.id, node.id, node.child.sigIndex, node.parent.name, nodeTypeMarkup, additionalClasses);\r\n\r\n\t\t\tvar parent = {v: node.parent.id};\r\n\r\n\t\t\trow.c.push(child, parent);\r\n\t\t\tchain.rows.push(row);\r\n\t\t\t\r\n\t\t\tvar modifiers = [];\t\t\t\r\n\t\t\tif (node.life == \"critical\") { modifiers.push('eol'); }\r\n\t\t\tif (node.mass == \"critical\") { modifiers.push('critical'); }\r\n\t\t\telse if (node.mass == \"destab\") { modifiers.push('destab'); }\r\n\t\t\t\r\n\t\t\tif($.inArray(node.parent.type, frigTypes) != -1 || $.inArray(node.child.type, frigTypes) != -1) { modifiers.push('frig'); }\r\n\t\t\t\r\n\t\t\tif(modifiers.length) { connections.push(Array(child.v, parent.v, modifiers, node.id)); }\r\n\t\t\t\r\n\t\t\tif(!node.calculated) { systemsInChainMap[node.child.systemID] = row; }\t// store for loops\r\n\t\t}\r\n\r\n\t\t// Apply critical/destab line colors\r\n\t\tconnections.reverse(); // so we apply to outer systems first\r\n\r\n\t\t//this.data.map = chain;\r\n\t\t//this.data.lines = connections;\r\n\t\treturn {\"map\": chain, \"lines\": connections};\r\n\t}\r\n\r\n\tthis.renderPath = function(path) {\r\n\t\tif(path.length <= 1 || path.length > options.chain.routingLimit) { return '' + path.length - 1; }\r\n\t\telse {\r\n\t\t\tvar systemMarkup = path\r\n\t\t\t.slice(0, path.length - 1).reverse()\r\n\t\t\t.map(function(s) {\r\n\t\t\t\tvar system = appData.systems[30000000 + 1 * s];\r\n\t\t\t\tvar securityClass = system.security >= 0.45 ? 'hisec' :\r\n\t\t\t\t\tsystem.security >= 0.0 ? 'lowsec' :\r\n\t\t\t\t\t'nullsec';\r\n\t\t\t\treturn '<span class=\"' + securityClass + '\" data-tooltip=\"' + system.name + ' (' + system.security + ')\">&#x25a0</span>';\r\n\t\t\t});\r\n\t\t\tvar r = '<span class=\"path\">';\r\n\t\t\tfor(var i = 0; i < systemMarkup.length; i++) {\r\n\t\t\t\tif(i > 0 && 0 == i % 5) { r += '|'; }\r\n\t\t\t\t\r\n\t\t\t\tr += systemMarkup[i];\t\t\t\t \r\n\t\t\t}\r\n\t\t\treturn r + '</span>';\r\n\t\t}\r\n\t}\r\n\r\n\tthis.redraw = function() {\r\n\t\tthis.useRenderer(options.chain.renderer);\r\n\t\t\r\n\t\tvar data = $.extend(true, {}, this.data);\r\n\t\tdata.map = $.extend(true, {}, data.rawMap);\r\n\r\n\t\tthis.draw(data);\r\n\t}\r\n\t\r\n\tvar drawRetryTimer = null;\r\n\r\n\tthis.draw = function(data) {\r\n\t\tvar data = typeof(data) !== \"undefined\" ? data : {};\r\n\t\tclearTimeout(drawRetryTimer);\r\n\r\n\t\t// We need to make sure Google chart is ready and we have signature data for this system before we begin, otherwise delay\r\n\t\tif (!this.renderer.ready() || (Object.size(data.map) && !tripwire.client.signatures)) {\r\n\t\t\tdrawRetryTimer = setTimeout(function() { chain.draw(data) }, 100);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (data.map) {\r\n\t\t\tthis.drawing = true;\r\n\r\n\t\t\tthis.data.rawMap = $.extend(true, {}, data.map);\r\n\r\n\t\t\t// if (options.chain.active == null || (options.chain.tabs[options.chain.active] && options.chain.tabs[options.chain.active].evescout == false)) {\r\n\t\t\t// \tif (options.masks.active != \"273.0\") {\r\n\t\t\t// \t\tfor (var i in data.map) {\r\n\t\t\t// \t\t\tif (data.map[i].mask == \"273.0\") {\r\n\t\t\t// \t\t\t\tdelete data.map[i];\r\n\t\t\t// \t\t\t}\r\n\t\t\t// \t\t}\r\n\t\t\t// \t}\r\n\t\t\t// }\r\n\r\n\t\t\t// Sort so we keep the chain map order the same\r\n\t\t\tObject.sort(data.map, \"id\");\r\n\r\n\t\t\t$.extend(data, this.nodes(data.map)); // 250ms -> <100ms\r\n\t\t\t$.extend(this.data, data);\r\n\t\t\t\r\n\t\t\tconst collapsedSystems = options.chain.tabs[options.chain.active] ? (options.chain.tabs[options.chain.active].collapsed || []) : [];\r\n\r\n\t\t\tthis.renderer.draw(data.map, data.lines, collapsedSystems); // 150ms\r\n\t\t\t//this.map.draw(this.newView(data.map), this.options); // 150ms\r\n\r\n//\t\t\tthis.renderer.lines(data); // 300ms\r\n\t\t\tthis.grid(); // 4ms\r\n\r\n\t\t\t// Apply current system style\r\n\t\t\t$(\"#chainMap [data-nodeid='\"+viewingSystemID+\"']\").parent().addClass(\"currentNode\"); // 0.1ms\r\n\r\n\t\t\t// Remove old system effect tooltips and add current ones\r\n\t\t\tif (WormholeTypeToolTips.attachedElements && WormholeTypeToolTips.attachedElements.length > 0) {\r\n\t\t\t\tWormholeTypeToolTips.detach($(\"#chainMap .whEffect\"));\r\n\t\t\t}\r\n\t\t\tWormholeTypeToolTips.attach($(\"#chainMap .whEffect[data-icon]\")); // 0.30ms\r\n\t\t\tWormholeRouteToolTips.attach($(\"#chainMap .path span[data-tooltip]\"));\r\n\r\n\t\t\tthis.drawing = false;\r\n\t\t}\r\n\r\n\t\t// Gather latest system activity\r\n\t\tif (!this.data.activity || new Date() > this.data.activity.expires) {\r\n\t\t\tdata.activity = {};\r\n\t\t\ttripwire.esi.universeJumps()\r\n\t\t\t\t.done(function(results, status, request) {\r\n\t\t\t\t\tdata.activity.expires = new Date(request.getResponseHeader(\"expires\"));\r\n\t\t\t\t\t$.each(results, function(x) {\r\n\t\t\t\t\t\tdata.activity[results[x].system_id] = {\r\n\t\t\t\t\t\t\tsystemID: results[x].system_id,\r\n\t\t\t\t\t\t\tshipJumps: results[x].ship_jumps\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.then(function() {\r\n\t\t\t\t\t return tripwire.esi.universeKills()\r\n\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t$.each(results, function(x) {\r\n\t\t\t\t\t\t\t\tif (data.activity[results[x].system_id]) {\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id].podKills = results[x].pod_kills;\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id].shipKills = results[x].ship_kills;\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id].npcKills = results[x].npc_kills;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id] = {\r\n\t\t\t\t\t\t\t\t\t\tsystemID: results[x].system_id,\r\n\t\t\t\t\t\t\t\t\t\tpodKills: results[x].pod_kills,\r\n\t\t\t\t\t\t\t\t\t\tshipKills: results[x].ship_kills,\r\n\t\t\t\t\t\t\t\t\t\tnpcKills: results[x].npc_kills,\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.then(function() {\r\n\t\t\t\t\tchain.data.activity = chain.activity(data.activity);\r\n\t\t\t\t});\r\n\t\t} else if (data.map) {\r\n\t\t\tchain.activity(this.data.activity);\r\n\t\t}\r\n\r\n\t\tif (data.occupied) { // 3ms\r\n\t\t\tthis.data.occupied = this.occupied(data.occupied);\r\n\t\t}\r\n\r\n\t\tif (data.flares) { // 20ms\r\n\t\t\tthis.data.flares = this.flares(data.flares);\r\n\t\t}\r\n\t}\r\n\r\n\tthis.updateCollapsed = function(collapsedSystems) {\r\n\t\tif (options.chain.tabs[options.chain.active]) {\r\n\t\t\toptions.chain.tabs[options.chain.active].collapsed = collapsedSystems;\r\n\t\t}\r\n\t\t\r\n\t\t// Apply current system style\r\n\t\t$(\"#chainMap [data-nodeid='\"+viewingSystemID+\"']\").parent().addClass(\"currentNode\");\r\n\r\n\t\tif (WormholeTypeToolTips.attachedElements && WormholeTypeToolTips.attachedElements.length > 0) {\r\n\t\t\tWormholeTypeToolTips.detach($(\"#chainMap .whEffect\"));\r\n\t\t}\r\n\t\tWormholeTypeToolTips.attach($(\"#chainMap .whEffect[data-icon]\"));\r\n\r\n\t\tchain.activity(chain.data.activity);\r\n\r\n\t\tchain.occupied(chain.data.occupied);\r\n\r\n\t\tchain.flares(chain.data.flares);\r\n\r\n\t\tchain.grid();\r\n\r\n\t\toptions.save();\r\n\t}\r\n\r\n}\r\n","tripwire.active = function(data) {\r\n    var editSigs = [];\r\n    var editComments = [];\r\n\r\n    for (var x in data) {\r\n        var activity = JSON.parse(data[x].activity);\r\n        editSigs.push(parseInt(activity.editSig));\r\n        editComments.push(parseInt(activity.editComment));\r\n\r\n        if (activity.editSig) {\r\n            $(\"#sigTable tr[data-id='\"+activity.editSig+\"']\")\r\n                //.attr('data-tooltip', sig.editing)\r\n                //.attr(\"title\", sig.editing)\r\n                .addClass(\"editing\")\r\n                .find(\"td\")\r\n                .animate({backgroundColor: \"#001b47\"}, 1000); //35240A - Yellow\r\n        }\r\n\r\n        if (activity.editComment && $(\"#commentWrapper .comment[data-id='\"+activity.editComment+\"'] .cke\").length > 0) {\r\n            $(\"#commentWrapper .comment[data-id='\"+activity.editComment+\"']\")\r\n                .addClass(\"editing\")\r\n                .find(\".commentStatus\").html(data[x].characterName + \" is editing\").fadeIn();\r\n        }\r\n    }\r\n\r\n    $(\"#sigTable tr.editing\").each(function() {\r\n        if ($.inArray($(this).data(\"id\"), editSigs) == -1) {\r\n            $(\"#sigTable tr[data-id='\"+$(this).data(\"id\")+\"']\")\r\n                //.attr('data-tooltip', '')\r\n                //.removeAttr(\"title\")\r\n                .removeClass(\"editing\")\r\n                .find(\"td\")\r\n                .animate({backgroundColor: \"#111\"}, 1000, null, function() {$(this).css({backgroundColor: \"\"});});\r\n        }\r\n    });\r\n\r\n    $(\"#commentWrapper .editing\").each(function() {\r\n        if ($.inArray($(this).data(\"id\"), editComments) == -1) {\r\n            $(\"#commentWrapper .editing[data-id='\"+$(this).data(\"id\")+\"']\")\r\n                .removeClass(\"editing\")\r\n                .find(\".commentStatus\").fadeOut(function() {$(this).html(\"\")});\r\n        }\r\n    });\r\n}\r\n","// Hanldes adding to Signatures section\r\n// ToDo: Use native JS\r\ntripwire.addSig = function(add, option, disabled) {\r\n    var option = option || {};\r\n    var animate = typeof(option.animate) !== 'undefined' ? option.animate : true;\r\n    var disabled = disabled || false;\r\n    var wormhole = {};\r\n\r\n    if (add.type == \"wormhole\") {\r\n        var wormhole = Object.values(tripwire.client.wormholes).find(function (wh) { return wh.initialID == add.id || wh.secondaryID == add.id});\r\n        if (!wormhole) return false;\r\n        var otherSignature = add.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID];\r\n        if (!otherSignature) return false;\r\n\r\n        if (add.name) {\r\n          leadsTo = tripwire.systems[otherSignature.systemID] ? \"<a href='.?system=\"+tripwire.systems[otherSignature.systemID].name+\"'>\"+add.name+\"</a>\" : add.name;\r\n        } else if (tripwire.aSigSystems[otherSignature.systemID]) {\r\n            leadsTo = tripwire.aSigSystems[otherSignature.systemID];\r\n        } else if (tripwire.systems[otherSignature.systemID]) {\r\n            leadsTo = \"<a href='.?system=\"+tripwire.systems[otherSignature.systemID].name+\"'>\"+tripwire.systems[otherSignature.systemID].name+\"</a>\";\r\n        } else {\r\n            leadsTo = \"\";\r\n        }\r\n\r\n        var row = \"<tr data-id='\"+add.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+(add.signatureID ? add.signatureID.substring(0, 3)+\"-\"+(add.signatureID.substring(3, 6) || \"###\") : \"???-###\")+\"</td>\"\r\n            + \"<td class='type-tooltip \"+ options.signatures.alignment.sigType +\"' data-tooltip=\\\"\"+this.whTooltip(wormhole)+\"\\\">\"+(wormhole[wormhole.parent+\"ID\"] == add.id ? wormhole.type || \"\" : (wormhole.parent ? \"K162\" : \"\"))+\"</td>\"\r\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge + (parseInt(add.lifeLength) === 0 ? \" disabled\" : \"\") +\"' data-tooltip='\"+this.ageTooltip(add)+\"'><span data-age='\"+add.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"'>\"+(leadsTo || \"\")+\"</td>\"\r\n            + \"<td class='\"+wormhole.life+\" \"+ options.signatures.alignment.sigLife +\"'>\"+wormhole.life+\"</td>\"\r\n            + \"<td class='\"+wormhole.mass+\" \"+ options.signatures.alignment.sigMass +\"'>\"+wormhole.mass+\"</td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    } else {\r\n        var row = \"<tr data-id='\"+add.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+(add.signatureID ? add.signatureID.substring(0, 3)+\"-\"+(add.signatureID.substring(3, 6) || \"###\") : \"???-###\")+\"</td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigType +\"'>\"+add.type+\"</td>\"\r\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge + (parseInt(add.lifeLength) === 0 ? \" disabled\" : \"\") +\"' data-tooltip='\"+this.ageTooltip(add)+\"'><span data-age='\"+add.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"' colspan='3'>\"+(add.name?linkSig(add.name):'')+\"</td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    }\r\n\r\n    Tooltips.attach($(tr).find(\"[data-tooltip]\"));\r\n\r\n    $(\"#sigTable\").append(tr);\r\n\r\n    // Add counter\r\n    if (wormhole.life == \"critical\") {\r\n        $(tr).find('span[data-age]').countdown({until: moment.utc(add.lifeLeft).toDate(), onExpiry: this.pastEOL, alwaysExpire: true, compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime})\r\n            // .countdown('pause')\r\n            .addClass('critical')\r\n            // .countdown('resume');\r\n    } else {\r\n        $(tr).find('span[data-age]').countdown({since: moment.utc(add.lifeTime).toDate(), compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime});\r\n    }\r\n\r\n    if (animate) {\r\n        $(tr)\r\n            .find('td')\r\n            .wrapInner('<div class=\"hidden\" />')\r\n            .parent()\r\n            .find('td > div')\r\n            .slideDown(700, function(){\r\n                $set = $(this);\r\n                $set.replaceWith($set.contents());\r\n            });\r\n\r\n        $(tr).find(\"td\").animate({backgroundColor: \"#004D16\"}, 1000).delay(1000).animate({backgroundColor: \"#111\"}, 1000, null, function() {$(this).css({backgroundColor: \"\"});});\r\n    }\r\n}\r\n","// Handles API updates\r\ntripwire.API = function() {\r\n    this.indicator;\r\n    this.APIrefresh;\r\n\r\n    this.API.expire = function() {\r\n        var options = {since: tripwire.API.APIrefresh, until: null, format: \"MS\", layout: \"-{mnn}{sep}{snn}\"};\r\n        $(\"#APItimer\").countdown(\"option\", options);\r\n    }\r\n\r\n    this.API.refresh = function() {\r\n        $.ajax({\r\n            url: \"api_update.php\",\r\n            cache: false,\r\n            dataType: \"JSON\",\r\n            data: \"indicator=\"+tripwire.API.indicator\r\n        }).done(function(data) {\r\n            if (data && data.APIrefresh) {\r\n                tripwire.API.indicator = data.indicator;\r\n                tripwire.API.APIrefresh = new Date(data.APIrefresh);\r\n                activity.refresh(); //Refresh graph\r\n\r\n                var options = {until: tripwire.API.APIrefresh, since: null, layout: \"{mnn}{sep}{snn}\"};\r\n                $(\"#APItimer\").countdown(\"option\", options);\r\n                setTimeout(\"tripwire.API.refresh();\", $.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) - 30);\r\n            } else if ($(\"#APItimer\").countdown(\"option\", \"layout\") !== \"-{mnn}{sep}{snn}\" && $.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) > 120) {\r\n                setTimeout(\"tripwire.API.refresh();\", ($.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) - 30) * 1000);\r\n            } else {\r\n                setTimeout(\"tripwire.API.refresh();\", 15000);\r\n            }\r\n        });\r\n    }\r\n\r\n    this.API.init = function() {\r\n        $.ajax({\r\n            url: \"api_update.php\",\r\n            cache: true,\r\n            dataType: \"JSON\",\r\n            data: \"init=true\"\r\n        }).done(function(data) {\r\n            tripwire.API.indicator = data.indicator;\r\n            tripwire.API.APIrefresh = new Date(data.APIrefresh);\r\n\r\n            $(\"#APItimer\").countdown({until: tripwire.API.APIrefresh, onExpiry: tripwire.API.expire, alwaysExpire: true, compact: true, format: \"MS\", serverSync: tripwire.serverTime.getTime, onTick: function(t) { $(\"#APIclock\").val(t[5] + 1).trigger(\"change\"); }})\r\n            var timer = $(\"#APItimer\").countdown(\"option\", \"layout\") === \"-{mnn}{sep}{snn}\" ? 15 : $.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) - 30;\r\n            setTimeout(\"tripwire.API.refresh();\", timer * 1000);\r\n        });\r\n    }\r\n\r\n    this.API.init();\r\n}\r\n// tripwire.API();\r\n","tripwire.autoMapper = function(from, to) {\r\n    var pods = [33328, 670];\r\n    var undo = [];\r\n\r\n    // Convert from & to from system name to system ID for diagnostic testing\r\n    // from = viewingSystemID;\r\n    // to = Object.index(tripwire.systems, 'name', to);\r\n\r\n    // Make sure the automapper is turned on & not disabled\r\n    if (!$(\"#toggle-automapper\").hasClass(\"active\") || $(\"#toggle-automapper\").hasClass(\"disabled\"))\r\n        return false;\r\n\r\n    // Make sure from and to are valid systems\r\n    if (!tripwire.systems[from] || !tripwire.systems[to])\r\n        return false;\r\n\r\n    // Make sure from and to are not the same system\r\n    if (from == to)\r\n        return false;\r\n\r\n    // Is pilot in a station?\r\n    if (tripwire.client.EVE && tripwire.client.EVE.stationID)\r\n        return false;\r\n\r\n    // Is pilot in a pod?\r\n    if (tripwire.client.EVE && tripwire.client.EVE.shipTypeID && $.inArray(parseInt(tripwire.client.EVE.shipTypeID), pods) >= 0)\r\n         return false;\r\n\r\n    // Is this a gate?\r\n    if (typeof(tripwire.map.shortest[from - 30000000]) != \"undefined\" && typeof(tripwire.map.shortest[from - 30000000][to - 30000000]) != \"undefined\")\r\n        return false;\r\n\r\n     // Is this an existing connection?\r\n     if ($.map(tripwire.client.wormholes,\r\n               function(wormhole) {\r\n                 const initial = tripwire.client.signatures[wormhole.initialID];\r\n                 const secondary = tripwire.client.signatures[wormhole.secondaryID];\r\n                 return initial && secondary &&\r\n                   ((initial.systemID == from && secondary.systemID == to) ||\r\n                    (initial.systemID == to && secondary.systemID == from))  ? wormhole : null;\r\n               }).length > 0) {\r\n       return false;\r\n     }\r\n\r\n    var payload = {\"signatures\": {\"add\": [], \"update\": []}};\r\n    var sig, toClass;\r\n\r\n    if (tripwire.systems[to].class)\r\n        toClass = \"Class-\" + tripwire.systems[to].class;\r\n    else if (tripwire.systems[to].security >= 0.45)\r\n        toClass = \"High-Sec\";\r\n    else if (tripwire.systems[to].security > 0)\r\n        toClass = \"Low-Sec\";\r\n    else\r\n        toClass = \"Null-Sec\";\r\n\r\n    var wormholes = $.map(tripwire.client.wormholes, function(wormhole) {\r\n        // Find wormholes that have no set Leads To system, and their initial system is from the wormhole we just jumped from\r\n        if (tripwire.client.signatures[wormhole.initialID].systemID == from && !tripwire.systems[tripwire.client.signatures[wormhole.secondaryID].systemID]) {\r\n            if (tripwire.aSigSystems[tripwire.client.signatures[wormhole.secondaryID].systemID] == toClass) {\r\n                // Find wormholes that Leads To is generically set to the class we just jumped into\r\n                return wormhole;\r\n            } else if (wormhole.type && tripwire.wormholes[wormhole.type] && tripwire.wormholes[wormhole.type].leadsTo.replace(' ', '-') == toClass) {\r\n                // Find wormholes that Type is known to lead to the class we just jumped into\r\n                return wormhole;\r\n            } else if (tripwire.client.signatures[wormhole.secondaryID].systemID === null && (!wormhole.type || !tripwire.wormholes[wormhole.type])) {\r\n                // Find wormholes that don't have a Type or any kind of Leads To entered\r\n                return wormhole;\r\n            }\r\n        }\r\n    });\r\n\r\n    if (wormholes.length) {\r\n        if (wormholes.length > 1) {\r\n            $(\"#dialog-select-signature\").dialog({\r\n                autoOpen: true,\r\n                title: \"Which Signature?\",\r\n                width: 390,\r\n                buttons: {\r\n                    Cancel: function() {\r\n                        $(this).dialog(\"close\");\r\n                    },\r\n                    Ok: function() {\r\n                        var i = $(\"#dialog-select-signature [name=sig]:checked\").val();\r\n                        var wormhole = wormholes[i];\r\n                        var signature = tripwire.client.signatures[wormhole.initialID];\r\n                        var signature2 = tripwire.client.signatures[wormhole.secondaryID];\r\n\r\n                        payload.signatures.update.push({\r\n                            \"wormhole\": {\r\n                                \"id\": wormhole.id\r\n                            },\r\n                            \"signatures\": [\r\n                                {\r\n                                    \"id\": signature.id\r\n                                },\r\n                                {\r\n                                    \"id\": signature2.id,\r\n                                    \"systemID\": to\r\n                                }\r\n                            ]\r\n                        });\r\n\r\n                        var success = function(data) {\r\n                            if (data.resultSet && data.resultSet[0].result == true) {\r\n                                undo.push({\"wormhole\": wormhole, \"signatures\": [signature, signature2]});\r\n                                $(\"#dialog-select-signature\").dialog(\"close\");\r\n                            }\r\n                        }\r\n\r\n                        tripwire.refresh('refresh', payload, success);\r\n                    }\r\n                },\r\n                open: function() {\r\n                    $(\"#dialog-select-signature .optionsTable tbody\").empty();\r\n\r\n                    $.each(wormholes, function(i) {\r\n                        var signature = tripwire.client.signatures[wormholes[i].initialID];\r\n                        var signatureRow = $(\"#sigTable tr[data-id='\"+signature.id+\"']\").html();\r\n                        var tr = \"<tr>\"\r\n                          + \"<td><input type='radio' name='sig' value='\"+i+\"' id='sig\"+i+\"' /></td>\"\r\n                          + signatureRow\r\n                          + \"</tr>\";\r\n\r\n                        $(\"#dialog-select-signature .optionsTable tbody\").append(tr);\r\n                        $(\"#dialog-select-signature .optionsTable tbody td\").wrapInner(\"<label for='sig\"+i+\"' />\");\r\n                    });\r\n                }\r\n            });\r\n        } else {\r\n            var wormhole = wormholes[0];\r\n            var signature = tripwire.client.signatures[wormhole.initialID];\r\n            var signature2 = tripwire.client.signatures[wormhole.secondaryID];\r\n\r\n            payload.signatures.update.push({\r\n                \"wormhole\": {\r\n                    \"id\": wormhole.id\r\n                },\r\n                \"signatures\": [\r\n                    {\r\n                        \"id\": signature.id\r\n                    },\r\n                    {\r\n                        \"id\": signature2.id,\r\n                        \"systemID\": to\r\n                    }\r\n                ]\r\n            });\r\n            undo.push({\"wormhole\": wormhole, \"signatures\": [signature, signature2]});\r\n        }\r\n    } else {\r\n        // Nothing matches, create a new wormhole\r\n        payload.signatures.add.push({\r\n            \"wormhole\": {\r\n                \"type\": null,\r\n                \"parent\": \"initial\",\r\n                \"life\": \"stable\",\r\n                \"mass\": \"stable\"\r\n            },\r\n            \"signatures\": [\r\n                {\r\n                    \"systemID\": from,\r\n                    \"type\": \"wormhole\"\r\n                },\r\n                {\r\n                    \"systemID\": to,\r\n                    \"type\": \"wormhole\"\r\n                }\r\n            ]\r\n        });\r\n    }\r\n\r\n    if (payload.signatures.add.length || payload.signatures.update.length) {\r\n        var success = function(data) {\r\n            if (data.resultSet && data.resultSet[0].result == true) {\r\n                $(\"#undo\").removeClass(\"disabled\");\r\n\r\n                if (data.results) {\r\n                    if (viewingSystemID in tripwire.signatures.undo) {\r\n                        tripwire.signatures.undo[viewingSystemID].push({action: \"add\", signatures: data.results});\r\n                    } else {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{action: \"add\", signatures: data.results}];\r\n                    }\r\n                }\r\n\r\n                if (undo.length) {\r\n                    if (viewingSystemID in tripwire.signatures.undo) {\r\n                        tripwire.signatures.undo[viewingSystemID].push({action: \"update\", signatures: undo});\r\n                    } else {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{action: \"update\", signatures: undo}];\r\n                    }\r\n                }\r\n\r\n                sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n            }\r\n        }\r\n\r\n        tripwire.refresh('refresh', payload, success);\r\n    }\r\n}\r\n","$(\"body\").on(\"dblclick\", \".comment\", function(e) {\r\n\te.preventDefault();\r\n\tdocument.getSelection().removeAllRanges();\r\n\t$(this).find(\".commentEdit\").click();\r\n})\r\n\r\n$(\"body\").on(\"click\", \".commentEdit\", function(e) {\r\n\te.preventDefault();\r\n\r\n\t// Prevent multiple editors\r\n\tif ($(\".cke\").length) return false;\r\n\r\n\tvar $comment = $(this).closest(\".comment\");\r\n\r\n\t$comment.find(\".commentToolbar\").hide();\r\n\r\n\tCKEDITOR.replace($comment.find(\".commentBody\").attr(\"id\"), CKConfig).on(\"instanceReady\", function() {\r\n\t\t$comment.find(\".commentStatus\").html(\"\");\r\n\t\t$comment.find(\".commentFooter\").show();\r\n\t\t$comment.find(\".commentFooter .commentControls\").show();\r\n\t});\r\n\r\n\ttripwire.activity.editComment = $comment.data(\"id\");\r\n\ttripwire.refresh('refresh');\r\n});\r\n\r\n$(\"body\").on(\"click\", \".commentSave, .commentCancel\", function(e) {\r\n\te.preventDefault();\r\n\tvar $this = $(this);\r\n\tif ($this.attr(\"disabled\")) return false;\r\n\r\n\tvar $comment = $this.closest(\".comment\");\r\n\t$this.attr(\"disabled\", \"true\");\r\n\r\n\tif ($this.hasClass(\"commentSave\")) {\r\n\t\tvar data = {\"mode\": \"save\", \"commentID\": $comment.data(\"id\"), \"systemID\": $comment.find(\".commentSticky\").hasClass(\"active\") ? 0 : viewingSystemID, \"comment\": CKEDITOR.instances[$comment.find(\".commentBody\").attr(\"id\")].getData()};\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: \"comments.php\",\r\n\t\t\ttype: \"POST\",\r\n\t\t\tdata: data,\r\n\t\t\tdataType: \"JSON\"\r\n\t\t}).done(function(data) {\r\n\t\t\tif (data && data.result == true) {\r\n\t\t\t\t$comment.find(\".commentModified\").html(\"Edited by \" + data.comment.modifiedByName + \" at \" + data.comment.modifiedDate);\r\n\t\t\t\t$comment.find(\".commentCreated\").html(\"Posted by \" + data.comment.createdByName + \" at \" + data.comment.createdDate);\r\n\t\t\t\tTooltips.attach($comment.find(\"[data-tooltip]\"));\r\n\r\n\t\t\t\tCKEDITOR.instances[$comment.find(\".commentBody\").attr(\"id\")].destroy(false);\r\n\t\t\t\t$comment.attr(\"data-id\", data.comment.id);\r\n\t\t\t\t$comment.find(\".commentToolbar\").show();\r\n\t\t\t\t$comment.find(\".commentFooter\").hide();\r\n\t\t\t\t$this.removeAttr(\"disabled\");\r\n\t\t\t}\r\n\t\t});\r\n\t} else {\r\n\t\tCKEDITOR.instances[$comment.find(\".commentBody\").attr(\"id\")].destroy(true);\r\n\r\n\t\tif (!$comment.attr(\"data-id\")) {\r\n\t\t\t$comment.remove();\r\n\t\t} else {\r\n\t\t\t$comment.find(\".commentToolbar\").show();\r\n\t\t\t$comment.find(\".commentFooter\").hide();\r\n\t\t\t$this.removeAttr(\"disabled\");\r\n\t\t}\r\n\t}\r\n\r\n\t$comment.find(\".commentStatus\").html(\"\");\r\n\r\n\tdelete tripwire.activity.editComment;\r\n\ttripwire.refresh('refresh');\r\n});\r\n\r\n$(\"body\").on(\"click\", \".commentDelete\", function(e) {\r\n\te.preventDefault();\r\n\tvar $comment = $(this).closest(\".comment\");\r\n\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-deleteComment\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-deleteComment\").data(\"comment\", $comment).dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tposition: {my: \"center\", at: \"center\", of: $(\"#notesWidget\")},\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tDelete: function() {\r\n\t\t\t\t\t// Prevent duplicate submitting\r\n\t\t\t\t\t$(\"#dialog-deleteComment\").parent().find(\":button:contains('Delete')\").button(\"disable\");\r\n\r\n\t\t\t\t\tvar $comment = $(this).data(\"comment\");\r\n\t\t\t\t\tvar data = {\"mode\": \"delete\", \"commentID\": $comment.data(\"id\")};\r\n\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: \"comments.php\",\r\n\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\tdata: data,\r\n\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t}).done(function(data) {\r\n\t\t\t\t\t\tif (data && data.result == true) {\r\n\t\t\t\t\t\t\t$(\"#dialog-deleteComment\").dialog(\"close\");\r\n\t\t\t\t\t\t\t$comment.remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).always(function() {\r\n\t\t\t\t\t\t$(\"#dialog-deleteComment\").parent().find(\":button:contains('Delete')\").button(\"enable\");\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-deleteComment\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-deleteComment\").data(\"comment\", $comment).dialog(\"open\");\r\n\t}\r\n});\r\n\r\n$(\"body\").on(\"click\", \"#add-comment\", function(e) {\r\n\te.preventDefault();\r\n\r\n\t// Prevent multiple editors\r\n\tif ($(\".cke\").length) return false;\r\n\r\n\tvar $comment = $(\".comment:last\").clone();\r\n\tvar commentID = $(\".comment:visible:last .commentBody\").attr(\"id\") ? $(\".comment:visible:last .commentBody\").attr(\"id\").replace(\"comment\", \"\") + 1 : 0;\r\n\t$(\".comment:last\").before($comment);\r\n\r\n\t$comment.find(\".commentBody\").attr(\"id\", \"comment\" + commentID);\r\n\t$comment.removeClass(\"hidden\").find(\".commentEdit\").click();\r\n});\r\n\r\n$(\"body\").on(\"click\", \".commentSticky\", function(e) {\r\n\te.preventDefault();\r\n\tvar $comment = $(this).closest(\".comment\");\r\n\r\n\tvar data = {\"mode\": \"sticky\", \"commentID\": $comment.data(\"id\"), \"systemID\": $comment.find(\".commentSticky\").hasClass(\"active\") ? viewingSystemID : 0};\r\n\r\n\t$.ajax({\r\n\t\turl: \"comments.php\",\r\n\t\ttype: \"POST\",\r\n\t\tdata: data,\r\n\t\tdataType: \"JSON\"\r\n\t}).done(function(data) {\r\n\t\tif (data && data.result == true) {\r\n\t\t\t$comment.find(\".commentSticky\").hasClass(\"active\") ? $comment.find(\".commentSticky\").removeClass(\"active\") : $comment.find(\".commentSticky\").addClass(\"active\");\r\n\t\t}\r\n\t});\r\n});\r\n","// Handles removing from Signatures section\r\ntripwire.deleteSig = function(key) {\r\n    var tr = $(\"#sigTable tr[data-id='\"+key+\"']\");\r\n\r\n    //Append empty space to prevent non-coloring\r\n    $(tr).find('td:empty, a:empty').append(\"&nbsp;\");\r\n\r\n    $(tr)\r\n        .find('td')\r\n        .wrapInner('<div />')\r\n        .parent()\r\n        .find('td > div').animate({backgroundColor: \"#4D0000\"}, 1000).delay(1000).animate({backgroundColor: \"#111\"}, 1000)\r\n        .slideUp(700, function(){\r\n            // Remove countdown reference\r\n            $(tr).find('span[data-age]').countdown(\"destroy\");\r\n\r\n            $(this).parent().parent().remove();\r\n            $(\"#sigTable\").trigger(\"update\");\r\n        });\r\n}\r\n","// Handles changing Signatures section\r\n// ToDo: Use native JS\r\ntripwire.editSig = function(edit, disabled) {\r\n    var disabled = disabled || false;\r\n    var wormhole = {};\r\n\r\n    if (edit.type == \"wormhole\") {\r\n        var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == edit.id || wormhole.secondaryID == edit.id) return wormhole; })[0];\r\n        if (!wormhole) return false;\r\n        var otherSignature = edit.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID];\r\n        if (!otherSignature) return false;\r\n\r\n        if (edit.name) {\r\n          leadsTo = tripwire.systems[otherSignature.systemID] ? \"<a href='.?system=\"+tripwire.systems[otherSignature.systemID].name+\"'>\"+edit.name+\"</a>\" : edit.name;\r\n        } else if (tripwire.aSigSystems[otherSignature.systemID]) {\r\n            leadsTo = tripwire.aSigSystems[otherSignature.systemID];\r\n        } else if (tripwire.systems[otherSignature.systemID]) {\r\n            leadsTo = \"<a href='.?system=\"+tripwire.systems[otherSignature.systemID].name+\"'>\"+tripwire.systems[otherSignature.systemID].name+\"</a>\";\r\n        } else {\r\n            leadsTo = \"\";\r\n        }\r\n\r\n        var row = \"<tr data-id='\"+edit.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+(edit.signatureID ? edit.signatureID.substring(0, 3)+\"-\"+(edit.signatureID.substring(3, 6) || \"###\") : \"???-###\")+\"</td>\"\r\n            + \"<td class='type-tooltip \"+ options.signatures.alignment.sigType +\"' data-tooltip=\\\"\"+this.whTooltip(wormhole)+\"\\\">\"+(wormhole[wormhole.parent+\"ID\"] == edit.id ? wormhole.type || \"\" : (wormhole.parent ? \"K162\" : \"\"))+\"</td>\"\r\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge + (parseInt(edit.lifeLength) === 0 ? \" disabled\" : \"\") +\"' data-tooltip='\"+this.ageTooltip(edit)+\"'><span data-age='\"+edit.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"'>\"+(leadsTo || \"\")+\"</td>\"\r\n            + \"<td class='\"+wormhole.life+\" \"+ options.signatures.alignment.sigLife +\"'>\"+wormhole.life+\"</td>\"\r\n            + \"<td class='\"+wormhole.mass+\" \"+ options.signatures.alignment.sigMass +\"'>\"+wormhole.mass+\"</td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    } else {\r\n        var row = \"<tr data-id='\"+edit.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+(edit.signatureID ? edit.signatureID.substring(0, 3)+\"-\"+(edit.signatureID.substring(3, 6) || \"###\") : \"???-###\")+\"</td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigType +\"'>\"+edit.type+\"</td>\"\r\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge + (parseInt(edit.lifeLength) === 0 ? \" disabled\" : \"\") +\"' data-tooltip='\"+this.ageTooltip(edit)+\"'><span data-age='\"+edit.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"' colspan='3'>\"+(edit.name?linkSig(edit.name):'')+\"</td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    }\r\n\r\n    Tooltips.attach($(tr).find(\"[data-tooltip]\"));\r\n\r\n    // Destroy the pervious countdown to prevent errors on a non-existant DOM element\r\n    $(\"#sigTable tr[data-id='\"+edit.id+\"']\").find('span[data-age]').countdown(\"destroy\");\r\n    $(\"#sigTable tr[data-id='\"+edit.id+\"']\").replaceWith(tr);\r\n\r\n    $(\"#sigTable\").trigger(\"update\");\r\n    // Update counter\r\n    if (wormhole.life == \"critical\") {\r\n        $(tr).find('span[data-age]').countdown({until: moment.utc(edit.lifeLeft).toDate(), onExpiry: this.pastEOL, alwaysExpire: true, compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime})\r\n            .addClass('critical');\r\n    } else {\r\n        $(tr).find('span[data-age]').countdown({since: moment.utc(edit.lifeTime).toDate(), compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime});\r\n    }\r\n\r\n    $(tr).effect(\"pulsate\");\r\n}\r\n","tripwire.esi = function() {\r\n    var baseUrl = \"https://esi.evetech.net\";\r\n    var userAgent = \"Tripwire Client \" + tripwire.version + \" (\" + window.location.hostname + \") - \" + window.navigator.userAgent;\r\n    var locationTimer, shipTimer, onlineTimer;\r\n    this.esi.connection = true;\r\n    this.esi.characters = {};\r\n\r\n    var scopeError = function(characterID) {\r\n        $(\"#tracking .tracking-clone[data-characterid='\"+ characterID +\"']\").find(\".alert\").show();\r\n    }\r\n\t\r\n\tvar isExpired = function(tokenExpire) {\r\n\t\treturn moment.utc(tokenExpire).subtract(5, \"minutes\").isBefore(moment());\r\n\t}\r\n\t\r\n    this.esi.location = function() {\r\n        clearTimeout(locationTimer);\r\n\r\n        for (characterID in tripwire.esi.characters) {\r\n            var character = tripwire.esi.characters[characterID];\r\n\r\n            // Check for expiring token\r\n            if (isExpired(character.tokenExpire)) {\r\n                tripwire.data.esi = {\"expired\": true};\r\n                continue;\r\n            }\r\n\r\n            $.ajax({\r\n                url: baseUrl + \"/v1/characters/\"+ characterID +\"/location/?\" + $.param({\"token\": character.accessToken, \"user_agent\": userAgent}),\r\n                // headers: {\"Authorization\": \"Bearer \"+ character.accessToken, \"X-User-Agent\": userAgent},\r\n                type: \"GET\",\r\n                dataType: \"JSON\",\r\n                characterID: characterID\r\n            }).done(function(data, status, xhr) {\r\n                var character = tripwire.esi.characters[this.characterID];\r\n\r\n                if (character) {\r\n                    character.locationDate = moment(xhr.getResponseHeader(\"last-modified\"), \"ddd, DD MMMM YYYY HH:mm:ss\").format();\r\n\r\n                    if (character.systemID != data.solar_system_id) {\r\n                        character.systemID = data.solar_system_id || null;\r\n                        character.systemName = tripwire.systems[data.solar_system_id] ? tripwire.systems[data.solar_system_id].name : null;\r\n\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".system\").html(character.systemName || \"&nbsp;\");\r\n\r\n                        // Send to Tripwire server on next refresh call\r\n                        tripwire.data.tracking[this.characterID] = {\r\n                            characterID: character.characterID,\r\n                            characterName: character.characterName,\r\n                            systemID: character.systemID,\r\n                            systemName: character.systemName,\r\n                            stationID: character.stationID,\r\n                            stationName: character.stationName,\r\n                            shipID: character.shipID,\r\n                            shipName: character.shipName,\r\n                            shipTypeID: character.shipTypeID,\r\n                            shipTypeName: character.shipTypeName};\r\n                    }\r\n\r\n                    if (character.stationID != data.station_id) {\r\n                        character.stationID = data.station_id || null;\r\n\r\n                        if (data.station_id) {\r\n                            tripwire.esi.stationLookup(data.station_id, this.characterID)\r\n                                .always(function(data) {\r\n                                    var character = tripwire.esi.characters[this.reference];\r\n\r\n                                    character.stationName = data.name || null;\r\n                                    $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference +\"']\").find(\".station\").html(data.name.substring(0, 17) + \"...\" || \"&nbsp;\").attr(\"data-tooltip\", data.name);\r\n                                    Tooltips.attach($(\"#tracking .tracking-clone[data-characterid='\"+ this.reference +\"'] .station[data-tooltip]\"));\r\n\r\n                                    // Send to Tripwire server on next refresh call\r\n                                    tripwire.data.tracking[this.reference] = {\r\n                                        characterID: character.characterID,\r\n                                        characterName: character.characterName,\r\n                                        systemID: character.systemID,\r\n                                        systemName: character.systemName,\r\n                                        stationID: character.stationID,\r\n                                        stationName: character.stationName,\r\n                                        shipID: character.shipID,\r\n                                        shipName: character.shipName,\r\n                                        shipTypeID: character.shipTypeID,\r\n                                        shipTypeName: character.shipTypeName};\r\n                                });\r\n                        } else {\r\n                            character.stationName = null;\r\n                            // $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".station\").html(\"&nbsp;\").attr(\"data-tooltip\", \"&nbsp;\");\r\n                            Tooltips.detach($(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"'] .station[data-tooltip]\"));\r\n\r\n                            // Send to Tripwire server on next refresh call\r\n                            tripwire.data.tracking[this.characterID] = {\r\n                                characterID: character.characterID,\r\n                                characterName: character.characterName,\r\n                                systemID: character.systemID,\r\n                                systemName: character.systemName,\r\n                                stationID: character.stationID,\r\n                                stationName: character.stationName,\r\n                                shipID: character.shipID,\r\n                                shipName: character.shipName,\r\n                                shipTypeID: character.shipTypeID,\r\n                                shipTypeName: character.shipTypeName};\r\n                        }\r\n                    }\r\n\r\n                    if (options.tracking.active == this.characterID) {\r\n                        tripwire.EVE(tripwire.esi.characters[options.tracking.active]);\r\n                    }\r\n                }\r\n            }).fail(function(data) {\r\n                if (data.status == 403) {\r\n                    tripwire.refresh(\"refresh\", {\"esi\": {\"expired\": true}});\r\n                }\r\n            }).always(function(data, status, xhr) {\r\n                if (status != \"success\" && status != \"abort\" && tripwire.esi.connection == true) {\r\n                    tripwire.esi.connection = false;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Failed\", \"red\", false, \"esiConnectionError\");\r\n                } else if (status == \"success\" && tripwire.esi.connection == false) {\r\n                    tripwire.esi.connection = true;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Resumed\", \"green\", 5000, \"esiConnectionSuccess\");\r\n                }\r\n\r\n                var headers = parseHeaders(xhr.getAllResponseHeaders());\r\n                if (headers.warning) {\r\n                  console.log('ESI API Warning: ', headers.warning, this.url);\r\n                }\r\n            });\r\n        }\r\n\r\n        locationTimer = setTimeout(\"tripwire.esi.location()\", 5000);\r\n    }\r\n\r\n    this.esi.ship = function() {\r\n        clearTimeout(shipTimer);\r\n\r\n        for (characterID in tripwire.esi.characters) {\r\n            var character = tripwire.esi.characters[characterID];\r\n\r\n            // Check for expiring token\r\n            if (isExpired(character.tokenExpire)) {\r\n                tripwire.data.esi = {\"expired\": true};\r\n                continue;\r\n            }\r\n\r\n            $.ajax({\r\n                url: baseUrl + \"/v1/characters/\"+ characterID +\"/ship/?\" + $.param({\"token\": character.accessToken, \"user_agent\": userAgent}),\r\n                // headers: {\"Authorization\": \"Bearer \"+ character.accessToken, \"X-User-Agent\": userAgent},\r\n                type: \"GET\",\r\n                dataType: \"JSON\",\r\n                characterID: characterID\r\n            }).done(function(data, status, xhr) {\r\n                var character = tripwire.esi.characters[this.characterID];\r\n\r\n                if (character) {\r\n                    character.shipDate = moment(xhr.getResponseHeader(\"last-modified\"), \"ddd, DD MMMM YYYY HH:mm:ss\").format();\r\n\r\n                    if (character.shipID != data.ship_item_id) {\r\n                        character.shipID = data.ship_item_id || null;\r\n\r\n                        // Send to Tripwire server on next refresh call\r\n                        tripwire.data.tracking[this.characterID] = {\r\n                            characterID: character.characterID,\r\n                            characterName: character.characterName,\r\n                            systemID: character.systemID,\r\n                            systemName: character.systemName,\r\n                            stationID: character.stationID,\r\n                            stationName: character.stationName,\r\n                            shipID: character.shipID,\r\n                            shipName: character.shipName,\r\n                            shipTypeID: character.shipTypeID,\r\n                            shipTypeName: character.shipTypeName};\r\n                    }\r\n\r\n                    if (character.shipName != data.ship_name) {\r\n                        character.shipName = data.ship_name || null;\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".shipname\").html(data.ship_name || \"&nbsp;\");\r\n\r\n                        // Send to Tripwire server on next refresh call\r\n                        tripwire.data.tracking[this.characterID] = {\r\n                            characterID: character.characterID,\r\n                            characterName: character.characterName,\r\n                            systemID: character.systemID,\r\n                            systemName: character.systemName,\r\n                            stationID: character.stationID,\r\n                            stationName: character.stationName,\r\n                            shipID: character.shipID,\r\n                            shipName: character.shipName,\r\n                            shipTypeID: character.shipTypeID,\r\n                            shipTypeName: character.shipTypeName};\r\n                    }\r\n\r\n                    if (character.shipTypeID != data.ship_type_id) {\r\n                        character.shipTypeID = data.ship_type_id || null;\r\n\r\n                        if (data.ship_type_id) {\r\n                            tripwire.esi.typeLookup(data.ship_type_id, this.characterID)\r\n                                .always(function(data) {\r\n                                    var character = tripwire.esi.characters[this.reference];\r\n\r\n                                    character.shipTypeName = data.name || null;\r\n                                    $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference +\"']\").find(\".ship\").html(data.name || \"&nbsp;\");\r\n\r\n                                    // Send to Tripwire server on next refresh call\r\n                                    tripwire.data.tracking[this.reference] = {\r\n                                        characterID: character.characterID,\r\n                                        characterName: character.characterName,\r\n                                        systemID: character.systemID,\r\n                                        systemName: character.systemName,\r\n                                        stationID: character.stationID,\r\n                                        stationName: character.stationName,\r\n                                        shipID: character.shipID,\r\n                                        shipName: character.shipName,\r\n                                        shipTypeID: character.shipTypeID,\r\n                                        shipTypeName: character.shipTypeName};\r\n                                });\r\n                        } else {\r\n                            character.shipTypeName = null;\r\n                            $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".ship\").html(\"&nbsp;\");\r\n\r\n                            // Send to Tripwire server on next refresh call\r\n                            tripwire.data.tracking[this.characterID] = {\r\n                                characterID: character.characterID,\r\n                                characterName: character.characterName,\r\n                                systemID: character.systemID,\r\n                                systemName: character.systemName,\r\n                                stationID: character.stationID,\r\n                                stationName: character.stationName,\r\n                                shipID: character.shipID,\r\n                                shipName: character.shipName,\r\n                                shipTypeID: character.shipTypeID,\r\n                                shipTypeName: character.shipTypeName};\r\n                        }\r\n                    }\r\n                }\r\n            }).fail(function(data) {\r\n                if (data.status == 403) {\r\n                    tripwire.refresh(\"refresh\", {\"esi\": {\"expired\": true}});\r\n                }\r\n            }).always(function(data, status, xhr) {\r\n                if (status != \"success\" && status != \"abort\" && tripwire.esi.connection == true) {\r\n                    tripwire.esi.connection = false;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Failed\", \"red\", false, \"esiConnectionError\");\r\n                } else if (status == \"success\" && tripwire.esi.connection == false) {\r\n                    tripwire.esi.connection = true;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Resumed\", \"green\", 5000, \"esiConnectionSuccess\");\r\n                }\r\n\r\n                var headers = parseHeaders(xhr.getAllResponseHeaders());\r\n                if (headers.warning) {\r\n                  console.log('ESI API Warning: ', headers.warning, this.url);\r\n                }\r\n            });\r\n        }\r\n\r\n        shipTimer = setTimeout(\"tripwire.esi.ship()\", 5000);\r\n    }\r\n\r\n    this.esi.online = function() {\r\n        clearTimeout(onlineTimer);\r\n\r\n        for (characterID in tripwire.esi.characters) {\r\n            var character = tripwire.esi.characters[characterID];\r\n\r\n            tripwire.esi.characterStatus(character.characterID, character)\r\n                .done(function(data) {\r\n                    if (data.online) {\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference.characterID +\"']\").find(\".online\").removeClass(\"critical\").addClass(\"stable\");\r\n                    } else {\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference.characterID +\"']\").find(\".online\").removeClass(\"stable\").addClass(\"critical\");\r\n                    }\r\n                }).fail(function(data) {\r\n                    if (data && data.status == 403) {\r\n                        scopeError(this.reference.characterID);\r\n                    }\r\n                    $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference.characterID +\"']\").find(\".online\").removeClass(\"stable\").addClass(\"critical\");\r\n                });\r\n        }\r\n\r\n        onlineTimer = setTimeout(\"tripwire.esi.online()\", 60000);\r\n    }\r\n\r\n    this.esi.typeLookup = function(typeID, reference) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v3/universe/types/\"+ typeID +\"/?\" + $.param({\"user_agent\": userAgent}),\r\n            // headers: {\"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            reference: reference\r\n        }).always(function(results, status, xhr) {\r\n          var headers = parseHeaders(xhr.getAllResponseHeaders());\r\n          if (headers.warning) {\r\n            console.log('ESI API Warning: ', headers.warning, this.url);\r\n          }\r\n        });\r\n    }\r\n\r\n    this.esi.stationLookup = function(stationID, reference) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/universe/stations/\"+ stationID +\"/?\" + $.param({\"user_agent\": userAgent}),\r\n            // headers: {\"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            reference: reference\r\n        }).always(function(results, status, xhr) {\r\n          var headers = parseHeaders(xhr.getAllResponseHeaders());\r\n          if (headers.warning) {\r\n            console.log('ESI API Warning: ', headers.warning, this.url);\r\n          }\r\n        });\r\n    }\r\n\r\n    this.esi.setDestination = function(destinationID, characterID, clear_waypoints, beginning) {\r\n        clear_waypoints = clear_waypoints ? clear_waypoints : false;\r\n        beginning = beginning ? beginning : false;\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/ui/autopilot/waypoint/?\" + $.param({destination_id: destinationID, clear_other_waypoints: clear_waypoints, add_to_beginning: beginning}),\r\n            headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.characters[characterID].accessToken, \"X-User-Agent\": userAgent},\r\n            type: \"POST\",\r\n            dataType: \"JSON\"\r\n        }).always(function(results, status, xhr) {\r\n          var headers = parseHeaders(xhr.getAllResponseHeaders());\r\n          if (headers.warning) {\r\n            console.log('ESI API Warning: ', headers.warning, this.url);\r\n          }\r\n        });\r\n    }\r\n\r\n    this.esi.showInfo = function(targetID, characterID) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v1/ui/openwindow/information/?\" + $.param({target_id: targetID}),\r\n            headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.characters[characterID].accessToken, \"X-User-Agent\": userAgent},\r\n            type: \"POST\",\r\n            dataType: \"JSON\"\r\n        }).always(function(results, status, xhr) {\r\n          var headers = parseHeaders(xhr.getAllResponseHeaders());\r\n          if (headers.warning) {\r\n            console.log('ESI API Warning: ', headers.warning, this.url);\r\n          }\r\n        });\r\n    }\r\n\r\n    this.esi.characterStatus = function(characterID, reference) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/characters/\" + characterID + \"/online/?\" + $.param({\"token\": tripwire.esi.characters[characterID].accessToken, \"user_agent\": userAgent}),\r\n            // headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.characters[characterID].accessToken, \"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            reference: reference\r\n        }).always(function(results, status, xhr) {\r\n          var headers = parseHeaders(xhr.getAllResponseHeaders());\r\n          if (headers.warning) {\r\n            console.log('ESI API Warning: ', headers.warning, this.url);\r\n          }\r\n        });\r\n    }\r\n\r\n    this.esi.eveStatus = function() {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v1/status/?\" + $.param({\"user_agent\": userAgent}),\r\n            // headers: {\"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\"\r\n        }).always(function(results, status, xhr) {\r\n          var headers = parseHeaders(xhr.getAllResponseHeaders());\r\n          if (headers.warning) {\r\n            console.log('ESI API Warning: ', headers.warning, this.url);\r\n          }\r\n        });\r\n    }\r\n\r\n    this.esi.idLookup = function(eveIDs) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/universe/names/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"POST\",\r\n            dataType: \"JSON\",\r\n            contentType: \"application/json\",\r\n            processData: false,\r\n            data: JSON.stringify(eveIDs)\r\n        }).always(function(results, status, xhr) {\r\n          var headers = parseHeaders(xhr.getAllResponseHeaders());\r\n          if (headers.warning) {\r\n            console.log('ESI API Warning: ', headers.warning, this.url);\r\n          }\r\n        });\r\n    }\r\n\r\n    this.esi.characterLookup = function(eveID, reference, async) {\r\n        var async = typeof(async) !== 'undefined' ? async : true;\r\n        return $.ajax({\r\n            url: baseUrl + \"/v4/characters/\" + eveID + \"/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            async: async,\r\n            eveID: eveID,\r\n            reference: reference\r\n        }).always(function(results, status, xhr) {\r\n          var headers = parseHeaders(xhr.getAllResponseHeaders());\r\n          if (headers.warning) {\r\n            console.log('ESI API Warning: ', headers.warning, this.url);\r\n          }\r\n        });\r\n    }\r\n\r\n    this.esi.corporationLookup = function(eveID, reference, async) {\r\n        var async = typeof(async) !== 'undefined' ? async : true;\r\n        return $.ajax({\r\n            url: baseUrl + \"/v4/corporations/\" + eveID + \"/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            async: async,\r\n            eveID: eveID,\r\n            reference: reference\r\n        }).always(function(results, status, xhr) {\r\n          var headers = parseHeaders(xhr.getAllResponseHeaders());\r\n          if (headers.warning) {\r\n            console.log('ESI API Warning: ', headers.warning, this.url);\r\n          }\r\n        });\r\n    }\r\n\r\n    this.esi.allianceLookup = function(eveID, reference, async) {\r\n        var async = typeof(async) !== 'undefined' ? async : true;\r\n        return $.ajax({\r\n            url: baseUrl + \"/v3/alliances/\" + eveID + \"/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            async: async,\r\n            eveID: eveID,\r\n            reference: reference\r\n        }).always(function(results, status, xhr) {\r\n          var headers = parseHeaders(xhr.getAllResponseHeaders());\r\n          if (headers.warning) {\r\n            console.log('ESI API Warning: ', headers.warning, this.url);\r\n          }\r\n        });\r\n    }\r\n\r\n    this.esi.search = function(searchString, categories, strict) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/search/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            contentType: \"application/json\",\r\n            data: {\"search\": searchString, \"categories\": categories, \"strict\": strict}\r\n        }).always(function(results, status, xhr) {\r\n          var headers = parseHeaders(xhr.getAllResponseHeaders());\r\n          if (headers.warning) {\r\n            console.log('ESI API Warning: ', headers.warning, this.url);\r\n          }\r\n        });\r\n    }\r\n\r\n    this.esi.universeJumps = function() {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v1/universe/system_jumps/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\"\r\n        }).always(function(results, status, xhr) {\r\n          var headers = parseHeaders(xhr.getAllResponseHeaders());\r\n          if (headers.warning) {\r\n            console.log('ESI API Warning: ', headers.warning, this.url);\r\n          }\r\n        });\r\n    }\r\n\r\n    this.esi.universeKills = function() {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/universe/system_kills/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\"\r\n        }).always(function(results, status, xhr) {\r\n          var headers = parseHeaders(xhr.getAllResponseHeaders());\r\n          if (headers.warning) {\r\n            console.log('ESI API Warning: ', headers.warning, this.url);\r\n          }\r\n        });\r\n    }\r\n\r\n    // Wrapper to make lookups easier\r\n    this.esi.fullLookup = function(eveIDs) {\r\n        var promise = $.Deferred();\r\n\r\n        tripwire.esi.idLookup(eveIDs)\r\n            .done(function(data) {\r\n                for (item in data) {\r\n                    if (data[item].category == \"character\") {\r\n                        tripwire.esi.characterLookup(data[item].id, data[item], false)\r\n                            .done(function(characterData) {\r\n                                $.extend(data[item], characterData);\r\n                                tripwire.esi.corporationLookup(characterData.corporation_id, this.reference, false)\r\n                                    .done(function(corporationData) {\r\n                                        data[item].corporation = corporationData;\r\n                                        if (corporationData.alliance_id) {\r\n                                            tripwire.esi.allianceLookup(corporationData.alliance_id, this.reference, false)\r\n                                                .done(function(allianceData) {\r\n                                                    data[item].alliance = allianceData;\r\n                                                });\r\n                                        }\r\n                                    });\r\n                            });\r\n                    } else if (data[item].category == \"corporation\") {\r\n                        tripwire.esi.corporationLookup(data[item].id, data[item], false)\r\n                            .done(function(corporationData) {\r\n                                $.extend(data[item], corporationData);\r\n                                if (corporationData.alliance_id) {\r\n                                    tripwire.esi.allianceLookup(corporationData.alliance_id, this.reference, false)\r\n                                        .done(function(allianceData) {\r\n                                            data[item].alliance = allianceData;\r\n                                        });\r\n                                }\r\n                            })\r\n                    }\r\n                }\r\n\r\n                promise.resolve(data);\r\n            });\r\n\r\n        return promise;\r\n    }\r\n\r\n    this.esi.parse = function(characters) {\r\n        for (characterID in tripwire.esi.characters) {\r\n            if (!(characterID in characters)) {\r\n                delete tripwire.esi.characters[characterID];\r\n                $(\"#tracking .tracking-clone[data-characterid='\"+ characterID +\"']\").remove();\r\n                if (options.tracking.active == characterID) {\r\n                    tripwire.EVE(false, true);\r\n                    $(\"#removeESI\").attr(\"disabled\", \"disabled\");\r\n                }\r\n            }\r\n        }\r\n\r\n        for (characterID in characters) {\r\n            if (options.tracking.active == \"new\") {\r\n                options.tracking.active = characterID;\r\n            }\r\n\r\n            if (!(characterID in tripwire.esi.characters)) {\r\n                var $clone = $(\"#tracking-clone\").clone();\r\n                $clone.attr(\"data-characterid\", characterID);\r\n                $clone.find(\".avatar img\").attr(\"src\", \"https://image.eveonline.com/Character/\"+ characterID +\"_32.jpg\");\r\n                $clone.find(\".name\").html(characters[characterID].characterName);\r\n                $clone.removeAttr(\"id\");\r\n                $clone.removeClass(\"hidden\");\r\n                $clone.addClass(\"tracking-clone\");\r\n\r\n                if (options.tracking.active == characterID) {\r\n                    $clone.addClass(\"active\");\r\n                    $(\"#removeESI\").removeAttr(\"disabled\");\t\t\t\t}\r\n\r\n                $(\"#tracking\").append($clone);\r\n                // Tooltips.attach($clone.find(\"[data-tooltip]\"));\r\n            }\r\n\r\n            tripwire.esi.characters[characterID] = characters[characterID];\r\n        }\r\n\r\n        tripwire.esi.ship();\r\n        tripwire.esi.location();\r\n        tripwire.esi.online();\r\n    }\r\n}\r\ntripwire.esi();\r\n","// Handles data from EVE in-game data\r\ntripwire.EVE = function(EVE, characterChange) {\r\n    var systemChange = this.client.EVE && this.client.EVE.systemChange || false;\r\n\r\n    if (EVE) {\r\n        // Automapper\r\n        if (!characterChange) {\r\n            // Did the system change or did it previously and we have yet to try an autoMapper call?\r\n            if ((this.client.EVE && this.client.EVE.systemID != EVE.systemID) || systemChange == true) {\r\n                systemChange = true;\r\n\r\n                // Check if location was updated after the last ship update\r\n                // if (moment(EVE.locationDate).isAfter(moment(this.client.EVE.shipDate))) {\r\n                    systemChange = false;\r\n                    tripwire.autoMapper(this.client.EVE.systemID, EVE.systemID);\r\n                // }\r\n            }\r\n        }\r\n\r\n        // System follower\r\n        if (!characterChange && options.buttons.follow && (this.client.EVE && this.client.EVE.systemID != EVE.systemID) && $(\".ui-dialog:visible\").length == 0) {\r\n            tripwire.systemChange(EVE.systemID);\r\n        }\r\n\r\n        if (!$(\"#search\").hasClass(\"active\")) {\r\n            $(\"#currentSpan\").show();\r\n        }\r\n\r\n        // Enable auto-mapper\r\n        $(\"#toggle-automapper\").removeClass(\"disabled\");\r\n\r\n        // Update current system\r\n        if (EVE.systemID) {\r\n            // add system to Leads To dropdown\r\n            if ($(\"#dialog-signature [data-autocomplete='sigSystems']\").hasClass(\"custom-combobox\")) {\r\n                $(\"#dialog-signature [data-autocomplete='sigSystems']\").inlinecomplete(\"removeFromSelect\");\r\n                $(\"#dialog-signature [data-autocomplete='sigSystems']\").inlinecomplete(\"addToSelect\", tripwire.systems[EVE.systemID].name);\r\n            }\r\n            $(\"#EVEsystem\").html(tripwire.systems[EVE.systemID].name).attr(\"href\", \".?system=\"+ tripwire.systems[EVE.systemID].name);\r\n        }\r\n    } else {\r\n        // Update current system\r\n        $(\"#EVEsystem\").html(\"\");\r\n        $(\"#currentSpan\").hide();\r\n        // Disable automapper\r\n        $(\"#toggle-automapper\").addClass(\"disabled\");\r\n        // remove system from Leads To dropdown\r\n        if ($(\"#dialog-signature [data-autocomplete='sigSystems']\").hasClass(\"custom-combobox\")) {\r\n            $(\"#dialog-signature [data-autocomplete='sigSystems']\").inlinecomplete(\"removeFromSelect\");\r\n        }\r\n    }\r\n\r\n    this.client.EVE = {\r\n        characterID: EVE.characterID,\r\n        characterName: EVE.characterName,\r\n        systemID: EVE.systemID,\r\n        systemName: EVE.systemName,\r\n        shipTypeID: EVE.shipTypeID,\r\n        shipTypeName: EVE.shipTypeName,\r\n        stationID: EVE.stationID,\r\n        stationName: EVE.stationName,\r\n        locationDate: EVE.locationDate,\r\n        shipDate: EVE.shipDate,\r\n        systemChange: systemChange\r\n    };\r\n}\r\n","tripwire.parse = function(server, mode) {\r\n    var data = $.extend(true, {}, server);\r\n\r\n    var updateSignatureTable = false;\r\n\r\n    if (options.chain.active == null || (options.chain.tabs[options.chain.active] && options.chain.tabs[options.chain.active].evescout != true)) {\r\n        if (options.masks.active != \"273.0\") {\r\n            for (var key in data.signatures) {\r\n                if (data.signatures[key].mask == \"273.0\") {\r\n                    delete data.signatures[key];\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    if (mode == 'refresh') {\r\n        // preserve client.EVE across refresh otherwise tracking/automapper will be confused\r\n        var EVE = this.client.EVE;\r\n        this.client = server;\r\n        this.client.EVE = EVE;\r\n\r\n        for (var key in data.signatures) {\r\n            if (data.signatures[key].systemID != viewingSystemID) {\r\n                continue;\r\n            }\r\n            var disabled = data.signatures[key].mask == \"273.0\" && options.masks.active != \"273.0\" ? true : false;\r\n\r\n            // Check for differences\r\n            if (!tripwire.signatures.list[key]) {\r\n                this.addSig(data.signatures[key], {animate: true}, disabled);\r\n                updateSignatureTable = true;\r\n            } else if (tripwire.signatures.list[key].modifiedTime !== data.signatures[key].modifiedTime) {\r\n                var edit = false;\r\n                for (column in data.signatures[key]) {\r\n                    if (data.signatures[key][column] != tripwire.signatures.list[key][column] && column != \"editing\") {\r\n                        edit = true;\r\n                    }\r\n                }\r\n\r\n                if (edit) {\r\n                    this.editSig(data.signatures[key], disabled);\r\n                } else {\r\n                    // this.sigEditing(data.signatures[key]);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Sigs needing removal\r\n        for (var key in tripwire.signatures.list) {\r\n            if (!data.signatures[key]) {\r\n                this.deleteSig(key);\r\n            }\r\n        }\r\n    } else if (mode == 'init' || mode == 'change') {\r\n        this.client = server;\r\n\r\n        for (var key in data.signatures) {\r\n            if (data.signatures[key].systemID != viewingSystemID) {\r\n                continue;\r\n            }\r\n            var disabled = data.signatures[key].mask == \"273.0\" && options.masks.active != \"273.0\" ? true : false;\r\n\r\n            this.addSig(data.signatures[key], {animate: false}, disabled);\r\n            updateSignatureTable = true;\r\n\r\n            if (data.signatures[key].editing) {\r\n                this.sigEditing(data.signatures[key]);\r\n            }\r\n        }\r\n    }\r\n\r\n    if (updateSignatureTable) {\r\n        $(\"#sigTable\").trigger(\"update\");\r\n    }\r\n    tripwire.signatures.list = data.signatures;\r\n\r\n    // set the sig count in the UI\r\n    var signatureCount = 0;\r\n    $.map(data.signatures, function(signature) {signature.systemID == viewingSystemID ? signatureCount++ : null;});\r\n    $(\"#signature-count\").html(signatureCount);\r\n}\r\n","// Handles pasting sigs from EVE\r\ntripwire.pasteSignatures = function() {\r\n    var processing = false;\r\n\r\n    var rowParse = function(row) {\r\n        var scanner = {};\r\n        var columns = row.split(\"\t\"); // Split by tab\r\n        var validScanGroups = [\"Cosmic Signature\", \"Cosmic Anomaly\", \"Kosmische Anomalie\", \"Kosmische Signatur\",\r\n                                \"Скрытый сигнал\", \"Космическая аномалия\", \"코즈믹 시그니처\", \"코즈믹 어노말리\"];\r\n        var validTypes = {\"Gas Site\": \"Gas\", \"Data Site\": \"Data\", \"Relic Site\": \"Relic\", \"Ore Site\": \"Ore\", \"Combat Site\": \"Combat\", \"Wormhole\": \"Wormhole\",\r\n                            \"Gasgebiet\": \"Gas\", \"Datengebiet\": \"Data\", \"Reliktgebiet\": \"Relic\", \"Mineraliengebiet\": \"Ore\", \"Kampfgebiet\": \"Combat\", \"Wurmloch\": \"Wormhole\",\r\n                            \"Газовый район\": \"Gas\", \"Информационный район\": \"Data\", \"Археологический район\": \"Relic\", \"Астероидный район\": \"Ore\", \"Боевой район\": \"Combat\", \"Червоточина\": \"Wormhole\", \r\n                            \"가스 사이트\": \"Gas\", \"데이터 사이트\": \"Data\", \"유물 사이트\": \"Relic\", \"채광 사이트\": \"Ore\", \"전투 사이트\": \"Combat\", \"웜홀\": \"Wormhole\"};\r\n\r\n        for (var x in columns) {\r\n            if (columns[x].match(/^([A-Z]{3}[-]\\d{3})$/)) {\r\n                scanner.id = columns[x].split(\"-\");\r\n                continue;\r\n            }\r\n\r\n            if (columns[x].match(/(\\d([.|,]\\d)?[ ]?(%))/) || columns[x].match(/(\\d[.|,]?\\d+\\s(AU|AE|km|m|а.е.|км|м))/i)) { // Exclude scan % || AU\r\n                continue;\r\n            }\r\n\r\n            if ($.inArray(columns[x], validScanGroups) != -1) {\r\n                scanner.scanGroup = columns[x];\r\n                continue;\r\n            }\r\n\r\n            if (validTypes[columns[x]]) {\r\n                scanner.type = validTypes[columns[x]];\r\n                continue;\r\n            }\r\n\r\n            if (columns[x] != \"\") {\r\n                scanner.name = columns[x].trim();\r\n            }\r\n        }\r\n\r\n        if (!scanner.id || scanner.id.length !== 2) {\r\n            return false;\r\n        }\r\n\r\n        return scanner;\r\n    }\r\n\r\n    this.pasteSignatures.parsePaste = function(paste) {\r\n        var paste = paste.split(\"\\n\");\r\n        var payload = {\"signatures\": {\"add\": [], \"update\": []}, \"systemID\": viewingSystemID};\r\n        var undo = [];\r\n        processing = true;\r\n\r\n        for (var i in paste) {\r\n            var scanner = rowParse(paste[i]);\r\n\r\n            if (scanner.id) {\r\n                var signature = $.map(tripwire.client.signatures, function(signature) { if (signature.signatureID && signature.signatureID.toUpperCase() == scanner.id[0] + scanner.id[1]) return signature; })[0];\r\n                if (signature) {\r\n                    // Update signature (only non-wormholes can be updated to a wormhole)\r\n                    if (scanner.type == \"Wormhole\" && signature.type != \"wormhole\") {\r\n                        var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0] || {};\r\n                        var otherSignature = wormhole.id ? (signature.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID]) : {};\r\n                        payload.signatures.update.push({\r\n                            \"wormhole\": {\r\n                                \"id\": wormhole.id || null,\r\n                                \"type\": wormhole.type || null,\r\n                                \"life\": wormhole.life || \"stable\",\r\n                                \"mass\": wormhole.mass || \"stable\"\r\n                            },\r\n                            \"signatures\": [\r\n                                {\r\n                                    \"id\": signature.id,\r\n                                    \"signatureID\": signature.signatureID,\r\n                                    \"systemID\": viewingSystemID,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"name\": signature.name\r\n                                },\r\n                                {\r\n                                    \"id\": otherSignature.id || null,\r\n                                    \"signatureID\": otherSignature.signatureID || null,\r\n                                    \"systemID\": otherSignature.systemID || null,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"name\": otherSignature.name\r\n                                }\r\n                            ]\r\n                        });\r\n\r\n                        if (tripwire.client.wormholes[wormhole.id]) {\r\n\t\t\t\t\t\t\tundo.push({\"wormhole\": tripwire.client.wormholes[wormhole.id], \"signatures\": [tripwire.client.signatures[signature.id], tripwire.client.signatures[otherSignature.id]]});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// used to be just a regular signature\r\n\t\t\t\t\t\t\tundo.push(tripwire.client.signatures[signature.id]);\r\n\t\t\t\t\t\t}\r\n                    // Make sure we are only updating when we have new info (we never turn wormholes into regular signatures)\r\n                    } else if (signature.type != \"wormhole\" && ((scanner.type && scanner.type.toLowerCase() != signature.type) || (scanner.name && scanner.name != signature.name))) {\r\n                        payload.signatures.update.push({\r\n                            \"id\": signature.id,\r\n                            \"systemID\": viewingSystemID,\r\n                            \"type\": scanner.type || 'unknown',\r\n                            \"name\": scanner.name,\r\n                            \"lifeLength\": options.signatures.pasteLife * 60 * 60\r\n                        });\r\n                        undo.push(tripwire.client.signatures[signature.id]);\r\n                    }\r\n                } else {\r\n                    // Add signature\r\n                    if (scanner.type == \"Wormhole\") {\r\n                        payload.signatures.add.push({\r\n                            \"wormhole\": {\r\n                                \"type\": null,\r\n                                \"parent\": \"initial\",\r\n                                \"life\": \"stable\",\r\n                                \"mass\": \"stable\"\r\n                            },\r\n                            \"signatures\": [\r\n                                {\r\n                                    \"signatureID\": scanner.id[0] + scanner.id[1],\r\n                                    \"systemID\": viewingSystemID,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"lifeLength\": options.signatures.pasteLife * 60 * 60\r\n                                },\r\n                                {\r\n                                    \"signatureID\": null,\r\n                                    \"systemID\": null,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"lifeLength\": options.signatures.pasteLife * 60 * 60\r\n                                }\r\n                            ]\r\n                        });\r\n                    } else {\r\n                        payload.signatures.add.push({\r\n                            \"signatureID\": scanner.id[0] + scanner.id[1],\r\n                            \"systemID\": viewingSystemID,\r\n                            \"type\": scanner.type || 'unknown',\r\n                            \"name\": scanner.name,\r\n                            \"lifeLength\": options.signatures.pasteLife * 60 * 60\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (payload.signatures.add.length || payload.signatures.update.length) {\r\n            var success = function(data) {\r\n                if (data.resultSet && data.resultSet[0].result == true) {\r\n                    $(\"#undo\").removeClass(\"disabled\");\r\n\r\n                    if (data.results) {\r\n                        if (viewingSystemID in tripwire.signatures.undo) {\r\n                            tripwire.signatures.undo[viewingSystemID].push({action: \"add\", signatures: data.results});\r\n                        } else {\r\n                            tripwire.signatures.undo[viewingSystemID] = [{action: \"add\", signatures: data.results}];\r\n                        }\r\n                    }\r\n\r\n                    if (undo.length) {\r\n                        if (viewingSystemID in tripwire.signatures.undo) {\r\n                            tripwire.signatures.undo[viewingSystemID].push({action: \"update\", signatures: undo});\r\n\t\t\t\t\t\t} else {\r\n                            tripwire.signatures.undo[viewingSystemID] = [{action: \"update\", signatures: undo}];\r\n\t\t\t\t\t\t}\r\n                    }\r\n\r\n                    sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n                }\r\n            }\r\n\r\n            var always = function(data) {\r\n                processing = false;\r\n            }\r\n\r\n            tripwire.refresh('refresh', payload, success, always);\r\n        } else {\r\n            processing = false;\r\n        }\r\n    }\r\n\r\n    this.pasteSignatures.init = function() {\r\n        $(document).keydown(function(e)\t{\r\n            if ((e.metaKey || e.ctrlKey) && (e.keyCode == 86 || e.keyCode == 91) && !processing) {\r\n                //Abort - user is in input or textarea\r\n                if ($(document.activeElement).is(\"textarea, input\")) return;\r\n\r\n                $(\"#clipboard\").focus();\r\n            }\r\n        });\r\n\r\n        $(\"body\").on(\"click\", \"#fullPaste\", function(e) {\r\n            e.preventDefault();\r\n\r\n            var paste = $(this).data(\"paste\").split(\"\\n\");\r\n            var pasteIDs = [];\r\n            var removes = [];\r\n            var undo = [];\r\n\r\n            for (var i in paste) {\r\n                if (scan = rowParse(paste[i])) {\r\n                    pasteIDs.push((scan.id[0] + scan.id[1]).toLowerCase());\r\n                }\r\n            }\r\n\r\n            for (var i in tripwire.client.signatures) {\r\n                var signature = tripwire.client.signatures[i];\r\n\r\n                if (signature.systemID == viewingSystemID && signature.signatureID && $.inArray(signature.signatureID.toLowerCase(), pasteIDs) === -1 && signature.signatureID !== \"???\") {\r\n                    if (signature.type == \"wormhole\") {\r\n                        var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0] || {};\r\n                        var otherSignature = wormhole.id ? (signature.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID]) : {};\r\n                        if (wormhole.type !== \"GATE\") {\r\n                            removes.push(wormhole);\r\n                            undo.push({\"wormhole\": wormhole, \"signatures\": [signature, otherSignature]});\r\n                        }\r\n                    } else {\r\n                        removes.push(signature.id);\r\n                        undo.push(signature);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (removes.length > 0) {\r\n                var payload = {\"signatures\": {\"remove\": removes}};\r\n\r\n                var success = function(data) {\r\n                    if (data.resultSet && data.resultSet[0].result == true) {\r\n                        $(\"#undo\").removeClass(\"disabled\");\r\n                        if (viewingSystemID in tripwire.signatures.undo) {\r\n                            tripwire.signatures.undo[viewingSystemID].push({action: \"remove\", signatures: undo});\r\n                        } else {\r\n                            tripwire.signatures.undo[viewingSystemID] = [{action: \"remove\", signatures: undo}];\r\n                        }\r\n\r\n                        sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n                    }\r\n                }\r\n\r\n                tripwire.refresh('refresh', payload, success);\r\n            }\r\n        });\r\n\r\n        $(\"#clipboard\").on(\"paste\", function(e) {\r\n            e.preventDefault();\r\n            var paste = window.clipboardData ? window.clipboardData.getData(\"Text\") : (e.originalEvent || e).clipboardData.getData('text/plain');\r\n\r\n            $(\"#clipboard\").blur();\r\n            Notify.trigger(\"Paste detected<br/>(<a id='fullPaste' href=''>Click to delete missing sigs</a>)\");\r\n            $(\"#fullPaste\").data(\"paste\", paste);\r\n            tripwire.pasteSignatures.parsePaste(paste);\r\n        });\r\n    }\r\n\r\n    this.pasteSignatures.init();\r\n}\r\ntripwire.pasteSignatures();\r\n","tripwire.redo = function() {\r\n    if (tripwire.signatures.redo[viewingSystemID].length > 0) {\r\n        $(\"#redo\").addClass(\"disabled\");\r\n        var lastIndex = tripwire.signatures.redo[viewingSystemID].length -1;\r\n        var data = {\"systemID\": viewingSystemID, \"signatures\": {\"add\": [], \"remove\": [], \"update\": []}};\r\n\r\n        var redoItem = tripwire.signatures.redo[viewingSystemID][lastIndex];\r\n        var undo = $.map(redoItem.signatures, function(signature) {\r\n            // grab the current signature so we can restore the way it is now\r\n            if (signature.wormhole && tripwire.client.wormholes[signature.wormhole.id]) {\r\n                // it was a wormhole and still is\r\n                return {\"wormhole\": tripwire.client.wormholes[signature.wormhole.id], \"signatures\": [tripwire.client.signatures[signature.signatures[0].id], tripwire.client.signatures[signature.signatures[1].id]]};\r\n            } else if (tripwire.client.signatures[signature.id] && tripwire.client.signatures[signature.id].type == \"wormhole\") {\r\n                // it was a regular signature but is now a wormhole\r\n                var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n                return {\"wormhole\": wormhole, \"signatures\": [tripwire.client.signatures[wormhole.initialID], tripwire.client.signatures[wormhole.secondaryID]]};\r\n            } else if (signature.wormhole && tripwire.client.signatures[signature.signatures[0].id]) {\r\n                // it was a wormhole but is now a regular signature\r\n                return tripwire.client.signatures[signature.signatures[0].id];\r\n            } else {\r\n                // it was a regular signature and still is\r\n                return tripwire.client.signatures[signature.id];\r\n            }\r\n        });\r\n\r\n        switch(redoItem.action) {\r\n            case \"add\":\r\n                data.signatures.add = data.signatures.add.concat(redoItem.signatures);\r\n                break;\r\n            case \"remove\":\r\n                data.signatures.remove = data.signatures.remove.concat($.map(redoItem.signatures, function(signature) { return signature.wormhole ? signature.wormhole : signature.id }));\r\n                break;\r\n            case \"update\":\r\n                data.signatures.update = data.signatures.update.concat(redoItem.signatures);\r\n                break;\r\n        }\r\n\r\n        var success = function(data) {\r\n            if (data.resultSet && data.resultSet[0].result == true) {\r\n                tripwire.signatures.redo[viewingSystemID].pop();\r\n\r\n                $(\"#undo\").removeClass(\"disabled\");\r\n                if (viewingSystemID in tripwire.signatures.undo) {\r\n                    if (redoItem.action == \"add\") {\r\n                        // we are adding new signatures we removed so we need the new ids\r\n                        tripwire.signatures.undo[viewingSystemID].push({\"action\": redoItem.action, \"signatures\": data.results});\r\n                    } else if (redoItem.action == \"update\") {\r\n                        tripwire.signatures.undo[viewingSystemID].push({\"action\": redoItem.action, \"signatures\": undo});\r\n                    } else {\r\n                        tripwire.signatures.undo[viewingSystemID].push({action: redoItem.action, signatures: redoItem.signatures});\r\n                    }\r\n                } else {\r\n                    if (redoItem.action == \"add\") {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{\"action\": redoItem.action, \"signatures\": data.results}];\r\n                    } else if (redoItem.action == \"update\") {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{\"action\": redoItem.action, \"signatures\": undo}];\r\n                    } else {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{action: redoItem.action, signatures: redoItem.signatures}];\r\n                    }\r\n                }\r\n\r\n                sessionStorage.setItem(\"tripwire_redo\", JSON.stringify(tripwire.signatures.redo));\r\n                sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n            }\r\n        }\r\n\r\n        var always = function(data) {\r\n            if (tripwire.signatures.redo[viewingSystemID].length > 0) {\r\n                $(\"#redo\").removeClass(\"disabled\");\r\n            }\r\n        }\r\n\r\n        tripwire.refresh('refresh', data, success, always);\r\n    }\r\n}\r\n","// Handles pulling TQ status & player count\r\ntripwire.serverStatus = function() {\r\n    this.data;\r\n    this.timer;\r\n\r\n    clearTimeout(tripwire.serverStatus.timer);\r\n\r\n    tripwire.esi.eveStatus()\r\n        .always(function(data) {\r\n            if (data && data.players && data.players > 0) {\r\n                if (!tripwire.serverStatus.data || tripwire.serverStatus.data.players !== data.players) {\r\n                    $('#serverStatus').html(\"<span class='\"+(data.players > 0 ? 'stable' : 'critical')+\"'>TQ</span>: \"+numFormat(data.players));\r\n\r\n                    if (tripwire.serverStatus.data) {\r\n                        $(\"#serverStatus\").effect('pulsate', {times: 5});\r\n                    }\r\n                }\r\n\r\n                tripwire.serverStatus.data = data;\r\n            } else {\r\n                $('#serverStatus').html(\"<span class='critical'>TQ</span>\");\r\n            }\r\n\r\n            tripwire.serverStatus.timer = setTimeout(\"tripwire.serverStatus();\", 15000);\r\n        });\r\n}\r\ntripwire.serverStatus();\r\n","tripwire.sync = function(mode, data, successCallback, alwaysCallback) {\r\n    var data = typeof(data) === \"object\" ? $.extend(true, {}, data) : {};\r\n\r\n    // Grab any pending changes\r\n    $.extend(true, data, tripwire.data);\r\n\r\n    // Remove old timer to prevent multiple\r\n    if (this.timer) clearTimeout(this.timer);\r\n    if (this.xhr) this.xhr.abort();\r\n\r\n    if (mode == 'refresh' || mode == 'change') {\r\n        data.signatureCount = tripwire.serverSignatureCount;\r\n        data.signatureTime = Object.maxTime(this.client.signatures, \"modifiedTime\");\r\n\r\n        data.flareCount = chain.data.flares ? chain.data.flares.flares.length : 0;\r\n        data.flareTime = chain.data.flares ? chain.data.flares.last_modified : 0;\r\n\r\n        data.commentCount = Object.size(this.comments.data);\r\n        data.commentTime = Object.maxTime(this.comments.data, \"modified\");\r\n\r\n        data.activity = this.activity;\r\n    } else {\r\n        // Expand Tripwire with JSON data from EVE Data Dump and other static data\r\n        $.extend(this, appData);\r\n\r\n        this.aSystems = $.map(this.systems, function(system) { return system.name; });\r\n        this.aSigSystems = [\"Null-Sec\", \"Low-Sec\", \"High-Sec\", \"Class-1\", \"Class-2\", \"Class-3\", \"Class-4\", \"Class-5\", \"Class-6\"];\r\n        $.merge(this.aSigSystems, this.aSystems.slice());\r\n\r\n        $(\".systemsAutocomplete\").inlinecomplete({source: this.aSystems, maxSize: 10, delay: 0});\r\n    }\r\n\r\n    data.mode = mode != \"init\" ? \"refresh\" : \"init\";\r\n    data.systemID = viewingSystemID;\r\n    data.systemName = viewingSystem;\r\n    data.instance = tripwire.instance;\r\n    data.version = tripwire.version;\r\n\r\n    this.xhr = $.ajax({\r\n        url: \"refresh.php\",\r\n        data: data,\r\n        type: \"POST\",\r\n        dataType: \"JSON\",\r\n        cache: false\r\n    }).done(function(data) {\r\n        if (data) {\r\n            tripwire.server = data;\r\n            if(data.signatures) { // Save this count before we delete entries\r\n                tripwire.serverSignatureCount = Object.size(data.signatures);\r\n            }\r\n\r\n            if (data.wormholes) {\r\n                // Purge bad wormhole signatures\r\n                var wormholeInitialIDs = {};\r\n                var wormholeSecondaryIDs = {};\r\n                Object.values(data.wormholes).forEach(function (wh) {\r\n                    wormholeInitialIDs[parseInt(wh.initialID)] = wh.id;\r\n                    wormholeSecondaryIDs[parseInt(wh.secondaryID)] = wh.id;\r\n                })\r\n                for (var i in data.signatures) {\r\n                  if (data.signatures[i].type == \"wormhole\") {\r\n                    var id = data.signatures[i].id;\r\n                    if (wormholeInitialIDs[id] === undefined && wormholeSecondaryIDs[id] === undefined) {\r\n                      delete data.signatures[i];\r\n                    }\r\n                  }\r\n                }\r\n            }\r\n\r\n            if (data.esi) {\r\n                tripwire.esi.parse(data.esi);\r\n            }\r\n\r\n            if (data.sync) {\r\n                tripwire.serverTime.time = new Date(data.sync);\r\n            }\r\n\r\n            if (data.signatures) {\r\n                tripwire.parse(data, mode);\r\n            }\r\n\r\n            if (data.comments) {\r\n                tripwire.comments.parse(data.comments);\r\n            }\r\n\r\n            if (data.wormholes || data.occupied || data.flares) {\r\n                tripwire.chainMap.parse({\"map\": data.wormholes || null, \"occupied\": data.occupied || null, \"flares\": data.flares || null});\r\n            } else if (chain.data.occupied && chain.data.occupied.length && !data.occupied) {\r\n                // send update to remove all occupied system indicators\r\n                tripwire.chainMap.parse({\"occupied\": []});\r\n            }\r\n\r\n            tripwire.active(data.activity);\r\n\r\n            if (data.notify && !$(\"#serverNotification\")[0]) Notify.trigger(data.notify, \"yellow\", false, \"serverNotification\");\r\n        }\r\n\r\n        tripwire.data = {tracking: {}, esi: {}};\r\n        successCallback ? successCallback(data) : null;\r\n    }).always(function(data, status) {\r\n        tripwire.timer = setTimeout(\"tripwire.refresh();\", tripwire.refreshRate);\r\n\r\n        alwaysCallback ? alwaysCallback(data) : null;\r\n\r\n        if (data.status == 403) {\r\n            window.location.href = \".\";\r\n        } else if (status != \"success\" && status != \"abort\" && tripwire.connected == true) {\r\n            tripwire.connected = false;\r\n            $(\"#ConnectionSuccess\").click();\r\n            Notify.trigger(\"Error syncing with server\", \"red\", false, \"connectionError\");\r\n        } else if (status == \"success\" && tripwire.connected == false) {\r\n            tripwire.connected = true;\r\n            $(\"#connectionError\").click();\r\n            Notify.trigger(\"Successfully reconnected with server\", \"green\", 5000, \"connectionSuccess\");\r\n        }\r\n    });\r\n\r\n    return true;\r\n}\r\ntripwire.sync(\"init\");\r\n","// Change the currently viewed system\r\ntripwire.systemChange = function(systemID, mode) {\r\n    if (mode != \"init\") {\r\n        $(\"#infoSecurity\").removeClass();\r\n        $(\"#infoStatics\").empty();\r\n\r\n        viewingSystem = tripwire.systems[systemID].name;\r\n        viewingSystemID = systemID;\r\n\r\n        // Reset activity\r\n        activity.refresh(true);\r\n\r\n        // Reset signatures\r\n        $(\"#sigTable span[data-age]\").countdown(\"destroy\");\r\n        $(\"#sigTable tbody\").empty();\r\n        $(\"#signature-count\").html(0);\r\n        tripwire.signatures.list = {};\r\n        tripwire.client.signatures = null;\r\n\r\n        // Reset chain map\r\n        chain.redraw();\r\n\r\n        // Reset comments\r\n        $(\"#notesWidget .content .comment:visible\").remove();\r\n        tripwire.comments.data = null;\r\n\r\n        // Change the URL & history\r\n        history.replaceState(null, null, \"?system=\"+viewingSystem);\r\n\r\n        tripwire.refresh(\"change\");\r\n    }\r\n\r\n    // Change the title\r\n    document.title = tripwire.systems[systemID].name + \" - \" + app_name;\r\n\r\n    $(\"#infoSystem\").text(tripwire.systems[systemID].name);\r\n\r\n    // Current system favorite\r\n    $.inArray(parseInt(viewingSystemID), options.favorites) != -1 ? $(\"#system-favorite\").attr(\"data-icon\", \"star\").addClass(\"active\") : $(\"#system-favorite\").attr(\"data-icon\", \"star-empty\").removeClass(\"active\");\r\n\r\n    if (tripwire.systems[systemID].class) {\r\n        // Security\r\n        $(\"#infoSecurity\").html(\"<span class='wh pointer'>Class \" + tripwire.systems[systemID].class + \"</span>\");\r\n\r\n        // Effects\r\n        if (tripwire.systems[systemID].effect) {\r\n            var tooltip = \"<table cellpadding=\\\"0\\\" cellspacing=\\\"1\\\">\";\r\n            for (var x in tripwire.effects[tripwire.systems[systemID].effect]) {\r\n                var effect = tripwire.effects[tripwire.systems[systemID].effect][x].name;\r\n                var base = tripwire.effects[tripwire.systems[systemID].effect][x].base;\r\n                var bad = tripwire.effects[tripwire.systems[systemID].effect][x].bad;\r\n                var whClass = tripwire.systems[systemID].class > 6 ? 6 : tripwire.systems[systemID].class;\r\n                var modifier = 0;\r\n\r\n                switch (Math.abs(base)) {\r\n                    case 15:\r\n                        modifier = base > 0 ? 7 : -7;\r\n                        break;\r\n                    case 30:\r\n                        modifier = base > 0 ? 14 : -14;\r\n                        break;\r\n                    case 60:\r\n                        modifier = base > 0 ? 28 : -28;\r\n                        break;\r\n                }\r\n\r\n                tooltip += \"<tr><td>\" + effect + \"</td><td style=\\\"padding-left: 25px; text-align: right;\\\" class=\\\"\" + (bad ? \"critical\" : \"stable\") + \"\\\">\";\r\n                tooltip += base + (modifier * (whClass -1)) + \"%</td></tr>\";\r\n            }\r\n            tooltip += \"</table>\";\r\n            $(\"#infoSecurity\").append(\"&nbsp;<span class='pointer' data-tooltip='\" + tooltip + \"'>\" + tripwire.systems[systemID].effect + \"</span>\");\r\n            Tooltips.attach($(\"#infoSecurity [data-tooltip]\"));\r\n        }\r\n\r\n        // Statics\r\n        for (var x in tripwire.systems[systemID].statics) {\r\n            var type = tripwire.systems[systemID].statics[x];\r\n            var wormhole = tripwire.wormholes[type];\r\n            var color = \"wh\";\r\n\r\n            switch (wormhole.leadsTo) {\r\n                case \"High-Sec\":\r\n                    color = \"hisec\";\r\n                    break;\r\n                case \"Low-Sec\":\r\n                    color = \"lowsec\";\r\n                    break;\r\n                case \"Null-Sec\":\r\n                    color = \"nullsec\";\r\n                    break;\r\n            }\r\n\r\n            $(\"#infoStatics\").append(\"<div><span class='\"+ color +\"'>&#9679;</span> <b>\"+ wormhole.leadsTo +\"</b> via <span class='\"+ color +\"'>\"+ type +\"</span></div>\");\r\n        }\r\n\r\n        // Faction\r\n        $(\"#infoFaction\").html(\"&nbsp;\");\r\n    } else {\r\n        // Security\r\n        if (tripwire.systems[systemID].security >= 0.45) {\r\n            $(\"#infoSecurity\").addClass(\"hisec\").text(\"High-Sec \" + tripwire.systems[systemID].security);\r\n        } else if (tripwire.systems[systemID].security > 0.0) {\r\n            $(\"#infoSecurity\").addClass(\"lowsec\").text(\"Low-Sec \" + tripwire.systems[systemID].security);\r\n        } else {\r\n            $(\"#infoSecurity\").addClass(\"nullsec\").text(\"Null-Sec \" + tripwire.systems[systemID].security);\r\n        }\r\n\r\n        // Faction\r\n        $(\"#infoFaction\").html(tripwire.systems[systemID].factionID ? tripwire.factions[tripwire.systems[systemID].factionID].name : \"&nbsp;\");\r\n\t\t\r\n\t\t// Route to favourites\r\n\t\tfor (var fi in options.favorites) {\r\n\t\t\tconst f = options.favorites[fi];\r\n\t\t\tconst path = guidance.findShortestPath(tripwire.map.shortest, f - 30000000, viewingSystemID - 30000000);\r\n\t\t\tif(path) { $('#infoStatics').append('<p><b>' + tripwire.systems[f].name + '</b>: ' + chain.renderPath(path) + '</p>'); }\r\n\t\t}\r\n        Tooltips.attach($(\"#infoStatics [data-tooltip]\"));\r\n    }\r\n\r\n    // Region\r\n    $(\"#infoRegion\").text(tripwire.regions[tripwire.systems[systemID].regionID].name);\r\n\r\n    // Info Links\r\n    $(\"#infoWidget .infoLink\").each(function() {\r\n        this.href = $(this).data(\"href\").replace(/\\$systemName/gi, tripwire.systems[systemID].name).replace(/\\$systemID/gi, systemID);\r\n    });\r\n\r\n    // Reset undo/redo\r\n    tripwire.signatures.undo[systemID] && tripwire.signatures.undo[systemID].length > 0 ? $(\"#undo\").removeClass(\"disabled\") : $(\"#undo\").addClass(\"disabled\");\r\n    tripwire.signatures.redo[systemID] && tripwire.signatures.redo[systemID].length > 0 ? $(\"#redo\").removeClass(\"disabled\") : $(\"#redo\").addClass(\"disabled\");\r\n\r\n    // Reset delete signature icon\r\n    $(\"#sigTable tr.selected\").length == 0 ? $(\"#signaturesWidget #delete-signature\").addClass(\"disabled\") : $(\"#signaturesWidget #delete-signature\").removeClass(\"disabled\");\r\n}\r\ntripwire.systemChange(viewingSystemID, \"init\");\r\n","var tutorial;\r\n\r\n// infoWidget\r\n$(\"#infoWidget .tutorial\").click(function() {\r\n    tutorial = introJs().setOptions({\r\n        showStepNumbers: false,\r\n        steps: [\r\n            {\r\n                element: document.querySelector(\"#infoWidget\"),\r\n                intro: \"<h4>System information widget</h4><br/><p>Displays information on the currently <b>selected</b> Tripwire system.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#infoGeneral\"),\r\n                intro: \"<p>This section includes:<br/>System Name<br/>Security Rating<br/>Region<br/>Owning Faction Name</p><br/><p>If the selected system is a wormhole with a system effect, that will also be shown - hover over it to view the effect breakdown.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#activityGraph\"),\r\n                intro: \"<p>This is the graph containing historical ship jump and kill information from the EVE API.</p><br/><p>This data is only available for K-Space systems and not wormhole systems.</p><br/><p>The EVE API updates this data each hour, so this graph will update itself at the top of every hour.</p>\"\r\n            },\r\n            {\r\n                element: $(\"#activityGraph svg > g > g:nth-child(5)\")[0],\r\n                intro: \"<p>Each category can be toggled by clicking these keys to drill down the graph into finer detail.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#activityGraphControls\"),\r\n                intro: \"<p>Select different lengths of historical data to adjust the graph to display more or less information.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#infoStatics\"),\r\n                intro: \"<p>If a wormhole system is selected, the publicaly known static wormholes will appear here.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#infoLinks\"),\r\n                intro: \"<p>These are some quick links to various sites for this specific system.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#system-favorite\"),\r\n                intro: \"<p>This toggles wether this is a 'favorite' system, orange is active.</p><br/><p>'Favorite' systems can be rendered in the chain map to be able to see how far away trade hub systems are from your wormhole chain K-Space exits.</p>\"\r\n            }\r\n        ]\r\n    }).start();\r\n});\r\n\r\n// signaturesWidget\r\n$(\"#signaturesWidget .tutorial\").click(function() {\r\n    tutorial = introJs().setOptions({\r\n        showStepNumbers: false,\r\n        steps: [\r\n            {\r\n                element: document.querySelector(\"#signaturesWidget\"),\r\n                intro: \"<h4>System signatures widget</h4><br/><p>Displays all signatures and wormholes in the currently <b>selected</b> Tripwire system.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#add-signature\"),\r\n                intro: \"<p>Add new signatures and wormholes manually by clicking the + icon.</p><br/><p>Copy & Paste EVE scanner results anywhere once Tripwire has focus to add or update signatures, repeated pastes will only update with new information.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#delete-signature\"),\r\n                intro: \"<p>Click here or use the keyboard shortcut <b>DELETE</b> to delete <b>selected</b> signatures from this system.</p><br/><p>Click on a row to select it, click multiple rows to delete multiple signatures at once, click a selected row again to unselect it.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#signature-count\"),\r\n                intro: \"<p>This shows the current count of signatures, including wormholes, in the selected system.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#undo\"),\r\n                intro: \"<p>Click here or use the keyboard shortcut <b>CTRL-Z</b> to undo the last changes you made in this sytem (this includes clipboard pasted changes).</p><br/><p>You can undo multiple times as history is kept in the browser.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#redo\"),\r\n                intro: \"<p>Click here or use the keyboard shortcut <b>CTRL-Y</b> to redo the last changes you made in this system (this includes clipboard pasted changes).</p><br/><p>You can redo multiple times as history is kept in the browser.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#toggle-automapper\"),\r\n                intro: \"<p>Click here to toggle the Auto-mapper feature on (orange) or off.</p><br/><p>This feature only works when an in-game character is being actively tracked, otherwise this icon appears disabled.</p><br/><p>The automapper will watch for a change in your in-game system not via a star gate and try to automatically add or update wormholes.</p><br/><p>First it tries to seach for wormholes already added but missing a leads to system, this includes via wormhole type (B274) or with a leads to of 'High-Sec' for example.</p><br/><p>Next it searches for wormholes without any type or leads to at all.</p><br/><p>Finally if there are no wormholes or they all have a leads to system already, it will add a new wormhole.</p><br/><p>If at any time if finds multiple wormholes it can update, a dialog window will appear asking which wormhole you want to update.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#sigTable\"),\r\n                intro: \"<p>Each column can be sorted by clicking the column label, sort by multiple columns by holding the shift key.</p><br/><p>Right-click a column to change the text-alignment.</p>\"\r\n            }\r\n        ]\r\n    }).start();\r\n});\r\n\r\n// notesWidget\r\n$(\"#notesWidget .tutorial\").click(function(e) {\r\n    e.preventDefault();\r\n\r\n    tutorial = introJs().setOptions({\r\n        showStepNumbers: false,\r\n        exitOnEsc: false,\r\n        exitOnOverlayClick: false,\r\n        skipLabel: \"Abort\",\r\n        steps: [\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<h4>System notes widget</h4><br/><p>Displays comments based on the currently <b>selected</b> Tripwire system.</p><br/><p>The rest of this tutorial will guide you through actually adding a comment, but don't worry we will switch you to your private Tripwire mask so we don't disturb anyone else.</p><br/><p>When you finish or leave this tutorial we will switch you back to your previous Tripwire mask.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#add-comment\"),\r\n                intro: \"<p>Now click the + icon to begin adding a new comment in this system (\" + viewingSystem + \").</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>Type some basic text now and click save.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>This is our newly created comment. Hover over the comment with your mouse to see additional information and controls.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>You can click the 'pin' or 'sticky' button to toggle showing this comment for every system, not just this system.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>Use the <b>Edit</b> to modify a comment and <b>Delete</b> to remove a comment.</p><br/><p>You can also quickly edit any comment by simply doubling clicking anywhere on it.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>Click on the <b>Edit</b> now on our comment.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>The toolbar at the top allows you to customize your notes.</p><br/><p>You can also click on the <b>Maximize/Minimize</b> button (the far right toolbar icon) to edit this comment in full screen mode.</p><br/><p>In full screen mode you will see 1 new button added to the toolbar to view the source code of the comment where you can write HTML, CSS, and even Javascript in your notes!</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>This concludes the tutorial, we will now switch you back to your previous Tripwire mask and delete the comment we created.</p>\"\r\n            }\r\n        ]\r\n    }).start();\r\n\r\n    tutorial.onchange(function(element) {\r\n        switch(tutorial._currentStep) {\r\n            case 1:\r\n                $(\".introjs-prevbutton, .introjs-nextbutton\").hide();\r\n\r\n                console.log(\"switch mask to private\");\r\n                tutorial.previousMask = options.masks.active;\r\n                options.masks.active = options.character.id + \".1\";\r\n                options.save();\r\n\r\n                tutorial.stepFunc = function() {\r\n                    setTimeout(function() {\r\n                        tutorial._options.steps[2].element = $(\"#notesWidget\").find(\".comment:has(.cke_toolbar)\")[0];\r\n                        tutorial.setOption(\"steps\", tutorial._options.steps);\r\n\r\n                        tutorial.exiting = false;\r\n                        tutorial.exit().start().goToStep(3);\r\n                        tutorial.exiting = true;\r\n                    }, 200);\r\n                }\r\n\r\n                $(\"#notesWidget #add-comment\").on(\"click\", tutorial.stepFunc);\r\n                break;\r\n            case 2:\r\n                $(\".introjs-prevbutton, .introjs-nextbutton\").hide();\r\n                $(\"#notesWidget #add-comment\").off(\"click\", tutorial.stepFunc);\r\n\r\n                tutorial.stepFunc = function() {\r\n                    tutorial.comment = $(this).closest(\".comment\");\r\n                    setTimeout(function() {\r\n                        tutorial._options.steps[3].element = tutorial.comment[0];\r\n                        tutorial._options.steps[4].element = tutorial.comment.find(\".commentSticky\")[0];\r\n                        tutorial._options.steps[5].element = tutorial.comment.find(\".commentControls\")[0];\r\n                        tutorial._options.steps[6].element = tutorial.comment.find(\".commentControls\")[0];\r\n                        tutorial.setOption(\"steps\", tutorial._options.steps);\r\n\r\n                        tutorial.exiting = false;\r\n                        tutorial.exit().start().goToStep(4);\r\n                        tutorial.exiting = true;\r\n                    }, 200);\r\n                }\r\n\r\n                $(\"#notesWidget\").on(\"click\", \".commentSave\", tutorial.stepFunc);\r\n                break;\r\n            case 6:\r\n                $(\".introjs-prevbutton, .introjs-nextbutton\").hide();\r\n                $(\"#notesWidget\").off(\"click\", \".commentSave\", tutorial.stepFunc);\r\n\r\n                tutorial.stepFunc = function() {\r\n                    setTimeout(function() {\r\n                        tutorial._options.steps[7].element = $(\"#notesWidget\").find(\".comment:has(.cke_toolbar)\")[0];\r\n                        tutorial._options.steps[8].element = $(\"#notesWidget\").find(\".comment:has(.cke_toolbar)\")[0];\r\n                        tutorial.setOption(\"steps\", tutorial._options.steps);\r\n\r\n                        tutorial.exiting = false;\r\n                        tutorial.exit().start().goToStep(8);\r\n                        tutorial.exiting = true;\r\n                    }, 200);\r\n                }\r\n\r\n                $(\"#notesWidget\").on(\"click\", \".commentEdit\", tutorial.stepFunc);\r\n                break;\r\n        }\r\n    });\r\n\r\n    tutorial.onexit(function() {\r\n        if (tutorial.exiting) {\r\n            $(\".commentCancel:visible\").click();\r\n            // delete the tutorial comment that was created\r\n            if (tutorial.comment) {\r\n                var data = {\"mode\": \"delete\", \"commentID\": tutorial.comment.data(\"id\")};\r\n\r\n                $.ajax({\r\n                    url: \"comments.php\",\r\n                    type: \"POST\",\r\n                    data: data,\r\n                    dataType: \"JSON\"\r\n                }).done(function(data) {\r\n                    if (data && data.result == true) {\r\n                        tutorial.comment.remove();\r\n                    }\r\n                });\r\n            }\r\n\r\n            if (tutorial.previousMask) {\r\n                setTimeout(function() {\r\n                    console.log(\"change mask back, delete comment\", tutorial.previousMask);\r\n                    options.masks.active = tutorial.previousMask;\r\n                    options.save();\r\n                }, 200);\r\n            }\r\n\r\n            // remove event listeners\r\n            $(\"#notesWidget #add-comment\").off(\"click\", tutorial.stepFunc);\r\n            $(\"#notesWidget\").off(\"click\", \".commentSave\", tutorial.stepFunc);\r\n            $(\"#notesWidget\").off(\"click\", \".commentEdit\", tutorial.stepFunc);\r\n            $(\"#notesWidget\").off(\"click\", \".cke_toolgroup:has(.cke_button__toolbarswitch)\", tutorial.stepFunc);\r\n        }\r\n    });\r\n\r\n    tutorial.previousMask;\r\n    tutorial.comment;\r\n    tutorial.stepFunc;\r\n    tutorial.exiting = true;\r\n});\r\n","tripwire.undo = function() {\r\n    if (tripwire.signatures.undo[viewingSystemID].length > 0) {\r\n        $(\"#undo\").addClass(\"disabled\");\r\n        var lastIndex = tripwire.signatures.undo[viewingSystemID].length -1;\r\n        var data = {\"systemID\": viewingSystemID, \"signatures\": {\"add\": [], \"remove\": [], \"update\": []}};\r\n\r\n        var undoItem = tripwire.signatures.undo[viewingSystemID][lastIndex];\r\n        var redo = $.map(undoItem.signatures, function(signature) {\r\n            // grab the current signature so we can restore the way it is now\r\n            if (signature.wormhole && tripwire.client.wormholes[signature.wormhole.id]) {\r\n                // it was a wormhole and still is\r\n                return {\"wormhole\": tripwire.client.wormholes[signature.wormhole.id], \"signatures\": [tripwire.client.signatures[signature.signatures[0].id], tripwire.client.signatures[signature.signatures[1].id]]};\r\n            } else if (tripwire.client.signatures[signature.id] && tripwire.client.signatures[signature.id].type == \"wormhole\") {\r\n                // it was a regular signature but is now a wormhole\r\n                var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n                return {\"wormhole\": wormhole, \"signatures\": [tripwire.client.signatures[wormhole.initialID], tripwire.client.signatures[wormhole.secondaryID]]};\r\n            } else if (signature.wormhole && tripwire.client.signatures[signature.signatures[0].id]) {\r\n                // it was a wormhole but is now a regular signature\r\n                return tripwire.client.signatures[signature.signatures[0].id];\r\n            } else {\r\n                // it was a regular signature and still is\r\n                return tripwire.client.signatures[signature.id];\r\n            }\r\n        });\r\n\r\n        switch(undoItem.action) {\r\n            case \"add\":\r\n                data.signatures.remove = data.signatures.remove.concat($.map(undoItem.signatures, function(signature) { return signature.wormhole ? signature.wormhole : signature.id }));\r\n                break;\r\n            case \"remove\":\r\n                data.signatures.add = data.signatures.add.concat(undoItem.signatures);\r\n                break;\r\n            case \"update\":\r\n                data.signatures.update = data.signatures.update.concat(undoItem.signatures);\r\n                break;\r\n        }\r\n\r\n        var success = function(data) {\r\n            if (data.resultSet && data.resultSet[0].result == true) {\r\n                tripwire.signatures.undo[viewingSystemID].pop();\r\n\r\n                $(\"#redo\").removeClass(\"disabled\");\r\n                if (viewingSystemID in tripwire.signatures.redo) {\r\n                    if (undoItem.action == \"remove\") {\r\n                        // we are adding new signatures we removed so we need the new ids\r\n                        tripwire.signatures.redo[viewingSystemID].push({\"action\": undoItem.action, \"signatures\": data.results});\r\n                    } else if (undoItem.action == \"update\") {\r\n                        tripwire.signatures.redo[viewingSystemID].push({\"action\": undoItem.action, \"signatures\": redo});\r\n                    } else {\r\n                        tripwire.signatures.redo[viewingSystemID].push({\"action\": undoItem.action, \"signatures\": undoItem.signatures});\r\n                    }\r\n                } else {\r\n                    if (undoItem.action == \"remove\") {\r\n                        tripwire.signatures.redo[viewingSystemID] = [{\"action\": undoItem.action, \"signatures\": data.results}];\r\n                    } else if (undoItem.action == \"update\") {\r\n                        tripwire.signatures.redo[viewingSystemID] = [{\"action\": undoItem.action, \"signatures\": redo}];\r\n                    } else {\r\n                        tripwire.signatures.redo[viewingSystemID] = [{\"action\": undoItem.action, \"signatures\": undoItem.signatures}];\r\n                    }\r\n                }\r\n\r\n                sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n                sessionStorage.setItem(\"tripwire_redo\", JSON.stringify(tripwire.signatures.redo));\r\n            }\r\n        }\r\n\r\n        var always = function(data) {\r\n            if (tripwire.signatures.undo[viewingSystemID].length > 0) {\r\n                $(\"#undo\").removeClass(\"disabled\");\r\n            }\r\n        }\r\n\r\n        tripwire.refresh('refresh', data, success, always);\r\n    }\r\n}\r\n","var activity = new function() {\r\n\tthis.graph;\r\n\tthis.options;\r\n\tthis.view;\r\n\tthis.span = 24;\r\n\tthis.columns = [\r\n\t\t{id: \"time\", label: \"Time\", role: \"domain\", type: \"string\", calc: function(d, r) { return d.getValue(r, 0) + \"h\"; }},\r\n\t\t{id: \"jumps\", label: \"Jumps\", role: \"data\", type: \"number\", sourceColumn: 1, column: 1, title: \"Jumps\"},\r\n\t\t{id: \"podkills\", label: \"Pod Kills\", role: \"data\", type: \"number\", sourceColumn: 2, column: 2, title: \"Pod Kills\"},\r\n\t\t{id: \"shipkills\", label: \"Ship Kills\", role: \"data\", type: \"number\", sourceColumn: 3, column: 3, title: \"Ship Kills\"},\r\n\t\t{id: \"npckills\", label: \"NPC Kills\", role: \"data\", type: \"number\", sourceColumn: 4, column: 4, title: \"NPC Kills\"},\r\n\t\t//{id: \"annotationLabel\", label: \"Test\", role: \"annotation\", type: \"string\", sourceColumn: 5, title: \"Test\"},\r\n\t\t//{id: \"annotationText\", label: \"Test\", role: \"annotationText\", type: \"string\", sourceColumn: 6, title: \"Test\"}\r\n\t];\r\n\r\n\tthis.getData = function(span, cache) {\r\n\t\tvar span = typeof(span) !== \"undefined\" ? span : this.span;\r\n\t\tvar cache = typeof(cache) !== \"undefined\" ? cache : true;\r\n\r\n\t\t// Google hasn't finished loading yet\r\n\t\tif (!activity.graph) {\r\n\t\t\t\tsetTimeout(function() {activity.getData(span, cache)}, 500);\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn $.ajax({\r\n\t\t\turl: \"activity_graph.php\",\r\n\t\t\tdata: {systemID: viewingSystemID, time: span},\r\n\t\t\ttype: \"GET\",\r\n\t\t\tdataType: \"JSON\",\r\n\t\t\tcache: cache\r\n\t\t}).done(function(json) {\r\n\t\t\tif (json) {\r\n\t\t\t\tjson.rows.reverse();\r\n\t\t\t\tactivity.view = new google.visualization.DataView(new google.visualization.DataTable(json));\r\n\t\t\t\tactivity.view.setColumns(activity.columns);\r\n\t\t\t\tactivity.graph.draw(activity.view, activity.options);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tthis.selectHandler = function() {\r\n\t\tvar selections = activity.graph.getSelection();\r\n\r\n\t\tif (selections[0] && selections[0].row == null) {\r\n\t\t\tvar c = selections[0].column;\r\n\r\n\t\t\tif (activity.columns[c].sourceColumn) {\r\n\t\t\t\t//activity.columns[c].calc = function() { return null };\r\n\t\t\t\tactivity.columns[c].label = activity.columns[c].title + \" (off)\";\r\n\t\t\t\tdelete activity.columns[c].sourceColumn;\r\n\t\t\t} else {\r\n\t\t\t\tactivity.columns[c].sourceColumn = activity.columns[c].column;\r\n\t\t\t\tactivity.columns[c].label = activity.columns[c].title;\r\n\t\t\t\t//delete activity.columns[c].calc;\r\n\t\t\t}\r\n\r\n\t\t\tactivity.view.setColumns(activity.columns);\r\n\t\t\tactivity.options.animation.duration = 0;\r\n\t\t\tactivity.graph.draw(activity.view, activity.options);\r\n\t\t\tactivity.options.animation.duration = 500;\r\n\t\t}\r\n\t}\r\n\r\n\tthis.init = function() {\r\n\t\tactivity.graph = new google.visualization.AreaChart(document.getElementById(\"activityGraph\"));\r\n\t\tactivity.options = {\r\n\t\t\tisStacked: false,\r\n\t\t\tbackgroundColor: \"transparent\",\r\n\t\t\thAxis: {textStyle: {color: \"#999\", fontName: \"Verdana\", fontSize: 10}, showTextEvery: 3},\r\n\t\t\tvAxis: {textStyle: {color: \"#666\", fontName: \"Verdana\", fontSize: 10}, viewWindowMode: \"maximized\", viewWindow: {min: 0}, maxValue: 5},\r\n\t\t\tgridlineColor: \"#454545\",\r\n\t\t\tpointSize: 2,\r\n\t\t\tlineWidth: 1,\r\n\t\t\tchartArea: {left: \"10%\", top: \"5%\", width: \"88%\", height: \"85%\"},\r\n\t\t\tlegend: {position: \"in\", textStyle: {color: \"#CCC\", fontName: \"Verdana\", fontSize: 8.5}},\r\n\t\t\tanimation: {duration: 500, easing: \"inAndout\"},\r\n\t\t\ttooltip: {showColorCode: true},\r\n\t\t\tannotations: {style: \"line\", textStyle: {fontSize: 12, color: \"#ccc\"}, domain: 0},\r\n\t\t\tfocusTarget: \"category\"\r\n\t\t}\r\n\r\n\t\tgoogle.visualization.events.addListener(activity.graph, \"select\", activity.selectHandler);\r\n\r\n\t\tactivity.getData(activity.span);\r\n\t}\r\n\r\n\tthis.time = function(span) {\r\n\t\tswitch(span) {\r\n\t\t\tcase 24:\r\n\t\t\t\tthis.options.hAxis.showTextEvery = 3;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 48:\r\n\t\t\t\tthis.options.hAxis.showTextEvery = 6;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 168:\r\n\t\t\t\tthis.options.hAxis.showTextEvery = 24;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tthis.span = span;\r\n\t\tthis.getData(span);\r\n\t}\r\n\r\n\tthis.redraw = function() {\r\n\t\tthis.graph.draw(this.view, this.options);\r\n\t}\r\n\r\n\tthis.refresh = function(cache) {\r\n\t\tthis.getData(this.span, cache);\r\n\t}\r\n\r\n\tgoogle.charts.setOnLoadCallback(this.init);\r\n}\r\n","var CKConfig = {\r\n\tskin: \"custom\",\r\n\theight: 100,\r\n\tallowedContent: true,\r\n\textraPlugins: \"toolbarswitch,autogrow,autolink\",\r\n\tenterMode: CKEDITOR.ENTER_BR,\r\n\tremoveDialogTabs: 'link:advanced',\r\n\tautoGrow_onStartup: true,\r\n\tautoGrow_minHeight: 100,\r\n\ttoolbar_minToolbar: [\r\n\t\t{name: \"basicstyles\", items: [\"Bold\", \"Italic\", \"Underline\", \"Strike\"]},\r\n\t\t{name: \"paragraph\", items: [\"BulletedList\", \"Outdent\", \"Indent\"]},\r\n\t\t{name: \"links\", items: [\"Link\"]},\r\n\t\t{name: \"colors\", items: [\"TextColor\", \"BGColor\"]},\r\n\t\t{name: \"styles\", items: [\"FontSize\"]},\r\n\t\t{name: \"tools\", items: [\"Toolbarswitch\"]}\r\n\t],\r\n\ttoolbar_maxToolbar: [\r\n\t\t{name: \"basicstyles\", items: [\"Bold\", \"Italic\", \"Underline\", \"Strike\", \"Subscript\", \"Superscript\"]},\r\n\t\t{name: \"paragraph\", items: [\"NumberedList\", \"BulletedList\", \"Outdent\", \"Indent\"]},\r\n\t\t{name: \"links\", items: [\"Link\"]},\r\n\t\t{name: \"colors\", items: [\"TextColor\", \"BGColor\"]},\r\n\t\t{name: \"styles\", items: [\"FontSize\", \"Font\"]},\r\n\t\t{name: \"tools\", items: [\"Source\", \"Toolbarswitch\"]}\r\n\t],\r\n\ttoolbar: \"minToolbar\",\r\n\tsmallToolbar: \"minToolbar\",\r\n\tmaximizedToolbar: \"maxToolbar\",\r\n\tfontSize_style: {\r\n\t    element:        'span',\r\n\t    styles:         { 'font-size': '#(size)' },\r\n\t    overrides:      [ { element :'font', attributes: { 'size': null } } ]\r\n\t}\r\n}\r\n\r\nCKEDITOR.on(\"instanceLoaded\", function(cke) {\r\n\tcke.editor.on(\"contentDom\", function() {\r\n\t\tcke.editor.on(\"key\", function(e) {\r\n\t\t\tif (e.data.keyCode == 27) {\r\n\t\t\t\t// escape key cancels\r\n\t\t\t\t$(cke.editor.element.$).closest(\".comment\").find(\".commentCancel\").click();\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (e.data.domEvent.$.altKey && e.data.domEvent.$.keyCode == 83) {\r\n\t\t\t\t// alt+s saves\r\n\t\t\t\t$(cke.editor.element.$).closest(\".comment\").find(\".commentSave\").click();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\t$(\".cke_combo__font a\")\r\n\t\t.removeClass(\"cke_combo_button\")\r\n\t\t.addClass(\"cke_button cke_button_off\")\r\n\t\t.html('<span class=\"cke_button_icon\">&nbsp;</span>')\r\n\r\n\t$(\".cke_combo__fontsize a\")\r\n\t\t.removeClass(\"cke_combo_button\")\r\n\t\t.addClass(\"cke_button cke_button_off\")\r\n\t\t.html('<span class=\"cke_button_icon\">&nbsp;</span>')\r\n});\r\n\r\nCKEDITOR.on(\"instanceReady\", function(cke) {\r\n\t// ensure focus on init\r\n\tcke.editor.focus();\r\n\r\n\tvar s = cke.editor.getSelection(); // getting selection\r\n\tvar selected_ranges = s.getRanges(); // getting ranges\r\n\tvar node = selected_ranges[0].startContainer; // selecting the starting node\r\n\tvar parents = node.getParents(true);\r\n\r\n\tnode = parents[parents.length - 2].getFirst();\r\n\r\n\tif (!node) return false;\r\n\r\n\twhile (true) {\r\n\t\tvar x = node.getNext();\r\n\t\tif (x == null) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tnode = x;\r\n\t}\r\n\r\n\ts.selectElement(node);\r\n\tselected_ranges = s.getRanges();\r\n\tselected_ranges[0].collapse(false);  //  false collapses the range to the end of the selected node, true before the node.\r\n\ts.selectRanges(selected_ranges);  // putting the current selection there\r\n});\r\n\r\nCKEDITOR.on(\"dialogDefinition\", function(ev) {\r\n\tif (ev.data.name == 'link') {\r\n\t\tev.data.definition.getContents('target').get('linkTargetType')['default'] = '_blank';\r\n\t}\r\n});\r\n","$(\"#admin\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"disabled\")) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif (!$(\"#dialog-admin\").hasClass(\"ui-dialog-content\")) {\r\n\t\tvar refreshTimer = null;\r\n\t\tvar $total = null;\r\n\t\tvar $ajax = null;\r\n\r\n\t\tfunction refreshWindow() {\r\n\t\t\tif ($ajax) $ajax.abort();\r\n\t\t\t$total.html(\"Total: \" + $(\"#dialog-admin .window .hasFocus table tr[data-id]\").length);\r\n\r\n\t\t\t$ajax = $.ajax({\r\n\t\t\t\turl: \"admin.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: {mode: $(\"#dialog-admin .menu .active\").attr(\"data-window\")},\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tif (data && data.results) {\r\n\t\t\t\t\tvar rows = data.results;\r\n\t\t\t\t\tvar ids = [];\r\n\r\n\t\t\t\t\tfor (var i = 0, l = rows.length; i < l; i++) {\r\n\t\t\t\t\t\tvar $row = $(\"#dialog-admin .window .hasFocus tbody tr[data-id='\"+ rows[i].id +\"']\");\r\n\t\t\t\t\t\tids.push(rows[i].id);\r\n\r\n\t\t\t\t\t\tif ($row.length) {\r\n\t\t\t\t\t\t\tfor (col in rows[i]) {\r\n\t\t\t\t\t\t\t\tvar $col = $row.find(\"[data-col='\"+col+\"']\");\r\n\t\t\t\t\t\t\t\t$col.html(($col.attr(\"data-format\") == \"number\" ? numFormat(rows[i][col]) : rows[i][col]) || \"&nbsp;\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t$row = $(\"#dialog-admin .window .hasFocus table tr.hidden\").clone();\r\n\t\t\t\t\t\t\t$row.attr(\"data-id\", rows[i].id);\r\n\r\n\t\t\t\t\t\t\tfor (col in rows[i]) {\r\n\t\t\t\t\t\t\t\tvar $col = $row.find(\"[data-col='\"+col+\"']\");\r\n\t\t\t\t\t\t\t\t$col.html(($col.attr(\"data-format\") == \"number\" ? numFormat(rows[i][col]) : rows[i][col]) || \"&nbsp;\");\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t$row.removeClass(\"hidden\");\r\n\r\n\t\t\t\t\t\t\t$(\"#dialog-admin .window .hasFocus tbody\").append($row);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .window .hasFocus table tr[data-id]\").each(function() {\r\n\t\t\t\t\t\tif ($.inArray($(this).data(\"id\").toString(), ids) == -1) {\r\n\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .window .hasFocus table\").trigger(\"update\", [true]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#dialog-admin .window .hasFocus table tr[data-id]\").remove();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$total.html(\"Total: \" + $(\"#dialog-admin .window .hasFocus table tr[data-id]\").length);\r\n\t\t\t});\r\n\r\n\t\t\tif ($(\"#dialog-admin\").dialog(\"isOpen\") && $(\"#dialog-admin .menu .active\").attr(\"data-refresh\")) {\r\n\t\t\t\trefreshTimer = setTimeout(refreshWindow, $(\"#dialog-admin .menu .active\").attr(\"data-refresh\"));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t$(\"#dialog-admin\").dialog({\r\n\t\t\tautoOpen: true,\r\n\t\t\tmodal: true,\r\n\t\t\theight: 350,\r\n\t\t\twidth: 800,\r\n\t\t\tbuttons: {\r\n\t\t\t\tClose: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t// menu toggle\r\n\t\t\t\t$(\"#dialog-admin\").on(\"click\", \".menu li\", function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t$menuItem = $(this);\r\n\t\t\t\t\tclearTimeout(refreshTimer);\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .menu .active\").removeClass(\"active\");\r\n\t\t\t\t\t$menuItem.addClass(\"active\");\r\n\t\t\t\t\t$(\"div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane\").html(\"\");\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .window [data-window]\").removeClass(\"hasFocus\").hide();\r\n\t\t\t\t\t$(\"#dialog-admin .window [data-window='\"+ $menuItem.data(\"window\") +\"']\").addClass(\"hasFocus\").show();\r\n\r\n\t\t\t\t\trefreshWindow();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-admin [data-sortable='true']\").tablesorter({\r\n\t\t\t\t\tsortReset: true,\r\n\t\t\t\t\twidgets: ['saveSort'],\r\n\t\t\t\t\tsortList: [[0,0]]\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// dialog bottom tray\r\n\t\t\t\t$($(this)[0].parentElement).find(\".ui-dialog-buttonpane\").append(\"<div class='ui-dialog-traypane'></div>\");\r\n\t\t\t\t$total = $(\"div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane\");\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$menuItem = $(\"#dialog-admin .menu li.active\");\r\n\t\t\t\trefreshWindow();\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tclearTimeout(refreshTimer);\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-admin\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-admin\").dialog(\"open\");\r\n\t}\r\n});\r\n","// Dialog effects\r\n$(\"#wrapper\").addClass(\"transition\");\r\n\r\n$(document).on(\"dialogopen\", \".ui-dialog\", function (event, ui) {\r\n\t// Add additional full screen overlay for 2nd level dialog\r\n\tif ($(\".ui-dialog:visible\").length == 2 && $(this).hasClass(\"dialog-modal\"))\r\n\t\t$(\"body\").append($(\"<div id='overlay' class='overlay' />\").css(\"z-index\", $(this).css(\"z-index\") - 1));\r\n\telse if ($(\"#overlay\"))\r\n\t\t$(\"#overlay\").css(\"z-index\", $(this).css(\"z-index\") - 1);\r\n\r\n\tif (!$(this).hasClass(\"dialog-noeffect\"))\r\n\t\t$(\"#wrapper\").addClass(\"blur\");\r\n});\r\n\r\n$(document).on(\"dialogclose\", \".ui-dialog\", function (event, ui) {\r\n\tif (!$(\".ui-dialog\").is(\":visible\"))\r\n\t\t$(\"#wrapper\").removeClass(\"blur\");\r\n\r\n\tif ($(\".ui-dialog:visible\").length == 1)\r\n\t\t$(\"#overlay\").remove();\r\n\telse if ($(\"#overlay\"))\r\n\t\t$(\"#overlay\").css(\"z-index\", $(this).css(\"z-index\") - 2);\r\n\r\n\t//if ($(\".ui-dialog:visible\").length == 0 && options.buttons.follow && viewingSystemID != tripwire.client.EVE.systemID)\r\n\t//\twindow.location = \"?system=\"+tripwire.client.EVE.systemName;\r\n});\r\n\r\n// Signature overwrite\r\n$(document).on(\"click\", \"#overwrite\", function() {\r\n\tvar payload = {\"signatures\": {\"remove\": []}, \"systemID\": viewingSystemID};\r\n\tvar undo = [];\r\n\r\n\tvar signature = tripwire.client.signatures[$(this).data(\"id\")];\r\n\tif (signature.type != \"wormhole\") {\r\n\t\tundo.push(signature);\r\n\t\tpayload.signatures.remove.push(signature.id);\r\n\t} else {\r\n\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n\t\tundo.push({\"wormhole\": wormhole, \"signatures\": [tripwire.client.signatures[wormhole.initialID], tripwire.client.signatures[wormhole.secondaryID]]});\r\n\t\tpayload.signatures.remove.push(wormhole);\r\n\t}\r\n\r\n\t$(\"#overwrite\").attr(\"disable\", true);\r\n\r\n\tvar success = function(data) {\r\n\t\tif (data.resultSet && data.resultSet[0].result == true) {\r\n\t\t\tValidationTooltips.close();\r\n\r\n\t\t\t$(\"#undo\").removeClass(\"disabled\");\r\n\t\t\tif (viewingSystemID in tripwire.signatures.undo) {\r\n\t\t\t\ttripwire.signatures.undo[viewingSystemID].push({action: \"remove\", signatures: undo});\r\n\t\t\t} else {\r\n\t\t\t\ttripwire.signatures.undo[viewingSystemID] = [{action: \"remove\", signatures: undo}];\r\n\t\t\t}\r\n\r\n\t\t\tsessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n\r\n\t\t\tif ($(\"#dialog-signature\").parent().find(\":button:contains('Save')\")) {\r\n\t\t\t\t$(\"#dialog-signature\").parent().find(\":button:contains('Save')\").click();\r\n\t\t\t} else {\r\n\t\t\t\t$(\"#dialog-signature\").parent().find(\":button:contains('Add')\").click();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tvar always = function() {\r\n\t\t$(\"#overwrite\").removeAttr(\"disable\");\r\n\t}\r\n\r\n\ttripwire.refresh('refresh', payload, success, always);\r\n});\r\n","$(\".options\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"disabled\"))\r\n\t\treturn false;\r\n\r\n\t$(\"#dialog-options\").dialog({\r\n\t\tautoOpen: false,\r\n\t\twidth: 450,\r\n\t\tminHeight: 400,\r\n\t\tmodal: true,\r\n\t\tbuttons: {\r\n\t\t\tSave: function() {\r\n\t\t\t\t// Options\r\n\t\t\t\tvar data = {mode: \"set\", options: JSON.stringify(options)};\r\n\t\t\t\tvar maskChange = false;\r\n\r\n\t\t\t\t$(\"#dialog-options\").parent().find(\".ui-dialog-buttonpane button:contains('Save')\").attr(\"disabled\", true).addClass(\"ui-state-disabled\");\r\n\r\n\t\t\t\toptions.chain.typeFormat = $(\"#dialog-options #typeFormat\").val();\r\n\t\t\t\toptions.chain.classFormat = $(\"#dialog-options #classFormat\").val();\r\n\t\t\t\t\r\n\t\t\t\toptions.chain.sigNameLocation = $(\"#dialog-options #chainSigNameLocation\").val();\r\n\t\t\t\toptions.chain.routingLimit = 1 * $(\"#dialog-options #chainRoutingLimit\").val();\r\n\t\t\t\toptions.chain.routeSecurity = $(\"#dialog-options #chainRouteSecurity\").val();\r\n\t\t\t\toptions.chain.routeIgnore.enabled = $(\"#dialog-options #route-ignore-enabled\").prop('checked');\r\n\t\t\t\toptions.chain.routeIgnore.systems = $(\"#dialog-options #route-ignore\").val().split(\",\").map(x => x.trim());\r\n\r\n\t\t\t\toptions.chain.gridlines = JSON.parse($(\"#dialog-options input[name=gridlines]:checked\").val());\r\n\r\n\t\t\t\toptions.chain[\"node-reference\"] = $(\"#dialog-options input[name=node-reference]:checked\").val();\r\n\t\t\t\t\r\n\t\t\t\toptions.chain.renderer = $(\"#dialog-options #renderer\").val();\r\n\r\n\t\t\t\toptions.signatures.editType = $(\"#dialog-options #editType\").val();\r\n\r\n\t\t\t\toptions.signatures.pasteLife = $(\"#dialog-options #pasteLife\").val();\r\n\r\n\t\t\t\toptions.signatures.copySeparator = $(\"#dialog-options #copySeparator\").val();\r\n\r\n\t\t\t\toptions.background = $(\"#dialog-options #background-image\").val();\r\n\r\n\t\t\t\toptions.uiscale = $(\"#dialog-options #uiscale-slider\").slider(\"value\");\r\n\r\n\t\t\t\tif (options.masks.active != $(\"#dialog-options input[name='mask']:checked\").val()) {\r\n\t\t\t\t\tmaskChange = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\toptions.masks.active = $(\"#dialog-options input[name='mask']:checked\").val();\r\n\r\n\t\t\t\toptions.apply();\r\n\t\t\t\toptions.save() // Performs AJAX\r\n\t\t\t\t\t.done(function() {\r\n\t\t\t\t\t\tif (maskChange) {\r\n\t\t\t\t\t\t\t// Reset signatures\r\n\t\t\t\t\t\t\t$(\"#sigTable span[data-age]\").countdown(\"destroy\");\r\n\t\t\t\t\t\t\t$(\"#sigTable tbody\").empty()\r\n\t\t\t\t\t\t\t$(\"#signature-count\").html(0);\r\n\t\t\t\t\t\t\ttripwire.signatures.list = {};\r\n\t\t\t\t\t\t\ttripwire.client.signatures = [];\r\n\r\n\t\t\t\t\t\t\ttripwire.refresh('change');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\r\n\t\t\t\t$(\"#dialog-options\").dialog(\"close\");\r\n\t\t\t\t$(\"#dialog-options\").parent().find(\".ui-dialog-buttonpane button:contains('Save')\").attr(\"disabled\", false).removeClass(\"ui-state-disabled\");\r\n\r\n\t\t\t\t// toggle mask admin icon\r\n\t\t\t\t$(\"#dialog-options input[name='mask']:checked\").data(\"admin\") ? $(\"#admin\").removeClass(\"disabled\") : $(\"#admin\").addClass(\"disabled\");\r\n\t\t\t},\r\n\t\t\tReset: function() {\r\n\t\t\t\t$(\"#dialog-confirm #msg\").html(\"Settings will be reset to defaults temporarily.<br/><br/><p><em>Save settings to make changes permanent.</em></p>\");\r\n\t\t\t\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tReset: function() {\r\n\t\t\t\t\t\t\toptions.reset();\r\n\t\t\t\t\t\t\toptions.apply();\r\n\r\n\t\t\t\t\t\t\t$(\"#dialog-options\").dialog(\"close\");\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}).dialog(\"open\");\r\n\t\t\t},\r\n\t\t\tClose: function() {\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t}\r\n\t\t},\r\n\t\topen: function() {\r\n\t\t\t// Get user stats data\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"user_stats.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tfor (i in data.stats) {\r\n\t\t\t\t\tfor (x in data.stats[i]) {\r\n\t\t\t\t\t\t$(\"#optionsAccordion #\"+ x).text(data.stats[i][x]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(\"#optionsAccordion #systems_visited\").text(data.system_visits);\r\n\t\t\t\t$(\"#optionsAccordion #logins\").text(data.account.logins);\r\n\t\t\t\t$(\"#optionsAccordion #lastLogin\").text(data.account.lastLogin);\r\n\t\t\t\t$(\"#optionsAccordion #username\").text(data.username);\r\n\t\t\t});\r\n\r\n\t\t\t// Get masks\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"masks.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(response) {\r\n\t\t\t\tif (response && response.masks) {\r\n\t\t\t\t\t$(\"#dialog-options #masks #default\").html(\"\");\r\n\t\t\t\t\t$(\"#dialog-options #masks #personal\").html(\"\");\r\n\t\t\t\t\t$(\"#dialog-options #masks #corporate\").html(\"\");\r\n\r\n\t\t\t\t\tfor (var x in response.masks) {\r\n\t\t\t\t\t\tvar mask = response.masks[x];\r\n\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t+ '<input type=\"radio\" name=\"mask\" id=\"mask'+x+'\" value=\"'+mask.mask+'\" class=\"selector\" data-owner=\"'+mask.owner+'\" data-admin=\"'+mask.admin+'\" />'\r\n\t\t\t\t\t\t\t+ '<label for=\"mask'+x+'\"><img src=\"'+mask.img+'\" />'\r\n\t\t\t\t\t\t\t+  (mask.optional ? '<i class=\"closeIcon\" onclick=\"return false;\" data-icon=\"red-giant\"><i data-icon=\"times\"></i></i>' : '')\r\n\t\t\t\t\t\t\t+ '<span class=\"selector_label\">'+mask.label+'</span></label>');\r\n\r\n\t\t\t\t\t\t$(\"#dialog-options #masks #\"+mask.type).append(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findp\" value=\"personal\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t+ '<label for=\"findp\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t$(\"#dialog-options #masks #personal\").append(node);\r\n\r\n\t\t\t\t\tif (init.admin == \"1\") {\r\n\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findc\" value=\"corporate\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t\t+ '<label for=\"findc\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t\t$(\"#dialog-options #masks #corporate\").append(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$(\"#dialog-options input[name='mask']\").filter(\"[value='\"+response.masks[response.active].mask+\"']\").attr(\"checked\", true).trigger(\"change\");\r\n\r\n\t\t\t\t\t// toggle mask admin icon\r\n\t\t\t\t\tresponse.masks[response.active].admin ? $(\"#admin\").removeClass(\"disabled\") : $(\"#admin\").addClass(\"disabled\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-options #editType\").val(options.signatures.editType);\r\n\t\t\t$(\"#dialog-options #pasteLife\").val(options.signatures.pasteLife);\r\n\t\t\t$(\"#dialog-options #copySeparator\").val(options.signatures.copySeparator);\r\n\t\t\t$(\"#dialog-options #typeFormat\").val(options.chain.typeFormat);\r\n\t\t\t$(\"#dialog-options #chainRoutingLimit\").val(options.chain.routingLimit);\r\n\t\t\t$(\"#dialog-options #chainSigNameLocation\").val(options.chain.sigNameLocation);\r\n\t\t\t$(\"#dialog-options #chainRouteSecurity\").val(options.chain.routeSecurity);\r\n\t\t\t$(\"#dialog-options #route-ignore-enabled\").prop('checked', options.chain.routeIgnore.enabled);\r\n\t\t\t$(\"#dialog-options #route-ignore\").val(options.chain.routeIgnore.systems.join(','));\r\n\t\t\t$(\"#dialog-options #renderer\").val(options.chain.renderer);\r\n\t\t\t$(\"#dialog-options #classFormat\").val(options.chain.classFormat);\r\n\t\t\t$(\"#dialog-options input[name='node-reference'][value='\"+options.chain[\"node-reference\"]+\"']\").prop(\"checked\", true);\r\n\t\t\t$(\"#dialog-options input[name='gridlines'][value='\"+options.chain.gridlines+\"']\").prop(\"checked\", true);\r\n\t\t\t$(\"#dialog-options #background-image\").val(options.background);\r\n\t\t},\r\n\t\tcreate: function() {\r\n\t\t\t$(\"#optionsAccordion\").accordion({heightStyle: \"content\", collapsible: true, active: false});\r\n\r\n\t\t\t$(\"#uiscale-slider\").slider({\r\n\t\t\t\tmin: 0.7,\r\n\t\t\t\tmax: 1.4,\r\n\t\t\t\tstep: 0.05,\r\n\t\t\t\tvalue: options.uiscale || 1.0,\r\n\t\t\t\tchange: function(e, ui) {\r\n\t\t\t\t\t$(\"body\").css(\"zoom\", ui.value);\r\n\t\t\t\t},\r\n\t\t\t\tslide: function(e, ui) {\r\n\t\t\t\t\t$(\"label[for='uiscale-slider']\").html(ui.value);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"label[for='uiscale-slider']\").html($(\"#uiscale-slider\").slider(\"value\"));\r\n\r\n\t\t\t$(\"#dialog-pwChange\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tresizable: false,\r\n\t\t\t\tminHeight: 0,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tSave: function() {\r\n\t\t\t\t\t\t$(\"#pwForm\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#pwForm input[name='password'], #pwForm input[name='confirm']\").val(\"\");\r\n\t\t\t\t\t$(\"#pwError\").text(\"\").hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#pwChange\").click(function() {\r\n\t\t\t\t$(\"#dialog-pwChange\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#pwForm\").submit(function(e) {\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t$(\"#pwError\").text(\"\").hide();\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: \"options.php\",\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t$(\"#dialog-msg #msg\").text(\"Password changed\");\r\n\t\t\t\t\t\t$(\"#dialog-msg\").dialog(\"open\");\r\n\r\n\t\t\t\t\t\t$(\"#dialog-pwChange\").dialog(\"close\");\r\n\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t$(\"#pwError\").text(response.error).show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#pwError\").text(\"Unknown error\").show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-usernameChange\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tresizable: false,\r\n\t\t\t\tminHeight: 0,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tSave: function() {\r\n\t\t\t\t\t\t$(\"#usernameForm\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\topen: function() {\r\n\t\t\t\t\t$(\"#usernameForm #username\").html($(\"#dialog-options #username\").html());\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#usernameForm [name='username']\").val(\"\");\r\n\t\t\t\t\t$(\"#usernameError\").text(\"\").hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#usernameChange\").click(function() {\r\n\t\t\t\t$(\"#dialog-usernameChange\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#usernameForm\").submit(function(e) {\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t$(\"#usernameError\").text(\"\").hide();\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: \"options.php\",\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t$(\"#dialog-msg #msg\").text(\"Username changed\");\r\n\t\t\t\t\t\t$(\"#dialog-msg\").dialog(\"open\");\r\n\r\n\t\t\t\t\t\t$(\"#dialog-options #username\").html(response.result);\r\n\r\n\t\t\t\t\t\t$(\"#dialog-usernameChange\").dialog(\"close\");\r\n\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t$(\"#usernameError\").text(response.error).show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#usernameError\").text(\"Unknown error\").show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Mask selections\r\n\t\t\t$(\"#masks\").on(\"change\", \"input.selector:checked\", function() {\r\n\t\t\t\tif ($(this).data(\"owner\")) {\r\n\t\t\t\t\t$(\"#maskControls #edit\").removeAttr(\"disabled\");\r\n\t\t\t\t\t$(\"#maskControls #delete\").removeAttr(\"disabled\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#maskControls #edit\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t\t$(\"#maskControls #delete\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($(this).val() != 0.0 && $(this).val().split(\".\")[1] == 0) {\r\n\t\t\t\t\t$(\"#dialog-options #leave\").removeAttr(\"disabled\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#dialog-options #leave\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Mask join\r\n\t\t\t$(\"#dialog-joinMask\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tresizable: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tAdd: function() {\r\n\t\t\t\t\t\tvar mask = $(\"#dialog-joinMask #results input:checked\");\r\n\t\t\t\t\t\tvar label = $(\"#dialog-joinMask #results input:checked+label\");\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: {mask: mask.val(), mode: \"join\"},\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\tlabel.css(\"width\", \"\");\r\n\t\t\t\t\t\t\t\tlabel.find(\".info\").remove();\r\n\t\t\t\t\t\t\t\tlabel.append('<i class=\"closeIcon\" onclick=\"return false;\" data-icon=\"red-giant\"><i data-icon=\"times\"></i></i>');\r\n\r\n\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #\"+response.type+\" input.selector:last\").before(mask).before(label);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-joinMask\").dialog(\"close\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#dialog-joinMask form\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$(\"#dialog-joinMask #results\").html(\"\");\r\n\t\t\t\t\t\t$(\"#dialog-joinMask #loading\").show();\r\n\t\t\t\t\t\t$(\"#dialog-joinMask input[type='submit']\").attr(\"disabled\", \"disabled\");\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).then(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.results && response.results.length) {\r\n\t\t\t\t\t\t\t\treturn tripwire.esi.fullLookup(response.eveIDs)\r\n\t\t\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\t\t\tif (results) {\r\n\t\t\t\t\t\t\t\t\t\t\tfor (var x in results) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar mask = response.results[x];\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"radio\" name=\"mask\" id=\"mask'+mask.mask+'\" value=\"'+mask.mask+'\" class=\"selector\" data-owner=\"false\" data-admin=\"'+mask.admin+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"mask'+mask.mask+'\" style=\"width: 100%; margin-left: -5px;\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"'+mask.img+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">'+mask.label+'</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name + '<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].category == \"character\" ? results[x].corporation.name +'<br/>' : null)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-joinMask #results\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(response.error);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unknown error\");\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).then(function() {\r\n\t\t\t\t\t\t\t$(\"#dialog-joinMask #loading\").hide();\r\n\t\t\t\t\t\t\t$(\"#dialog-joinMask input[type='submit']\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#dialog-joinMask #results\").html(\"\");\r\n\t\t\t\t\t$(\"#dialog-joinMask input[name='name']\").val(\"\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-options #masks\").on(\"click\", \"input[name='find']+label\", function() {\r\n\t\t\t\t$(\"#dialog-joinMask input[name='find']\").val($(this).prev().val());\r\n\t\t\t\t$(\"#dialog-joinMask\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// Mask leave\r\n\t\t\t$(\"#dialog-options #masks\").on(\"click\", \".closeIcon\", function() {\r\n\t\t\t\tvar mask = $(this).closest(\"input.selector+label\").prev();\r\n\r\n\t\t\t\t$(\"#dialog-confirm #msg\").text(\"Are you sure you want to remove this mask?\");\r\n\r\n\t\t\t\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tRemove: function() {\r\n\t\t\t\t\t\t\tvar send = {mode: \"leave\", mask: mask.val()};\r\n\r\n\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\t\tdata: send,\r\n\t\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t\tmask.next().remove();\r\n\t\t\t\t\t\t\t\t\tmask.remove();\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unable to delete\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}).dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// Mask delete\r\n\t\t\t$(\"#maskControls #delete\").click(function() {\r\n\t\t\t\tvar mask = $(\"#masks input.selector:checked\");\r\n\r\n\t\t\t\t$(\"#dialog-confirm #msg\").text(\"Are you sure you want to delete this mask?\");\r\n\t\t\t\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tDelete: function() {\r\n\t\t\t\t\t\t\tvar send = {mode: \"delete\", mask: mask.val()};\r\n\r\n\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\t\tdata: send,\r\n\t\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t\tmask.next().remove();\r\n\t\t\t\t\t\t\t\t\tmask.remove();\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unable to delete\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}).dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// User Create mask\r\n\t\t\t$(\"#dialog-createMask\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tCreate: function() {\r\n\t\t\t\t\t\t$(\"#dialog-createMask form\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#dialog-createMask #accessList\").on(\"click\", \"#create_add+label\", function() {\r\n\t\t\t\t\t\t$(\"#dialog-EVEsearch\").dialog(\"open\");\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-createMask form\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t// Get masks\r\n\t\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\t\t\tif (response && response.masks) {\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #default\").html(\"\");\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #personal\").html(\"\");\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #corporate\").html(\"\");\r\n\r\n\t\t\t\t\t\t\t\t\t\tfor (var x in response.masks) {\r\n\t\t\t\t\t\t\t\t\t\t\tvar mask = response.masks[x];\r\n\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"radio\" name=\"mask\" id=\"mask'+x+'\" value=\"'+mask.mask+'\" class=\"selector\" data-owner=\"'+mask.owner+'\" data-admin=\"'+mask.admin+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"mask'+x+'\"><img src=\"'+mask.img+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+  (mask.optional ? '<i class=\"closeIcon\" onclick=\"return false;\" data-icon=\"red-giant\"><i data-icon=\"times\"></i></i>' : '')\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<span class=\"selector_label\">'+mask.label+'</span></label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #\"+mask.type).append(node);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findp\" value=\"personal\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"findp\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #personal\").append(node);\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (init.admin == \"1\") {\r\n\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findc\" value=\"corporate\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"findc\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #corporate\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options input[name='mask']\").filter(\"[value='\"+response.masks[response.active].mask+\"']\").attr(\"checked\", true).trigger(\"change\");\r\n\r\n\t\t\t\t\t\t\t\t\t\t// toggle mask admin icon\r\n\t\t\t\t\t\t\t\t\t\tresponse.masks[response.active].admin ? $(\"#admin\").removeClass(\"disabled\") : $(\"#admin\").addClass(\"disabled\");\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t$(\"#dialog-createMask\").dialog(\"close\");\r\n\t\t\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(response.error);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unknown error\");\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-createMask select\").selectmenu({width: 100});\r\n\t\t\t\t},\r\n\t\t\t\topen: function() {\r\n\t\t\t\t\t$(\"#dialog-createMask input[name='name']\").val(\"\");\r\n\t\t\t\t\t$(\"#dialog-createMask #accessList :not(.static)\").remove();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#maskControls #create\").click(function() {\r\n\t\t\t\t$(\"#dialog-createMask\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-createMask #accessList\").on(\"click\", \".maskRemove\", function() {\r\n\t\t\t\t$(this).closest(\"input.selector+label\").prev().remove();\r\n\t\t\t\t$(this).closest(\"label\").remove();\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-editMask\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tSave: function() {\r\n\t\t\t\t\t\t$(\"#dialog-editMask form\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList\").on(\"click\", \".maskRemove\", function() {\r\n\t\t\t\t\t\t$(this).closest(\"input.selector+label\").prev().attr(\"name\", \"deletes[]\").hide();\r\n\t\t\t\t\t\t$(this).closest(\"label\").hide();\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList\").on(\"click\", \"#edit_add+label\", function() {\r\n\t\t\t\t\t\t$(\"#dialog-EVEsearch\").dialog(\"open\");\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-editMask form\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-editMask\").dialog(\"close\");\r\n\t\t\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(response.error);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unknown error\");\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\topen: function() {\r\n\t\t\t\t\tvar mask = $(\"#dialog-options input[name='mask']:checked\").val();\r\n\t\t\t\t\t$(\"#dialog-editMask input[name='mask']\").val(mask);\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList label.static\").hide();\r\n\t\t\t\t\t$(\"#dialog-editMask #loading\").show();\r\n\t\t\t\t\t$(\"#dialog-editMask #name\").text($(\"#dialog-options input[name='mask']:checked+label .selector_label\").text());\r\n\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\tdata: {mode: \"edit\", mask: mask},\r\n\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t}).then(function(response) {\r\n\t\t\t\t\t\tif (response && response.results && response.results.length) {\r\n\t\t\t\t\t\t\treturn tripwire.esi.fullLookup(response.results)\r\n\t\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\t\tif (results) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var x in results) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (results[x].category == \"character\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" checked=\"checked\" onclick=\"return false\" name=\"\" id=\"edit_'+results[x].id+'_1373\" value=\"'+results[x].id+'_1373\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"edit_'+results[x].id+'_1373\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Character/'+results[x].id+'_64.jpg\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Character</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name + '<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].corporation.name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t<input type=\"button\" class=\"maskRemove\" value=\"Remove\" style=\"position: absolute; bottom: 3px; right: 3px;\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-editMask #accessList .static:first\").before(node);\r\n\t\t\t\t\t\t\t\t\t\t\t} else if (results[x].category == \"corporation\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" checked=\"checked\" onclick=\"return false\" name=\"\" id=\"edit_'+results[x].id+'_2\" value=\"'+results[x].id+'_2\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"edit_'+results[x].id+'_2\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Corporation/'+results[x].id+'_64.png\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Corporation</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t<input type=\"button\" class=\"maskRemove\" value=\"Remove\" style=\"position: absolute; bottom: 3px; right: 3px;\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-editMask #accessList .static:first\").before(node);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).then(function(response) {\r\n\t\t\t\t\t\t$(\"#dialog-editMask #accessList label.static\").show();\r\n\t\t\t\t\t\t$(\"#dialog-editMask #loading\").hide();\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList :not(.static)\").remove();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#maskControls #edit\").click(function() {\r\n\t\t\t\t$(\"#dialog-editMask\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// EVE search dialog\r\n\t\t\t$(\"#dialog-EVEsearch\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tAdd: function() {\r\n\t\t\t\t\t\tif ($(\"#accessList input[value='\"+$(\"#EVESearchResults input\").val()+\"']\").length) {\r\n\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Already has access\");\r\n\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$(\"#EVESearchResults .info\").append('<input type=\"button\" class=\"maskRemove\" value=\"Remove\" style=\"position: absolute; bottom: 3px; right: 3px;\" />');\r\n\t\t\t\t\t\t$(\"#EVESearchResults input:checked\").attr(\"checked\", \"checked\");\r\n\t\t\t\t\t\t$(\"#EVESearchResults input:checked\").attr(\"onclick\", \"return false\");\r\n\r\n\t\t\t\t\t\tvar nodes = $(\"#EVESearchResults .maskNode:has(input:checked)\");\r\n\r\n\t\t\t\t\t\tif ($(\"#dialog-createMask\").dialog(\"isOpen\"))\r\n\t\t\t\t\t\t\t$(\"#dialog-createMask #accessList .static:first\").before(nodes);\r\n\t\t\t\t\t\telse if ($(\"#dialog-editMask\").dialog(\"isOpen\"))\r\n\t\t\t\t\t\t\t$(\"#dialog-editMask #accessList .static:first\").before(nodes);\r\n\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t},\r\n\t\t\t\t\tClose: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#EVEsearch\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\tif ($(\"#EVEsearch input[name='name']\").val() == \"\") {\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$(\"#EVESearchResults, #searchCount\").html(\"\");\r\n\t\t\t\t\t\t$(\"#EVEsearch #searchSpinner\").show();\r\n\t\t\t\t\t\t$(\"#EVEsearch input[type='submit']\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t\t\t$(\"#dialog-EVEsearch\").parent().find(\".ui-dialog-buttonpane button:contains('Add')\").attr(\"disabled\", true).addClass(\"ui-state-disabled\");\r\n\r\n\t\t\t\t\t\ttripwire.esi.search($(\"#EVEsearch input[name='name']\").val(), $(\"#EVEsearch input[name='category']:checked\").val(), $(\"#EVEsearch input[name='exact']\")[0].checked)\r\n\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\tif (results && (results.character || results.corporation)) {\r\n\t\t\t\t\t\t\t\t\t// limit results\r\n\t\t\t\t\t\t\t\t\tresults = $.merge(results.character || [], results.corporation || []);\r\n\t\t\t\t\t\t\t\t\ttotal = results.length;\r\n\t\t\t\t\t\t\t\t\tresults = results.slice(0, 10);\r\n\t\t\t\t\t\t\t\t\treturn tripwire.esi.fullLookup(results)\r\n\t\t\t\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#EVEsearch #searchCount\").html(\"Found: \"+total+\"<br/>Showing: \"+(total<10?total:10));\r\n\t\t\t\t\t\t\t\t\t\t\tif (results) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tfor (var x in results) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (results[x].category == \"character\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<div class=\"maskNode\"><input type=\"checkbox\" name=\"adds[]\" id=\"find_'+results[x].id+'_1373\" value=\"'+results[x].id+'_1373\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"find_'+results[x].id+'_1373\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Character/'+results[x].id+'_64.jpg\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Character</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name + '<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].corporation.name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label></div>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(\"#EVESearchResults\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (results[x].category == \"corporation\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<div class=\"maskNode\"><input type=\"checkbox\" name=\"adds[]\" id=\"find_'+results[x].id+'_2\" value=\"'+results[x].id+'_2\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"find_'+results[x].id+'_2\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Corporation/'+results[x].id+'_64.png\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Corporation</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label></div>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(\"#EVESearchResults\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}).always(function() {\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#EVEsearch #searchSpinner\").hide();\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#EVEsearch input[type='submit']\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-EVEsearch\").parent().find(\".ui-dialog-buttonpane button:contains('Add')\").removeAttr(\"disabled\").removeClass(\"ui-state-disabled\");\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"No Results\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#EVEsearch #searchSpinner\").hide();\r\n\t\t\t\t\t\t\t\t\t$(\"#EVEsearch input[type='submit']\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-EVEsearch\").parent().find(\".ui-dialog-buttonpane button:contains('Add')\").removeAttr(\"disabled\").removeClass(\"ui-state-disabled\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#EVEsearch input[name='name']\").val(\"\");\r\n\t\t\t\t\t$(\"#EVESearchResults, #searchCount\").html(\"\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\t$(\"#dialog-options\").dialog(\"open\");\r\n});\r\n","$(\"#signaturesWidget\").on(\"click\", \"#delete-signature\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).closest(\"tr\").attr(\"disabled\")) {\r\n\t\treturn false;\r\n\t} else if ($(\"#sigTable tr.selected\").length == 0) {\r\n\t\treturn false;\r\n\t} else if ($(\"#dialog-sigEdit\").hasClass(\"ui-dialog-content\") && $(\"#dialog-sigEdit\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-sigEdit\").parent().effect(\"shake\", 300);\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-deleteSig\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-deleteSig\").dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tDelete: function() {\r\n\t\t\t\t\t// Prevent duplicate submitting\r\n\t\t\t\t\t$(\"#dialog-deleteSig\").parent().find(\":button:contains('Delete')\").button(\"disable\");\r\n\t\t\t\t\tvar payload = {\"signatures\": {\"remove\": []}, \"systemID\": viewingSystemID};\r\n\t\t\t\t\tvar undo = [];\r\n\r\n\t\t\t\t\tvar signatures = $.map($(\"#sigTable tr.selected\"), function(n) {\r\n\t\t\t\t\t\tvar signature = tripwire.client.signatures[$(n).data(\"id\")];\r\n\t\t\t\t\t\tif (signature.type != \"wormhole\") {\r\n\t\t\t\t\t\t\tundo.push(signature);\r\n\t\t\t\t\t\t\treturn signature.id;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n\t\t\t\t\t\t\tundo.push({\"wormhole\": wormhole, \"signatures\": [tripwire.client.signatures[wormhole.initialID], tripwire.client.signatures[wormhole.secondaryID]]});\r\n\t\t\t\t\t\t\treturn wormhole;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tpayload.signatures.remove = signatures;\r\n\r\n\t\t\t\t\tvar success = function(data) {\r\n\t\t\t\t\t\tif (data.resultSet && data.resultSet[0].result == true) {\r\n\t\t\t\t\t\t\t$(\"#dialog-deleteSig\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t$(\"#undo\").removeClass(\"disabled\");\r\n\t\t\t\t\t\t\tif (viewingSystemID in tripwire.signatures.undo) {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[viewingSystemID].push({action: \"remove\", signatures: undo});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[viewingSystemID] = [{action: \"remove\", signatures: undo}];\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tsessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar always = function(data) {\r\n\t\t\t\t\t\t$(\"#dialog-deleteSig\").parent().find(\":button:contains('Delete')\").button(\"enable\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttripwire.refresh('refresh', payload, success, always);\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\t$(\"#sigTable tr.selected\").removeClass(\"selected\");\r\n\t\t\t\t//$(\"#sigTable .sigDelete\").removeClass(\"invisible\");\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-deleteSig\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-deleteSig\").dialog(\"open\");\r\n\t}\r\n});\r\n","$(\"#sigTable tbody\").on(\"dblclick\", \"tr\", {mode: \"update\", source:\"sig-row\"}, openSignatureDialog);\r\n$(\"#edit-signature\").on(\"click\", {mode: \"update\", source:\"edit-sig\"}, openSignatureDialog);\r\n$(\"#add-signature\").click({mode: \"add\"}, openSignatureDialog);\r\n\r\nconst sigDialogVM = {};\r\nfunction openSignatureDialog(e) {\r\n\tif(e.preventDefault) { e.preventDefault(); }\t// Allow calls with fake event-like objects too\r\n\tsigDialogVM.mode = e.data.mode;\r\n\t\r\n\tswitch(sigDialogVM.mode) {\r\n\t\tcase 'update':\r\n\t\t\tif (e.data.source == \"sig-row\") {\r\n\t\t\t\t$(\"#sigTable tr.selected\").removeClass(\"selected\");\r\n\t\t\t\t$(this).closest(\"tr\").addClass(\"selected\");\r\n\t\t\t\tsigDialogVM.sigId = $(this).data('id');\r\n\t\t\t} else if (e.data.source == \"edit-sig\") {\r\n\t\t\t\tvar elements = $(\"#sigTable tbody tr.selected\");\r\n\t\t\t\tif (elements.length !== 1) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsigDialogVM.sigId = $(elements[0]).data('id');\r\n\t\t\t\t}\r\n\t\t\t} else { sigDialogVM.sigId = e.data.signature; }\r\n\t\t\tbreak;\r\n\t\tdefault: delete sigDialogVM.sigId;\r\n\t}\r\n\t\r\n\tsigDialogVM.viewingSystemID = (tripwire.client.signatures[sigDialogVM.sigId] || {systemID: viewingSystemID }).systemID;\r\n\tsigDialogVM.viewingSystem = tripwire.systems[sigDialogVM.viewingSystemID];\r\n\t\r\n\tif (!$(\"#dialog-signature\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-signature\").dialog({\r\n\t\t\tautoOpen: true,\r\n\t\t\tresizable: false,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tposition: {my: \"center\", at: \"center\", of: $(\"#signaturesWidget\")},\r\n\t\t\tbuttons: {\r\n\t\t\t\tSave: function() {\r\n\t\t\t\t\t$(\"#form-signature\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tAdd: function() {\r\n\t\t\t\t\t$(\"#form-signature\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\tvar aSigWormholes = $.map(tripwire.wormholes, function(item, index) { return index;});\r\n\t\t\t\taSigWormholes.splice(26, 0, \"K162\");\r\n\t\t\t\taSigWormholes.push(\"GATE\");\r\n\t\t\t\taSigWormholes.push(\"SML\");\r\n\t\t\t\taSigWormholes.push(\"MED\");\r\n\t\t\t\taSigWormholes.push(\"LRG\");\r\n\t\t\t\taSigWormholes.push(\"XLG\");\r\n\r\n\t\t\t\t$(\"#dialog-signature [name='signatureType'], #dialog-signature [name='signatureLife']\").selectmenu({width: 100});\r\n\t\t\t\t$(\"#dialog-signature [name='wormholeLife'], #dialog-signature [name='wormholeMass']\").selectmenu({width: 80});\r\n\t\t\t\t$(\"#dialog-signature [data-autocomplete='sigSystems']\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0});\r\n\t\t\t\t$(\"#dialog-signature [data-autocomplete='sigType']\").inlinecomplete({source: aSigWormholes, maxSize: 10, delay: 0});\r\n\r\n\t\t\t\t$(\"#dialog-signature #durationPicker\").durationPicker();\r\n\t\t\t\t$(\"#dialog-signature #durationPicker\").on(\"change\", function() {\r\n\t\t\t\t\t// prevent negative values\r\n\t\t\t\t\tif (this.value < 0) {\r\n\t\t\t\t\t\tthis.value = 0;\r\n\t\t\t\t\t\t$(this).change();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Ensure first signature ID field only accepts letters\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID_Alpha'], #dialog-signature [name='signatureID2_Alpha']\").on(\"input\", function() {\r\n\t\t\t\t\twhile (!/^[a-zA-Z?]*$/g.test(this.value)) {\r\n\t\t\t\t\t\tthis.value = this.value.substring(0, this.value.length -1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Move to the numeric ID after filling out alpha ID\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID_Alpha']\").on(\"input\", function() {\r\n\t\t\t\t\tif (this.value.length === 3) {\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureID_Numeric']\").select();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID2_Alpha']\").on(\"input\", function() {\r\n\t\t\t\t\tif (this.value.length === 3) {\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureID2_Numeric']\").select();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Ensure second signature ID field only accepts numbers\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID_Numeric'], #dialog-signature [name='signatureID2_Numeric']\").on(\"input\", function() {\r\n\t\t\t\t\twhile (!/^[0-9?]*$/g.test(this.value)) {\r\n\t\t\t\t\t\tthis.value = this.value.substring(0, this.value.length -1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Select value on click\r\n\t\t\t\t$(\"#dialog-signature .signatureID, #dialog-signature .wormholeType\").on(\"click\", function() {\r\n\t\t\t\t\t$(this).select();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Auto fill opposite side wormhole w/ K162\r\n\t\t\t\t$(\"#dialog-signature .wormholeType\").on(\"input, change\", function() {\r\n\t\t\t\t\tif (this.value.length > 0 && $.inArray(this.value.toUpperCase(), aSigWormholes) != -1 && this.value.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature .wormholeType\").not(this).val(\"K162\");\r\n\r\n\t\t\t\t\t\t// Also auto calculate duration\r\n\t\t\t\t\t\tif (tripwire.wormholes[this.value.toUpperCase()]) {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature #durationPicker\").val(tripwire.wormholes[this.value.toUpperCase()].life.substring(0, 2) * 60 * 60).change();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (this.value.toUpperCase() === \"K162\") {\r\n\t\t\t\t\t\tif ($.inArray($(\"#dialog-signature .wormholeType\").not(this).val().toUpperCase(), aSigWormholes) === -1 || $(\"#dialog-signature .wormholeType\").not(this).val().toUpperCase() === \"K162\") {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature .wormholeType\").not(this).val(\"????\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (this.value == \"????\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature .wormholeType\").not(this).val(\"K162\");\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Toggle between wormhole and regular signatures\r\n\t\t\t\t$(\"#dialog-signature\").on(\"selectmenuchange\", \"[name='signatureType']\", function() {\r\n\t\t\t\t\tif (this.value == \"wormhole\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature #site\").slideUp(200, function() { $(this).hide(0); });\r\n\t\t\t\t\t\t$(\"#dialog-signature #wormhole\").slideDown(200, function() { $(this).show(200); });\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#dialog-signature #site\").slideDown(200, function() { $(this).show(200); });\r\n\t\t\t\t\t\t$(\"#dialog-signature #wormhole\").slideUp(200, function() { $(this).hide(0); });\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tValidationTooltips.close();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#form-signature\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar form = $(this).serializeObject();\r\n\t\t\t\t\tvar valid = true;\r\n\t\t\t\t\tValidationTooltips.close();\r\n\r\n\t\t\t\t\t// Validate full signature ID fields (blank | 3 characters)\r\n\t\t\t\t\t$.each($(\"#dialog-signature .signatureID:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && this.value.length < 3) {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Must be 3 characters in length!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate full signature ID doesn't already exist in current system\r\n\t\t\t\t\tif (form.signatureID_Alpha.length === 3 && form.signatureID_Numeric.length === 3 && Object.find(tripwire.client.signatures, \"signatureID\", form.signatureID_Alpha + form.signatureID_Numeric, true) != false && Object.find(tripwire.client.signatures, \"signatureID\", form.signatureID_Alpha + form.signatureID_Numeric, true).id != $(\"#dialog-signature\").data(\"signatureid\")) {\r\n\t\t\t\t\t\tvar existingSignature = Object.find(tripwire.client.signatures, \"signatureID\", form.signatureID_Alpha + form.signatureID_Numeric);\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-signature .signatureID:first\")}).setContent(\"Signature ID already exists! <input type='button' autofocus='true' id='overwrite' value='Overwrite' style='margin-bottom: -4px; margin-top: -4px; font-size: 0.8em;' data-id='\"+ existingSignature.id +\"' />\");\r\n\t\t\t\t\t\t$(\"#overwrite\").focus();\r\n\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate wormhole types (blank | wormhole)\r\n\t\t\t\t\t$.each($(\"#dialog-signature .wormholeType:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && $.inArray(this.value.toUpperCase(), aSigWormholes) == -1 && this.value != \"????\") {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Must be a valid wormhole type!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate leads to system (blank | system)\r\n\t\t\t\t\t$.each($(\"#dialog-signature .leadsTo:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && tripwire.aSigSystems.findIndex((item) => this.value.toLowerCase() === item.toLowerCase()) == -1) {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Must be a valid leads to system!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate leads to isn't the viewing system which causes a inner loop\r\n\t\t\t\t\t$.each($(\"#dialog-signature .leadsTo:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && this.value.toLowerCase() === sigDialogVM.viewingSystem.name.toLowerCase()) {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Wormhole cannot lead to the same system it comes from!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\tvar payload = {};\r\n\t\t\t\t\tvar undo = [];\r\n\t\t\t\t\tif (form.signatureType === \"wormhole\") {\r\n\t\t\t\t\t\tvar signature = {\r\n\t\t\t\t\t\t\t\"signatureID\": form.signatureID_Alpha + form.signatureID_Numeric,\r\n\t\t\t\t\t\t\t\"systemID\": sigDialogVM.viewingSystemID,\r\n\t\t\t\t\t\t\t\"type\": \"wormhole\",\r\n\t\t\t\t\t\t\t\"name\": form.wormholeName,\r\n\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tvar leadsTo = null;\r\n\t\t\t\t\t\tif (Object.index(tripwire.systems, \"name\", form.leadsTo, true)) {\r\n\t\t\t\t\t\t\t// Leads To is a normal EVE system, so use the sytem ID\r\n\t\t\t\t\t\t\tleadsTo = Object.index(tripwire.systems, \"name\", form.leadsTo, true)\r\n\t\t\t\t\t\t} else if (tripwire.wormholes[form.wormholeType.toUpperCase()]) {\r\n\t\t\t\t\t\t\t// Leads To can be determined by the wormhole type, so lets use what we know it leads to\r\n\t\t\t\t\t\t\tif (tripwire.aSigSystems.findIndex((item) => tripwire.wormholes[form.wormholeType.toUpperCase()].leadsTo.replace(' ', '-').toLowerCase() === item.toLowerCase()) > -1) {\r\n\t\t\t\t\t\t\t\tleadsTo = tripwire.aSigSystems.findIndex((item) => tripwire.wormholes[form.wormholeType.toUpperCase()].leadsTo.replace(' ', '-').toLowerCase() === item.toLowerCase());\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (tripwire.aSigSystems.findIndex((item) => form.leadsTo.toLowerCase() === item.toLowerCase()) !== -1) {\r\n\t\t\t\t\t\t\t// Leads To is one of the valid types we allow, so use of of those indexes as reference\r\n\t\t\t\t\t\t\tleadsTo = tripwire.aSigSystems.findIndex((item) => form.leadsTo.toLowerCase() === item.toLowerCase());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar signature2 = {\r\n\t\t\t\t\t\t\t\"signatureID\": form.signatureID2_Alpha + form.signatureID2_Numeric,\r\n\t\t\t\t\t\t\t\"systemID\": leadsTo,\r\n\t\t\t\t\t\t\t\"type\": \"wormhole\",\r\n\t\t\t\t\t\t\t\"name\": form.wormholeName2,\r\n\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tvar type = null;\r\n\t\t\t\t\t\tvar parent = null;\r\n\t\t\t\t\t\tif (form.wormholeType.length > 0 && $.inArray(form.wormholeType.toUpperCase(), aSigWormholes) != -1 && form.wormholeType.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t\tparent = \"initial\";\r\n\t\t\t\t\t\t\ttype = form.wormholeType.toUpperCase();\r\n\t\t\t\t\t\t} else if (form.wormholeType2.length > 0 && $.inArray(form.wormholeType2.toUpperCase(), aSigWormholes) != -1 && form.wormholeType2.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t\tparent = \"secondary\";\r\n\t\t\t\t\t\t\ttype = form.wormholeType2.toUpperCase();\r\n\t\t\t\t\t\t} else if (form.wormholeType.toUpperCase() == \"K162\") {\r\n\t\t\t\t\t\t\tparent = \"secondary\";\r\n\t\t\t\t\t\t\ttype = \"????\";\r\n\t\t\t\t\t\t} else if (form.wormholeType2.toUpperCase() == \"K162\") {\r\n\t\t\t\t\t\t\tparent = \"initial\";\r\n\t\t\t\t\t\t\ttype = \"????\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar wormhole = {\r\n\t\t\t\t\t\t\t\"type\": type,\r\n\t\t\t\t\t\t\t\"parent\": parent,\r\n\t\t\t\t\t\t\t\"life\": form.wormholeLife,\r\n\t\t\t\t\t\t\t\"mass\": form.wormholeMass\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tif (sigDialogVM.mode == \"update\") {\r\n\t\t\t\t\t\t\tsignature.id = $(\"#dialog-signature\").data(\"signatureid\");\r\n\t\t\t\t\t\t\tsignature2.id = $(\"#dialog-signature\").data(\"signature2id\");\r\n\t\t\t\t\t\t\twormhole.id = $(\"#dialog-signature\").data(\"wormholeid\");\r\n\r\n\t\t\t\t\t\t\t// Update the initial and type based on which side of the wormhole we are editing\r\n\t\t\t\t\t\t\tif (tripwire.client.wormholes[wormhole.id]) {\r\n\t\t\t\t\t\t\t\tif (form.wormholeType.length > 0 && $.inArray(form.wormholeType.toUpperCase(), aSigWormholes) != -1 && form.wormholeType.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t\t\t\twormhole.parent = tripwire.client.wormholes[wormhole.id].initialID == signature.id ? \"initial\" : \"secondary\";\r\n\t\t\t\t\t\t\t\t\twormhole.type = form.wormholeType.toUpperCase();\r\n\t\t\t\t\t\t\t\t} else if (form.wormholeType2.length > 0 && $.inArray(form.wormholeType2.toUpperCase(), aSigWormholes) != -1 && form.wormholeType2.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t\t\t\twormhole.parent = tripwire.client.wormholes[wormhole.id].initialID == signature.id ? \"secondary\" : \"initial\";\r\n\t\t\t\t\t\t\t\t\twormhole.type = form.wormholeType2.toUpperCase();\r\n\t\t\t\t\t\t\t\t} else if (form.wormholeType.toUpperCase() == \"K162\") {\r\n\t\t\t\t\t\t\t\t\twormhole.parent = tripwire.client.wormholes[wormhole.id].initialID == signature.id ? \"secondary\" : \"initial\";\r\n\t\t\t\t\t\t\t\t\twormhole.type = \"????\";\r\n\t\t\t\t\t\t\t\t} else if (form.wormholeType2.toUpperCase() == \"K162\") {\r\n\t\t\t\t\t\t\t\t\twormhole.parent = tripwire.client.wormholes[wormhole.id].initialID == signature.id ? \"initial\" : \"secondary\";\r\n\t\t\t\t\t\t\t\t\twormhole.type = \"????\";\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"update\": [{\"wormhole\": wormhole, \"signatures\": [signature, signature2]}]}};\r\n\r\n\t\t\t\t\t\t\tif (tripwire.client.wormholes[wormhole.id]) {\r\n\t\t\t\t\t\t\t\t\t//used to be a wormhole\r\n\t\t\t\t\t\t\t\t\tundo.push({\"wormhole\": tripwire.client.wormholes[wormhole.id], \"signatures\": [tripwire.client.signatures[signature.id], tripwire.client.signatures[signature2.id]]});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t// used to be just a regular signature\r\n\t\t\t\t\t\t\t\t\tundo.push(tripwire.client.signatures[signature.id]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"add\": [{\"wormhole\": wormhole, \"signatures\": [signature, signature2]}]}};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (sigDialogVM.mode == \"update\") {\r\n\t\t\t\t\t\t\tvar signature = {\r\n\t\t\t\t\t\t\t\t\"id\": $(\"#dialog-signature\").data(\"signatureid\"),\r\n\t\t\t\t\t\t\t\t\"signatureID\": form.signatureID_Alpha + form.signatureID_Numeric,\r\n\t\t\t\t\t\t\t\t\"systemID\": sigDialogVM.viewingSystemID,\r\n\t\t\t\t\t\t\t\t\"type\": form.signatureType,\r\n\t\t\t\t\t\t\t\t\"name\": form.signatureName,\r\n\t\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"update\": [signature]}};\r\n\r\n\t\t\t\t\t\t\tif (tripwire.client.signatures[signature.id].type == \"wormhole\") {\r\n\t\t\t\t\t\t\t\t//used to be a wormhole\r\n\t\t\t\t\t\t\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n\t\t\t\t\t\t\t\tvar signature2 = signature.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t\t\t\t\tundo.push({\"wormhole\": tripwire.client.wormholes[wormhole.id], \"signatures\": [tripwire.client.signatures[signature.id], tripwire.client.signatures[signature2.id]]});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t// used to be just a regular signature\r\n\t\t\t\t\t\t\t\tundo.push(tripwire.client.signatures[signature.id]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar signature = {\r\n\t\t\t\t\t\t\t\t\"signatureID\": form.signatureID_Alpha + form.signatureID_Numeric,\r\n\t\t\t\t\t\t\t\t\"systemID\": sigDialogVM.viewingSystemID,\r\n\t\t\t\t\t\t\t\t\"type\": form.signatureType,\r\n\t\t\t\t\t\t\t\t\"name\": form.signatureName,\r\n\t\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"add\": [signature]}};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\":button:contains('Save')\").button(\"disable\");\r\n\r\n\t\t\t\t\tvar success = function(data) {\r\n\t\t\t\t\t\tif (data.resultSet && data.resultSet[0].result == true) {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t$(\"#undo\").removeClass(\"disabled\");\r\n\r\n\t\t\t\t\t\t\tif (sigDialogVM.mode == \"add\") {\r\n\t\t\t\t\t\t\t\tundo = data.results;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (sigDialogVM.viewingSystemID in tripwire.signatures.undo) {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[sigDialogVM.viewingSystemID].push({action: sigDialogVM.mode, signatures: undo});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[sigDialogVM.viewingSystemID] = [{action: sigDialogVM.mode, signatures: undo}];\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tsessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar always = function() {\r\n\t\t\t\t\t\t$(\"#sigEditForm input[type=submit]\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t$(\"#dialog-signature\").parent().find(\":button:contains('Save')\").button(\"enable\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttripwire.refresh('refresh', payload, success, always);\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$(\"#dialog-signature\").data(\"signatureid\", \"\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"signature2id\", \"\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"wormholeid\", \"\");\r\n\r\n\t\t\t\t$(\"#dialog-signature input\").val(\"\");\r\n\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(\"unknown\").selectmenu(\"refresh\");\r\n\r\n\t\t\t\t$(\"#dialog-signature [name='wormholeLife']\").val(\"stable\").selectmenu(\"refresh\");\r\n\t\t\t\t$(\"#dialog-signature [name='wormholeMass']\").val(\"stable\").selectmenu(\"refresh\");\r\n\r\n\t\t\t\t$(\"#dialog-signature #site\").show();\r\n\t\t\t\t$(\"#dialog-signature #wormhole\").hide();\r\n\r\n\t\t\t\t// Side labels\r\n\t\t\t\t$(\"#dialog-signature .sideLabel:first\").html(sigDialogVM.viewingSystem.name + \" Side\");\r\n\t\t\t\t$(\"#dialog-signature .sideLabel:last\").html(\"Other Side\");\r\n\r\n\t\t\t\t// Default signature life\r\n\t\t\t\t$(\"#dialog-signature #durationPicker\").val(options.signatures.pasteLife * 60 * 60).change();\r\n\r\n\t\t\t\tvar id = sigDialogVM.sigId;\r\n\t\t\t\tif (sigDialogVM.mode == \"update\" && id && tripwire.client.signatures[id]) {\r\n\t\t\t\t\tvar signature = tripwire.client.signatures[id];\r\n\t\t\t\t\t$(\"#dialog-signature\").data(\"signatureid\", id);\r\n\r\n\t\t\t\t\t// Change the dialog buttons\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Add')\").hide();\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Save')\").show();\r\n\r\n\t\t\t\t\t// Change the dialog title\r\n\t\t\t\t\t$(\"#dialog-signature\").dialog(\"option\", \"title\", \"Edit Signature\");\r\n\r\n\t\t\t\t\tif (signature.type == \"wormhole\") {\r\n\t\t\t\t\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == id || wormhole.secondaryID == id) return wormhole; })[0];\r\n\t\t\t\t\t\tvar otherSignature = id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t\t\t$(\"#dialog-signature\").data(\"signature2id\", otherSignature.id);\r\n\t\t\t\t\t\t$(\"#dialog-signature\").data(\"wormholeid\", wormhole.id);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst sigAlpha = signature.signatureID ? signature.signatureID.substr(0, 3) : \"???\";\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Alpha']\").val(sigAlpha);\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Numeric']\").val(signature.signatureID ? signature.signatureID.substr(3, 5) : \"\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(signature.type).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeName']\").val(signature.name);\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='leadsTo']\").val(tripwire.systems[otherSignature.systemID] ? tripwire.systems[otherSignature.systemID].name : (tripwire.aSigSystems[otherSignature.systemID] ? tripwire.aSigSystems[otherSignature.systemID] : \"\"));\r\n\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID2_Alpha']\").val(otherSignature.signatureID ? otherSignature.signatureID.substr(0, 3) : \"???\");\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID2_Numeric']\").val(otherSignature.signatureID ? otherSignature.signatureID.substr(3, 5) : \"\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeName2']\").val(otherSignature.name);\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeLife']\").val(wormhole.life).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeMass']\").val(wormhole.mass).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\r\n\t\t\t\t\t\tif (wormhole[wormhole.parent+\"ID\"] == signature.id) {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature input[name='wormholeType']\").val(wormhole.type).change();\r\n\t\t\t\t\t\t} else if (wormhole[wormhole.parent+\"ID\"] == otherSignature.id) {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature input[name='wormholeType2']\").val(wormhole.type).change();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$(\"#dialog-signature #durationPicker\").val(signature.lifeLength).change();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Focus the sig ID, if it isn't set, otherwise the sig name\r\n\t\t\t\t\t\tif(sigAlpha != '???') { $(\"#dialog-signature input[name='wormholeName']\").select(); }\r\n\t\t\t\t\t\telse { $(\"#dialog-signature input[name='signatureID_Alpha']\").select(); }\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Alpha']\").val(signature.signatureID ? signature.signatureID.substr(0, 3) : \"???\");\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Numeric']\").val(signature.signatureID ? signature.signatureID.substr(3, 5) : \"\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(signature.type).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureName']\").val(signature.name);\r\n\t\t\t\t\t\t$(\"#dialog-signature #durationPicker\").val(signature.lifeLength).change();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Not a wormhole - always focus the sig ID\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Alpha']\").select();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Hightlight first ID section, if not set, otherwise the name\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Change the dialog buttons\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Add')\").show();\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Save')\").hide();\r\n\r\n\t\t\t\t\t// Change the dialog title\r\n\t\t\t\t\t$(\"#dialog-signature\").dialog(\"option\", \"title\", \"Add Signature\");\r\n\r\n\t\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(options.signatures.editType || \"unknown\").selectmenu(\"refresh\")\r\n\t\t\t\t\tif ($(\"#dialog-signature [name='signatureType']\").val() === \"wormhole\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature #site\").hide();\r\n\t\t\t\t\t\t$(\"#dialog-signature #wormhole\").show();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tValidationTooltips.close();\r\n\t\t\t\t$(\"#sigTable tr.selected\").removeClass(\"selected\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"signatureid\", \"\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"signature2id\", \"\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"wormholeid\", \"\");\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-signature\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-signature\").dialog(\"open\");\r\n\t}\r\n};\r\n"]}