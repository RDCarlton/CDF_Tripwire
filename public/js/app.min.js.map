{"version":3,"sources":["helpers.js","init.js","options.js","layout.js","tripwire.js","global-hooks.js","active.js","addSignature.js","api.js","automapper.js","comments.js","deleteSignature.js","editSignature.js","esi.js","eve.js","parse.js","paste.js","redo.js","serverStatus.js","sync.js","systemChange.js","tutorials.js","undo.js","activity-graph.js","chain-map.js","ckeditor.js","guidance.js","dialogs/admin-dialog.js","dialogs/base-dialog.js","dialogs/options-dialog.js","dialogs/signature-add-dialog.js","dialogs/signature-delete-dialog.js","dialogs/signature-dialog.js","dialogs/signature-edit-dialog.js"],"names":["Object","sort","obj","prop","swapped","prev","i","Number","tmp","index","val","cs","key","toLowerCase","find","maxTime","maxTimeString","Date","size","hasOwnProperty","time","dates","push","length","getTime","$","fn","serializeObject","self","this","json","push_counters","patterns","validate","fixed","named","build","base","value","push_counter","undefined","each","serializeArray","test","name","k","keys","match","merge","reverse_key","pop","replace","RegExp","extend","jQuery","numFormat","num","n","toString","split","join","letterToNumbers","string","toUpperCase","letters","sum","Math","pow","indexOf","substr","sigFormat","input","type","alpha","numeric","format","options","chain","typeFormat","classFormat","x","l","sigClass","id","map","tripwire","systems","system","class","security","systemType","wormholes","leadsTo","isEmpty","getCookie","c_name","c_value","document","cookie","c_start","c_end","unescape","substring","setCookie","exdays","exdate","setDate","getDate","escape","toUTCString","location","protocol","viewingSystem","attr","viewingSystemID","server","app_name","html","localOverrides","localOptions","JSON","parse","localStorage","getItem","userID","init","character","characterID","characterName","background","uiscale","favorites","grid","tracking","active","masks","corporationID","gridlines","tabs","node-reference","signatures","pasteLife","alignment","sigID","sigType","sigAge","sigLife","sigMass","buttons","follow","chainWidget","viewing","signaturesWidget","autoMapper","save","stringify","get","setItem","ajax","url","data","mode","dataType","load","set","apply","local","constructor","reset","defaults","oog","data-col","col","data-row","row","data-sizex","size_x","data-sizey","size_y","css","width","height","favorite","parseInt","addClass","home","kspace","evescout","inArray","a","href","hostname","pathname","search","filter","$tab","clone","systemID","append","redraw","gridster","widget_selector","avoid_overlapped_widgets","widget_base_dimensions","widget_margins","autogrow_cols","helper","draggable","start","e","ui","resize","enabled","handle_class","max_size","min_size","stop","$widget","setTimeout","serialize_params","$w","wgd","disable","disable_resize","visibility","click","hasClass","removeClass","serialize","enable","enable_resize","timer","xhr","version","client","list","undo","sessionStorage","redo","activity","esi","refreshRate","connected","ageFormat","instance","window","clearTimeout","sync","setAgeFormat","countdown","serverTime","chainMap","draw","pastEOL","since","layout","whTooltip","sig","item","tooltip","sig2Type","whType","life","mass","jump","ageTooltip","date","lifeTime","getMonth","getHours","getMinutes","createdByName","modifiedTime","modifiedByName","refresh","successCallback","alwaysCallback","on","preventDefault","systemChange","keydown","activeElement","is","metaKey","ctrlKey","keyCode","Notify","trigger","knob","angleArc","max","readOnly","displayInput","fgColor","bgColor","splice","toggle","EVE","systemName","show","hide","focus","select","characters","removeAttr","remove","delete","display","stopPropagation","whList","content","color","stick","jBox","offset","y","animation","autoClose","ValidationTooltips","fade","Tooltips","attach","getContent","position","outside","WormholeTypeToolTips","OccupiedToolTips","pointer","repositionOnOpen","onOpen","source","closest","setContent","cache","done","chars","occupants","shipTypeName","linkSig","sigName","sortable","items","axis","delay","tolerance","containment","update","result","newTabs","dialog","Remove Tab","Cancel","resizable","minHeight","dialogClass","OK","submit","open","close","create","inlinecomplete","aSigSystems","maxSize","thera","checked","target","eq","contextmenu","delegate","menu","parent","children","colName","cmd","beforeOpen","uiMenuOptions","my","at","effect","duration","showInfo","setDestination","collapsed","collapse","autoOpen","Close","rawMap","connectionID","signatureID","totalMass","parseFloat","toID","shipType","Save","connection","button","request","rename","side","moogle","prototype","setFlare","flare","flares","removeFlare","widget","autocomplete","_create","element","_selectInit","_super","_value","originalReturn","_superApply","arguments","change","_suggest","_initSource","isArray","response","matcher","escapeRegex","term","results","Array","_close","event","input_source","wrapper","select_source","trim","text","toArray","_createShowAllButton","that","wasOpen","appendTo","icons","primary","_search","tablesorter","sortReset","widgets","textExtraction","2","node","aSystems","Ok","easing","editSigs","editComments","editSig","editComment","animate","backgroundColor","fadeIn","fadeOut","addSig","add","option","disabled","wormhole","parentID","childID","otherSignature","tr","until","moment","utc","lifeLeft","toDate","onExpiry","alwaysExpire","compact","serverSync","wrapInner","slideDown","$set","replaceWith","contents","API","indicator","APIrefresh","expire","periodsToSeconds","onTick","t","from","to","shipTypeID","shortest","toClass","sig2ID","connectionName","whLife","whMass","lifeLength","class2","signature","resultSet","action","comments","modified","$comment","comment","err","message","modifiedBy","sticky","commentID","before","createdBy","created","deleteSig","slideUp","edit","baseUrl","userAgent","navigator","tokenExpire","subtract","isBefore","expired","param","token","accessToken","user_agent","status","locationDate","getResponseHeader","solar_system_id","stationID","stationName","shipID","shipName","station_id","stationLookup","always","reference","detach","fail","ship","shipDate","ship_item_id","ship_name","ship_type_id","typeLookup","online","characterStatus","typeID","destinationID","clear_waypoints","beginning","destination_id","clear_other_waypoints","add_to_beginning","headers","Authorization","X-User-Agent","targetID","target_id","eveStatus","idLookup","eveIDs","contentType","processData","characterLookup","eveID","async","corporationLookup","allianceLookup","searchString","categories","strict","universeJumps","universeKills","fullLookup","promise","Deferred","category","characterData","corporation_id","corporationData","corporation","alliance_id","allianceData","alliance","resolve","$clone","characterChange","isAfter","mask","column","editing","sigEditing","signatureCount","pasteSignatures","processing","rowParse","scanner","columns","validScanGroups","validTypes","Gas Site","Data Site","Relic Site","Ore Site","Combat Site","Wormhole","Gasgebiet","Datengebiet","Reliktgebiet","Mineraliengebiet","Kampfgebiet","Wurmloch","ГАЗ: район добычи газа","ДАННЫЕ: район сбора данных","АРТЕФАКТЫ: район поиска артефактов","РУДА: район добычи руды","ОПАСНО: район повышенной опасности","Червоточина","scanGroup","parsePaste","paste","payload","pasteIDs","removes","scan","clipboardData","getData","originalEvent","blur","lastIndex","redoItem","concat","serverStatus","players","times","abort","signatureTime","chainCount","chainTime","flareCount","flareTime","last_modified","commentCount","commentTime","appData","slice","notify","empty","history","replaceState","title","effects","bad","whClass","modifier","abs","statics","factionID","factions","regions","regionID","tutorial","introJs","setOptions","showStepNumbers","steps","querySelector","intro","exitOnEsc","exitOnOverlayClick","skipLabel","onchange","_currentStep","console","log","previousMask","stepFunc","_options","setOption","exiting","exit","goToStep","off","onexit","undoItem","graph","view","span","label","role","calc","d","r","getValue","sourceColumn","rows","reverse","google","visualization","DataView","DataTable","setColumns","selectHandler","selections","getSelection","c","AreaChart","getElementById","isStacked","hAxis","textStyle","fontName","fontSize","showTextEvery","vAxis","viewWindowMode","viewWindow","min","maxValue","gridlineColor","pointSize","lineWidth","chartArea","left","top","legend","showColorCode","annotations","style","domain","focusTarget","events","addListener","charts","setOnLoadCallback","drawing","newView","shipJumps","podKills","shipKills","npcKills","$node","occupied","count","next","lines","drawNodeLine","nodeIndex","ceil","cellIndex","$connector","$parent","nodeCol","connectorCell","colSpan","parentIndex","newparentIndex","checkSystem","v","$connecte","me","tempCol","breaker","skip","nodes","cols","frigTypes","connections","topLevel","effectClass","chainNode","f","findLinks","chainList","chainData","link","usedLinks","typeBM","type2BM","classBM","class2BM","nth","nth2","child","chainLinks","jumps","guidance","findShortestPath","calcNode","nodeClass","nodeSecurity","expires","system_id","ship_jumps","then","pod_kills","ship_kills","npc_kills","getCollapsedNodes","OrgChart","allowHtml","allowCollapse","CKConfig","skin","allowedContent","extraPlugins","enterMode","CKEDITOR","ENTER_BR","removeDialogTabs","autoGrow_onStartup","autoGrow_minHeight","toolbar_minToolbar","toolbar_maxToolbar","toolbar","smallToolbar","maximizedToolbar","fontSize_style","styles","font-size","overrides","attributes","cke","editor","domEvent","altKey","s","selected_ranges","getRanges","startContainer","parents","getParents","getFirst","getNext","selectElement","selectRanges","ev","definition","getContents","removeAllRanges","$this","instances","modifiedDate","createdDate","destroy","of","Delete","extractKeys","call","sorter","b","findPaths","end","infinity","Infinity","costs","0","predecessors","addToOpen","cost","vertex","bucket","shift","currentCost","adjacentNodes","totalCost","vertexCost","extractShortest","u","predecessor","path","Guidance","refreshTimer","$total","$ajax","refreshWindow","ids","$row","$col","modal","$menuItem","sortList","parentElement","maskChange","slider","Reset","stat","owner","admin","img","optional","accordion","heightStyle","collapsible","step","slide","error","direction","Add","Remove","send","Create","selectmenu","total","form","openSignatureDialog","aSigWormholes","durationPicker","not","valid","isNaN","findIndex","signatureType","signatureID_Alpha","signatureID_Numeric","wormholeName","signatureLength","wormholeType","signature2","signatureID2_Alpha","signatureID2_Numeric","wormholeName2","wormholeType2","wormholeLife","wormholeMass","signatureName","openSigEdit"],"mappings":"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","file":"app.min.js","sourcesContent":["Object.sort = function(obj, prop) {\r\n\tvar swapped, prev;\r\n\tdo {\r\n\t\tswapped = false, prev = null;\r\n\t\tfor (var i in obj) {\r\n\t\t\tif (prev && Number(obj[i][prop]) < Number(obj[prev][prop])) {\r\n\t\t\t\tvar tmp = obj[i];\r\n\t\t\t\tobj[i] = obj[prev];\r\n\t\t\t\tobj[prev] = tmp;\r\n\t\t\t\tswapped = true;\r\n\t\t\t}\r\n\t\t\tprev = i;\r\n\t\t}\r\n\t} while (swapped);\r\n}\r\n\r\nObject.index = function(obj, prop, val, cs) {\r\n\tfor (var key in obj) {\r\n\t\tif (!cs) {\r\n\t\t\tif (obj[key][prop] == val) {\r\n\t\t\t\treturn key;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (obj[key][prop].toLowerCase() == val.toLowerCase()) {\r\n\t\t\t\treturn key;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nObject.find = function(obj, prop, val) {\r\n\tfor (var key in obj) {\r\n\t\tif (obj[key][prop] == val) {\r\n\t\t\treturn obj[key];\r\n\t\t}\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\nObject.maxTime = function(obj, prop) {\r\n\tvar maxTimeString = \"\", maxTime;\r\n\r\n\tfor (var key in obj) {\r\n\t\tif (!maxTime || maxTime < new Date(obj[key][prop])) {\r\n\t\t\tmaxTime = new Date(obj[key][prop]);\r\n\t\t\tmaxTimeString = obj[key][prop];\r\n\t\t}\r\n\t}\r\n\treturn maxTimeString;\r\n}\r\n\r\nObject.size = function(obj) {\r\n    var size = 0, key;\r\n    for (key in obj) {\r\n        if (obj.hasOwnProperty(key)) size++;\r\n    }\r\n\r\n    return size;\r\n};\r\n\r\nObject.time = function(obj) {\r\n\tvar dates = [], key;\r\n\tfor (key in obj) {\r\n\t\tdates.push(new Date(obj[key].time));\r\n\t}\r\n\r\n\treturn dates.length ? dates.sort()[dates.length -1].getTime() /1000 : 0;\r\n};\r\n\r\n(function($){\r\n    $.fn.serializeObject = function(){\r\n\r\n        var self = this,\r\n            json = {},\r\n            push_counters = {},\r\n            patterns = {\r\n                \"validate\": /^[a-zA-Z][a-zA-Z0-9_]*(?:\\[(?:\\d*|[a-zA-Z0-9_]+)\\])*$/,\r\n                \"key\":      /[a-zA-Z0-9_]+|(?=\\[\\])/g,\r\n                \"push\":     /^$/,\r\n                \"fixed\":    /^\\d+$/,\r\n                \"named\":    /^[a-zA-Z0-9_]+$/\r\n            };\r\n\r\n\r\n        this.build = function(base, key, value){\r\n            base[key] = value;\r\n            return base;\r\n        };\r\n\r\n        this.push_counter = function(key){\r\n            if(push_counters[key] === undefined){\r\n                push_counters[key] = 0;\r\n            }\r\n            return push_counters[key]++;\r\n        };\r\n\r\n        $.each($(this).serializeArray(), function(){\r\n\r\n            // skip invalid keys\r\n            if(!patterns.validate.test(this.name)){\r\n                return;\r\n            }\r\n\r\n            var k,\r\n                keys = this.name.match(patterns.key),\r\n                merge = this.value,\r\n                reverse_key = this.name;\r\n\r\n            while((k = keys.pop()) !== undefined){\r\n\r\n                // adjust reverse_key\r\n                reverse_key = reverse_key.replace(new RegExp(\"\\\\[\" + k + \"\\\\]$\"), '');\r\n\r\n                // push\r\n                if(k.match(patterns.push)){\r\n                    merge = self.build([], self.push_counter(reverse_key), merge);\r\n                }\r\n\r\n                // fixed\r\n                else if(k.match(patterns.fixed)){\r\n                    merge = self.build([], k, merge);\r\n                }\r\n\r\n                // named\r\n                else if(k.match(patterns.named)){\r\n                    merge = self.build({}, k, merge);\r\n                }\r\n            }\r\n\r\n            json = $.extend(true, json, merge);\r\n        });\r\n\r\n        return json;\r\n    };\r\n})(jQuery);\r\n\r\nvar numFormat = function(num) {\r\n\t//Seperates the components of the number\r\n\tvar n = num.toString().split(\".\");\r\n\t//Comma-fies the first part\r\n\tn[0] = n[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\r\n\t//Combines the two sections\r\n\treturn n.join(\".\");\r\n}\r\n\r\nvar letterToNumbers = function(string) {\r\n    string = string.toUpperCase();\r\n    var letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', sum = 0, i;\r\n    for (i = 0; i < string.length; i++) {\r\n        sum += Math.pow(letters.length, i) * (letters.indexOf(string.substr(((i + 1) * -1), 1)) + 1);\r\n    }\r\n    return sum;\r\n}\r\n\r\nvar sigFormat = function(input, type) {\r\n\tif (!input) return \"\";\r\n\r\n\tvar alpha = /^[a-zA-Z]+$/;\r\n\tvar numeric = /^[0-9]+$/;\r\n\tvar format = type == \"type\" ? options.chain.typeFormat || \"\" : options.chain.classFormat || \"\";\r\n\r\n\tfor (var x = 0, l = format.length; x < l; x++) {\r\n\t\tif (format[x].match(alpha)) {\r\n\t\t\tif (format[x].toUpperCase() == \"B\" && input == \"a\") {\r\n\t\t\t\treturn \"\";\r\n\t\t\t} else {\r\n\t\t\t\tif (format[x] == format[x].toUpperCase()) {\r\n\t\t\t\t\tformat = format.substr(0, x) + input.toUpperCase() + format.substr(x + 1, l);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tformat = format.substr(0, x) + input + format.substr(x + 1, l);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (format[x].match(numeric)) {\r\n\t\t\tif (format[x] == 2 && input == \"a\") {\r\n\t\t\t\treturn \"\";\r\n\t\t\t} else {\r\n\t\t\t\tformat = format.substr(0, x) + letterToNumbers(input) + format.substr(x +1, l);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn format;\r\n}\r\n\r\nvar sigClass = function(name, type) {\r\n\tvar id = $.map(tripwire.systems, function(system, id) { return system.name == name ? id : null })[0];\r\n\tvar system = {\r\n\t\t\"name\": name,\r\n\t\t\"class\": id ? tripwire.systems[id].class : null,\r\n\t\t\"security\":  id ? tripwire.systems[id].security : null,\r\n\t\t\"type\": type};\r\n\tvar systemType = null;\r\n\r\n\tif (system.class == 6 || system.name == \"Class-6\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 6\"))\r\n\t\tsystemType = \"C6\";\r\n\telse if (system.class == 5 || system.name == \"Class-5\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 5\"))\r\n\t\tsystemType = \"C5\";\r\n\telse if (system.class == 4 || system.name == \"Class-4\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 4\"))\r\n\t\tsystemType = \"C4\";\r\n\telse if (system.class == 3 || system.name == \"Class-3\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 3\"))\r\n\t\tsystemType = \"C3\";\r\n\telse if (system.class == 2 || system.name == \"Class-2\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 2\"))\r\n\t\tsystemType = \"C2\";\r\n\telse if (system.class == 1 || system.name == \"Class-1\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 1\"))\r\n\t\tsystemType = \"C1\";\r\n\telse if (system.security >= 0.45 || system.name == \"High-Sec\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"High-Sec\" && !system.security))\r\n\t\tsystemType = \"HS\";\r\n\telse if (system.security > 0.0 || system.name == \"Low-Sec\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Low-Sec\" && !system.security))\r\n\t\tsystemType = \"LS\";\r\n\telse if ((system.security <= 0.0 && system.security != null) || system.name == \"Null-Sec\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Null-Sec\"))\r\n\t\tsystemType = \"NS\";\r\n\r\n\treturn systemType;\r\n}\r\n\r\nvar isEmpty = function(obj) {\r\n    for(var key in obj) {\r\n        if(obj.hasOwnProperty(key))\r\n            return false;\r\n    }\r\n    return true;\r\n}\r\n\r\nvar getCookie = function(c_name) {\r\n\tvar c_value = document.cookie;\r\n\r\n\tvar c_start = c_value.indexOf(\" \" + c_name + \"=\");\r\n\tif (c_start == -1) {\r\n\t\tc_start = c_value.indexOf(c_name + \"=\");\r\n\t}\r\n\r\n\tif (c_start == -1) {\r\n\t\tc_value = null;\r\n\t} else {\r\n\t\tc_start = c_value.indexOf(\"=\", c_start) + 1;\r\n\t\tvar c_end = c_value.indexOf(\";\", c_start);\r\n\r\n\t\tif (c_end == -1) {\r\n\t\t\tc_end = c_value.length;\r\n\t\t}\r\n\r\n\t\tc_value = unescape(c_value.substring(c_start, c_end));\r\n\t}\r\n\r\n\treturn c_value;\r\n}\r\n\r\nvar setCookie = function(c_name, value, exdays) {\r\n\tvar exdate = new Date();\r\n\texdate.setDate(exdate.getDate() + exdays);\r\n\tvar c_value = escape(value) + ((exdays == null) ? \"\" : \"; expires=\"+exdate.toUTCString());\r\n\r\n\tdocument.cookie = c_name + \"=\" + c_value + \";\" + (document.location.protocol == \"https:\" ? \"secure;\" : \"\");\r\n}\r\n","var viewingSystem = $(\"meta[name=system]\").attr(\"content\");\r\nvar viewingSystemID = $(\"meta[name=systemID]\").attr(\"content\");\r\nvar server = $(\"meta[name=server]\").attr(\"content\");\r\nvar app_name = $(\"meta[name=app_name]\").attr(\"content\");\r\n\r\n// Page cache indicator\r\nif (getCookie(\"loadedFromBrowserCache\") == \"true\") {\r\n\t$(\"#pageTime\").html(\"Page is Cached\");\r\n}\r\n\r\nsetCookie('loadedFromBrowserCache', true);\r\n","var options = new function() {\r\n\tvar localOverrides = [\"grid\"];\r\n\tvar localOptions = JSON.parse(localStorage.getItem(\"tripwire_options\"));\r\n\r\n\tthis.userID = init.userID;\r\n\tthis.character = {id: init.characterID, name: init.characterName};\r\n\tthis.background = null;\r\n\tthis.uiscale = 1.0;\r\n\tthis.favorites = [];\r\n\tthis.grid = {};\r\n\tthis.tracking = {active: \"new\"};\r\n\tthis.masks = {active: init.corporationID + \".2\"};\r\n\tthis.chain = {typeFormat: null, classFormat: null, gridlines: true, active: 0, tabs: [], \"node-reference\": \"type\"};\r\n\tthis.signatures = {pasteLife: 72, alignment: {sigID: \"centerAlign\", sigType: \"centerAlign\", sigAge: \"centerAlign\", leadsTo: \"centerAlign\", sigLife: \"centerAlign\", sigMass: \"centerAlign\"}};\r\n\tthis.buttons = {follow: false, chainWidget: {viewing: false, favorites: false}, signaturesWidget: {autoMapper: false}};\r\n\r\n\t// Saves options in both cookie and database\r\n\tthis.save = function() {\r\n\t\tvar options = JSON.stringify(this.get());\r\n\r\n\t\tlocalStorage.setItem(\"tripwire_options\", options);\r\n\r\n\t\treturn $.ajax({\r\n\t\t\turl: \"options.php\",\r\n\t\t\tdata: {mode: \"set\", options: options},\r\n\t\t\ttype: \"POST\",\r\n\t\t\tdataType: \"JSON\"\r\n\t\t});\r\n\t}\r\n\r\n\t// Loads options via passed object else cookie\r\n\tthis.load = function(data) {\r\n\t\tif (data && typeof(data) != \"undefined\") {\r\n\t\t\tthis.set(this, data);\r\n\t\t} else if (localOptions) {\r\n\t\t\tthis.set(this, localOptions);\r\n\t\t}\r\n\r\n\t\tthis.apply();\r\n\t}\r\n\r\n\t// Gets options from this by exluding types == function\r\n\tthis.get = function() {\r\n\t\tvar data = {};\r\n\r\n\t\tfor (var x in this) {\r\n\t\t\tif (typeof(this[x]) != \"function\") {\r\n\t\t\t\tdata[x] = this[x];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\t// Sets this from passed object\r\n\tthis.set = function(local, data) {\r\n\t\tfor (var prop in data) {\r\n\t\t\tif (data[prop] && data[prop].constructor && data[prop].constructor === Object) {\r\n\t\t\t\tif (local) {\r\n\t\t\t\t\tthis.set(local[prop], data[prop]);\r\n\t\t\t\t}\r\n\t\t\t} else if (local && typeof(local[prop]) != \"undefined\") {\r\n\t\t\t\tlocal[prop] = data[prop];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tthis.reset = function() {\r\n\t\tfor (var x in this) {\r\n\t\t\tif (typeof(this[x]) != \"function\") {\r\n\t\t\t\tthis[x] = JSON.parse(JSON.stringify(this.reset.defaults[x]));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Applies settings\r\n\tthis.apply = function() {\r\n\t\t// Local browser overrides\r\n\t\tif (localOptions) {\r\n            for (key in localOverrides) {\r\n                this[localOverrides[key]] = localOptions[localOverrides[key]];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Grid layout (detect old IGB setting options)\r\n\t\tif (this.grid.hasOwnProperty(\"oog\") && !isEmpty(this.grid.oog)) {\r\n\t\t\t$.each(this.grid.oog, function() {\r\n\t\t\t\t$(\"#\"+this.id).attr({\"data-col\": this.col, \"data-row\": this.row, \"data-sizex\": this.size_x, \"data-sizey\": this.size_y})\r\n\t\t\t\t\t.css({width: this.width, height: this.height});\r\n\t\t\t});\r\n\t\t} else if (!isEmpty(this.grid)) {\r\n\t\t\t$.each(this.grid, function() {\r\n\t\t\t\t$(\"#\"+this.id).attr({\"data-col\": this.col, \"data-row\": this.row, \"data-sizex\": this.size_x, \"data-sizey\": this.size_y})\r\n\t\t\t\t\t.css({width: this.width, height: this.height});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Make sure favorites are all ints and not strings\r\n\t\tthis.favorites = $.map(this.favorites, function(favorite) {\r\n\t\t\treturn parseInt(favorite);\r\n\t\t});\r\n\r\n\t\t// Buttons\r\n\t\tif (this.buttons.follow) $(\"#follow\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.home) $(\"#home\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.kspace) $(\"#k-space\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.viewing) $(\"#show-viewing\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.favorites) $(\"#show-favorite\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.evescout) $(\"#eve-scout\").addClass(\"active\");\r\n\t\tif ($.inArray(parseInt(viewingSystemID), this.favorites) !== -1) $(\"#system-favorite\").attr(\"data-icon\", \"star\").addClass(\"active\");\r\n\t\tif (this.buttons.signaturesWidget.autoMapper) $(\"#toggle-automapper\").addClass(\"active\");\r\n\r\n\t\t// UI Scale\r\n\t\tif (this.uiscale) {\r\n\t\t\t$(\"body\").css(\"zoom\", this.uiscale);\r\n\t\t}\r\n\r\n\t\t// Background\r\n\t\tif (this.background) {\r\n\t\t\tvar a = $('<a>', { href:this.background } )[0];\r\n\t\t\t$(\"#wrapper\").attr(\"style\", \"background-image: url(https://\" + a.hostname + a.pathname + a.search + \");\");\r\n\t\t} else {\r\n\t\t\t$(\"#wrapper\").attr(\"style\", \"\");\r\n\t\t}\r\n\r\n\t\t// Characters in Options\r\n\t\t$(\"#dialog-options #characters\").html(\"<img src='https://image.eveonline.com/Character/\"+init.characterID+\"_64.jpg' />\");\r\n\r\n\t\t// Active mask\r\n\t\t$(\"#dialog-options input[name='mask']\").filter(\"[value='\"+this.masks.active+\"']\").attr(\"checked\", true);\r\n\r\n\t\t// Chain tabs\r\n\t\t$(\"#chainTabs\").html(\"\");\r\n\t\tfor (var x in this.chain.tabs) {\r\n\t\t\tif (this.chain.tabs[x]) {\r\n\t\t\t\tvar $tab = $(\"#chainTab .tab\").clone();\r\n\r\n\t\t\t\t$tab.attr(\"id\", x).find(\".name\").data(\"tab\", this.chain.tabs[x].systemID).html(this.chain.tabs[x].name);\r\n\t\t\t\tif (x == this.chain.active) { $tab.addClass(\"current\"); }\r\n\r\n\t\t\t\t$(\"#chainTabs\").append($tab);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Draw chain if Tripwire is initialized\r\n\t\tif (typeof(tripwire) !== \"undefined\") {\r\n\t\t\tchain.redraw();\r\n\t\t}\r\n\t}\r\n\r\n\tthis.reset.defaults = JSON.parse(JSON.stringify(this.get()));\r\n\tthis.load(init && init.options ? init.options : null);\r\n}\r\n","var grid = $(\".gridster ul\").gridster({\r\n\twidget_selector: \"li.gridWidget\",\r\n\tavoid_overlapped_widgets: false,\r\n\twidget_base_dimensions: [50, 50],\r\n\twidget_margins: [5, 5],\r\n\tautogrow_cols: true,\r\n\thelper: \"clone\",\r\n\tdraggable: {\r\n\t\tstart: function(e, ui) {\r\n\t\t\t$(\"div.gridster\").width($(\"div.gridster ul\").width());\r\n\t\t}\r\n\t},\r\n\tresize: {\r\n    \tenabled: true,\r\n    \thandle_class: \"grid-resize\",\r\n    \tmax_size: [30, 30],\r\n    \tmin_size: [4, 4],\r\n    \tstart: function(e) {\r\n    \t\t$(\"div.gridster\").width($(\"div.gridster ul\").width());\r\n    \t},\r\n    \tstop: function(e, ui, $widget) {\r\n    \t\t//var width = parseInt($(\".gridster\").css(\"margin-left\")) + this.container_width;\r\n    \t\t//$(\"#wrapper\").css({width: width + \"px\"})\r\n    \t\tswitch ($widget.attr(\"id\")) {\r\n    \t\t\tcase \"infoWidget\":\r\n    \t\t\t\tsetTimeout(\"activity.redraw();\", 300);\r\n    \t\t\t\tbreak;\r\n    \t\t}\r\n    \t}\r\n\t},\r\n\tserialize_params: function($w, wgd) {\r\n\t\treturn {\r\n\t\t\tid: $w.attr(\"id\"),\r\n\t\t\tcol: wgd.col,\r\n\t\t\trow: wgd.row,\r\n\t\t\tsize_x: wgd.size_x,\r\n\t\t\tsize_y: wgd.size_y,\r\n\t\t\twidth: $w.width(),\r\n\t\t\theight: $w.height()\r\n\t\t}\r\n\t}\r\n}).data(\"gridster\").disable();\r\n\r\ngrid.disable_resize();\r\n$(\".grid-resize\").addClass(\"hidden\").attr(\"data-icon\", \"resize\");\r\n\r\n$(\".gridster\").css({visibility: \"visible\"});\r\n$(\".gridster > *\").addClass(\"gridster-transition\");\r\n\r\n$(\"#layout\").click(function() {\r\n\tif (!$(this).hasClass(\"active\")) {\r\n\t\tgrid.enable();\r\n\t\tgrid.enable_resize();\r\n\t\t$(\".grid-resize\").removeClass(\"hidden\");\r\n\r\n\t\t$(this).addClass(\"active\");\r\n\t} else {\r\n\t\tgrid.disable();\r\n\t\tgrid.disable_resize();\r\n\t\t$(\".grid-resize\").addClass(\"hidden\");\r\n\r\n\t\t$(this).removeClass(\"active\");\r\n\r\n\t\toptions.grid = grid.serialize();\r\n\r\n\t\toptions.save();\r\n\t}\r\n});\r\n","var tripwire = new function() {\r\n    this.timer, this.xhr;\r\n\tthis.version = \"0.9.2\";\r\n\tthis.client = {signatures: {}, wormholes: {}};\r\n\tthis.server = {signatures: {}, wormholes: {}};\r\n\tthis.signatures = {list: {}, undo: JSON.parse(sessionStorage.getItem(\"tripwire_undo\")) || {}, redo: JSON.parse(sessionStorage.getItem(\"tripwire_redo\")) || {}};\r\n\tthis.activity = {};\r\n\tthis.data = {tracking: {}, esi: {}};\r\n\tthis.refreshRate = 5000;\r\n\tthis.connected = true;\r\n\tthis.ageFormat = \"HM\";\r\n\tthis.instance = window.name ? window.name : (new Date().getTime() / 1000, window.name = new Date().getTime() / 1000);\r\n\r\n    // Command to start/stop tripwire updates\r\n\t// ToDo: Include API and Server timers\r\n\tthis.stop = function() {\r\n\t\tclearTimeout(this.timer);\r\n\t\treturn this.timer;\r\n\t};\r\n\r\n\tthis.start = function() {\r\n\t\treturn this.sync();\r\n\t}\r\n\r\n    // Command to change Age format\r\n\t// ToDo: Cookie change to keep\r\n\tthis.setAgeFormat = function(format) {\r\n\t\tvar format = typeof(format) !== 'undefined' ? format : this.ageFormat;\r\n\r\n\t\t$(\"span[data-age]\").each(function() {\r\n\t\t\t$(this).countdown(\"option\", {format: format});\r\n\t\t});\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n    this.serverTime = function() {\r\n\t\tthis.time;\r\n\r\n\t\tthis.serverTime.getTime = function() {\r\n\t\t\treturn tripwire.serverTime.time;\r\n\t\t}\r\n\t}\r\n    this.serverTime();\r\n\r\n    // Handles putting chain together\r\n\tthis.chainMap = function() {\r\n\t\tthis.chainMap.parse = function(data) {\r\n\t\t\tchain.draw(data);\r\n\t\t}\r\n\t}\r\n    this.chainMap();\r\n\r\n    this.pastEOL = function() {\r\n\t\tvar options = {since: $(this).countdown('option', 'until'), format: \"HM\", layout: \"-{hnn}{sep}{mnn}&nbsp;\"};\r\n\t\t$(this).countdown(\"option\", options);\r\n\t}\r\n\r\n    // Handles WH Type hover-over tooltip\r\n\t// ToDo: Use native JS\r\n\tthis.whTooltip = function(sig) {\r\n\t\tif (viewingSystemID == sig.systemID) {\r\n\t\t\tif ($.inArray(sig.type, $.map(tripwire.wormholes, function(item, index) { return index;})) >= 0) {\r\n\t\t\t\tvar type = sig.type;\r\n\t\t\t\tvar tooltip = '';\r\n\t\t\t} else {\r\n\t\t\t\tvar type = sig.sig2Type;\r\n\t\t\t\tvar tooltip = \"<b>Type:</b> \"+type+\"<br/>\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif ($.inArray(sig.sig2Type, $.map(tripwire.wormholes, function(item, index) { return index;})) >= 0) {\r\n\t\t\t\tvar type = sig.sig2Type;\r\n\t\t\t\tvar tooltip = '';\r\n\t\t\t} else {\r\n\t\t\t\tvar type = sig.type;\r\n\t\t\t\tvar tooltip = \"<b>Type:</b> \"+type+\"<br/>\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($.inArray(type, $.map(tripwire.wormholes, function(item, index) { return index;})) >= 0) {\r\n\t\t\tvar whType = true;\r\n\t\t} else {\r\n\t\t\tvar whType = false;\r\n\t\t}\r\n\r\n\t\ttooltip += \"<b>Life:</b> \"+(whType?tripwire.wormholes[type].life:\"Unknown\")+\"<br/>\";\r\n\r\n\t\tif (whType) {\r\n\t\t\tswitch (tripwire.wormholes[type].leadsTo.split(\" \")[0]) {\r\n\t\t\t\tcase 'High-Sec':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='hisec'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Low-Sec':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='lowsec'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Null-Sec':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='nullsec'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Class':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='wh'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\ttooltip += \"<b>Leads To:</b> <span>Unknown</span><br/>\";\r\n\t\t}\r\n\r\n\t\ttooltip += \"<b>Max Mass</b>: \"+(whType?numFormat(tripwire.wormholes[type].mass):\"Unknown\")+\" Kg<br/>\";\r\n\r\n\t\ttooltip += \"<b>Max Jumpable</b>: \"+(whType?numFormat(tripwire.wormholes[type].jump):\"Unknown\")+\" Kg<br/>\";\r\n\r\n\t\treturn tooltip;\r\n\t}\r\n\r\n\t// Handles Age hover-over tooltip\r\n\t// ToDo: Use native JS\r\n\tthis.ageTooltip = function(sig) {\r\n\t\t// var date = new Date(sig.lifeTime);\r\n\t\t// var localOffset = date.getTimezoneOffset() * 60000;\r\n\t\t// date = new Date(date.getTime() + localOffset);\r\n        var date = new Date(sig.lifeTime);\r\n\r\n\t\tvar tooltip = \"<table class=\\\"age-tooltip-table\\\"><tr>\"\r\n        + \"<th>Created:</th><td>\"+(date.getMonth()+1)+\"/\"+date.getDate()+\" \"+(date.getHours() < 10?'0':'')+date.getHours()+\":\"+(date.getMinutes() < 10?'0':'')+date.getMinutes()+\"</td>\"\r\n        + \"<td>\"+sig.createdByName+\"</td>\"\r\n        + \"</tr>\";\r\n\r\n\t\tif (sig.lifeTime != sig.modifiedTime) {\r\n\t\t\tdate = new Date(sig.modifiedTime);\r\n\t\t\t// localOffset = date.getTimezoneOffset() * 60000;\r\n\t\t\t// date = new Date(date.getTime() + localOffset);\r\n\r\n\t\t\ttooltip += \"<tr><th>Last Modified:</th><td>\"+(date.getMonth()+1)+\"/\"+date.getDate()+\" \"+(date.getHours() < 10?'0':'')+date.getHours()+\":\"+(date.getMinutes() < 10?'0':'')+date.getMinutes()+\"</td>\"\r\n          + \"<td>\"+sig.modifiedByName+\"</td>\"\r\n          + \"</tr>\";\r\n\t\t}\r\n\r\n\t\ttooltip += \"</table>\";\r\n\r\n\t\treturn tooltip;\r\n\t}\r\n\r\n    this.refresh = function(mode, data, successCallback, alwaysCallback) {\r\n\t\tvar mode = mode || 'refresh';\r\n\r\n\t\tthis.sync(mode, data, successCallback, alwaysCallback);\r\n\t}\r\n}\r\n","$(\"body\").on(\"click\", \"a[href^='.?system=']\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tvar system = $(this).attr(\"href\").replace(\".?system=\", \"\");\r\n\tvar systemID = Object.index(tripwire.systems, \"name\", system);\r\n\r\n\ttripwire.systemChange(systemID);\r\n});\r\n\r\n$(\"body\").on(\"submit\", \"#systemSearch\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tvar system = $(this).find(\"[name='system']\").val();\r\n\tvar systemID = Object.index(tripwire.systems, \"name\", system) || false;\r\n\r\n\tif (systemID !== false) {\r\n\t\ttripwire.systemChange(systemID);\r\n\t\t$(this).find(\"[name='system']\").val(\"\");\r\n\t\t$(\"#search\").click();\r\n\t}\r\n});\r\n\r\n$(\"body\").on(\"click\", \"#undo:not(.disabled)\", function() {\r\n\ttripwire.undo();\r\n});\r\n\r\n$(\"body\").on(\"click\", \"#redo:not(.disabled)\", function() {\r\n\ttripwire.redo();\r\n});\r\n\r\n$(document).keydown(function(e)\t{\r\n\t//Abort - user is in input or textarea\r\n\tif ($(document.activeElement).is(\"textarea, input\")) return;\r\n\r\n\tif ((e.metaKey || e.ctrlKey) && (e.keyCode == 89 || e.keyCode == 90)) {\r\n\r\n\t\te.preventDefault();\r\n\r\n\t\t// ctrl-z (undo) & ctrl-y (redo) keyhooks\r\n\t\tif (e.keyCode == 89 && !$(\"#redo\").hasClass(\"disabled\")) {\r\n\t\t\t$(\"#redo\").click();\r\n\t\t\tNotify.trigger(\"Redoing last undo\");\r\n\t\t} else if (e.keyCode == 90 && !$(\"#undo\").hasClass(\"disabled\")) {\r\n\t\t\t$(\"#undo\").click();\r\n\t\t\tNotify.trigger(\"Undoing last action\");\r\n\t\t}\r\n\t} else {\r\n\t\t// delete key keyhooks\r\n\t\tif (e.keyCode == 46 && $(\"#sigTable tr.selected\").length > 0) {\r\n\t\t\t$(\"#delete-signature\").click();\r\n\t\t}\r\n\t}\r\n});\r\n\r\n$(\"#APIclock\").knob({angleArc: 359.9, height: 20, width: 20, max: 60, readOnly: true, displayInput: false, fgColor: \"#CCC\", bgColor: \"#666\"});\r\n\r\n$(\"#follow\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\toptions.buttons.follow = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n})\r\n\r\n$(\"#show-viewing\").click(function() {\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\tchain.redraw();\r\n\r\n\toptions.buttons.chainWidget.viewing = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n});\r\n\r\n$(\"#show-favorite\").click(function() {\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\tchain.redraw();\r\n\r\n\toptions.buttons.chainWidget.favorites = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n});\r\n\r\n$(\"#system-favorite\").click(function() {\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\").attr(\"data-icon\", \"star-empty\");\r\n\r\n\t\toptions.favorites.splice(options.favorites.indexOf(parseInt(viewingSystemID)), 1);\r\n\t} else {\r\n\t\t$(this).attr(\"data-icon\", \"star\").addClass(\"active\");\r\n\r\n\t\toptions.favorites.push(parseInt(viewingSystemID));\r\n\t}\r\n\r\n\tif ($(\"#show-favorite\").hasClass(\"active\"))\r\n\t\tchain.redraw();\r\n\r\n\toptions.save();\r\n});\r\n\r\n$(\"#search\").click(function(e) {\r\n\t$(\"#searchSpan\").toggle();\r\n\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\");\r\n\t\tif (tripwire.client.EVE && tripwire.client.EVE.systemName)\r\n\t\t\t$(\"#currentSpan\").show();\r\n\t} else {\r\n\t\t$(this).addClass(\"active\");\r\n\t\t$(\"#currentSpan\").hide();\r\n\r\n\t\t$(\"#searchSpan input[name=system]\").focus().select();\r\n\t}\r\n});\r\n\r\n$(\"#toggle-automapper\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\toptions.buttons.signaturesWidget.autoMapper = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n});\r\n\r\n$(\"#track\").on(\"click\", \".tracking-clone\", function() {\r\n\tvar characterID =$(this).attr(\"data-characterid\");\r\n\t$(\"#tracking .tracking-clone\").removeClass(\"active\");\r\n\r\n\tif (options.tracking.active == characterID) {\r\n\t\toptions.tracking.active = null;\r\n\t\ttripwire.EVE(false, true);\r\n\t\t$(\"#removeESI\").attr(\"disabled\", \"disabled\");\r\n\t} else {\r\n\t\toptions.tracking.active = characterID;\r\n\r\n\t\tif (tripwire.esi.characters[options.tracking.active]) {\r\n\t\t\t$(\"#tracking .tracking-clone[data-characterid='\"+ options.tracking.active +\"']\").addClass(\"active\");\r\n\t\t\ttripwire.EVE(tripwire.esi.characters[options.tracking.active], true);\r\n\t\t}\r\n\r\n\t\t$(\"#removeESI\").removeAttr(\"disabled\");\r\n\t}\r\n\r\n\toptions.save();\r\n});\r\n\r\n$(\"#login\").on(\"click\", \"#removeESI\", function() {\r\n\tvar characterID = options.tracking.active;\r\n\r\n\toptions.tracking.active = null;\r\n\ttripwire.EVE(false, true);\r\n\toptions.save();\r\n\r\n\t$(\"#tracking .tracking-clone[data-characterid='\"+ characterID +\"']\").remove();\r\n\r\n\t$(\"#removeESI\").attr(\"disabled\", \"disabled\");\r\n\ttripwire.data.esi.delete = characterID;\r\n});\r\n\r\n$(\"#user\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\");\r\n\r\n\t\t$(\"#login > #panel\").css({display: \"none\"});\r\n\r\n\t\t//$(\"#wrapper\").unbind(\"click\");\r\n\t} else {\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\t\t$(\"#login > #panel\").css({display: \"inline\"});\r\n\t\t$(\"#loginForm input[name=username]\").focus().select();\r\n\r\n\t\t// Click outside closes\r\n\t\t$(\"#wrapper\").click(function(e) {\r\n\t\t\t$(\"#login > #panel\").css({display: \"none\"});\r\n\t\t\t$(\"#user\").removeClass(\"active\");\r\n\t\t});\r\n\r\n\t\t$(\"#login\").click(function(e) {\r\n\t\t\te.stopPropagation();\r\n\t\t})\r\n\t}\r\n});\r\n\r\n$(\"#logout\").click(function() {\r\n\twindow.location = \"logout.php\";\r\n});\r\n\r\nvar Notify = new function() {\r\n\r\n\tthis.trigger = function(content, color, stick, id) {\r\n\t\tvar color = typeof(color) !== \"undefined\" ? color : \"blue\";\r\n\t\tvar stick = typeof(stick) !== \"undefined\" ? stick : 10000;\r\n\t\tvar id = typeof(id) !== \"undefined\" ? id : null;\r\n\r\n\t\tnew jBox(\"Notice\", {\r\n\t\t\tid: id,\r\n\t\t\tcontent: content,\r\n\t\t\toffset: {y: 35},\r\n\t\t\tanimation: \"flip\",\r\n\t\t\tcolor: color,\r\n\t\t\tautoClose: stick\r\n\t\t});\r\n\t}\r\n}\r\n\r\n// Init valdiation tooltips\r\nvar ValidationTooltips = new jBox(\"Tooltip\", {\r\n\ttrigger: null,\r\n\taddClass: \"validation-tooltip\",\r\n\tanimation: \"flip\",\r\n\tfade: 0\r\n});\r\n\r\nvar Tooltips = new jBox(\"Tooltip\", {\r\n\tattach: $(\"[data-tooltip]\"),\r\n\tgetContent: \"data-tooltip\",\r\n\tposition: {x: \"right\", y: \"center\"},\r\n\toutside: \"x\"\r\n});\r\n\r\nvar WormholeTypeToolTips = new jBox(\"Tooltip\", {\r\n\tattach: $(\".whEffect[data-tooltip]\"),\r\n\tgetContent: \"data-tooltip\",\r\n\tposition: {x: \"left\", y: \"center\"},\r\n\toutside: \"x\"\r\n});\r\n\r\nvar OccupiedToolTips = new jBox(\"Tooltip\", {\r\n\tpointer: \"top:-3\",\r\n\tposition: {x: \"right\", y: \"center\"},\r\n\toutside: \"x\",\r\n\tanimation: \"move\",\r\n\trepositionOnOpen: true,\r\n\tonOpen: function() {\r\n\t\tvar tooltip = this;\r\n\t\tvar systemID = $(this.source).closest(\"[data-nodeid]\").data(\"nodeid\");\r\n\r\n\t\ttooltip.setContent(\"&nbsp;\");\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: \"occupants.php\",\r\n\t\t\tdataType: \"JSON\",\r\n\t\t\tdata: \"systemID=\"+systemID,\r\n\t\t\tcache: false\r\n\t\t}).done(function(data) {\r\n\t\t\tvar chars = \"<table>\";\r\n\r\n\t\t\tfor (var x in data.occupants) {\r\n\t\t\t\tchars += \"<tr><td>\"+data.occupants[x].characterName+\"</td><td style='padding-left: 10px;'>\"+(data.occupants[x].shipTypeName?data.occupants[x].shipTypeName:\"\")+\"</td></tr>\";\r\n\t\t\t}\r\n\r\n\t\t\tchars += \"</table>\";\r\n\t\t\ttooltip.setContent(chars);\r\n\t\t});\r\n\t}\r\n});\r\n\r\n$(\"#chainTabs\").sortable({\r\n\titems: \"> .tab\",\r\n\taxis: \"x\",\r\n\tdelay: 150,\r\n\ttolerance: \"pointer\",\r\n\tcontainment: \"parent\",\r\n\tupdate: function(e, ui) {\r\n\t\tvar result = $(\"#chainTabs\").sortable(\"toArray\");\r\n\t\tvar newTabs = [];\r\n\r\n\t\tfor (var x in result) {\r\n\t\t\tnewTabs.push(options.chain.tabs[result[x]]);\r\n\t\t\t$(\"#chainTabs .tab:eq(\"+x+\")\").attr(\"id\", x);\r\n\t\t}\r\n\r\n\t\toptions.chain.active = $(\".tab.current\").index();\r\n\t\toptions.chain.tabs = newTabs;\r\n\t\toptions.save();\r\n\t}\r\n});\r\n\r\n$(\"#chainTabs\").on(\"click\", \".tab\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"current\")) {\r\n\t\t$(\"#chainTabs .tab\").removeClass(\"current\");\r\n\t\toptions.chain.active = null;\r\n\t} else {\r\n\t\t$(\"#chainTabs .tab\").removeClass(\"current\");\r\n\t\t$(this).addClass(\"current\");\r\n\t\toptions.chain.active = $(this).index();\r\n\t}\r\n\r\n\toptions.save();\r\n\tchain.redraw();\r\n\ttripwire.parse(tripwire.client, \"refresh\");\r\n});\r\n\r\n$(\"#chainTabs\").on(\"click\", \".closeTab\", function(e) {\r\n\te.stopPropagation();\r\n\tvar $tab = $(this).closest(\".tab\");\r\n\r\n\t$(\"#dialog-confirm #msg\").html(\"This tab will be removed, are you sure?\");\r\n\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\tbuttons: {\r\n\t\t\t\"Remove Tab\": function() {\r\n\t\t\t\tvar i = $tab.index();\r\n\r\n\t\t\t\toptions.chain.active = $(\".tab.current\").index();\r\n\t\t\t\toptions.chain.tabs.splice(i, 1);\r\n\t\t\t\toptions.save();\r\n\r\n\t\t\t\t$tab.remove();\r\n\t\t\t\tif ($(\"#chainTabs .tab.current\").length == 0) {\r\n\t\t\t\t\t$(\"#chainTabs .tab:last\").click();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var x = 0, l = $(\"#chainTabs .tab\").length; x < l; x++) {\r\n\t\t\t\t\t$(\"#chainTabs .tab:eq(\"+x+\")\").attr(\"id\", x);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t},\r\n\t\t\tCancel: function() {\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t}\r\n\t\t}\r\n\t}).dialog(\"open\");\r\n});\r\n\r\n$(\"#newTab\").on(\"click\", function() {\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-newTab\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-newTab\").dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tOK: function() {\r\n\t\t\t\t\t$(\"#newTab_form\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$(\"#dialog-newTab .name\").val(viewingSystem).focus();\r\n\t\t\t\t$(\"#dialog-newTab .sigSystemsAutocomplete\").val(viewingSystem);\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tValidationTooltips.close();\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t$(\"#dialog-newTab .sigSystemsAutocomplete\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0});\r\n\r\n\t\t\t\t$(\"#newTab_form\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar $tab = $(\"#chainTab .tab\").clone();\r\n\t\t\t\t\tvar name = $(\"#dialog-newTab .name\").val();\r\n\t\t\t\t\tvar systemID = Object.index(tripwire.systems, \"name\", $(\"#dialog-newTab .sigSystemsAutocomplete\").val());\r\n\t\t\t\t\tvar thera = $(\"#tabThera\")[0].checked ? true : false;\r\n\r\n\t\t\t\t\tif (!name) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-newTab .name\")}).setContent(\"Must have a name!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if (!systemID && $(\"#tabType1\")[0].checked) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-newTab .sigSystemsAutocomplete\")}).setContent(\"Must have a valid system!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if ($(\"#tabType2\")[0].checked) {\r\n\t\t\t\t\t\tsystemID = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$tab.attr(\"id\", $(\"#chainTabs .tab\").length).find(\".name\").data(\"tab\", systemID).html(name);\r\n\t\t\t\t\toptions.chain.tabs.push({systemID: systemID, name: name, evescout: thera});\r\n\t\t\t\t\toptions.save();\r\n\r\n\t\t\t\t\t$(\"#chainTabs\").append($tab);\r\n\r\n\t\t\t\t\t$(\"#dialog-newTab\").dialog(\"close\");\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-newTab .sigSystemsAutocomplete\").click(function(e) {\r\n\t\t\t\t\t$(\"#dialog-newTab #tabType1\").click();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-newTab\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-newTab\").dialog(\"open\");\r\n\t}\r\n});\r\n\r\n$(\"#chainTabs\").on(\"click\", \".editTab\", function(e) {\r\n\te.stopPropagation();\r\n\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-editTab\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-editTab\").dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tOK: function() {\r\n\t\t\t\t\t$(\"#editTab_form\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$(\"#dialog-editTab .name\").val(options.chain.tabs[options.chain.active].name).focus();\r\n\t\t\t\t$(\"#dialog-editTab .sigSystemsAutocomplete\").val(options.chain.tabs[options.chain.active].systemID > 0 ? tripwire.systems[options.chain.tabs[options.chain.active].systemID].name : \"\");\r\n\t\t\t\toptions.chain.tabs[options.chain.active].systemID > 0 ? $(\"#dialog-editTab #editTabType1\")[0].checked = true : $(\"#dialog-editTab #editTabType2\")[0].checked = true;\r\n\t\t\t\t$(\"#dialog-editTab #editTabThera\")[0].checked = options.chain.tabs[options.chain.active].evescout;\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tValidationTooltips.close();\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t$(\"#dialog-editTab .sigSystemsAutocomplete\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0});\r\n\r\n\t\t\t\t$(\"#editTab_form\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar $tab = $(\"#chainTabs .tab\").eq([options.chain.active]);\r\n\t\t\t\t\tvar name = $(\"#dialog-editTab .name\").val();\r\n\t\t\t\t\tvar systemID = Object.index(tripwire.systems, \"name\", $(\"#dialog-editTab .sigSystemsAutocomplete\").val());\r\n\t\t\t\t\tvar thera = $(\"#editTabThera\")[0].checked ? true : false;\r\n\r\n\t\t\t\t\tif (!name) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-editTab .name\")}).setContent(\"Must have a name!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if (!systemID && $(\"#editTabType1\")[0].checked) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-editTab .sigSystemsAutocomplete\")}).setContent(\"Must have a valid system!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if ($(\"#editTabType2\")[0].checked) {\r\n\t\t\t\t\t\tsystemID = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$tab.attr(\"id\", $(\"#chainTabs .tab\").length).find(\".name\").data(\"tab\", systemID).html(name);\r\n\t\t\t\t\toptions.chain.tabs[options.chain.active] = {systemID: systemID, name: name, evescout: thera};\r\n\t\t\t\t\toptions.save();\r\n\t\t\t\t\tchain.redraw();\r\n\r\n\t\t\t\t\ttripwire.parse(tripwire.client, \"refresh\");\r\n\r\n\t\t\t\t\t//$(\"#chainTabs\").append($tab);\r\n\r\n\t\t\t\t\t$(\"#dialog-editTab\").dialog(\"close\");\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-editTab .sigSystemsAutocomplete\").click(function(e) {\r\n\t\t\t\t\t$(\"#dialog-editTab #editTabType1\").click();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-editTab\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-editTab\").dialog(\"open\");\r\n\t}\r\n});\r\n\r\n// Signature column context menu\r\n$(\"#signaturesWidget #sigTable thead\").contextmenu({\r\n\tdelegate: \"th.sortable\",\r\n\tmenu: \"#signatureColumnMenu\",\r\n\tselect: function(e, ui) {\r\n\t\tvar col = $(ui.target).parent().parent().children().index($(ui.target).parent()) + 1;\r\n\r\n\t\tswitch(col) {\r\n\t\t\tcase 1:\r\n\t\t\t\tcolName = \"sigID\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tcolName = \"sigType\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tcolName = \"sigAge\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tcolName = \"leadsTo\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tcolName = \"sigLife\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tcolName = \"sigMass\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tswitch(ui.cmd) {\r\n\t\t\tcase \"leftAlign\":\r\n\t\t\t\t$(\"#signaturesWidget #sigTable tbody td:nth-child(\"+ col +\")\").removeClass(\"centerAlign rightAlign\").addClass(\"leftAlign\");\r\n\t\t\t\toptions.signatures.alignment[colName] = \"leftAlign\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"centerAlign\":\r\n\t\t\t\t$(\"#signaturesWidget #sigTable tbody td:nth-child(\"+ col +\")\").removeClass(\"leftAlign rightAlign\").addClass(\"centerAlign\");\r\n\t\t\t\toptions.signatures.alignment[colName] = \"centerAlign\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"rightAlign\":\r\n\t\t\t\t$(\"#signaturesWidget #sigTable tbody td:nth-child(\"+ col +\")\").removeClass(\"centerAlign leftAlign\").addClass(\"rightAlign\");\r\n\t\t\t\toptions.signatures.alignment[colName] = \"rightAlign\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\toptions.save();\r\n\t},\r\n\tbeforeOpen: function(e, ui) {\r\n\t\tvar col = $(ui.target).parent().parent().children().index($(ui.target).parent()) + 1;\r\n\r\n\t\tswitch(col) {\r\n\t\t\tcase 1:\r\n\t\t\t\tcolName = \"sigID\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tcolName = \"sigType\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tcolName = \"sigAge\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tcolName = \"leadsTo\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tcolName = \"sigLife\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tcolName = \"sigMass\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t$(this).contextmenu(\"enableEntry\", \"leftAlign\", true);\r\n\t\t$(this).contextmenu(\"enableEntry\", \"centerAlign\", true);\r\n\t\t$(this).contextmenu(\"enableEntry\", \"rightAlign\", true);\r\n\r\n\t\t$(this).contextmenu(\"enableEntry\", options.signatures.alignment[colName], false);\r\n\t}\r\n});\r\n\r\n// Chain Map Context Menu\r\n$(\"#chainMap\").contextmenu({\r\n\tdelegate: \".node a\",\r\n\tuiMenuOptions: {position: {my: \"left top-1\", at: \"right top\"}},\r\n\tmenu: \"#chainMenu\",\r\n\tshow: {effect: \"slideDown\", duration: 150},\r\n\tselect: function(e, ui) {\r\n\t\tvar id = $(ui.target[0]).closest(\"[data-nodeid]\").data(\"nodeid\");\r\n\t\tvar row = $(ui.target[0]).closest(\"[data-nodeid]\").attr(\"id\").replace(\"node\", \"\") -1;\r\n\r\n\t\tswitch(ui.cmd) {\r\n\t\t\tcase \"showInfo\":\r\n\t\t\t\ttripwire.esi.showInfo(id, options.tracking.active);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"setDest\":\r\n\t\t\t\ttripwire.esi.setDestination(id, options.tracking.active);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"addWay\":\r\n\t\t\t\ttripwire.esi.setDestination(id, options.tracking.active, false);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"showMap\":\r\n\t\t\t\t// CCPEVE.showMap(id);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"red\":\r\n\t\t\t\t$(ui.target[0]).closest(\"td\").hasClass(\"redNode\") ? $(this).contextmenu(\"removeFlare\", id, ui) : $(this).contextmenu(\"setFlare\", id, ui.cmd, ui);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"yellow\":\r\n\t\t\t\t$(ui.target[0]).closest(\"td\").hasClass(\"yellowNode\") ? $(this).contextmenu(\"removeFlare\", id, ui) : $(this).contextmenu(\"setFlare\", id, ui.cmd, ui);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"green\":\r\n\t\t\t\t$(ui.target[0]).closest(\"td\").hasClass(\"greenNode\") ? $(this).contextmenu(\"removeFlare\", id, ui) : $(this).contextmenu(\"setFlare\", id, ui.cmd, ui);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"mass\":\r\n\t\t\t\t$(\"#dialog-mass\").data(\"id\", $(ui.target[0]).closest(\"[data-nodeid]\").data(\"sigid\")).data(\"systemID\", $(ui.target[0]).closest(\"[data-nodeid]\").data(\"nodeid\")).dialog(\"open\");\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"rename\":\r\n\t\t\t\t$(\"#dialog-rename\").data(\"id\", $(ui.target[0]).closest(\"[data-nodeid]\").data(\"sigid\")).data(\"systemID\", $(ui.target[0]).closest(\"[data-nodeid]\").data(\"nodeid\")).dialog(\"open\");\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"collapse\":\r\n\t\t\t\tvar toggle = options.chain.tabs[options.chain.active] ? ($.inArray(id, options.chain.tabs[options.chain.active].collapsed) == -1 ? true : false) : true;\r\n\t\t\t\tchain.map.collapse(row, toggle);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\tbeforeOpen: function(e, ui) {\r\n\t\tvar sigID = $(ui.target[0]).closest(\"[data-nodeid]\").data(\"sigid\") || null;\r\n\t\tvar id = $(ui.target[0]).closest(\"[data-nodeid]\").data(\"nodeid\");\r\n\r\n\t\t// Add check for k-space\r\n\t\tif (tripwire.systems[id].class || !tripwire.esi.characters[options.tracking.active]) {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"setDest\", false);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"addWay\", false);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"showMap\", false);\r\n\t\t} else {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"setDest\", true);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"addWay\", true);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"showMap\", false);\r\n\t\t}\r\n\r\n\t\tif (sigID) {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"rename\", true);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"mass\", true);\r\n\t\t} else {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"rename\", false);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"mass\", false);\r\n\t\t}\r\n\t},\r\n\tcreate: function(e, ui) {\r\n\t\t$(\"#dialog-mass\").dialog({\r\n\t\t\tautoOpen: false,\r\n\t\t\twidth: \"auto\",\r\n\t\t\theight: \"auto\",\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tClose: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\tvar sigID = $(this).data(\"id\");\r\n\t\t\t\tvar systemID = $(this).data(\"systemID\");\r\n\t\t\t\tvar sig = Object.find(chain.data.rawMap, \"id\", sigID);\r\n\r\n\t\t\t\t$(\"#dialog-mass\").dialog(\"option\", \"title\", \"From \"+(sig.systemID == systemID ? tripwire.systems[sig.connectionID].name : tripwire.systems[sig.systemID].name)+\" to \"+tripwire.systems[systemID].name);\r\n\r\n\t\t\t\t$(\"#dialog-mass #massTable tbody tr\").remove();\r\n\r\n\t\t\t\tvar data = {signatureID: sigID};\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: \"mass.php\",\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\tdata: data,\r\n\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t}).done(function(data) {\r\n\t\t\t\t\tif (data && data.mass) {\r\n                        var totalMass = 0;\r\n\t\t\t\t\t\tfor (x in data.mass) {\r\n                            totalMass += parseFloat(data.mass[x].mass);\r\n\t\t\t\t\t\t\t$(\"#dialog-mass #massTable tbody\").append(\"<tr><td>\"+data.mass[x].characterName+\"</td><td>\"+(data.mass[x].toID == systemID ? \"In\" : \"Out\")+\"</td><td>\"+data.mass[x].shipType+\"</td><td>\"+numFormat(data.mass[x].mass)+\"Kg</td><td>\"+data.mass[x].time+\"</td></tr>\");\r\n\t\t\t\t\t\t}\r\n                        $(\"#dialog-mass #massTable tbody\").append(\"<tr><td></td><td></td><td></td><th>\"+ numFormat(totalMass) +\"Kg</th><td></td></tr>\");\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$(\"#dialog-rename\").dialog({\r\n\t\t\tautoOpen: false,\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tSave: function() {\r\n\t\t\t\t\t$(\"#rename_form\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\tvar sigID = $(this).data(\"id\");\r\n\t\t\t\tvar systemID = $(this).data(\"systemID\");\r\n\t\t\t\tvar sig = Object.find(tripwire.client.chain.map, \"id\", sigID);\r\n\r\n\t\t\t\t$(this).find(\"#name\").val(sig.systemID == systemID ? sig.system : sig.connection);\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t$(\"#rename_form\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar sigID = $(\"#dialog-rename\").data(\"id\");\r\n\t\t\t\t\tvar systemID = $(\"#dialog-rename\").data(\"systemID\");\r\n\t\t\t\t\tvar sig = Object.find(tripwire.client.chain.map, \"id\", sigID);\r\n\r\n\t\t\t\t\t$(\"#dialog-rename\").parent().find(\":button:contains('Save')\").button(\"disable\");\r\n\r\n\t\t\t\t\tvar data = {\"request\": {\"signatures\": {\"rename\": {id: sigID, name: $(\"#dialog-rename\").find(\"#name\").val(), side: sig.systemID == systemID ? \"parent\" : \"child\"}}}};\r\n\r\n\t\t\t\t\tvar success = function(data) {\r\n\t\t\t\t\t\tif (data && data.result == true) {\r\n\t\t\t\t\t\t\t$(\"#dialog-rename\").dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar always = function(data) {\r\n\t\t\t\t\t\t$(\"#dialog-rename\").parent().find(\":button:contains('Save')\").button(\"enable\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttripwire.refresh('refresh', data, success, always);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$.moogle.contextmenu.prototype.setFlare = function(systemID, flare, ui) {\r\n\t\t\tvar data = {\"systemID\": systemID, \"flare\": flare};\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"flares.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: data,\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tif (data && data.result) {\r\n\t\t\t\t\t// $(ui.target[0]).closest(\"td\").removeClass(\"redNode yellowNode greenNode\").addClass(flare+\"Node\");\r\n\r\n\t\t\t\t\tchain.data.flares.flares.push({systemID: systemID, flare: flare, time: null});\r\n\t\t\t\t\tchain.flares(chain.data.flares);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t$.moogle.contextmenu.prototype.removeFlare = function(systemID, ui) {\r\n\t\t\tvar data = {\"systemID\": systemID};\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"flares.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: data,\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tif (data && data.result) {\r\n\t\t\t\t\t// $(ui.target[0]).closest(\"td\").removeClass(\"redNode yellowNode greenNode\");\r\n\r\n\t\t\t\t\tchain.data.flares.flares.splice(Object.index(chain.data.flares.flares, \"systemID\", systemID), 1);\r\n\t\t\t\t\tchain.flares(chain.data.flares);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// Used to generate eve-survival guide link\r\nfunction linkSig(sigName) {\r\n\tvar wormholeSignatures = [\r\n\t\t// Ore sites\r\n\t\t\"Average Frontier Deposit\",\r\n\t\t\"Unexceptional Frontier Deposit\",\r\n\t\t\"Common Perimeter Deposit\",\r\n\t\t\"Exceptional Core Deposit\",\r\n\t\t\"Infrequent Core Deposit\",\r\n\t\t\"Unusual Core Deposit\",\r\n\t\t\"Rarified Core Deposit\",\r\n\t\t\"Isolated Core Deposit\",\r\n\t\t\"Ordinary Permiter Deposit\",\r\n\t\t\"Uncommon Core Deposit\",\r\n\r\n\t\t// Gas Sites\r\n\t\t\"Barren Perimeter Reservoir\",\r\n\t\t\"Minor Perimeter Reservoir\",\r\n\t\t\"Ordinary Perimeter Reservoir\",\r\n\t\t\"Sizeable Perimeter Reservoir\",\r\n\t\t\"Token Perimeter Reservoir\",\r\n\t\t\"Bountiful Frontier Reservoir\",\r\n\t\t\"Vast Frontier Reservoir\",\r\n\t\t\"Instrumental Core Reservoir\",\r\n\t\t\"Vital Core Reservoir\",\r\n\r\n\t\t// Class 1\r\n\t\t\"Perimeter Ambush Point\",\r\n\t\t\"Perimeter Camp\",\r\n\t\t\"Phase Catalyst Node\",\r\n\t\t\"The Line\",\r\n\t\t\"Forgotten Perimeter Coronation Platform\",\r\n\t\t\"Forgotten Perimeter Power Array\",\r\n\t\t\"Unsecured Perimeter Amplifier\",\r\n\t\t\"Unsecured Perimeter Information Center\",\r\n\r\n\t\t// Class 2\r\n\t\t\"Perimeter Checkpoint\",\r\n\t\t\"Perimeter Hangar\",\r\n\t\t\"The Ruins of Enclave Cohort 27\",\r\n\t\t\"Sleeper Data Sanctuary\",\r\n\t\t\"Forgotten Perimeter Gateway\",\r\n\t\t\"Forgotten Perimeter Habitation Coils\",\r\n\t\t\"Unsecured Perimeter Comms Relay\",\r\n\t\t\"Unsecured Perimeter Transponder Farm\",\r\n\r\n\t\t// Class 3\r\n\t\t\"Fortification Frontier Stronghold\",\r\n\t\t\"Outpost Frontier Stronghold\",\r\n\t\t\"Solar Cell\",\r\n\t\t\"The Oruze Construct\",\r\n\t\t\"Forgotten Frontier Quarantine Outpost\",\r\n\t\t\"Forgotten Frontier Recursive Depot\",\r\n\t\t\"Unsecured Frontier Database\",\r\n\t\t\"Unsecured Frontier Receiver\",\r\n\r\n\t\t// Class 4\r\n\t\t\"Frontier Barracks\",\r\n\t\t\"Frontier Command Post\",\r\n\t\t\"Integrated Terminus\",\r\n\t\t\"Sleeper Information Sanctum\",\r\n\t\t\"Forgotten Frontier Conversion Module\",\r\n\t\t\"Forgotten Frontier Evacuation Center\",\r\n\t\t\"Unsecured Frontier Digital Nexus\",\r\n\t\t\"Unsecured Frontier Trinary Hub\",\r\n\r\n\t\t// Class 5\r\n\t\t\"Core Garrison\",\r\n\t\t\"Core Stronghold\",\r\n\t\t\"Oruze Osobnyk\",\r\n\t\t\"Quarantine Area\",\r\n\t\t\"Forgotten Core Data Field\",\r\n\t\t\"Forgotten Core Information Pen\",\r\n\t\t\"Unsecured Frontier Enclave Relay\",\r\n\t\t\"Unsecured Frontier Server Bank\",\r\n\r\n\t\t// Class 6\r\n\t\t\"Core Citadel\",\r\n\t\t\"Core Bastion\",\r\n\t\t\"Strange Energy Readings\",\r\n\t\t\"The Mirror\",\r\n\t\t\"Forgotten Core Assembly Hall\",\r\n\t\t\"Forgotten Core Circuitry Disassembler\",\r\n\t\t\"Unsecured Core Backup Array\",\r\n\t\t\"Unsecured Core Emergence\"\r\n\t];\r\n\r\n\tif (wormholeSignatures.indexOf(sigName) > -1) {\r\n\t\treturn '<a href=\"http://eve-survival.org/wikka.php?wakka='+sigName.replace(/ /g, '')+'\" target=\"_blank\" class=\"siteLink\">'+sigName+'</a>';\r\n\t}\r\n\r\n\treturn sigName;\r\n}\r\n\r\n// Custom inlinecomplete + dropdown input\r\n$.widget(\"custom.inlinecomplete\", $.ui.autocomplete, {\r\n\t_create: function() {\r\n\t\tif (!this.element.is(\"input\")) {\r\n\t\t\tthis._selectInit();\r\n\t\t}\r\n\r\n\t\t// Invoke the parent function\r\n\t\treturn this._super();\r\n\t},\r\n\t_value: function() {\r\n\t\t// Invoke the parent function\r\n\t\tvar originalReturn = this._superApply(arguments);\r\n\r\n\t\tthis.element.change();\r\n\r\n\t\treturn originalReturn;\r\n\t},\r\n\t_suggest: function(items) {\r\n\t\t// if (this.element.val() != items[0].value) {\r\n\t\t\t// this.element.val(items[0].value.substr(0, this.element.val().length));\r\n\t\t// }\r\n\r\n\t\t// Invoke the parent function\r\n\t\treturn this._super(items);\r\n\t},\r\n\t_initSource: function() {\r\n\t\tif ($.isArray(this.options.source)) {\r\n\t\t\tthis.source = function(request, response) {\r\n\t\t\t\tvar matcher = new RegExp(\"^\" + $.ui.autocomplete.escapeRegex(request.term), \"i\");\r\n\t\t\t\tvar results = new Array(); // results array\r\n\t\t\t\tvar data = this.options.source;\r\n\t\t\t\tvar maxSize = this.options.maxSize || 25; // maximum result size\r\n\t\t\t\t// simple loop for the options\r\n\t\t\t\tfor (var i = 0, l = data.length; i < l; i++) {\r\n\t\t\t\t\tif (matcher.test(data[i])) {\r\n\t\t\t\t\t\tresults.push(data[i]);\r\n\r\n\t\t\t\t\t\tif (maxSize && results.length > maxSize) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t // send response\r\n\t\t\t\t response(results);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Invoke the parent function\r\n\t\t\treturn this._super();\r\n\t\t}\r\n\t},\r\n\t_close: function(event) {\r\n\t\tthis.options.source = this.options.input_source ? this.options.input_source : this.options.source;\r\n\r\n\t\t// Invoke the parent function\r\n\t\treturn this._super(event);\r\n\t},\r\n\t_selectInit: function() {\r\n\t\tthis.element.addClass(\"custom-combobox\");\r\n\t\tthis.wrapper = this.element;\r\n\t\tthis.element = this.wrapper.find(\"input:first\");\r\n\t\tthis.select = this.wrapper.find(\"select:first\").remove();\r\n\r\n\t\tthis.options.input_source = this.options.source;\r\n\t\tthis.options.select_source = this.select.children(\"option[value!='']\").map(function() {\r\n            return $.trim(this.text);\r\n        }).toArray();\r\n\r\n\t\tthis._createShowAllButton();\r\n\t},\r\n\t_createShowAllButton: function() {\r\n        var that = this,\r\n          wasOpen = false;\r\n\r\n        $(\"<a>\")\r\n\t\t\t.attr(\"tabIndex\", that.element.prop(\"tabindex\"))\r\n\t\t\t.attr(\"title\", \"\")\r\n\t\t\t.appendTo(that.wrapper)\r\n\t\t\t.button({icons: {primary: \"ui-icon-triangle-1-s\"}, text: false})\r\n\t\t\t.removeClass(\"ui-corner-all\")\r\n\t\t\t.addClass(\"custom-combobox-toggle ui-corner-right\")\r\n\t\t\t.on(\"mousedown\", function() {\r\n\t\t\t\twasOpen = that.widget().is(\":visible\");\r\n\t\t\t})\r\n\t\t\t.on(\"click\", function() {\r\n\t\t\t\tthat.element.trigger(\"focus\");\r\n\r\n\t\t\t\t// Close if already visible\r\n\t\t\t\tif (wasOpen) {\r\n\t\t\t\t  return;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Pass empty string as value to search for, displaying all results\r\n\t\t\t\tthat.options.source = that.options.select_source;\r\n\t\t\t\tthat._search(\"\");\r\n\t\t\t});\r\n\t\t},\r\n});\r\n\r\n// Initialize tablesorter plugin on signaturesWidget table\r\n$(\"#sigTable\").tablesorter({\r\n\tsortReset: true,\r\n\twidgets: ['saveSort'],\r\n\ttextExtraction: {\r\n\t\t2: function(node) { return $(node).find(\"span\").data(\"age\"); }\r\n\t}\r\n});\r\n\r\n// Highlight signaturesWidget tr on click\r\n$(\"#sigTable tbody\").on(\"click\", \"tr\", function(e) {\r\n\tif ($(this).hasClass(\"selected\")) {\r\n\t\t$(this).removeClass(\"selected\");\r\n\t} else {\r\n\t\t$(this).addClass(\"selected\");\r\n\t}\r\n\r\n\t// Enable/Disable icon\r\n\t$(\"#signaturesWidget #delete-signature\").trigger(\"delete:refresh\");\r\n});\r\n\r\n// Update signaturesWidget delete icon based on .selected rows\r\n$(\"#signaturesWidget #delete-signature\").on(\"delete:refresh\", function(e) {\r\n\t// Enable/Disable icon\r\n\tif ($(\"#sigTable tr.selected\").length == 0) {\r\n\t\t$(\"#signaturesWidget #delete-signature\").addClass(\"disabled\");\r\n\t} else {\r\n\t\t$(\"#signaturesWidget #delete-signature\").removeClass(\"disabled\");\r\n\t}\r\n});\r\n\r\nvar whList;\r\nwhList = $.map(tripwire.wormholes, function(item, index) { return index;});\r\nwhList.splice(26, 0, \"K162\");\r\nwhList.push(\"???\", \"GATE\");\r\n\r\n$(\".systemsAutocomplete\").inlinecomplete({source: tripwire.aSystems, maxSize: 10, delay: 0});\r\n\r\n$(\"#dialog-error\").dialog({\r\n\tautoOpen: false,\r\n\tresizable: false,\r\n\tminHeight: 0,\r\n\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\tbuttons: {\r\n\t\tOk: function() {\r\n\t\t\t$(this).dialog(\"close\");\r\n\t\t}\r\n\t},\r\n\tcreate: function() {\r\n\t\t$(this).dialog(\"option\", \"show\", {effect: \"shake\", duration: 150, easing: \"easeOutElastic\"});\r\n\t}\r\n});\r\n\r\n$(\"#dialog-msg\").dialog({\r\n\tautoOpen: false,\r\n\tresizable: false,\r\n\tminHeight: 0,\r\n\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\tbuttons: {\r\n\t\tOk: function() {\r\n\t\t\t$(this).dialog(\"close\");\r\n\t\t}\r\n\t}\r\n});\r\n\r\n$(\"#dialog-confirm\").dialog({\r\n\tautoOpen: false,\r\n\tresizable: false,\r\n\tminHeight: 0,\r\n\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\tbuttons: {\r\n\t\tCancel: function() {\r\n\t\t\t$(this).dialog(\"close\");\r\n\t\t}\r\n\t}\r\n});\r\n\r\nif (window.location.href.indexOf(\"galileo\") != -1) {\r\n\tNotify.trigger(\"This is the test version of Tripwire.<br/>Please use <a href='https://tripwire.cloud-things.com'>Tripwire</a>\")\r\n}\r\n","tripwire.active = function(data) {\r\n    var editSigs = [];\r\n    var editComments = [];\r\n\r\n    for (var x in data) {\r\n        var activity = JSON.parse(data[x].activity);\r\n        editSigs.push(parseInt(activity.editSig));\r\n        editComments.push(parseInt(activity.editComment));\r\n\r\n        if (activity.editSig) {\r\n            $(\"#sigTable tr[data-id='\"+activity.editSig+\"']\")\r\n                //.attr('data-tooltip', sig.editing)\r\n                //.attr(\"title\", sig.editing)\r\n                .addClass(\"editing\")\r\n                .find(\"td\")\r\n                .animate({backgroundColor: \"#001b47\"}, 1000); //35240A - Yellow\r\n        }\r\n\r\n        if (activity.editComment && $(\"#commentWrapper .comment[data-id='\"+activity.editComment+\"'] .cke\").length > 0) {\r\n            $(\"#commentWrapper .comment[data-id='\"+activity.editComment+\"']\")\r\n                .addClass(\"editing\")\r\n                .find(\".commentStatus\").html(data[x].characterName + \" is editing\").fadeIn();\r\n        }\r\n    }\r\n\r\n    $(\"#sigTable tr.editing\").each(function() {\r\n        if ($.inArray($(this).data(\"id\"), editSigs) == -1) {\r\n            $(\"#sigTable tr[data-id='\"+$(this).data(\"id\")+\"']\")\r\n                //.attr('data-tooltip', '')\r\n                //.removeAttr(\"title\")\r\n                .removeClass(\"editing\")\r\n                .find(\"td\")\r\n                .animate({backgroundColor: \"#111\"}, 1000, null, function() {$(this).css({backgroundColor: \"\"});});\r\n        }\r\n    });\r\n\r\n    $(\"#commentWrapper .editing\").each(function() {\r\n        if ($.inArray($(this).data(\"id\"), editComments) == -1) {\r\n            $(\"#commentWrapper .editing[data-id='\"+$(this).data(\"id\")+\"']\")\r\n                .removeClass(\"editing\")\r\n                .find(\".commentStatus\").fadeOut(function() {$(this).html(\"\")});\r\n        }\r\n    });\r\n}\r\n","// Hanldes adding to Signatures section\r\n// ToDo: Use native JS\r\ntripwire.addSig = function(add, option, disabled) {\r\n    var option = option || {};\r\n    var animate = typeof(option.animate) !== 'undefined' ? option.animate : true;\r\n    var disabled = disabled || false;\r\n    var wormhole = {};\r\n\r\n    if (add.type == \"wormhole\") {\r\n        var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.parentID == add.id || wormhole.childID == add.id) return wormhole; })[0];\r\n        var otherSignature = add.id == wormhole.parentID ? tripwire.client.signatures[wormhole.childID] : tripwire.client.signatures[wormhole.parentID];\r\n\r\n        if (add.name) {\r\n          leadsTo = tripwire.systems[otherSignature.systemID] ? \"<a href='.?system=\"+tripwire.systems[otherSignature.systemID].name+\"'>\"+add.name+\"</a>\" : add.name;\r\n        } else if (tripwire.aSigSystems[otherSignature.systemID]) {\r\n            leadsTo = tripwire.aSigSystems[otherSignature.systemID];\r\n        } else if (tripwire.systems[otherSignature.systemID]) {\r\n            leadsTo = \"<a href='.?system=\"+tripwire.systems[otherSignature.systemID].name+\"'>\"+tripwire.systems[otherSignature.systemID].name+\"</a>\";\r\n        } else {\r\n            leadsTo = \"\";\r\n        }\r\n\r\n        var row = \"<tr data-id='\"+add.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+(add.signatureID ? add.signatureID.substring(0, 3)+\"-\"+(add.signatureID.substring(3, 6) || \"###\") : \"???-###\")+\"</td>\"\r\n            + \"<td class='type-tooltip \"+ options.signatures.alignment.sigType +\"' data-tooltip=\\\"\"+this.whTooltip(wormhole)+\"\\\">\"+(wormhole.parentID == add.id ? wormhole.type || \"????\" : \"K162\")+\"</td>\"\r\n            + \"<td class=\\\"age-tooltip \"+ options.signatures.alignment.sigAge +\"\\\" data-tooltip='\"+this.ageTooltip(add)+\"'><span data-age='\"+add.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"'>\"+(leadsTo || \"\")+\"</td>\"\r\n            + \"<td class='\"+wormhole.life+\" \"+ options.signatures.alignment.sigLife +\"'>\"+wormhole.life+\"</td>\"\r\n            + \"<td class='\"+wormhole.mass+\" \"+ options.signatures.alignment.sigMass +\"'>\"+wormhole.mass+\"</td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    } else {\r\n        var row = \"<tr data-id='\"+add.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+(add.signatureID ? add.signatureID.substring(0, 3)+\"-\"+(add.signatureID.substring(3, 6) || \"###\") : \"???-###\")+\"</td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigType +\"'>\"+add.type+\"</td>\"\r\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge +\"' data-tooltip='\"+this.ageTooltip(add)+\"'><span data-age='\"+add.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"' colspan='3'>\"+(add.name?linkSig(add.name):'')+\"</td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    }\r\n\r\n    Tooltips.attach($(tr).find(\"[data-tooltip]\"));\r\n\r\n    $(\"#sigTable\").append(tr);\r\n\r\n    $(\"#sigTable\").trigger(\"update\");\r\n\r\n    // Add counter\r\n    if (wormhole.life == \"critical\") {\r\n        $(tr).find('span[data-age]').countdown({until: moment.utc(add.lifeLeft).toDate(), onExpiry: this.pastEOL, alwaysExpire: true, compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime})\r\n            // .countdown('pause')\r\n            .addClass('critical')\r\n            // .countdown('resume');\r\n    } else {\r\n        $(tr).find('span[data-age]').countdown({since: moment.utc(add.lifeTime).toDate(), compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime});\r\n    }\r\n\r\n    if (animate) {\r\n        $(tr)\r\n            .find('td')\r\n            .wrapInner('<div class=\"hidden\" />')\r\n            .parent()\r\n            .find('td > div')\r\n            .slideDown(700, function(){\r\n                $set = $(this);\r\n                $set.replaceWith($set.contents());\r\n            });\r\n\r\n        $(tr).find(\"td\").animate({backgroundColor: \"#004D16\"}, 1000).delay(1000).animate({backgroundColor: \"#111\"}, 1000, null, function() {$(this).css({backgroundColor: \"\"});});\r\n    }\r\n}\r\n","// Handles API updates\r\ntripwire.API = function() {\r\n    this.indicator;\r\n    this.APIrefresh;\r\n\r\n    this.API.expire = function() {\r\n        var options = {since: tripwire.API.APIrefresh, until: null, format: \"MS\", layout: \"-{mnn}{sep}{snn}\"};\r\n        $(\"#APItimer\").countdown(\"option\", options);\r\n    }\r\n\r\n    this.API.refresh = function() {\r\n        $.ajax({\r\n            url: \"api_update.php\",\r\n            cache: false,\r\n            dataType: \"JSON\",\r\n            data: \"indicator=\"+tripwire.API.indicator\r\n        }).done(function(data) {\r\n            if (data && data.APIrefresh) {\r\n                tripwire.API.indicator = data.indicator;\r\n                tripwire.API.APIrefresh = new Date(data.APIrefresh);\r\n                activity.refresh(); //Refresh graph\r\n\r\n                var options = {until: tripwire.API.APIrefresh, since: null, layout: \"{mnn}{sep}{snn}\"};\r\n                $(\"#APItimer\").countdown(\"option\", options);\r\n                setTimeout(\"tripwire.API.refresh();\", $.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) - 30);\r\n\r\n                // Node activity\r\n                if (data.chain)\r\n                    tripwire.chainMap.parse(data.chain);\r\n            } else if ($(\"#APItimer\").countdown(\"option\", \"layout\") !== \"-{mnn}{sep}{snn}\" && $.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) > 120) {\r\n                setTimeout(\"tripwire.API.refresh();\", ($.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) - 30) * 1000);\r\n            } else {\r\n                setTimeout(\"tripwire.API.refresh();\", 15000);\r\n            }\r\n        });\r\n    }\r\n\r\n    this.API.init = function() {\r\n        $.ajax({\r\n            url: \"api_update.php\",\r\n            cache: true,\r\n            dataType: \"JSON\",\r\n            data: \"init=true\"\r\n        }).done(function(data) {\r\n            tripwire.API.indicator = data.indicator;\r\n            tripwire.API.APIrefresh = new Date(data.APIrefresh);\r\n\r\n            $(\"#APItimer\").countdown({until: tripwire.API.APIrefresh, onExpiry: tripwire.API.expire, alwaysExpire: true, compact: true, format: \"MS\", serverSync: tripwire.serverTime.getTime, onTick: function(t) { $(\"#APIclock\").val(t[5] + 1).trigger(\"change\"); }})\r\n            var timer = $(\"#APItimer\").countdown(\"option\", \"layout\") === \"-{mnn}{sep}{snn}\" ? 15 : $.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) - 30;\r\n            setTimeout(\"tripwire.API.refresh();\", timer * 1000);\r\n        });\r\n    }\r\n\r\n    this.API.init();\r\n}\r\ntripwire.API();\r\n","tripwire.autoMapper = function(from, to) {\r\n    // Testing\r\n    // from = $.map(tripwire.systems, function(system, id) { return system.name == from ? id : null; })[0];\r\n    // to = $.map(tripwire.systems, function(system, id) { return system.name == to ? id : null; })[0];\r\n    var pods = [33328, 670];\r\n\r\n    // Make sure from and to are valid systems\r\n    if (!tripwire.systems[from] || !tripwire.systems[to])\r\n        return false;\r\n\r\n    // Is auto-mapper toggled?\r\n    if (!$(\"#toggle-automapper\").hasClass(\"active\"))\r\n        return false;\r\n\r\n    // Is pilot in a pod?\r\n    if ($.inArray(parseInt(tripwire.client.EVE.shipTypeID), pods) >= 0)\r\n        return false;\r\n\r\n    // Is this a gate?\r\n    if (typeof(tripwire.map.shortest[from - 30000000]) != \"undefined\" && typeof(tripwire.map.shortest[from - 30000000][to - 30000000]) != \"undefined\")\r\n        return false;\r\n\r\n    // Is this an existing connection?\r\n    if ($.map(chain.data.rawMap, function(sig) { return (sig.systemID == from && sig.connectionID == to) || (sig.connectionID == from && sig.systemID == to) ? sig : null })[0])\r\n        return false;\r\n\r\n    var data = {\"request\": {\"signatures\": {\"add\": [], \"update\": []}}};\r\n    var sig, toClass = null;\r\n\r\n    if (tripwire.systems[to].class)\r\n        toClass = \"Class \" + tripwire.systems[to].class;\r\n    else if (tripwire.systems[to].security >= 0.45)\r\n        toClass = \"High-Sec\";\r\n    else if (tripwire.systems[to].security > 0)\r\n        toClass = \"Low-Sec\";\r\n    else\r\n        toClass = \"Null-Sec\";\r\n\r\n    sig = $.map(chain.data.rawMap, function(sig) { return sig.systemID == from && sig.mass && ((tripwire.wormholes[sig.type] && tripwire.wormholes[sig.type].leadsTo == toClass && sig.connectionID <= 0) || sig.connection == toClass) ? sig : null; })\r\n    if (sig.length) {\r\n        if (sig.length > 1) {\r\n            $(\"#dialog-msg\").dialog({\r\n                autoOpen: true,\r\n                buttons: {\r\n                    Cancel: function() {\r\n                        $(this).dialog(\"close\");\r\n                    },\r\n                    Ok: function() {\r\n                        var x = $(\"#dialog-msg #msg [name=sig]:checked\").val();\r\n\r\n                        data.request.signatures.update.push({\r\n                            id: sig[x].id,\r\n                            side: \"parent\",\r\n                            signatureID: sig[x].signatureID,\r\n                            systemID: sig[x].systemID,\r\n                            systemName: sig[x].system,\r\n                            type: \"Wormhole\",\r\n                            whType: sig[x].type,\r\n                            sig2ID: sig[x].sig2ID,\r\n                            sig2Type: sig[x].sig2Type,\r\n                            connectionName: tripwire.systems[to].name,\r\n                            connectionID: to,\r\n                            whLife: sig[x].life,\r\n                            whMass: sig[x].mass,\r\n                            lifeLength: sig[x].lifeLength\r\n                        });\r\n\r\n                        data.systemID = viewingSystemID;\r\n\r\n                        var success = function(data) {\r\n                            if (data && data.result == true) {\r\n                                $(\"#dialog-msg\").dialog(\"close\");\r\n                            }\r\n                        }\r\n\r\n                        tripwire.refresh('refresh', data, success);\r\n                    }\r\n                },\r\n                open: function() {\r\n                    $(\"#dialog-msg #msg\").html(\"Which signature would you like to update?<br/><br/>\");\r\n\r\n                    $.each(sig, function(index) {\r\n                        $(\"#dialog-msg #msg\").append(\"<input type='radio' name='sig' value='\"+index+\"' />\"+this.signatureID+\"<br/>\");\r\n                    });\r\n                }\r\n            });\r\n        } else if (sig.length) {\r\n            sig = sig[0];\r\n\r\n            data.request.signatures.update.push({\r\n                id: sig.id,\r\n                side: \"parent\",\r\n                signatureID: sig.signatureID,\r\n                systemID: sig.systemID,\r\n                systemName: sig.system,\r\n                type: \"Wormhole\",\r\n                whType: sig.type,\r\n                sig2ID: sig.sig2ID,\r\n                sig2Type: sig.sig2Type,\r\n                connectionName: tripwire.systems[to].name,\r\n                connectionID: to,\r\n                whLife: sig.life,\r\n                whMass: sig.mass,\r\n                lifeLength: sig.lifeLength\r\n            });\r\n        }\r\n    } else if (sig = $.map(chain.data.rawMap, function(sig) { return sig.systemID == from && sig.connectionID <= 0 && (sig.type == \"???\" || sig.type == \"K162\") ? sig : null; })) {\r\n        if (sig.length > 1) {\r\n            $(\"#dialog-msg\").dialog({\r\n                autoOpen: true,\r\n                buttons: {\r\n                    Cancel: function() {\r\n                        $(this).dialog(\"close\");\r\n                    },\r\n                    Ok: function() {\r\n                        var x = $(\"#dialog-msg #msg [name=sig]:checked\").val();\r\n\r\n                        data.request.signatures.update.push({\r\n                            id: sig[x].id,\r\n                            side: \"parent\",\r\n                            signatureID: sig[x].signatureID,\r\n                            systemID: sig[x].systemID,\r\n                            systemName: sig[x].system,\r\n                            type: \"Wormhole\",\r\n                            whType: sig[x].type,\r\n                            sig2ID: sig[x].sig2ID,\r\n                            sig2Type: sig[x].sig2Type,\r\n                            connectionName: tripwire.systems[to].name,\r\n                            connectionID: to,\r\n                            whLife: sig[x].life,\r\n                            whMass: sig[x].mass,\r\n                            lifeLength: sig[x].lifeLength\r\n                        });\r\n\r\n                        data.systemID = viewingSystemID;\r\n\r\n                        var success = function(data) {\r\n                            if (data && data.result == true) {\r\n                                $(\"#dialog-msg\").dialog(\"close\");\r\n                            }\r\n                        }\r\n\r\n                        tripwire.refresh('refresh', data, success);\r\n                    }\r\n                },\r\n                open: function() {\r\n                    $(\"#dialog-msg #msg\").html(\"Which signature would you like to update?<br/><br/>\");\r\n\r\n                    $.each(sig, function(index) {\r\n                        $(\"#dialog-msg #msg\").append(\"<input type='radio' name='sig' value='\"+index+\"' /> \"+this.signatureID+\"<br/>\");\r\n                    });\r\n                }\r\n            });\r\n        } else if (sig.length) {\r\n            sig = sig[0];\r\n\r\n            data.request.signatures.update.push({\r\n                id: sig.id,\r\n                side: \"parent\",\r\n                signatureID: sig.signatureID,\r\n                systemID: sig.systemID,\r\n                systemName: sig.system,\r\n                type: \"Wormhole\",\r\n                whType: sig.type,\r\n                sig2ID: sig.sig2ID,\r\n                sig2Type: sig.sig2Type,\r\n                connectionName: tripwire.systems[to].name,\r\n                connectionID: to,\r\n                whLife: sig.life,\r\n                whMass: sig.mass,\r\n                lifeLength: sig.lifeLength\r\n            });\r\n        }\r\n    }\r\n\r\n    if (sig.length == 0) {\r\n        data.request.signatures.add.push({\r\n            signatureID: \"???\",\r\n            systemID: from,\r\n            type: \"Wormhole\",\r\n            whType: \"???\",\r\n            class: sigClass(tripwire.systems[from].name, \"???\"),\r\n            class2: sigClass(tripwire.systems[to].name, null),\r\n            connectionName: \"\",\r\n            connectionID: to\r\n        });\r\n    }\r\n\r\n    if (data.request.signatures.add.length || data.request.signatures.update.length) {\r\n        data.systemID = viewingSystemID;\r\n\r\n        var update = $.map(data.request.signatures.update, function(signature) { return tripwire.client.signatures[signature.id]; });\r\n        var success = function(data) {\r\n            if (data.result == true) {\r\n                $(\"#undo\").removeClass(\"disabled\");\r\n                if (viewingSystemID in tripwire.signatures.undo) {\r\n                    if (data.resultSet) {\r\n                        tripwire.signatures.undo[viewingSystemID].push({action: \"add\", signatures: $.map(data.resultSet, function(id) { return data.signatures[id]; })});\r\n                    }\r\n\r\n                    if (update.length) {\r\n                        tripwire.signatures.undo[viewingSystemID].push({action: \"update\", signatures: update});\r\n                    }\r\n                } else {\r\n                    if (data.resultSet) {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{action: \"add\", signatures: $.map(data.resultSet, function(id) { return data.signatures[id]; })}];\r\n                    }\r\n\r\n                    if (update.length) {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{action: \"update\", signatures: update}];\r\n                    }\r\n                }\r\n\r\n                sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n            }\r\n        }\r\n\r\n        tripwire.refresh('refresh', data, success);\r\n    }\r\n}\r\n","$(\"body\").on(\"dblclick\", \".comment\", function(e) {\r\n\te.preventDefault();\r\n\tdocument.getSelection().removeAllRanges();\r\n\t$(this).find(\".commentEdit\").click();\r\n})\r\n\r\n$(\"body\").on(\"click\", \".commentEdit\", function(e) {\r\n\te.preventDefault();\r\n\r\n\t// Prevent multiple editors\r\n\tif ($(\".cke\").length) return false;\r\n\r\n\tvar $comment = $(this).closest(\".comment\");\r\n\r\n\t$comment.find(\".commentToolbar\").hide();\r\n\r\n\tCKEDITOR.replace($comment.find(\".commentBody\").attr(\"id\"), CKConfig).on(\"instanceReady\", function() {\r\n\t\t$comment.find(\".commentStatus\").html(\"\");\r\n\t\t$comment.find(\".commentFooter\").show();\r\n\t\t$comment.find(\".commentFooter .commentControls\").show();\r\n\t});\r\n\r\n\ttripwire.activity.editComment = $comment.data(\"id\");\r\n\ttripwire.refresh('refresh');\r\n});\r\n\r\n$(\"body\").on(\"click\", \".commentSave, .commentCancel\", function(e) {\r\n\te.preventDefault();\r\n\tvar $this = $(this);\r\n\tif ($this.attr(\"disabled\")) return false;\r\n\r\n\tvar $comment = $this.closest(\".comment\");\r\n\t$this.attr(\"disabled\", \"true\");\r\n\r\n\tif ($this.hasClass(\"commentSave\")) {\r\n\t\tvar data = {\"mode\": \"save\", \"commentID\": $comment.data(\"id\"), \"systemID\": $comment.find(\".commentSticky\").hasClass(\"active\") ? 0 : viewingSystemID, \"comment\": CKEDITOR.instances[$comment.find(\".commentBody\").attr(\"id\")].getData()};\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: \"comments.php\",\r\n\t\t\ttype: \"POST\",\r\n\t\t\tdata: data,\r\n\t\t\tdataType: \"JSON\"\r\n\t\t}).done(function(data) {\r\n\t\t\tif (data && data.result == true) {\r\n\t\t\t\t$comment.find(\".commentModified\").html(\"Edited by \" + data.comment.modifiedBy + \" at \" + data.comment.modifiedDate);\r\n\t\t\t\t$comment.find(\".commentCreated\").html(\"Posted by \" + data.comment.createdBy + \" at \" + data.comment.createdDate);\r\n\t\t\t\tTooltips.attach($comment.find(\"[data-tooltip]\"));\r\n\r\n\t\t\t\tCKEDITOR.instances[$comment.find(\".commentBody\").attr(\"id\")].destroy(false);\r\n\t\t\t\t$comment.attr(\"data-id\", data.comment.id);\r\n\t\t\t\t$comment.find(\".commentToolbar\").show();\r\n\t\t\t\t$comment.find(\".commentFooter\").hide();\r\n\t\t\t\t$this.removeAttr(\"disabled\");\r\n\t\t\t}\r\n\t\t});\r\n\t} else {\r\n\t\tCKEDITOR.instances[$comment.find(\".commentBody\").attr(\"id\")].destroy(true);\r\n\r\n\t\tif (!$comment.attr(\"data-id\")) {\r\n\t\t\t$comment.remove();\r\n\t\t} else {\r\n\t\t\t$comment.find(\".commentToolbar\").show();\r\n\t\t\t$comment.find(\".commentFooter\").hide();\r\n\t\t\t$this.removeAttr(\"disabled\");\r\n\t\t}\r\n\t}\r\n\r\n\t$comment.find(\".commentStatus\").html(\"\");\r\n\r\n\tdelete tripwire.activity.editComment;\r\n\ttripwire.refresh('refresh');\r\n});\r\n\r\n$(\"body\").on(\"click\", \".commentDelete\", function(e) {\r\n\te.preventDefault();\r\n\tvar $comment = $(this).closest(\".comment\");\r\n\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-deleteComment\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-deleteComment\").data(\"comment\", $comment).dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tposition: {my: \"center\", at: \"center\", of: $(\"#notesWidget\")},\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tDelete: function() {\r\n\t\t\t\t\t// Prevent duplicate submitting\r\n\t\t\t\t\t$(\"#dialog-deleteComment\").parent().find(\":button:contains('Delete')\").button(\"disable\");\r\n\r\n\t\t\t\t\tvar $comment = $(this).data(\"comment\");\r\n\t\t\t\t\tvar data = {\"mode\": \"delete\", \"commentID\": $comment.data(\"id\")};\r\n\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: \"comments.php\",\r\n\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\tdata: data,\r\n\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t}).done(function(data) {\r\n\t\t\t\t\t\tif (data && data.result == true) {\r\n\t\t\t\t\t\t\t$(\"#dialog-deleteComment\").dialog(\"close\");\r\n\t\t\t\t\t\t\t$comment.remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).always(function() {\r\n\t\t\t\t\t\t$(\"#dialog-deleteComment\").parent().find(\":button:contains('Delete')\").button(\"enable\");\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-deleteComment\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-deleteComment\").data(\"comment\", $comment).dialog(\"open\");\r\n\t}\r\n});\r\n\r\n$(\"body\").on(\"click\", \"#add-comment\", function(e) {\r\n\te.preventDefault();\r\n\r\n\t// Prevent multiple editors\r\n\tif ($(\".cke\").length) return false;\r\n\r\n\tvar $comment = $(\".comment:last\").clone();\r\n\tvar commentID = $(\".comment:visible:last .commentBody\").attr(\"id\") ? $(\".comment:visible:last .commentBody\").attr(\"id\").replace(\"comment\", \"\") + 1 : 0;\r\n\t$(\".comment:last\").before($comment);\r\n\r\n\t$comment.find(\".commentBody\").attr(\"id\", \"comment\" + commentID);\r\n\t$comment.removeClass(\"hidden\").find(\".commentEdit\").click();\r\n});\r\n\r\n$(\"body\").on(\"click\", \".commentSticky\", function(e) {\r\n\te.preventDefault();\r\n\tvar $comment = $(this).closest(\".comment\");\r\n\r\n\tvar data = {\"mode\": \"sticky\", \"commentID\": $comment.data(\"id\"), \"systemID\": $comment.find(\".commentSticky\").hasClass(\"active\") ? viewingSystemID : 0};\r\n\r\n\t$.ajax({\r\n\t\turl: \"comments.php\",\r\n\t\ttype: \"POST\",\r\n\t\tdata: data,\r\n\t\tdataType: \"JSON\"\r\n\t}).done(function(data) {\r\n\t\tif (data && data.result == true) {\r\n\t\t\t$comment.find(\".commentSticky\").hasClass(\"active\") ? $comment.find(\".commentSticky\").removeClass(\"active\") : $comment.find(\".commentSticky\").addClass(\"active\");\r\n\t\t}\r\n\t});\r\n});\r\n","// Handles removing from Signatures section\r\ntripwire.deleteSig = function(key) {\r\n    var tr = $(\"#sigTable tr[data-id='\"+key+\"']\");\r\n\r\n    // unselect the tr because we will delete it\r\n    $(tr).removeClass(\"selected\");\r\n    $(\"#delete-signature\").trigger(\"delete:refresh\");\r\n\r\n    //Append empty space to prevent non-coloring\r\n    $(tr).find('td:empty, a:empty').append(\"&nbsp;\");\r\n\r\n    $(tr)\r\n        .find('td')\r\n        .wrapInner('<div />')\r\n        .parent()\r\n        .find('td > div').animate({backgroundColor: \"#4D0000\"}, 1000).delay(1000).animate({backgroundColor: \"#111\"}, 1000)\r\n        .slideUp(700, function(){\r\n            // Remove countdown reference\r\n            $(tr).find('span[data-age]').countdown(\"destroy\");\r\n\r\n            $(this).parent().parent().remove();\r\n            $(\"#sigTable\").trigger(\"update\");\r\n        });\r\n}\r\n","// Handles changing Signatures section\r\n// ToDo: Use native JS\r\ntripwire.editSig = function(edit, disabled) {\r\n    var disabled = disabled || false;\r\n    var wormhole = {};\r\n\r\n    if (edit.type == \"wormhole\") {\r\n        var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.parentID == edit.id || wormhole.childID == edit.id) return wormhole; })[0];\r\n        var otherSignature = edit.id == wormhole.parentID ? tripwire.client.signatures[wormhole.childID] : tripwire.client.signatures[wormhole.parentID];\r\n\r\n        if (edit.name) {\r\n          leadsTo = tripwire.systems[otherSignature.systemID] ? \"<a href='.?system=\"+tripwire.systems[otherSignature.systemID].name+\"'>\"+edit.name+\"</a>\" : edit.name;\r\n        } else if (tripwire.aSigSystems[otherSignature.systemID]) {\r\n            leadsTo = tripwire.aSigSystems[otherSignature.systemID];\r\n        } else if (tripwire.systems[otherSignature.systemID]) {\r\n            leadsTo = \"<a href='.?system=\"+tripwire.systems[otherSignature.systemID].name+\"'>\"+tripwire.systems[otherSignature.systemID].name+\"</a>\";\r\n        } else {\r\n            leadsTo = \"\";\r\n        }\r\n\r\n        var row = \"<tr data-id='\"+edit.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+(edit.signatureID ? edit.signatureID.substring(0, 3)+\"-\"+(edit.signatureID.substring(3, 6) || \"###\") : \"???-###\")+\"</td>\"\r\n            + \"<td class='type-tooltip \"+ options.signatures.alignment.sigType +\"' data-tooltip=\\\"\"+this.whTooltip(wormhole)+\"\\\">\"+(wormhole.type || \"????\")+\"</td>\"\r\n            + \"<td class=\\\"age-tooltip \"+ options.signatures.alignment.sigAge +\"\\\" data-tooltip='\"+this.ageTooltip(edit)+\"'><span data-age='\"+edit.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"'>\"+(leadsTo || \"\")+\"</td>\"\r\n            + \"<td class='\"+wormhole.life+\" \"+ options.signatures.alignment.sigLife +\"'>\"+wormhole.life+\"</td>\"\r\n            + \"<td class='\"+wormhole.mass+\" \"+ options.signatures.alignment.sigMass +\"'>\"+wormhole.mass+\"</td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    } else {\r\n        var row = \"<tr data-id='\"+edit.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+(edit.signatureID ? edit.signatureID.substring(0, 3)+\"-\"+(edit.signatureID.substring(3, 6) || \"###\") : \"???-###\")+\"</td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigType +\"'>\"+edit.type+\"</td>\"\r\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge +\"' data-tooltip='\"+this.ageTooltip(edit)+\"'><span data-age='\"+edit.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"' colspan='3'>\"+(edit.name?linkSig(edit.name):'')+\"</td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    }\r\n\r\n    Tooltips.attach($(tr).find(\"[data-tooltip]\"));\r\n\r\n    // Destroy the pervious countdown to prevent errors on a non-existant DOM element\r\n    $(\"#sigTable tr[data-id='\"+edit.id+\"']\").find('span[data-age]').countdown(\"destroy\");\r\n    $(\"#sigTable tr[data-id='\"+edit.id+\"']\").replaceWith(tr);\r\n\r\n    $(\"#sigTable\").trigger(\"update\");\r\n    // Update counter\r\n    if (wormhole.life == \"critical\") {\r\n        $(tr).find('span[data-age]').countdown({until: moment.utc(edit.lifeLeft).toDate(), onExpiry: this.pastEOL, alwaysExpire: true, compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime})\r\n            .addClass('critical');\r\n    } else {\r\n        $(tr).find('span[data-age]').countdown({since: moment.utc(edit.lifeTime).toDate(), compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime});\r\n    }\r\n\r\n    $(tr).effect(\"pulsate\");\r\n}\r\n","tripwire.esi = function() {\r\n    var baseUrl = \"https://esi.tech.ccp.is\";\r\n    var userAgent = \"Tripwire Client \" + tripwire.version + \" (\" + window.location.hostname + \") - \" + window.navigator.userAgent;\r\n    this.esi.connection = true;\r\n    this.esi.characters = {};\r\n\r\n    var scopeError = function(characterID) {\r\n        $(\"#tracking .tracking-clone[data-characterid='\"+ characterID +\"']\").find(\".alert\").show();\r\n    }\r\n\r\n    var location = function() {\r\n        location.timer;\r\n\r\n        clearTimeout(location.timer);\r\n\r\n        for (characterID in tripwire.esi.characters) {\r\n            var character = tripwire.esi.characters[characterID];\r\n\r\n            // Check for expiring token\r\n            if (moment(character.tokenExpire).subtract(5, \"minutes\").isBefore(moment())) {\r\n                tripwire.data.esi = {\"expired\": true};\r\n                continue;\r\n            }\r\n\r\n            $.ajax({\r\n                url: baseUrl + \"/v1/characters/\"+ characterID +\"/location/?\" + $.param({\"token\": character.accessToken, \"user_agent\": userAgent}),\r\n                // headers: {\"Authorization\": \"Bearer \"+ character.accessToken, \"X-User-Agent\": userAgent},\r\n                type: \"GET\",\r\n                dataType: \"JSON\",\r\n                characterID: characterID\r\n            }).done(function(data, status, xhr) {\r\n                var character = tripwire.esi.characters[this.characterID];\r\n\r\n                if (character) {\r\n                    character.locationDate = xhr.getResponseHeader(\"last-modified\");\r\n\r\n                    if (character.systemID != data.solar_system_id) {\r\n                        character.systemID = data.solar_system_id || null;\r\n                        character.systemName = tripwire.systems[data.solar_system_id] ? tripwire.systems[data.solar_system_id].name : null;\r\n\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".system\").html(character.systemName || \"&nbsp;\");\r\n\r\n                        // Send to Tripwire server on next refresh call\r\n                        tripwire.data.tracking[this.characterID] = {\r\n                            characterID: character.characterID,\r\n                            characterName: character.characterName,\r\n                            systemID: character.systemID,\r\n                            systemName: character.systemName,\r\n                            stationID: character.stationID,\r\n                            stationName: character.stationName,\r\n                            shipID: character.shipID,\r\n                            shipName: character.shipName,\r\n                            shipTypeID: character.shipTypeID,\r\n                            shipTypeName: character.shipTypeName};\r\n                    }\r\n\r\n                    if (character.stationID != data.station_id) {\r\n                        character.stationID = data.station_id || null;\r\n\r\n                        if (data.station_id) {\r\n                            tripwire.esi.stationLookup(data.station_id, this.characterID)\r\n                                .always(function(data) {\r\n                                    var character = tripwire.esi.characters[this.reference];\r\n\r\n                                    character.stationName = data.name || null;\r\n                                    $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference +\"']\").find(\".station\").html(data.name.substring(0, 17) + \"...\" || \"&nbsp;\").attr(\"data-tooltip\", data.name);\r\n                                    Tooltips.attach($(\"#tracking .tracking-clone[data-characterid='\"+ this.reference +\"'] .station[data-tooltip]\"));\r\n\r\n                                    // Send to Tripwire server on next refresh call\r\n                                    tripwire.data.tracking[characterID] = {\r\n                                        characterID: character.characterID,\r\n                                        characterName: character.characterName,\r\n                                        systemID: character.systemID,\r\n                                        systemName: character.systemName,\r\n                                        stationID: character.stationID,\r\n                                        stationName: character.stationName,\r\n                                        shipID: character.shipID,\r\n                                        shipName: character.shipName,\r\n                                        shipTypeID: character.shipTypeID,\r\n                                        shipTypeName: character.shipTypeName};\r\n                                });\r\n                        } else {\r\n                            character.stationName = null;\r\n                            // $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".station\").html(\"&nbsp;\").attr(\"data-tooltip\", \"&nbsp;\");\r\n                            Tooltips.detach($(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"'] .station[data-tooltip]\"));\r\n\r\n                            // Send to Tripwire server on next refresh call\r\n                            tripwire.data.tracking[this.characterID] = {\r\n                                characterID: character.characterID,\r\n                                characterName: character.characterName,\r\n                                systemID: character.systemID,\r\n                                systemName: character.systemName,\r\n                                stationID: character.stationID,\r\n                                stationName: character.stationName,\r\n                                shipID: character.shipID,\r\n                                shipName: character.shipName,\r\n                                shipTypeID: character.shipTypeID,\r\n                                shipTypeName: character.shipTypeName};\r\n                        }\r\n                    }\r\n\r\n                    if (options.tracking.active == this.characterID) {\r\n                        tripwire.EVE(tripwire.esi.characters[options.tracking.active]);\r\n                    }\r\n                }\r\n            }).fail(function(data) {\r\n                if (data.status == 403) {\r\n                    tripwire.refresh(\"refresh\", {\"esi\": {\"expired\": true}});\r\n                }\r\n            }).always(function(data, status) {\r\n                if (status != \"success\" && status != \"abort\" && tripwire.esi.connection == true) {\r\n                    tripwire.esi.connection = false;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Failed\", \"red\", false, \"esiConnectionError\");\r\n                } else if (status == \"success\" && tripwire.esi.connection == false) {\r\n                    tripwire.esi.connection = true;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Resumed\", \"green\", 5000, \"esiConnectionSuccess\");\r\n                }\r\n            });\r\n        }\r\n\r\n        location.timer = setTimeout(location, 5000);\r\n    }\r\n\r\n    var ship = function() {\r\n        ship.timer;\r\n\r\n        clearTimeout(ship.timer);\r\n\r\n        for (characterID in tripwire.esi.characters) {\r\n            var character = tripwire.esi.characters[characterID];\r\n\r\n            // Check for expiring token\r\n            if (moment(character.tokenExpire).subtract(5, \"minutes\").isBefore(moment())) {\r\n                tripwire.data.esi = {\"expired\": true};\r\n                continue;\r\n            }\r\n\r\n            $.ajax({\r\n                url: baseUrl + \"/v1/characters/\"+ characterID +\"/ship/?\" + $.param({\"token\": character.accessToken, \"user_agent\": userAgent}),\r\n                // headers: {\"Authorization\": \"Bearer \"+ character.accessToken, \"X-User-Agent\": userAgent},\r\n                type: \"GET\",\r\n                dataType: \"JSON\",\r\n                characterID: characterID\r\n            }).done(function(data, status, xhr) {\r\n                var character = tripwire.esi.characters[this.characterID];\r\n\r\n                if (character) {\r\n                    character.shipDate = xhr.getResponseHeader(\"last-modified\");\r\n\r\n                    if (character.shipID != data.ship_item_id) {\r\n                        character.shipID = data.ship_item_id || null;\r\n\r\n                        // Send to Tripwire server on next refresh call\r\n                        tripwire.data.tracking[this.characterID] = {\r\n                            characterID: character.characterID,\r\n                            characterName: character.characterName,\r\n                            systemID: character.systemID,\r\n                            systemName: character.systemName,\r\n                            stationID: character.stationID,\r\n                            stationName: character.stationName,\r\n                            shipID: character.shipID,\r\n                            shipName: character.shipName,\r\n                            shipTypeID: character.shipTypeID,\r\n                            shipTypeName: character.shipTypeName};\r\n                    }\r\n\r\n                    if (character.shipName != data.ship_name) {\r\n                        character.shipName = data.ship_name || null;\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".shipname\").html(data.ship_name || \"&nbsp;\");\r\n\r\n                        // Send to Tripwire server on next refresh call\r\n                        tripwire.data.tracking[this.characterID] = {\r\n                            characterID: character.characterID,\r\n                            characterName: character.characterName,\r\n                            systemID: character.systemID,\r\n                            systemName: character.systemName,\r\n                            stationID: character.stationID,\r\n                            stationName: character.stationName,\r\n                            shipID: character.shipID,\r\n                            shipName: character.shipName,\r\n                            shipTypeID: character.shipTypeID,\r\n                            shipTypeName: character.shipTypeName};\r\n                    }\r\n\r\n                    if (character.shipTypeID != data.ship_type_id) {\r\n                        character.shipTypeID = data.ship_type_id || null;\r\n\r\n                        if (data.ship_type_id) {\r\n                            tripwire.esi.typeLookup(data.ship_type_id, this.characterID)\r\n                                .always(function(data) {\r\n                                    var character = tripwire.esi.characters[this.reference];\r\n\r\n                                    character.shipTypeName = data.name || null;\r\n                                    $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference +\"']\").find(\".ship\").html(data.name || \"&nbsp;\");\r\n\r\n                                    // Send to Tripwire server on next refresh call\r\n                                    tripwire.data.tracking[this.characterID] = {\r\n                                        characterID: character.characterID,\r\n                                        characterName: character.characterName,\r\n                                        systemID: character.systemID,\r\n                                        systemName: character.systemName,\r\n                                        stationID: character.stationID,\r\n                                        stationName: character.stationName,\r\n                                        shipID: character.shipID,\r\n                                        shipName: character.shipName,\r\n                                        shipTypeID: character.shipTypeID,\r\n                                        shipTypeName: character.shipTypeName};\r\n                                });\r\n                        } else {\r\n                            character.shipTypeName = null;\r\n                            $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".ship\").html(\"&nbsp;\");\r\n\r\n                            // Send to Tripwire server on next refresh call\r\n                            tripwire.data.tracking[this.characterID] = {\r\n                                characterID: character.characterID,\r\n                                characterName: character.characterName,\r\n                                systemID: character.systemID,\r\n                                systemName: character.systemName,\r\n                                stationID: character.stationID,\r\n                                stationName: character.stationName,\r\n                                shipID: character.shipID,\r\n                                shipName: character.shipName,\r\n                                shipTypeID: character.shipTypeID,\r\n                                shipTypeName: character.shipTypeName};\r\n                        }\r\n                    }\r\n                }\r\n            }).fail(function(data) {\r\n                if (data.status == 403) {\r\n                    tripwire.refresh(\"refresh\", {\"esi\": {\"expired\": true}});\r\n                }\r\n            }).always(function(data, status) {\r\n                if (status != \"success\" && status != \"abort\" && tripwire.esi.connection == true) {\r\n                    tripwire.esi.connection = false;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Failed\", \"red\", false, \"esiConnectionError\");\r\n                } else if (status == \"success\" && tripwire.esi.connection == false) {\r\n                    tripwire.esi.connection = true;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Resumed\", \"green\", 5000, \"esiConnectionSuccess\");\r\n                }\r\n            });\r\n        }\r\n\r\n        ship.timer = setTimeout(ship, 5000);\r\n    }\r\n\r\n    var online = function() {\r\n        online.timer;\r\n\r\n        clearTimeout(online.timer);\r\n\r\n        for (characterID in tripwire.esi.characters) {\r\n            var character = tripwire.esi.characters[characterID];\r\n\r\n            tripwire.esi.characterStatus(character.characterID, character)\r\n                .done(function(data) {\r\n                    if (data) {\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference.characterID +\"']\").find(\".online\").removeClass(\"critical\").addClass(\"stable\");\r\n                    } else {\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference.characterID +\"']\").find(\".online\").removeClass(\"stable\").addClass(\"critical\");\r\n                    }\r\n                }).fail(function(data) {\r\n                    if (data && data.status == 403) {\r\n                        scopeError(this.reference.characterID);\r\n                    }\r\n                    $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference.characterID +\"']\").find(\".online\").removeClass(\"stable\").addClass(\"critical\");\r\n                });\r\n        }\r\n\r\n        online.timer = setTimeout(online, 60000);\r\n    }\r\n\r\n    this.esi.typeLookup = function(typeID, reference) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/universe/types/\"+ typeID +\"/?\" + $.param({\"user_agent\": userAgent}),\r\n            // headers: {\"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            reference: reference\r\n        });\r\n    }\r\n\r\n    this.esi.stationLookup = function(stationID, reference) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/universe/stations/\"+ stationID +\"/?\" + $.param({\"user_agent\": userAgent}),\r\n            // headers: {\"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            reference: reference\r\n        });\r\n    }\r\n\r\n    this.esi.setDestination = function(destinationID, characterID, clear_waypoints, beginning) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/ui/autopilot/waypoint/?\" + $.param({destination_id: destinationID, clear_other_waypoints: clear_waypoints, add_to_beginning: beginning}),\r\n            headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.characters[characterID].accessToken, \"X-User-Agent\": userAgent},\r\n            type: \"POST\",\r\n            dataType: \"JSON\"\r\n        });\r\n    }\r\n\r\n    this.esi.showInfo = function(targetID, characterID) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v1/ui/openwindow/information/?\" + $.param({target_id: targetID}),\r\n            headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.characters[characterID].accessToken, \"X-User-Agent\": userAgent},\r\n            type: \"POST\",\r\n            dataType: \"JSON\"\r\n        });\r\n    }\r\n\r\n    this.esi.characterStatus = function(characterID, reference) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v1/characters/\" + characterID + \"/online/?\" + $.param({\"token\": tripwire.esi.characters[characterID].accessToken, \"user_agent\": userAgent}),\r\n            // headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.characters[characterID].accessToken, \"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            reference: reference\r\n        });\r\n    }\r\n\r\n    this.esi.eveStatus = function() {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v1/status/?\" + $.param({\"user_agent\": userAgent}),\r\n            // headers: {\"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\"\r\n        });\r\n    }\r\n\r\n    this.esi.idLookup = function(eveIDs) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/universe/names/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"POST\",\r\n            dataType: \"JSON\",\r\n            contentType: \"application/json\",\r\n            processData: false,\r\n            data: JSON.stringify(eveIDs)\r\n        });\r\n    }\r\n\r\n    this.esi.characterLookup = function(eveID, reference, async) {\r\n        var async = typeof(async) !== 'undefined' ? async : true;\r\n        return $.ajax({\r\n            url: baseUrl + \"/v4/characters/\" + eveID + \"/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            async: async,\r\n            eveID: eveID,\r\n            reference: reference\r\n        });\r\n    }\r\n\r\n    this.esi.corporationLookup = function(eveID, reference, async) {\r\n        var async = typeof(async) !== 'undefined' ? async : true;\r\n        return $.ajax({\r\n            url: baseUrl + \"/v4/corporations/\" + eveID + \"/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            async: async,\r\n            eveID: eveID,\r\n            reference: reference\r\n        });\r\n    }\r\n\r\n    this.esi.allianceLookup = function(eveID, reference, async) {\r\n        var async = typeof(async) !== 'undefined' ? async : true;\r\n        return $.ajax({\r\n            url: baseUrl + \"/v3/alliances/\" + eveID + \"/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            async: async,\r\n            eveID: eveID,\r\n            reference: reference\r\n        });\r\n    }\r\n\r\n    this.esi.search = function(searchString, categories, strict) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/search/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            contentType: \"application/json\",\r\n            data: {\"search\": searchString, \"categories\": categories, \"strict\": strict}\r\n        });\r\n    }\r\n\r\n    this.esi.universeJumps = function() {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v1/universe/system_jumps/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\"\r\n        });\r\n    }\r\n\r\n    this.esi.universeKills = function() {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/universe/system_kills/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\"\r\n        });\r\n    }\r\n\r\n    // Wrapper to make lookups easier\r\n    this.esi.fullLookup = function(eveIDs) {\r\n        var promise = $.Deferred();\r\n\r\n        tripwire.esi.idLookup(eveIDs)\r\n            .done(function(data) {\r\n                for (item in data) {\r\n                    if (data[item].category == \"character\") {\r\n                        tripwire.esi.characterLookup(data[item].id, data[item], false)\r\n                            .done(function(characterData) {\r\n                                $.extend(data[item], characterData);\r\n                                tripwire.esi.corporationLookup(characterData.corporation_id, this.reference, false)\r\n                                    .done(function(corporationData) {\r\n                                        data[item].corporation = corporationData;\r\n                                        if (corporationData.alliance_id) {\r\n                                            tripwire.esi.allianceLookup(corporationData.alliance_id, this.reference, false)\r\n                                                .done(function(allianceData) {\r\n                                                    data[item].alliance = allianceData;\r\n                                                });\r\n                                        }\r\n                                    });\r\n                            });\r\n                    } else if (data[item].category == \"corporation\") {\r\n                        tripwire.esi.corporationLookup(data[item].id, data[item], false)\r\n                            .done(function(corporationData) {\r\n                                $.extend(data[item], corporationData);\r\n                                if (corporationData.alliance_id) {\r\n                                    tripwire.esi.allianceLookup(corporationData.alliance_id, this.reference, false)\r\n                                        .done(function(allianceData) {\r\n                                            data[item].alliance = allianceData;\r\n                                        });\r\n                                }\r\n                            })\r\n                    }\r\n                }\r\n\r\n                promise.resolve(data);\r\n            });\r\n\r\n        return promise;\r\n    }\r\n\r\n    this.esi.parse = function(characters) {\r\n        for (characterID in tripwire.esi.characters) {\r\n            if (!(characterID in characters)) {\r\n                delete tripwire.esi.characters[characterID];\r\n                $(\"#tracking .tracking-clone[data-characterid='\"+ characterID +\"']\").remove();\r\n                if (options.tracking.active == characterID) {\r\n                    tripwire.EVE(false, true);\r\n                    $(\"#removeESI\").attr(\"disabled\", \"disabled\");\r\n                }\r\n            }\r\n        }\r\n\r\n        for (characterID in characters) {\r\n            if (options.tracking.active == \"new\") {\r\n                options.tracking.active = characterID;\r\n            }\r\n\r\n            if (!(characterID in tripwire.esi.characters)) {\r\n                var $clone = $(\"#tracking-clone\").clone();\r\n                $clone.attr(\"data-characterid\", characterID);\r\n                $clone.find(\".avatar img\").attr(\"src\", \"https://image.eveonline.com/Character/\"+ characterID +\"_32.jpg\");\r\n                $clone.find(\".name\").html(characters[characterID].characterName);\r\n                $clone.removeAttr(\"id\");\r\n                $clone.removeClass(\"hidden\");\r\n                $clone.addClass(\"tracking-clone\");\r\n\r\n                if (options.tracking.active == characterID) {\r\n                    $clone.addClass(\"active\");\r\n                    $(\"#removeESI\").removeAttr(\"disabled\");\t\t\t\t}\r\n\r\n                $(\"#tracking\").append($clone);\r\n                // Tooltips.attach($clone.find(\"[data-tooltip]\"));\r\n            }\r\n\r\n            tripwire.esi.characters[characterID] = characters[characterID];\r\n        }\r\n\r\n        ship();\r\n        location();\r\n        online();\r\n    }\r\n}\r\ntripwire.esi();\r\n","// Handles data from EVE in-game data\r\ntripwire.EVE = function(EVE, characterChange) {\r\n    var systemChange = this.client.EVE && this.client.EVE.systemChange || false;\r\n\r\n    if (EVE) {\r\n        // Automapper\r\n        if (!characterChange) {\r\n            // Did the system change or did it previously and we have yet to try an autoMapper call?\r\n            if ((this.client.EVE && this.client.EVE.systemID != EVE.systemID) || systemChange == true) {\r\n                systemChange = true;\r\n\r\n                // Check if location was updated after the last ship update\r\n                if (moment(EVE.locationDate).isAfter(moment(this.client.EVE.shipDate))) {\r\n                    systemChange = false;\r\n                    tripwire.autoMapper(this.client.EVE.systemID, EVE.systemID);\r\n                }\r\n            }\r\n        }\r\n\r\n        // System follower\r\n        if (!characterChange && options.buttons.follow && (this.client.EVE && this.client.EVE.systemID != EVE.systemID) && $(\".ui-dialog:visible\").length == 0) {\r\n            tripwire.systemChange(EVE.systemID);\r\n        }\r\n\r\n        if (!$(\"#search\").hasClass(\"active\")) {\r\n            $(\"#currentSpan\").show();\r\n        }\r\n\r\n        // Update current system\r\n        if (EVE.systemID) {\r\n            $(\"#EVEsystem\").html(tripwire.systems[EVE.systemID].name).attr(\"href\", \".?system=\"+ tripwire.systems[EVE.systemID].name);\r\n        }\r\n    } else {\r\n        // Update current system\r\n        $(\"#EVEsystem\").html(\"\");\r\n        $(\"#currentSpan\").hide();\r\n    }\r\n\r\n    this.client.EVE = {\r\n        characterID: EVE.characterID,\r\n        characterName: EVE.characterName,\r\n        systemID: EVE.systemID,\r\n        systemName: EVE.systemName,\r\n        shipTypeID: EVE.shipTypeID,\r\n        shipTypeName: EVE.shipTypeName,\r\n        stationID: EVE.stationID,\r\n        stationName: EVE.stationName,\r\n        locationDate: EVE.locationDate,\r\n        shipDate: EVE.shipDate,\r\n        systemChange: systemChange\r\n    };\r\n}\r\n","tripwire.parse = function(server, mode) {\r\n    var data = $.extend(true, {}, server);\r\n\r\n    if (options.chain.active == null || (options.chain.tabs[options.chain.active] && options.chain.tabs[options.chain.active].evescout != true)) {\r\n        if (options.masks.active != \"273.0\") {\r\n            for (var key in data.signatures) {\r\n                if (data.signatures[key].mask == \"273.0\") {\r\n                    delete data.signatures[key];\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    if (mode == 'refresh') {\r\n        this.client = server;\r\n        for (var key in data.signatures) {\r\n            if (data.signatures[key].systemID != viewingSystemID) {\r\n                continue;\r\n            }\r\n            var disabled = data.signatures[key].mask == \"273.0\" && options.masks.active != \"273.0\" ? true : false;\r\n\r\n            // Check for differences\r\n            if (!tripwire.signatures.list[key]) {\r\n                this.addSig(data.signatures[key], {animate: true}, disabled);\r\n            } else if (tripwire.signatures.list[key].modifiedTime !== data.signatures[key].modifiedTime) {\r\n                var edit = false;\r\n                for (column in data.signatures[key]) {\r\n                    if (data.signatures[key][column] != tripwire.signatures.list[key][column] && column != \"editing\") {\r\n                        edit = true;\r\n                    }\r\n                }\r\n\r\n                if (edit) {\r\n                    this.editSig(data.signatures[key], disabled);\r\n                } else {\r\n                    // this.sigEditing(data.signatures[key]);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Sigs needing removal\r\n        for (var key in tripwire.signatures.list) {\r\n            if (!data.signatures[key]) {\r\n                this.deleteSig(key);\r\n            }\r\n        }\r\n    } else if (mode == 'init' || mode == 'change') {\r\n        this.client = server;\r\n\r\n        for (var key in data.signatures) {\r\n            if (data.signatures[key].systemID != viewingSystemID) {\r\n                continue;\r\n            }\r\n            var disabled = data.signatures[key].mask == \"273.0\" && options.masks.active != \"273.0\" ? true : false;\r\n\r\n            this.addSig(data.signatures[key], {animate: false}, disabled);\r\n\r\n            if (data.signatures[key].editing) {\r\n                this.sigEditing(data.signatures[key]);\r\n            }\r\n        }\r\n    }\r\n\r\n    tripwire.signatures.list = data.signatures;\r\n\r\n    // set the sig count in the UI\r\n    var signatureCount = 0;\r\n    $.map(data.signatures, function(signature) {signature.systemID == viewingSystemID ? signatureCount++ : null;});\r\n    $(\"#signature-count\").html(signatureCount);\r\n}\r\n","// Handles pasting sigs from EVE\r\ntripwire.pasteSignatures = function() {\r\n    var processing = false;\r\n\r\n    var rowParse = function(row) {\r\n        var scanner = {};\r\n        var columns = row.split(\"\t\"); // Split by tab\r\n        var validScanGroups = [\"Cosmic Signature\", \"Cosmic Anomaly\", \"Kosmische Anomalie\", \"Kosmische Signatur\",\r\n                                \"Источники сигналов\", \"Космическая аномалия\"];\r\n        var validTypes = {\"Gas Site\": \"Gas\", \"Data Site\": \"Data\", \"Relic Site\": \"Relic\", \"Ore Site\": \"Ore\", \"Combat Site\": \"Combat\", \"Wormhole\": \"Wormhole\",\r\n                            \"Gasgebiet\": \"Gas\", \"Datengebiet\": \"Data\", \"Reliktgebiet\": \"Relic\", \"Mineraliengebiet\": \"Ore\", \"Kampfgebiet\": \"Combat\", \"Wurmloch\": \"Wormhole\",\r\n                            \"ГАЗ: район добычи газа\": \"Gas\", \"ДАННЫЕ: район сбора данных\": \"Data\", \"АРТЕФАКТЫ: район поиска артефактов\": \"Relic\", \"РУДА: район добычи руды\": \"Ore\", \"ОПАСНО: район повышенной опасности\": \"Combat\", \"Червоточина\": \"Wormhole\"};\r\n\r\n        for (var x in columns) {\r\n            if (columns[x].match(/([A-Z]{3}[-]\\d{3})/)) {\r\n                scanner.id = columns[x].split(\"-\");\r\n                continue;\r\n            }\r\n\r\n            if (columns[x].match(/(\\d([.|,]\\d)?[ ]?(%))/) || columns[x].match(/(\\d[.|,]?\\d+\\s(AU|AE|km|m|а.е.|км|м))/i)) { // Exclude scan % || AU\r\n                continue;\r\n            }\r\n\r\n            if ($.inArray(columns[x], validScanGroups) != -1) {\r\n                scanner.scanGroup = columns[x];\r\n                continue;\r\n            }\r\n\r\n            if (validTypes[columns[x]]) {\r\n                scanner.type = validTypes[columns[x]];\r\n                continue;\r\n            }\r\n\r\n            if (columns[x] != \"\") {\r\n                scanner.name = columns[x];\r\n            }\r\n        }\r\n\r\n        if (!scanner.id || scanner.id.length !== 2) {\r\n            return false;\r\n        }\r\n\r\n        return scanner;\r\n    }\r\n\r\n    this.pasteSignatures.parsePaste = function(paste) {\r\n        var paste = paste.split(\"\\n\");\r\n        var payload = {\"signatures\": {\"add\": [], \"update\": []}, \"systemID\": viewingSystemID};\r\n        var undo = [];\r\n        processing = true;\r\n\r\n        for (var i in paste) {\r\n            var scanner = rowParse(paste[i]);\r\n\r\n            if (scanner.id) {\r\n                var signature = $.map(tripwire.client.signatures, function(signature) { if (signature.signatureID == scanner.id[0] + scanner.id[1]) return signature; })[0];\r\n                if (signature) {\r\n                    // Update signature\r\n                    if (scanner.type == \"Wormhole\") {\r\n                        var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.parentID == signature.id || wormhole.childID == signature.id) return wormhole; })[0] || {};\r\n                        var otherSignature = wormhole.id ? (signature.id == wormhole.parentID ? tripwire.client.signatures[wormhole.childID] : tripwire.client.signatures[wormhole.parentID]) : {};\r\n                        payload.signatures.update.push({\r\n                            \"wormhole\": {\r\n                                \"id\": wormhole.id || null,\r\n                                \"type\": wormhole.type || null,\r\n                                \"life\": wormhole.life || \"stable\",\r\n                                \"mass\": wormhole.mass || \"stable\"\r\n                            },\r\n                            \"signatures\": [\r\n                                {\r\n                                    \"id\": signature.id,\r\n                                    \"signatureID\": signature.signatureID,\r\n                                    \"systemID\": viewingSystemID,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"name\": signature.name\r\n                                },\r\n                                {\r\n                                    \"id\": otherSignature.id || null,\r\n                                    \"signatureID\": otherSignature.signatureID || null,\r\n                                    \"systemID\": otherSignature.systemID || null,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"name\": otherSignature.name\r\n                                }\r\n                            ]\r\n                        });\r\n\r\n                        if (tripwire.client.wormholes[wormhole.id]) {\r\n          \t\t\t\t\t\t\t\t\tundo.push({\"wormhole\": tripwire.client.wormholes[wormhole.id], \"signatures\": [tripwire.client.signatures[signature.id], tripwire.client.signatures[otherSignature.id]]});\r\n          \t\t\t\t\t\t\t} else {\r\n          \t\t\t\t\t\t\t\t\t// used to be just a regular signature\r\n          \t\t\t\t\t\t\t\t\tundo.push(tripwire.client.signatures[signature.id]);\r\n          \t\t\t\t\t\t\t}\r\n                    } else {\r\n                        payload.signatures.update.push({\r\n                            \"id\": signature.id,\r\n                            \"systemID\": viewingSystemID,\r\n                            \"type\": scanner.type || 'unknown',\r\n                            \"name\": scanner.name,\r\n                            \"lifeLength\": options.signatures.pasteLife * 60 * 60\r\n                        });\r\n                        undo.push(tripwire.client.signatures[signature.id]);\r\n                    }\r\n                } else {\r\n                    // Add signature\r\n                    if (scanner.type == \"Wormhole\") {\r\n                        payload.signatures.add.push({\r\n                            \"wormhole\": {\r\n                                \"type\": null,\r\n                                \"life\": \"stable\",\r\n                                \"mass\": \"stable\"\r\n                            },\r\n                            \"signatures\": [\r\n                                {\r\n                                    \"signatureID\": scanner.id[0] + scanner.id[1],\r\n                                    \"systemID\": viewingSystemID,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"name\": null\r\n                                },\r\n                                {\r\n                                    \"signatureID\": null,\r\n                                    \"systemID\": null,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"name\": null\r\n                                }\r\n                            ]\r\n                        });\r\n                    } else {\r\n                        payload.signatures.add.push({\r\n                            signatureID: scanner.id[0] + scanner.id[1],\r\n                            systemID: viewingSystemID,\r\n                            type: scanner.type || 'unknown',\r\n                            name: scanner.name,\r\n                            lifeLength: options.signatures.pasteLife * 60 * 60\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (payload.signatures.add.length || payload.signatures.update.length) {\r\n            var success = function(data) {\r\n                if (data.resultSet && data.resultSet[0].result == true) {\r\n                    $(\"#undo\").removeClass(\"disabled\");\r\n\r\n                    if (data.results) {\r\n                        if (viewingSystemID in tripwire.signatures.undo) {\r\n                            tripwire.signatures.undo[viewingSystemID].push({action: \"add\", signatures: data.results});\r\n                        } else {\r\n                            tripwire.signatures.undo[viewingSystemID] = [{action: \"add\", signatures: data.results}];\r\n                        }\r\n                    }\r\n\r\n                    if (undo.length) {\r\n                        if (viewingSystemID in tripwire.signatures.undo) {\r\n                            tripwire.signatures.undo[viewingSystemID].push({action: \"update\", signatures: undo});\r\n          \t\t\t\t\t\t\t} else {\r\n                            tripwire.signatures.undo[viewingSystemID] = [{action: \"update\", signatures: undo}];\r\n          \t\t\t\t\t\t\t}\r\n                    }\r\n\r\n                    sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n                }\r\n            }\r\n\r\n            var always = function(data) {\r\n                processing = false;\r\n            }\r\n\r\n            tripwire.refresh('refresh', payload, success, always);\r\n        } else {\r\n            processing = false;\r\n        }\r\n    }\r\n\r\n    this.pasteSignatures.init = function() {\r\n        $(document).keydown(function(e)\t{\r\n            if ((e.metaKey || e.ctrlKey) && (e.keyCode == 86 || e.keyCode == 91) && !processing) {\r\n                //Abort - user is in input or textarea\r\n                if ($(document.activeElement).is(\"textarea, input\")) return;\r\n\r\n                $(\"#clipboard\").focus();\r\n            }\r\n        });\r\n\r\n        $(\"body\").on(\"click\", \"#fullPaste\", function(e) {\r\n            e.preventDefault();\r\n\r\n            var paste = $(this).data(\"paste\").split(\"\\n\");\r\n            var pasteIDs = [];\r\n            var removes = [];\r\n            var undo = [];\r\n\r\n            for (var i in paste) {\r\n                if (scan = rowParse(paste[i])) {\r\n                    pasteIDs.push(scan.id[0] + scan.id[1]);\r\n                }\r\n            }\r\n\r\n            for (var i in tripwire.client.signatures) {\r\n                var signature = tripwire.client.signatures[i];\r\n\r\n                if (signature.systemID == viewingSystemID && $.inArray(signature.signatureID, pasteIDs) === -1) {\r\n                    if (signature.type == \"wormhole\") {\r\n                        var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.parentID == signature.id || wormhole.childID == signature.id) return wormhole; })[0] || {};\r\n                        var otherSignature = wormhole.id ? (signature.id == wormhole.parentID ? tripwire.client.signatures[wormhole.childID] : tripwire.client.signatures[wormhole.parentID]) : {};\r\n                        if (wormhole.type !== \"GATE\") {\r\n                            removes.push(wormhole);\r\n                            undo.push({\"wormhole\": wormhole, \"signatures\": [signature, otherSignature]});\r\n                        }\r\n                    } else {\r\n                        removes.push(signature.id);\r\n                        undo.push(signature);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (removes.length > 0) {\r\n                var payload = {\"signatures\": {\"remove\": removes}};\r\n\r\n                var success = function(data) {\r\n                    if (data.resultSet && data.resultSet[0].result == true) {\r\n                        $(\"#undo\").removeClass(\"disabled\");\r\n                        if (viewingSystemID in tripwire.signatures.undo) {\r\n                            tripwire.signatures.undo[viewingSystemID].push({action: \"remove\", signatures: undo});\r\n                        } else {\r\n                            tripwire.signatures.undo[viewingSystemID] = [{action: \"remove\", signatures: undo}];\r\n                        }\r\n\r\n                        sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n                    }\r\n                }\r\n\r\n                tripwire.refresh('refresh', payload, success);\r\n            }\r\n        });\r\n\r\n        $(\"#clipboard\").on(\"paste\", function(e) {\r\n            e.preventDefault();\r\n            var paste = window.clipboardData ? window.clipboardData.getData(\"Text\") : (e.originalEvent || e).clipboardData.getData('text/plain');\r\n\r\n            $(\"#clipboard\").blur();\r\n            Notify.trigger(\"Paste detected<br/>(<a id='fullPaste' href=''>Click to delete missing sigs</a>)\");\r\n            $(\"#fullPaste\").data(\"paste\", paste);\r\n            tripwire.pasteSignatures.parsePaste(paste);\r\n        });\r\n    }\r\n\r\n    this.pasteSignatures.init();\r\n}\r\ntripwire.pasteSignatures();\r\n","tripwire.redo = function() {\r\n    if (tripwire.signatures.redo[viewingSystemID].length > 0) {\r\n        $(\"#redo\").addClass(\"disabled\");\r\n        var lastIndex = tripwire.signatures.redo[viewingSystemID].length -1;\r\n        var data = {\"systemID\": viewingSystemID, \"signatures\": {\"add\": [], \"remove\": [], \"update\": []}};\r\n\r\n        var redoItem = tripwire.signatures.redo[viewingSystemID][lastIndex];\r\n        var undo = $.map(redoItem.signatures, function(signature) {\r\n            if (signature.wormhole && tripwire.client.wormholes[signature.wormhole.id]) {\r\n                return {\"wormhole\": tripwire.client.wormholes[signature.wormhole.id], \"signatures\": [tripwire.client.signatures[signature.wormhole.id], tripwire.client.signatures[signature.wormhole.id]]};\r\n            } else if (tripwire.client.signatures[signature.id] && tripwire.client.signatures[signature.id].type == \"wormhole\") {\r\n                var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.parentID == signature.id || wormhole.childID == signature.id) return wormhole; })[0];\r\n                return {\"wormhole\": wormhole, \"signatures\": [tripwire.client.signatures[wormhole.parentID], tripwire.client.signatures[wormhole.childID]]};\r\n            } else if (signature.wormhole && tripwire.client.signatures[signature.signatures[0].id]) {\r\n                return tripwire.client.signatures[signature.signatures[0].id];\r\n            } else {\r\n                return tripwire.client.signatures[signature.id];\r\n            }\r\n        });\r\n\r\n        switch(redoItem.action) {\r\n            case \"add\":\r\n                data.signatures.add = data.signatures.add.concat(redoItem.signatures);\r\n                break;\r\n            case \"remove\":\r\n                data.signatures.remove = data.signatures.remove.concat($.map(redoItem.signatures, function(signature) { return signature.wormhole ? signature.wormhole : signature.id }));\r\n                break;\r\n            case \"update\":\r\n                data.signatures.update = data.signatures.update.concat(redoItem.signatures);\r\n                break;\r\n        }\r\n\r\n        var success = function(data) {\r\n            if (data.resultSet && data.resultSet[0].result == true) {\r\n                tripwire.signatures.redo[viewingSystemID].pop();\r\n\r\n                $(\"#undo\").removeClass(\"disabled\");\r\n                if (viewingSystemID in tripwire.signatures.undo) {\r\n                    if (redoItem.action == \"add\") {\r\n                        // we are adding new signatures we removed so we need the new ids\r\n                        tripwire.signatures.undo[viewingSystemID].push({\"action\": redoItem.action, \"signatures\": data.results});\r\n                    } else if (redoItem.action == \"update\") {\r\n                        tripwire.signatures.undo[viewingSystemID].push({\"action\": redoItem.action, \"signatures\": undo});\r\n                    } else {\r\n                        tripwire.signatures.undo[viewingSystemID].push({action: redoItem.action, signatures: redoItem.signatures});\r\n                    }\r\n                } else {\r\n                    if (redoItem.action == \"add\") {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{\"action\": redoItem.action, \"signatures\": data.results}];\r\n                    } else if (redoItem.action == \"update\") {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{\"action\": redoItem.action, \"signatures\": undo}];\r\n                    } else {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{action: redoItem.action, signatures: redoItem.signatures}];\r\n                    }\r\n                }\r\n\r\n                sessionStorage.setItem(\"tripwire_redo\", JSON.stringify(tripwire.signatures.redo));\r\n                sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n            }\r\n        }\r\n\r\n        var always = function(data) {\r\n            if (tripwire.signatures.redo[viewingSystemID].length > 0) {\r\n                $(\"#redo\").removeClass(\"disabled\");\r\n            }\r\n        }\r\n\r\n        tripwire.refresh('refresh', data, success, always);\r\n    }\r\n}\r\n","// Handles pulling TQ status & player count\r\ntripwire.serverStatus = function() {\r\n    this.data;\r\n    this.timer;\r\n\r\n    clearTimeout(tripwire.serverStatus.timer);\r\n\r\n    tripwire.esi.eveStatus()\r\n        .always(function(data) {\r\n            if (data && data.players && data.players > 0) {\r\n                if (!tripwire.serverStatus.data || tripwire.serverStatus.data.players !== data.players) {\r\n                    $('#serverStatus').html(\"<span class='\"+(data.players > 0 ? 'stable' : 'critical')+\"'>TQ</span>: \"+numFormat(data.players));\r\n\r\n                    if (tripwire.serverStatus.data) {\r\n                        $(\"#serverStatus\").effect('pulsate', {times: 5});\r\n                    }\r\n                }\r\n\r\n                tripwire.serverStatus.data = data;\r\n            } else {\r\n                $('#serverStatus').html(\"<span class='critical'>TQ</span>\");\r\n            }\r\n\r\n            tripwire.serverStatus.timer = setTimeout(\"tripwire.serverStatus();\", 15000);\r\n        });\r\n}\r\ntripwire.serverStatus();\r\n","tripwire.sync = function(mode, data, successCallback, alwaysCallback) {\r\n    var data = typeof(data) === \"object\" ? $.extend(true, {}, data) : {};\r\n\r\n    // Grab any pending changes\r\n    $.extend(true, data, tripwire.data);\r\n\r\n    // Remove old timer to prevent multiple\r\n    if (this.timer) clearTimeout(this.timer);\r\n    if (this.xhr) this.xhr.abort();\r\n\r\n    if (mode == 'refresh' || mode == 'change') {\r\n        data.signatureCount = Object.size(this.client.signatures);\r\n        data.signatureTime = Object.maxTime(this.client.signatures, \"modifiedTime\");\r\n\r\n        data.chainCount = Object.size(chain.data.rawMap);\r\n        data.chainTime = Object.maxTime(chain.data.rawMap, \"time\");\r\n\r\n        data.flareCount = chain.data.flares ? chain.data.flares.flares.length : 0;\r\n        data.flareTime = chain.data.flares ? chain.data.flares.last_modified : 0;\r\n\r\n        data.commentCount = Object.size(this.comments.data);\r\n        data.commentTime = Object.maxTime(this.comments.data, \"modified\");\r\n\r\n        data.activity = this.activity;\r\n    } else {\r\n        // Expand Tripwire with JSON data from EVE Data Dump and other static data\r\n        $.extend(this, appData);\r\n\r\n        this.aSystems = $.map(this.systems, function(system) { return system.name; });\r\n        this.aSigSystems = [\"Null-Sec\", \"Low-Sec\", \"High-Sec\", \"Class-1\", \"Class-2\", \"Class-3\", \"Class-4\", \"Class-5\", \"Class-6\"];\r\n        $.merge(this.aSigSystems, this.aSystems.slice());\r\n    }\r\n\r\n    data.mode = mode != \"init\" ? \"refresh\" : \"init\";\r\n    data.systemID = viewingSystemID;\r\n    data.systemName = viewingSystem;\r\n    data.instance = tripwire.instance;\r\n    data.version = tripwire.version;\r\n\r\n    this.xhr = $.ajax({\r\n        url: \"refresh.php\",\r\n        data: data,\r\n        type: \"POST\",\r\n        dataType: \"JSON\",\r\n        cache: false\r\n    }).done(function(data) {\r\n        if (data) {\r\n            tripwire.server = data;\r\n\r\n            if (data.esi) {\r\n                tripwire.esi.parse(data.esi);\r\n            }\r\n\r\n            if (data.sync) {\r\n                tripwire.serverTime.time = new Date(data.sync);\r\n            }\r\n\r\n            if (data.signatures)\r\n                tripwire.parse(data, mode);\r\n\r\n            if (data.chain)\r\n                tripwire.chainMap.parse(data.chain);\r\n\r\n            if (data.comments)\r\n                tripwire.comments.parse(data.comments)\r\n\r\n            tripwire.active(data.activity);\r\n\r\n            if (data.notify && !$(\"#serverNotification\")[0]) Notify.trigger(data.notify, \"yellow\", false, \"serverNotification\");\r\n        }\r\n\r\n        tripwire.data = {tracking: {}, esi: {}};\r\n        successCallback ? successCallback(data) : null;\r\n    }).always(function(data, status) {\r\n        tripwire.timer = setTimeout(\"tripwire.refresh();\", tripwire.refreshRate);\r\n\r\n        alwaysCallback ? alwaysCallback(data) : null;\r\n\r\n        if (data.status == 403) {\r\n            window.location.href = \".\";\r\n        } else if (status != \"success\" && status != \"abort\" && tripwire.connected == true) {\r\n            tripwire.connected = false;\r\n            $(\"#ConnectionSuccess\").click();\r\n            Notify.trigger(\"Error syncing with server\", \"red\", false, \"connectionError\");\r\n        } else if (status == \"success\" && tripwire.connected == false) {\r\n            tripwire.connected = true;\r\n            $(\"#connectionError\").click();\r\n            Notify.trigger(\"Successfully reconnected with server\", \"green\", 5000, \"connectionSuccess\");\r\n        }\r\n    });\r\n\r\n    return true;\r\n}\r\ntripwire.sync(\"init\");\r\n","// Change the currently viewed system\r\ntripwire.systemChange = function(systemID, mode) {\r\n    if (mode != \"init\") {\r\n        $(\"#infoSecurity\").removeClass();\r\n        $(\"#infoStatics\").empty();\r\n\r\n        viewingSystem = tripwire.systems[systemID].name;\r\n        viewingSystemID = systemID;\r\n\r\n        // Reset activity\r\n        activity.refresh(true);\r\n\r\n        // Reset signatures\r\n        $(\"#sigTable span[data-age]\").countdown(\"destroy\");\r\n        $(\"#sigTable tbody\").empty();\r\n        $(\"#signature-count\").html(0);\r\n        tripwire.signatures.list = {};\r\n        tripwire.client.signatures = [];\r\n\r\n        // Reset chain map\r\n        chain.redraw();\r\n\r\n        // Reset comments\r\n        $(\"#notesWidget .content .comment:visible\").remove();\r\n        tripwire.comments.data = null;\r\n\r\n        // Change the URL & history\r\n        history.replaceState(null, null, \"?system=\"+viewingSystem);\r\n\r\n        tripwire.refresh(\"change\");\r\n    }\r\n\r\n    // Change the title\r\n    document.title = tripwire.systems[systemID].name + \" - \" + app_name;\r\n\r\n    $(\"#infoSystem\").text(tripwire.systems[systemID].name);\r\n\r\n    // Current system favorite\r\n    $.inArray(parseInt(viewingSystemID), options.favorites) != -1 ? $(\"#system-favorite\").attr(\"data-icon\", \"star\").addClass(\"active\") : $(\"#system-favorite\").attr(\"data-icon\", \"star-empty\").removeClass(\"active\");\r\n\r\n    if (tripwire.systems[systemID].class) {\r\n        // Security\r\n        $(\"#infoSecurity\").html(\"<span class='wh pointer'>Class \" + tripwire.systems[systemID].class + \"</span>\");\r\n\r\n        // Effects\r\n        if (tripwire.systems[systemID].effect) {\r\n            var tooltip = \"<table cellpadding=\\\"0\\\" cellspacing=\\\"1\\\">\";\r\n            for (var x in tripwire.effects[tripwire.systems[systemID].effect]) {\r\n                var effect = tripwire.effects[tripwire.systems[systemID].effect][x].name;\r\n                var base = tripwire.effects[tripwire.systems[systemID].effect][x].base;\r\n                var bad = tripwire.effects[tripwire.systems[systemID].effect][x].bad;\r\n                var whClass = tripwire.systems[systemID].class > 6 ? 6 : tripwire.systems[systemID].class;\r\n                var modifier = 0;\r\n\r\n                switch (Math.abs(base)) {\r\n                    case 15:\r\n                        modifier = base > 0 ? 7 : -7;\r\n                        break;\r\n                    case 30:\r\n                        modifier = base > 0 ? 14 : -14;\r\n                        break;\r\n                    case 60:\r\n                        modifier = base > 0 ? 28 : -28;\r\n                        break;\r\n                }\r\n\r\n                tooltip += \"<tr><td>\" + effect + \"</td><td style=\\\"padding-left: 25px; text-align: right;\\\" class=\\\"\" + (bad ? \"critical\" : \"stable\") + \"\\\">\";\r\n                tooltip += base + (modifier * (whClass -1)) + \"%</td></tr>\";\r\n            }\r\n            tooltip += \"</table>\";\r\n            $(\"#infoSecurity\").append(\"&nbsp;<span class='pointer' data-tooltip='\" + tooltip + \"'>\" + tripwire.systems[systemID].effect + \"</span>\");\r\n            Tooltips.attach($(\"#infoSecurity [data-tooltip]\"));\r\n        }\r\n\r\n        // Statics\r\n        for (var x in tripwire.systems[systemID].statics) {\r\n            var type = tripwire.systems[systemID].statics[x];\r\n            var wormhole = tripwire.wormholes[type];\r\n            var color = \"wh\";\r\n\r\n            switch (wormhole.leadsTo) {\r\n                case \"High-Sec\":\r\n                    color = \"hisec\";\r\n                    break;\r\n                case \"Low-Sec\":\r\n                    color = \"lowsec\";\r\n                    break;\r\n                case \"Null-Sec\":\r\n                    color = \"nullsec\";\r\n                    break;\r\n            }\r\n\r\n            $(\"#infoStatics\").append(\"<div><span class='\"+ color +\"'>&#9679;</span> <b>\"+ wormhole.leadsTo +\"</b> via <span class='\"+ color +\"'>\"+ type +\"</span></div>\");\r\n        }\r\n\r\n        // Faction\r\n        $(\"#infoFaction\").html(\"&nbsp;\");\r\n    } else {\r\n        // Security\r\n        if (tripwire.systems[systemID].security >= 0.45) {\r\n            $(\"#infoSecurity\").addClass(\"hisec\").text(\"High-Sec \" + tripwire.systems[systemID].security);\r\n        } else if (tripwire.systems[systemID].security > 0.0) {\r\n            $(\"#infoSecurity\").addClass(\"lowsec\").text(\"Low-Sec \" + tripwire.systems[systemID].security);\r\n        } else {\r\n            $(\"#infoSecurity\").addClass(\"nullsec\").text(\"Null-Sec \" + tripwire.systems[systemID].security);\r\n        }\r\n\r\n        // Faction\r\n        $(\"#infoFaction\").html(tripwire.systems[systemID].factionID ? tripwire.factions[tripwire.systems[systemID].factionID].name : \"&nbsp;\");\r\n    }\r\n\r\n    // Region\r\n    $(\"#infoRegion\").text(tripwire.regions[tripwire.systems[systemID].regionID].name);\r\n\r\n    // Info Links\r\n    $(\"#infoWidget .infoLink\").each(function() {\r\n        this.href = $(this).data(\"href\").replace(/\\$systemName/gi, tripwire.systems[systemID].name).replace(/\\$systemID/gi, systemID);\r\n    });\r\n\r\n    // Reset undo/redo\r\n    tripwire.signatures.undo[systemID] && tripwire.signatures.undo[systemID].length > 0 ? $(\"#undo\").removeClass(\"disabled\") : $(\"#undo\").addClass(\"disabled\");\r\n    tripwire.signatures.redo[systemID] && tripwire.signatures.redo[systemID].length > 0 ? $(\"#redo\").removeClass(\"disabled\") : $(\"#redo\").addClass(\"disabled\");\r\n\r\n    // Reset delete signature icon\r\n    $(\"#sigTable tr.selected\").length == 0 ? $(\"#signaturesWidget #delete-signature\").addClass(\"disabled\") : $(\"#signaturesWidget #delete-signature\").removeClass(\"disabled\");\r\n}\r\ntripwire.systemChange(viewingSystemID, \"init\");\r\n","var tutorial;\r\n\r\n// infoWidget\r\n$(\"#infoWidget .tutorial\").click(function() {\r\n    tutorial = introJs().setOptions({\r\n        showStepNumbers: false,\r\n        steps: [\r\n            {\r\n                element: document.querySelector(\"#infoWidget\"),\r\n                intro: \"<h4>System information widget</h4><br/><p>Displays information on the currently <b>selected</b> Tripwire system (not the in-game system).</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#infoGeneral\"),\r\n                intro: \"<p>This section includes the system name, security rating, region, and owning faction.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#activityGraph\"),\r\n                intro: \"<p>This is the graph containing historical ship jump and kill information.</p>\"\r\n            },\r\n            {\r\n                element: $(\"#activityGraph svg > g > g:nth-child(5)\")[0],\r\n                intro: \"<p>Each value can be toggled by clicking these keys to drill down the graph into finer detail.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#activityGraphControls\"),\r\n                intro: \"<p>Select different lengths of historical data to show</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#infoStatics\"),\r\n                intro: \"<p>If a wormhole system is selected, the static wormholes will appear here.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#infoLinks\"),\r\n                intro: \"<p>These are some quick links to various sites for this specific system.</p>\"\r\n            }\r\n        ]\r\n    }).start();\r\n});\r\n\r\n// signaturesWidget\r\n$(\"#signaturesWidget .tutorial\").click(function() {\r\n    tutorial = introJs().setOptions({\r\n        showStepNumbers: false,\r\n        steps: [\r\n            {\r\n                element: document.querySelector(\"#signaturesWidget\"),\r\n                intro: \"<h4>System signatures widget</h4><br/><p>Displays all signatures and wormholes in the currently <b>selected</b> Tripwire system (not the in-game system).</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#add-signature2\"),\r\n                intro: \"<p>Add new signatures or wormholes manually by clicking the + icon.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#toggle-automapper\"),\r\n                intro: \"<p>Toggle the Auto-mapper feature on (orange) or off. (more details here)</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#signature-count\"),\r\n                intro: \"<p>Shows the current count of signatures.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#undo\"),\r\n                intro: \"<p>Click or use the keyboard shortcut CTRL-Z to undo the last changes made to these signatures (this includes clipboard pasted changes).</p><br/><p>You can undo multiple times as history is kept in the browser.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#redo\"),\r\n                intro: \"<p>Click or use the keyboard shortcut CTRL-Y to redo the last changes made to these signatures (this includes clipboard pasted changes).</p><br/><p>You can redo multiple times as history is kept in the browser.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#sigTable\"),\r\n                intro: \"<p>Each column can be sorted by clicking the column label, sort by multiple columns by holding the shift key.</p><br/><p>Right-click a column to change the text-alignment.</p>\"\r\n            }\r\n        ]\r\n    }).start();\r\n});\r\n\r\n// notesWidget\r\n$(\"#notesWidget .tutorial\").click(function(e) {\r\n    e.preventDefault();\r\n\r\n    tutorial = introJs().setOptions({\r\n        showStepNumbers: false,\r\n        exitOnEsc: false,\r\n        exitOnOverlayClick: false,\r\n        skipLabel: \"Abort\",\r\n        steps: [\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<h4>System notes widget</h4><br/><p>Displays comments based on the currently <b>selected</b> Tripwire system (not the in-game system).</p><br/><p>The rest of this tutorial will guide you through actually adding a comment, but don't worry we will switch you to your private Tripwire mask so we don't disturb anyone else.</p><br/><p>When you finish or leave this tutorial we will switch you back to your previous Tripwire mask.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#add-comment\"),\r\n                intro: \"<p>Now click the + icon to begin adding a new comment in this system (\" + viewingSystem + \").</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>Type some basic text now and click save.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>This is our newly created comment. Hover over the comment with your mouse to see additional information and controls.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>You can click the 'pin' or 'sticky' button to toggle showing this comment for every system, not just this system.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>Use the <b>Edit</b> to modify a comment and <b>Delete</b> to remove a comment.</p><br/><p>You can also quickly edit any comment by simply doubling clicking anywhere on it.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>Click on the <b>Edit</b> now on our comment.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>The toolbar at the top allows you to customize your notes.</p><br/><p>You can also click on the <b>Maximize/Minimize</b> button (the far right toolbar icon) to edit this comment in full screen mode.</p><br/><p>In full screen mode you will see 1 new button added to the toolbar to view the source code of the comment where you can write HTML, CSS, and even Javascript in your notes!</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>This concludes the tutorial, we will now switch you back to your previous Tripwire mask and delete the comment we created.</p>\"\r\n            }\r\n        ]\r\n    }).start();\r\n\r\n    tutorial.onchange(function(element) {\r\n        switch(tutorial._currentStep) {\r\n            case 1:\r\n                $(\".introjs-prevbutton, .introjs-nextbutton\").hide();\r\n\r\n                console.log(\"switch mask to private\");\r\n                tutorial.previousMask = options.masks.active;\r\n                options.masks.active = options.character.id + \".1\";\r\n                options.save();\r\n\r\n                tutorial.stepFunc = function() {\r\n                    setTimeout(function() {\r\n                        tutorial._options.steps[2].element = $(\"#notesWidget\").find(\".comment:has(.cke_toolbar)\")[0];\r\n                        tutorial.setOption(\"steps\", tutorial._options.steps);\r\n\r\n                        tutorial.exiting = false;\r\n                        tutorial.exit().start().goToStep(3);\r\n                        tutorial.exiting = true;\r\n                    }, 200);\r\n                }\r\n\r\n                $(\"#notesWidget #add-comment\").on(\"click\", tutorial.stepFunc);\r\n                break;\r\n            case 2:\r\n                $(\".introjs-prevbutton, .introjs-nextbutton\").hide();\r\n                $(\"#notesWidget #add-comment\").off(\"click\", tutorial.stepFunc);\r\n\r\n                tutorial.stepFunc = function() {\r\n                    tutorial.comment = $(this).closest(\".comment\");\r\n                    setTimeout(function() {\r\n                        tutorial._options.steps[3].element = tutorial.comment[0];\r\n                        tutorial._options.steps[4].element = tutorial.comment.find(\".commentSticky\")[0];\r\n                        tutorial._options.steps[5].element = tutorial.comment.find(\".commentControls\")[0];\r\n                        tutorial._options.steps[6].element = tutorial.comment.find(\".commentControls\")[0];\r\n                        tutorial.setOption(\"steps\", tutorial._options.steps);\r\n\r\n                        tutorial.exiting = false;\r\n                        tutorial.exit().start().goToStep(4);\r\n                        tutorial.exiting = true;\r\n                    }, 200);\r\n                }\r\n\r\n                $(\"#notesWidget\").on(\"click\", \".commentSave\", tutorial.stepFunc);\r\n                break;\r\n            case 6:\r\n                $(\".introjs-prevbutton, .introjs-nextbutton\").hide();\r\n                $(\"#notesWidget\").off(\"click\", \".commentSave\", tutorial.stepFunc);\r\n\r\n                tutorial.stepFunc = function() {\r\n                    setTimeout(function() {\r\n                        tutorial._options.steps[7].element = $(\"#notesWidget\").find(\".comment:has(.cke_toolbar)\")[0];\r\n                        tutorial._options.steps[8].element = $(\"#notesWidget\").find(\".comment:has(.cke_toolbar)\")[0];\r\n                        tutorial.setOption(\"steps\", tutorial._options.steps);\r\n\r\n                        tutorial.exiting = false;\r\n                        tutorial.exit().start().goToStep(8);\r\n                        tutorial.exiting = true;\r\n                    }, 200);\r\n                }\r\n\r\n                $(\"#notesWidget\").on(\"click\", \".commentEdit\", tutorial.stepFunc);\r\n                break;\r\n        }\r\n    });\r\n\r\n    tutorial.onexit(function() {\r\n        if (tutorial.exiting) {\r\n            $(\".commentCancel:visible\").click();\r\n            // delete the tutorial comment that was created\r\n            if (tutorial.comment) {\r\n                var data = {\"mode\": \"delete\", \"commentID\": tutorial.comment.data(\"id\")};\r\n\r\n                $.ajax({\r\n                    url: \"comments.php\",\r\n                    type: \"POST\",\r\n                    data: data,\r\n                    dataType: \"JSON\"\r\n                }).done(function(data) {\r\n                    if (data && data.result == true) {\r\n                        tutorial.comment.remove();\r\n                    }\r\n                });\r\n            }\r\n\r\n            if (tutorial.previousMask) {\r\n                setTimeout(function() {\r\n                    console.log(\"change mask back, delete comment\", tutorial.previousMask);\r\n                    options.masks.active = tutorial.previousMask;\r\n                    options.save();\r\n                }, 200);\r\n            }\r\n\r\n            // remove event listeners\r\n            $(\"#notesWidget #add-comment\").off(\"click\", tutorial.stepFunc);\r\n            $(\"#notesWidget\").off(\"click\", \".commentSave\", tutorial.stepFunc);\r\n            $(\"#notesWidget\").off(\"click\", \".commentEdit\", tutorial.stepFunc);\r\n            $(\"#notesWidget\").off(\"click\", \".cke_toolgroup:has(.cke_button__toolbarswitch)\", tutorial.stepFunc);\r\n        }\r\n    });\r\n\r\n    tutorial.previousMask;\r\n    tutorial.comment;\r\n    tutorial.stepFunc;\r\n    tutorial.exiting = true;\r\n});\r\n","tripwire.undo = function() {\r\n    if (tripwire.signatures.undo[viewingSystemID].length > 0) {\r\n        $(\"#undo\").addClass(\"disabled\");\r\n        var lastIndex = tripwire.signatures.undo[viewingSystemID].length -1;\r\n        var data = {\"systemID\": viewingSystemID, \"signatures\": {\"add\": [], \"remove\": [], \"update\": []}};\r\n\r\n        var undoItem = tripwire.signatures.undo[viewingSystemID][lastIndex];\r\n        var redo = $.map(undoItem.signatures, function(signature) {\r\n            if (signature.wormhole && tripwire.client.wormholes[signature.wormhole.id]) {\r\n                return {\"wormhole\": tripwire.client.wormholes[signature.wormhole.id], \"signatures\": [tripwire.client.signatures[signature.wormhole.id], tripwire.client.signatures[signature.wormhole.id]]};\r\n            } else if (tripwire.client.signatures[signature.id] && tripwire.client.signatures[signature.id].type == \"wormhole\") {\r\n                var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.parentID == signature.id || wormhole.childID == signature.id) return wormhole; })[0];\r\n                return {\"wormhole\": wormhole, \"signatures\": [tripwire.client.signatures[wormhole.parentID], tripwire.client.signatures[wormhole.childID]]};\r\n            } else if (signature.wormhole && tripwire.client.signatures[signature.signatures[0].id]) {\r\n                return tripwire.client.signatures[signature.signatures[0].id];\r\n            } else {\r\n                return tripwire.client.signatures[signature.id];\r\n            }\r\n        });\r\n\r\n        switch(undoItem.action) {\r\n            case \"add\":\r\n                data.signatures.remove = data.signatures.remove.concat($.map(undoItem.signatures, function(signature) { return signature.wormhole ? signature.wormhole : signature.id }));\r\n                break;\r\n            case \"remove\":\r\n                data.signatures.add = data.signatures.add.concat(undoItem.signatures);\r\n                break;\r\n            case \"update\":\r\n                data.signatures.update = data.signatures.update.concat(undoItem.signatures);\r\n                break;\r\n        }\r\n\r\n        var success = function(data) {\r\n            if (data.resultSet && data.resultSet[0].result == true) {\r\n                tripwire.signatures.undo[viewingSystemID].pop();\r\n\r\n                $(\"#redo\").removeClass(\"disabled\");\r\n                if (viewingSystemID in tripwire.signatures.redo) {\r\n                    if (undoItem.action == \"remove\") {\r\n                        // we are adding new signatures we removed so we need the new ids\r\n                        tripwire.signatures.redo[viewingSystemID].push({\"action\": undoItem.action, \"signatures\": data.results});\r\n                    } else if (undoItem.action == \"update\") {\r\n                        tripwire.signatures.redo[viewingSystemID].push({\"action\": undoItem.action, \"signatures\": redo});\r\n                    } else {\r\n                        tripwire.signatures.redo[viewingSystemID].push({\"action\": undoItem.action, \"signatures\": undoItem.signatures});\r\n                    }\r\n                } else {\r\n                    if (undoItem.action == \"remove\") {\r\n                        tripwire.signatures.redo[viewingSystemID] = [{\"action\": undoItem.action, \"signatures\": data.results}];\r\n                    } else if (undoItem.action == \"update\") {\r\n                        tripwire.signatures.redo[viewingSystemID] = [{\"action\": undoItem.action, \"signatures\": redo}];\r\n                    } else {\r\n                        tripwire.signatures.redo[viewingSystemID] = [{\"action\": undoItem.action, \"signatures\": undoItem.signatures}];\r\n                    }\r\n                }\r\n\r\n                sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n                sessionStorage.setItem(\"tripwire_redo\", JSON.stringify(tripwire.signatures.redo));\r\n            }\r\n        }\r\n\r\n        var always = function(data) {\r\n            if (tripwire.signatures.undo[viewingSystemID].length > 0) {\r\n                $(\"#undo\").removeClass(\"disabled\");\r\n            }\r\n        }\r\n\r\n        tripwire.refresh('refresh', data, success, always);\r\n    }\r\n}\r\n","var activity = new function() {\r\n\tthis.graph;\r\n\tthis.options;\r\n\tthis.view;\r\n\tthis.span = 24;\r\n\tthis.columns = [\r\n\t\t{id: \"time\", label: \"Time\", role: \"domain\", type: \"string\", calc: function(d, r) { return d.getValue(r, 0) + \"h\"; }},\r\n\t\t{id: \"jumps\", label: \"Jumps\", role: \"data\", type: \"number\", sourceColumn: 1, column: 1, title: \"Jumps\"},\r\n\t\t{id: \"podkills\", label: \"Pod Kills\", role: \"data\", type: \"number\", sourceColumn: 2, column: 2, title: \"Pod Kills\"},\r\n\t\t{id: \"shipkills\", label: \"Ship Kills\", role: \"data\", type: \"number\", sourceColumn: 3, column: 3, title: \"Ship Kills\"},\r\n\t\t{id: \"npckills\", label: \"NPC Kills\", role: \"data\", type: \"number\", sourceColumn: 4, column: 4, title: \"NPC Kills\"},\r\n\t\t//{id: \"annotationLabel\", label: \"Test\", role: \"annotation\", type: \"string\", sourceColumn: 5, title: \"Test\"},\r\n\t\t//{id: \"annotationText\", label: \"Test\", role: \"annotationText\", type: \"string\", sourceColumn: 6, title: \"Test\"}\r\n\t];\r\n\r\n\tthis.getData = function(span, cache) {\r\n\t\tvar span = typeof(span) !== \"undefined\" ? span : this.span;\r\n\t\tvar cache = typeof(cache) !== \"undefined\" ? cache : true;\r\n\r\n\t\t// Google hasn't finished loading yet\r\n\t\tif (!activity.graph) {\r\n\t\t\t\tsetTimeout(function() {activity.getData(span, cache)}, 500);\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn $.ajax({\r\n\t\t\turl: \"activity_graph.php\",\r\n\t\t\tdata: {systemID: viewingSystemID, time: span},\r\n\t\t\ttype: \"GET\",\r\n\t\t\tdataType: \"JSON\",\r\n\t\t\tcache: cache\r\n\t\t}).done(function(json) {\r\n\t\t\tif (json) {\r\n\t\t\t\tjson.rows.reverse();\r\n\t\t\t\tactivity.view = new google.visualization.DataView(new google.visualization.DataTable(json));\r\n\t\t\t\tactivity.view.setColumns(activity.columns);\r\n\t\t\t\tactivity.graph.draw(activity.view, activity.options);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tthis.selectHandler = function() {\r\n\t\tvar selections = activity.graph.getSelection();\r\n\r\n\t\tif (selections[0] && selections[0].row == null) {\r\n\t\t\tvar c = selections[0].column;\r\n\r\n\t\t\tif (activity.columns[c].sourceColumn) {\r\n\t\t\t\t//activity.columns[c].calc = function() { return null };\r\n\t\t\t\tactivity.columns[c].label = activity.columns[c].title + \" (off)\";\r\n\t\t\t\tdelete activity.columns[c].sourceColumn;\r\n\t\t\t} else {\r\n\t\t\t\tactivity.columns[c].sourceColumn = activity.columns[c].column;\r\n\t\t\t\tactivity.columns[c].label = activity.columns[c].title;\r\n\t\t\t\t//delete activity.columns[c].calc;\r\n\t\t\t}\r\n\r\n\t\t\tactivity.view.setColumns(activity.columns);\r\n\t\t\tactivity.options.animation.duration = 0;\r\n\t\t\tactivity.graph.draw(activity.view, activity.options);\r\n\t\t\tactivity.options.animation.duration = 500;\r\n\t\t}\r\n\t}\r\n\r\n\tthis.init = function() {\r\n\t\tactivity.graph = new google.visualization.AreaChart(document.getElementById(\"activityGraph\"));\r\n\t\tactivity.options = {\r\n\t\t\tisStacked: false,\r\n\t\t\tbackgroundColor: \"transparent\",\r\n\t\t\thAxis: {textStyle: {color: \"#999\", fontName: \"Verdana\", fontSize: 10}, showTextEvery: 3},\r\n\t\t\tvAxis: {textStyle: {color: \"#666\", fontName: \"Verdana\", fontSize: 10}, viewWindowMode: \"maximized\", viewWindow: {min: 0}, maxValue: 5},\r\n\t\t\tgridlineColor: \"#454545\",\r\n\t\t\tpointSize: 2,\r\n\t\t\tlineWidth: 1,\r\n\t\t\tchartArea: {left: \"10%\", top: \"5%\", width: \"88%\", height: \"85%\"},\r\n\t\t\tlegend: {position: \"in\", textStyle: {color: \"#CCC\", fontName: \"Verdana\", fontSize: 8.5}},\r\n\t\t\tanimation: {duration: 500, easing: \"inAndout\"},\r\n\t\t\ttooltip: {showColorCode: true},\r\n\t\t\tannotations: {style: \"line\", textStyle: {fontSize: 12, color: \"#ccc\"}, domain: 0},\r\n\t\t\tfocusTarget: \"category\"\r\n\t\t}\r\n\r\n\t\tgoogle.visualization.events.addListener(activity.graph, \"select\", activity.selectHandler);\r\n\r\n\t\tactivity.getData(activity.span);\r\n\t}\r\n\r\n\tthis.time = function(span) {\r\n\t\tswitch(span) {\r\n\t\t\tcase 24:\r\n\t\t\t\tthis.options.hAxis.showTextEvery = 3;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 48:\r\n\t\t\t\tthis.options.hAxis.showTextEvery = 6;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 168:\r\n\t\t\t\tthis.options.hAxis.showTextEvery = 24;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tthis.span = span;\r\n\t\tthis.getData(span);\r\n\t}\r\n\r\n\tthis.redraw = function() {\r\n\t\tthis.graph.draw(this.view, this.options);\r\n\t}\r\n\r\n\tthis.refresh = function(cache) {\r\n\t\tthis.getData(this.span, cache);\r\n\t}\r\n\r\n\tgoogle.charts.setOnLoadCallback(this.init);\r\n}\r\n","var chain = new function() {\r\n\tthis.map, this.view, this.options, this.drawing, this.data = {};\r\n\r\n\tthis.newView = function(json) {\r\n\t\tthis.view = new google.visualization.DataView(new google.visualization.DataTable(json));\r\n\t\treturn this.view;\r\n\t};\r\n\r\n\tthis.activity = function(data) {\r\n\t\t/*\tfunction for adding recent activity to chain map nodes\t*/\r\n\t\t//var data = typeof(data) !== \"undefined\" ? data : this.data.activity;\r\n\r\n\t\t// Hide all activity colored dots instead of checking each one\r\n\t\t$(\"#chainMap .nodeActivity > span:not(.invisible)\").addClass(\"invisible\");\r\n\r\n\t\t// Loop through passed data and show dots by system\r\n\t\t$(\"#chainMap [data-nodeid]\").each(function() {\r\n\t\t\tvar systemID = $(this).attr(\"data-nodeid\");\r\n\t\t\tif (data[systemID]) {\r\n\t\t\t\tvar shipJumps = data[systemID].shipJumps;\r\n\t\t\t\tvar podKills = data[systemID].podKills;\r\n\t\t\t\tvar shipKills = data[systemID].shipKills;\r\n\t\t\t\tvar npcKills = data[systemID].npcKills;\r\n\t\t\t\tvar $node = $(this).find(\".nodeActivity\");\r\n\r\n\t\t\t\tif (shipJumps > 0) {\r\n\t\t\t\t\t$node.find(\".jumps\").removeClass(\"invisible\").attr(\"title\", shipJumps+\" Jumps\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (podKills > 0) {\r\n\t\t\t\t\t$node.find(\".pods\").removeClass(\"invisible\").attr(\"title\", podKills+\" Pod Kills\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (shipKills > 0) {\r\n\t\t\t\t\t$node.find(\".ships\").removeClass(\"invisible\").attr(\"title\", shipKills+\" Ship Kills\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (npcKills > 0) {\r\n\t\t\t\t\t$node.find(\".npcs\").removeClass(\"invisible\").attr(\"title\", npcKills+\" NPC Kills\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$(\"#chainMap .nodeActivity > span[title]\").jBox(\"Tooltip\", {position: {y: \"bottom\"}});\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tthis.occupied = function(data) {\r\n\t\t/*\tfunction for showing occupied icon  */\r\n\r\n\t\t// Hide all icons instead of checking each one\r\n\t\t$(\"#chainMap [data-icon='user'], #chainMap [data-icon='user'] + .badge\").addClass(\"invisible\");\r\n\r\n\t\t// Loop through passed data and show icons\r\n\t\tfor (var x in data) {\r\n\t\t\t$(\"#chainMap [data-nodeid='\"+data[x].systemID+\"'] [data-icon='user']\").removeClass(\"invisible\")\r\n\t\t\t$(\"#chainMap [data-nodeid='\"+data[x].systemID+\"'] [data-icon='user'] + .badge\").removeClass(\"invisible\").html(data[x].count);\r\n\t\t}\r\n\r\n\t\tOccupiedToolTips.attach($(\"#chainMap [data-icon='user']:not(.invisible)\"));\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tthis.flares = function(data) {\r\n\t\t/*\tfunction for coloring chain map nodes via flares  */\r\n\t\t//var data = typeof(data) !== \"undefined\" ? data : this.data.flares;\r\n\r\n\t\t// Remove all current node coloring instead of checking each one\r\n\t\t$(\"#chainMap td.node\").removeClass(\"redNode yellowNode greenNode\");\r\n\r\n\t\t// Remove all coloring from chain grid\r\n\t\t$(\"#chainGrid tr\").removeClass(\"red yellow green\");\r\n\r\n\t\t// Loop through passed data and add classes by system\r\n\t\tif (data) {\r\n\t\t\tfor (var x in data.flares) {\r\n\t\t\t\tvar systemID = data.flares[x].systemID;\r\n\t\t\t\tvar flare = data.flares[x].flare;\r\n\r\n\t\t\t\tvar row = ($(\"#chainMap [data-nodeid=\"+systemID+\"]\").parent().addClass(flare+\"Node\").parent().index() - 1) / 3 * 2;\r\n\r\n\t\t\t\tif (row > 0) {\r\n\t\t\t\t\t$(\"#chainGrid tr:eq(\"+row+\")\").addClass(flare).next().addClass(flare);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tthis.grid = function() {\r\n\t\t/*  function for showing/hiding grid lines  */\r\n\t\tif (options.chain.gridlines == false) { $(\"#chainGrid tr\").addClass(\"hidden\"); return false; }\r\n\r\n\t\t$(\"#chainGrid tr\").removeClass(\"hidden\");\r\n\t\t//$(\"#chainGrid\").css(\"width\", \"100%\");\r\n\r\n\t\tvar rows = $(\".google-visualization-orgchart-table tr:has(.node)\").length * 2 - 1;\r\n\r\n\t\t$(\"#chainGrid tr:gt(\"+rows+\")\").addClass(\"hidden\");\r\n\t}\r\n\r\n\tthis.lines = function(data) {\r\n\t\t//var data = typeof(data) !== \"undefined\" ? data : this.data.lines;\r\n\r\n\t\tfunction drawNodeLine(system, parent, mode, signatureID) {\r\n\t\t\t/*\tfunction for drawing colored lines  */\r\n\r\n\t\t\t// Find node in chainmap\r\n\t\t\t//var $node = $(\"#chainMap [data-nodeid='\"+system+\"']\").parent();\r\n\t\t\tvar $node = $(\"#chainMap #node\"+system).parent();\r\n\r\n\t\t\tif ($node.length == 0) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\t// Get node # in this line\r\n\t\t\tvar nodeIndex = Math.ceil(($node[0].cellIndex + 1) / 2 - 1);\r\n\r\n\t\t\t// applly to my top line\r\n\t\t\tvar $connector = $($node.parent().prev().children(\"td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright\")[nodeIndex]).addClass(\"left-\"+mode+\" right-\"+mode);\r\n\t\t\t//var $connector = $($node.parent().prev().find(\"td:not([colspan])\")[nodeIndex]).addClass(\"left-\"+mode+\" right-\"+mode).attr(\"data-signatureid\", signatureID);\r\n\r\n\t\t\t// Find parent node\r\n\t\t\t//var $parent = $(\"#chainMap [data-nodeid='\"+parent+\"']\").parent();\r\n\t\t\tvar $parent = $(\"#chainMap #node\"+parent).parent();\r\n\r\n\t\t\tif ($parent.length == 0 || $connector.length == 0)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t// Find the col of my top line\r\n\t\t\tvar nodeCol = 0, connectorCell = $connector[0].cellIndex;\r\n\t\t\t$node.parent().prev().find(\"td\").each(function(index) {\r\n\t\t\t\tnodeCol += this.colSpan;\r\n\r\n\t\t\t\tif (index == connectorCell) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Get node # in this line\r\n\t\t\tvar parentIndex = Math.ceil(($parent[0].cellIndex + 1) / 2 - 1);\r\n\r\n\t\t\t// Compensate for non-parent nodes (slight performance hit ~10ms)\r\n\t\t\tvar newparentIndex = parentIndex;\r\n\t\t\tfor (var i = 0; i <= parentIndex; i++) {\r\n\t\t\t\tvar checkSystem = 0;//$node.parent().prev().prev().prev().find(\"td:has([data-nodeid]):eq(\"+i+\")\").find(\"[data-nodeid]\").data(\"nodeid\");\r\n\t\t\t\t$node.parent().prev().prev().prev().find(\"td > [data-nodeid]\").each(function(index) {\r\n\t\t\t\t\tif (index == i) {\r\n\t\t\t\t\t\tcheckSystem = $(this).attr(\"id\").replace(\"node\", \"\");//$(this).data(\"nodeid\");\r\n\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif ($.map(data.map.rows, function(node) { return node.c[1].v == checkSystem ? node : null; }).length <= 0) {\r\n\t\t\t\t\tnewparentIndex--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tparentIndex = newparentIndex;\r\n\r\n\t\t\t// Apply to parent bottom line\r\n\t\t\tvar $connecte = $($node.parent().prev().prev().children(\"td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright\")[parentIndex]).addClass(\"left-\"+mode+\" right-\"+mode);\r\n\t\t\t//var $connecte = $($node.parent().prev().prev().find(\"td:not([colspan])\")[parentIndex]).addClass(\"left-\"+mode+\" right-\"+mode).attr(\"data-signatureid\", signatureID);\r\n\r\n\t\t\t// the beans\r\n\t\t\tvar col = 0, parent = false, me = false;\r\n\t\t\t$node.parent().prev().prev().find(\"td\").each(function(index, value) {\r\n\t\t\t\tcol += this.colSpan;\r\n\r\n\t\t\t\tif (me && parent) {\r\n\t\t\t\t\t// All done - get outta here\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else if (typeof($connecte[0]) != \"undefined\" && $connecte[0].cellIndex == index) {\r\n\t\t\t\t\tparent = true;\r\n\r\n\t\t\t\t\t$(this).addClass(\"left-\"+mode);\r\n\r\n\t\t\t\t\t// remove bottom border that points to the right\r\n\t\t\t\t\tif (!me && col != nodeCol) {\r\n\t\t\t\t\t\t$(this).addClass(\"bottom-\"+mode);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// parent and node are same - we are done\r\n\t\t\t\t\tif (nodeCol == col) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (col == nodeCol) {\r\n\t\t\t\t\tme = true;\r\n\r\n\t\t\t\t\t$(this).addClass(\"bottom-\"+mode);\r\n\t\t\t\t} else if (me || parent) {\r\n\t\t\t\t\tvar tempCol = 0, breaker = false, skip = false;\r\n\r\n\t\t\t\t\t$node.parent().prev().find(\"td\").each(function(index) {\r\n\t\t\t\t\t\ttempCol += this.colSpan;\r\n\r\n\t\t\t\t\t\tif (tempCol == col && ($(this).hasClass(\"google-visualization-orgchart-lineleft\") || $(this).hasClass(\"google-visualization-orgchart-lineright\"))) {\r\n\t\t\t\t\t\t\tif (parent == false) {\r\n\t\t\t\t\t\t\t\t// Stop looking cuz there is another node between us and parent\r\n\t\t\t\t\t\t\t\tbreaker = true;\r\n\t\t\t\t\t\t\t\t$connecte.removeClass(\"left-\"+mode+\" right-\"+mode);\r\n\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t} else if (parent == true) {\r\n\t\t\t\t\t\t\t\t// Lets make sure there isnt a node between the parent and me\r\n\t\t\t\t\t\t\t\t$connecte.removeClass(\"left-\"+mode+\" right-\"+mode);\r\n\r\n\t\t\t\t\t\t\t\t$node.parent().prev().prev().find(\"td\").each(function(index) {\r\n\t\t\t\t\t\t\t\t\tif (index >= $connecte[0].cellIndex) {\r\n\t\t\t\t\t\t\t\t\t\t// there is a node after parent but before me\r\n\t\t\t\t\t\t\t\t\t\t$(this).removeClass(\"bottom-\"+mode);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tskip = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (breaker) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!skip) {\r\n\t\t\t\t\t\t$(this).addClass(\"bottom-\"+mode);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfor (var x in data.lines) {\r\n\t\t\tdrawNodeLine(data.lines[x][0], data.lines[x][1], data.lines[x][2], data.lines[x][3]);\r\n\t\t}\r\n\t}\r\n\r\n\tthis.nodes = function(map) {\r\n\t\tvar chain = {cols: [{label: \"System\", type: \"string\"}, {label: \"Parent\", type: \"string\"}], rows: []};\r\n\t\tvar frigTypes = [\"Q003\", \"E004\", \"L005\", \"Z006\", \"M001\", \"C008\", \"G008\", \"A009\"];\r\n\t\tvar connections = [];\r\n\r\n\t\tfunction topLevel(systemID, id) {\r\n\t\t\tif (!systemID || !tripwire.systems[systemID])\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t// System type switch\r\n\t\t\tvar systemType;\r\n\t\t\tif (tripwire.systems[systemID].class)\r\n\t\t\t\tsystemType = \"<span class='wh'>C\" + tripwire.systems[systemID].class + \"</span>\";\r\n\t\t\telse if (tripwire.systems[systemID].security >= 0.45)\r\n\t\t\t\tsystemType = \"<span class='hisec'>HS</span>\";\r\n\t\t\telse if (tripwire.systems[systemID].security > 0.0)\r\n\t\t\t\tsystemType = \"<span class='lowsec'>LS</span>\";\r\n\t\t\telse if (tripwire.systems[systemID].security <= 0.0)\r\n\t\t\t\tsystemType = \"<span class='nullsec'>NS</span>\";\r\n\r\n\t\t\tvar effectClass = null, effect = null;\r\n\t\t\tif (tripwire.systems[systemID].class) {\r\n\t\t\t\tswitch(tripwire.systems[systemID].effect) {\r\n\t\t\t\t\tcase \"Black Hole\":\r\n\t\t\t\t\t\teffectClass = \"blackhole\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Cataclysmic Variable\":\r\n\t\t\t\t\t\teffectClass = \"cataclysmic-variable\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Magnetar\":\r\n\t\t\t\t\t\teffectClass = \"magnetar\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Pulsar\":\r\n\t\t\t\t\t\teffectClass = \"pulsar\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Red Giant\":\r\n\t\t\t\t\t\teffectClass = \"red-giant\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Wolf-Rayet Star\":\r\n\t\t\t\t\t\teffectClass = \"wolf-rayet\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\teffect = tripwire.systems[systemID].effect;\r\n\t\t\t}\r\n\r\n\t\t\tvar system = {v: id};\r\n\t\t\tvar chainNode = \"<div id='node\"+id+\"' data-nodeid='\"+systemID+\"'>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='nodeIcons'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<div style='float: left;'>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<i class='whEffect' \"+(effectClass ? \"data-icon='\"+effectClass+\"' data-tooltip='\"+effect+\"'\" : null)+\"></i>\"\r\n\t\t\t\t\t\t\t+\t\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\t\"<div style='float: right;'>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<i data-icon='user' class='invisible'></i>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<span class='badge' class='invisible'></span>\"\r\n\t\t\t\t\t\t\t+\t\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeClass'>\"+systemType+\"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeSystem'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<a href='.?system=\"+tripwire.systems[systemID].name+\"'>\"+(options.chain.tabs[options.chain.active] && options.chain.tabs[options.chain.active].systemID != 0 ? options.chain.tabs[options.chain.active].name : tripwire.systems[systemID].name)+\"</a>\"\r\n\t\t\t\t\t\t\t+\t\"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeType'>&nbsp;</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='nodeActivity'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span>\"\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\"</div>\"\r\n\r\n\t\t\tsystem.f = chainNode;\r\n\r\n\t\t\treturn system;\r\n\t\t}\r\n\r\n\t\tfunction findLinks(system) {\r\n\t\t\tif (system[0] <= 0) return false;\r\n\r\n\t\t\tvar parentID = parseInt(system[1]), childID = chainList.length;\r\n\r\n\t\t\tfor (var x in chainData) {\r\n\t\t\t\tvar link = chainData[x];\r\n\r\n\t\t\t\tif ($.inArray(link.id, usedLinks) == -1) {\r\n\t\t\t\t\tif (link.systemID == system[0]) {\r\n\t\t\t\t\t\tvar node = {};\r\n\t\t\t\t\t\tnode.id = link.id;\r\n\t\t\t\t\t\tnode.life = link.life;\r\n\t\t\t\t\t\tnode.mass = link.mass;\r\n\t\t\t\t\t\tnode.time = link.time;\r\n\r\n\t\t\t\t\t\tnode.parent = {};\r\n\t\t\t\t\t\tnode.parent.id = parentID;\r\n\t\t\t\t\t\tnode.parent.systemID = link.systemID;\r\n\t\t\t\t\t\tnode.parent.name = link.system;\r\n\t\t\t\t\t\tnode.parent.type = link.sig2Type;\r\n\t\t\t\t\t\tnode.parent.typeBM = link.type2BM;\r\n\t\t\t\t\t\tnode.parent.classBM = link.class2BM;\r\n\t\t\t\t\t\tnode.parent.nth = link.nth2;\r\n\t\t\t\t\t\tnode.parent.signatureID = link.sig2ID;\r\n\r\n\t\t\t\t\t\tnode.child = {};\r\n\t\t\t\t\t\tnode.child.id = ++childID;\r\n\t\t\t\t\t\tnode.child.systemID = link.connectionID;\r\n\t\t\t\t\t\tnode.child.name = link.connection;\r\n\t\t\t\t\t\tnode.child.type = link.type;\r\n\t\t\t\t\t\tnode.child.typeBM = link.typeBM;\r\n\t\t\t\t\t\tnode.child.classBM = link.classBM;\r\n\t\t\t\t\t\tnode.child.nth = link.nth;\r\n\t\t\t\t\t\tnode.child.signatureID = link.signatureID;\r\n\r\n\t\t\t\t\t\tchainLinks.push(node);\r\n\t\t\t\t\t\tchainList.push([node.child.systemID, node.child.id, system[2]]);\r\n\t\t\t\t\t\tusedLinks.push(node.id);\r\n\t\t\t\t\t\t//usedLinks[system[2]].push(node.id);\r\n\r\n\t\t\t\t\t\tif ($(\"#show-viewing\").hasClass(\"active\") && tripwire.systems[node.child.systemID] && !tripwire.systems[viewingSystemID].class && !tripwire.systems[node.child.systemID].class) {\r\n\t\t\t\t\t\t\tvar jumps = guidance.findShortestPath(tripwire.map.shortest, [viewingSystemID - 30000000, node.child.systemID - 30000000]).length - 1;\r\n\r\n\t\t\t\t\t\t\tvar calcNode = {};\r\n\t\t\t\t\t\t\tcalcNode.life = \"Gate\";\r\n\t\t\t\t\t\t\tcalcNode.parent = {};\r\n\t\t\t\t\t\t\tcalcNode.parent.id = node.child.id;\r\n\t\t\t\t\t\t\tcalcNode.parent.systemID = node.child.systemID;\r\n\t\t\t\t\t\t\tcalcNode.parent.name = node.child.name;\r\n\t\t\t\t\t\t\tcalcNode.parent.type = node.child.type;\r\n\t\t\t\t\t\t\tcalcNode.parent.nth = node.child.nth;\r\n\r\n\t\t\t\t\t\t\tcalcNode.child = {};\r\n\t\t\t\t\t\t\tcalcNode.child.id = ++childID;\r\n\t\t\t\t\t\t\tcalcNode.child.systemID = viewingSystemID\r\n\t\t\t\t\t\t\tcalcNode.child.name = tripwire.systems[viewingSystemID].name;\r\n\t\t\t\t\t\t\tcalcNode.child.type = jumps;\r\n\t\t\t\t\t\t\tcalcNode.child.nth = null;\r\n\t\t\t\t\t\t\tcalcNode.child.signatureID = jumps;\r\n\r\n\t\t\t\t\t\t\tchainLinks.push(calcNode);\r\n\t\t\t\t\t\t\tchainList.push([0, childID]);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ($(\"#show-favorite\").hasClass(\"active\") && tripwire.systems[node.child.systemID]) {\r\n\t\t\t\t\t\t\tfor (x in options.favorites) {\r\n\t\t\t\t\t\t\t\tif (tripwire.systems[options.favorites[x]].regionID >= 11000000 || tripwire.systems[node.child.systemID].regionID >= 11000000)\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t\t\t\tvar jumps = guidance.findShortestPath(tripwire.map.shortest, [options.favorites[x] - 30000000, node.child.systemID - 30000000]).length - 1;\r\n\r\n\t\t\t\t\t\t\t\tvar calcNode = {};\r\n\t\t\t\t\t\t\t\tcalcNode.life = \"Gate\";\r\n\t\t\t\t\t\t\t\tcalcNode.parent = {};\r\n\t\t\t\t\t\t\t\tcalcNode.parent.id = node.child.id;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.systemID = node.child.systemID;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.name = node.child.name;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.type = node.child.type;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.nth = node.child.nth;\r\n\r\n\t\t\t\t\t\t\t\tcalcNode.child = {};\r\n\t\t\t\t\t\t\t\tcalcNode.child.id = ++childID;\r\n\t\t\t\t\t\t\t\tcalcNode.child.systemID = options.favorites[x];\r\n\t\t\t\t\t\t\t\tcalcNode.child.name = tripwire.systems[options.favorites[x]].name;\r\n\t\t\t\t\t\t\t\tcalcNode.child.type = jumps;\r\n\t\t\t\t\t\t\t\tcalcNode.child.nth = null;\r\n\t\t\t\t\t\t\t\tcalcNode.child.signatureID = jumps;\r\n\r\n\t\t\t\t\t\t\t\tchainLinks.push(calcNode);\r\n\t\t\t\t\t\t\t\tchainList.push([0, childID]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (link.connectionID == system[0]) {\r\n\t\t\t\t\t\tvar node = {};\r\n\t\t\t\t\t\tnode.id = link.id;\r\n\t\t\t\t\t\tnode.life = link.life;\r\n\t\t\t\t\t\tnode.mass = link.mass;\r\n\t\t\t\t\t\tnode.time = link.time;\r\n\r\n\t\t\t\t\t\tnode.parent = {};\r\n\t\t\t\t\t\tnode.parent.id = parentID;\r\n\t\t\t\t\t\tnode.parent.systemID = link.connectionID;\r\n\t\t\t\t\t\tnode.parent.name = link.connection;\r\n\t\t\t\t\t\tnode.parent.type = link.type;\r\n\t\t\t\t\t\tnode.parent.typeBM = link.typeBM;\r\n\t\t\t\t\t\tnode.parent.classBM = link.classBM;\r\n\t\t\t\t\t\tnode.parent.nth = link.nth;\r\n\t\t\t\t\t\tnode.parent.signatureID = link.signatureID;\r\n\r\n\t\t\t\t\t\tnode.child = {};\r\n\t\t\t\t\t\tnode.child.id = ++childID;\r\n\t\t\t\t\t\tnode.child.systemID = link.systemID;\r\n\t\t\t\t\t\tnode.child.name = link.system;\r\n\t\t\t\t\t\tnode.child.type = link.sig2Type;\r\n\t\t\t\t\t\tnode.child.typeBM = link.type2BM;\r\n\t\t\t\t\t\tnode.child.classBM = link.class2BM;\r\n\t\t\t\t\t\tnode.child.nth = link.nth2;\r\n\t\t\t\t\t\tnode.child.signatureID = link.sig2ID;\r\n\r\n\t\t\t\t\t\tchainLinks.push(node);\r\n\t\t\t\t\t\tchainList.push([node.child.systemID, node.child.id, system[2]]);\r\n\t\t\t\t\t\tusedLinks.push(node.id);\r\n\t\t\t\t\t\t//usedLinks[system[2]].push(node.id);\r\n\r\n\t\t\t\t\t\tif ($(\"#show-viewing\").hasClass(\"active\") && tripwire.systems[node.child.systemID] && !tripwire.systems[viewingSystemID].class && !tripwire.systems[node.child.systemID].class) {\r\n\t\t\t\t\t\t\tvar jumps = guidance.findShortestPath(tripwire.map.shortest, [viewingSystemID - 30000000, node.child.systemID - 30000000]).length - 1;\r\n\r\n\t\t\t\t\t\t\tvar calcNode = {};\r\n\t\t\t\t\t\t\tcalcNode.life = \"Gate\";\r\n\t\t\t\t\t\t\tcalcNode.parent = {};\r\n\t\t\t\t\t\t\tcalcNode.parent.id = node.child.id;\r\n\t\t\t\t\t\t\tcalcNode.parent.systemID = node.child.systemID;\r\n\t\t\t\t\t\t\tcalcNode.parent.name = node.child.name;\r\n\t\t\t\t\t\t\tcalcNode.parent.type = node.child.type;\r\n\t\t\t\t\t\t\tcalcNode.parent.nth = node.child.nth;\r\n\r\n\t\t\t\t\t\t\tcalcNode.child = {};\r\n\t\t\t\t\t\t\tcalcNode.child.id = ++childID;\r\n\t\t\t\t\t\t\tcalcNode.child.systemID = viewingSystemID;\r\n\t\t\t\t\t\t\tcalcNode.child.name = tripwire.systems[viewingSystemID].name;\r\n\t\t\t\t\t\t\tcalcNode.child.type = jumps;\r\n\t\t\t\t\t\t\tcalcNode.child.nth = null;\r\n\t\t\t\t\t\t\tcalcNode.child.signatureID = jumps;\r\n\r\n\t\t\t\t\t\t\tchainLinks.push(calcNode);\r\n\t\t\t\t\t\t\tchainList.push([0, childID]);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ($(\"#show-favorite\").hasClass(\"active\") && tripwire.systems[node.child.systemID]) {\r\n\t\t\t\t\t\t\tfor (x in options.favorites) {\r\n\t\t\t\t\t\t\t\tif (tripwire.systems[options.favorites[x]].regionID >= 11000000 || tripwire.systems[node.child.systemID].regionID >= 11000000)\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t\t\t\tvar jumps = guidance.findShortestPath(tripwire.map.shortest, [options.favorites[x] - 30000000, node.child.systemID - 30000000]).length - 1;\r\n\r\n\t\t\t\t\t\t\t\tvar calcNode = {};\r\n\t\t\t\t\t\t\t\tcalcNode.life = \"Gate\";\r\n\t\t\t\t\t\t\t\tcalcNode.parent = {};\r\n\t\t\t\t\t\t\t\tcalcNode.parent.id = node.child.id;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.systemID = node.child.systemID;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.name = node.child.name;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.type = node.child.type;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.nth = node.child.nth;\r\n\r\n\t\t\t\t\t\t\t\tcalcNode.child = {};\r\n\t\t\t\t\t\t\t\tcalcNode.child.id = ++childID;\r\n\t\t\t\t\t\t\t\tcalcNode.child.systemID = options.favorites[x];\r\n\t\t\t\t\t\t\t\tcalcNode.child.name = tripwire.systems[options.favorites[x]].name;\r\n\t\t\t\t\t\t\t\tcalcNode.child.type = jumps;\r\n\t\t\t\t\t\t\t\tcalcNode.child.nth = null;\r\n\t\t\t\t\t\t\t\tcalcNode.child.signatureID = jumps;\r\n\r\n\t\t\t\t\t\t\t\tchainLinks.push(calcNode);\r\n\t\t\t\t\t\t\t\tchainList.push([0, childID]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (false && $(\"#home\").hasClass(\"active\")) {\r\n\t\t\t$(\"#chainError\").hide();\r\n\r\n\t\t\tvar row = {c: []};\r\n\t\t\tvar systemID = $.map(tripwire.systems, function(system, id) { return system.name == options.chain.home ? id : null; })[0];\r\n\r\n\t\t\trow.c.push(topLevel(systemID, 1), {v: null});\r\n\r\n\t\t\tchain.rows.push(row);\r\n\r\n\t\t\tvar chainList = [[systemID, 1]];\r\n\t\t\tvar chainData = map;\r\n\t\t\tvar chainLinks = [];\r\n\t\t\tvar usedLinks = [];\r\n\r\n\t\t\tfor (var i = 0; i < chainList.length; ++i) {\r\n\t\t\t\tfindLinks(chainList[i]);\r\n\t\t\t}\r\n\t\t} else if (false && $(\"#k-space\").hasClass(\"active\")) {\r\n\t\t\t$(\"#chainError\").hide();\r\n\r\n\t\t\tvar chainList = [];//$.map(tripwire.systems, function(system, id) { return system.class ? null : [id, 1]; });\r\n\t\t\tvar kspace = $.map(tripwire.systems, function(system, id) { return system.class ? null : id; });\r\n\t\t\tvar chainData = map;\r\n\t\t\tvar chainLinks = [];\r\n\t\t\tvar usedLinks = [];\r\n\r\n\t\t\tvar i = 0;\r\n\t\t\tfor (var x in map) {\r\n\t\t\t\tif ($.inArray(map[x].systemID, kspace) != -1) {\r\n\t\t\t\t\ti++;\r\n\t\t\t\t\tchain.rows.push({c: [topLevel(map[x].systemID, i), {v: null}]});\r\n\t\t\t\t\tchainList.push([map[x].systemID, i]);\r\n\t\t\t\t} else if ($.inArray(map[x].connectionID, kspace) != -1) {\r\n\t\t\t\t\ti++;\r\n\t\t\t\t\tchain.rows.push({c: [topLevel(map[x].connectionID, i), {v: null}]});\r\n\t\t\t\t\tchainList.push([map[x].connectionID, i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0; i < chainList.length; ++i) {\r\n\t\t\t\tfindLinks(chainList[i]);\r\n\t\t\t}\r\n\t\t} else if (false && $(\"#eve-scout\").hasClass(\"active\")) {\r\n\t\t\t$(\"#chainError\").hide();\r\n\r\n\t\t\tvar row = {c: []};\r\n\t\t\tvar systemID = 31000005;\r\n\r\n\t\t\trow.c.push(topLevel(systemID, 1), {v: null});\r\n\r\n\t\t\tchain.rows.push(row);\r\n\r\n\t\t\tvar chainList = [[systemID, 1]];\r\n\t\t\tvar chainData = map;\r\n\t\t\tvar chainLinks = [];\r\n\t\t\tvar usedLinks = [];\r\n\r\n\t\t\tfor (var i = 0; i < chainList.length; ++i) {\r\n\t\t\t\tfindLinks(chainList[i]);\r\n\t\t\t}\r\n\t\t} else if ($(\"#chainTabs .current\").length > 0) {\r\n\t\t\tvar systems = $(\"#chainTabs .current .name\").data(\"tab\").toString().split(\",\");\r\n\t\t\tvar chainList = [];\r\n\t\t\tvar chainData = map;\r\n\t\t\tvar chainLinks = [];\r\n\t\t\tvar usedLinks = [];\r\n\r\n\t\t\tif (systems == 0) {\r\n\t\t\t\tvar i = 0;\r\n\t\t\t\tfor (var x in map) {\r\n\t\t\t\t\tif (typeof(tripwire.systems[map[x].systemID].class) == \"undefined\") {\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t//usedLinks[map[x].systemID] = [];\r\n\t\t\t\t\t\tchain.rows.push({c: [topLevel(map[x].systemID, i), {v: null}]});\r\n\t\t\t\t\t\tchainList.push([map[x].systemID, i, map[x].systemID]);\r\n\t\t\t\t\t} else if (tripwire.systems[map[x].connectionID] && typeof(tripwire.systems[map[x].connectionID].class) == \"undefined\") {\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t//usedLinks[map[x].connectionID] = [];\r\n\t\t\t\t\t\tchain.rows.push({c: [topLevel(map[x].connectionID, i), {v: null}]});\r\n\t\t\t\t\t\tchainList.push([map[x].connectionID, i, map[x].connectionID]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor (var x in systems) {\r\n\t\t\t\t\t//usedLinks[systems[x]] = [];\r\n\t\t\t\t\tchain.rows.push({c: [topLevel(systems[x], parseInt(x) + 1), {v: null}]});\r\n\t\t\t\t\tchainList.push([systems[x], parseInt(x) + 1, systems[x]]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//var startTime = window.performance.now();\r\n\t\t\tfor (var i = 0; i < chainList.length; i++) {\r\n\t\t\t\tfindLinks(chainList[i]);\r\n\t\t\t}\r\n\t\t\t//console.log(\"stint: \"+ (window.performance.now() - startTime));\r\n\t\t} else {\r\n\t\t\t$(\"#chainError\").hide();\r\n\r\n\t\t\tvar row = {c: []};\r\n\t\t\tvar systemID = viewingSystemID;\r\n\r\n\t\t\trow.c.push(topLevel(systemID, 1), {v: null});\r\n\r\n\t\t\tchain.rows.push(row);\r\n\r\n\t\t\tvar chainList = [[systemID, 1]];\r\n\t\t\tvar chainData = map;\r\n\t\t\tvar chainLinks = [];\r\n\t\t\tvar usedLinks = [];\r\n\r\n\t\t\tfor (var i = 0; i < chainList.length; ++i) {\r\n\t\t\t\tfindLinks(chainList[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var x in chainLinks) {\r\n\t\t\tvar node = chainLinks[x];\r\n\t\t\tvar row = {c: []};\r\n\r\n\t\t\t// System type switch\r\n\t\t\tvar systemType;\r\n\t\t\tvar nodeClass = tripwire.systems[node.child.systemID] ? tripwire.systems[node.child.systemID].class : null;\r\n\t\t\tvar nodeSecurity = tripwire.systems[node.child.systemID] ? tripwire.systems[node.child.systemID].security : null;\r\n\t\t\tif (nodeClass == 6 || node.child.name == \"Class-6\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Class 6\"))\r\n\t\t\t\tsystemType = \"<span class='wh'>C6</span>\";\r\n\t\t\telse if (nodeClass == 5 || node.child.name == \"Class-5\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Class 5\"))\r\n\t\t\t\tsystemType = \"<span class='wh'>C5</span>\";\r\n\t\t\telse if (nodeClass == 4 || node.child.name == \"Class-4\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Class 4\"))\r\n\t\t\t\tsystemType = \"<span class='wh'>C4</span>\";\r\n\t\t\telse if (nodeClass == 3 || node.child.name == \"Class-3\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Class 3\"))\r\n\t\t\t\tsystemType = \"<span class='wh'>C3</span>\";\r\n\t\t\telse if (nodeClass == 2 || node.child.name == \"Class-2\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Class 2\"))\r\n\t\t\t\tsystemType = \"<span class='wh'>C2</span>\";\r\n\t\t\telse if (nodeClass == 1 || node.child.name == \"Class-1\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Class 1\"))\r\n\t\t\t\tsystemType = \"<span class='wh'>C1</span>\";\r\n\t\t\telse if (nodeClass > 6)\r\n\t\t\t\tsystemType = \"<span class='wh'>C\" + nodeClass + \"</span>\";\r\n\t\t\telse if (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo.split(\" \").length > 1)\r\n\t\t\t\tsystemType = \"<span class='wh'>C\" + tripwire.wormholes[node.child.type].leadsTo.split(\" \")[1] + \"</span>\";\r\n\t\t\telse if (nodeSecurity >= 0.45 || node.child.name == \"High-Sec\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"High-Sec\" && !nodeSecurity))\r\n\t\t\t\tsystemType = \"<span class='hisec'>HS</span>\";\r\n\t\t\telse if (nodeSecurity > 0.0 || node.child.name == \"Low-Sec\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Low-Sec\" && !nodeSecurity))\r\n\t\t\t\tsystemType = \"<span class='lowsec'>LS</span>\";\r\n\t\t\telse if ((nodeSecurity <= 0.0 && nodeSecurity != null) || node.child.name == \"Null-Sec\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Null-Sec\"))\r\n\t\t\t\tsystemType = \"<span class='nullsec'>NS</span>\";\r\n\t\t\telse\r\n\t\t\t\tsystemType = \"<span>&nbsp;</span>\";\r\n\r\n\t\t\tvar effectClass = null, effect = null;\r\n\t\t\tif (typeof(tripwire.systems[node.child.systemID]) != \"undefined\") {\r\n\t\t\t\tswitch(tripwire.systems[node.child.systemID].effect) {\r\n\t\t\t\t\tcase \"Black Hole\":\r\n\t\t\t\t\t\teffectClass = \"blackhole\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Cataclysmic Variable\":\r\n\t\t\t\t\t\teffectClass = \"cataclysmic-variable\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Magnetar\":\r\n\t\t\t\t\t\teffectClass = \"magnetar\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Pulsar\":\r\n\t\t\t\t\t\teffectClass = \"pulsar\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Red Giant\":\r\n\t\t\t\t\t\teffectClass = \"red-giant\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Wolf-Rayet Star\":\r\n\t\t\t\t\t\teffectClass = \"wolf-rayet\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\teffectClass = null;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\teffect = tripwire.systems[node.child.systemID].effect;\r\n\t\t\t}\r\n\r\n\t\t\tvar child = {v: node.child.id};\r\n\t\t\tvar chainNode = \"<div id='node\"+node.child.id+\"' data-nodeid='\"+node.child.systemID+\"' data-sigid='\"+node.id+\"'>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='nodeIcons'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<div style='float: left;'>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<i class='whEffect' \"+(effectClass ? \"data-icon='\"+effectClass+\"' data-tooltip='\"+effect+\"'\" : null)+\"></i>\"\r\n\t\t\t\t\t\t\t+\t\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\t\"<div style='float: right;'>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<i data-icon='user' class='invisible'></i>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<span class='badge' class='invisible'></span>\"\r\n\t\t\t\t\t\t\t+\t\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeClass'>\"+(systemType + sigFormat(node.child.classBM, \"class\"))+\"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeSystem'>\"\r\n\t\t\t\t\t\t\t+ \t(tripwire.systems[node.child.systemID] ? \"<a href='.?system=\"+tripwire.systems[node.child.systemID].name+\"'>\"+(node.child.name ? node.child.name : tripwire.systems[node.child.systemID].name)+\"</a>\" : \"<a class='invisible'>system</a>\")\r\n\t\t\t\t\t\t\t+\t\"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeType'>\"+(options.chain[\"node-reference\"] == \"id\" ? node.child.signatureID : node.child.type + sigFormat(node.child.typeBM, \"type\") || \"&nbsp;\")+\"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='nodeActivity'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span>\"\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\"</div>\"\r\n\r\n\t\t\tchild.f = chainNode;\r\n\r\n\t\t\tvar parent = {v: node.parent.id};\r\n\r\n\t\t\trow.c.push(child, parent);\r\n\t\t\tchain.rows.push(row);\r\n\r\n\t\t\tif (node.life == \"Critical\" && ($.inArray(node.parent.type, frigTypes) != -1 || $.inArray(node.child.type, frigTypes) != -1))\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"eol-frig\", node.id));\r\n\t\t\telse if (node.life == \"Critical\" && node.mass == \"Critical\")\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"eol-critical\", node.id));\r\n\t\t\telse if (node.life == \"Critical\" && node.mass == \"Destab\")\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"eol-destab\", node.id));\r\n\t\t\telse if ($.inArray(node.parent.type, frigTypes) != -1 || $.inArray(node.child.type, frigTypes) != -1)\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"frig\", node.id));\r\n\t\t\telse if (node.life == \"Critical\")\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"eol\", node.id));\r\n\t\t\telse if (node.mass == \"Critical\")\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"critical\", node.id));\r\n\t\t\telse if (node.mass == \"Destab\")\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"destab\", node.id));\r\n\t\t\telse if (node.life == \"Gate\" || node.parent.type == \"GATE\" || node.child.type == \"GATE\")\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"gate\", node.id));\r\n\t\t\t//else\r\n\t\t\t//\tconnections.push(Array(child.v, parent.v, \"\", node.id));\r\n\t\t}\r\n\r\n\t\t// Apply critical/destab line colors\r\n\t\tconnections.reverse(); // so we apply to outer systems first\r\n\r\n\t\t//this.data.map = chain;\r\n\t\t//this.data.lines = connections;\r\n\t\treturn {\"map\": chain, \"lines\": connections};\r\n\t}\r\n\r\n\tthis.redraw = function() {\r\n\t\tvar data = $.extend(true, {}, this.data);\r\n\t\tdata.map = $.extend(true, {}, data.rawMap);\r\n\r\n\t\tthis.draw(data);\r\n\t}\r\n\r\n\tthis.draw = function(data) {\r\n\t\tvar data = typeof(data) !== \"undefined\" ? data : {};\r\n\t\t//var startTime = window.performance.now();\r\n\r\n\t\tif (!this.map) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (data.map) {\r\n\t\t\tthis.drawing = true;\r\n\r\n\t\t\tthis.data.rawMap = $.extend(true, {}, data.map);\r\n\r\n\t\t\tif (options.chain.active == null || (options.chain.tabs[options.chain.active] && options.chain.tabs[options.chain.active].evescout == false)) {\r\n\t\t\t\tif (options.masks.active != \"273.0\") {\r\n\t\t\t\t\tfor (var i in data.map) {\r\n\t\t\t\t\t\tif (data.map[i].mask == \"273.0\") {\r\n\t\t\t\t\t\t\tdelete data.map[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Sort so we keep the chain map order the same\r\n\t\t\tObject.sort(data.map, \"id\");\r\n\r\n\t\t\t$.extend(data, this.nodes(data.map)); // 250ms -> <100ms\r\n\t\t\t$.extend(this.data, data);\r\n\t\t\tthis.map.draw(this.newView(data.map), this.options); // 150ms\r\n\r\n\t\t\tif (options.chain.tabs[options.chain.active]) {\r\n\t\t\t\tfor (var x in options.chain.tabs[options.chain.active].collapsed) {\r\n\t\t\t\t\tvar node = $(\"#chainMap [data-nodeid='\"+options.chain.tabs[options.chain.active].collapsed[x]+\"']\").attr(\"id\");\r\n\r\n\t\t\t\t\tif (node) {\r\n\t\t\t\t\t\tnode = node.split(\"node\")[1];\r\n\t\t\t\t\t\tthis.map.collapse(node - 1, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.lines(data); // 300ms\r\n\t\t\tthis.grid(); // 4ms\r\n\r\n\t\t\t// Apply current system style\r\n\t\t\t$(\"#chainMap [data-nodeid='\"+viewingSystemID+\"']\").parent().addClass(\"currentNode\"); // 1ms\r\n\r\n\t\t\tWormholeTypeToolTips.attach($(\"#chainMap .whEffect\")); // 30ms\r\n\t\t\tthis.drawing = false;\r\n\t\t}\r\n\r\n\t\t// Gather latest system activity\r\n\t\tif (!this.data.activity || new Date() > this.data.activity.expires) {\r\n\t\t\tdata.activity = {};\r\n\t\t\ttripwire.esi.universeJumps()\r\n\t\t\t\t.done(function(results, status, request) {\r\n\t\t\t\t\tdata.activity.expires = new Date(request.getResponseHeader(\"expires\"));\r\n\t\t\t\t\t$.each(results, function(x) {\r\n\t\t\t\t\t\tdata.activity[results[x].system_id] = {\r\n\t\t\t\t\t\t\tsystemID: results[x].system_id,\r\n\t\t\t\t\t\t\tshipJumps: results[x].ship_jumps\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.then(function() {\r\n\t\t\t\t\t return tripwire.esi.universeKills()\r\n\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t$.each(results, function(x) {\r\n\t\t\t\t\t\t\t\tif (data.activity[results[x].system_id]) {\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id].podKills = results[x].pod_kills;\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id].shipKills = results[x].ship_kills;\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id].npcKills = results[x].npc_kills;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id] = {\r\n\t\t\t\t\t\t\t\t\t\tsystemID: results[x].system_id,\r\n\t\t\t\t\t\t\t\t\t\tpodKills: results[x].pod_kills,\r\n\t\t\t\t\t\t\t\t\t\tshipKills: results[x].ship_kills,\r\n\t\t\t\t\t\t\t\t\t\tnpcKills: results[x].npc_kills,\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.then(function() {\r\n\t\t\t\t\tchain.data.activity = chain.activity(data.activity);\r\n\t\t\t\t});\r\n\t\t} else {\r\n\t\t\tchain.activity(this.data.activity);\r\n\t\t}\r\n\r\n\t\t// if (data.activity) // 100ms\r\n\t\t// \tthis.data.activity = this.activity(data.activity);\r\n\r\n\t\tif (data.occupied) // 3ms\r\n\t\t\tthis.data.occupied = this.occupied(data.occupied);\r\n\r\n\t\tif (data.flares) // 20ms\r\n\t\t\tthis.data.flares = this.flares(data.flares);\r\n\r\n\t\tif (data.last_modified)\r\n\t\t\tthis.data.last_modified = data.last_modified;\r\n\r\n\t\t//console.log(\"stint: \"+ (window.performance.now() - startTime));\r\n\t}\r\n\r\n\tthis.collapse = function(c) {\r\n\t\tif (chain.drawing) return false;\r\n\r\n\t\tvar collapsed = chain.map.getCollapsedNodes();\r\n\t\toptions.chain.tabs[options.chain.active].collapsed = [];\r\n\t\tfor (x in collapsed) {\r\n\t\t\tvar systemID = $(\"#chainMap #node\"+(collapsed[x] +1)).data(\"nodeid\");\r\n\t\t\toptions.chain.tabs[options.chain.active].collapsed.push(systemID);\r\n\t\t}\r\n\r\n\t\tchain.lines(chain.data);\r\n\r\n\t\t// Apply current system style\r\n\t\t$(\"#chainMap [data-nodeid='\"+viewingSystemID+\"']\").parent().addClass(\"currentNode\");\r\n\r\n\t\tWormholeTypeToolTips.attach($(\"#chainMap .whEffect\"));\r\n\r\n\t\tchain.activity(chain.data.activity);\r\n\r\n\t\tchain.occupied(chain.data.occupied);\r\n\r\n\t\tchain.flares(chain.data.flares);\r\n\r\n\t\tchain.grid();\r\n\r\n\t\toptions.save();\r\n\t}\r\n\r\n\tthis.init = function() {\r\n\t\tchain.map = new google.visualization.OrgChart(document.getElementById(\"chainMap\"));\r\n\t\tchain.options = {allowHtml: true, allowCollapse: true, size: \"medium\", nodeClass: \"node\"};\r\n\r\n\t\tgoogle.visualization.events.addListener(chain.map, \"collapse\", chain.collapse);\r\n\r\n\t\tchain.map.draw(new google.visualization.DataView(new google.visualization.DataTable({cols:[{label: \"System\", type: \"string\"}, {label: \"Parent\", type: \"string\"}]})), this.options);\r\n\r\n\t\tchain.redraw();\r\n\t}\r\n\r\n\tgoogle.charts.setOnLoadCallback(this.init);\r\n}\r\n","var CKConfig = {\r\n\tskin: \"custom\",\r\n\theight: 100,\r\n\tallowedContent: true,\r\n\textraPlugins: \"toolbarswitch,autogrow,autolink\",\r\n\tenterMode: CKEDITOR.ENTER_BR,\r\n\tremoveDialogTabs: 'link:advanced',\r\n\tautoGrow_onStartup: true,\r\n\tautoGrow_minHeight: 100,\r\n\ttoolbar_minToolbar: [\r\n\t\t{name: \"basicstyles\", items: [\"Bold\", \"Italic\", \"Underline\", \"Strike\"]},\r\n\t\t{name: \"paragraph\", items: [\"BulletedList\", \"Outdent\", \"Indent\"]},\r\n\t\t{name: \"links\", items: [\"Link\"]},\r\n\t\t{name: \"colors\", items: [\"TextColor\", \"BGColor\"]},\r\n\t\t{name: \"styles\", items: [\"FontSize\"]},\r\n\t\t{name: \"tools\", items: [\"Toolbarswitch\"]}\r\n\t],\r\n\ttoolbar_maxToolbar: [\r\n\t\t{name: \"basicstyles\", items: [\"Bold\", \"Italic\", \"Underline\", \"Strike\", \"Subscript\", \"Superscript\"]},\r\n\t\t{name: \"paragraph\", items: [\"NumberedList\", \"BulletedList\", \"Outdent\", \"Indent\"]},\r\n\t\t{name: \"links\", items: [\"Link\"]},\r\n\t\t{name: \"colors\", items: [\"TextColor\", \"BGColor\"]},\r\n\t\t{name: \"styles\", items: [\"FontSize\", \"Font\"]},\r\n\t\t{name: \"tools\", items: [\"Source\", \"Toolbarswitch\"]}\r\n\t],\r\n\ttoolbar: \"minToolbar\",\r\n\tsmallToolbar: \"minToolbar\",\r\n\tmaximizedToolbar: \"maxToolbar\",\r\n\tfontSize_style: {\r\n\t    element:        'span',\r\n\t    styles:         { 'font-size': '#(size)' },\r\n\t    overrides:      [ { element :'font', attributes: { 'size': null } } ]\r\n\t}\r\n}\r\n\r\nCKEDITOR.on(\"instanceLoaded\", function(cke) {\r\n\tcke.editor.on(\"contentDom\", function() {\r\n\t\tcke.editor.on(\"key\", function(e) {\r\n\t\t\tif (e.data.keyCode == 27) {\r\n\t\t\t\t// escape key cancels\r\n\t\t\t\t$(cke.editor.element.$).closest(\".comment\").find(\".commentCancel\").click();\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (e.data.domEvent.$.altKey && e.data.domEvent.$.keyCode == 83) {\r\n\t\t\t\t// alt+s saves\r\n\t\t\t\t$(cke.editor.element.$).closest(\".comment\").find(\".commentSave\").click();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\t$(\".cke_combo__font a\")\r\n\t\t.removeClass(\"cke_combo_button\")\r\n\t\t.addClass(\"cke_button cke_button_off\")\r\n\t\t.html('<span class=\"cke_button_icon\">&nbsp;</span>')\r\n\r\n\t$(\".cke_combo__fontsize a\")\r\n\t\t.removeClass(\"cke_combo_button\")\r\n\t\t.addClass(\"cke_button cke_button_off\")\r\n\t\t.html('<span class=\"cke_button_icon\">&nbsp;</span>')\r\n});\r\n\r\nCKEDITOR.on(\"instanceReady\", function(cke) {\r\n\t// ensure focus on init\r\n\tcke.editor.focus();\r\n\r\n\tvar s = cke.editor.getSelection(); // getting selection\r\n\tvar selected_ranges = s.getRanges(); // getting ranges\r\n\tvar node = selected_ranges[0].startContainer; // selecting the starting node\r\n\tvar parents = node.getParents(true);\r\n\r\n\tnode = parents[parents.length - 2].getFirst();\r\n\r\n\tif (!node) return false;\r\n\r\n\twhile (true) {\r\n\t\tvar x = node.getNext();\r\n\t\tif (x == null) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tnode = x;\r\n\t}\r\n\r\n\ts.selectElement(node);\r\n\tselected_ranges = s.getRanges();\r\n\tselected_ranges[0].collapse(false);  //  false collapses the range to the end of the selected node, true before the node.\r\n\ts.selectRanges(selected_ranges);  // putting the current selection there\r\n});\r\n\r\nCKEDITOR.on(\"dialogDefinition\", function(ev) {\r\n\tif (ev.data.name == 'link') {\r\n\t\tev.data.definition.getContents('target').get('linkTargetType')['default'] = '_blank';\r\n\t}\r\n});\r\n","var guidance = (function (undefined) {\r\n\r\n\tvar extractKeys = function (obj) {\r\n\t\tvar keys = [];\r\n\r\n\t\tfor (var key in obj) {\r\n\t\t    Object.prototype.hasOwnProperty.call(obj,key) && keys.push(key);\r\n\t\t}\r\n\r\n\t\treturn keys;\r\n\t}\r\n\r\n\tvar sorter = function (a, b) {\r\n\t\treturn parseFloat (a) - parseFloat (b);\r\n\t}\r\n\r\n\tvar findPaths = function (map, start, end, infinity) {\r\n\t\tinfinity = infinity || Infinity;\r\n\r\n\t\tvar costs = {},\r\n\t\t    open = {'0': [start]},\r\n\t\t    predecessors = {},\r\n\t\t    keys;\r\n\r\n\t\tvar addToOpen = function (cost, vertex) {\r\n\t\t\tvar key = \"\" + cost;\r\n\t\t\tif (!open[key]) open[key] = [];\r\n\t\t\topen[key].push(vertex);\r\n\t\t}\r\n\r\n\t\tcosts[start] = 0;\r\n\r\n\t\twhile (open) {\r\n\t\t\tif(!(keys = extractKeys(open)).length) break;\r\n\r\n\t\t\tkeys.sort(sorter);\r\n\r\n\t\t\tvar key = keys[0],\r\n\t\t\t    bucket = open[key],\r\n\t\t\t    node = bucket.shift(),\r\n\t\t\t    currentCost = parseFloat(key),\r\n\t\t\t    adjacentNodes = map[node] || {};\r\n\r\n\t\t\tif (!bucket.length) delete open[key];\r\n\r\n\t\t\tfor (var vertex in adjacentNodes) {\r\n\t\t\t    if (Object.prototype.hasOwnProperty.call(adjacentNodes, vertex)) {\r\n\t\t\t\t\tvar cost = adjacentNodes[vertex],\r\n\t\t\t\t\t    totalCost = cost + currentCost,\r\n\t\t\t\t\t    vertexCost = costs[vertex];\r\n\r\n\t\t\t\t\tif ((vertexCost === undefined) || (vertexCost > totalCost)) {\r\n\t\t\t\t\t\tcosts[vertex] = totalCost;\r\n\t\t\t\t\t\taddToOpen(totalCost, vertex);\r\n\t\t\t\t\t\tpredecessors[vertex] = node;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (costs[end] === undefined) {\r\n\t\t\treturn null;\r\n\t\t} else {\r\n\t\t\treturn predecessors;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tvar extractShortest = function (predecessors, end) {\r\n\t\tvar nodes = [],\r\n\t\t    u = end;\r\n\r\n\t\twhile (u) {\r\n\t\t\tnodes.push(u);\r\n\t\t\tpredecessor = predecessors[u];\r\n\t\t\tu = predecessors[u];\r\n\t\t}\r\n\r\n\t\tnodes.reverse();\r\n\t\treturn nodes;\r\n\t}\r\n\r\n\tvar findShortestPath = function (map, nodes) {\r\n\t\tvar start = nodes.shift(),\r\n\t\t    end,\r\n\t\t    predecessors,\r\n\t\t    path = [],\r\n\t\t    shortest;\r\n\r\n\t\twhile (nodes.length) {\r\n\t\t\tend = nodes.shift();\r\n\t\t\tpredecessors = findPaths(map, start, end);\r\n\r\n\t\t\tif (predecessors) {\r\n\t\t\t\tshortest = extractShortest(predecessors, end);\r\n\t\t\t\tif (nodes.length) {\r\n\t\t\t\t\tpath.push.apply(path, shortest.slice(0, -1));\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn path.concat(shortest);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tstart = end;\r\n\t\t}\r\n\t}\r\n\r\n\tvar toArray = function (list, offset) {\r\n\t\ttry {\r\n\t\t\treturn Array.prototype.slice.call(list, offset);\r\n\t\t} catch (e) {\r\n\t\t\tvar a = [];\r\n\t\t\tfor (var i = offset || 0, l = list.length; i < l; ++i) {\r\n\t\t\t\ta.push(list[i]);\r\n\t\t\t}\r\n\t\t\treturn a;\r\n\t\t}\r\n\t}\r\n\r\n\tvar Guidance = function (map) {\r\n\t\tthis.map = map;\r\n\t}\r\n\r\n\tGuidance.prototype.findShortestPath = function (start, end) {\r\n\t\tvar result;\r\n\r\n\t\tif (Object.prototype.toString.call(start) === '[object Array]') {\r\n\t\t\tresult = findShortestPath(this.map, start);\r\n\t\t} else if (arguments.length === 2) {\r\n\t\t\tresult = findShortestPath(this.map, [start, end]);\r\n\t\t} else {\r\n\t\t\tresult = findShortestPath(this.map, toArray(arguments));\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tGuidance.findShortestPath = function (map, start, end) {\r\n\t\tif (Object.prototype.toString.call(start) === '[object Array]') {\r\n\t\t\treturn findShortestPath(map, start);\r\n\t\t} else if (arguments.length === 3) {\r\n\t\t\treturn findShortestPath(map, [start, end]);\r\n\t\t} else {\r\n\t\t\treturn findShortestPath(map, toArray(arguments, 1));\r\n\t\t}\r\n\t}\r\n\r\n\treturn Guidance;\r\n})();\r\n","$(\"#admin\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"disabled\")) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif (!$(\"#dialog-admin\").hasClass(\"ui-dialog-content\")) {\r\n\t\tvar refreshTimer = null;\r\n\t\tvar $total = null;\r\n\t\tvar $ajax = null;\r\n\r\n\t\tfunction refreshWindow() {\r\n\t\t\tif ($ajax) $ajax.abort();\r\n\t\t\t$total.html(\"Total: \" + $(\"#dialog-admin .window .hasFocus table tr[data-id]\").length);\r\n\r\n\t\t\t$ajax = $.ajax({\r\n\t\t\t\turl: \"admin.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: {mode: $(\"#dialog-admin .menu .active\").attr(\"data-window\")},\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tif (data && data.results) {\r\n\t\t\t\t\tvar rows = data.results;\r\n\t\t\t\t\tvar ids = [];\r\n\r\n\t\t\t\t\tfor (var i = 0, l = rows.length; i < l; i++) {\r\n\t\t\t\t\t\tvar $row = $(\"#dialog-admin .window .hasFocus tbody tr[data-id='\"+ rows[i].id +\"']\");\r\n\t\t\t\t\t\tids.push(rows[i].id);\r\n\r\n\t\t\t\t\t\tif ($row.length) {\r\n\t\t\t\t\t\t\tfor (col in rows[i]) {\r\n\t\t\t\t\t\t\t\tvar $col = $row.find(\"[data-col='\"+col+\"']\");\r\n\t\t\t\t\t\t\t\t$col.html(($col.attr(\"data-format\") == \"number\" ? numFormat(rows[i][col]) : rows[i][col]) || \"&nbsp;\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t$row = $(\"#dialog-admin .window .hasFocus table tr.hidden\").clone();\r\n\t\t\t\t\t\t\t$row.attr(\"data-id\", rows[i].id);\r\n\r\n\t\t\t\t\t\t\tfor (col in rows[i]) {\r\n\t\t\t\t\t\t\t\tvar $col = $row.find(\"[data-col='\"+col+\"']\");\r\n\t\t\t\t\t\t\t\t$col.html(($col.attr(\"data-format\") == \"number\" ? numFormat(rows[i][col]) : rows[i][col]) || \"&nbsp;\");\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t$row.removeClass(\"hidden\");\r\n\r\n\t\t\t\t\t\t\t$(\"#dialog-admin .window .hasFocus tbody\").append($row);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .window .hasFocus table tr[data-id]\").each(function() {\r\n\t\t\t\t\t\tif ($.inArray($(this).data(\"id\").toString(), ids) == -1) {\r\n\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .window .hasFocus table\").trigger(\"update\", [true]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#dialog-admin .window .hasFocus table tr[data-id]\").remove();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$total.html(\"Total: \" + $(\"#dialog-admin .window .hasFocus table tr[data-id]\").length);\r\n\t\t\t});\r\n\r\n\t\t\tif ($(\"#dialog-admin\").dialog(\"isOpen\") && $(\"#dialog-admin .menu .active\").attr(\"data-refresh\")) {\r\n\t\t\t\trefreshTimer = setTimeout(refreshWindow, $(\"#dialog-admin .menu .active\").attr(\"data-refresh\"));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t$(\"#dialog-admin\").dialog({\r\n\t\t\tautoOpen: true,\r\n\t\t\tmodal: true,\r\n\t\t\theight: 350,\r\n\t\t\twidth: 800,\r\n\t\t\tbuttons: {\r\n\t\t\t\tClose: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t// menu toggle\r\n\t\t\t\t$(\"#dialog-admin\").on(\"click\", \".menu li\", function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t$menuItem = $(this);\r\n\t\t\t\t\tclearTimeout(refreshTimer);\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .menu .active\").removeClass(\"active\");\r\n\t\t\t\t\t$menuItem.addClass(\"active\");\r\n\t\t\t\t\t$(\"div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane\").html(\"\");\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .window [data-window]\").removeClass(\"hasFocus\").hide();\r\n\t\t\t\t\t$(\"#dialog-admin .window [data-window='\"+ $menuItem.data(\"window\") +\"']\").addClass(\"hasFocus\").show();\r\n\r\n\t\t\t\t\trefreshWindow();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-admin [data-sortable='true']\").tablesorter({\r\n\t\t\t\t\tsortReset: true,\r\n\t\t\t\t\twidgets: ['saveSort'],\r\n\t\t\t\t\tsortList: [[0,0]]\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// dialog bottom tray\r\n\t\t\t\t$($(this)[0].parentElement).find(\".ui-dialog-buttonpane\").append(\"<div class='ui-dialog-traypane'></div>\");\r\n\t\t\t\t$total = $(\"div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane\");\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$menuItem = $(\"#dialog-admin .menu li.active\");\r\n\t\t\t\trefreshWindow();\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tclearTimeout(refreshTimer);\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-admin\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-admin\").dialog(\"open\");\r\n\t}\r\n});\r\n","// Dialog effects\r\n$(\"#wrapper\").addClass(\"transition\");\r\n\r\n$(document).on(\"dialogopen\", \".ui-dialog\", function (event, ui) {\r\n\t// Add additional full screen overlay for 2nd level dialog\r\n\tif ($(\".ui-dialog:visible\").length == 2 && $(this).hasClass(\"dialog-modal\"))\r\n\t\t$(\"body\").append($(\"<div id='overlay' class='overlay' />\").css(\"z-index\", $(this).css(\"z-index\") - 1));\r\n\telse if ($(\"#overlay\"))\r\n\t\t$(\"#overlay\").css(\"z-index\", $(this).css(\"z-index\") - 1);\r\n\r\n\tif (!$(this).hasClass(\"dialog-noeffect\"))\r\n\t\t$(\"#wrapper\").addClass(\"blur\");\r\n});\r\n\r\n$(document).on(\"dialogclose\", \".ui-dialog\", function (event, ui) {\r\n\tif (!$(\".ui-dialog\").is(\":visible\"))\r\n\t\t$(\"#wrapper\").removeClass(\"blur\");\r\n\r\n\tif ($(\".ui-dialog:visible\").length == 1)\r\n\t\t$(\"#overlay\").remove();\r\n\telse if ($(\"#overlay\"))\r\n\t\t$(\"#overlay\").css(\"z-index\", $(this).css(\"z-index\") - 2);\r\n\r\n\t//if ($(\".ui-dialog:visible\").length == 0 && options.buttons.follow && viewingSystemID != tripwire.client.EVE.systemID)\r\n\t//\twindow.location = \"?system=\"+tripwire.client.EVE.systemName;\r\n});\r\n\r\n// Signature overwrite\r\n$(document).on(\"click\", \"#overwrite\", function() {\r\n\tvar data = {request: {signatures: {\"delete\": [$(this).data(\"id\")]}}, systemID: viewingSystemID};\r\n\r\n\t$(\"#overwrite\").attr(\"disable\", true);\r\n\r\n\tvar success = function(data) {\r\n\t\t$(\"th.critical\").removeClass(\"critical\");\r\n\t\tValidationTooltips.close();\r\n\r\n\t\t$(\"#dialog-sigEdit\").parent().find(\".ui-button-text:contains(Save)\").click();\r\n\t}\r\n\r\n\tvar always = function(data) {\r\n\t\t$(\"#overwrite\").removeAttr(\"disable\");\r\n\t}\r\n\r\n\ttripwire.refresh('refresh', data, success, always);\r\n});\r\n","$(\".options\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"disabled\"))\r\n\t\treturn false;\r\n\r\n\t$(\"#dialog-options\").dialog({\r\n\t\tautoOpen: false,\r\n\t\twidth: 450,\r\n\t\tminHeight: 400,\r\n\t\tmodal: true,\r\n\t\tbuttons: {\r\n\t\t\tSave: function() {\r\n\t\t\t\t// Options\r\n\t\t\t\tvar data = {mode: \"set\", options: JSON.stringify(options)};\r\n\t\t\t\tvar maskChange = false;\r\n\r\n\t\t\t\t$(\"#dialog-options\").parent().find(\".ui-dialog-buttonpane button:contains('Save')\").attr(\"disabled\", true).addClass(\"ui-state-disabled\");\r\n\r\n\t\t\t\toptions.chain.typeFormat = $(\"#dialog-options #typeFormat\").val();\r\n\t\t\t\toptions.chain.classFormat = $(\"#dialog-options #classFormat\").val();\r\n\r\n\t\t\t\toptions.chain.gridlines = JSON.parse($(\"#dialog-options input[name=gridlines]:checked\").val());\r\n\r\n\t\t\t\toptions.chain[\"node-reference\"] = $(\"#dialog-options input[name=node-reference]:checked\").val();\r\n\r\n\t\t\t\toptions.signatures.pasteLife = $(\"#dialog-options #pasteLife\").val();\r\n\r\n\t\t\t\toptions.background = $(\"#dialog-options #background-image\").val();\r\n\r\n\t\t\t\toptions.uiscale = $(\"#dialog-options #uiscale-slider\").slider(\"value\");\r\n\r\n\t\t\t\tif (options.masks.active != $(\"#dialog-options input[name='mask']:checked\").val()) {\r\n\t\t\t\t\tmaskChange = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\toptions.masks.active = $(\"#dialog-options input[name='mask']:checked\").val();\r\n\r\n\t\t\t\toptions.apply();\r\n\t\t\t\toptions.save() // Performs AJAX\r\n\t\t\t\t\t.done(function() {\r\n\t\t\t\t\t\tif (maskChange) {\r\n\t\t\t\t\t\t\t// Reset signatures\r\n\t\t\t\t\t\t\t$(\"#sigTable span[data-age]\").countdown(\"destroy\");\r\n\t\t\t\t\t\t\t$(\"#sigTable tbody\").empty()\r\n\t\t\t\t\t\t\t$(\"#signature-count\").html(0);\r\n\t\t\t\t\t\t\ttripwire.signatures.list = {};\r\n\t\t\t\t\t\t\ttripwire.client.signatures = [];\r\n\r\n\t\t\t\t\t\t\ttripwire.refresh('change');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\r\n\t\t\t\t$(\"#dialog-options\").dialog(\"close\");\r\n\t\t\t\t$(\"#dialog-options\").parent().find(\".ui-dialog-buttonpane button:contains('Save')\").attr(\"disabled\", false).removeClass(\"ui-state-disabled\");\r\n\r\n\t\t\t\t// toggle mask admin icon\r\n\t\t\t\t$(\"#dialog-options input[name='mask']:checked\").data(\"admin\") ? $(\"#admin\").removeClass(\"disabled\") : $(\"#admin\").addClass(\"disabled\");\r\n\t\t\t},\r\n\t\t\tReset: function() {\r\n\t\t\t\t$(\"#dialog-confirm #msg\").html(\"Settings will be reset to defaults temporarily.<br/><br/><p><em>Save settings to make changes permanent.</em></p>\");\r\n\t\t\t\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tReset: function() {\r\n\t\t\t\t\t\t\toptions.reset();\r\n\t\t\t\t\t\t\toptions.apply();\r\n\r\n\t\t\t\t\t\t\t$(\"#dialog-options\").dialog(\"close\");\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}).dialog(\"open\");\r\n\t\t\t},\r\n\t\t\tClose: function() {\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t}\r\n\t\t},\r\n\t\topen: function() {\r\n\t\t\t// Get user stats data\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"user_stats.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tfor (stat in data) {\r\n\t\t\t\t\t$(\"#\"+stat).text(data[stat]);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Get masks\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"masks.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(response) {\r\n\t\t\t\tif (response && response.masks) {\r\n\t\t\t\t\t$(\"#dialog-options #masks #default\").html(\"\");\r\n\t\t\t\t\t$(\"#dialog-options #masks #personal\").html(\"\");\r\n\t\t\t\t\t$(\"#dialog-options #masks #corporate\").html(\"\");\r\n\r\n\t\t\t\t\tfor (var x in response.masks) {\r\n\t\t\t\t\t\tvar mask = response.masks[x];\r\n\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t+ '<input type=\"radio\" name=\"mask\" id=\"mask'+x+'\" value=\"'+mask.mask+'\" class=\"selector\" data-owner=\"'+mask.owner+'\" data-admin=\"'+mask.admin+'\" />'\r\n\t\t\t\t\t\t\t+ '<label for=\"mask'+x+'\"><img src=\"'+mask.img+'\" />'\r\n\t\t\t\t\t\t\t+  (mask.optional ? '<i class=\"closeIcon\" onclick=\"return false;\" data-icon=\"red-giant\"><i data-icon=\"times\"></i></i>' : '')\r\n\t\t\t\t\t\t\t+ '<span class=\"selector_label\">'+mask.label+'</span></label>');\r\n\r\n\t\t\t\t\t\t$(\"#dialog-options #masks #\"+mask.type).append(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findp\" value=\"personal\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t+ '<label for=\"findp\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t$(\"#dialog-options #masks #personal\").append(node);\r\n\r\n\t\t\t\t\tif (init.admin == \"1\") {\r\n\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findc\" value=\"corporate\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t\t+ '<label for=\"findc\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t\t$(\"#dialog-options #masks #corporate\").append(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$(\"#dialog-options input[name='mask']\").filter(\"[value='\"+response.masks[response.active].mask+\"']\").attr(\"checked\", true).trigger(\"change\");\r\n\r\n\t\t\t\t\t// toggle mask admin icon\r\n\t\t\t\t\tresponse.masks[response.active].admin ? $(\"#admin\").removeClass(\"disabled\") : $(\"#admin\").addClass(\"disabled\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-options #pasteLife\").val(options.signatures.pasteLife);\r\n\t\t\t$(\"#dialog-options #typeFormat\").val(options.chain.typeFormat);\r\n\t\t\t$(\"#dialog-options #classFormat\").val(options.chain.classFormat);\r\n\t\t\t$(\"#dialog-options input[name='node-reference'][value='\"+options.chain[\"node-reference\"]+\"']\").prop(\"checked\", true);\r\n\t\t\t$(\"#dialog-options input[name='gridlines'][value='\"+options.chain.gridlines+\"']\").prop(\"checked\", true);\r\n\t\t\t$(\"#dialog-options #background-image\").val(options.background);\r\n\t\t},\r\n\t\tcreate: function() {\r\n\t\t\t$(\"#optionsAccordion\").accordion({heightStyle: \"content\", collapsible: true, active: false});\r\n\r\n\t\t\t$(\"#uiscale-slider\").slider({\r\n\t\t\t\tmin: 0.7,\r\n\t\t\t\tmax: 1.4,\r\n\t\t\t\tstep: 0.05,\r\n\t\t\t\tvalue: options.uiscale || 1.0,\r\n\t\t\t\tchange: function(e, ui) {\r\n\t\t\t\t\t$(\"body\").css(\"zoom\", ui.value);\r\n\t\t\t\t},\r\n\t\t\t\tslide: function(e, ui) {\r\n\t\t\t\t\t$(\"label[for='uiscale-slider']\").html(ui.value);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"label[for='uiscale-slider']\").html($(\"#uiscale-slider\").slider(\"value\"));\r\n\r\n\t\t\t$(\"#dialog-pwChange\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tresizable: false,\r\n\t\t\t\tminHeight: 0,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tSave: function() {\r\n\t\t\t\t\t\t$(\"#pwForm\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#pwForm input[name='password'], #pwForm input[name='confirm']\").val(\"\");\r\n\t\t\t\t\t$(\"#pwError\").text(\"\").hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#pwChange\").click(function() {\r\n\t\t\t\t$(\"#dialog-pwChange\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#pwForm\").submit(function(e) {\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t$(\"#pwError\").text(\"\").hide();\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: \"options.php\",\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t$(\"#dialog-msg #msg\").text(\"Password changed\");\r\n\t\t\t\t\t\t$(\"#dialog-msg\").dialog(\"open\");\r\n\r\n\t\t\t\t\t\t$(\"#dialog-pwChange\").dialog(\"close\");\r\n\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t$(\"#pwError\").text(response.error).show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#pwError\").text(\"Unknown error\").show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-usernameChange\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tresizable: false,\r\n\t\t\t\tminHeight: 0,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tSave: function() {\r\n\t\t\t\t\t\t$(\"#usernameForm\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\topen: function() {\r\n\t\t\t\t\t$(\"#usernameForm #username\").html($(\"#dialog-options #username\").html());\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#usernameForm [name='username']\").val(\"\");\r\n\t\t\t\t\t$(\"#usernameError\").text(\"\").hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#usernameChange\").click(function() {\r\n\t\t\t\t$(\"#dialog-usernameChange\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#usernameForm\").submit(function(e) {\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t$(\"#usernameError\").text(\"\").hide();\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: \"options.php\",\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t$(\"#dialog-msg #msg\").text(\"Username changed\");\r\n\t\t\t\t\t\t$(\"#dialog-msg\").dialog(\"open\");\r\n\r\n\t\t\t\t\t\t$(\"#dialog-options #username\").html(response.result);\r\n\r\n\t\t\t\t\t\t$(\"#dialog-usernameChange\").dialog(\"close\");\r\n\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t$(\"#usernameError\").text(response.error).show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#usernameError\").text(\"Unknown error\").show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Mask selections\r\n\t\t\t$(\"#masks\").on(\"change\", \"input.selector:checked\", function() {\r\n\t\t\t\tif ($(this).data(\"owner\")) {\r\n\t\t\t\t\t$(\"#maskControls #edit\").removeAttr(\"disabled\");\r\n\t\t\t\t\t$(\"#maskControls #delete\").removeAttr(\"disabled\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#maskControls #edit\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t\t$(\"#maskControls #delete\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($(this).val() != 0.0 && $(this).val().split(\".\")[1] == 0) {\r\n\t\t\t\t\t$(\"#dialog-options #leave\").removeAttr(\"disabled\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#dialog-options #leave\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Mask join\r\n\t\t\t$(\"#dialog-joinMask\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tresizable: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tAdd: function() {\r\n\t\t\t\t\t\tvar mask = $(\"#dialog-joinMask #results input:checked\");\r\n\t\t\t\t\t\tvar label = $(\"#dialog-joinMask #results input:checked+label\");\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: {mask: mask.val(), mode: \"join\"},\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\tlabel.css(\"width\", \"\");\r\n\t\t\t\t\t\t\t\tlabel.find(\".info\").remove();\r\n\t\t\t\t\t\t\t\tlabel.append('<i class=\"closeIcon\" onclick=\"return false;\" data-icon=\"red-giant\"><i data-icon=\"times\"></i></i>');\r\n\r\n\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #\"+response.type+\" input.selector:last\").before(mask).before(label);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-joinMask\").dialog(\"close\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#dialog-joinMask form\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$(\"#dialog-joinMask #results\").html(\"\");\r\n\t\t\t\t\t\t$(\"#dialog-joinMask #loading\").show();\r\n\t\t\t\t\t\t$(\"#dialog-joinMask input[type='submit']\").attr(\"disabled\", \"disabled\");\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).then(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.results) {\r\n\t\t\t\t\t\t\t\treturn tripwire.esi.fullLookup(response.eveIDs)\r\n\t\t\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\t\t\tif (results) {\r\n\t\t\t\t\t\t\t\t\t\t\tfor (var x in results) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar mask = response.results[x];\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"radio\" name=\"mask\" id=\"mask'+mask.mask+'\" value=\"'+mask.mask+'\" class=\"selector\" data-owner=\"false\" data-admin=\"'+mask.admin+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"mask'+mask.mask+'\" style=\"width: 100%; margin-left: -5px;\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"'+mask.img+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">'+mask.label+'</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name + '<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].corporation.name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-joinMask #results\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(response.error);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unknown error\");\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).then(function() {\r\n\t\t\t\t\t\t\t$(\"#dialog-joinMask #loading\").hide();\r\n\t\t\t\t\t\t\t$(\"#dialog-joinMask input[type='submit']\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#dialog-joinMask #results\").html(\"\");\r\n\t\t\t\t\t$(\"#dialog-joinMask input[name='name']\").val(\"\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-options #masks\").on(\"click\", \"input[name='find']+label\", function() {\r\n\t\t\t\t$(\"#dialog-joinMask input[name='find']\").val($(this).prev().val());\r\n\t\t\t\t$(\"#dialog-joinMask\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// Mask leave\r\n\t\t\t$(\"#dialog-options #masks\").on(\"click\", \".closeIcon\", function() {\r\n\t\t\t\tvar mask = $(this).closest(\"input.selector+label\").prev();\r\n\r\n\t\t\t\t$(\"#dialog-confirm #msg\").text(\"Are you sure you want to remove this mask?\");\r\n\r\n\t\t\t\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tRemove: function() {\r\n\t\t\t\t\t\t\tvar send = {mode: \"leave\", mask: mask.val()};\r\n\r\n\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\t\tdata: send,\r\n\t\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t\tmask.next().remove();\r\n\t\t\t\t\t\t\t\t\tmask.remove();\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unable to delete\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}).dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// Mask delete\r\n\t\t\t$(\"#maskControls #delete\").click(function() {\r\n\t\t\t\tvar mask = $(\"#masks input.selector:checked\");\r\n\r\n\t\t\t\t$(\"#dialog-confirm #msg\").text(\"Are you sure you want to delete this mask?\");\r\n\t\t\t\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tDelete: function() {\r\n\t\t\t\t\t\t\tvar send = {mode: \"delete\", mask: mask.val()};\r\n\r\n\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\t\tdata: send,\r\n\t\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t\tmask.next().remove();\r\n\t\t\t\t\t\t\t\t\tmask.remove();\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unable to delete\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}).dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// User Create mask\r\n\t\t\t$(\"#dialog-createMask\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tCreate: function() {\r\n\t\t\t\t\t\t$(\"#dialog-createMask form\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#dialog-createMask #accessList\").on(\"click\", \"#create_add+label\", function() {\r\n\t\t\t\t\t\t$(\"#dialog-EVEsearch\").dialog(\"open\");\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-createMask form\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t// Get masks\r\n\t\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\t\t\tif (response && response.masks) {\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #default\").html(\"\");\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #personal\").html(\"\");\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #corporate\").html(\"\");\r\n\r\n\t\t\t\t\t\t\t\t\t\tfor (var x in response.masks) {\r\n\t\t\t\t\t\t\t\t\t\t\tvar mask = response.masks[x];\r\n\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"radio\" name=\"mask\" id=\"mask'+x+'\" value=\"'+mask.mask+'\" class=\"selector\" data-owner=\"'+mask.owner+'\" data-admin=\"'+mask.admin+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"mask'+x+'\"><img src=\"'+mask.img+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+  (mask.optional ? '<i class=\"closeIcon\" onclick=\"return false;\" data-icon=\"red-giant\"><i data-icon=\"times\"></i></i>' : '')\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<span class=\"selector_label\">'+mask.label+'</span></label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #\"+mask.type).append(node);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findp\" value=\"personal\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"findp\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #personal\").append(node);\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (init.admin == \"1\") {\r\n\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findc\" value=\"corporate\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"findc\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #corporate\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options input[name='mask']\").filter(\"[value='\"+response.masks[response.active].mask+\"']\").attr(\"checked\", true).trigger(\"change\");\r\n\r\n\t\t\t\t\t\t\t\t\t\t// toggle mask admin icon\r\n\t\t\t\t\t\t\t\t\t\tresponse.masks[response.active].admin ? $(\"#admin\").removeClass(\"disabled\") : $(\"#admin\").addClass(\"disabled\");\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t$(\"#dialog-createMask\").dialog(\"close\");\r\n\t\t\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(response.error);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unknown error\");\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-createMask select\").selectmenu({width: 100});\r\n\t\t\t\t},\r\n\t\t\t\topen: function() {\r\n\t\t\t\t\t$(\"#dialog-createMask input[name='name']\").val(\"\");\r\n\t\t\t\t\t$(\"#dialog-createMask #accessList :not(.static)\").remove();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#maskControls #create\").click(function() {\r\n\t\t\t\t$(\"#dialog-createMask\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-createMask #accessList\").on(\"click\", \".maskRemove\", function() {\r\n\t\t\t\t$(this).closest(\"input.selector+label\").prev().remove();\r\n\t\t\t\t$(this).closest(\"label\").remove();\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-editMask\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tSave: function() {\r\n\t\t\t\t\t\t$(\"#dialog-editMask form\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList\").on(\"click\", \".maskRemove\", function() {\r\n\t\t\t\t\t\t$(this).closest(\"input.selector+label\").prev().attr(\"name\", \"deletes[]\").hide();\r\n\t\t\t\t\t\t$(this).closest(\"label\").hide();\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList\").on(\"click\", \"#edit_add+label\", function() {\r\n\t\t\t\t\t\t$(\"#dialog-EVEsearch\").dialog(\"open\");\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-editMask form\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-editMask\").dialog(\"close\");\r\n\t\t\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(response.error);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unknown error\");\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\topen: function() {\r\n\t\t\t\t\tvar mask = $(\"#dialog-options input[name='mask']:checked\").val();\r\n\t\t\t\t\t$(\"#dialog-editMask input[name='mask']\").val(mask);\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList label.static\").hide();\r\n\t\t\t\t\t$(\"#dialog-editMask #loading\").show();\r\n\t\t\t\t\t$(\"#dialog-editMask #name\").text($(\"#dialog-options input[name='mask']:checked+label .selector_label\").text());\r\n\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\tdata: {mode: \"edit\", mask: mask},\r\n\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t}).then(function(response) {\r\n\t\t\t\t\t\treturn tripwire.esi.fullLookup(response.results)\r\n\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\tif (results) {\r\n\t\t\t\t\t\t\t\t\tfor (var x in results) {\r\n\t\t\t\t\t\t\t\t\t\tif (results[x].category == \"character\") {\r\n\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" checked=\"checked\" onclick=\"return false\" name=\"\" id=\"edit_'+results[x].id+'_1373\" value=\"'+results[x].id+'_1373\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"edit_'+results[x].id+'_1373\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Character/'+results[x].id+'_64.jpg\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Character</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name + '<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].corporation.name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t<input type=\"button\" class=\"maskRemove\" value=\"Remove\" style=\"position: absolute; bottom: 3px; right: 3px;\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '</label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-editMask #accessList .static:first\").before(node);\r\n\t\t\t\t\t\t\t\t\t\t} else if (results[x].category == \"corporation\") {\r\n\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" checked=\"checked\" onclick=\"return false\" name=\"\" id=\"edit_'+results[x].id+'_2\" value=\"'+results[x].id+'_2\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"edit_'+results[x].id+'_2\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Corporation/'+results[x].id+'_64.png\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Corporation</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t<input type=\"button\" class=\"maskRemove\" value=\"Remove\" style=\"position: absolute; bottom: 3px; right: 3px;\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '</label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-editMask #accessList .static:first\").before(node);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}).then(function(response) {\r\n\t\t\t\t\t\t$(\"#dialog-editMask #accessList label.static\").show();\r\n\t\t\t\t\t\t$(\"#dialog-editMask #loading\").hide();\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList :not(.static)\").remove();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#maskControls #edit\").click(function() {\r\n\t\t\t\t$(\"#dialog-editMask\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// EVE search dialog\r\n\t\t\t$(\"#dialog-EVEsearch\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tAdd: function() {\r\n\t\t\t\t\t\tif ($(\"#accessList input[value='\"+$(\"#EVESearchResults input\").val()+\"']\").length) {\r\n\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Already has access\");\r\n\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$(\"#EVESearchResults .info\").append('<input type=\"button\" class=\"maskRemove\" value=\"Remove\" style=\"position: absolute; bottom: 3px; right: 3px;\" />');\r\n\t\t\t\t\t\t$(\"#EVESearchResults input:checked\").attr(\"checked\", \"checked\");\r\n\t\t\t\t\t\t$(\"#EVESearchResults input:checked\").attr(\"onclick\", \"return false\");\r\n\r\n\t\t\t\t\t\tvar nodes = $(\"#EVESearchResults .maskNode:has(input:checked)\");\r\n\r\n\t\t\t\t\t\tif ($(\"#dialog-createMask\").dialog(\"isOpen\"))\r\n\t\t\t\t\t\t\t$(\"#dialog-createMask #accessList .static:first\").before(nodes);\r\n\t\t\t\t\t\telse if ($(\"#dialog-editMask\").dialog(\"isOpen\"))\r\n\t\t\t\t\t\t\t$(\"#dialog-editMask #accessList .static:first\").before(nodes);\r\n\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t},\r\n\t\t\t\t\tClose: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#EVEsearch\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\tif ($(\"#EVEsearch input[name='name']\").val() == \"\") {\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$(\"#EVESearchResults, #searchCount\").html(\"\");\r\n\t\t\t\t\t\t$(\"#EVEsearch #searchSpinner\").show();\r\n\t\t\t\t\t\t$(\"#EVEsearch input[type='submit']\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t\t\t$(\"#dialog-EVEsearch\").parent().find(\".ui-dialog-buttonpane button:contains('Add')\").attr(\"disabled\", true).addClass(\"ui-state-disabled\");\r\n\r\n\t\t\t\t\t\ttripwire.esi.search($(\"#EVEsearch input[name='name']\").val(), $(\"#EVEsearch input[name='category']:checked\").val(), $(\"#EVEsearch input[name='exact']\")[0].checked)\r\n\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\tif (results && (results.character || results.corporation)) {\r\n\t\t\t\t\t\t\t\t\t// limit results\r\n\t\t\t\t\t\t\t\t\tresults = $.merge(results.character || [], results.corporation || []);\r\n\t\t\t\t\t\t\t\t\ttotal = results.length;\r\n\t\t\t\t\t\t\t\t\tresults = results.slice(0, 10);\r\n\t\t\t\t\t\t\t\t\treturn tripwire.esi.fullLookup(results)\r\n\t\t\t\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#EVEsearch #searchCount\").html(\"Found: \"+total+\"<br/>Showing: \"+(total<10?total:10));\r\n\t\t\t\t\t\t\t\t\t\t\tif (results) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tfor (var x in results) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (results[x].category == \"character\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<div class=\"maskNode\"><input type=\"checkbox\" name=\"adds[]\" id=\"find_'+results[x].id+'_1373\" value=\"'+results[x].id+'_1373\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"find_'+results[x].id+'_1373\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Character/'+results[x].id+'_64.jpg\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Character</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name + '<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].corporation.name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label></div>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(\"#EVESearchResults\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (results[x].category == \"corporation\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<div class=\"maskNode\"><input type=\"checkbox\" name=\"\" id=\"find_'+results[x].id+'_2\" value=\"'+results[x].id+'_2\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"find_'+results[x].id+'_2\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Corporation/'+results[x].id+'_64.png\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Corporation</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label></div>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(\"#EVESearchResults\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}).always(function() {\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#EVEsearch #searchSpinner\").hide();\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#EVEsearch input[type='submit']\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-EVEsearch\").parent().find(\".ui-dialog-buttonpane button:contains('Add')\").removeAttr(\"disabled\").removeClass(\"ui-state-disabled\");\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"No Results\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#EVEsearch #searchSpinner\").hide();\r\n\t\t\t\t\t\t\t\t\t$(\"#EVEsearch input[type='submit']\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-EVEsearch\").parent().find(\".ui-dialog-buttonpane button:contains('Add')\").removeAttr(\"disabled\").removeClass(\"ui-state-disabled\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// $.ajax({\r\n\t\t\t\t\t\t// \turl: \"masks.php\",\r\n\t\t\t\t\t\t// \ttype: \"POST\",\r\n\t\t\t\t\t\t// \tdata: $(this).serialize(),\r\n\t\t\t\t\t\t// \tdataType: \"JSON\"\r\n\t\t\t\t\t\t// }).done(function(response) {\r\n\t\t\t\t\t\t// \tif (response && response.results) {\r\n\t\t\t\t\t\t// \t\tvar result = response.results[0];\r\n\t\t\t\t\t\t// \t\tvar node = $(''\r\n\t\t\t\t\t\t// \t\t\t+ '<input type=\"checkbox\" checked=\"checked\" onclick=\"return false\" name=\"adds[]\" id=\"find_'+(result.type == 2 ? result.corporationID : result.characterID)+'_'+result.type+'\" value=\"'+(result.type == 2 ? result.corporationID : result.characterID)+'_'+result.type+'\" class=\"selector\" />'\r\n\t\t\t\t\t\t// \t\t\t+ '<label for=\"find_'+(result.type == 2 ? result.corporationID : result.characterID)+'_'+result.type+'\" style=\"width: 100%; margin-left: -5px;\">'\r\n\t\t\t\t\t\t// \t\t\t+ '\t<img src=\"https://image.eveonline.com/'+(result.type == 2 ? 'Corporation/'+result.corporationID+'_64.png' : 'Character/'+result.characterID+'_64.jpg')+'\" />'\r\n\t\t\t\t\t\t// \t\t\t+ '\t<span class=\"selector_label\">'+(result.type == 2 ? 'Corporation' : 'Character')+'</span>'\r\n\t\t\t\t\t\t// \t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t// \t\t\t+ '\t\t'+(result.type != 2 ? result.characterName + '<br/>' : '')\r\n\t\t\t\t\t\t// \t\t\t+ '\t\t'+result.corporationName+'<br/>'\r\n\t\t\t\t\t\t// \t\t\t+ '\t\t'+result.allianceName\r\n\t\t\t\t\t\t// \t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t// \t\t\t+ '</label>');\r\n\t\t\t\t\t\t//\r\n\t\t\t\t\t\t// \t\t$(\"#EVESearchResults\").html(node);\r\n\t\t\t\t\t\t// \t} else {\r\n\t\t\t\t\t\t// \t\t$(\"#dialog-error #msg\").text(\"No Results\");\r\n\t\t\t\t\t\t// \t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// }).always(function() {\r\n\t\t\t\t\t\t// \t$(\"#EVEsearch #searchSpinner\").hide();\r\n\t\t\t\t\t\t// \t$(\"#EVEsearch input[type='submit']\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t// \t$(\"#dialog-EVEsearch\").parent().find(\".ui-dialog-buttonpane button:contains('Add')\").removeAttr(\"disabled\").removeClass(\"ui-state-disabled\");\r\n\t\t\t\t\t\t// });\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#EVEsearch input[name='name']\").val(\"\");\r\n\t\t\t\t\t$(\"#EVESearchResults, #searchCount\").html(\"\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\t$(\"#dialog-options\").dialog(\"open\");\r\n});\r\n","$(\"#add-signature\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\t$(\"#dialog-sigAdd\").dialog({\r\n\t\tautoOpen: false,\r\n\t\tresizable: false,\r\n\t\tminHeight: 150,\r\n\t\tdialogClass: \"dialog-noeffect\",\r\n\t\tbuttons: {\r\n\t\t\tAdd: function() {\r\n\t\t\t\t$(\"#sigAddForm\").submit();\r\n\t\t\t},\r\n\t\t\tCancel: function() {\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t}\r\n\t\t},\r\n\t\topen: function() {\r\n\t\t\t$(\"#sigAddForm #sigID\").val('');\r\n\t\t\t$(\"#sigAddForm #sigType\").val(\"Sites\").selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t$(\"#sigAddForm #sigLife\").val(72).selectmenu(\"refresh\");\r\n\t\t\t$(\"#sigAddForm #sigName\").val('');\r\n\t\t\t$(\"#sigAddForm #whType\").val('');\r\n\t\t\t$(\"#sigAddForm #connection\").val('');\r\n\t\t\t$(\"#sigAddForm #autoAdd\")[0].checked = false;\r\n\t\t\t$(\"#sigAddForm #autoAdd\").button(\"refresh\");\r\n\t\t\t$(\"#sigAddForm #whLife\").val(\"Stable\").selectmenu(\"refresh\");\r\n\t\t\t$(\"#sigAddForm #whMass\").val(\"Stable\").selectmenu(\"refresh\");\r\n\r\n\t\t\tif (tripwire.client.EVE && tripwire.client.EVE.systemName) {\r\n\t\t\t\t$(\"#autoAdd\").button(\"enable\");\r\n\t\t\t} else {\r\n\t\t\t\t$(\"#autoAdd\").button(\"disable\");\r\n\t\t\t}\r\n\t\t},\r\n\t\tclose: function() {\r\n\t\t\t$(\"th.critical\").removeClass(\"critical\");\r\n\t\t\tValidationTooltips.close();\r\n\t\t},\r\n\t\tcreate: function() {\r\n\t\t\t$(\"#autoAdd\").button().click(function() {\r\n\t\t\t\t$(\"#sigAddForm #connection\").val(tripwire.client.EVE.systemName);\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#sigAddForm #sigType, #sigAddForm #sigLife\").selectmenu({width: 100});\r\n\t\t\t$(\"#sigAddForm #whLife, #sigAddForm #whMass\").selectmenu({width: 80});\r\n\t\t\t$(\"#sigAddForm .sigSystemsAutocomplete\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0});\r\n\t\t\t$(\"#sigAddForm .typesAutocomplete\").inlinecomplete({source: whList, maxSize: 10, delay: 0});\r\n\r\n\t\t\t$(\"#sigAddForm #whType, #sigAddForm #sigID\").blur(function(e) {\r\n\t\t\t\tif (this.value == \"\") {\r\n\t\t\t\t\tthis.value = \"???\";\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#sigAddForm #whType, #sigAddForm #sigID\").focus(function(e) {\r\n\t\t\t\t$(this).select();\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\t$(\"#dialog-sigAdd\").dialog(\"open\");\r\n});\r\n\r\n$(\"#sigAddForm\").submit(function(e) {\r\n\te.preventDefault();\r\n\r\n\t// Trim ending whitespace\r\n\t$(\"#sigAddForm #connection\").val($(\"#sigAddForm #connection\").val().trim());\r\n\r\n\t$(\"th.critical\").removeClass(\"critical\");\r\n\tValidationTooltips.close();\r\n\r\n\t// Check for !empty and length == 3\r\n\tif ($(\"#sigAddForm #sigID\").val() == '' || $(\"#sigAddForm #sigID\").val().length !== 3) {\r\n\t\t$(\"#sigAddForm #sigID\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\tValidationTooltips.open({target: $(\"#sigAddForm #sigID\")}).setContent(\"Must be 3 Letters in length!\");\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Check for letters only\r\n\tif ($(\"#sigAddForm #sigID\").val() !== \"???\") {\r\n\t\tvar i = $(\"#sigAddForm #sigID\").val().length;\r\n\t\twhile (i--) {\r\n\t\t\tif ($(\"#sigAddForm #sigID\").val()[i].toLowerCase() === $(\"#sigAddForm #sigID\").val()[i].toUpperCase()) {\r\n\t\t\t\t$(\"#sigAddForm #sigID\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\t\t\tValidationTooltips.open({target: $(\"#sigAddForm #sigID\")}).setContent(\"Must be only letters!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Check for existing ID\r\n\t\tif ($.map(tripwire.client.signatures, function(sig) {return sig.mask == \"273.0\" && ((options.chain.active != null && !options.chain.tabs[options.chain.active].evescout) || options.chain.active == null) ? null : (viewingSystemID == sig.systemID ? sig.signatureID : sig.sig2ID)}).indexOf($(\"#sigAddForm #sigID\").val().toUpperCase()) !== -1) {\r\n\t\t\t$(\"#sigAddForm #sigID\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\t\tValidationTooltips.open({target: $(\"#sigAddForm #sigID\")}).setContent(\"Signature ID already exists!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\t// Check for !empty WH type\r\n\tif ($(\"#sigAddForm #sigType\").val() == \"Wormhole\" && $(\"#sigAddForm #whType\").val() == '') {\r\n\t\t$(\"#sigAddForm #whType\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\tValidationTooltips.open({target: $(\"#sigAddForm #whType\")}).setContent(\"Must specify a wormhole type!\");\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Check for valid WH type\r\n\tif ($(\"#sigAddForm #sigType\").val() == \"Wormhole\" && whList.indexOf($(\"#sigAddForm #whType\").val()) == -1) {\r\n\t\t$(\"#sigAddForm #whType\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\tValidationTooltips.open({target: $(\"#sigAddForm #whType\")}).setContent(\"Not a valid wormhole type!\");\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Check for valid Leads To\r\n\tif ($(\"#sigAddForm #sigType\").val() == \"Wormhole\" && $(\"#sigAddForm #connection\").val() && tripwire.aSigSystems.indexOf($(\"#sigAddForm #connection\").val()) == -1) {\r\n\t\t$(\"#sigAddForm #connection\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\tValidationTooltips.open({target: $(\"#sigAddForm #connection\")}).setContent(\"Not a valid leads to system!\");\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar form = $(this).serializeObject();\r\n\tform.systemID = viewingSystemID;\r\n\tform.lifeLength = tripwire.wormholes[form.whType] ? tripwire.wormholes[form.whType].life.split(\" \")[0] : 72;\r\n\tform.class = sigClass(viewingSystem, form.whType);\r\n\tif (Object.index(tripwire.systems, \"name\", form.connectionName)) {\r\n\t\tform.connectionID = Object.index(tripwire.systems, \"name\", form.connectionName);\r\n\t\tform.class2 = sigClass(form.connectionName, null);\r\n\t\tform.connectionName = null;\r\n\t}\r\n\r\n\tvar data = {\"request\": {\"signatures\": {\"add\": form}}};\r\n\r\n\t// Prevent duplicate submitting\r\n\t$(\"#sigAddForm input[type=submit]\").attr(\"disabled\", true);\r\n\t$(\"#dialog-sigAdd\").parent().find(\":button:contains('Add')\").button(\"disable\");\r\n\r\n\tvar success = function(data) {\r\n\t\tif (data.result == true) {\r\n\t\t\t$(\"#dialog-sigAdd\").dialog(\"close\");\r\n\r\n\t\t\t$(\"#undo\").removeClass(\"disabled\");\r\n\t\t\tvar undo = $.map(data.resultSet, function(id) { return data.signatures[id] });\r\n\t\t\tif (viewingSystemID in tripwire.signatures.undo) {\r\n\t\t\t\ttripwire.signatures.undo[viewingSystemID].push({action: \"add\", signatures: undo});\r\n\t\t\t} else {\r\n\t\t\t\ttripwire.signatures.undo[viewingSystemID] = [{action: \"add\", signatures: undo}];\r\n\t\t\t}\r\n\r\n\t\t\tsessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n\t\t}\r\n\t}\r\n\r\n\tvar always = function(data) {\r\n\t\t$(\"#sigAddForm input[type=submit]\").removeAttr(\"disabled\");\r\n\t\t$(\"#dialog-sigAdd\").parent().find(\":button:contains('Add')\").button(\"enable\");\r\n\t}\r\n\r\n\ttripwire.refresh('refresh', data, success, always);\r\n});\r\n","$(\"#signaturesWidget\").on(\"click\", \"#delete-signature\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).closest(\"tr\").attr(\"disabled\")) {\r\n\t\treturn false;\r\n\t} else if ($(\"#sigTable tr.selected\").length == 0) {\r\n\t\treturn false;\r\n\t} else if ($(\"#dialog-sigEdit\").hasClass(\"ui-dialog-content\") && $(\"#dialog-sigEdit\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-sigEdit\").parent().effect(\"shake\", 300);\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// $(this).closest(\"tr\").addClass(\"selected\");\r\n\t//$(this).addClass(\"invisible\");\r\n\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-deleteSig\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-deleteSig\").dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tDelete: function() {\r\n\t\t\t\t\t// Prevent duplicate submitting\r\n\t\t\t\t\t$(\"#dialog-deleteSig\").parent().find(\":button:contains('Delete')\").button(\"disable\");\r\n\t\t\t\t\tvar payload = {\"signatures\": {\"remove\": []}, \"systemID\": viewingSystemID};\r\n\t\t\t\t\tvar undo = [];\r\n\r\n\t\t\t\t\tvar signatures = $.map($(\"#sigTable tr.selected\"), function(n) {\r\n\t\t\t\t\t\tvar signature = tripwire.client.signatures[$(n).data(\"id\")];\r\n\t\t\t\t\t\tif (signature.type != \"wormhole\") {\r\n\t\t\t\t\t\t\tundo.push(signature);\r\n\t\t\t\t\t\t\treturn signature.id;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.parentID == signature.id || wormhole.childID == signature.id) return wormhole; })[0];\r\n\t\t\t\t\t\t\tundo.push({\"wormhole\": wormhole, \"signatures\": [tripwire.client.signatures[wormhole.parentID], tripwire.client.signatures[wormhole.childID]]});\r\n\t\t\t\t\t\t\treturn wormhole;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tpayload.signatures.remove = signatures;\r\n\r\n\t\t\t\t\tvar success = function(data) {\r\n\t\t\t\t\t\tif (data.resultSet && data.resultSet[0].result == true) {\r\n\t\t\t\t\t\t\t$(\"#dialog-deleteSig\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t$(\"#undo\").removeClass(\"disabled\");\r\n\t\t\t\t\t\t\tif (viewingSystemID in tripwire.signatures.undo) {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[viewingSystemID].push({action: \"remove\", signatures: undo});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[viewingSystemID] = [{action: \"remove\", signatures: undo}];\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tsessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar always = function(data) {\r\n\t\t\t\t\t\t$(\"#dialog-deleteSig\").parent().find(\":button:contains('Delete')\").button(\"enable\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttripwire.refresh('refresh', payload, success, always);\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\t// $(\"#sigTable tr.selected\").removeClass(\"selected\");\r\n\t\t\t\t//$(\"#sigTable .sigDelete\").removeClass(\"invisible\");\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-deleteSig\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-deleteSig\").dialog(\"open\");\r\n\t}\r\n});\r\n","$(\"#sigTable tbody\").on(\"dblclick\", \"tr\", {mode: \"update\"}, openSignatureDialog);\r\n$(\"#add-signature\").click({mode: \"add\"}, openSignatureDialog);\r\n\r\nfunction openSignatureDialog(e) {\r\n\te.preventDefault();\r\n\tmode = e.data.mode;\r\n\r\n\tif (mode == \"update\") {\r\n\t\t$(\"#sigTable tr.selected\").removeClass(\"selected\");\r\n\t\t$(this).closest(\"tr\").addClass(\"selected\");\r\n\t}\r\n\r\n\tif (!$(\"#dialog-signature\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-signature\").dialog({\r\n\t\t\tautoOpen: true,\r\n\t\t\tresizable: false,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tposition: {my: \"center\", at: \"center\", of: $(\"#signaturesWidget\")},\r\n\t\t\tbuttons: {\r\n\t\t\t\tSave: function() {\r\n\t\t\t\t\t$(\"#form-signature\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tAdd: function() {\r\n\t\t\t\t\t$(\"#form-signature\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\tvar aSigWormholes = $.map(tripwire.wormholes, function(item, index) { return index;});\r\n\t\t\t\taSigWormholes.splice(26, 0, \"K162\");\r\n\t\t\t\taSigWormholes.push(\"GATE\");\r\n\r\n\t\t\t\t$(\"#dialog-signature [name='signatureType'], #dialog-signature [name='signatureLife']\").selectmenu({width: 100});\r\n\t\t\t\t$(\"#dialog-signature [name='wormholeLife'], #dialog-signature [name='wormholeMass']\").selectmenu({width: 80});\r\n\t\t\t\t$(\"#dialog-signature [data-autocomplete='sigSystems']\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0});\r\n\t\t\t\t$(\"#dialog-signature [data-autocomplete='sigType']\").inlinecomplete({source: aSigWormholes, maxSize: 10, delay: 0});\r\n\r\n\t\t\t\t$(\"#dialog-signature #durationPicker\").durationPicker();\r\n\r\n\t\t\t\t// Ensure first signature ID field only accepts letters\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID_Alpha'], #dialog-signature [name='signatureID2_Alpha']\").on(\"input\", function() {\r\n\t\t\t\t\twhile (!/^[a-zA-Z?]*$/g.test(this.value)) {\r\n\t\t\t\t\t\tthis.value = this.value.substring(0, this.value.length -1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Ensure second signature ID field only accepts numbers\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID_Numeric'], #dialog-signature [name='signatureID2_Numeric']\").on(\"input\", function() {\r\n\t\t\t\t\twhile (!/^[0-9?]*$/g.test(this.value)) {\r\n\t\t\t\t\t\tthis.value = this.value.substring(0, this.value.length -1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Select value on click\r\n\t\t\t\t$(\"#dialog-signature .signatureID, #dialog-signature .wormholeType\").on(\"click\", function() {\r\n\t\t\t\t\t$(this).select();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Auto fill opposite side wormhole w/ K162\r\n\t\t\t\t$(\"#dialog-signature .wormholeType\").on(\"input, change\", function() {\r\n\t\t\t\t\tif (this.value.length > 0 && $.inArray(this.value, aSigWormholes) != -1 && this.value != \"K162\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature .wormholeType\").not(this).val(\"K162\");\r\n\r\n\t\t\t\t\t\t// Also auto calculate duration\r\n\t\t\t\t\t\tif (tripwire.wormholes[this.value]) {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature #durationPicker\").val(tripwire.wormholes[this.value].life.substring(0, 2) * 60 * 60).change();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Toggle between wormhole and regular signatures\r\n\t\t\t\t$(\"#dialog-signature\").on(\"selectmenuchange\", \"[name='signatureType']\", function() {\r\n\t\t\t\t\tif (this.value == \"wormhole\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature #site\").slideUp(200, function() { $(this).hide(0); });\r\n\t\t\t\t\t\t$(\"#dialog-signature #wormhole\").slideDown(200, function() { $(this).show(200); });\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#dialog-signature #site\").slideDown(200, function() { $(this).show(200); });\r\n\t\t\t\t\t\t$(\"#dialog-signature #wormhole\").slideUp(200, function() { $(this).hide(0); });\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tValidationTooltips.close();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#form-signature\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar form = $(this).serializeObject();\r\n\t\t\t\t\tvar valid = true;\r\n\t\t\t\t\tValidationTooltips.close();\r\n\r\n\t\t\t\t\t// Validate full signature ID fields (blank | 3 characters)\r\n\t\t\t\t\t$.each($(\"#dialog-signature .signatureID:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && this.value.length < 3) {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Must be 3 characters in length!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate life length (> 5 minutes)\r\n\t\t\t\t\tif (isNaN(parseInt($(\"#dialog-signature #durationPicker\").val())) || !(parseInt($(\"#dialog-signature #durationPicker\").val()) >= 300)) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-signature #durationPicker + .bdp-input\")}).setContent(\"Must be at least 5 minutes!\");\r\n\t\t\t\t\t\t$(\"#dialog-signature #durationPicker\").select();\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Validate wormhole types (blank | wormhole)\r\n\t\t\t\t\t$.each($(\"#dialog-signature .wormholeType:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && $.inArray(this.value.toUpperCase(), aSigWormholes) == -1) {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Must be a valid wormhole type!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate leads to system (blank | system)\r\n\t\t\t\t\t$.each($(\"#dialog-signature .leadsTo:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && tripwire.aSigSystems.findIndex((item) => this.value.toLowerCase() === item.toLowerCase()) == -1) {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Must be a valid leads to system!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate leads to isn't the viewing system which causes a inner loop\r\n\t\t\t\t\t$.each($(\"#dialog-signature .leadsTo:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && this.value.toLowerCase() === viewingSystem.toLowerCase()) {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Wormhole cannot lead to the same system it comes from!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\tvar payload = {};\r\n\t\t\t\t\tvar undo = [];\r\n\t\t\t\t\tif (form.signatureType === \"wormhole\") {\r\n\t\t\t\t\t\tvar signature = {\r\n\t\t\t\t\t\t\t\"signatureID\": form.signatureID_Alpha + form.signatureID_Numeric,\r\n\t\t\t\t\t\t\t\"systemID\": viewingSystemID,\r\n\t\t\t\t\t\t\t\"type\": \"wormhole\",\r\n\t\t\t\t\t\t\t\"name\": form.wormholeName,\r\n\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tvar leadsTo = null;\r\n\t\t\t\t\t\tif (Object.index(tripwire.systems, \"name\", form.leadsTo, true)) {\r\n\t\t\t\t\t\t\t// Leads To is a normal EVE system, so use the sytem ID\r\n\t\t\t\t\t\t\tleadsTo = Object.index(tripwire.systems, \"name\", form.leadsTo, true)\r\n\t\t\t\t\t\t} else if (tripwire.wormholes[form.wormholeType.toUpperCase()]) {\r\n\t\t\t\t\t\t\t// Leads To can be determined by the wormhole type, so lets use what we know it leads to\r\n\t\t\t\t\t\t\tif (tripwire.aSigSystems.findIndex((item) => tripwire.wormholes[form.wormholeType.toUpperCase()].leadsTo.replace(' ', '-').toLowerCase() === item.toLowerCase()) > -1) {\r\n\t\t\t\t\t\t\t\tleadsTo = tripwire.aSigSystems.findIndex((item) => tripwire.wormholes[form.wormholeType.toUpperCase()].leadsTo.replace(' ', '-').toLowerCase() === item.toLowerCase());\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (tripwire.aSigSystems.findIndex((item) => form.leadsTo.toLowerCase() === item.toLowerCase()) !== -1) {\r\n\t\t\t\t\t\t\t// Leads To is one of the valid types we allow, so use of of those indexes as reference\r\n\t\t\t\t\t\t\tleadsTo = tripwire.aSigSystems.findIndex((item) => form.leadsTo.toLowerCase() === item.toLowerCase());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar signature2 = {\r\n\t\t\t\t\t\t\t\"signatureID\": form.signatureID2_Alpha + form.signatureID2_Numeric,\r\n\t\t\t\t\t\t\t\"systemID\": leadsTo,\r\n\t\t\t\t\t\t\t\"type\": \"wormhole\",\r\n\t\t\t\t\t\t\t\"name\": form.wormholeName2,\r\n\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tvar wormhole = {\r\n\t\t\t\t\t\t\t\"type\": tripwire.wormholes[form.wormholeType.toUpperCase()] ? form.wormholeType.toUpperCase() : (tripwire.wormholes[form.wormholeType2.toUpperCase()] ? form.wormholeType2.toUpperCase() : \"\"),\r\n\t\t\t\t\t\t\t\"life\": form.wormholeLife,\r\n\t\t\t\t\t\t\t\"mass\": form.wormholeMass\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tif (mode == \"update\") {\r\n\t\t\t\t\t\t\tsignature.id = $(\"#dialog-signature\").data(\"signatureid\");\r\n\t\t\t\t\t\t\tsignature2.id = $(\"#dialog-signature\").data(\"signature2id\");\r\n\t\t\t\t\t\t\twormhole.id = $(\"#dialog-signature\").data(\"wormholeid\");\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"update\": [{\"wormhole\": wormhole, \"signatures\": [signature, signature2]}]}};\r\n\r\n\t\t\t\t\t\t\tif (tripwire.client.wormholes[wormhole.id]) {\r\n\t\t\t\t\t\t\t\t\tundo.push({\"wormhole\": tripwire.client.wormholes[wormhole.id], \"signatures\": [tripwire.client.signatures[signature.id], tripwire.client.signatures[signature2.id]]});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t// used to be just a regular signature\r\n\t\t\t\t\t\t\t\t\tundo.push(tripwire.client.signatures[signature.id]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"add\": [{\"wormhole\": wormhole, \"signatures\": [signature, signature2]}]}};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (mode == \"update\") {\r\n\t\t\t\t\t\t\tvar signature = {\r\n\t\t\t\t\t\t\t\t\"id\": $(\"#dialog-signature\").data(\"signatureid\"),\r\n\t\t\t\t\t\t\t\t\"signatureID\": form.signatureID_Alpha + form.signatureID_Numeric,\r\n\t\t\t\t\t\t\t\t\"systemID\": viewingSystemID,\r\n\t\t\t\t\t\t\t\t\"type\": form.signatureType,\r\n\t\t\t\t\t\t\t\t\"name\": form.signatureName,\r\n\t\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"update\": [signature]}};\r\n\t\t\t\t\t\t\tundo.push(tripwire.client.signatures[signature.id]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar signature = {\r\n\t\t\t\t\t\t\t\t\"signatureID\": form.signatureID_Alpha + form.signatureID_Numeric,\r\n\t\t\t\t\t\t\t\t\"systemID\": viewingSystemID,\r\n\t\t\t\t\t\t\t\t\"type\": form.signatureType,\r\n\t\t\t\t\t\t\t\t\"name\": form.signatureName,\r\n\t\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"add\": [signature]}};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\":button:contains('Save')\").button(\"disable\");\r\n\r\n\t\t\t\t\tvar success = function(data) {\r\n\t\t\t\t\t\tif (data.resultSet && data.resultSet[0].result == true) {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t$(\"#undo\").removeClass(\"disabled\");\r\n\r\n\t\t\t\t\t\t\tif (mode == \"add\") {\r\n\t\t\t\t\t\t\t\tundo = data.results;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (viewingSystemID in tripwire.signatures.undo) {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[viewingSystemID].push({action: mode, signatures: undo});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[viewingSystemID] = [{action: mode, signatures: undo}];\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tsessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar always = function() {\r\n\t\t\t\t\t\t$(\"#sigEditForm input[type=submit]\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t$(\"#dialog-signature\").parent().find(\":button:contains('Save')\").button(\"enable\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttripwire.refresh('refresh', payload, success, always);\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$(\"#dialog-signature input\").val(\"\");\r\n\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(\"unknown\").selectmenu(\"refresh\");\r\n\r\n\t\t\t\t$(\"#dialog-signature #site\").show();\r\n\t\t\t\t$(\"#dialog-signature #wormhole\").hide();\r\n\r\n\t\t\t\t// Side labels\r\n\t\t\t\t$(\"#dialog-signature .sideLabel:first\").html(viewingSystem + \" Side\");\r\n\t\t\t\t$(\"#dialog-signature .sideLabel:last\").html(\"Other Side\");\r\n\r\n\t\t\t\t// Default signature life\r\n\t\t\t\t$(\"#dialog-signature #durationPicker\").val(options.signatures.pasteLife * 60 * 60).change();\r\n\r\n\t\t\t\tif (mode == \"update\") {\r\n\t\t\t\t\tvar id = $(\"#sigTable tr.selected\").data(\"id\");\r\n\t\t\t\t\tvar signature = tripwire.client.signatures[id];\r\n\t\t\t\t\t$(\"#dialog-signature\").data(\"signatureid\", id);\r\n\r\n\t\t\t\t\t// Change the dialog buttons\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Add')\").hide();\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Save')\").show();\r\n\r\n\t\t\t\t\t// Change the dialog title\r\n\t\t\t\t\t$(\"#dialog-signature\").dialog(\"option\", \"title\", \"Edit Signature\");\r\n\r\n\t\t\t\t\t// console.log(signature);\r\n\t\t\t\t\tif (signature.type == \"wormhole\") {\r\n\t\t\t\t\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.parentID == id || wormhole.childID == id) return wormhole; })[0];\r\n\t\t\t\t\t\tvar otherSignature = id == wormhole.parentID ? tripwire.client.signatures[wormhole.childID] : tripwire.client.signatures[wormhole.parentID];\r\n\t\t\t\t\t\t$(\"#dialog-signature\").data(\"signature2id\", otherSignature.id);\r\n\t\t\t\t\t\t$(\"#dialog-signature\").data(\"wormholeid\", wormhole.id);\r\n\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Alpha']\").val(signature.signatureID ? signature.signatureID.substr(0, 3) : \"???\");\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Numeric']\").val(signature.signatureID ? signature.signatureID.substr(3, 5) : \"\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(signature.type).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeName']\").val(signature.name);\r\n\t\t\t\t\t\t$(\"#dialog-signature #durationPicker\").val(signature.lifeLength).change();\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='wormholeType']\").val(wormhole.parentID == signature.id ? wormhole.type : 'K162');\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='leadsTo']\").val(tripwire.systems[otherSignature.systemID] ? tripwire.systems[otherSignature.systemID].name : (tripwire.aSigSystems[otherSignature.systemID] ? tripwire.aSigSystems[otherSignature.systemID] : \"\"));\r\n\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID2_Alpha']\").val(otherSignature.signatureID ? otherSignature.signatureID.substr(0, 3) : \"???\");\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID2_Numeric']\").val(otherSignature.signatureID ? otherSignature.signatureID.substr(3, 5) : \"\");\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='wormholeType2']\").val(wormhole.parentID == otherSignature.id ? wormhole.type : 'K162');\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeName2']\").val(otherSignature.name);\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeLife']\").val(wormhole.life).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeMass']\").val(wormhole.mass).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Alpha']\").val(signature.signatureID.substr(0, 3));\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Numeric']\").val(signature.signatureID.substr(3, 5));\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(signature.type).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureName']\").val(signature.name);\r\n\t\t\t\t\t\t$(\"#dialog-signature #durationPicker\").val(signature.lifeLength).change();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Change the dialog buttons\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Add')\").show();\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Save')\").hide();\r\n\r\n\t\t\t\t\t// Change the dialog title\r\n\t\t\t\t\t$(\"#dialog-signature\").dialog(\"option\", \"title\", \"Add Signature\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tValidationTooltips.close();\r\n\t\t\t\t$(\"#sigTable tr.selected\").removeClass(\"selected\");\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-signature\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-signature\").dialog(\"open\");\r\n\t}\r\n};\r\n","function openSigEdit(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).closest(\"tr\").attr(\"disabled\")) {\r\n\t\treturn false;\r\n\t} else if ($(\"#dialog-deleteSig\").hasClass(\"ui-dialog-content\") && $(\"#dialog-deleteSig\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-deleteSig\").parent().effect(\"shake\", 300);\r\n\t\treturn false;\r\n\t} else if ($(\"#dialog-sigEdit\").hasClass(\"ui-dialog-content\") && $(\"#dialog-sigEdit\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-sigEdit\").parent().effect(\"shake\", 300);\r\n\t\treturn false;\r\n\t}\r\n\r\n\t$(this).closest(\"tr\").addClass(\"selected\");\r\n\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-sigEdit\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-sigEdit\").dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 150,\r\n\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tSave: function() {\r\n\t\t\t\t\t$(\"#sigEditForm\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\tvar id = $(\"#sigTable tr.selected\").data(\"id\");\r\n\t\t\t\t$(\"#sigEditForm\").data(\"id\", id);\r\n\t\t\t\tvar sig = tripwire.client.signatures[id];\r\n\t\t\t\ttripwire.activity.editSig = id;\r\n\t\t\t\ttripwire.refresh('refresh');\r\n\r\n\t\t\t\t$(\"#autoEdit\")[0].checked = false;\r\n\t\t\t\t$(\"#autoEdit\").button(\"refresh\");\r\n\r\n\t\t\t\t// First check if it is a WH\r\n\t\t\t\tif (sig.life || sig.mass) {\r\n\t\t\t\t\t// Check which side we are editing\r\n\t\t\t\t\tif (sig.systemID == viewingSystemID) {\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #sigID\").val(sig.signatureID);\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #sigType\").val(\"Wormhole\").selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #whType\").val(sig.type);\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #connection\").val(tripwire.systems[sig.connectionID] ? tripwire.systems[sig.connectionID].name : sig.connection);\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #whLife\").val(sig.life).selectmenu(\"refresh\");\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #whMass\").val(sig.mass).selectmenu(\"refresh\");\r\n\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit [name=side]\").val(\"parent\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #sigID\").val(sig.sig2ID);\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #sigType\").val(\"Wormhole\").selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #whType\").val(sig.sig2Type);\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #connection\").val(tripwire.systems[sig.systemID] ? tripwire.systems[sig.systemID].name : sig.system);\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #whLife\").val(sig.life).selectmenu(\"refresh\");\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit #whMass\").val(sig.mass).selectmenu(\"refresh\");\r\n\r\n\t\t\t\t\t\t$(\"#dialog-sigEdit [name=side]\").val(\"child\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$(\"#dialog-sigEdit #sigLife\").val(72).selectmenu(\"refresh\");\r\n\t\t\t\t\t$(\"#dialog-sigEdit #sigName\").val(\"\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Its not a WH\r\n\t\t\t\t\t$(\"#dialog-sigEdit #sigID\").val(sig.signatureID);//.attr(\"name\", \"signatureID\");\r\n\t\t\t\t\t$(\"#dialog-sigEdit #sigType\").val(sig.type == \"???\" ? \"Sites\" : sig.type).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t$(\"#dialog-sigEdit #sigLife\").val(sig.lifeLength).selectmenu(\"refresh\");\r\n\t\t\t\t\t$(\"#dialog-sigEdit #sigName\").val(sig.name);\r\n\r\n\t\t\t\t\t$(\"#dialog-sigEdit #whType\").val(\"\");\r\n\t\t\t\t\t$(\"#dialog-sigEdit #connection\").val(\"\");\r\n\t\t\t\t\t$(\"#dialog-sigEdit #whLife\").val(\"Stable\").selectmenu(\"refresh\");\r\n\t\t\t\t\t$(\"#dialog-sigEdit #whMass\").val(\"Stable\").selectmenu(\"refresh\");\r\n\r\n\t\t\t\t\t$(\"#dialog-sigEdit [name=side]\").val(\"parent\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (tripwire.client.EVE && tripwire.client.EVE.systemName) {\r\n\t\t\t\t\t$(\"#autoEdit\").button(\"enable\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#autoEdit\").button(\"disable\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Auto select ID field\r\n\t\t\t\t$(\"#dialog-sigEdit #sigID\").select();\r\n\t\t\t},\r\n\t\t\tclose: function(e, ui) {\r\n\t\t\t\tdelete tripwire.activity.editSig;\r\n\t\t\t\ttripwire.refresh('refresh');\r\n\r\n\t\t\t\t$(this).data(\"id\", \"\");\r\n\r\n\t\t\t\t$(\"th.critical\").removeClass(\"critical\");\r\n\t\t\t\tValidationTooltips.close();\r\n\r\n\t\t\t\t$(\"#sigTable tr.selected\").removeClass(\"selected\");\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t$(\"#autoEdit\").button().click(function() {\r\n\t\t\t\t\t$(\"#sigEditForm #connection\").val(tripwire.client.EVE.systemName);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#sigEditForm #sigType, #sigEditForm #sigLife\").selectmenu({width: 100});\r\n\t\t\t\t$(\"#sigEditForm #whLife, #sigEditForm #whMass\").selectmenu({width: 80});\r\n\t\t\t\t$(\"#sigEditForm .sigSystemsAutocomplete\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0});\r\n\t\t\t\t$(\"#sigEditForm .typesAutocomplete\").inlinecomplete({source: whList, maxSize: 10, delay: 0});\r\n\r\n\t\t\t\t$(\"#sigEditForm #whType, #sigEditForm #sigID\").blur(function(e) {\r\n\t\t\t\t\tif (this.value == \"\") {\r\n\t\t\t\t\t\tthis.value = \"???\";\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#sigEditForm #whType, #sigEditForm #sigID\").focus(function(e) {\r\n\t\t\t\t\t$(this).select();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-sigEdit\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-sigEdit\").dialog(\"open\");\r\n\t}\r\n}\r\n\r\n// $(\"#sigTable\").on(\"click\", \".sigEdit\", openSigEdit);\r\n// $(\"#sigTable tbody\").on(\"dblclick\", \"tr\", openSigEdit);\r\n\r\n$(\"#sigEditForm\").submit(function(e) {\r\n\te.preventDefault();\r\n\r\n\t// Trim ending whitespace\r\n\t$(\"#sigEditForm #connection\").val($(\"#sigEditForm #connection\").val().trim());\r\n\r\n\t$(\"th.critical\").removeClass(\"critical\");\r\n\tValidationTooltips.close();\r\n\r\n\t// Check for !empty and length == 3\r\n\tif ($(\"#sigEditForm #sigID\").val() == '' || $(\"#sigEditForm #sigID\").val().length !== 3) {\r\n\t\t$(\"#sigEditForm #sigID\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\tValidationTooltips.open({target: $(\"#sigEditForm #sigID\")}).setContent(\"Must be 3 letters in length!\");\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Check for letters only\r\n\tif ($(\"#sigEditForm #sigID\").val() !== \"???\") {\r\n\t\tvar i = $(\"#sigEditForm #sigID\").val().length;\r\n\t\twhile (i--) {\r\n\t\t\tif ($(\"#sigEditForm #sigID\").val()[i].toLowerCase() === $(\"#sigEditForm #sigID\").val()[i].toUpperCase()) {\r\n\t\t\t\t$(\"#sigEditForm #sigID\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\t\t\tValidationTooltips.open({target: $(\"#sigEditForm #sigID\")}).setContent(\"Must be only letters!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Check for existing ID\r\n\t\tif ($(\"#sigEditForm #sigID\").val().toUpperCase() !== (viewingSystemID == tripwire.client.signatures[$(this).data(\"id\")].systemID ? tripwire.client.signatures[$(this).data(\"id\")].signatureID : tripwire.client.signatures[$(this).data(\"id\")].sig2ID) && $.map(tripwire.client.signatures, function(sig) {return sig.mask == \"273.0\" && ((options.chain.active != null && !options.chain.tabs[options.chain.active].evescout) || options.chain.active == null) ? null : (viewingSystemID == sig.systemID ? sig.signatureID : sig.sig2ID)}).indexOf($(\"#sigEditForm #sigID\").val().toUpperCase()) !== -1) {\r\n\t\t\t$(\"#sigEditForm #sigID\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\t\tValidationTooltips.open({target: $(\"#sigEditForm #sigID\")}).setContent(\"Signature ID already exists! <input type='button' autofocus='true' id='overwrite' value='Overwrite' style='margin-bottom: -4px; margin-top: -4px; font-size: 0.8em;' data-id='\"+ $(\"#sigTable tr:has(td:first-child:contains(\"+$(\"#sigEditForm #sigID\").val().toUpperCase()+\"))\").data(\"id\") +\"' />\");\r\n\t\t\t$(\"#overwrite\").focus();\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\t// Check for empty WH type\r\n\tif ($(\"#sigEditForm #sigType\").val() == \"Wormhole\" && $(\"#sigEditForm #whType\").val() == '') {\r\n\t\t$(\"#sigEditForm #whType\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\tValidationTooltips.open({target: $(\"#sigEditForm #whType\")}).setContent(\"Must specify a wormhole type!\");\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Check for valid WH type\r\n\tif ($(\"#sigEditForm #sigType\").val() == \"Wormhole\" && whList.indexOf($(\"#sigEditForm #whType\").val()) == -1) {\r\n\t\t$(\"#sigEditForm #whType\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\tValidationTooltips.open({target: $(\"#sigEditForm #whType\")}).setContent(\"Not a valid wormhole type!\");\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Check for valid Leads To\r\n\tif ($(\"#sigEditForm #sigType\").val() == \"Wormhole\" && $(\"#sigEditForm #connection\").val() && tripwire.aSigSystems.indexOf($(\"#sigEditForm #connection\").val()) == -1) {\r\n\t\t$(\"#sigEditForm #connection\").focus().parent().prev(\"th\").addClass(\"critical\");\r\n\t\tValidationTooltips.open({target: $(\"#sigEditForm #connection\")}).setContent(\"Not a valid leads to system!\");\r\n\t\treturn;\r\n\t}\r\n\r\n\r\n\tvar form = $(this).serializeObject();\r\n\tform.id = $(this).data(\"id\");\r\n\tform.systemID = viewingSystemID; // needed??\r\n\r\n\tif (tripwire.wormholes[form.whType]) {\r\n\t\tform.lifeLength = tripwire.wormholes[form.whType].life.split(\" \")[0];\r\n\t} else if (form.side == \"parent\") {\r\n\t\tform.lifeLength = tripwire.wormholes[tripwire.client.signatures[form.id].sig2Type] ? tripwire.wormholes[tripwire.client.signatures[form.id].sig2Type].life.split(\" \")[0] : form.lifeLength;\r\n\t} else {\r\n\t\tform.lifeLength = tripwire.wormholes[tripwire.client.signatures[form.id].type] ? tripwire.wormholes[tripwire.client.signatures[form.id].type].life.split(\" \")[0] : form.lifeLength;\r\n\t}\r\n\r\n\tform.connectionID = form.connectionName ? Object.index(tripwire.systems, \"name\", form.connectionName) || null : null;\r\n\tform.connectionName = form.connectionID ? (form.side == \"parent\" ? (tripwire.client.signatures[form.id].connectionID > 0 ? tripwire.client.signatures[form.id].connection : null) : (tripwire.client.signatures[form.id].systemID > 0 ? tripwire.client.signatures[form.id].system : null)) : form.connectionName;\r\n\t//form.connectionName = tripwire.systems[form.connectionID] ? (form.side == \"parent\" ? tripwire.client.signatures[form.id].connection : tripwire.client.signatures[form.id].system) || null : form.connectionName;\r\n\tform.whLife = tripwire.client.signatures[form.id].life != form.whLife ? form.whLife : null;\r\n\tform.whLife = !tripwire.client.signatures[form.id].life ? \"New \" + form.whLife : form.whLife;\r\n\tform.sig2ID = form.side == \"parent\" ? tripwire.client.signatures[form.id].sig2ID : tripwire.client.signatures[form.id].signatureID;\r\n\tform.sig2Type = form.side == \"parent\" ? tripwire.client.signatures[form.id].sig2Type : tripwire.client.signatures[form.id].type;\r\n\tform.class = sigClass(viewingSystem, form.sig2Type);\r\n\tform.class2 = sigClass(form.connectionID ? tripwire.systems[form.connectionID].name : null, form.whType);\r\n\tvar data = {\"request\": {\"signatures\": {\"update\": form}}};\r\n\tvar undo = [tripwire.client.signatures[form.id]];\r\n\r\n\t// Prevent duplicate submitting\r\n\t$(\"#sigEditForm input[type=submit]\").attr(\"disabled\", true);\r\n\t$(\"#dialog-sigEdit\").parent().find(\":button:contains('Save')\").button(\"disable\");\r\n\r\n\tvar success = function(data) {\r\n\t\tif (data.result == true) {\r\n\t\t\t$(\"#dialog-sigEdit\").dialog(\"close\");\r\n\r\n\t\t\t$(\"#undo\").removeClass(\"disabled\");\r\n\t\t\tif (viewingSystemID in tripwire.signatures.undo) {\r\n\t\t\t\ttripwire.signatures.undo[viewingSystemID].push({action: \"update\", signatures: undo});\r\n\t\t\t} else {\r\n\t\t\t\ttripwire.signatures.undo[viewingSystemID] = [{action: \"update\", signatures: undo}];\r\n\t\t\t}\r\n\r\n\t\t\tsessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n\t\t}\r\n\t}\r\n\r\n\tvar always = function(data) {\r\n\t\t$(\"#sigEditForm input[type=submit]\").removeAttr(\"disabled\");\r\n\t\t$(\"#dialog-sigEdit\").parent().find(\":button:contains('Save')\").button(\"enable\");\r\n\t}\r\n\r\n\ttripwire.refresh('refresh', data, success, always);\r\n});\r\n"]}