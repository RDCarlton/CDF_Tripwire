{"version":3,"sources":["helpers.js","init.js","options.js","layout.js","tripwire.js","global-hooks.js","active.js","addSignature.js","api.js","automapper.js","comments.js","deleteSignature.js","editSignature.js","esi.js","eve.js","parse.js","paste.js","redo.js","serverStatus.js","sync.js","systemChange.js","tutorials.js","undo.js","activity-graph.js","chain-map.js","ckeditor.js","guidance.js","dialogs/admin-dialog.js","dialogs/base-dialog.js","dialogs/options-dialog.js","dialogs/signature-delete-dialog.js","dialogs/signature-dialog.js"],"names":["Object","sort","obj","prop","swapped","prev","i","Number","tmp","index","val","cs","key","toLowerCase","find","maxTime","maxTimeString","Date","size","hasOwnProperty","time","dates","push","length","getTime","$","fn","serializeObject","self","this","json","push_counters","patterns","validate","fixed","named","build","base","value","push_counter","undefined","each","serializeArray","test","name","k","keys","match","merge","reverse_key","pop","replace","RegExp","extend","jQuery","numFormat","num","n","toString","split","join","letterToNumbers","string","toUpperCase","letters","sum","Math","pow","indexOf","substr","sigFormat","input","type","alpha","numeric","format","options","chain","typeFormat","classFormat","x","l","sigClass","id","map","tripwire","systems","system","class","security","systemType","wormholes","leadsTo","isEmpty","getCookie","c_name","c_value","document","cookie","c_start","c_end","unescape","substring","setCookie","exdays","exdate","setDate","getDate","escape","toUTCString","location","protocol","originalAddClassMethod","addClass","originalRemoveClassMethod","removeClass","className","result","apply","arguments","trigger","viewingSystem","attr","viewingSystemID","server","app_name","version","html","saveTimer","localOverrides","localOptions","JSON","parse","localStorage","getItem","userID","init","character","characterID","characterName","background","uiscale","favorites","grid","tracking","active","masks","corporationID","gridlines","tabs","node-reference","zoom","signatures","editType","copySeparator","pasteLife","alignment","sigID","sigType","sigAge","sigLife","sigMass","buttons","follow","chainWidget","viewing","signaturesWidget","autoMapper","saveDelay","delay","clearTimeout","setTimeout","save","stringify","window","get","setItem","ajax","url","data","mode","dataType","load","set","local","constructor","reset","defaults","oog","data-col","col","data-row","row","data-sizex","size_x","data-sizey","size_y","css","width","height","favorite","parseInt","home","kspace","evescout","inArray","a","href","hostname","pathname","search","filter","$tab","clone","systemID","append","redraw","gridster","widget_selector","avoid_overlapped_widgets","widget_base_dimensions","widget_margins","autogrow_cols","helper","draggable","start","e","ui","resize","enabled","handle_class","max_size","min_size","stop","$widget","serialize_params","$w","wgd","disable","disable_resize","visibility","click","hasClass","serialize","enable","enable_resize","timer","xhr","client","list","undo","sessionStorage","redo","activity","esi","refreshRate","connected","ageFormat","instance","sync","setAgeFormat","countdown","serverTime","chainMap","draw","pastEOL","since","layout","whTooltip","sig","item","tooltip","sig2Type","whType","life","mass","jump","ageTooltip","date","lifeTime","getMonth","getHours","getMinutes","createdByName","modifiedTime","modifiedByName","refresh","successCallback","alwaysCallback","on","preventDefault","systemChange","parseFloat","originalEvent","wheelDelta","fadeIn","timeout","keydown","activeElement","is","metaKey","ctrlKey","keyCode","getSelection","output","signature","signatureID","wormhole","initialID","secondaryID","otherSignature","aSigSystems","lifeLength","lifeLeft","text","focus","select","Notify","splice","toggle","EVE","systemName","show","hide","characters","removeAttr","remove","delete","display","stopPropagation","content","color","stick","jBox","offset","y","animation","autoClose","ValidationTooltips","fade","Tooltips","attach","getContent","position","outside","SystemActivityToolTips","appendTo","reposition","repositionOnOpen","createOnInit","onOpen","nodePos","source","closest","parentPos","nodeHeight","targetPos","target","tooltipWidth","container","parent","left","top","WormholeTypeToolTips","adjustDistance","responsiveWidth","OccupiedToolTips","pointer","minWidth","repositionOnContent","parentWidth","setContent","cache","done","occupants","chars","b","shipTypeName","linkSig","sigName","sortable","items","axis","tolerance","containment","update","newTabs","dialog","Remove Tab","Cancel","resizable","minHeight","dialogClass","OK","submit","open","close","create","inlinecomplete","maxSize","thera","checked","eq","contextmenu","delegate","menu","event","my","at","of","children","colName","cmd","beforeOpen","effect","duration","showInfo","setDestination","collapsed","collapse","wormholeID","autoOpen","Close","payload","totalMass","toID","shipType","moogle","prototype","setFlare","flare","flares","removeFlare","widget","autocomplete","_create","element","_selectInit","_super","_value","originalReturn","_superApply","change","_suggest","_initSource","isArray","request","response","matcher","escapeRegex","term","results","Array","_close","input_source","addToSelect","select_added_value","select_source","unshift","removeFromSelect","wrapper","trim","toArray","_createShowAllButton","that","wasOpen","button","icons","primary","_search","tablesorter","sortReset","widgets","textExtraction","2","node","toggleClass","shiftKey","nextUntil","addBack","add","Ok","easing","editSigs","editComments","editSig","editComment","animate","backgroundColor","fadeOut","addSig","option","disabled","tr","until","moment","utc","toDate","onExpiry","alwaysExpire","compact","serverSync","wrapInner","slideDown","$set","replaceWith","contents","API","indicator","APIrefresh","expire","periodsToSeconds","onTick","t","from","to","stationID","shortest","toClass","title","signature2","resultSet","empty","action","comments","modified","$comment","comment","err","message","sticky","commentID","before","created","deleteSig","slideUp","edit","locationTimer","shipTimer","onlineTimer","baseUrl","userAgent","navigator","connection","tokenExpire","subtract","isBefore","expired","param","token","accessToken","user_agent","status","locationDate","getResponseHeader","solar_system_id","stationName","shipID","shipName","shipTypeID","station_id","stationLookup","always","reference","detach","fail","ship","shipDate","ship_item_id","ship_name","ship_type_id","typeLookup","online","characterStatus","typeID","destinationID","clear_waypoints","beginning","destination_id","clear_other_waypoints","add_to_beginning","headers","Authorization","X-User-Agent","targetID","target_id","eveStatus","idLookup","eveIDs","contentType","processData","characterLookup","eveID","async","corporationLookup","allianceLookup","searchString","categories","strict","universeJumps","universeKills","fullLookup","promise","Deferred","category","characterData","corporation_id","corporationData","corporation","alliance_id","allianceData","alliance","resolve","$clone","characterChange","mask","column","editing","sigEditing","signatureCount","pasteSignatures","processing","rowParse","scanner","columns","validScanGroups","validTypes","Gas Site","Data Site","Relic Site","Ore Site","Combat Site","Wormhole","Gasgebiet","Datengebiet","Reliktgebiet","Mineraliengebiet","Kampfgebiet","Wurmloch","ГАЗ: район добычи газа","ДАННЫЕ: район сбора данных","АРТЕФАКТЫ: район поиска артефактов","РУДА: район добычи руды","ОПАСНО: район повышенной опасности","Червоточина","scanGroup","parsePaste","paste","pasteIDs","removes","scan","clipboardData","getData","blur","lastIndex","redoItem","concat","serverStatus","players","times","abort","signatureTime","flareCount","flareTime","last_modified","commentCount","commentTime","appData","aSystems","slice","hasWormhole","hasInitial","hasSecondary","occupied","notify","history","replaceState","effects","bad","whClass","modifier","abs","statics","factionID","factions","regions","regionID","tutorial","introJs","setOptions","showStepNumbers","steps","querySelector","intro","exitOnEsc","exitOnOverlayClick","skipLabel","onchange","_currentStep","console","log","previousMask","stepFunc","_options","setOption","exiting","exit","goToStep","off","onexit","undoItem","graph","view","span","label","role","calc","d","r","getValue","sourceColumn","rows","reverse","google","visualization","DataView","DataTable","setColumns","selectHandler","selections","c","AreaChart","getElementById","isStacked","hAxis","textStyle","fontName","fontSize","showTextEvery","vAxis","viewWindowMode","viewWindow","min","maxValue","gridlineColor","pointSize","lineWidth","chartArea","legend","showColorCode","annotations","style","domain","focusTarget","events","addListener","charts","setOnLoadCallback","drawing","newView","elements","querySelectorAll","getAttribute","shipJumps","podKills","shipKills","npcKills","getElementsByClassName","jumps","setAttribute","pods","ships","npcs","attachedElements","count","next","max","lines","drawNodeLine","$node","nodeIndex","ceil","cellIndex","$connector","$parent","nodeCol","connectorCell","colSpan","parentIndex","newparentIndex","checkSystem","v","$connecte","me","tempCol","breaker","skip","nodes","cols","frigTypes","connections","topLevel","effectClass","chainNode","f","findLinks","parentID","childID","chainList","chainData","child","usedLinks","floor","random","typeBM","classBM","nth","chainLinks","guidance","findShortestPath","calcNode","nodeClass","nodeSecurity","leadsToPointer","rawMap","expires","system_id","ship_jumps","then","pod_kills","ship_kills","npc_kills","getCollapsedNodes","OrgChart","allowHtml","allowCollapse","CKConfig","skin","allowedContent","extraPlugins","enterMode","CKEDITOR","ENTER_BR","removeDialogTabs","autoGrow_onStartup","autoGrow_minHeight","toolbar_minToolbar","toolbar_maxToolbar","toolbar","smallToolbar","maximizedToolbar","fontSize_style","styles","font-size","overrides","attributes","cke","editor","domEvent","altKey","s","selected_ranges","getRanges","startContainer","parents","getParents","getFirst","getNext","selectElement","selectRanges","ev","definition","getContents","removeAllRanges","$this","instances","modifiedDate","createdDate","destroy","Delete","extractKeys","call","sorter","findPaths","end","infinity","Infinity","costs","0","predecessors","addToOpen","cost","vertex","bucket","shift","currentCost","adjacentNodes","totalCost","vertexCost","extractShortest","u","predecessor","path","Guidance","refreshTimer","$total","$ajax","refreshWindow","ids","$row","$col","modal","$menuItem","sortList","parentElement","Save","maskChange","slider","Reset","stats","system_visits","account","logins","lastLogin","username","owner","admin","img","optional","accordion","heightStyle","collapsible","step","slide","error","direction","Add","Remove","send","Create","selectmenu","total","openSignatureDialog","aSigWormholes","durationPicker","not","form","valid","signatureID_Alpha","signatureID_Numeric","existingSignature","findIndex","signatureType","wormholeName","signatureLength","wormholeType","signatureID2_Alpha","signatureID2_Numeric","wormholeName2","wormholeType2","wormholeLife","wormholeMass","signatureName"],"mappings":"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","file":"app.min.js","sourcesContent":["Object.sort = function(obj, prop) {\r\n\tvar swapped, prev;\r\n\tdo {\r\n\t\tswapped = false, prev = null;\r\n\t\tfor (var i in obj) {\r\n\t\t\tif (prev && Number(obj[i][prop]) < Number(obj[prev][prop])) {\r\n\t\t\t\tvar tmp = obj[i];\r\n\t\t\t\tobj[i] = obj[prev];\r\n\t\t\t\tobj[prev] = tmp;\r\n\t\t\t\tswapped = true;\r\n\t\t\t}\r\n\t\t\tprev = i;\r\n\t\t}\r\n\t} while (swapped);\r\n}\r\n\r\nObject.index = function(obj, prop, val, cs) {\r\n\tfor (var key in obj) {\r\n\t\tif (!cs && obj[key][prop] == val) {\r\n\t\t\treturn key;\r\n\t\t} else if (obj[key][prop] && obj[key][prop].toLowerCase() == val.toLowerCase()) {\r\n\t\t\treturn key;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nObject.find = function(obj, prop, val, cs) {\r\n\tfor (var key in obj) {\r\n\t\tif (!cs && obj[key][prop] == val) {\r\n\t\t\treturn obj[key];\r\n\t\t} else if (obj[key][prop] && obj[key][prop].toLowerCase() == val.toLowerCase()) {\r\n\t\t\treturn obj[key];\r\n\t\t}\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\nObject.maxTime = function(obj, prop) {\r\n\tvar maxTimeString = \"\", maxTime;\r\n\r\n\tfor (var key in obj) {\r\n\t\tif (!maxTime || maxTime < new Date(obj[key][prop])) {\r\n\t\t\tmaxTime = new Date(obj[key][prop]);\r\n\t\t\tmaxTimeString = obj[key][prop];\r\n\t\t}\r\n\t}\r\n\treturn maxTimeString;\r\n}\r\n\r\nObject.size = function(obj) {\r\n    var size = 0, key;\r\n    for (key in obj) {\r\n        if (obj.hasOwnProperty(key)) size++;\r\n    }\r\n\r\n    return size;\r\n};\r\n\r\nObject.time = function(obj) {\r\n\tvar dates = [], key;\r\n\tfor (key in obj) {\r\n\t\tdates.push(new Date(obj[key].time));\r\n\t}\r\n\r\n\treturn dates.length ? dates.sort()[dates.length -1].getTime() /1000 : 0;\r\n};\r\n\r\n(function($){\r\n    $.fn.serializeObject = function(){\r\n\r\n        var self = this,\r\n            json = {},\r\n            push_counters = {},\r\n            patterns = {\r\n                \"validate\": /^[a-zA-Z][a-zA-Z0-9_]*(?:\\[(?:\\d*|[a-zA-Z0-9_]+)\\])*$/,\r\n                \"key\":      /[a-zA-Z0-9_]+|(?=\\[\\])/g,\r\n                \"push\":     /^$/,\r\n                \"fixed\":    /^\\d+$/,\r\n                \"named\":    /^[a-zA-Z0-9_]+$/\r\n            };\r\n\r\n\r\n        this.build = function(base, key, value){\r\n            base[key] = value;\r\n            return base;\r\n        };\r\n\r\n        this.push_counter = function(key){\r\n            if(push_counters[key] === undefined){\r\n                push_counters[key] = 0;\r\n            }\r\n            return push_counters[key]++;\r\n        };\r\n\r\n        $.each($(this).serializeArray(), function(){\r\n\r\n            // skip invalid keys\r\n            if(!patterns.validate.test(this.name)){\r\n                return;\r\n            }\r\n\r\n            var k,\r\n                keys = this.name.match(patterns.key),\r\n                merge = this.value,\r\n                reverse_key = this.name;\r\n\r\n            while((k = keys.pop()) !== undefined){\r\n\r\n                // adjust reverse_key\r\n                reverse_key = reverse_key.replace(new RegExp(\"\\\\[\" + k + \"\\\\]$\"), '');\r\n\r\n                // push\r\n                if(k.match(patterns.push)){\r\n                    merge = self.build([], self.push_counter(reverse_key), merge);\r\n                }\r\n\r\n                // fixed\r\n                else if(k.match(patterns.fixed)){\r\n                    merge = self.build([], k, merge);\r\n                }\r\n\r\n                // named\r\n                else if(k.match(patterns.named)){\r\n                    merge = self.build({}, k, merge);\r\n                }\r\n            }\r\n\r\n            json = $.extend(true, json, merge);\r\n        });\r\n\r\n        return json;\r\n    };\r\n})(jQuery);\r\n\r\nvar numFormat = function(num) {\r\n\t//Seperates the components of the number\r\n\tvar n = num.toString().split(\".\");\r\n\t//Comma-fies the first part\r\n\tn[0] = n[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\r\n\t//Combines the two sections\r\n\treturn n.join(\".\");\r\n};\r\n\r\nvar letterToNumbers = function(string) {\r\n    string = string.toUpperCase();\r\n    var letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', sum = 0, i;\r\n    for (i = 0; i < string.length; i++) {\r\n        sum += Math.pow(letters.length, i) * (letters.indexOf(string.substr(((i + 1) * -1), 1)) + 1);\r\n    }\r\n    return sum;\r\n};\r\n\r\nvar sigFormat = function(input, type) {\r\n\tif (!input) return \"\";\r\n\r\n\tvar alpha = /^[a-zA-Z]+$/;\r\n\tvar numeric = /^[0-9]+$/;\r\n\tvar format = type == \"type\" ? options.chain.typeFormat || \"\" : options.chain.classFormat || \"\";\r\n\r\n\tfor (var x = 0, l = format.length; x < l; x++) {\r\n\t\tif (format[x].match(alpha)) {\r\n\t\t\tif (format[x].toUpperCase() == \"B\" && input == \"a\") {\r\n\t\t\t\treturn \"\";\r\n\t\t\t} else {\r\n\t\t\t\tif (format[x] == format[x].toUpperCase()) {\r\n\t\t\t\t\tformat = format.substr(0, x) + input.toUpperCase() + format.substr(x + 1, l);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tformat = format.substr(0, x) + input + format.substr(x + 1, l);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (format[x].match(numeric)) {\r\n\t\t\tif (format[x] == 2 && input == \"a\") {\r\n\t\t\t\treturn \"\";\r\n\t\t\t} else {\r\n\t\t\t\tformat = format.substr(0, x) + letterToNumbers(input) + format.substr(x +1, l);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn format;\r\n};\r\n\r\nvar sigClass = function(name, type) {\r\n\tvar id = $.map(tripwire.systems, function(system, id) { return system.name == name ? id : null })[0];\r\n\tvar system = {\r\n\t\t\"name\": name,\r\n\t\t\"class\": id ? tripwire.systems[id].class : null,\r\n\t\t\"security\":  id ? tripwire.systems[id].security : null,\r\n\t\t\"type\": type};\r\n\tvar systemType = null;\r\n\r\n\tif (system.class == 6 || system.name == \"Class-6\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 6\"))\r\n\t\tsystemType = \"C6\";\r\n\telse if (system.class == 5 || system.name == \"Class-5\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 5\"))\r\n\t\tsystemType = \"C5\";\r\n\telse if (system.class == 4 || system.name == \"Class-4\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 4\"))\r\n\t\tsystemType = \"C4\";\r\n\telse if (system.class == 3 || system.name == \"Class-3\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 3\"))\r\n\t\tsystemType = \"C3\";\r\n\telse if (system.class == 2 || system.name == \"Class-2\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 2\"))\r\n\t\tsystemType = \"C2\";\r\n\telse if (system.class == 1 || system.name == \"Class-1\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Class 1\"))\r\n\t\tsystemType = \"C1\";\r\n\telse if (system.security >= 0.45 || system.name == \"High-Sec\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"High-Sec\" && !system.security))\r\n\t\tsystemType = \"HS\";\r\n\telse if (system.security > 0.0 || system.name == \"Low-Sec\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Low-Sec\" && !system.security))\r\n\t\tsystemType = \"LS\";\r\n\telse if ((system.security <= 0.0 && system.security != null) || system.name == \"Null-Sec\" || (typeof(tripwire.wormholes[system.type]) != \"undefined\" && tripwire.wormholes[system.type].leadsTo == \"Null-Sec\"))\r\n\t\tsystemType = \"NS\";\r\n\r\n\treturn systemType;\r\n};\r\n\r\nvar isEmpty = function(obj) {\r\n    for(var key in obj) {\r\n        if(obj.hasOwnProperty(key))\r\n            return false;\r\n    }\r\n    return true;\r\n};\r\n\r\nvar getCookie = function(c_name) {\r\n\tvar c_value = document.cookie;\r\n\r\n\tvar c_start = c_value.indexOf(\" \" + c_name + \"=\");\r\n\tif (c_start == -1) {\r\n\t\tc_start = c_value.indexOf(c_name + \"=\");\r\n\t}\r\n\r\n\tif (c_start == -1) {\r\n\t\tc_value = null;\r\n\t} else {\r\n\t\tc_start = c_value.indexOf(\"=\", c_start) + 1;\r\n\t\tvar c_end = c_value.indexOf(\";\", c_start);\r\n\r\n\t\tif (c_end == -1) {\r\n\t\t\tc_end = c_value.length;\r\n\t\t}\r\n\r\n\t\tc_value = unescape(c_value.substring(c_start, c_end));\r\n\t}\r\n\r\n\treturn c_value;\r\n};\r\n\r\nvar setCookie = function(c_name, value, exdays) {\r\n\tvar exdate = new Date();\r\n\texdate.setDate(exdate.getDate() + exdays);\r\n\tvar c_value = escape(value) + ((exdays == null) ? \"\" : \"; expires=\"+exdate.toUTCString());\r\n\r\n\tdocument.cookie = c_name + \"=\" + c_value + \";\" + (document.location.protocol == \"https:\" ? \"secure;\" : \"\");\r\n};\r\n\r\n// Global CSS class change event\r\n(function($) {\r\n    var originalAddClassMethod = $.fn.addClass;\r\n\tvar originalRemoveClassMethod = $.fn.removeClass;\r\n\r\n    $.fn.addClass = function(className) {\r\n        // Execute the original method.\r\n        var result = originalAddClassMethod.apply(this, arguments);\r\n\r\n        // trigger a custom event\r\n        this.trigger('classchange', className);\r\n\r\n        // return the original result\r\n        return result;\r\n    }\r\n\r\n\t$.fn.removeClass = function(className) {\r\n        // Execute the original method.\r\n        var result = originalRemoveClassMethod.apply(this, arguments);\r\n\r\n        // trigger a custom event\r\n        this.trigger('classchange', className);\r\n\r\n        // return the original result\r\n        return result;\r\n    }\r\n})(jQuery);\r\n","var viewingSystem = $(\"meta[name=system]\").attr(\"content\");\r\nvar viewingSystemID = $(\"meta[name=systemID]\").attr(\"content\");\r\nvar server = $(\"meta[name=server]\").attr(\"content\");\r\nvar app_name = $(\"meta[name=app_name]\").attr(\"content\");\r\nvar version = $(\"meta[name=version]\").attr(\"content\");\r\n\r\n// Page cache indicator\r\nif (getCookie(\"loadedFromBrowserCache\") == \"true\") {\r\n\t$(\"#pageTime\").html(\"Page is Cached\");\r\n}\r\n\r\n// setCookie('loadedFromBrowserCache', true);\r\n\r\n// Use this to test performance of javascript code lines\r\n// var startTime = window.performance.now();\r\n// console.log(\"stint: \"+ (window.performance.now() - startTime));\r\n","var options = new function() {\r\n\tvar localOverrides = [\"grid\"];\r\n\tvar localOptions = JSON.parse(localStorage.getItem(\"tripwire_options\"));\r\n\tvar saveTimer;\r\n\r\n\tthis.userID = init.userID;\r\n\tthis.character = {id: init.characterID, name: init.characterName};\r\n\tthis.background = null;\r\n\tthis.uiscale = 1.0;\r\n\tthis.favorites = [];\r\n\tthis.grid = {};\r\n\tthis.tracking = {active: \"new\"};\r\n\tthis.masks = {active: init.corporationID + \".2\"};\r\n\tthis.chain = {typeFormat: null, classFormat: null, gridlines: true, active: 0, tabs: [], \"node-reference\": \"type\", zoom: 1.0};\r\n\tthis.signatures = {editType: \"unknown\", copySeparator: \",\", pasteLife: 72, alignment: {sigID: \"centerAlign\", sigType: \"centerAlign\", sigAge: \"centerAlign\", leadsTo: \"centerAlign\", sigLife: \"centerAlign\", sigMass: \"centerAlign\"}};\r\n\tthis.buttons = {follow: false, chainWidget: {viewing: false, favorites: false}, signaturesWidget: {autoMapper: false}};\r\n\r\n\tthis.saveDelay = function(delay) {\r\n\t\tif (saveTimer) clearTimeout(saveTimer);\r\n\r\n\t\tsaveTimer = setTimeout(\"options.save()\", delay);\r\n\t};\r\n\r\n\t// Saves options in both cookie and database\r\n\tthis.save = function() {\r\n\t\tvar options = JSON.stringify(window.options.get());\r\n\r\n\t\tlocalStorage.setItem(\"tripwire_options\", options);\r\n\r\n\t\treturn $.ajax({\r\n\t\t\turl: \"options.php\",\r\n\t\t\tdata: {mode: \"set\", options: options},\r\n\t\t\ttype: \"POST\",\r\n\t\t\tdataType: \"JSON\"\r\n\t\t});\r\n\t};\r\n\r\n\t// Loads options via passed object else cookie\r\n\tthis.load = function(data) {\r\n\t\tif (data && typeof(data) != \"undefined\") {\r\n\t\t\tthis.set(this, data);\r\n\t\t} else if (localOptions) {\r\n\t\t\tthis.set(this, localOptions);\r\n\t\t}\r\n\r\n\t\tthis.apply();\r\n\t};\r\n\r\n\t// Gets options from this by exluding types == function\r\n\tthis.get = function() {\r\n\t\tvar data = {};\r\n\r\n\t\tfor (var x in this) {\r\n\t\t\tif (typeof(this[x]) != \"function\") {\r\n\t\t\t\tdata[x] = this[x];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t};\r\n\r\n\t// Sets this from passed object\r\n\tthis.set = function(local, data) {\r\n\t\tfor (var prop in data) {\r\n\t\t\tif (data[prop] && data[prop].constructor && data[prop].constructor === Object) {\r\n\t\t\t\tif (local) {\r\n\t\t\t\t\tthis.set(local[prop], data[prop]);\r\n\t\t\t\t}\r\n\t\t\t} else if (local && typeof(local[prop]) != \"undefined\") {\r\n\t\t\t\tlocal[prop] = data[prop];\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis.reset = function() {\r\n\t\tfor (var x in this) {\r\n\t\t\tif (typeof(this[x]) != \"function\") {\r\n\t\t\t\tthis[x] = JSON.parse(JSON.stringify(this.reset.defaults[x]));\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// Applies settings\r\n\tthis.apply = function() {\r\n\t\t// Local browser overrides\r\n\t\tif (localOptions) {\r\n            for (key in localOverrides) {\r\n                this[localOverrides[key]] = localOptions[localOverrides[key]];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Grid layout (detect old IGB setting options)\r\n\t\tif (this.grid.hasOwnProperty(\"oog\") && !isEmpty(this.grid.oog)) {\r\n\t\t\t$.each(this.grid.oog, function() {\r\n\t\t\t\t$(\"#\"+this.id).attr({\"data-col\": this.col, \"data-row\": this.row, \"data-sizex\": this.size_x, \"data-sizey\": this.size_y})\r\n\t\t\t\t\t.css({width: this.width, height: this.height});\r\n\t\t\t});\r\n\t\t} else if (!isEmpty(this.grid)) {\r\n\t\t\t$.each(this.grid, function() {\r\n\t\t\t\t$(\"#\"+this.id).attr({\"data-col\": this.col, \"data-row\": this.row, \"data-sizex\": this.size_x, \"data-sizey\": this.size_y})\r\n\t\t\t\t\t.css({width: this.width, height: this.height});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Make sure favorites are all ints and not strings\r\n\t\tthis.favorites = $.map(this.favorites, function(favorite) {\r\n\t\t\treturn parseInt(favorite);\r\n\t\t});\r\n\r\n\t\t// Buttons\r\n\t\tif (this.buttons.follow) $(\"#follow\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.home) $(\"#home\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.kspace) $(\"#k-space\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.viewing) $(\"#show-viewing\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.favorites) $(\"#show-favorite\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.evescout) $(\"#eve-scout\").addClass(\"active\");\r\n\t\tif ($.inArray(parseInt(viewingSystemID), this.favorites) !== -1) $(\"#system-favorite\").attr(\"data-icon\", \"star\").addClass(\"active\");\r\n\t\tif (this.buttons.signaturesWidget.autoMapper) $(\"#toggle-automapper\").addClass(\"active\");\r\n\r\n\t\t// UI Scale\r\n\t\tif (this.uiscale) {\r\n\t\t\t$(\"body\").css(\"zoom\", this.uiscale);\r\n\t\t}\r\n\r\n\t\t// Chain zoom\r\n\t\tif (this.chain.zoom) {\r\n\t\t\t$(\"#chainParent\").css(\"zoom\", this.chain.zoom);\r\n\t\t}\r\n\r\n\t\t// Background\r\n\t\tif (this.background) {\r\n\t\t\tvar a = $('<a>', { href:this.background } )[0];\r\n\t\t\t$(\"#wrapper\").attr(\"style\", \"background-image: url(https://\" + a.hostname + a.pathname + a.search + \");\");\r\n\t\t} else {\r\n\t\t\t$(\"#wrapper\").attr(\"style\", \"\");\r\n\t\t}\r\n\r\n\t\t// Characters in Options\r\n\t\t$(\"#dialog-options #characters\").html(\"<img src='https://image.eveonline.com/Character/\"+init.characterID+\"_64.jpg' />\");\r\n\r\n\t\t// Active mask\r\n\t\t$(\"#dialog-options input[name='mask']\").filter(\"[value='\"+this.masks.active+\"']\").attr(\"checked\", true);\r\n\r\n\t\t// Chain tabs\r\n\t\t$(\"#chainTabs\").html(\"\");\r\n\t\tfor (var x in this.chain.tabs) {\r\n\t\t\tif (this.chain.tabs[x]) {\r\n\t\t\t\tvar $tab = $(\"#chainTab .tab\").clone();\r\n\r\n\t\t\t\t$tab.attr(\"id\", x).find(\".name\").data(\"tab\", this.chain.tabs[x].systemID).html(this.chain.tabs[x].name);\r\n\t\t\t\tif (x == this.chain.active) { $tab.addClass(\"current\"); }\r\n\r\n\t\t\t\t$(\"#chainTabs\").append($tab);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Draw chain if Tripwire is initialized\r\n\t\tif (typeof(tripwire) !== \"undefined\") {\r\n\t\t\tchain.redraw();\r\n\t\t}\r\n\t};\r\n\r\n\tthis.reset.defaults = JSON.parse(JSON.stringify(this.get()));\r\n\tthis.load(init && init.options ? init.options : null);\r\n}\r\n","var grid = $(\".gridster ul\").gridster({\r\n\twidget_selector: \"li.gridWidget\",\r\n\tavoid_overlapped_widgets: false,\r\n\twidget_base_dimensions: [50, 50],\r\n\twidget_margins: [5, 5],\r\n\tautogrow_cols: true,\r\n\thelper: \"clone\",\r\n\tdraggable: {\r\n\t\tstart: function(e, ui) {\r\n\t\t\t$(\"div.gridster\").width($(\"div.gridster ul\").width());\r\n\t\t}\r\n\t},\r\n\tresize: {\r\n    \tenabled: true,\r\n    \thandle_class: \"grid-resize\",\r\n    \tmax_size: [30, 30],\r\n    \tmin_size: [4, 4],\r\n    \tstart: function(e) {\r\n    \t\t$(\"div.gridster\").width($(\"div.gridster ul\").width());\r\n    \t},\r\n    \tstop: function(e, ui, $widget) {\r\n    \t\t//var width = parseInt($(\".gridster\").css(\"margin-left\")) + this.container_width;\r\n    \t\t//$(\"#wrapper\").css({width: width + \"px\"})\r\n    \t\tswitch ($widget.attr(\"id\")) {\r\n    \t\t\tcase \"infoWidget\":\r\n    \t\t\t\tsetTimeout(\"activity.redraw();\", 300);\r\n    \t\t\t\tbreak;\r\n    \t\t}\r\n    \t}\r\n\t},\r\n\tserialize_params: function($w, wgd) {\r\n\t\treturn {\r\n\t\t\tid: $w.attr(\"id\"),\r\n\t\t\tcol: wgd.col,\r\n\t\t\trow: wgd.row,\r\n\t\t\tsize_x: wgd.size_x,\r\n\t\t\tsize_y: wgd.size_y,\r\n\t\t\twidth: $w.width(),\r\n\t\t\theight: $w.height()\r\n\t\t}\r\n\t}\r\n}).data(\"gridster\").disable();\r\n\r\ngrid.disable_resize();\r\n$(\".grid-resize\").addClass(\"hidden\").attr(\"data-icon\", \"resize\");\r\n\r\n$(\".gridster\").css({visibility: \"visible\"});\r\n$(\".gridster > *\").addClass(\"gridster-transition\");\r\n\r\n$(\"#layout\").click(function() {\r\n\tif (!$(this).hasClass(\"active\")) {\r\n\t\tgrid.enable();\r\n\t\tgrid.enable_resize();\r\n\t\t$(\".grid-resize\").removeClass(\"hidden\");\r\n\r\n\t\t$(this).addClass(\"active\");\r\n\t} else {\r\n\t\tgrid.disable();\r\n\t\tgrid.disable_resize();\r\n\t\t$(\".grid-resize\").addClass(\"hidden\");\r\n\r\n\t\t$(this).removeClass(\"active\");\r\n\r\n\t\toptions.grid = grid.serialize();\r\n\r\n\t\toptions.save();\r\n\t}\r\n});\r\n","var tripwire = new function() {\r\n    this.timer, this.xhr;\r\n\tthis.version = version;\r\n\tthis.client = {signatures: {}, wormholes: {}};\r\n\tthis.server = {signatures: {}, wormholes: {}};\r\n\tthis.signatures = {list: {}, undo: JSON.parse(sessionStorage.getItem(\"tripwire_undo\")) || {}, redo: JSON.parse(sessionStorage.getItem(\"tripwire_redo\")) || {}};\r\n\tthis.activity = {};\r\n\tthis.data = {tracking: {}, esi: {}};\r\n\tthis.refreshRate = 5000;\r\n\tthis.connected = true;\r\n\tthis.ageFormat = \"HM\";\r\n\tthis.instance = window.name ? window.name : (new Date().getTime() / 1000, window.name = new Date().getTime() / 1000);\r\n\r\n    // Command to start/stop tripwire updates\r\n\t// ToDo: Include API and Server timers\r\n\tthis.stop = function() {\r\n\t\tclearTimeout(this.timer);\r\n\t\treturn this.timer;\r\n\t};\r\n\r\n\tthis.start = function() {\r\n\t\treturn this.sync();\r\n\t}\r\n\r\n    // Command to change Age format\r\n\t// ToDo: Cookie change to keep\r\n\tthis.setAgeFormat = function(format) {\r\n\t\tvar format = typeof(format) !== 'undefined' ? format : this.ageFormat;\r\n\r\n\t\t$(\"span[data-age]\").each(function() {\r\n\t\t\t$(this).countdown(\"option\", {format: format});\r\n\t\t});\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n    this.serverTime = function() {\r\n\t\tthis.time;\r\n\r\n\t\tthis.serverTime.getTime = function() {\r\n\t\t\treturn tripwire.serverTime.time;\r\n\t\t}\r\n\t}\r\n    this.serverTime();\r\n\r\n    // Handles putting chain together\r\n\tthis.chainMap = function() {\r\n\t\tthis.chainMap.parse = function(data) {\r\n\t\t\tchain.draw(data);\r\n\t\t}\r\n\t}\r\n    this.chainMap();\r\n\r\n    this.pastEOL = function() {\r\n\t\tvar options = {since: $(this).countdown('option', 'until'), format: \"HM\", layout: \"-{hnn}{sep}{mnn}&nbsp;\"};\r\n\t\t$(this).countdown(\"option\", options);\r\n\t}\r\n\r\n    // Handles WH Type hover-over tooltip\r\n\t// ToDo: Use native JS\r\n\tthis.whTooltip = function(sig) {\r\n\t\tif (viewingSystemID == sig.systemID) {\r\n\t\t\tif ($.inArray(sig.type, $.map(tripwire.wormholes, function(item, index) { return index;})) >= 0) {\r\n\t\t\t\tvar type = sig.type;\r\n\t\t\t\tvar tooltip = '';\r\n\t\t\t} else {\r\n\t\t\t\tvar type = sig.sig2Type;\r\n\t\t\t\tvar tooltip = \"<b>Type:</b> \"+type+\"<br/>\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif ($.inArray(sig.sig2Type, $.map(tripwire.wormholes, function(item, index) { return index;})) >= 0) {\r\n\t\t\t\tvar type = sig.sig2Type;\r\n\t\t\t\tvar tooltip = '';\r\n\t\t\t} else {\r\n\t\t\t\tvar type = sig.type;\r\n\t\t\t\tvar tooltip = \"<b>Type:</b> \"+type+\"<br/>\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($.inArray(type, $.map(tripwire.wormholes, function(item, index) { return index;})) >= 0) {\r\n\t\t\tvar whType = true;\r\n\t\t} else {\r\n\t\t\tvar whType = false;\r\n\t\t}\r\n\r\n\t\ttooltip += \"<b>Life:</b> \"+(whType?tripwire.wormholes[type].life:\"Unknown\")+\"<br/>\";\r\n\r\n\t\tif (whType) {\r\n\t\t\tswitch (tripwire.wormholes[type].leadsTo.split(\" \")[0]) {\r\n\t\t\t\tcase 'High-Sec':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='hisec'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Low-Sec':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='lowsec'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Null-Sec':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='nullsec'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Class':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='wh'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\ttooltip += \"<b>Leads To:</b> <span>Unknown</span><br/>\";\r\n\t\t}\r\n\r\n\t\ttooltip += \"<b>Max Mass</b>: \"+(whType?numFormat(tripwire.wormholes[type].mass):\"Unknown\")+\" Kg<br/>\";\r\n\r\n\t\ttooltip += \"<b>Max Jumpable</b>: \"+(whType?numFormat(tripwire.wormholes[type].jump):\"Unknown\")+\" Kg<br/>\";\r\n\r\n\t\treturn tooltip;\r\n\t}\r\n\r\n\t// Handles Age hover-over tooltip\r\n\t// ToDo: Use native JS\r\n\tthis.ageTooltip = function(sig) {\r\n\t\t// var date = new Date(sig.lifeTime);\r\n\t\t// var localOffset = date.getTimezoneOffset() * 60000;\r\n\t\t// date = new Date(date.getTime() + localOffset);\r\n        var date = new Date(sig.lifeTime);\r\n\r\n\t\tvar tooltip = \"<table class=\\\"age-tooltip-table\\\"><tr>\"\r\n        + \"<th>Created:</th><td>\"+(date.getMonth()+1)+\"/\"+date.getDate()+\" \"+(date.getHours() < 10?'0':'')+date.getHours()+\":\"+(date.getMinutes() < 10?'0':'')+date.getMinutes()+\"</td>\"\r\n        + \"<td>\"+sig.createdByName.replace(/'/g, '&#39;').replace(/\"/g, '&#34;')+\"</td>\"\r\n        + \"</tr>\";\r\n\r\n\t\tif (sig.lifeTime != sig.modifiedTime) {\r\n\t\t\tdate = new Date(sig.modifiedTime);\r\n\t\t\t// localOffset = date.getTimezoneOffset() * 60000;\r\n\t\t\t// date = new Date(date.getTime() + localOffset);\r\n      \r\n\t\t\ttooltip += \"<tr><th>Last Modified:</th><td>\"+(date.getMonth()+1)+\"/\"+date.getDate()+\" \"+(date.getHours() < 10?'0':'')+date.getHours()+\":\"+(date.getMinutes() < 10?'0':'')+date.getMinutes()+\"</td>\"\r\n          + \"<td>\"+sig.modifiedByName.replace(/'/g, '&#39;').replace(/\"/g, '&#34;')+\"</td>\"\r\n          + \"</tr>\";\r\n\t\t}\r\n\r\n\t\ttooltip += \"</table>\";\r\n\r\n\t\treturn tooltip;\r\n\t}\r\n\r\n    this.refresh = function(mode, data, successCallback, alwaysCallback) {\r\n\t\tvar mode = mode || 'refresh';\r\n\r\n\t\tthis.sync(mode, data, successCallback, alwaysCallback);\r\n\t}\r\n}\r\n","$(\"body\").on(\"click\", \"a[href^='.?system=']\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tvar system = $(this).attr(\"href\").replace(\".?system=\", \"\");\r\n\tvar systemID = Object.index(tripwire.systems, \"name\", system);\r\n\r\n\ttripwire.systemChange(systemID);\r\n});\r\n\r\n$(\"body\").on(\"submit\", \"#systemSearch\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tvar system = $(this).find(\"[name='system']\").val();\r\n\tvar systemID = Object.index(tripwire.systems, \"name\", system, true) || false;\r\n\r\n\tif (systemID !== false) {\r\n\t\ttripwire.systemChange(systemID);\r\n\t\t$(this).find(\"[name='system']\").val(\"\");\r\n\t\t$(\"#search\").click();\r\n\t}\r\n});\r\n\r\n$(\"body\").on(\"click\", \"#undo:not(.disabled)\", function() {\r\n\ttripwire.undo();\r\n});\r\n\r\n$(\"body\").on(\"click\", \"#redo:not(.disabled)\", function() {\r\n\ttripwire.redo();\r\n});\r\n\r\n// Chain map zooming (Gets funky if you push things too far)\r\n$(\"#chainParent\").on(\"mousewheel\", function(e) {\r\n\te.preventDefault();\r\n\tvar zoom = parseFloat($(\"#chainParent\").css(\"zoom\")) || 1.0;\r\n\tvar min = 0.6;\r\n\tvar max = 2.0;\r\n\r\n    if (e.originalEvent.wheelDelta / 120 > 0 && zoom < max) {\r\n\t\t$(\"#chainParent\").css(\"zoom\", zoom + 0.1);\r\n    } else if (e.originalEvent.wheelDelta / 120 < 0 && zoom > min) {\r\n\t\t$(\"#chainParent\").css(\"zoom\", zoom - 0.1);\r\n    }\r\n\r\n\t// Show the reset zoom button for awhile\r\n\t$(\"#chain-zoom-reset\").fadeIn(200);\r\n\tif (this.timeout) clearTimeout(this.timeout);\r\n\tthis.timeout = setTimeout('$(\"#chain-zoom-reset\").fadeOut(200);', 3000);\r\n\r\n\t// Save options\r\n\toptions.chain.zoom = parseFloat($(\"#chainParent\").css(\"zoom\"));\r\n\toptions.saveDelay(2000);\r\n});\r\n\r\n$(\"#chain-zoom-reset\").on(\"click\", function() {\r\n\t$(\"#chainParent\").css(\"zoom\", 1);\r\n\toptions.chain.zoom = 1;\r\n\toptions.saveDelay(2000);\r\n});\r\n\r\n$(document).keydown(function(e)\t{\r\n\t//Abort - user is in input or textarea\r\n\tif ($(document.activeElement).is(\"textarea, input\")) return;\r\n\r\n\t// Ctrl key hooks\r\n\tif (e.metaKey || e.ctrlKey) {\r\n\r\n\t\tif (e.keyCode === 89 && !$(\"#redo\").hasClass(\"disabled\")) {\r\n\t\t\t// Ctrl-y redo hook\r\n\t\t\te.preventDefault();\r\n\t\t\t$(\"#redo\").click();\r\n\t\t\tNotify.trigger(\"Redoing last undo\");\r\n\t\t} else if (e.keyCode === 90 && !$(\"#undo\").hasClass(\"disabled\")) {\r\n\t\t\t// Ctrl-z undo hook\r\n\t\t\te.preventDefault();\r\n\t\t\t$(\"#undo\").click();\r\n\t\t\tNotify.trigger(\"Undoing last action\");\r\n\t\t} else if (e.keyCode === 65) {\r\n\t\t\t// Ctrl-a select all (signatures) hook\r\n\t\t\te.preventDefault();\r\n\t\t\t$(\"#sigTable tbody tr\").addClass(\"selected\");\r\n\t\t\t$(\"#signaturesWidget #delete-signature\").trigger(\"delete:refresh\");\r\n\t\t} else if (e.keyCode === 67) {\r\n\t\t\t// Ctrl-c copy selected signatures hook\r\n\t\t\tif (window.getSelection().toString() === \"\") {\r\n\t\t\t\tvar output = \"\";\r\n\t\t\t\t$(\"#sigTable tbody tr.selected\").each(function(row) {\r\n\t\t\t\t\tvar signature = tripwire.client.signatures[$(this).data(\"id\")];\r\n\t\t\t\t\tvar row = [];\r\n\r\n\t\t\t\t\tif (signature.signatureID) {\r\n\t\t\t\t\t\trow.push(signature.signatureID.substring(0, 3).toUpperCase() + \"-\" + (signature.signatureID.substring(3, 6) || \"###\"));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trow.push(\"null\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trow.push(signature.type);\r\n\t\t\t\t\tif (signature.type === \"wormhole\") {\r\n\t\t\t\t\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n\t\t\t\t\t\tvar otherSignature = signature.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t\t\trow.push(wormhole.type || \"null\" );\r\n\t\t\t\t\t\trow.push(tripwire.systems[signature.systemID] ? tripwire.systems[signature.systemID].name : tripwire.aSigSystems[signature.systemID]);\r\n\t\t\t\t\t\trow.push(tripwire.systems[otherSignature.systemID] ? tripwire.systems[otherSignature.systemID].name : tripwire.aSigSystems[otherSignature.systemID]);\r\n\t\t\t\t\t\trow.push(wormhole.life);\r\n\t\t\t\t\t\trow.push(wormhole.mass);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trow.push(signature.name);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trow.push(signature.createdByName);\r\n\t\t\t\t\trow.push(signature.lifeTime);\r\n\t\t\t\t\trow.push(signature.lifeLength);\r\n\t\t\t\t\trow.push(signature.lifeLeft);\r\n\t\t\t\t\trow.push(signature.modifiedByName);\r\n\t\t\t\t\trow.push(signature.modifiedTime);\r\n\t\t\t\t\toutput += row.join(options.signatures.copySeparator) + \"\\r\\n\";\r\n\t\t\t\t});\r\n\t\t\t\t$(\"#clipboard\").text(output);\r\n\t\t\t\t$(\"#clipboard\").focus();\r\n\t\t\t\t$(\"#clipboard\").select();\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\t// delete key keyhooks\r\n\t\tif (e.keyCode == 46 && $(\"#sigTable tr.selected\").length > 0) {\r\n\t\t\t$(\"#delete-signature\").click();\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// $(\"#APIclock\").knob({angleArc: 359.9, height: 20, width: 20, max: 60, readOnly: true, displayInput: false, fgColor: \"#CCC\", bgColor: \"#666\"});\r\n\r\n$(\"#follow\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\toptions.buttons.follow = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n})\r\n\r\n$(\"#show-viewing\").click(function() {\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\tchain.redraw();\r\n\r\n\toptions.buttons.chainWidget.viewing = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n});\r\n\r\n$(\"#show-favorite\").click(function() {\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\tchain.redraw();\r\n\r\n\toptions.buttons.chainWidget.favorites = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n});\r\n\r\n$(\"#system-favorite\").click(function() {\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\").attr(\"data-icon\", \"star-empty\");\r\n\r\n\t\toptions.favorites.splice(options.favorites.indexOf(parseInt(viewingSystemID)), 1);\r\n\t} else {\r\n\t\t$(this).attr(\"data-icon\", \"star\").addClass(\"active\");\r\n\r\n\t\toptions.favorites.push(parseInt(viewingSystemID));\r\n\t}\r\n\r\n\tif ($(\"#show-favorite\").hasClass(\"active\"))\r\n\t\tchain.redraw();\r\n\r\n\toptions.save();\r\n});\r\n\r\n$(\"#search\").click(function(e) {\r\n\t$(\"#searchSpan\").toggle();\r\n\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\");\r\n\t\tif (tripwire.client.EVE && tripwire.client.EVE.systemName)\r\n\t\t\t$(\"#currentSpan\").show();\r\n\t} else {\r\n\t\t$(this).addClass(\"active\");\r\n\t\t$(\"#currentSpan\").hide();\r\n\r\n\t\t$(\"#searchSpan input[name=system]\").focus().select();\r\n\t}\r\n});\r\n\r\n$(\"#toggle-automapper\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\");\r\n\t} else {\r\n\t\t$(this).addClass(\"active\");\r\n\t}\r\n\r\n\toptions.buttons.signaturesWidget.autoMapper = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n});\r\n\r\n$(\"#track\").on(\"click\", \".tracking-clone\", function() {\r\n\tvar characterID =$(this).attr(\"data-characterid\");\r\n\t$(\"#tracking .tracking-clone\").removeClass(\"active\");\r\n\r\n\tif (options.tracking.active == characterID) {\r\n\t\toptions.tracking.active = null;\r\n\t\ttripwire.EVE(false, true);\r\n\t\t$(\"#removeESI\").attr(\"disabled\", \"disabled\");\r\n\t} else {\r\n\t\toptions.tracking.active = characterID;\r\n\r\n\t\tif (tripwire.esi.characters[options.tracking.active]) {\r\n\t\t\t$(\"#tracking .tracking-clone[data-characterid='\"+ options.tracking.active +\"']\").addClass(\"active\");\r\n\t\t\ttripwire.EVE(tripwire.esi.characters[options.tracking.active], true);\r\n\t\t}\r\n\r\n\t\t$(\"#removeESI\").removeAttr(\"disabled\");\r\n\t}\r\n\r\n\toptions.save();\r\n});\r\n\r\n$(\"#login\").on(\"click\", \"#removeESI\", function() {\r\n\tvar characterID = options.tracking.active;\r\n\r\n\toptions.tracking.active = null;\r\n\ttripwire.EVE(false, true);\r\n\toptions.save();\r\n\r\n\t$(\"#tracking .tracking-clone[data-characterid='\"+ characterID +\"']\").remove();\r\n\r\n\t$(\"#removeESI\").attr(\"disabled\", \"disabled\");\r\n\ttripwire.data.esi.delete = characterID;\r\n});\r\n\r\n$(\"#user\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\");\r\n\r\n\t\t$(\"#login > #panel\").css({display: \"none\"});\r\n\r\n\t\t//$(\"#wrapper\").unbind(\"click\");\r\n\t} else {\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\t\t$(\"#login > #panel\").css({display: \"inline\"});\r\n\t\t$(\"#loginForm input[name=username]\").focus().select();\r\n\r\n\t\t// Click outside closes\r\n\t\t$(\"#wrapper\").click(function(e) {\r\n\t\t\t$(\"#login > #panel\").css({display: \"none\"});\r\n\t\t\t$(\"#user\").removeClass(\"active\");\r\n\t\t});\r\n\r\n\t\t$(\"#login\").click(function(e) {\r\n\t\t\te.stopPropagation();\r\n\t\t})\r\n\t}\r\n});\r\n\r\n$(\"#logout\").click(function() {\r\n\twindow.location = \"logout.php\";\r\n});\r\n\r\nvar Notify = new function() {\r\n\tthis.trigger = function(content, color, stick, id) {\r\n\t\tvar color = typeof(color) !== \"undefined\" ? color : \"blue\";\r\n\t\tvar stick = typeof(stick) !== \"undefined\" ? stick : 10000;\r\n\t\tvar id = typeof(id) !== \"undefined\" ? id : null;\r\n\r\n\t\tnew jBox(\"Notice\", {\r\n\t\t\tid: id,\r\n\t\t\tcontent: content,\r\n\t\t\toffset: {y: 35},\r\n\t\t\tanimation: \"flip\",\r\n\t\t\tcolor: color,\r\n\t\t\tautoClose: stick\r\n\t\t});\r\n\t}\r\n}\r\n\r\n// Init valdiation tooltips\r\nvar ValidationTooltips = new jBox(\"Tooltip\", {\r\n\ttrigger: null,\r\n\taddClass: \"validation-tooltip\",\r\n\tanimation: \"flip\",\r\n\tfade: 0\r\n});\r\n\r\nvar Tooltips = new jBox(\"Tooltip\", {\r\n\tattach: $(\"[data-tooltip]\"),\r\n\tgetContent: \"data-tooltip\",\r\n\tposition: {x: \"right\", y: \"center\"},\r\n\toutside: \"x\"\r\n});\r\n\r\nvar SystemActivityToolTips = new jBox(\"Tooltip\", {\r\n\tgetContent: \"data-tooltip\",\r\n\tposition: {y: \"bottom\"},\r\n\tappendTo: $(\"#chainParent\"),\r\n\treposition: true,\r\n\trepositionOnOpen: true,\r\n\tcreateOnInit: true,\r\n\tonOpen: function() {\r\n\t\tvar nodePos = this.source.closest(\"[data-nodeid]\").position();\r\n\t\tvar parentPos = this.source.closest(\".nodeActivity\").position();\r\n\t\tvar nodeHeight = this.source.closest(\"[data-nodeid]\").height();\r\n\t\t// var nodeWidth = this.source.closest(\"[data-nodeid]\").width();\r\n\t\tvar targetPos = this.target.position()\r\n\t\tvar tooltipWidth = this.container.parent().width();\r\n\t\t// var tooltipHeight = this.container.parent().height();\r\n\r\n\t\tthis.options.position = {x: nodePos.left + parentPos.left + targetPos.left + 3 - tooltipWidth /2 , y: nodePos.top + nodeHeight + 15};\r\n\t}\r\n});\r\n\r\nvar WormholeTypeToolTips = new jBox(\"Tooltip\", {\r\n\tattach: $(\"#chainMap .whEffect[data-icon]\"),\r\n\tgetContent: \"data-tooltip\",\r\n\tposition: {x: \"left\", y: \"center\"},\r\n\tappendTo: $(\"#chainParent\"),\r\n\toutside: \"x\",\r\n\tadjustDistance: 100,\r\n\tresponsiveWidth: false,\r\n\treposition: true,\r\n\trepositionOnOpen: true,\r\n\tcreateOnInit: true,\r\n\tonOpen: function() {\r\n\t\tvar parentPos = this.source.closest(\"[data-nodeid]\").position();\r\n\t\t// var parentHeight = this.source.closest(\"[data-nodeid]\").height();\r\n\t\t// var parentWidth = this.source.closest(\"[data-nodeid]\").width();\r\n\t\tvar targetPos = this.target.position()\r\n\t\tvar tooltipWidth = this.container.parent().width();\r\n\t\t// var tooltipHeight = this.container.parent().height();\r\n\r\n\t\tthis.options.position = {x: parentPos.left - tooltipWidth - 10, y: parentPos.top + targetPos.top - 3};\r\n\t}\r\n});\r\n\r\nvar OccupiedToolTips = new jBox(\"Tooltip\", {\r\n\tpointer: \"top:-3\",\r\n\tposition: {x: \"right\", y: \"center\"},\r\n\tappendTo: $(\"#chainParent\"),\r\n\toutside: \"x\",\r\n\tminWidth: 100,\r\n\tanimation: \"move\",\r\n\tadjustDistance: 100,\r\n\tresponsiveWidth: false,\r\n\treposition: true,\r\n\trepositionOnOpen: true,\r\n\trepositionOnContent: true,\r\n\tcreateOnInit: true,\r\n\tonOpen: function() {\r\n\t\tvar tooltip = this;\r\n\t\tvar systemID = this.source.closest(\"[data-nodeid]\").data(\"nodeid\");\r\n\t\tvar parentPos = this.source.closest(\"[data-nodeid]\").position();\r\n\t\tvar parentWidth = this.source.closest(\"[data-nodeid]\").width();\r\n\t\tvar targetPos = this.target.position();\r\n\r\n\t\tthis.options.position = {x: parentPos.left + parentWidth, y: parentPos.top + targetPos.top - 3};\r\n\r\n\t\ttooltip.setContent(\"&nbsp;\");\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: \"occupants.php\",\r\n\t\t\tdataType: \"JSON\",\r\n\t\t\tdata: \"systemID=\"+systemID,\r\n\t\t\tcache: false\r\n\t\t}).done(function(data) {\r\n\t\t\tif (data && data.occupants) {\r\n\t\t\t\tvar chars = \"<table>\";\r\n\r\n\t\t\t\t// Sort by characterName\r\n\t\t\t\tdata.occupants.sort(function(a, b) {\r\n\t\t\t\t\tif (a.characterName.toLowerCase() < b.characterName.toLowerCase()) return -1;\r\n\t\t\t\t\tif (a.characterName.toLowerCase() > b.characterName.toLowerCase()) return 1;\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tfor (var x in data.occupants) {\r\n\t\t\t\t\tchars += \"<tr><td>\"+data.occupants[x].characterName+\"</td><td style='padding-left: 10px;'>\"+(data.occupants[x].shipTypeName?data.occupants[x].shipTypeName:\"\")+\"</td></tr>\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tchars += \"</table>\";\r\n\t\t\t\ttooltip.setContent(chars);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n});\r\n\r\n$(\"#chainTabs\").sortable({\r\n\titems: \"> .tab\",\r\n\taxis: \"x\",\r\n\tdelay: 150,\r\n\ttolerance: \"pointer\",\r\n\tcontainment: \"parent\",\r\n\tupdate: function(e, ui) {\r\n\t\tvar result = $(\"#chainTabs\").sortable(\"toArray\");\r\n\t\tvar newTabs = [];\r\n\r\n\t\tfor (var x in result) {\r\n\t\t\tnewTabs.push(options.chain.tabs[result[x]]);\r\n\t\t\t$(\"#chainTabs .tab:eq(\"+x+\")\").attr(\"id\", x);\r\n\t\t}\r\n\r\n\t\toptions.chain.active = $(\".tab.current\").index();\r\n\t\toptions.chain.tabs = newTabs;\r\n\t\toptions.save();\r\n\t}\r\n});\r\n\r\n$(\"#chainTabs\").on(\"click\", \".tab\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"current\")) {\r\n\t\t$(\"#chainTabs .tab\").removeClass(\"current\");\r\n\t\toptions.chain.active = null;\r\n\t} else {\r\n\t\t$(\"#chainTabs .tab\").removeClass(\"current\");\r\n\t\t$(this).addClass(\"current\");\r\n\t\toptions.chain.active = $(this).index();\r\n\t}\r\n\r\n\toptions.save();\r\n\tchain.redraw();\r\n\ttripwire.parse(tripwire.client, \"refresh\");\r\n});\r\n\r\n$(\"#chainTabs\").on(\"click\", \".closeTab\", function(e) {\r\n\te.stopPropagation();\r\n\tvar $tab = $(this).closest(\".tab\");\r\n\r\n\t$(\"#dialog-confirm #msg\").html(\"This tab will be removed, are you sure?\");\r\n\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\tbuttons: {\r\n\t\t\t\"Remove Tab\": function() {\r\n\t\t\t\tvar i = $tab.index();\r\n\r\n\t\t\t\toptions.chain.active = $(\".tab.current\").index();\r\n\t\t\t\toptions.chain.tabs.splice(i, 1);\r\n\t\t\t\toptions.save();\r\n\r\n\t\t\t\t$tab.remove();\r\n\t\t\t\tif ($(\"#chainTabs .tab.current\").length == 0) {\r\n\t\t\t\t\t$(\"#chainTabs .tab:last\").click();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var x = 0, l = $(\"#chainTabs .tab\").length; x < l; x++) {\r\n\t\t\t\t\t$(\"#chainTabs .tab:eq(\"+x+\")\").attr(\"id\", x);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t},\r\n\t\t\tCancel: function() {\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t}\r\n\t\t}\r\n\t}).dialog(\"open\");\r\n});\r\n\r\n$(\"#newTab\").on(\"click\", function() {\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-newTab\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-newTab\").dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tOK: function() {\r\n\t\t\t\t\t$(\"#newTab_form\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$(\"#dialog-newTab .name\").val(viewingSystem).focus();\r\n\t\t\t\t$(\"#dialog-newTab .sigSystemsAutocomplete\").val(viewingSystem);\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tValidationTooltips.close();\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t$(\"#dialog-newTab .sigSystemsAutocomplete\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0});\r\n\r\n\t\t\t\t$(\"#newTab_form\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar $tab = $(\"#chainTab .tab\").clone();\r\n\t\t\t\t\tvar name = $(\"#dialog-newTab .name\").val();\r\n\t\t\t\t\tvar systemID = Object.index(tripwire.systems, \"name\", $(\"#dialog-newTab .sigSystemsAutocomplete\").val());\r\n\t\t\t\t\tvar thera = $(\"#tabThera\")[0].checked ? true : false;\r\n\r\n\t\t\t\t\tif (!name) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-newTab .name\")}).setContent(\"Must have a name!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if (!systemID && $(\"#tabType1\")[0].checked) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-newTab .sigSystemsAutocomplete\")}).setContent(\"Must have a valid system!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if ($(\"#tabType2\")[0].checked) {\r\n\t\t\t\t\t\tsystemID = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$tab.attr(\"id\", $(\"#chainTabs .tab\").length).find(\".name\").data(\"tab\", systemID).html(name);\r\n\t\t\t\t\toptions.chain.tabs.push({systemID: systemID, name: name, evescout: thera});\r\n\t\t\t\t\toptions.save();\r\n\r\n\t\t\t\t\t$(\"#chainTabs\").append($tab);\r\n\r\n\t\t\t\t\t$(\"#dialog-newTab\").dialog(\"close\");\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-newTab .sigSystemsAutocomplete\").click(function(e) {\r\n\t\t\t\t\t$(\"#dialog-newTab #tabType1\").click();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-newTab\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-newTab\").dialog(\"open\");\r\n\t}\r\n});\r\n\r\n$(\"#chainTabs\").on(\"click\", \".editTab\", function(e) {\r\n\te.stopPropagation();\r\n\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-editTab\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-editTab\").dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tOK: function() {\r\n\t\t\t\t\t$(\"#editTab_form\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$(\"#dialog-editTab .name\").val(options.chain.tabs[options.chain.active].name).focus();\r\n\t\t\t\t$(\"#dialog-editTab .sigSystemsAutocomplete\").val(options.chain.tabs[options.chain.active].systemID > 0 ? tripwire.systems[options.chain.tabs[options.chain.active].systemID].name : \"\");\r\n\t\t\t\toptions.chain.tabs[options.chain.active].systemID > 0 ? $(\"#dialog-editTab #editTabType1\")[0].checked = true : $(\"#dialog-editTab #editTabType2\")[0].checked = true;\r\n\t\t\t\t$(\"#dialog-editTab #editTabThera\")[0].checked = options.chain.tabs[options.chain.active].evescout;\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tValidationTooltips.close();\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t$(\"#dialog-editTab .sigSystemsAutocomplete\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0});\r\n\r\n\t\t\t\t$(\"#editTab_form\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar $tab = $(\"#chainTabs .tab\").eq([options.chain.active]);\r\n\t\t\t\t\tvar name = $(\"#dialog-editTab .name\").val();\r\n\t\t\t\t\tvar systemID = Object.index(tripwire.systems, \"name\", $(\"#dialog-editTab .sigSystemsAutocomplete\").val());\r\n\t\t\t\t\tvar thera = $(\"#editTabThera\")[0].checked ? true : false;\r\n\r\n\t\t\t\t\tif (!name) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-editTab .name\")}).setContent(\"Must have a name!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if (!systemID && $(\"#editTabType1\")[0].checked) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-editTab .sigSystemsAutocomplete\")}).setContent(\"Must have a valid system!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if ($(\"#editTabType2\")[0].checked) {\r\n\t\t\t\t\t\tsystemID = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$tab.attr(\"id\", $(\"#chainTabs .tab\").length).find(\".name\").data(\"tab\", systemID).html(name);\r\n\t\t\t\t\toptions.chain.tabs[options.chain.active] = {systemID: systemID, name: name, evescout: thera};\r\n\t\t\t\t\toptions.save();\r\n\t\t\t\t\tchain.redraw();\r\n\r\n\t\t\t\t\ttripwire.parse(tripwire.client, \"refresh\");\r\n\r\n\t\t\t\t\t//$(\"#chainTabs\").append($tab);\r\n\r\n\t\t\t\t\t$(\"#dialog-editTab\").dialog(\"close\");\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-editTab .sigSystemsAutocomplete\").click(function(e) {\r\n\t\t\t\t\t$(\"#dialog-editTab #editTabType1\").click();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-editTab\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-editTab\").dialog(\"open\");\r\n\t}\r\n});\r\n\r\n// Signature column context menu\r\n$(\"#signaturesWidget #sigTable thead\").contextmenu({\r\n\tdelegate: \"th.sortable\",\r\n\tmenu: \"#signatureColumnMenu\",\r\n\tposition: function(event, ui) {\r\n        return {my: \"left top\", at: \"center\", of: ui.target};\r\n    },\r\n\tselect: function(e, ui) {\r\n\t\tvar col = $(ui.target).parent().parent().children().index($(ui.target).parent()) + 1;\r\n\r\n\t\tswitch(col) {\r\n\t\t\tcase 1:\r\n\t\t\t\tcolName = \"sigID\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tcolName = \"sigType\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tcolName = \"sigAge\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tcolName = \"leadsTo\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tcolName = \"sigLife\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tcolName = \"sigMass\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tswitch(ui.cmd) {\r\n\t\t\tcase \"leftAlign\":\r\n\t\t\t\t$(\"#signaturesWidget #sigTable tbody td:nth-child(\"+ col +\")\").removeClass(\"centerAlign rightAlign\").addClass(\"leftAlign\");\r\n\t\t\t\toptions.signatures.alignment[colName] = \"leftAlign\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"centerAlign\":\r\n\t\t\t\t$(\"#signaturesWidget #sigTable tbody td:nth-child(\"+ col +\")\").removeClass(\"leftAlign rightAlign\").addClass(\"centerAlign\");\r\n\t\t\t\toptions.signatures.alignment[colName] = \"centerAlign\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"rightAlign\":\r\n\t\t\t\t$(\"#signaturesWidget #sigTable tbody td:nth-child(\"+ col +\")\").removeClass(\"centerAlign leftAlign\").addClass(\"rightAlign\");\r\n\t\t\t\toptions.signatures.alignment[colName] = \"rightAlign\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\toptions.save();\r\n\t},\r\n\tbeforeOpen: function(e, ui) {\r\n\t\tvar col = $(ui.target).parent().parent().children().index($(ui.target).parent()) + 1;\r\n\r\n\t\tswitch(col) {\r\n\t\t\tcase 1:\r\n\t\t\t\tcolName = \"sigID\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tcolName = \"sigType\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tcolName = \"sigAge\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tcolName = \"leadsTo\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tcolName = \"sigLife\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tcolName = \"sigMass\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t$(this).contextmenu(\"enableEntry\", \"leftAlign\", true);\r\n\t\t$(this).contextmenu(\"enableEntry\", \"centerAlign\", true);\r\n\t\t$(this).contextmenu(\"enableEntry\", \"rightAlign\", true);\r\n\r\n\t\t$(this).contextmenu(\"enableEntry\", options.signatures.alignment[colName], false);\r\n\t}\r\n});\r\n\r\n// Chain Map Context Menu\r\n$(\"#chainParent\").contextmenu({\r\n\tappendTo: \"#chainParent\",\r\n\tdelegate: \".nodeSystem a\",\r\n\tposition: function(event, ui) {\r\n        return {my: \"left top-1\", at: \"right top\", of: ui.target};\r\n    },\r\n\tmenu: \"#chainMenu\",\r\n\tshow: {effect: \"slideDown\", duration: 150},\r\n\tselect: function(e, ui) {\r\n\t\tvar id = $(ui.target[0]).closest(\"[data-nodeid]\").data(\"nodeid\");\r\n\t\tvar row = $(ui.target[0]).closest(\"[data-nodeid]\").attr(\"id\").replace(\"node\", \"\") -1;\r\n\r\n\t\tswitch(ui.cmd) {\r\n\t\t\tcase \"showInfo\":\r\n\t\t\t\ttripwire.esi.showInfo(id, options.tracking.active);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"setDest\":\r\n\t\t\t\ttripwire.esi.setDestination(id, options.tracking.active, true);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"addWay\":\r\n\t\t\t\ttripwire.esi.setDestination(id, options.tracking.active, false);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"showMap\":\r\n\t\t\t\t// CCPEVE.showMap(id);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"red\":\r\n\t\t\t\t$(ui.target[0]).closest(\"td\").hasClass(\"redNode\") ? $(this).contextmenu(\"removeFlare\", id, ui) : $(this).contextmenu(\"setFlare\", id, ui.cmd, ui);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"yellow\":\r\n\t\t\t\t$(ui.target[0]).closest(\"td\").hasClass(\"yellowNode\") ? $(this).contextmenu(\"removeFlare\", id, ui) : $(this).contextmenu(\"setFlare\", id, ui.cmd, ui);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"green\":\r\n\t\t\t\t$(ui.target[0]).closest(\"td\").hasClass(\"greenNode\") ? $(this).contextmenu(\"removeFlare\", id, ui) : $(this).contextmenu(\"setFlare\", id, ui.cmd, ui);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"mass\":\r\n\t\t\t\t$(\"#dialog-mass\").data(\"id\", $(ui.target[0]).closest(\"[data-nodeid]\").data(\"sigid\")).data(\"systemID\", $(ui.target[0]).closest(\"[data-nodeid]\").data(\"nodeid\")).dialog(\"open\");\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"collapse\":\r\n\t\t\t\tvar toggle = options.chain.tabs[options.chain.active] ? ($.inArray(id, options.chain.tabs[options.chain.active].collapsed) == -1 ? true : false) : true;\r\n\t\t\t\tchain.map.collapse(row, toggle);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\tbeforeOpen: function(e, ui) {\r\n\t\tvar wormholeID = $(ui.target[0]).closest(\"[data-nodeid]\").data(\"sigid\") || null;\r\n\t\tvar systemID = $(ui.target[0]).closest(\"[data-nodeid]\").data(\"nodeid\");\r\n\r\n\t\t// Add check for k-space\r\n\t\tif (tripwire.systems[systemID].class || !tripwire.esi.characters[options.tracking.active]) {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"setDest\", false);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"addWay\", false);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"showMap\", false);\r\n\t\t} else {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"setDest\", true);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"addWay\", true);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"showMap\", false);\r\n\t\t}\r\n\r\n\t\tif (wormholeID) {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"mass\", true);\r\n\t\t} else {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"mass\", false);\r\n\t\t}\r\n\t},\r\n\tcreate: function(e, ui) {\r\n\t\t// Fix some bad CSS from jQuery Position\r\n\t\t$(this).find(\".ui-front\").css(\"width\", \"10em\");\r\n\t\t$(this).find(\".ui-front\").css(\"position\", \"\");\r\n\r\n\t\t$(\"#dialog-mass\").dialog({\r\n\t\t\tautoOpen: false,\r\n\t\t\twidth: \"auto\",\r\n\t\t\theight: \"auto\",\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tClose: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\tvar wormholeID = $(this).data(\"id\");\r\n\t\t\t\tvar systemID = $(this).data(\"systemID\");\r\n\t\t\t\tvar wormhole = tripwire.client.wormholes[wormholeID];\r\n\t\t\t\tvar signature = tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\tvar otherSignature = tripwire.client.signatures[wormhole.secondaryID];\r\n\r\n\t\t\t\t$(\"#dialog-mass\").dialog(\"option\", \"title\", \"From \"+tripwire.systems[signature.systemID].name+\" to \"+tripwire.systems[otherSignature.systemID].name);\r\n\r\n\t\t\t\t$(\"#dialog-mass #massTable tbody tr\").remove();\r\n\r\n\t\t\t\tvar payload = {wormholeID: wormhole.id};\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: \"mass.php\",\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\tdata: payload,\r\n\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t}).done(function(data) {\r\n\t\t\t\t\tif (data && data.mass) {\r\n                        var totalMass = 0;\r\n\t\t\t\t\t\tfor (x in data.mass) {\r\n                            totalMass += parseFloat(data.mass[x].mass);\r\n\t\t\t\t\t\t\t$(\"#dialog-mass #massTable tbody\").append(\"<tr><td>\"+data.mass[x].characterName+\"</td><td>\"+(data.mass[x].toID == systemID ? \"In\" : \"Out\")+\"</td><td>\"+data.mass[x].shipType+\"</td><td>\"+numFormat(data.mass[x].mass)+\"Kg</td><td>\"+data.mass[x].time+\"</td></tr>\");\r\n\t\t\t\t\t\t}\r\n                        $(\"#dialog-mass #massTable tbody\").append(\"<tr><td></td><td></td><td></td><th>\"+ numFormat(totalMass) +\"Kg</th><td></td></tr>\");\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$.moogle.contextmenu.prototype.setFlare = function(systemID, flare, ui) {\r\n\t\t\tvar data = {\"systemID\": systemID, \"flare\": flare};\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"flares.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: data,\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tif (data && data.result) {\r\n\t\t\t\t\t// $(ui.target[0]).closest(\"td\").removeClass(\"redNode yellowNode greenNode\").addClass(flare+\"Node\");\r\n\r\n\t\t\t\t\tchain.data.flares.flares.push({systemID: systemID, flare: flare, time: null});\r\n\t\t\t\t\tchain.flares(chain.data.flares);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t$.moogle.contextmenu.prototype.removeFlare = function(systemID, ui) {\r\n\t\t\tvar data = {\"systemID\": systemID};\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"flares.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: data,\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tif (data && data.result) {\r\n\t\t\t\t\t// $(ui.target[0]).closest(\"td\").removeClass(\"redNode yellowNode greenNode\");\r\n\r\n\t\t\t\t\tchain.data.flares.flares.splice(Object.index(chain.data.flares.flares, \"systemID\", systemID), 1);\r\n\t\t\t\t\tchain.flares(chain.data.flares);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// Used to generate eve-survival guide link\r\nfunction linkSig(sigName) {\r\n\tvar wormholeSignatures = [\r\n\t\t// Ore sites\r\n\t\t\"Average Frontier Deposit\",\r\n\t\t\"Unexceptional Frontier Deposit\",\r\n\t\t\"Common Perimeter Deposit\",\r\n\t\t\"Exceptional Core Deposit\",\r\n\t\t\"Infrequent Core Deposit\",\r\n\t\t\"Unusual Core Deposit\",\r\n\t\t\"Rarified Core Deposit\",\r\n\t\t\"Isolated Core Deposit\",\r\n\t\t\"Ordinary Permiter Deposit\",\r\n\t\t\"Uncommon Core Deposit\",\r\n\r\n\t\t// Gas Sites\r\n\t\t\"Barren Perimeter Reservoir\",\r\n\t\t\"Minor Perimeter Reservoir\",\r\n\t\t\"Ordinary Perimeter Reservoir\",\r\n\t\t\"Sizeable Perimeter Reservoir\",\r\n\t\t\"Token Perimeter Reservoir\",\r\n\t\t\"Bountiful Frontier Reservoir\",\r\n\t\t\"Vast Frontier Reservoir\",\r\n\t\t\"Instrumental Core Reservoir\",\r\n\t\t\"Vital Core Reservoir\",\r\n\r\n\t\t// Class 1\r\n\t\t\"Perimeter Ambush Point\",\r\n\t\t\"Perimeter Camp\",\r\n\t\t\"Phase Catalyst Node\",\r\n\t\t\"The Line\",\r\n\t\t\"Forgotten Perimeter Coronation Platform\",\r\n\t\t\"Forgotten Perimeter Power Array\",\r\n\t\t\"Unsecured Perimeter Amplifier\",\r\n\t\t\"Unsecured Perimeter Information Center\",\r\n\r\n\t\t// Class 2\r\n\t\t\"Perimeter Checkpoint\",\r\n\t\t\"Perimeter Hangar\",\r\n\t\t\"The Ruins of Enclave Cohort 27\",\r\n\t\t\"Sleeper Data Sanctuary\",\r\n\t\t\"Forgotten Perimeter Gateway\",\r\n\t\t\"Forgotten Perimeter Habitation Coils\",\r\n\t\t\"Unsecured Perimeter Comms Relay\",\r\n\t\t\"Unsecured Perimeter Transponder Farm\",\r\n\r\n\t\t// Class 3\r\n\t\t\"Fortification Frontier Stronghold\",\r\n\t\t\"Outpost Frontier Stronghold\",\r\n\t\t\"Solar Cell\",\r\n\t\t\"The Oruze Construct\",\r\n\t\t\"Forgotten Frontier Quarantine Outpost\",\r\n\t\t\"Forgotten Frontier Recursive Depot\",\r\n\t\t\"Unsecured Frontier Database\",\r\n\t\t\"Unsecured Frontier Receiver\",\r\n\r\n\t\t// Class 4\r\n\t\t\"Frontier Barracks\",\r\n\t\t\"Frontier Command Post\",\r\n\t\t\"Integrated Terminus\",\r\n\t\t\"Sleeper Information Sanctum\",\r\n\t\t\"Forgotten Frontier Conversion Module\",\r\n\t\t\"Forgotten Frontier Evacuation Center\",\r\n\t\t\"Unsecured Frontier Digital Nexus\",\r\n\t\t\"Unsecured Frontier Trinary Hub\",\r\n\r\n\t\t// Class 5\r\n\t\t\"Core Garrison\",\r\n\t\t\"Core Stronghold\",\r\n\t\t\"Oruze Osobnyk\",\r\n\t\t\"Quarantine Area\",\r\n\t\t\"Forgotten Core Data Field\",\r\n\t\t\"Forgotten Core Information Pen\",\r\n\t\t\"Unsecured Frontier Enclave Relay\",\r\n\t\t\"Unsecured Frontier Server Bank\",\r\n\r\n\t\t// Class 6\r\n\t\t\"Core Citadel\",\r\n\t\t\"Core Bastion\",\r\n\t\t\"Strange Energy Readings\",\r\n\t\t\"The Mirror\",\r\n\t\t\"Forgotten Core Assembly Hall\",\r\n\t\t\"Forgotten Core Circuitry Disassembler\",\r\n\t\t\"Unsecured Core Backup Array\",\r\n\t\t\"Unsecured Core Emergence\"\r\n\t];\r\n\r\n\tif (wormholeSignatures.indexOf(sigName) > -1) {\r\n\t\treturn '<a href=\"http://eve-survival.org/wikka.php?wakka='+sigName.replace(/ /g, '')+'\" target=\"_blank\" class=\"siteLink\">'+sigName+'</a>';\r\n\t}\r\n\r\n\treturn sigName;\r\n}\r\n\r\n// Custom inlinecomplete + dropdown input\r\n$.widget(\"custom.inlinecomplete\", $.ui.autocomplete, {\r\n\t_create: function() {\r\n\t\tif (!this.element.is(\"input\")) {\r\n\t\t\tthis._selectInit();\r\n\t\t}\r\n\r\n\t\t// Invoke the parent function\r\n\t\treturn this._super();\r\n\t},\r\n\t_value: function() {\r\n\t\t// Invoke the parent function\r\n\t\tvar originalReturn = this._superApply(arguments);\r\n\r\n\t\tthis.element.change();\r\n\r\n\t\treturn originalReturn;\r\n\t},\r\n\t_suggest: function(items) {\r\n\t\t// if (this.element.val() != items[0].value) {\r\n\t\t\t// this.element.val(items[0].value.substr(0, this.element.val().length));\r\n\t\t// }\r\n\r\n\t\t// Invoke the parent function\r\n\t\treturn this._super(items);\r\n\t},\r\n\t_initSource: function() {\r\n\t\tif ($.isArray(this.options.source)) {\r\n\t\t\tthis.source = function(request, response) {\r\n\t\t\t\tvar matcher = new RegExp(\"^\" + $.ui.autocomplete.escapeRegex(request.term), \"i\");\r\n\t\t\t\tvar results = new Array(); // results array\r\n\t\t\t\tvar data = this.options.source;\r\n\t\t\t\tvar maxSize = this.options.maxSize || 25; // maximum result size\r\n\t\t\t\t// simple loop for the options\r\n\t\t\t\tfor (var i = 0, l = data.length; i < l; i++) {\r\n\t\t\t\t\tif (matcher.test(data[i])) {\r\n\t\t\t\t\t\tresults.push(data[i]);\r\n\r\n\t\t\t\t\t\tif (maxSize && results.length > maxSize) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t // send response\r\n\t\t\t\t response(results);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Invoke the parent function\r\n\t\t\treturn this._super();\r\n\t\t}\r\n\t},\r\n\t_close: function(event) {\r\n\t\tthis.options.source = this.options.input_source ? this.options.input_source : this.options.source;\r\n\r\n\t\t// Invoke the parent function\r\n\t\treturn this._super(event);\r\n\t},\r\n\taddToSelect: function(value) {\r\n\t\tthis.options.select_added_value = value;\r\n\t\tthis.options.select_source.unshift(value);\r\n\t},\r\n\tremoveFromSelect: function(value) {\r\n\t\tif (value) {\r\n\t\t\tthis.options.select_source.splice(value, 1);\r\n\t\t} else if (this.options.select_added_value) {\r\n\t\t\tthis.options.select_source.splice(this.options.select_added_value, 1);\r\n\t\t}\r\n\t\tthis.options.select_added_value = null;\r\n\t},\r\n\t_selectInit: function() {\r\n\t\tthis.element.addClass(\"custom-combobox\");\r\n\t\tthis.wrapper = this.element;\r\n\t\tthis.element = this.wrapper.find(\"input:first\");\r\n\t\tthis.select = this.wrapper.find(\"select:first\").remove();\r\n\r\n\t\tthis.options.input_source = this.options.source;\r\n\t\tthis.options.select_source = this.select.children(\"option[value!='']\").map(function() {\r\n            return $.trim(this.text);\r\n        }).toArray();\r\n\r\n\t\tthis._createShowAllButton();\r\n\t},\r\n\t_createShowAllButton: function() {\r\n        var that = this,\r\n          wasOpen = false;\r\n\r\n        $(\"<a>\")\r\n\t\t\t.attr(\"tabIndex\", that.element.prop(\"tabindex\"))\r\n\t\t\t.attr(\"title\", \"\")\r\n\t\t\t.appendTo(that.wrapper)\r\n\t\t\t.button({icons: {primary: \"ui-icon-triangle-1-s\"}, text: false})\r\n\t\t\t.removeClass(\"ui-corner-all\")\r\n\t\t\t.addClass(\"custom-combobox-toggle ui-corner-right\")\r\n\t\t\t.on(\"mousedown\", function() {\r\n\t\t\t\twasOpen = that.widget().is(\":visible\");\r\n\t\t\t})\r\n\t\t\t.on(\"click\", function() {\r\n\t\t\t\tthat.element.trigger(\"focus\");\r\n\r\n\t\t\t\t// Close if already visible\r\n\t\t\t\tif (wasOpen) {\r\n\t\t\t\t  return;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Pass empty string as value to search for, displaying all results\r\n\t\t\t\tthat.options.source = that.options.select_source;\r\n\t\t\t\tthat._search(\"\");\r\n\t\t\t});\r\n\t},\r\n});\r\n\r\n// Initialize tablesorter plugin on signaturesWidget table\r\n$(\"#sigTable\").tablesorter({\r\n\tsortReset: true,\r\n\twidgets: ['saveSort'],\r\n\ttextExtraction: {\r\n\t\t2: function(node) { return $(node).find(\"span\").data(\"age\"); }\r\n\t}\r\n});\r\n\r\n// Highlight signaturesWidget tr on click\r\n$(\"#sigTable tbody\").on(\"click\", \"tr\", function(e) {\r\n\tif (e.metaKey || e.ctrlKey) {\r\n\t\t// ctrl or cmd key\r\n\t\t$(this).toggleClass(\"selected\");\r\n\t} else if (e.shiftKey) {\r\n\t\t// shift key\r\n\t\t$(this).addClass(\"selected\");\r\n\t\t$(\"#sigTable tbody tr.selected:first\").nextUntil(\"#sigTable tbody tr.selected:last\").addBack().add(\"#sigTable tbody tr.selected:last\").addClass(\"selected\");\r\n\t} else {\r\n\t\t$(\"#sigTable tbody tr.selected\").removeClass(\"selected\");\r\n\t\t$(this).addClass(\"selected\");\r\n\t}\r\n});\r\n\r\n// Un-Highlight signaturesWidget tr on clicking outside\r\n$(document).click(function(e) {\r\n    if(!$(e.target).closest('#sigTable tbody').length && !$(e.target).closest('#edit-signature').length && !$(e.target).closest('#delete-signature').length) {\r\n\t\t$(\"#sigTable tbody tr.selected\").removeClass(\"selected\");\r\n    }\r\n});\r\n\r\n// Monitor custom 'classchange' event\r\n$(\"#sigTable tbody\").on(\"classchange\", \"tr\", function(e, className) {\r\n\t// Trigger signaturesWidget selected row change custom event\r\n\tif (className === \"selected\") {\r\n\t\t$(\"#signaturesWidget\").trigger(\"selected:change\");\r\n\t}\r\n});\r\n\r\n// Update signaturesWidget based on .selected rows change\r\n$(\"#signaturesWidget\").on(\"selected:change\", function() {\r\n\t// Enable/Disable delete icon\r\n\tif ($(\"#sigTable tr.selected\").length === 0) {\r\n\t\t$(\"#signaturesWidget #delete-signature\").addClass(\"disabled\");\r\n\t} else {\r\n\t\t$(\"#signaturesWidget #delete-signature\").removeClass(\"disabled\");\r\n\t}\r\n\r\n\t// Enable/Disable edit icon\r\n\tif ($(\"#sigTable tr.selected\").length === 1) {\r\n\t\t$(\"#signaturesWidget #edit-signature\").removeClass(\"disabled\");\r\n\t} else {\r\n\t\t$(\"#signaturesWidget #edit-signature\").addClass(\"disabled\");\r\n\t}\r\n})\r\n\r\n$(\"#dialog-error\").dialog({\r\n\tautoOpen: false,\r\n\tresizable: false,\r\n\tminHeight: 0,\r\n\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\tbuttons: {\r\n\t\tOk: function() {\r\n\t\t\t$(this).dialog(\"close\");\r\n\t\t}\r\n\t},\r\n\tcreate: function() {\r\n\t\t$(this).dialog(\"option\", \"show\", {effect: \"shake\", duration: 150, easing: \"easeOutElastic\"});\r\n\t}\r\n});\r\n\r\n$(\"#dialog-msg\").dialog({\r\n\tautoOpen: false,\r\n\tresizable: false,\r\n\tminHeight: 0,\r\n\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\tbuttons: {\r\n\t\tOk: function() {\r\n\t\t\t$(this).dialog(\"close\");\r\n\t\t}\r\n\t}\r\n});\r\n\r\n$(\"#dialog-confirm\").dialog({\r\n\tautoOpen: false,\r\n\tresizable: false,\r\n\tminHeight: 0,\r\n\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\tbuttons: {\r\n\t\tCancel: function() {\r\n\t\t\t$(this).dialog(\"close\");\r\n\t\t}\r\n\t}\r\n});\r\n\r\nif (window.location.href.indexOf(\"galileo\") != -1) {\r\n\tNotify.trigger(\"This is the test version of Tripwire.<br/>Please use <a href='https://tripwire.cloud-things.com'>Tripwire</a>\")\r\n}\r\n","tripwire.active = function(data) {\r\n    var editSigs = [];\r\n    var editComments = [];\r\n\r\n    for (var x in data) {\r\n        var activity = JSON.parse(data[x].activity);\r\n        editSigs.push(parseInt(activity.editSig));\r\n        editComments.push(parseInt(activity.editComment));\r\n\r\n        if (activity.editSig) {\r\n            $(\"#sigTable tr[data-id='\"+activity.editSig+\"']\")\r\n                //.attr('data-tooltip', sig.editing)\r\n                //.attr(\"title\", sig.editing)\r\n                .addClass(\"editing\")\r\n                .find(\"td\")\r\n                .animate({backgroundColor: \"#001b47\"}, 1000); //35240A - Yellow\r\n        }\r\n\r\n        if (activity.editComment && $(\"#commentWrapper .comment[data-id='\"+activity.editComment+\"'] .cke\").length > 0) {\r\n            $(\"#commentWrapper .comment[data-id='\"+activity.editComment+\"']\")\r\n                .addClass(\"editing\")\r\n                .find(\".commentStatus\").html(data[x].characterName + \" is editing\").fadeIn();\r\n        }\r\n    }\r\n\r\n    $(\"#sigTable tr.editing\").each(function() {\r\n        if ($.inArray($(this).data(\"id\"), editSigs) == -1) {\r\n            $(\"#sigTable tr[data-id='\"+$(this).data(\"id\")+\"']\")\r\n                //.attr('data-tooltip', '')\r\n                //.removeAttr(\"title\")\r\n                .removeClass(\"editing\")\r\n                .find(\"td\")\r\n                .animate({backgroundColor: \"#111\"}, 1000, null, function() {$(this).css({backgroundColor: \"\"});});\r\n        }\r\n    });\r\n\r\n    $(\"#commentWrapper .editing\").each(function() {\r\n        if ($.inArray($(this).data(\"id\"), editComments) == -1) {\r\n            $(\"#commentWrapper .editing[data-id='\"+$(this).data(\"id\")+\"']\")\r\n                .removeClass(\"editing\")\r\n                .find(\".commentStatus\").fadeOut(function() {$(this).html(\"\")});\r\n        }\r\n    });\r\n}\r\n","// Hanldes adding to Signatures section\r\n// ToDo: Use native JS\r\ntripwire.addSig = function(add, option, disabled) {\r\n    var option = option || {};\r\n    var animate = typeof(option.animate) !== 'undefined' ? option.animate : true;\r\n    var disabled = disabled || false;\r\n    var wormhole = {};\r\n\r\n    if (add.type == \"wormhole\") {\r\n        var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == add.id || wormhole.secondaryID == add.id) return wormhole; })[0];\r\n        if (!wormhole) return false;\r\n        var otherSignature = add.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID];\r\n        if (!otherSignature) return false;\r\n\r\n        if (add.name) {\r\n          leadsTo = tripwire.systems[otherSignature.systemID] ? \"<a href='.?system=\"+tripwire.systems[otherSignature.systemID].name+\"'>\"+add.name+\"</a>\" : add.name;\r\n        } else if (tripwire.aSigSystems[otherSignature.systemID]) {\r\n            leadsTo = tripwire.aSigSystems[otherSignature.systemID];\r\n        } else if (tripwire.systems[otherSignature.systemID]) {\r\n            leadsTo = \"<a href='.?system=\"+tripwire.systems[otherSignature.systemID].name+\"'>\"+tripwire.systems[otherSignature.systemID].name+\"</a>\";\r\n        } else {\r\n            leadsTo = \"\";\r\n        }\r\n\r\n        var row = \"<tr data-id='\"+add.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+(add.signatureID ? add.signatureID.substring(0, 3)+\"-\"+(add.signatureID.substring(3, 6) || \"###\") : \"???-###\")+\"</td>\"\r\n            + \"<td class='type-tooltip \"+ options.signatures.alignment.sigType +\"' data-tooltip=\\\"\"+this.whTooltip(wormhole)+\"\\\">\"+(wormhole[wormhole.parent+\"ID\"] == add.id ? wormhole.type || \"\" : (wormhole.parent ? \"K162\" : \"\"))+\"</td>\"\r\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge + (parseInt(add.lifeLength) === 0 ? \" disabled\" : \"\") +\"' data-tooltip='\"+this.ageTooltip(add)+\"'><span data-age='\"+add.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"'>\"+(leadsTo || \"\")+\"</td>\"\r\n            + \"<td class='\"+wormhole.life+\" \"+ options.signatures.alignment.sigLife +\"'>\"+wormhole.life+\"</td>\"\r\n            + \"<td class='\"+wormhole.mass+\" \"+ options.signatures.alignment.sigMass +\"'>\"+wormhole.mass+\"</td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    } else {\r\n        var row = \"<tr data-id='\"+add.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+(add.signatureID ? add.signatureID.substring(0, 3)+\"-\"+(add.signatureID.substring(3, 6) || \"###\") : \"???-###\")+\"</td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigType +\"'>\"+add.type+\"</td>\"\r\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge + (parseInt(add.lifeLength) === 0 ? \" disabled\" : \"\") +\"' data-tooltip='\"+this.ageTooltip(add)+\"'><span data-age='\"+add.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"' colspan='3'>\"+(add.name?linkSig(add.name):'')+\"</td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    }\r\n\r\n    Tooltips.attach($(tr).find(\"[data-tooltip]\"));\r\n\r\n    $(\"#sigTable\").append(tr);\r\n\r\n    $(\"#sigTable\").trigger(\"update\");\r\n\r\n    // Add counter\r\n    if (wormhole.life == \"critical\") {\r\n        $(tr).find('span[data-age]').countdown({until: moment.utc(add.lifeLeft).toDate(), onExpiry: this.pastEOL, alwaysExpire: true, compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime})\r\n            // .countdown('pause')\r\n            .addClass('critical')\r\n            // .countdown('resume');\r\n    } else {\r\n        $(tr).find('span[data-age]').countdown({since: moment.utc(add.lifeTime).toDate(), compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime});\r\n    }\r\n\r\n    if (animate) {\r\n        $(tr)\r\n            .find('td')\r\n            .wrapInner('<div class=\"hidden\" />')\r\n            .parent()\r\n            .find('td > div')\r\n            .slideDown(700, function(){\r\n                $set = $(this);\r\n                $set.replaceWith($set.contents());\r\n            });\r\n\r\n        $(tr).find(\"td\").animate({backgroundColor: \"#004D16\"}, 1000).delay(1000).animate({backgroundColor: \"#111\"}, 1000, null, function() {$(this).css({backgroundColor: \"\"});});\r\n    }\r\n}\r\n","// Handles API updates\r\ntripwire.API = function() {\r\n    this.indicator;\r\n    this.APIrefresh;\r\n\r\n    this.API.expire = function() {\r\n        var options = {since: tripwire.API.APIrefresh, until: null, format: \"MS\", layout: \"-{mnn}{sep}{snn}\"};\r\n        $(\"#APItimer\").countdown(\"option\", options);\r\n    }\r\n\r\n    this.API.refresh = function() {\r\n        $.ajax({\r\n            url: \"api_update.php\",\r\n            cache: false,\r\n            dataType: \"JSON\",\r\n            data: \"indicator=\"+tripwire.API.indicator\r\n        }).done(function(data) {\r\n            if (data && data.APIrefresh) {\r\n                tripwire.API.indicator = data.indicator;\r\n                tripwire.API.APIrefresh = new Date(data.APIrefresh);\r\n                activity.refresh(); //Refresh graph\r\n\r\n                var options = {until: tripwire.API.APIrefresh, since: null, layout: \"{mnn}{sep}{snn}\"};\r\n                $(\"#APItimer\").countdown(\"option\", options);\r\n                setTimeout(\"tripwire.API.refresh();\", $.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) - 30);\r\n            } else if ($(\"#APItimer\").countdown(\"option\", \"layout\") !== \"-{mnn}{sep}{snn}\" && $.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) > 120) {\r\n                setTimeout(\"tripwire.API.refresh();\", ($.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) - 30) * 1000);\r\n            } else {\r\n                setTimeout(\"tripwire.API.refresh();\", 15000);\r\n            }\r\n        });\r\n    }\r\n\r\n    this.API.init = function() {\r\n        $.ajax({\r\n            url: \"api_update.php\",\r\n            cache: true,\r\n            dataType: \"JSON\",\r\n            data: \"init=true\"\r\n        }).done(function(data) {\r\n            tripwire.API.indicator = data.indicator;\r\n            tripwire.API.APIrefresh = new Date(data.APIrefresh);\r\n\r\n            $(\"#APItimer\").countdown({until: tripwire.API.APIrefresh, onExpiry: tripwire.API.expire, alwaysExpire: true, compact: true, format: \"MS\", serverSync: tripwire.serverTime.getTime, onTick: function(t) { $(\"#APIclock\").val(t[5] + 1).trigger(\"change\"); }})\r\n            var timer = $(\"#APItimer\").countdown(\"option\", \"layout\") === \"-{mnn}{sep}{snn}\" ? 15 : $.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) - 30;\r\n            setTimeout(\"tripwire.API.refresh();\", timer * 1000);\r\n        });\r\n    }\r\n\r\n    this.API.init();\r\n}\r\n// tripwire.API();\r\n","tripwire.autoMapper = function(from, to) {\r\n    var pods = [33328, 670];\r\n    var undo = [];\r\n\r\n    // Convert from & to from system name to system ID for diagnostic testing\r\n    // from = viewingSystemID;\r\n    // to = Object.index(tripwire.systems, 'name', to);\r\n\r\n    // Make sure the automapper is turned on & not disabled\r\n    if (!$(\"#toggle-automapper\").hasClass(\"active\") || $(\"#toggle-automapper\").hasClass(\"disabled\"))\r\n        return false;\r\n\r\n    // Make sure from and to are valid systems\r\n    if (!tripwire.systems[from] || !tripwire.systems[to])\r\n        return false;\r\n\r\n    // Make sure from and to are not the same system\r\n    if (from == to)\r\n        return false;\r\n\r\n    // Is pilot in a station?\r\n    if (tripwire.client.EVE && tripwire.client.EVE.stationID)\r\n        return false;\r\n\r\n    // Is pilot in a pod?\r\n    // if (tripwire.client.EVE && tripwire.client.EVE.shipTypeID && $.inArray(parseInt(tripwire.client.EVE.shipTypeID), pods) >= 0)\r\n    //     return false;\r\n\r\n    // Is this a gate?\r\n    if (typeof(tripwire.map.shortest[from - 30000000]) != \"undefined\" && typeof(tripwire.map.shortest[from - 30000000][to - 30000000]) != \"undefined\")\r\n        return false;\r\n\r\n    // Is this an existing connection?\r\n    if ($.map(tripwire.client.wormholes, function(wormhole) { return (tripwire.client.signatures[wormhole.initialID].systemID == from && tripwire.client.signatures[wormhole.secondaryID].systemID == to) || (tripwire.client.signatures[wormhole.initialID].systemID == to && tripwire.client.signatures[wormhole.secondaryID].systemID == from) ? wormhole : null; }).length > 0)\r\n        return false;\r\n\r\n    var payload = {\"signatures\": {\"add\": [], \"update\": []}};\r\n    var sig, toClass;\r\n\r\n    if (tripwire.systems[to].class)\r\n        toClass = \"Class-\" + tripwire.systems[to].class;\r\n    else if (tripwire.systems[to].security >= 0.45)\r\n        toClass = \"High-Sec\";\r\n    else if (tripwire.systems[to].security > 0)\r\n        toClass = \"Low-Sec\";\r\n    else\r\n        toClass = \"Null-Sec\";\r\n\r\n    var wormholes = $.map(tripwire.client.wormholes, function(wormhole) {\r\n        // Find wormholes that have no set Leads To system, and their initial system is from the wormhole we just jumped from\r\n        if (tripwire.client.signatures[wormhole.initialID].systemID == from && !tripwire.systems[tripwire.client.signatures[wormhole.secondaryID].systemID]) {\r\n            if (tripwire.aSigSystems[tripwire.client.signatures[wormhole.secondaryID].systemID] == toClass) {\r\n                // Find wormholes that Leads To is generically set to the class we just jumped into\r\n                return wormhole;\r\n            } else if (wormhole.type && tripwire.wormholes[wormhole.type] && tripwire.wormholes[wormhole.type].leadsTo.replace(' ', '-') == toClass) {\r\n                // Find wormholes that Type is known to lead to the class we just jumped into\r\n                return wormhole;\r\n            } else if (tripwire.client.signatures[wormhole.secondaryID].systemID === null && (!wormhole.type || !tripwire.wormholes[wormhole.type])) {\r\n                // Find wormholes that don't have a Type or any kind of Leads To entered\r\n                return wormhole;\r\n            }\r\n        }\r\n    });\r\n\r\n    if (wormholes.length) {\r\n        if (wormholes.length > 1) {\r\n            $(\"#dialog-select-signature\").dialog({\r\n                autoOpen: true,\r\n                title: \"Which Signature?\",\r\n                width: 390,\r\n                buttons: {\r\n                    Cancel: function() {\r\n                        $(this).dialog(\"close\");\r\n                    },\r\n                    Ok: function() {\r\n                        var i = $(\"#dialog-select-signature [name=sig]:checked\").val();\r\n                        var wormhole = wormholes[i];\r\n                        var signature = tripwire.client.signatures[wormhole.initialID];\r\n                        var signature2 = tripwire.client.signatures[wormhole.secondaryID];\r\n\r\n                        payload.signatures.update.push({\r\n                            \"wormhole\": {\r\n                                \"id\": wormhole.id\r\n                            },\r\n                            \"signatures\": [\r\n                                {\r\n                                    \"id\": signature.id\r\n                                },\r\n                                {\r\n                                    \"id\": signature2.id,\r\n                                    \"systemID\": to\r\n                                }\r\n                            ]\r\n                        });\r\n\r\n                        var success = function(data) {\r\n                            if (data.resultSet && data.resultSet[0].result == true) {\r\n                                undo.push({\"wormhole\": wormhole, \"signatures\": [signature, signature2]});\r\n                                $(\"#dialog-select-signature\").dialog(\"close\");\r\n                            }\r\n                        }\r\n\r\n                        tripwire.refresh('refresh', payload, success);\r\n                    }\r\n                },\r\n                open: function() {\r\n                    $(\"#dialog-select-signature .optionsTable tbody\").empty();\r\n\r\n                    $.each(wormholes, function(i) {\r\n                        var signature = tripwire.client.signatures[wormholes[i].initialID];\r\n                        var signatureRow = $(\"#sigTable tr[data-id='\"+signature.id+\"']\").html();\r\n                        var tr = \"<tr>\"\r\n                          + \"<td><input type='radio' name='sig' value='\"+i+\"' id='sig\"+i+\"' /></td>\"\r\n                          + signatureRow\r\n                          + \"</tr>\";\r\n\r\n                        $(\"#dialog-select-signature .optionsTable tbody\").append(tr);\r\n                        $(\"#dialog-select-signature .optionsTable tbody td\").wrapInner(\"<label for='sig\"+i+\"' />\");\r\n                    });\r\n                }\r\n            });\r\n        } else {\r\n            var wormhole = wormholes[0];\r\n            var signature = tripwire.client.signatures[wormhole.initialID];\r\n            var signature2 = tripwire.client.signatures[wormhole.secondaryID];\r\n\r\n            payload.signatures.update.push({\r\n                \"wormhole\": {\r\n                    \"id\": wormhole.id\r\n                },\r\n                \"signatures\": [\r\n                    {\r\n                        \"id\": signature.id\r\n                    },\r\n                    {\r\n                        \"id\": signature2.id,\r\n                        \"systemID\": to\r\n                    }\r\n                ]\r\n            });\r\n            undo.push({\"wormhole\": wormhole, \"signatures\": [signature, signature2]});\r\n        }\r\n    } else {\r\n        // Nothing matches, create a new wormhole\r\n        payload.signatures.add.push({\r\n            \"wormhole\": {\r\n                \"type\": null,\r\n                \"parent\": \"initial\",\r\n                \"life\": \"stable\",\r\n                \"mass\": \"stable\"\r\n            },\r\n            \"signatures\": [\r\n                {\r\n                    \"systemID\": from,\r\n                    \"type\": \"wormhole\"\r\n                },\r\n                {\r\n                    \"systemID\": to,\r\n                    \"type\": \"wormhole\"\r\n                }\r\n            ]\r\n        });\r\n    }\r\n\r\n    if (payload.signatures.add.length || payload.signatures.update.length) {\r\n        var success = function(data) {\r\n            if (data.resultSet && data.resultSet[0].result == true) {\r\n                $(\"#undo\").removeClass(\"disabled\");\r\n\r\n                if (data.results) {\r\n                    if (viewingSystemID in tripwire.signatures.undo) {\r\n                        tripwire.signatures.undo[viewingSystemID].push({action: \"add\", signatures: data.results});\r\n                    } else {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{action: \"add\", signatures: data.results}];\r\n                    }\r\n                }\r\n\r\n                if (undo.length) {\r\n                    if (viewingSystemID in tripwire.signatures.undo) {\r\n                        tripwire.signatures.undo[viewingSystemID].push({action: \"update\", signatures: undo});\r\n                    } else {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{action: \"update\", signatures: undo}];\r\n                    }\r\n                }\r\n\r\n                sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n            }\r\n        }\r\n\r\n        tripwire.refresh('refresh', payload, success);\r\n    }\r\n}\r\n","$(\"body\").on(\"dblclick\", \".comment\", function(e) {\r\n\te.preventDefault();\r\n\tdocument.getSelection().removeAllRanges();\r\n\t$(this).find(\".commentEdit\").click();\r\n})\r\n\r\n$(\"body\").on(\"click\", \".commentEdit\", function(e) {\r\n\te.preventDefault();\r\n\r\n\t// Prevent multiple editors\r\n\tif ($(\".cke\").length) return false;\r\n\r\n\tvar $comment = $(this).closest(\".comment\");\r\n\r\n\t$comment.find(\".commentToolbar\").hide();\r\n\r\n\tCKEDITOR.replace($comment.find(\".commentBody\").attr(\"id\"), CKConfig).on(\"instanceReady\", function() {\r\n\t\t$comment.find(\".commentStatus\").html(\"\");\r\n\t\t$comment.find(\".commentFooter\").show();\r\n\t\t$comment.find(\".commentFooter .commentControls\").show();\r\n\t});\r\n\r\n\ttripwire.activity.editComment = $comment.data(\"id\");\r\n\ttripwire.refresh('refresh');\r\n});\r\n\r\n$(\"body\").on(\"click\", \".commentSave, .commentCancel\", function(e) {\r\n\te.preventDefault();\r\n\tvar $this = $(this);\r\n\tif ($this.attr(\"disabled\")) return false;\r\n\r\n\tvar $comment = $this.closest(\".comment\");\r\n\t$this.attr(\"disabled\", \"true\");\r\n\r\n\tif ($this.hasClass(\"commentSave\")) {\r\n\t\tvar data = {\"mode\": \"save\", \"commentID\": $comment.data(\"id\"), \"systemID\": $comment.find(\".commentSticky\").hasClass(\"active\") ? 0 : viewingSystemID, \"comment\": CKEDITOR.instances[$comment.find(\".commentBody\").attr(\"id\")].getData()};\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: \"comments.php\",\r\n\t\t\ttype: \"POST\",\r\n\t\t\tdata: data,\r\n\t\t\tdataType: \"JSON\"\r\n\t\t}).done(function(data) {\r\n\t\t\tif (data && data.result == true) {\r\n\t\t\t\t$comment.find(\".commentModified\").html(\"Edited by \" + data.comment.modifiedByName + \" at \" + data.comment.modifiedDate);\r\n\t\t\t\t$comment.find(\".commentCreated\").html(\"Posted by \" + data.comment.createdByName + \" at \" + data.comment.createdDate);\r\n\t\t\t\tTooltips.attach($comment.find(\"[data-tooltip]\"));\r\n\r\n\t\t\t\tCKEDITOR.instances[$comment.find(\".commentBody\").attr(\"id\")].destroy(false);\r\n\t\t\t\t$comment.attr(\"data-id\", data.comment.id);\r\n\t\t\t\t$comment.find(\".commentToolbar\").show();\r\n\t\t\t\t$comment.find(\".commentFooter\").hide();\r\n\t\t\t\t$this.removeAttr(\"disabled\");\r\n\t\t\t}\r\n\t\t});\r\n\t} else {\r\n\t\tCKEDITOR.instances[$comment.find(\".commentBody\").attr(\"id\")].destroy(true);\r\n\r\n\t\tif (!$comment.attr(\"data-id\")) {\r\n\t\t\t$comment.remove();\r\n\t\t} else {\r\n\t\t\t$comment.find(\".commentToolbar\").show();\r\n\t\t\t$comment.find(\".commentFooter\").hide();\r\n\t\t\t$this.removeAttr(\"disabled\");\r\n\t\t}\r\n\t}\r\n\r\n\t$comment.find(\".commentStatus\").html(\"\");\r\n\r\n\tdelete tripwire.activity.editComment;\r\n\ttripwire.refresh('refresh');\r\n});\r\n\r\n$(\"body\").on(\"click\", \".commentDelete\", function(e) {\r\n\te.preventDefault();\r\n\tvar $comment = $(this).closest(\".comment\");\r\n\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-deleteComment\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-deleteComment\").data(\"comment\", $comment).dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tposition: {my: \"center\", at: \"center\", of: $(\"#notesWidget\")},\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tDelete: function() {\r\n\t\t\t\t\t// Prevent duplicate submitting\r\n\t\t\t\t\t$(\"#dialog-deleteComment\").parent().find(\":button:contains('Delete')\").button(\"disable\");\r\n\r\n\t\t\t\t\tvar $comment = $(this).data(\"comment\");\r\n\t\t\t\t\tvar data = {\"mode\": \"delete\", \"commentID\": $comment.data(\"id\")};\r\n\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: \"comments.php\",\r\n\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\tdata: data,\r\n\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t}).done(function(data) {\r\n\t\t\t\t\t\tif (data && data.result == true) {\r\n\t\t\t\t\t\t\t$(\"#dialog-deleteComment\").dialog(\"close\");\r\n\t\t\t\t\t\t\t$comment.remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).always(function() {\r\n\t\t\t\t\t\t$(\"#dialog-deleteComment\").parent().find(\":button:contains('Delete')\").button(\"enable\");\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-deleteComment\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-deleteComment\").data(\"comment\", $comment).dialog(\"open\");\r\n\t}\r\n});\r\n\r\n$(\"body\").on(\"click\", \"#add-comment\", function(e) {\r\n\te.preventDefault();\r\n\r\n\t// Prevent multiple editors\r\n\tif ($(\".cke\").length) return false;\r\n\r\n\tvar $comment = $(\".comment:last\").clone();\r\n\tvar commentID = $(\".comment:visible:last .commentBody\").attr(\"id\") ? $(\".comment:visible:last .commentBody\").attr(\"id\").replace(\"comment\", \"\") + 1 : 0;\r\n\t$(\".comment:last\").before($comment);\r\n\r\n\t$comment.find(\".commentBody\").attr(\"id\", \"comment\" + commentID);\r\n\t$comment.removeClass(\"hidden\").find(\".commentEdit\").click();\r\n});\r\n\r\n$(\"body\").on(\"click\", \".commentSticky\", function(e) {\r\n\te.preventDefault();\r\n\tvar $comment = $(this).closest(\".comment\");\r\n\r\n\tvar data = {\"mode\": \"sticky\", \"commentID\": $comment.data(\"id\"), \"systemID\": $comment.find(\".commentSticky\").hasClass(\"active\") ? viewingSystemID : 0};\r\n\r\n\t$.ajax({\r\n\t\turl: \"comments.php\",\r\n\t\ttype: \"POST\",\r\n\t\tdata: data,\r\n\t\tdataType: \"JSON\"\r\n\t}).done(function(data) {\r\n\t\tif (data && data.result == true) {\r\n\t\t\t$comment.find(\".commentSticky\").hasClass(\"active\") ? $comment.find(\".commentSticky\").removeClass(\"active\") : $comment.find(\".commentSticky\").addClass(\"active\");\r\n\t\t}\r\n\t});\r\n});\r\n","// Handles removing from Signatures section\r\ntripwire.deleteSig = function(key) {\r\n    var tr = $(\"#sigTable tr[data-id='\"+key+\"']\");\r\n\r\n    //Append empty space to prevent non-coloring\r\n    $(tr).find('td:empty, a:empty').append(\"&nbsp;\");\r\n\r\n    $(tr)\r\n        .find('td')\r\n        .wrapInner('<div />')\r\n        .parent()\r\n        .find('td > div').animate({backgroundColor: \"#4D0000\"}, 1000).delay(1000).animate({backgroundColor: \"#111\"}, 1000)\r\n        .slideUp(700, function(){\r\n            // Remove countdown reference\r\n            $(tr).find('span[data-age]').countdown(\"destroy\");\r\n\r\n            $(this).parent().parent().remove();\r\n            $(\"#sigTable\").trigger(\"update\");\r\n        });\r\n}\r\n","// Handles changing Signatures section\r\n// ToDo: Use native JS\r\ntripwire.editSig = function(edit, disabled) {\r\n    var disabled = disabled || false;\r\n    var wormhole = {};\r\n\r\n    if (edit.type == \"wormhole\") {\r\n        var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == edit.id || wormhole.secondaryID == edit.id) return wormhole; })[0];\r\n        if (!wormhole) return false;\r\n        var otherSignature = edit.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID];\r\n        if (!otherSignature) return false;\r\n\r\n        if (edit.name) {\r\n          leadsTo = tripwire.systems[otherSignature.systemID] ? \"<a href='.?system=\"+tripwire.systems[otherSignature.systemID].name+\"'>\"+edit.name+\"</a>\" : edit.name;\r\n        } else if (tripwire.aSigSystems[otherSignature.systemID]) {\r\n            leadsTo = tripwire.aSigSystems[otherSignature.systemID];\r\n        } else if (tripwire.systems[otherSignature.systemID]) {\r\n            leadsTo = \"<a href='.?system=\"+tripwire.systems[otherSignature.systemID].name+\"'>\"+tripwire.systems[otherSignature.systemID].name+\"</a>\";\r\n        } else {\r\n            leadsTo = \"\";\r\n        }\r\n\r\n        var row = \"<tr data-id='\"+edit.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+(edit.signatureID ? edit.signatureID.substring(0, 3)+\"-\"+(edit.signatureID.substring(3, 6) || \"###\") : \"???-###\")+\"</td>\"\r\n            + \"<td class='type-tooltip \"+ options.signatures.alignment.sigType +\"' data-tooltip=\\\"\"+this.whTooltip(wormhole)+\"\\\">\"+(wormhole[wormhole.parent+\"ID\"] == edit.id ? wormhole.type || \"\" : (wormhole.parent ? \"K162\" : \"\"))+\"</td>\"\r\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge + (parseInt(edit.lifeLength) === 0 ? \" disabled\" : \"\") +\"' data-tooltip='\"+this.ageTooltip(edit)+\"'><span data-age='\"+edit.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"'>\"+(leadsTo || \"\")+\"</td>\"\r\n            + \"<td class='\"+wormhole.life+\" \"+ options.signatures.alignment.sigLife +\"'>\"+wormhole.life+\"</td>\"\r\n            + \"<td class='\"+wormhole.mass+\" \"+ options.signatures.alignment.sigMass +\"'>\"+wormhole.mass+\"</td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    } else {\r\n        var row = \"<tr data-id='\"+edit.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+(edit.signatureID ? edit.signatureID.substring(0, 3)+\"-\"+(edit.signatureID.substring(3, 6) || \"###\") : \"???-###\")+\"</td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigType +\"'>\"+edit.type+\"</td>\"\r\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge + (parseInt(edit.lifeLength) === 0 ? \" disabled\" : \"\") +\"' data-tooltip='\"+this.ageTooltip(edit)+\"'><span data-age='\"+edit.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"' colspan='3'>\"+(edit.name?linkSig(edit.name):'')+\"</td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    }\r\n\r\n    Tooltips.attach($(tr).find(\"[data-tooltip]\"));\r\n\r\n    // Destroy the pervious countdown to prevent errors on a non-existant DOM element\r\n    $(\"#sigTable tr[data-id='\"+edit.id+\"']\").find('span[data-age]').countdown(\"destroy\");\r\n    $(\"#sigTable tr[data-id='\"+edit.id+\"']\").replaceWith(tr);\r\n\r\n    $(\"#sigTable\").trigger(\"update\");\r\n    // Update counter\r\n    if (wormhole.life == \"critical\") {\r\n        $(tr).find('span[data-age]').countdown({until: moment.utc(edit.lifeLeft).toDate(), onExpiry: this.pastEOL, alwaysExpire: true, compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime})\r\n            .addClass('critical');\r\n    } else {\r\n        $(tr).find('span[data-age]').countdown({since: moment.utc(edit.lifeTime).toDate(), compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime});\r\n    }\r\n\r\n    $(tr).effect(\"pulsate\");\r\n}\r\n","tripwire.esi = function() {\r\n    var baseUrl = \"https://esi.tech.ccp.is\";\r\n    var userAgent = \"Tripwire Client \" + tripwire.version + \" (\" + window.location.hostname + \") - \" + window.navigator.userAgent;\r\n    var locationTimer, shipTimer, onlineTimer;\r\n    this.esi.connection = true;\r\n    this.esi.characters = {};\r\n\r\n    var scopeError = function(characterID) {\r\n        $(\"#tracking .tracking-clone[data-characterid='\"+ characterID +\"']\").find(\".alert\").show();\r\n    }\r\n\r\n    this.esi.location = function() {\r\n        clearTimeout(locationTimer);\r\n\r\n        for (characterID in tripwire.esi.characters) {\r\n            var character = tripwire.esi.characters[characterID];\r\n\r\n            // Check for expiring token\r\n            if (moment(character.tokenExpire).subtract(5, \"minutes\").isBefore(moment())) {\r\n                tripwire.data.esi = {\"expired\": true};\r\n                continue;\r\n            }\r\n\r\n            $.ajax({\r\n                url: baseUrl + \"/v1/characters/\"+ characterID +\"/location/?\" + $.param({\"token\": character.accessToken, \"user_agent\": userAgent}),\r\n                // headers: {\"Authorization\": \"Bearer \"+ character.accessToken, \"X-User-Agent\": userAgent},\r\n                type: \"GET\",\r\n                dataType: \"JSON\",\r\n                characterID: characterID\r\n            }).done(function(data, status, xhr) {\r\n                var character = tripwire.esi.characters[this.characterID];\r\n\r\n                if (character) {\r\n                    character.locationDate = moment(xhr.getResponseHeader(\"last-modified\"), \"ddd, DD MMMM YYYY HH:mm:ss\").format();\r\n\r\n                    if (character.systemID != data.solar_system_id) {\r\n                        character.systemID = data.solar_system_id || null;\r\n                        character.systemName = tripwire.systems[data.solar_system_id] ? tripwire.systems[data.solar_system_id].name : null;\r\n\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".system\").html(character.systemName || \"&nbsp;\");\r\n\r\n                        // Send to Tripwire server on next refresh call\r\n                        tripwire.data.tracking[this.characterID] = {\r\n                            characterID: character.characterID,\r\n                            characterName: character.characterName,\r\n                            systemID: character.systemID,\r\n                            systemName: character.systemName,\r\n                            stationID: character.stationID,\r\n                            stationName: character.stationName,\r\n                            shipID: character.shipID,\r\n                            shipName: character.shipName,\r\n                            shipTypeID: character.shipTypeID,\r\n                            shipTypeName: character.shipTypeName};\r\n                    }\r\n\r\n                    if (character.stationID != data.station_id) {\r\n                        character.stationID = data.station_id || null;\r\n\r\n                        if (data.station_id) {\r\n                            tripwire.esi.stationLookup(data.station_id, this.characterID)\r\n                                .always(function(data) {\r\n                                    var character = tripwire.esi.characters[this.reference];\r\n\r\n                                    character.stationName = data.name || null;\r\n                                    $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference +\"']\").find(\".station\").html(data.name.substring(0, 17) + \"...\" || \"&nbsp;\").attr(\"data-tooltip\", data.name);\r\n                                    Tooltips.attach($(\"#tracking .tracking-clone[data-characterid='\"+ this.reference +\"'] .station[data-tooltip]\"));\r\n\r\n                                    // Send to Tripwire server on next refresh call\r\n                                    tripwire.data.tracking[characterID] = {\r\n                                        characterID: character.characterID,\r\n                                        characterName: character.characterName,\r\n                                        systemID: character.systemID,\r\n                                        systemName: character.systemName,\r\n                                        stationID: character.stationID,\r\n                                        stationName: character.stationName,\r\n                                        shipID: character.shipID,\r\n                                        shipName: character.shipName,\r\n                                        shipTypeID: character.shipTypeID,\r\n                                        shipTypeName: character.shipTypeName};\r\n                                });\r\n                        } else {\r\n                            character.stationName = null;\r\n                            // $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".station\").html(\"&nbsp;\").attr(\"data-tooltip\", \"&nbsp;\");\r\n                            Tooltips.detach($(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"'] .station[data-tooltip]\"));\r\n\r\n                            // Send to Tripwire server on next refresh call\r\n                            tripwire.data.tracking[this.characterID] = {\r\n                                characterID: character.characterID,\r\n                                characterName: character.characterName,\r\n                                systemID: character.systemID,\r\n                                systemName: character.systemName,\r\n                                stationID: character.stationID,\r\n                                stationName: character.stationName,\r\n                                shipID: character.shipID,\r\n                                shipName: character.shipName,\r\n                                shipTypeID: character.shipTypeID,\r\n                                shipTypeName: character.shipTypeName};\r\n                        }\r\n                    }\r\n\r\n                    if (options.tracking.active == this.characterID) {\r\n                        tripwire.EVE(tripwire.esi.characters[options.tracking.active]);\r\n                    }\r\n                }\r\n            }).fail(function(data) {\r\n                if (data.status == 403) {\r\n                    tripwire.refresh(\"refresh\", {\"esi\": {\"expired\": true}});\r\n                }\r\n            }).always(function(data, status) {\r\n                if (status != \"success\" && status != \"abort\" && tripwire.esi.connection == true) {\r\n                    tripwire.esi.connection = false;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Failed\", \"red\", false, \"esiConnectionError\");\r\n                } else if (status == \"success\" && tripwire.esi.connection == false) {\r\n                    tripwire.esi.connection = true;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Resumed\", \"green\", 5000, \"esiConnectionSuccess\");\r\n                }\r\n            });\r\n        }\r\n\r\n        locationTimer = setTimeout(\"tripwire.esi.location()\", 5000);\r\n    }\r\n\r\n    this.esi.ship = function() {\r\n        clearTimeout(shipTimer);\r\n\r\n        for (characterID in tripwire.esi.characters) {\r\n            var character = tripwire.esi.characters[characterID];\r\n\r\n            // Check for expiring token\r\n            if (moment(character.tokenExpire).subtract(5, \"minutes\").isBefore(moment())) {\r\n                tripwire.data.esi = {\"expired\": true};\r\n                continue;\r\n            }\r\n\r\n            $.ajax({\r\n                url: baseUrl + \"/v1/characters/\"+ characterID +\"/ship/?\" + $.param({\"token\": character.accessToken, \"user_agent\": userAgent}),\r\n                // headers: {\"Authorization\": \"Bearer \"+ character.accessToken, \"X-User-Agent\": userAgent},\r\n                type: \"GET\",\r\n                dataType: \"JSON\",\r\n                characterID: characterID\r\n            }).done(function(data, status, xhr) {\r\n                var character = tripwire.esi.characters[this.characterID];\r\n\r\n                if (character) {\r\n                    character.shipDate = moment(xhr.getResponseHeader(\"last-modified\"), \"ddd, DD MMMM YYYY HH:mm:ss\").format();\r\n\r\n                    if (character.shipID != data.ship_item_id) {\r\n                        character.shipID = data.ship_item_id || null;\r\n\r\n                        // Send to Tripwire server on next refresh call\r\n                        tripwire.data.tracking[this.characterID] = {\r\n                            characterID: character.characterID,\r\n                            characterName: character.characterName,\r\n                            systemID: character.systemID,\r\n                            systemName: character.systemName,\r\n                            stationID: character.stationID,\r\n                            stationName: character.stationName,\r\n                            shipID: character.shipID,\r\n                            shipName: character.shipName,\r\n                            shipTypeID: character.shipTypeID,\r\n                            shipTypeName: character.shipTypeName};\r\n                    }\r\n\r\n                    if (character.shipName != data.ship_name) {\r\n                        character.shipName = data.ship_name || null;\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".shipname\").html(data.ship_name || \"&nbsp;\");\r\n\r\n                        // Send to Tripwire server on next refresh call\r\n                        tripwire.data.tracking[this.characterID] = {\r\n                            characterID: character.characterID,\r\n                            characterName: character.characterName,\r\n                            systemID: character.systemID,\r\n                            systemName: character.systemName,\r\n                            stationID: character.stationID,\r\n                            stationName: character.stationName,\r\n                            shipID: character.shipID,\r\n                            shipName: character.shipName,\r\n                            shipTypeID: character.shipTypeID,\r\n                            shipTypeName: character.shipTypeName};\r\n                    }\r\n\r\n                    if (character.shipTypeID != data.ship_type_id) {\r\n                        character.shipTypeID = data.ship_type_id || null;\r\n\r\n                        if (data.ship_type_id) {\r\n                            tripwire.esi.typeLookup(data.ship_type_id, this.characterID)\r\n                                .always(function(data) {\r\n                                    var character = tripwire.esi.characters[this.reference];\r\n\r\n                                    character.shipTypeName = data.name || null;\r\n                                    $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference +\"']\").find(\".ship\").html(data.name || \"&nbsp;\");\r\n\r\n                                    // Send to Tripwire server on next refresh call\r\n                                    tripwire.data.tracking[this.characterID] = {\r\n                                        characterID: character.characterID,\r\n                                        characterName: character.characterName,\r\n                                        systemID: character.systemID,\r\n                                        systemName: character.systemName,\r\n                                        stationID: character.stationID,\r\n                                        stationName: character.stationName,\r\n                                        shipID: character.shipID,\r\n                                        shipName: character.shipName,\r\n                                        shipTypeID: character.shipTypeID,\r\n                                        shipTypeName: character.shipTypeName};\r\n                                });\r\n                        } else {\r\n                            character.shipTypeName = null;\r\n                            $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".ship\").html(\"&nbsp;\");\r\n\r\n                            // Send to Tripwire server on next refresh call\r\n                            tripwire.data.tracking[this.characterID] = {\r\n                                characterID: character.characterID,\r\n                                characterName: character.characterName,\r\n                                systemID: character.systemID,\r\n                                systemName: character.systemName,\r\n                                stationID: character.stationID,\r\n                                stationName: character.stationName,\r\n                                shipID: character.shipID,\r\n                                shipName: character.shipName,\r\n                                shipTypeID: character.shipTypeID,\r\n                                shipTypeName: character.shipTypeName};\r\n                        }\r\n                    }\r\n                }\r\n            }).fail(function(data) {\r\n                if (data.status == 403) {\r\n                    tripwire.refresh(\"refresh\", {\"esi\": {\"expired\": true}});\r\n                }\r\n            }).always(function(data, status) {\r\n                if (status != \"success\" && status != \"abort\" && tripwire.esi.connection == true) {\r\n                    tripwire.esi.connection = false;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Failed\", \"red\", false, \"esiConnectionError\");\r\n                } else if (status == \"success\" && tripwire.esi.connection == false) {\r\n                    tripwire.esi.connection = true;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Resumed\", \"green\", 5000, \"esiConnectionSuccess\");\r\n                }\r\n            });\r\n        }\r\n\r\n        shipTimer = setTimeout(\"tripwire.esi.ship()\", 5000);\r\n    }\r\n\r\n    this.esi.online = function() {\r\n        clearTimeout(onlineTimer);\r\n\r\n        for (characterID in tripwire.esi.characters) {\r\n            var character = tripwire.esi.characters[characterID];\r\n\r\n            tripwire.esi.characterStatus(character.characterID, character)\r\n                .done(function(data) {\r\n                    if (data) {\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference.characterID +\"']\").find(\".online\").removeClass(\"critical\").addClass(\"stable\");\r\n                    } else {\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference.characterID +\"']\").find(\".online\").removeClass(\"stable\").addClass(\"critical\");\r\n                    }\r\n                }).fail(function(data) {\r\n                    if (data && data.status == 403) {\r\n                        scopeError(this.reference.characterID);\r\n                    }\r\n                    $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference.characterID +\"']\").find(\".online\").removeClass(\"stable\").addClass(\"critical\");\r\n                });\r\n        }\r\n\r\n        onlineTimer = setTimeout(\"tripwire.esi.online()\", 60000);\r\n    }\r\n\r\n    this.esi.typeLookup = function(typeID, reference) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/universe/types/\"+ typeID +\"/?\" + $.param({\"user_agent\": userAgent}),\r\n            // headers: {\"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            reference: reference\r\n        });\r\n    }\r\n\r\n    this.esi.stationLookup = function(stationID, reference) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/universe/stations/\"+ stationID +\"/?\" + $.param({\"user_agent\": userAgent}),\r\n            // headers: {\"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            reference: reference\r\n        });\r\n    }\r\n\r\n    this.esi.setDestination = function(destinationID, characterID, clear_waypoints, beginning) {\r\n        clear_waypoints = clear_waypoints ? clear_waypoints : false;\r\n        beginning = beginning ? beginning : false;\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/ui/autopilot/waypoint/?\" + $.param({destination_id: destinationID, clear_other_waypoints: clear_waypoints, add_to_beginning: beginning}),\r\n            headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.characters[characterID].accessToken, \"X-User-Agent\": userAgent},\r\n            type: \"POST\",\r\n            dataType: \"JSON\"\r\n        });\r\n    }\r\n\r\n    this.esi.showInfo = function(targetID, characterID) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v1/ui/openwindow/information/?\" + $.param({target_id: targetID}),\r\n            headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.characters[characterID].accessToken, \"X-User-Agent\": userAgent},\r\n            type: \"POST\",\r\n            dataType: \"JSON\"\r\n        });\r\n    }\r\n\r\n    this.esi.characterStatus = function(characterID, reference) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v1/characters/\" + characterID + \"/online/?\" + $.param({\"token\": tripwire.esi.characters[characterID].accessToken, \"user_agent\": userAgent}),\r\n            // headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.characters[characterID].accessToken, \"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            reference: reference\r\n        });\r\n    }\r\n\r\n    this.esi.eveStatus = function() {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v1/status/?\" + $.param({\"user_agent\": userAgent}),\r\n            // headers: {\"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\"\r\n        });\r\n    }\r\n\r\n    this.esi.idLookup = function(eveIDs) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/universe/names/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"POST\",\r\n            dataType: \"JSON\",\r\n            contentType: \"application/json\",\r\n            processData: false,\r\n            data: JSON.stringify(eveIDs)\r\n        });\r\n    }\r\n\r\n    this.esi.characterLookup = function(eveID, reference, async) {\r\n        var async = typeof(async) !== 'undefined' ? async : true;\r\n        return $.ajax({\r\n            url: baseUrl + \"/v4/characters/\" + eveID + \"/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            async: async,\r\n            eveID: eveID,\r\n            reference: reference\r\n        });\r\n    }\r\n\r\n    this.esi.corporationLookup = function(eveID, reference, async) {\r\n        var async = typeof(async) !== 'undefined' ? async : true;\r\n        return $.ajax({\r\n            url: baseUrl + \"/v4/corporations/\" + eveID + \"/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            async: async,\r\n            eveID: eveID,\r\n            reference: reference\r\n        });\r\n    }\r\n\r\n    this.esi.allianceLookup = function(eveID, reference, async) {\r\n        var async = typeof(async) !== 'undefined' ? async : true;\r\n        return $.ajax({\r\n            url: baseUrl + \"/v3/alliances/\" + eveID + \"/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            async: async,\r\n            eveID: eveID,\r\n            reference: reference\r\n        });\r\n    }\r\n\r\n    this.esi.search = function(searchString, categories, strict) {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/search/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            contentType: \"application/json\",\r\n            data: {\"search\": searchString, \"categories\": categories, \"strict\": strict}\r\n        });\r\n    }\r\n\r\n    this.esi.universeJumps = function() {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v1/universe/system_jumps/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\"\r\n        });\r\n    }\r\n\r\n    this.esi.universeKills = function() {\r\n        return $.ajax({\r\n            url: baseUrl + \"/v2/universe/system_kills/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\"\r\n        });\r\n    }\r\n\r\n    // Wrapper to make lookups easier\r\n    this.esi.fullLookup = function(eveIDs) {\r\n        var promise = $.Deferred();\r\n\r\n        tripwire.esi.idLookup(eveIDs)\r\n            .done(function(data) {\r\n                for (item in data) {\r\n                    if (data[item].category == \"character\") {\r\n                        tripwire.esi.characterLookup(data[item].id, data[item], false)\r\n                            .done(function(characterData) {\r\n                                $.extend(data[item], characterData);\r\n                                tripwire.esi.corporationLookup(characterData.corporation_id, this.reference, false)\r\n                                    .done(function(corporationData) {\r\n                                        data[item].corporation = corporationData;\r\n                                        if (corporationData.alliance_id) {\r\n                                            tripwire.esi.allianceLookup(corporationData.alliance_id, this.reference, false)\r\n                                                .done(function(allianceData) {\r\n                                                    data[item].alliance = allianceData;\r\n                                                });\r\n                                        }\r\n                                    });\r\n                            });\r\n                    } else if (data[item].category == \"corporation\") {\r\n                        tripwire.esi.corporationLookup(data[item].id, data[item], false)\r\n                            .done(function(corporationData) {\r\n                                $.extend(data[item], corporationData);\r\n                                if (corporationData.alliance_id) {\r\n                                    tripwire.esi.allianceLookup(corporationData.alliance_id, this.reference, false)\r\n                                        .done(function(allianceData) {\r\n                                            data[item].alliance = allianceData;\r\n                                        });\r\n                                }\r\n                            })\r\n                    }\r\n                }\r\n\r\n                promise.resolve(data);\r\n            });\r\n\r\n        return promise;\r\n    }\r\n\r\n    this.esi.parse = function(characters) {\r\n        for (characterID in tripwire.esi.characters) {\r\n            if (!(characterID in characters)) {\r\n                delete tripwire.esi.characters[characterID];\r\n                $(\"#tracking .tracking-clone[data-characterid='\"+ characterID +\"']\").remove();\r\n                if (options.tracking.active == characterID) {\r\n                    tripwire.EVE(false, true);\r\n                    $(\"#removeESI\").attr(\"disabled\", \"disabled\");\r\n                }\r\n            }\r\n        }\r\n\r\n        for (characterID in characters) {\r\n            if (options.tracking.active == \"new\") {\r\n                options.tracking.active = characterID;\r\n            }\r\n\r\n            if (!(characterID in tripwire.esi.characters)) {\r\n                var $clone = $(\"#tracking-clone\").clone();\r\n                $clone.attr(\"data-characterid\", characterID);\r\n                $clone.find(\".avatar img\").attr(\"src\", \"https://image.eveonline.com/Character/\"+ characterID +\"_32.jpg\");\r\n                $clone.find(\".name\").html(characters[characterID].characterName);\r\n                $clone.removeAttr(\"id\");\r\n                $clone.removeClass(\"hidden\");\r\n                $clone.addClass(\"tracking-clone\");\r\n\r\n                if (options.tracking.active == characterID) {\r\n                    $clone.addClass(\"active\");\r\n                    $(\"#removeESI\").removeAttr(\"disabled\");\t\t\t\t}\r\n\r\n                $(\"#tracking\").append($clone);\r\n                // Tooltips.attach($clone.find(\"[data-tooltip]\"));\r\n            }\r\n\r\n            tripwire.esi.characters[characterID] = characters[characterID];\r\n        }\r\n\r\n        tripwire.esi.ship();\r\n        tripwire.esi.location();\r\n        tripwire.esi.online();\r\n    }\r\n}\r\ntripwire.esi();\r\n","// Handles data from EVE in-game data\r\ntripwire.EVE = function(EVE, characterChange) {\r\n    var systemChange = this.client.EVE && this.client.EVE.systemChange || false;\r\n\r\n    if (EVE) {\r\n        // Automapper\r\n        if (!characterChange) {\r\n            // Did the system change or did it previously and we have yet to try an autoMapper call?\r\n            if ((this.client.EVE && this.client.EVE.systemID != EVE.systemID) || systemChange == true) {\r\n                systemChange = true;\r\n\r\n                // Check if location was updated after the last ship update\r\n                // if (moment(EVE.locationDate).isAfter(moment(this.client.EVE.shipDate))) {\r\n                    systemChange = false;\r\n                    tripwire.autoMapper(this.client.EVE.systemID, EVE.systemID);\r\n                // }\r\n            }\r\n        }\r\n\r\n        // System follower\r\n        if (!characterChange && options.buttons.follow && (this.client.EVE && this.client.EVE.systemID != EVE.systemID) && $(\".ui-dialog:visible\").length == 0) {\r\n            tripwire.systemChange(EVE.systemID);\r\n        }\r\n\r\n        if (!$(\"#search\").hasClass(\"active\")) {\r\n            $(\"#currentSpan\").show();\r\n        }\r\n\r\n        // Enable auto-mapper\r\n        $(\"#toggle-automapper\").removeClass(\"disabled\");\r\n\r\n        // Update current system\r\n        if (EVE.systemID) {\r\n            // add system to Leads To dropdown\r\n            if ($(\"#dialog-signature [data-autocomplete='sigSystems']\").hasClass(\"custom-combobox\")) {\r\n                $(\"#dialog-signature [data-autocomplete='sigSystems']\").inlinecomplete(\"removeFromSelect\");\r\n                $(\"#dialog-signature [data-autocomplete='sigSystems']\").inlinecomplete(\"addToSelect\", tripwire.systems[EVE.systemID].name);\r\n            }\r\n            $(\"#EVEsystem\").html(tripwire.systems[EVE.systemID].name).attr(\"href\", \".?system=\"+ tripwire.systems[EVE.systemID].name);\r\n        }\r\n    } else {\r\n        // Update current system\r\n        $(\"#EVEsystem\").html(\"\");\r\n        $(\"#currentSpan\").hide();\r\n        // Disable automapper\r\n        $(\"#toggle-automapper\").addClass(\"disabled\");\r\n        // remove system from Leads To dropdown\r\n        if ($(\"#dialog-signature [data-autocomplete='sigSystems']\").hasClass(\"custom-combobox\")) {\r\n            $(\"#dialog-signature [data-autocomplete='sigSystems']\").inlinecomplete(\"removeFromSelect\");\r\n        }\r\n    }\r\n\r\n    this.client.EVE = {\r\n        characterID: EVE.characterID,\r\n        characterName: EVE.characterName,\r\n        systemID: EVE.systemID,\r\n        systemName: EVE.systemName,\r\n        shipTypeID: EVE.shipTypeID,\r\n        shipTypeName: EVE.shipTypeName,\r\n        stationID: EVE.stationID,\r\n        stationName: EVE.stationName,\r\n        locationDate: EVE.locationDate,\r\n        shipDate: EVE.shipDate,\r\n        systemChange: systemChange\r\n    };\r\n}\r\n","tripwire.parse = function(server, mode) {\r\n    var data = $.extend(true, {}, server);\r\n\r\n    if (options.chain.active == null || (options.chain.tabs[options.chain.active] && options.chain.tabs[options.chain.active].evescout != true)) {\r\n        if (options.masks.active != \"273.0\") {\r\n            for (var key in data.signatures) {\r\n                if (data.signatures[key].mask == \"273.0\") {\r\n                    delete data.signatures[key];\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    if (mode == 'refresh') {\r\n        this.client = server;\r\n        for (var key in data.signatures) {\r\n            if (data.signatures[key].systemID != viewingSystemID) {\r\n                continue;\r\n            }\r\n            var disabled = data.signatures[key].mask == \"273.0\" && options.masks.active != \"273.0\" ? true : false;\r\n\r\n            // Check for differences\r\n            if (!tripwire.signatures.list[key]) {\r\n                this.addSig(data.signatures[key], {animate: true}, disabled);\r\n            } else if (tripwire.signatures.list[key].modifiedTime !== data.signatures[key].modifiedTime) {\r\n                var edit = false;\r\n                for (column in data.signatures[key]) {\r\n                    if (data.signatures[key][column] != tripwire.signatures.list[key][column] && column != \"editing\") {\r\n                        edit = true;\r\n                    }\r\n                }\r\n\r\n                if (edit) {\r\n                    this.editSig(data.signatures[key], disabled);\r\n                } else {\r\n                    // this.sigEditing(data.signatures[key]);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Sigs needing removal\r\n        for (var key in tripwire.signatures.list) {\r\n            if (!data.signatures[key]) {\r\n                this.deleteSig(key);\r\n            }\r\n        }\r\n    } else if (mode == 'init' || mode == 'change') {\r\n        this.client = server;\r\n\r\n        for (var key in data.signatures) {\r\n            if (data.signatures[key].systemID != viewingSystemID) {\r\n                continue;\r\n            }\r\n            var disabled = data.signatures[key].mask == \"273.0\" && options.masks.active != \"273.0\" ? true : false;\r\n\r\n            this.addSig(data.signatures[key], {animate: false}, disabled);\r\n\r\n            if (data.signatures[key].editing) {\r\n                this.sigEditing(data.signatures[key]);\r\n            }\r\n        }\r\n    }\r\n\r\n    tripwire.signatures.list = data.signatures;\r\n\r\n    // set the sig count in the UI\r\n    var signatureCount = 0;\r\n    $.map(data.signatures, function(signature) {signature.systemID == viewingSystemID ? signatureCount++ : null;});\r\n    $(\"#signature-count\").html(signatureCount);\r\n}\r\n","// Handles pasting sigs from EVE\r\ntripwire.pasteSignatures = function() {\r\n    var processing = false;\r\n\r\n    var rowParse = function(row) {\r\n        var scanner = {};\r\n        var columns = row.split(\"\t\"); // Split by tab\r\n        var validScanGroups = [\"Cosmic Signature\", \"Cosmic Anomaly\", \"Kosmische Anomalie\", \"Kosmische Signatur\",\r\n                                \"Источники сигналов\", \"Космическая аномалия\"];\r\n        var validTypes = {\"Gas Site\": \"Gas\", \"Data Site\": \"Data\", \"Relic Site\": \"Relic\", \"Ore Site\": \"Ore\", \"Combat Site\": \"Combat\", \"Wormhole\": \"Wormhole\",\r\n                            \"Gasgebiet\": \"Gas\", \"Datengebiet\": \"Data\", \"Reliktgebiet\": \"Relic\", \"Mineraliengebiet\": \"Ore\", \"Kampfgebiet\": \"Combat\", \"Wurmloch\": \"Wormhole\",\r\n                            \"ГАЗ: район добычи газа\": \"Gas\", \"ДАННЫЕ: район сбора данных\": \"Data\", \"АРТЕФАКТЫ: район поиска артефактов\": \"Relic\", \"РУДА: район добычи руды\": \"Ore\", \"ОПАСНО: район повышенной опасности\": \"Combat\", \"Червоточина\": \"Wormhole\"};\r\n\r\n        for (var x in columns) {\r\n            if (columns[x].match(/^([A-Z]{3}[-]\\d{3})$/)) {\r\n                scanner.id = columns[x].split(\"-\");\r\n                continue;\r\n            }\r\n\r\n            if (columns[x].match(/(\\d([.|,]\\d)?[ ]?(%))/) || columns[x].match(/(\\d[.|,]?\\d+\\s(AU|AE|km|m|а.е.|км|м))/i)) { // Exclude scan % || AU\r\n                continue;\r\n            }\r\n\r\n            if ($.inArray(columns[x], validScanGroups) != -1) {\r\n                scanner.scanGroup = columns[x];\r\n                continue;\r\n            }\r\n\r\n            if (validTypes[columns[x]]) {\r\n                scanner.type = validTypes[columns[x]];\r\n                continue;\r\n            }\r\n\r\n            if (columns[x] != \"\") {\r\n                scanner.name = columns[x];\r\n            }\r\n        }\r\n\r\n        if (!scanner.id || scanner.id.length !== 2) {\r\n            return false;\r\n        }\r\n\r\n        return scanner;\r\n    }\r\n\r\n    this.pasteSignatures.parsePaste = function(paste) {\r\n        var paste = paste.split(\"\\n\");\r\n        var payload = {\"signatures\": {\"add\": [], \"update\": []}, \"systemID\": viewingSystemID};\r\n        var undo = [];\r\n        processing = true;\r\n\r\n        for (var i in paste) {\r\n            var scanner = rowParse(paste[i]);\r\n\r\n            if (scanner.id) {\r\n                var signature = $.map(tripwire.client.signatures, function(signature) { if (signature.signatureID && signature.signatureID.toUpperCase() == scanner.id[0] + scanner.id[1]) return signature; })[0];\r\n                if (signature) {\r\n                    // Update signature (only non-wormholes can be updated to a wormhole)\r\n                    if (scanner.type == \"Wormhole\" && signature.type != \"wormhole\") {\r\n                        var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0] || {};\r\n                        var otherSignature = wormhole.id ? (signature.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID]) : {};\r\n                        payload.signatures.update.push({\r\n                            \"wormhole\": {\r\n                                \"id\": wormhole.id || null,\r\n                                \"type\": wormhole.type || null,\r\n                                \"life\": wormhole.life || \"stable\",\r\n                                \"mass\": wormhole.mass || \"stable\"\r\n                            },\r\n                            \"signatures\": [\r\n                                {\r\n                                    \"id\": signature.id,\r\n                                    \"signatureID\": signature.signatureID,\r\n                                    \"systemID\": viewingSystemID,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"name\": signature.name\r\n                                },\r\n                                {\r\n                                    \"id\": otherSignature.id || null,\r\n                                    \"signatureID\": otherSignature.signatureID || null,\r\n                                    \"systemID\": otherSignature.systemID || null,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"name\": otherSignature.name\r\n                                }\r\n                            ]\r\n                        });\r\n\r\n                        if (tripwire.client.wormholes[wormhole.id]) {\r\n\t\t\t\t\t\t\tundo.push({\"wormhole\": tripwire.client.wormholes[wormhole.id], \"signatures\": [tripwire.client.signatures[signature.id], tripwire.client.signatures[otherSignature.id]]});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// used to be just a regular signature\r\n\t\t\t\t\t\t\tundo.push(tripwire.client.signatures[signature.id]);\r\n\t\t\t\t\t\t}\r\n                    // Make sure we are only updating when we have new info (we never turn wormholes into regular signatures)\r\n                    } else if (signature.type != \"wormhole\" && ((scanner.type && scanner.type.toLowerCase() != signature.type) || (scanner.name && scanner.name != signature.name))) {\r\n                        payload.signatures.update.push({\r\n                            \"id\": signature.id,\r\n                            \"systemID\": viewingSystemID,\r\n                            \"type\": scanner.type || 'unknown',\r\n                            \"name\": scanner.name,\r\n                            \"lifeLength\": options.signatures.pasteLife * 60 * 60\r\n                        });\r\n                        undo.push(tripwire.client.signatures[signature.id]);\r\n                    }\r\n                } else {\r\n                    // Add signature\r\n                    if (scanner.type == \"Wormhole\") {\r\n                        payload.signatures.add.push({\r\n                            \"wormhole\": {\r\n                                \"type\": null,\r\n                                \"parent\": \"initial\",\r\n                                \"life\": \"stable\",\r\n                                \"mass\": \"stable\"\r\n                            },\r\n                            \"signatures\": [\r\n                                {\r\n                                    \"signatureID\": scanner.id[0] + scanner.id[1],\r\n                                    \"systemID\": viewingSystemID,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"lifeLength\": options.signatures.pasteLife * 60 * 60\r\n                                },\r\n                                {\r\n                                    \"signatureID\": null,\r\n                                    \"systemID\": null,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"lifeLength\": options.signatures.pasteLife * 60 * 60\r\n                                }\r\n                            ]\r\n                        });\r\n                    } else {\r\n                        payload.signatures.add.push({\r\n                            \"signatureID\": scanner.id[0] + scanner.id[1],\r\n                            \"systemID\": viewingSystemID,\r\n                            \"type\": scanner.type || 'unknown',\r\n                            \"name\": scanner.name,\r\n                            \"lifeLength\": options.signatures.pasteLife * 60 * 60\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (payload.signatures.add.length || payload.signatures.update.length) {\r\n            var success = function(data) {\r\n                if (data.resultSet && data.resultSet[0].result == true) {\r\n                    $(\"#undo\").removeClass(\"disabled\");\r\n\r\n                    if (data.results) {\r\n                        if (viewingSystemID in tripwire.signatures.undo) {\r\n                            tripwire.signatures.undo[viewingSystemID].push({action: \"add\", signatures: data.results});\r\n                        } else {\r\n                            tripwire.signatures.undo[viewingSystemID] = [{action: \"add\", signatures: data.results}];\r\n                        }\r\n                    }\r\n\r\n                    if (undo.length) {\r\n                        if (viewingSystemID in tripwire.signatures.undo) {\r\n                            tripwire.signatures.undo[viewingSystemID].push({action: \"update\", signatures: undo});\r\n\t\t\t\t\t\t} else {\r\n                            tripwire.signatures.undo[viewingSystemID] = [{action: \"update\", signatures: undo}];\r\n\t\t\t\t\t\t}\r\n                    }\r\n\r\n                    sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n                }\r\n            }\r\n\r\n            var always = function(data) {\r\n                processing = false;\r\n            }\r\n\r\n            tripwire.refresh('refresh', payload, success, always);\r\n        } else {\r\n            processing = false;\r\n        }\r\n    }\r\n\r\n    this.pasteSignatures.init = function() {\r\n        $(document).keydown(function(e)\t{\r\n            if ((e.metaKey || e.ctrlKey) && (e.keyCode == 86 || e.keyCode == 91) && !processing) {\r\n                //Abort - user is in input or textarea\r\n                if ($(document.activeElement).is(\"textarea, input\")) return;\r\n\r\n                $(\"#clipboard\").focus();\r\n            }\r\n        });\r\n\r\n        $(\"body\").on(\"click\", \"#fullPaste\", function(e) {\r\n            e.preventDefault();\r\n\r\n            var paste = $(this).data(\"paste\").split(\"\\n\");\r\n            var pasteIDs = [];\r\n            var removes = [];\r\n            var undo = [];\r\n\r\n            for (var i in paste) {\r\n                if (scan = rowParse(paste[i])) {\r\n                    pasteIDs.push((scan.id[0] + scan.id[1]).toLowerCase());\r\n                }\r\n            }\r\n\r\n            for (var i in tripwire.client.signatures) {\r\n                var signature = tripwire.client.signatures[i];\r\n\r\n                if (signature.systemID == viewingSystemID && signature.signatureID && $.inArray(signature.signatureID.toLowerCase(), pasteIDs) === -1 && signature.signatureID !== \"???\") {\r\n                    if (signature.type == \"wormhole\") {\r\n                        var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0] || {};\r\n                        var otherSignature = wormhole.id ? (signature.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID]) : {};\r\n                        if (wormhole.type !== \"GATE\") {\r\n                            removes.push(wormhole);\r\n                            undo.push({\"wormhole\": wormhole, \"signatures\": [signature, otherSignature]});\r\n                        }\r\n                    } else {\r\n                        removes.push(signature.id);\r\n                        undo.push(signature);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (removes.length > 0) {\r\n                var payload = {\"signatures\": {\"remove\": removes}};\r\n\r\n                var success = function(data) {\r\n                    if (data.resultSet && data.resultSet[0].result == true) {\r\n                        $(\"#undo\").removeClass(\"disabled\");\r\n                        if (viewingSystemID in tripwire.signatures.undo) {\r\n                            tripwire.signatures.undo[viewingSystemID].push({action: \"remove\", signatures: undo});\r\n                        } else {\r\n                            tripwire.signatures.undo[viewingSystemID] = [{action: \"remove\", signatures: undo}];\r\n                        }\r\n\r\n                        sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n                    }\r\n                }\r\n\r\n                tripwire.refresh('refresh', payload, success);\r\n            }\r\n        });\r\n\r\n        $(\"#clipboard\").on(\"paste\", function(e) {\r\n            e.preventDefault();\r\n            var paste = window.clipboardData ? window.clipboardData.getData(\"Text\") : (e.originalEvent || e).clipboardData.getData('text/plain');\r\n\r\n            $(\"#clipboard\").blur();\r\n            Notify.trigger(\"Paste detected<br/>(<a id='fullPaste' href=''>Click to delete missing sigs</a>)\");\r\n            $(\"#fullPaste\").data(\"paste\", paste);\r\n            tripwire.pasteSignatures.parsePaste(paste);\r\n        });\r\n    }\r\n\r\n    this.pasteSignatures.init();\r\n}\r\ntripwire.pasteSignatures();\r\n","tripwire.redo = function() {\r\n    if (tripwire.signatures.redo[viewingSystemID].length > 0) {\r\n        $(\"#redo\").addClass(\"disabled\");\r\n        var lastIndex = tripwire.signatures.redo[viewingSystemID].length -1;\r\n        var data = {\"systemID\": viewingSystemID, \"signatures\": {\"add\": [], \"remove\": [], \"update\": []}};\r\n\r\n        var redoItem = tripwire.signatures.redo[viewingSystemID][lastIndex];\r\n        var undo = $.map(redoItem.signatures, function(signature) {\r\n            // grab the current signature so we can restore the way it is now\r\n            if (signature.wormhole && tripwire.client.wormholes[signature.wormhole.id]) {\r\n                // it was a wormhole and still is\r\n                return {\"wormhole\": tripwire.client.wormholes[signature.wormhole.id], \"signatures\": [tripwire.client.signatures[signature.signatures[0].id], tripwire.client.signatures[signature.signatures[1].id]]};\r\n            } else if (tripwire.client.signatures[signature.id] && tripwire.client.signatures[signature.id].type == \"wormhole\") {\r\n                // it was a regular signature but is now a wormhole\r\n                var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n                return {\"wormhole\": wormhole, \"signatures\": [tripwire.client.signatures[wormhole.initialID], tripwire.client.signatures[wormhole.secondaryID]]};\r\n            } else if (signature.wormhole && tripwire.client.signatures[signature.signatures[0].id]) {\r\n                // it was a wormhole but is now a regular signature\r\n                return tripwire.client.signatures[signature.signatures[0].id];\r\n            } else {\r\n                // it was a regular signature and still is\r\n                return tripwire.client.signatures[signature.id];\r\n            }\r\n        });\r\n\r\n        switch(redoItem.action) {\r\n            case \"add\":\r\n                data.signatures.add = data.signatures.add.concat(redoItem.signatures);\r\n                break;\r\n            case \"remove\":\r\n                data.signatures.remove = data.signatures.remove.concat($.map(redoItem.signatures, function(signature) { return signature.wormhole ? signature.wormhole : signature.id }));\r\n                break;\r\n            case \"update\":\r\n                data.signatures.update = data.signatures.update.concat(redoItem.signatures);\r\n                break;\r\n        }\r\n\r\n        var success = function(data) {\r\n            if (data.resultSet && data.resultSet[0].result == true) {\r\n                tripwire.signatures.redo[viewingSystemID].pop();\r\n\r\n                $(\"#undo\").removeClass(\"disabled\");\r\n                if (viewingSystemID in tripwire.signatures.undo) {\r\n                    if (redoItem.action == \"add\") {\r\n                        // we are adding new signatures we removed so we need the new ids\r\n                        tripwire.signatures.undo[viewingSystemID].push({\"action\": redoItem.action, \"signatures\": data.results});\r\n                    } else if (redoItem.action == \"update\") {\r\n                        tripwire.signatures.undo[viewingSystemID].push({\"action\": redoItem.action, \"signatures\": undo});\r\n                    } else {\r\n                        tripwire.signatures.undo[viewingSystemID].push({action: redoItem.action, signatures: redoItem.signatures});\r\n                    }\r\n                } else {\r\n                    if (redoItem.action == \"add\") {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{\"action\": redoItem.action, \"signatures\": data.results}];\r\n                    } else if (redoItem.action == \"update\") {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{\"action\": redoItem.action, \"signatures\": undo}];\r\n                    } else {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{action: redoItem.action, signatures: redoItem.signatures}];\r\n                    }\r\n                }\r\n\r\n                sessionStorage.setItem(\"tripwire_redo\", JSON.stringify(tripwire.signatures.redo));\r\n                sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n            }\r\n        }\r\n\r\n        var always = function(data) {\r\n            if (tripwire.signatures.redo[viewingSystemID].length > 0) {\r\n                $(\"#redo\").removeClass(\"disabled\");\r\n            }\r\n        }\r\n\r\n        tripwire.refresh('refresh', data, success, always);\r\n    }\r\n}\r\n","// Handles pulling TQ status & player count\r\ntripwire.serverStatus = function() {\r\n    this.data;\r\n    this.timer;\r\n\r\n    clearTimeout(tripwire.serverStatus.timer);\r\n\r\n    tripwire.esi.eveStatus()\r\n        .always(function(data) {\r\n            if (data && data.players && data.players > 0) {\r\n                if (!tripwire.serverStatus.data || tripwire.serverStatus.data.players !== data.players) {\r\n                    $('#serverStatus').html(\"<span class='\"+(data.players > 0 ? 'stable' : 'critical')+\"'>TQ</span>: \"+numFormat(data.players));\r\n\r\n                    if (tripwire.serverStatus.data) {\r\n                        $(\"#serverStatus\").effect('pulsate', {times: 5});\r\n                    }\r\n                }\r\n\r\n                tripwire.serverStatus.data = data;\r\n            } else {\r\n                $('#serverStatus').html(\"<span class='critical'>TQ</span>\");\r\n            }\r\n\r\n            tripwire.serverStatus.timer = setTimeout(\"tripwire.serverStatus();\", 15000);\r\n        });\r\n}\r\ntripwire.serverStatus();\r\n","tripwire.sync = function(mode, data, successCallback, alwaysCallback) {\r\n    var data = typeof(data) === \"object\" ? $.extend(true, {}, data) : {};\r\n\r\n    // Grab any pending changes\r\n    $.extend(true, data, tripwire.data);\r\n\r\n    // Remove old timer to prevent multiple\r\n    if (this.timer) clearTimeout(this.timer);\r\n    if (this.xhr) this.xhr.abort();\r\n\r\n    if (mode == 'refresh' || mode == 'change') {\r\n        data.signatureCount = Object.size(this.client.signatures);\r\n        data.signatureTime = Object.maxTime(this.client.signatures, \"modifiedTime\");\r\n\r\n        data.flareCount = chain.data.flares ? chain.data.flares.flares.length : 0;\r\n        data.flareTime = chain.data.flares ? chain.data.flares.last_modified : 0;\r\n\r\n        data.commentCount = Object.size(this.comments.data);\r\n        data.commentTime = Object.maxTime(this.comments.data, \"modified\");\r\n\r\n        data.activity = this.activity;\r\n    } else {\r\n        // Expand Tripwire with JSON data from EVE Data Dump and other static data\r\n        $.extend(this, appData);\r\n\r\n        this.aSystems = $.map(this.systems, function(system) { return system.name; });\r\n        this.aSigSystems = [\"Null-Sec\", \"Low-Sec\", \"High-Sec\", \"Class-1\", \"Class-2\", \"Class-3\", \"Class-4\", \"Class-5\", \"Class-6\"];\r\n        $.merge(this.aSigSystems, this.aSystems.slice());\r\n\r\n        $(\".systemsAutocomplete\").inlinecomplete({source: this.aSystems, maxSize: 10, delay: 0});\r\n    }\r\n\r\n    data.mode = mode != \"init\" ? \"refresh\" : \"init\";\r\n    data.systemID = viewingSystemID;\r\n    data.systemName = viewingSystem;\r\n    data.instance = tripwire.instance;\r\n    data.version = tripwire.version;\r\n\r\n    this.xhr = $.ajax({\r\n        url: \"refresh.php\",\r\n        data: data,\r\n        type: \"POST\",\r\n        dataType: \"JSON\",\r\n        cache: false\r\n    }).done(function(data) {\r\n        if (data) {\r\n            tripwire.server = data;\r\n\r\n            // Purge bad wormhole signatures\r\n            for (var i in data.signatures) {\r\n              if (data.signatures[i].type == \"wormhole\") {\r\n                var hasWormhole = false;\r\n                var hasInitial = false;\r\n                var hasSecondary = false;\r\n                var wormholeID = null;\r\n                for (var x in data.wormholes) {\r\n                  if (data.wormholes[x].initialID == data.signatures[i].id) {\r\n                    hasInitial = true;\r\n                    hasWormhole = true;\r\n                    wormholeID = data.wormholes[x].id;\r\n                    if (data.signatures[parseInt(data.wormholes[x].secondaryID)]) {\r\n                      hasSecondary = true;\r\n                    }\r\n                  } else if (data.wormholes[x].secondaryID == data.signatures[i].id) {\r\n                    hasSecondary = true;\r\n                    hasWormhole = true;\r\n                    wormholeID = data.wormholes[x].id;\r\n                    if (data.signatures[parseInt(data.wormholes[x].initialID)]) {\r\n                      hasInitial = true;\r\n                    }\r\n                  }\r\n                }\r\n\r\n                if (!hasWormhole || !hasSecondary || !hasInitial) {\r\n                  delete data.signatures[i];\r\n                  if (wormholeID) {\r\n                    delete data.wormholes[wormholeID];\r\n                  }\r\n                }\r\n              }\r\n            }\r\n\r\n            if (data.esi) {\r\n                tripwire.esi.parse(data.esi);\r\n            }\r\n\r\n            if (data.sync) {\r\n                tripwire.serverTime.time = new Date(data.sync);\r\n            }\r\n\r\n            if (data.signatures) {\r\n                tripwire.parse(data, mode);\r\n            }\r\n\r\n            if (data.comments) {\r\n                tripwire.comments.parse(data.comments);\r\n            }\r\n\r\n            if (data.wormholes || data.occupied || data.flares) {\r\n                tripwire.chainMap.parse({\"map\": data.wormholes || null, \"occupied\": data.occupied || null, \"flares\": data.flares || null});\r\n            } else if (chain.data.occupied && chain.data.occupied.length && !data.occupied) {\r\n                // send update to remove all occupied system indicators\r\n                tripwire.chainMap.parse({\"occupied\": []});\r\n            }\r\n\r\n            tripwire.active(data.activity);\r\n\r\n            if (data.notify && !$(\"#serverNotification\")[0]) Notify.trigger(data.notify, \"yellow\", false, \"serverNotification\");\r\n        }\r\n\r\n        tripwire.data = {tracking: {}, esi: {}};\r\n        successCallback ? successCallback(data) : null;\r\n    }).always(function(data, status) {\r\n        tripwire.timer = setTimeout(\"tripwire.refresh();\", tripwire.refreshRate);\r\n\r\n        alwaysCallback ? alwaysCallback(data) : null;\r\n\r\n        if (data.status == 403) {\r\n            window.location.href = \".\";\r\n        } else if (status != \"success\" && status != \"abort\" && tripwire.connected == true) {\r\n            tripwire.connected = false;\r\n            $(\"#ConnectionSuccess\").click();\r\n            Notify.trigger(\"Error syncing with server\", \"red\", false, \"connectionError\");\r\n        } else if (status == \"success\" && tripwire.connected == false) {\r\n            tripwire.connected = true;\r\n            $(\"#connectionError\").click();\r\n            Notify.trigger(\"Successfully reconnected with server\", \"green\", 5000, \"connectionSuccess\");\r\n        }\r\n    });\r\n\r\n    return true;\r\n}\r\ntripwire.sync(\"init\");\r\n","// Change the currently viewed system\r\ntripwire.systemChange = function(systemID, mode) {\r\n    if (mode != \"init\") {\r\n        $(\"#infoSecurity\").removeClass();\r\n        $(\"#infoStatics\").empty();\r\n\r\n        viewingSystem = tripwire.systems[systemID].name;\r\n        viewingSystemID = systemID;\r\n\r\n        // Reset activity\r\n        activity.refresh(true);\r\n\r\n        // Reset signatures\r\n        $(\"#sigTable span[data-age]\").countdown(\"destroy\");\r\n        $(\"#sigTable tbody\").empty();\r\n        $(\"#signature-count\").html(0);\r\n        tripwire.signatures.list = {};\r\n        tripwire.client.signatures = null;\r\n\r\n        // Reset chain map\r\n        chain.redraw();\r\n\r\n        // Reset comments\r\n        $(\"#notesWidget .content .comment:visible\").remove();\r\n        tripwire.comments.data = null;\r\n\r\n        // Change the URL & history\r\n        history.replaceState(null, null, \"?system=\"+viewingSystem);\r\n\r\n        tripwire.refresh(\"change\");\r\n    }\r\n\r\n    // Change the title\r\n    document.title = tripwire.systems[systemID].name + \" - \" + app_name;\r\n\r\n    $(\"#infoSystem\").text(tripwire.systems[systemID].name);\r\n\r\n    // Current system favorite\r\n    $.inArray(parseInt(viewingSystemID), options.favorites) != -1 ? $(\"#system-favorite\").attr(\"data-icon\", \"star\").addClass(\"active\") : $(\"#system-favorite\").attr(\"data-icon\", \"star-empty\").removeClass(\"active\");\r\n\r\n    if (tripwire.systems[systemID].class) {\r\n        // Security\r\n        $(\"#infoSecurity\").html(\"<span class='wh pointer'>Class \" + tripwire.systems[systemID].class + \"</span>\");\r\n\r\n        // Effects\r\n        if (tripwire.systems[systemID].effect) {\r\n            var tooltip = \"<table cellpadding=\\\"0\\\" cellspacing=\\\"1\\\">\";\r\n            for (var x in tripwire.effects[tripwire.systems[systemID].effect]) {\r\n                var effect = tripwire.effects[tripwire.systems[systemID].effect][x].name;\r\n                var base = tripwire.effects[tripwire.systems[systemID].effect][x].base;\r\n                var bad = tripwire.effects[tripwire.systems[systemID].effect][x].bad;\r\n                var whClass = tripwire.systems[systemID].class > 6 ? 6 : tripwire.systems[systemID].class;\r\n                var modifier = 0;\r\n\r\n                switch (Math.abs(base)) {\r\n                    case 15:\r\n                        modifier = base > 0 ? 7 : -7;\r\n                        break;\r\n                    case 30:\r\n                        modifier = base > 0 ? 14 : -14;\r\n                        break;\r\n                    case 60:\r\n                        modifier = base > 0 ? 28 : -28;\r\n                        break;\r\n                }\r\n\r\n                tooltip += \"<tr><td>\" + effect + \"</td><td style=\\\"padding-left: 25px; text-align: right;\\\" class=\\\"\" + (bad ? \"critical\" : \"stable\") + \"\\\">\";\r\n                tooltip += base + (modifier * (whClass -1)) + \"%</td></tr>\";\r\n            }\r\n            tooltip += \"</table>\";\r\n            $(\"#infoSecurity\").append(\"&nbsp;<span class='pointer' data-tooltip='\" + tooltip + \"'>\" + tripwire.systems[systemID].effect + \"</span>\");\r\n            Tooltips.attach($(\"#infoSecurity [data-tooltip]\"));\r\n        }\r\n\r\n        // Statics\r\n        for (var x in tripwire.systems[systemID].statics) {\r\n            var type = tripwire.systems[systemID].statics[x];\r\n            var wormhole = tripwire.wormholes[type];\r\n            var color = \"wh\";\r\n\r\n            switch (wormhole.leadsTo) {\r\n                case \"High-Sec\":\r\n                    color = \"hisec\";\r\n                    break;\r\n                case \"Low-Sec\":\r\n                    color = \"lowsec\";\r\n                    break;\r\n                case \"Null-Sec\":\r\n                    color = \"nullsec\";\r\n                    break;\r\n            }\r\n\r\n            $(\"#infoStatics\").append(\"<div><span class='\"+ color +\"'>&#9679;</span> <b>\"+ wormhole.leadsTo +\"</b> via <span class='\"+ color +\"'>\"+ type +\"</span></div>\");\r\n        }\r\n\r\n        // Faction\r\n        $(\"#infoFaction\").html(\"&nbsp;\");\r\n    } else {\r\n        // Security\r\n        if (tripwire.systems[systemID].security >= 0.45) {\r\n            $(\"#infoSecurity\").addClass(\"hisec\").text(\"High-Sec \" + tripwire.systems[systemID].security);\r\n        } else if (tripwire.systems[systemID].security > 0.0) {\r\n            $(\"#infoSecurity\").addClass(\"lowsec\").text(\"Low-Sec \" + tripwire.systems[systemID].security);\r\n        } else {\r\n            $(\"#infoSecurity\").addClass(\"nullsec\").text(\"Null-Sec \" + tripwire.systems[systemID].security);\r\n        }\r\n\r\n        // Faction\r\n        $(\"#infoFaction\").html(tripwire.systems[systemID].factionID ? tripwire.factions[tripwire.systems[systemID].factionID].name : \"&nbsp;\");\r\n    }\r\n\r\n    // Region\r\n    $(\"#infoRegion\").text(tripwire.regions[tripwire.systems[systemID].regionID].name);\r\n\r\n    // Info Links\r\n    $(\"#infoWidget .infoLink\").each(function() {\r\n        this.href = $(this).data(\"href\").replace(/\\$systemName/gi, tripwire.systems[systemID].name).replace(/\\$systemID/gi, systemID);\r\n    });\r\n\r\n    // Reset undo/redo\r\n    tripwire.signatures.undo[systemID] && tripwire.signatures.undo[systemID].length > 0 ? $(\"#undo\").removeClass(\"disabled\") : $(\"#undo\").addClass(\"disabled\");\r\n    tripwire.signatures.redo[systemID] && tripwire.signatures.redo[systemID].length > 0 ? $(\"#redo\").removeClass(\"disabled\") : $(\"#redo\").addClass(\"disabled\");\r\n\r\n    // Reset delete signature icon\r\n    $(\"#sigTable tr.selected\").length == 0 ? $(\"#signaturesWidget #delete-signature\").addClass(\"disabled\") : $(\"#signaturesWidget #delete-signature\").removeClass(\"disabled\");\r\n}\r\ntripwire.systemChange(viewingSystemID, \"init\");\r\n","var tutorial;\r\n\r\n// infoWidget\r\n$(\"#infoWidget .tutorial\").click(function() {\r\n    tutorial = introJs().setOptions({\r\n        showStepNumbers: false,\r\n        steps: [\r\n            {\r\n                element: document.querySelector(\"#infoWidget\"),\r\n                intro: \"<h4>System information widget</h4><br/><p>Displays information on the currently <b>selected</b> Tripwire system.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#infoGeneral\"),\r\n                intro: \"<p>This section includes:<br/>System Name<br/>Security Rating<br/>Region<br/>Owning Faction Name</p><br/><p>If the selected system is a wormhole with a system effect, that will also be shown - hover over it to view the effect breakdown.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#activityGraph\"),\r\n                intro: \"<p>This is the graph containing historical ship jump and kill information from the EVE API.</p><br/><p>This data is only available for K-Space systems and not wormhole systems.</p><br/><p>The EVE API updates this data each hour, so this graph will update itself at the top of every hour.</p>\"\r\n            },\r\n            {\r\n                element: $(\"#activityGraph svg > g > g:nth-child(5)\")[0],\r\n                intro: \"<p>Each category can be toggled by clicking these keys to drill down the graph into finer detail.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#activityGraphControls\"),\r\n                intro: \"<p>Select different lengths of historical data to adjust the graph to display more or less information.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#infoStatics\"),\r\n                intro: \"<p>If a wormhole system is selected, the publicaly known static wormholes will appear here.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#infoLinks\"),\r\n                intro: \"<p>These are some quick links to various sites for this specific system.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#system-favorite\"),\r\n                intro: \"<p>This toggles wether this is a 'favorite' system, orange is active.</p><br/><p>'Favorite' systems can be rendered in the chain map to be able to see how far away trade hub systems are from your wormhole chain K-Space exits.</p>\"\r\n            }\r\n        ]\r\n    }).start();\r\n});\r\n\r\n// signaturesWidget\r\n$(\"#signaturesWidget .tutorial\").click(function() {\r\n    tutorial = introJs().setOptions({\r\n        showStepNumbers: false,\r\n        steps: [\r\n            {\r\n                element: document.querySelector(\"#signaturesWidget\"),\r\n                intro: \"<h4>System signatures widget</h4><br/><p>Displays all signatures and wormholes in the currently <b>selected</b> Tripwire system.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#add-signature\"),\r\n                intro: \"<p>Add new signatures and wormholes manually by clicking the + icon.</p><br/><p>Copy & Paste EVE scanner results anywhere once Tripwire has focus to add or update signatures, repeated pastes will only update with new information.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#delete-signature\"),\r\n                intro: \"<p>Click here or use the keyboard shortcut <b>DELETE</b> to delete <b>selected</b> signatures from this system.</p><br/><p>Click on a row to select it, click multiple rows to delete multiple signatures at once, click a selected row again to unselect it.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#signature-count\"),\r\n                intro: \"<p>This shows the current count of signatures, including wormholes, in the selected system.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#undo\"),\r\n                intro: \"<p>Click here or use the keyboard shortcut <b>CTRL-Z</b> to undo the last changes you made in this sytem (this includes clipboard pasted changes).</p><br/><p>You can undo multiple times as history is kept in the browser.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#redo\"),\r\n                intro: \"<p>Click here or use the keyboard shortcut <b>CTRL-Y</b> to redo the last changes you made in this system (this includes clipboard pasted changes).</p><br/><p>You can redo multiple times as history is kept in the browser.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#toggle-automapper\"),\r\n                intro: \"<p>Click here to toggle the Auto-mapper feature on (orange) or off.</p><br/><p>This feature only works when an in-game character is being actively tracked, otherwise this icon appears disabled.</p><br/><p>The automapper will watch for a change in your in-game system not via a star gate and try to automatically add or update wormholes.</p><br/><p>First it tries to seach for wormholes already added but missing a leads to system, this includes via wormhole type (B274) or with a leads to of 'High-Sec' for example.</p><br/><p>Next it searches for wormholes without any type or leads to at all.</p><br/><p>Finally if there are no wormholes or they all have a leads to system already, it will add a new wormhole.</p><br/><p>If at any time if finds multiple wormholes it can update, a dialog window will appear asking which wormhole you want to update.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#sigTable\"),\r\n                intro: \"<p>Each column can be sorted by clicking the column label, sort by multiple columns by holding the shift key.</p><br/><p>Right-click a column to change the text-alignment.</p>\"\r\n            }\r\n        ]\r\n    }).start();\r\n});\r\n\r\n// notesWidget\r\n$(\"#notesWidget .tutorial\").click(function(e) {\r\n    e.preventDefault();\r\n\r\n    tutorial = introJs().setOptions({\r\n        showStepNumbers: false,\r\n        exitOnEsc: false,\r\n        exitOnOverlayClick: false,\r\n        skipLabel: \"Abort\",\r\n        steps: [\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<h4>System notes widget</h4><br/><p>Displays comments based on the currently <b>selected</b> Tripwire system.</p><br/><p>The rest of this tutorial will guide you through actually adding a comment, but don't worry we will switch you to your private Tripwire mask so we don't disturb anyone else.</p><br/><p>When you finish or leave this tutorial we will switch you back to your previous Tripwire mask.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#add-comment\"),\r\n                intro: \"<p>Now click the + icon to begin adding a new comment in this system (\" + viewingSystem + \").</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>Type some basic text now and click save.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>This is our newly created comment. Hover over the comment with your mouse to see additional information and controls.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>You can click the 'pin' or 'sticky' button to toggle showing this comment for every system, not just this system.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>Use the <b>Edit</b> to modify a comment and <b>Delete</b> to remove a comment.</p><br/><p>You can also quickly edit any comment by simply doubling clicking anywhere on it.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>Click on the <b>Edit</b> now on our comment.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>The toolbar at the top allows you to customize your notes.</p><br/><p>You can also click on the <b>Maximize/Minimize</b> button (the far right toolbar icon) to edit this comment in full screen mode.</p><br/><p>In full screen mode you will see 1 new button added to the toolbar to view the source code of the comment where you can write HTML, CSS, and even Javascript in your notes!</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>This concludes the tutorial, we will now switch you back to your previous Tripwire mask and delete the comment we created.</p>\"\r\n            }\r\n        ]\r\n    }).start();\r\n\r\n    tutorial.onchange(function(element) {\r\n        switch(tutorial._currentStep) {\r\n            case 1:\r\n                $(\".introjs-prevbutton, .introjs-nextbutton\").hide();\r\n\r\n                console.log(\"switch mask to private\");\r\n                tutorial.previousMask = options.masks.active;\r\n                options.masks.active = options.character.id + \".1\";\r\n                options.save();\r\n\r\n                tutorial.stepFunc = function() {\r\n                    setTimeout(function() {\r\n                        tutorial._options.steps[2].element = $(\"#notesWidget\").find(\".comment:has(.cke_toolbar)\")[0];\r\n                        tutorial.setOption(\"steps\", tutorial._options.steps);\r\n\r\n                        tutorial.exiting = false;\r\n                        tutorial.exit().start().goToStep(3);\r\n                        tutorial.exiting = true;\r\n                    }, 200);\r\n                }\r\n\r\n                $(\"#notesWidget #add-comment\").on(\"click\", tutorial.stepFunc);\r\n                break;\r\n            case 2:\r\n                $(\".introjs-prevbutton, .introjs-nextbutton\").hide();\r\n                $(\"#notesWidget #add-comment\").off(\"click\", tutorial.stepFunc);\r\n\r\n                tutorial.stepFunc = function() {\r\n                    tutorial.comment = $(this).closest(\".comment\");\r\n                    setTimeout(function() {\r\n                        tutorial._options.steps[3].element = tutorial.comment[0];\r\n                        tutorial._options.steps[4].element = tutorial.comment.find(\".commentSticky\")[0];\r\n                        tutorial._options.steps[5].element = tutorial.comment.find(\".commentControls\")[0];\r\n                        tutorial._options.steps[6].element = tutorial.comment.find(\".commentControls\")[0];\r\n                        tutorial.setOption(\"steps\", tutorial._options.steps);\r\n\r\n                        tutorial.exiting = false;\r\n                        tutorial.exit().start().goToStep(4);\r\n                        tutorial.exiting = true;\r\n                    }, 200);\r\n                }\r\n\r\n                $(\"#notesWidget\").on(\"click\", \".commentSave\", tutorial.stepFunc);\r\n                break;\r\n            case 6:\r\n                $(\".introjs-prevbutton, .introjs-nextbutton\").hide();\r\n                $(\"#notesWidget\").off(\"click\", \".commentSave\", tutorial.stepFunc);\r\n\r\n                tutorial.stepFunc = function() {\r\n                    setTimeout(function() {\r\n                        tutorial._options.steps[7].element = $(\"#notesWidget\").find(\".comment:has(.cke_toolbar)\")[0];\r\n                        tutorial._options.steps[8].element = $(\"#notesWidget\").find(\".comment:has(.cke_toolbar)\")[0];\r\n                        tutorial.setOption(\"steps\", tutorial._options.steps);\r\n\r\n                        tutorial.exiting = false;\r\n                        tutorial.exit().start().goToStep(8);\r\n                        tutorial.exiting = true;\r\n                    }, 200);\r\n                }\r\n\r\n                $(\"#notesWidget\").on(\"click\", \".commentEdit\", tutorial.stepFunc);\r\n                break;\r\n        }\r\n    });\r\n\r\n    tutorial.onexit(function() {\r\n        if (tutorial.exiting) {\r\n            $(\".commentCancel:visible\").click();\r\n            // delete the tutorial comment that was created\r\n            if (tutorial.comment) {\r\n                var data = {\"mode\": \"delete\", \"commentID\": tutorial.comment.data(\"id\")};\r\n\r\n                $.ajax({\r\n                    url: \"comments.php\",\r\n                    type: \"POST\",\r\n                    data: data,\r\n                    dataType: \"JSON\"\r\n                }).done(function(data) {\r\n                    if (data && data.result == true) {\r\n                        tutorial.comment.remove();\r\n                    }\r\n                });\r\n            }\r\n\r\n            if (tutorial.previousMask) {\r\n                setTimeout(function() {\r\n                    console.log(\"change mask back, delete comment\", tutorial.previousMask);\r\n                    options.masks.active = tutorial.previousMask;\r\n                    options.save();\r\n                }, 200);\r\n            }\r\n\r\n            // remove event listeners\r\n            $(\"#notesWidget #add-comment\").off(\"click\", tutorial.stepFunc);\r\n            $(\"#notesWidget\").off(\"click\", \".commentSave\", tutorial.stepFunc);\r\n            $(\"#notesWidget\").off(\"click\", \".commentEdit\", tutorial.stepFunc);\r\n            $(\"#notesWidget\").off(\"click\", \".cke_toolgroup:has(.cke_button__toolbarswitch)\", tutorial.stepFunc);\r\n        }\r\n    });\r\n\r\n    tutorial.previousMask;\r\n    tutorial.comment;\r\n    tutorial.stepFunc;\r\n    tutorial.exiting = true;\r\n});\r\n","tripwire.undo = function() {\r\n    if (tripwire.signatures.undo[viewingSystemID].length > 0) {\r\n        $(\"#undo\").addClass(\"disabled\");\r\n        var lastIndex = tripwire.signatures.undo[viewingSystemID].length -1;\r\n        var data = {\"systemID\": viewingSystemID, \"signatures\": {\"add\": [], \"remove\": [], \"update\": []}};\r\n\r\n        var undoItem = tripwire.signatures.undo[viewingSystemID][lastIndex];\r\n        var redo = $.map(undoItem.signatures, function(signature) {\r\n            // grab the current signature so we can restore the way it is now\r\n            if (signature.wormhole && tripwire.client.wormholes[signature.wormhole.id]) {\r\n                // it was a wormhole and still is\r\n                return {\"wormhole\": tripwire.client.wormholes[signature.wormhole.id], \"signatures\": [tripwire.client.signatures[signature.signatures[0].id], tripwire.client.signatures[signature.signatures[1].id]]};\r\n            } else if (tripwire.client.signatures[signature.id] && tripwire.client.signatures[signature.id].type == \"wormhole\") {\r\n                // it was a regular signature but is now a wormhole\r\n                var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n                return {\"wormhole\": wormhole, \"signatures\": [tripwire.client.signatures[wormhole.initialID], tripwire.client.signatures[wormhole.secondaryID]]};\r\n            } else if (signature.wormhole && tripwire.client.signatures[signature.signatures[0].id]) {\r\n                // it was a wormhole but is now a regular signature\r\n                return tripwire.client.signatures[signature.signatures[0].id];\r\n            } else {\r\n                // it was a regular signature and still is\r\n                return tripwire.client.signatures[signature.id];\r\n            }\r\n        });\r\n\r\n        switch(undoItem.action) {\r\n            case \"add\":\r\n                data.signatures.remove = data.signatures.remove.concat($.map(undoItem.signatures, function(signature) { return signature.wormhole ? signature.wormhole : signature.id }));\r\n                break;\r\n            case \"remove\":\r\n                data.signatures.add = data.signatures.add.concat(undoItem.signatures);\r\n                break;\r\n            case \"update\":\r\n                data.signatures.update = data.signatures.update.concat(undoItem.signatures);\r\n                break;\r\n        }\r\n\r\n        var success = function(data) {\r\n            if (data.resultSet && data.resultSet[0].result == true) {\r\n                tripwire.signatures.undo[viewingSystemID].pop();\r\n\r\n                $(\"#redo\").removeClass(\"disabled\");\r\n                if (viewingSystemID in tripwire.signatures.redo) {\r\n                    if (undoItem.action == \"remove\") {\r\n                        // we are adding new signatures we removed so we need the new ids\r\n                        tripwire.signatures.redo[viewingSystemID].push({\"action\": undoItem.action, \"signatures\": data.results});\r\n                    } else if (undoItem.action == \"update\") {\r\n                        tripwire.signatures.redo[viewingSystemID].push({\"action\": undoItem.action, \"signatures\": redo});\r\n                    } else {\r\n                        tripwire.signatures.redo[viewingSystemID].push({\"action\": undoItem.action, \"signatures\": undoItem.signatures});\r\n                    }\r\n                } else {\r\n                    if (undoItem.action == \"remove\") {\r\n                        tripwire.signatures.redo[viewingSystemID] = [{\"action\": undoItem.action, \"signatures\": data.results}];\r\n                    } else if (undoItem.action == \"update\") {\r\n                        tripwire.signatures.redo[viewingSystemID] = [{\"action\": undoItem.action, \"signatures\": redo}];\r\n                    } else {\r\n                        tripwire.signatures.redo[viewingSystemID] = [{\"action\": undoItem.action, \"signatures\": undoItem.signatures}];\r\n                    }\r\n                }\r\n\r\n                sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n                sessionStorage.setItem(\"tripwire_redo\", JSON.stringify(tripwire.signatures.redo));\r\n            }\r\n        }\r\n\r\n        var always = function(data) {\r\n            if (tripwire.signatures.undo[viewingSystemID].length > 0) {\r\n                $(\"#undo\").removeClass(\"disabled\");\r\n            }\r\n        }\r\n\r\n        tripwire.refresh('refresh', data, success, always);\r\n    }\r\n}\r\n","var activity = new function() {\r\n\tthis.graph;\r\n\tthis.options;\r\n\tthis.view;\r\n\tthis.span = 24;\r\n\tthis.columns = [\r\n\t\t{id: \"time\", label: \"Time\", role: \"domain\", type: \"string\", calc: function(d, r) { return d.getValue(r, 0) + \"h\"; }},\r\n\t\t{id: \"jumps\", label: \"Jumps\", role: \"data\", type: \"number\", sourceColumn: 1, column: 1, title: \"Jumps\"},\r\n\t\t{id: \"podkills\", label: \"Pod Kills\", role: \"data\", type: \"number\", sourceColumn: 2, column: 2, title: \"Pod Kills\"},\r\n\t\t{id: \"shipkills\", label: \"Ship Kills\", role: \"data\", type: \"number\", sourceColumn: 3, column: 3, title: \"Ship Kills\"},\r\n\t\t{id: \"npckills\", label: \"NPC Kills\", role: \"data\", type: \"number\", sourceColumn: 4, column: 4, title: \"NPC Kills\"},\r\n\t\t//{id: \"annotationLabel\", label: \"Test\", role: \"annotation\", type: \"string\", sourceColumn: 5, title: \"Test\"},\r\n\t\t//{id: \"annotationText\", label: \"Test\", role: \"annotationText\", type: \"string\", sourceColumn: 6, title: \"Test\"}\r\n\t];\r\n\r\n\tthis.getData = function(span, cache) {\r\n\t\tvar span = typeof(span) !== \"undefined\" ? span : this.span;\r\n\t\tvar cache = typeof(cache) !== \"undefined\" ? cache : true;\r\n\r\n\t\t// Google hasn't finished loading yet\r\n\t\tif (!activity.graph) {\r\n\t\t\t\tsetTimeout(function() {activity.getData(span, cache)}, 500);\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn $.ajax({\r\n\t\t\turl: \"activity_graph.php\",\r\n\t\t\tdata: {systemID: viewingSystemID, time: span},\r\n\t\t\ttype: \"GET\",\r\n\t\t\tdataType: \"JSON\",\r\n\t\t\tcache: cache\r\n\t\t}).done(function(json) {\r\n\t\t\tif (json) {\r\n\t\t\t\tjson.rows.reverse();\r\n\t\t\t\tactivity.view = new google.visualization.DataView(new google.visualization.DataTable(json));\r\n\t\t\t\tactivity.view.setColumns(activity.columns);\r\n\t\t\t\tactivity.graph.draw(activity.view, activity.options);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tthis.selectHandler = function() {\r\n\t\tvar selections = activity.graph.getSelection();\r\n\r\n\t\tif (selections[0] && selections[0].row == null) {\r\n\t\t\tvar c = selections[0].column;\r\n\r\n\t\t\tif (activity.columns[c].sourceColumn) {\r\n\t\t\t\t//activity.columns[c].calc = function() { return null };\r\n\t\t\t\tactivity.columns[c].label = activity.columns[c].title + \" (off)\";\r\n\t\t\t\tdelete activity.columns[c].sourceColumn;\r\n\t\t\t} else {\r\n\t\t\t\tactivity.columns[c].sourceColumn = activity.columns[c].column;\r\n\t\t\t\tactivity.columns[c].label = activity.columns[c].title;\r\n\t\t\t\t//delete activity.columns[c].calc;\r\n\t\t\t}\r\n\r\n\t\t\tactivity.view.setColumns(activity.columns);\r\n\t\t\tactivity.options.animation.duration = 0;\r\n\t\t\tactivity.graph.draw(activity.view, activity.options);\r\n\t\t\tactivity.options.animation.duration = 500;\r\n\t\t}\r\n\t}\r\n\r\n\tthis.init = function() {\r\n\t\tactivity.graph = new google.visualization.AreaChart(document.getElementById(\"activityGraph\"));\r\n\t\tactivity.options = {\r\n\t\t\tisStacked: false,\r\n\t\t\tbackgroundColor: \"transparent\",\r\n\t\t\thAxis: {textStyle: {color: \"#999\", fontName: \"Verdana\", fontSize: 10}, showTextEvery: 3},\r\n\t\t\tvAxis: {textStyle: {color: \"#666\", fontName: \"Verdana\", fontSize: 10}, viewWindowMode: \"maximized\", viewWindow: {min: 0}, maxValue: 5},\r\n\t\t\tgridlineColor: \"#454545\",\r\n\t\t\tpointSize: 2,\r\n\t\t\tlineWidth: 1,\r\n\t\t\tchartArea: {left: \"10%\", top: \"5%\", width: \"88%\", height: \"85%\"},\r\n\t\t\tlegend: {position: \"in\", textStyle: {color: \"#CCC\", fontName: \"Verdana\", fontSize: 8.5}},\r\n\t\t\tanimation: {duration: 500, easing: \"inAndout\"},\r\n\t\t\ttooltip: {showColorCode: true},\r\n\t\t\tannotations: {style: \"line\", textStyle: {fontSize: 12, color: \"#ccc\"}, domain: 0},\r\n\t\t\tfocusTarget: \"category\"\r\n\t\t}\r\n\r\n\t\tgoogle.visualization.events.addListener(activity.graph, \"select\", activity.selectHandler);\r\n\r\n\t\tactivity.getData(activity.span);\r\n\t}\r\n\r\n\tthis.time = function(span) {\r\n\t\tswitch(span) {\r\n\t\t\tcase 24:\r\n\t\t\t\tthis.options.hAxis.showTextEvery = 3;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 48:\r\n\t\t\t\tthis.options.hAxis.showTextEvery = 6;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 168:\r\n\t\t\t\tthis.options.hAxis.showTextEvery = 24;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tthis.span = span;\r\n\t\tthis.getData(span);\r\n\t}\r\n\r\n\tthis.redraw = function() {\r\n\t\tthis.graph.draw(this.view, this.options);\r\n\t}\r\n\r\n\tthis.refresh = function(cache) {\r\n\t\tthis.getData(this.span, cache);\r\n\t}\r\n\r\n\tgoogle.charts.setOnLoadCallback(this.init);\r\n}\r\n","var chain = new function() {\r\n\tthis.map, this.view, this.options, this.drawing, this.data = {};\r\n\r\n\tthis.newView = function(json) {\r\n\t\tthis.view = new google.visualization.DataView(new google.visualization.DataTable(json));\r\n\t\treturn this.view;\r\n\t};\r\n\r\n\tthis.activity = function(data) {\r\n\t\t/*\tfunction for adding recent activity to chain map nodes\t*/\r\n\t\t//var data = typeof(data) !== \"undefined\" ? data : this.data.activity;\r\n\r\n\t\t// Hide all activity colored dots instead of checking each one\r\n\t\tvar elements = document.querySelectorAll(\"#chainMap .nodeActivity span\");\r\n\t\tfor (var i = 0, l = elements.length; i < l; ++i) {\r\n\t\t   elements[i].className = elements[i].className + \" invisible\";\r\n\t\t}\r\n\r\n\t\t// Loop through passed data and show dots by system\r\n\t\tvar elements = document.querySelectorAll(\"#chainMap [data-nodeid]\");\r\n\t\tfor (var i = 0, l = elements.length; i < l; ++i) {\r\n\t\t   var systemID = elements[i].getAttribute(\"data-nodeid\");\r\n\t\t   if (data[systemID]) {\r\n\t\t\t   var shipJumps = data[systemID].shipJumps;\r\n\t\t\t   var podKills = data[systemID].podKills;\r\n\t\t\t   var shipKills = data[systemID].shipKills;\r\n\t\t\t   var npcKills = data[systemID].npcKills;\r\n\t\t\t   var node = elements[i].getElementsByClassName(\"nodeActivity\")[0];\r\n\r\n\t\t\t   if (shipJumps > 0) {\r\n\t\t\t\t   var jumps = node.getElementsByClassName(\"jumps\")[0];\r\n\t\t\t\t   jumps.className = jumps.className.replace(/invisible/g, \"\");\r\n\t\t\t\t   jumps.setAttribute(\"data-tooltip\", shipJumps + \" Jumps\");\r\n\t\t\t   }\r\n\r\n\t\t\t   if (podKills > 0) {\r\n\t\t\t\t   var pods = node.getElementsByClassName(\"pods\")[0];\r\n\t\t\t\t   pods.className = pods.className.replace(/invisible/g, \"\");\r\n\t\t\t\t   pods.setAttribute(\"data-tooltip\", podKills + \" Pod Kills\");\r\n\t\t\t   }\r\n\r\n\t\t\t   if (shipKills > 0) {\r\n\t\t\t\t   var ships = node.getElementsByClassName(\"ships\")[0];\r\n\t\t\t\t   ships.className = ships.className.replace(/invisible/g, \"\");\r\n\t\t\t\t   ships.setAttribute(\"data-tooltip\", shipKills + \" Ship Kills\");\r\n\t\t\t   }\r\n\r\n\t\t\t   if (npcKills > 0) {\r\n\t\t\t\t   var npcs = node.getElementsByClassName(\"npcs\")[0];\r\n\t\t\t\t   npcs.className = npcs.className.replace(/invisible/g, \"\");\r\n\t\t\t\t   npcs.setAttribute(\"data-tooltip\", npcKills + \" NPC Kills\");\r\n\t\t\t   }\r\n\t\t   }\r\n\t\t}\r\n\r\n\t\tif (SystemActivityToolTips.attachedElements && SystemActivityToolTips.attachedElements.length > 0) {\r\n\t\t\tSystemActivityToolTips.detach($(\"#chainMap .whEffect\"));\r\n\t\t}\r\n\t\tSystemActivityToolTips.attach($(\"#chainMap .nodeActivity > span[data-tooltip]:not(.invisible)\"));\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tthis.occupied = function(data) {\r\n\t\t/*\tfunction for showing occupied icon  */\r\n\r\n\t\t// Hide all icons instead of checking each one\r\n\t\t$(\"#chainMap [data-icon='user'], #chainMap [data-icon='user'] + .badge\").addClass(\"invisible\");\r\n\r\n\t\t// Loop through passed data and show icons\r\n\t\tfor (var x in data) {\r\n\t\t\t$(\"#chainMap [data-nodeid='\"+data[x].systemID+\"'] [data-icon='user']\").removeClass(\"invisible\");\r\n\t\t\t$(\"#chainMap [data-nodeid='\"+data[x].systemID+\"'] [data-icon='user'] + .badge\").removeClass(\"invisible\").html(data[x].count);\r\n\t\t}\r\n\r\n\t\tOccupiedToolTips.attach($(\"#chainMap [data-icon='user']:not(.invisible)\"));\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tthis.flares = function(data) {\r\n\t\t/*\tfunction for coloring chain map nodes via flares  */\r\n\t\t//var data = typeof(data) !== \"undefined\" ? data : this.data.flares;\r\n\r\n\t\t// Remove all current node coloring instead of checking each one\r\n\t\t$(\"#chainMap td.node\").removeClass(\"redNode yellowNode greenNode\");\r\n\r\n\t\t// Remove all coloring from chain grid\r\n\t\t$(\"#chainGrid tr\").removeClass(\"red yellow green\");\r\n\r\n\t\t// Loop through passed data and add classes by system\r\n\t\tif (data) {\r\n\t\t\tfor (var x in data.flares) {\r\n\t\t\t\tvar systemID = data.flares[x].systemID;\r\n\t\t\t\tvar flare = data.flares[x].flare;\r\n\r\n\t\t\t\tvar row = ($(\"#chainMap [data-nodeid=\"+systemID+\"]\").parent().addClass(flare+\"Node\").parent().index() - 1) / 3 * 2;\r\n\r\n\t\t\t\tif (row > 0) {\r\n\t\t\t\t\t$(\"#chainGrid tr:eq(\"+row+\")\").addClass(flare).next().addClass(flare);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tthis.grid = function() {\r\n\t\t/*  function for showing/hiding grid lines  */\r\n\t\t// This is an optional feature\r\n\t\tif (options.chain.gridlines == false) {\r\n\t\t\t$(\"#chainGrid tr\").addClass(\"hidden\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t$(\"#chainGrid tr\").removeClass(\"hidden\");\r\n\t\t//$(\"#chainGrid\").css(\"width\", \"100%\");\r\n\r\n\t\t// Calculate how many rows have systems, max 0 hack to prevent negative numbers, and rows above this number get hidden\r\n\t\tvar rows = Math.max(0, $(\".google-visualization-orgchart-table tr:has(.node)\").length * 2 - 1);\r\n\t\t$(\"#chainGrid tr:gt(\"+rows+\")\").addClass(\"hidden\");\r\n\t}\r\n\r\n\tthis.lines = function(data) {\r\n\t\t//var data = typeof(data) !== \"undefined\" ? data : this.data.lines;\r\n\r\n\t\tfunction drawNodeLine(system, parent, mode, signatureID) {\r\n\t\t\t/*\tfunction for drawing colored lines  */\r\n\r\n\t\t\t// Find node in chainmap\r\n\t\t\t//var $node = $(\"#chainMap [data-nodeid='\"+system+\"']\").parent();\r\n\t\t\tvar $node = $(\"#chainMap #node\"+system).parent();\r\n\r\n\t\t\tif ($node.length == 0) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\t// Get node # in this line\r\n\t\t\tvar nodeIndex = Math.ceil(($node[0].cellIndex + 1) / 2 - 1);\r\n\r\n\t\t\t// applly to my top line\r\n\t\t\tvar $connector = $($node.parent().prev().children(\"td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright\")[nodeIndex]).addClass(\"left-\"+mode+\" right-\"+mode);\r\n\t\t\t//var $connector = $($node.parent().prev().find(\"td:not([colspan])\")[nodeIndex]).addClass(\"left-\"+mode+\" right-\"+mode).attr(\"data-signatureid\", signatureID);\r\n\r\n\t\t\t// Find parent node\r\n\t\t\t//var $parent = $(\"#chainMap [data-nodeid='\"+parent+\"']\").parent();\r\n\t\t\tvar $parent = $(\"#chainMap #node\"+parent).parent();\r\n\r\n\t\t\tif ($parent.length == 0 || $connector.length == 0)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t// Find the col of my top line\r\n\t\t\tvar nodeCol = 0, connectorCell = $connector[0].cellIndex;\r\n\t\t\t$node.parent().prev().find(\"td\").each(function(index) {\r\n\t\t\t\tnodeCol += this.colSpan;\r\n\r\n\t\t\t\tif (index == connectorCell) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Get node # in this line\r\n\t\t\tvar parentIndex = Math.ceil(($parent[0].cellIndex + 1) / 2 - 1);\r\n\r\n\t\t\t// Compensate for non-parent nodes (slight performance hit ~10ms)\r\n\t\t\tvar newparentIndex = parentIndex;\r\n\t\t\tfor (var i = 0; i <= parentIndex; i++) {\r\n\t\t\t\tvar checkSystem = 0;//$node.parent().prev().prev().prev().find(\"td:has([data-nodeid]):eq(\"+i+\")\").find(\"[data-nodeid]\").data(\"nodeid\");\r\n\t\t\t\t$node.parent().prev().prev().prev().find(\"td > [data-nodeid]\").each(function(index) {\r\n\t\t\t\t\tif (index == i) {\r\n\t\t\t\t\t\tcheckSystem = $(this).attr(\"id\").replace(\"node\", \"\");//$(this).data(\"nodeid\");\r\n\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif ($.map(data.map.rows, function(node) { return node.c[1].v == checkSystem ? node : null; }).length <= 0) {\r\n\t\t\t\t\tnewparentIndex--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tparentIndex = newparentIndex;\r\n\r\n\t\t\t// Apply to parent bottom line\r\n\t\t\tvar $connecte = $($node.parent().prev().prev().children(\"td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright\")[parentIndex]).addClass(\"left-\"+mode+\" right-\"+mode);\r\n\t\t\t//var $connecte = $($node.parent().prev().prev().find(\"td:not([colspan])\")[parentIndex]).addClass(\"left-\"+mode+\" right-\"+mode).attr(\"data-signatureid\", signatureID);\r\n\r\n\t\t\t// the beans\r\n\t\t\tvar col = 0, parent = false, me = false;\r\n\t\t\t$node.parent().prev().prev().find(\"td\").each(function(index, value) {\r\n\t\t\t\tcol += this.colSpan;\r\n\r\n\t\t\t\tif (me && parent) {\r\n\t\t\t\t\t// All done - get outta here\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else if (typeof($connecte[0]) != \"undefined\" && $connecte[0].cellIndex == index) {\r\n\t\t\t\t\tparent = true;\r\n\r\n\t\t\t\t\t$(this).addClass(\"left-\"+mode);\r\n\r\n\t\t\t\t\t// remove bottom border that points to the right\r\n\t\t\t\t\tif (!me && col != nodeCol) {\r\n\t\t\t\t\t\t$(this).addClass(\"bottom-\"+mode);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// parent and node are same - we are done\r\n\t\t\t\t\tif (nodeCol == col) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (col == nodeCol) {\r\n\t\t\t\t\tme = true;\r\n\r\n\t\t\t\t\t$(this).addClass(\"bottom-\"+mode);\r\n\t\t\t\t} else if (me || parent) {\r\n\t\t\t\t\tvar tempCol = 0, breaker = false, skip = false;\r\n\r\n\t\t\t\t\t$node.parent().prev().find(\"td\").each(function(index) {\r\n\t\t\t\t\t\ttempCol += this.colSpan;\r\n\r\n\t\t\t\t\t\tif (tempCol == col && ($(this).hasClass(\"google-visualization-orgchart-lineleft\") || $(this).hasClass(\"google-visualization-orgchart-lineright\"))) {\r\n\t\t\t\t\t\t\tif (parent == false) {\r\n\t\t\t\t\t\t\t\t// Stop looking cuz there is another node between us and parent\r\n\t\t\t\t\t\t\t\tbreaker = true;\r\n\t\t\t\t\t\t\t\t$connecte.removeClass(\"left-\"+mode+\" right-\"+mode);\r\n\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t} else if (parent == true) {\r\n\t\t\t\t\t\t\t\t// Lets make sure there isnt a node between the parent and me\r\n\t\t\t\t\t\t\t\t$connecte.removeClass(\"left-\"+mode+\" right-\"+mode);\r\n\r\n\t\t\t\t\t\t\t\t$node.parent().prev().prev().find(\"td\").each(function(index) {\r\n\t\t\t\t\t\t\t\t\tif (index >= $connecte[0].cellIndex) {\r\n\t\t\t\t\t\t\t\t\t\t// there is a node after parent but before me\r\n\t\t\t\t\t\t\t\t\t\t$(this).removeClass(\"bottom-\"+mode);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tskip = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (breaker) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!skip) {\r\n\t\t\t\t\t\t$(this).addClass(\"bottom-\"+mode);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfor (var x in data.lines) {\r\n\t\t\tdrawNodeLine(data.lines[x][0], data.lines[x][1], data.lines[x][2], data.lines[x][3]);\r\n\t\t}\r\n\t}\r\n\r\n\tthis.nodes = function(map) {\r\n\t\tvar chain = {cols: [{label: \"System\", type: \"string\"}, {label: \"Parent\", type: \"string\"}], rows: []};\r\n\t\tvar frigTypes = [\"Q003\", \"E004\", \"L005\", \"Z006\", \"M001\", \"C008\", \"G008\", \"A009\", \"SML\", \"MED\", \"LRG\", \"XLG\"];\r\n\t\tvar connections = [];\r\n\r\n\t\tfunction topLevel(systemID, id) {\r\n\t\t\tif (!systemID || !tripwire.systems[systemID])\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t// System type switch\r\n\t\t\tvar systemType;\r\n\t\t\tif (tripwire.systems[systemID].class)\r\n\t\t\t\tsystemType = \"<span class='wh'>C\" + tripwire.systems[systemID].class + \"</span>\";\r\n\t\t\telse if (tripwire.systems[systemID].security >= 0.45)\r\n\t\t\t\tsystemType = \"<span class='hisec'>HS</span>\";\r\n\t\t\telse if (tripwire.systems[systemID].security > 0.0)\r\n\t\t\t\tsystemType = \"<span class='lowsec'>LS</span>\";\r\n\t\t\telse if (tripwire.systems[systemID].security <= 0.0)\r\n\t\t\t\tsystemType = \"<span class='nullsec'>NS</span>\";\r\n\r\n\t\t\tvar effectClass = null, effect = null;\r\n\t\t\tif (tripwire.systems[systemID].class) {\r\n\t\t\t\tswitch(tripwire.systems[systemID].effect) {\r\n\t\t\t\t\tcase \"Black Hole\":\r\n\t\t\t\t\t\teffectClass = \"blackhole\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Cataclysmic Variable\":\r\n\t\t\t\t\t\teffectClass = \"cataclysmic-variable\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Magnetar\":\r\n\t\t\t\t\t\teffectClass = \"magnetar\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Pulsar\":\r\n\t\t\t\t\t\teffectClass = \"pulsar\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Red Giant\":\r\n\t\t\t\t\t\teffectClass = \"red-giant\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Wolf-Rayet Star\":\r\n\t\t\t\t\t\teffectClass = \"wolf-rayet\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\teffect = tripwire.systems[systemID].effect;\r\n\t\t\t}\r\n\r\n\t\t\tvar system = {v: id};\r\n\t\t\tvar chainNode = \"<div id='node\"+id+\"' data-nodeid='\"+systemID+\"'>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='nodeIcons'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<div style='float: left;'>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<i class='whEffect' \"+(effectClass ? \"data-icon='\"+effectClass+\"' data-tooltip='\"+effect+\"'\" : null)+\"></i>\"\r\n\t\t\t\t\t\t\t+\t\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\t\"<div style='float: right;'>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<i data-icon='user' class='invisible'></i>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<span class='badge invisible'></span>\"\r\n\t\t\t\t\t\t\t+\t\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeClass'>\"+systemType+\"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeSystem'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<a href='.?system=\"+tripwire.systems[systemID].name+\"'>\"+(options.chain.tabs[options.chain.active] && options.chain.tabs[options.chain.active].systemID != 0 ? options.chain.tabs[options.chain.active].name : tripwire.systems[systemID].name)+\"</a>\"\r\n\t\t\t\t\t\t\t+\t\"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeType'>&nbsp;</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='nodeActivity'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span>\"\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\"</div>\"\r\n\r\n\t\t\tsystem.f = chainNode;\r\n\r\n\t\t\treturn system;\r\n\t\t}\r\n\r\n\t\tfunction findLinks(system) {\r\n\t\t\tif (system[0] <= 0) return false;\r\n\r\n\t\t\tvar parentID = parseInt(system[1]), childID = chainList.length;\r\n\r\n\t\t\tfor (var x in chainData) {\r\n\t\t\t\tvar wormhole = chainData[x];\r\n\t\t\t\tif (wormhole.parent == \"secondary\") {\r\n\t\t\t\t\tvar parent = tripwire.client.signatures[wormhole.secondaryID];\r\n\t\t\t\t\tvar child = tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar parent = tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t\tvar child = tripwire.client.signatures[wormhole.secondaryID];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($.inArray(wormhole.id, usedLinks) == -1) {\r\n\t\t\t\t\tif (parent && parent.systemID == system[0]) {\r\n\t\t\t\t\t\tvar node = {};\r\n\t\t\t\t\t\tnode.id = wormhole.id;\r\n\t\t\t\t\t\tnode.life = wormhole.life;\r\n\t\t\t\t\t\tnode.mass = wormhole.mass;\r\n\t\t\t\t\t\tnode.time = parent.modifiedTime;\r\n\r\n\t\t\t\t\t\tnode.parent = {};\r\n\t\t\t\t\t\tnode.parent.id = parentID;\r\n\t\t\t\t\t\tnode.parent.systemID = tripwire.systems[parent.systemID] ? parent.systemID : parent.systemID + \"|\" + Math.floor(Math.random() * Math.floor(10000));\r\n\t\t\t\t\t\tnode.parent.name = parent.name;\r\n\t\t\t\t\t\tnode.parent.type = 'K162';\r\n\t\t\t\t\t\tnode.parent.typeBM = null;\r\n\t\t\t\t\t\tnode.parent.classBM = null;\r\n\t\t\t\t\t\tnode.parent.nth = null;\r\n\t\t\t\t\t\tnode.parent.signatureID = child.signatureID;\r\n\r\n\t\t\t\t\t\tnode.child = {};\r\n\t\t\t\t\t\tnode.child.id = ++childID;\r\n\t\t\t\t\t\tnode.child.systemID = tripwire.systems[child.systemID] ? child.systemID : child.systemID + \"|\" + Math.floor(Math.random() * Math.floor(10000));\r\n\t\t\t\t\t\tnode.child.name = child.name;\r\n\t\t\t\t\t\tnode.child.type = wormhole.type;\r\n\t\t\t\t\t\tnode.child.typeBM = null;\r\n\t\t\t\t\t\tnode.child.classBM = null;\r\n\t\t\t\t\t\tnode.child.nth = null;\r\n\t\t\t\t\t\tnode.child.signatureID = parent.signatureID;\r\n\r\n\t\t\t\t\t\tchainLinks.push(node);\r\n\t\t\t\t\t\tchainList.push([node.child.systemID, node.child.id, system[2]]);\r\n\t\t\t\t\t\tusedLinks.push(node.id);\r\n\t\t\t\t\t\t// usedLinks[system[2]].push(node.id);\r\n\r\n\t\t\t\t\t\tif ($(\"#show-viewing\").hasClass(\"active\") && tripwire.systems[node.child.systemID] && !tripwire.systems[viewingSystemID].class && !tripwire.systems[node.child.systemID].class) {\r\n\t\t\t\t\t\t\tvar jumps = guidance.findShortestPath(tripwire.map.shortest, [viewingSystemID - 30000000, node.child.systemID - 30000000]).length - 1;\r\n\r\n\t\t\t\t\t\t\tvar calcNode = {};\r\n\t\t\t\t\t\t\tcalcNode.life = \"Gate\";\r\n\t\t\t\t\t\t\tcalcNode.parent = {};\r\n\t\t\t\t\t\t\tcalcNode.parent.id = node.child.id;\r\n\t\t\t\t\t\t\tcalcNode.parent.systemID = node.child.systemID;\r\n\t\t\t\t\t\t\tcalcNode.parent.name = node.child.name;\r\n\t\t\t\t\t\t\tcalcNode.parent.type = node.child.type;\r\n\t\t\t\t\t\t\tcalcNode.parent.nth = node.child.nth;\r\n\r\n\t\t\t\t\t\t\tcalcNode.child = {};\r\n\t\t\t\t\t\t\tcalcNode.child.id = ++childID;\r\n\t\t\t\t\t\t\tcalcNode.child.systemID = viewingSystemID\r\n\t\t\t\t\t\t\tcalcNode.child.name = tripwire.systems[viewingSystemID].name;\r\n\t\t\t\t\t\t\tcalcNode.child.jumps = jumps;\r\n\t\t\t\t\t\t\tcalcNode.child.nth = null;\r\n\r\n\t\t\t\t\t\t\tchainLinks.push(calcNode);\r\n\t\t\t\t\t\t\tchainList.push([0, childID]);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ($(\"#show-favorite\").hasClass(\"active\") && tripwire.systems[node.child.systemID]) {\r\n\t\t\t\t\t\t\tfor (x in options.favorites) {\r\n\t\t\t\t\t\t\t\tif (tripwire.systems[options.favorites[x]].regionID >= 11000000 || tripwire.systems[node.child.systemID].regionID >= 11000000)\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t\t\t\tvar jumps = guidance.findShortestPath(tripwire.map.shortest, [options.favorites[x] - 30000000, node.child.systemID - 30000000]).length - 1;\r\n\r\n\t\t\t\t\t\t\t\tvar calcNode = {};\r\n\t\t\t\t\t\t\t\tcalcNode.life = \"Gate\";\r\n\t\t\t\t\t\t\t\tcalcNode.parent = {};\r\n\t\t\t\t\t\t\t\tcalcNode.parent.id = node.child.id;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.systemID = node.child.systemID;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.name = node.child.name;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.type = node.child.type;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.nth = node.child.nth;\r\n\r\n\t\t\t\t\t\t\t\tcalcNode.child = {};\r\n\t\t\t\t\t\t\t\tcalcNode.child.id = ++childID;\r\n\t\t\t\t\t\t\t\tcalcNode.child.systemID = options.favorites[x];\r\n\t\t\t\t\t\t\t\tcalcNode.child.name = tripwire.systems[options.favorites[x]].name;\r\n\t\t\t\t\t\t\t\tcalcNode.child.jumps = jumps;\r\n\t\t\t\t\t\t\t\tcalcNode.child.nth = null;\r\n\r\n\t\t\t\t\t\t\t\tchainLinks.push(calcNode);\r\n\t\t\t\t\t\t\t\tchainList.push([0, childID]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (child && child.systemID == system[0]) {\r\n\t\t\t\t\t\tvar node = {};\r\n\t\t\t\t\t\tnode.id = wormhole.id;\r\n\t\t\t\t\t\tnode.life = wormhole.life;\r\n\t\t\t\t\t\tnode.mass = wormhole.mass;\r\n\t\t\t\t\t\tnode.time = wormhole.modifiedTime;\r\n\r\n\t\t\t\t\t\tnode.parent = {};\r\n\t\t\t\t\t\tnode.parent.id = parentID;\r\n\t\t\t\t\t\tnode.parent.systemID = tripwire.systems[child.systemID] ? child.systemID : child.systemID + \"|\" + Math.floor(Math.random() * Math.floor(10000));\r\n\t\t\t\t\t\tnode.parent.name = child.name;\r\n\t\t\t\t\t\tnode.parent.type = wormhole.type;\r\n\t\t\t\t\t\tnode.parent.typeBM = null;\r\n\t\t\t\t\t\tnode.parent.classBM = null;\r\n\t\t\t\t\t\tnode.parent.nth = null;\r\n\t\t\t\t\t\tnode.parent.signatureID = parent.signatureID;\r\n\r\n\t\t\t\t\t\tnode.child = {};\r\n\t\t\t\t\t\tnode.child.id = ++childID;\r\n\t\t\t\t\t\tnode.child.systemID = tripwire.systems[parent.systemID] ? parent.systemID : parent.systemID + \"|\" + Math.floor(Math.random() * Math.floor(10000));\r\n\t\t\t\t\t\tnode.child.name = parent.name;\r\n\t\t\t\t\t\tnode.child.type = 'K162';\r\n\t\t\t\t\t\tnode.child.typeBM = null;\r\n\t\t\t\t\t\tnode.child.classBM = null;\r\n\t\t\t\t\t\tnode.child.nth = null;\r\n\t\t\t\t\t\tnode.child.signatureID = child.signatureID;\r\n\r\n\t\t\t\t\t\tchainLinks.push(node);\r\n\t\t\t\t\t\tchainList.push([node.child.systemID, node.child.id, system[2]]);\r\n\t\t\t\t\t\tusedLinks.push(node.id);\r\n\t\t\t\t\t\t// usedLinks[system[2]].push(node.id);\r\n\r\n\t\t\t\t\t\tif ($(\"#show-viewing\").hasClass(\"active\") && tripwire.systems[node.child.systemID] && !tripwire.systems[viewingSystemID].class && !tripwire.systems[node.child.systemID].class) {\r\n\t\t\t\t\t\t\tvar jumps = guidance.findShortestPath(tripwire.map.shortest, [viewingSystemID - 30000000, node.child.systemID - 30000000]).length - 1;\r\n\r\n\t\t\t\t\t\t\tvar calcNode = {};\r\n\t\t\t\t\t\t\tcalcNode.life = \"Gate\";\r\n\t\t\t\t\t\t\tcalcNode.parent = {};\r\n\t\t\t\t\t\t\tcalcNode.parent.id = node.child.id;\r\n\t\t\t\t\t\t\tcalcNode.parent.systemID = node.child.systemID;\r\n\t\t\t\t\t\t\tcalcNode.parent.name = node.child.name;\r\n\t\t\t\t\t\t\tcalcNode.parent.type = node.child.type;\r\n\t\t\t\t\t\t\tcalcNode.parent.nth = node.child.nth;\r\n\r\n\t\t\t\t\t\t\tcalcNode.child = {};\r\n\t\t\t\t\t\t\tcalcNode.child.id = ++childID;\r\n\t\t\t\t\t\t\tcalcNode.child.systemID = viewingSystemID;\r\n\t\t\t\t\t\t\tcalcNode.child.name = tripwire.systems[viewingSystemID].name;\r\n\t\t\t\t\t\t\tcalcNode.child.nth = null;\r\n\t\t\t\t\t\t\tcalcNode.child.jumps = jumps;\r\n\r\n\t\t\t\t\t\t\tchainLinks.push(calcNode);\r\n\t\t\t\t\t\t\tchainList.push([0, childID]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ($(\"#show-favorite\").hasClass(\"active\") && tripwire.systems[node.child.systemID]) {\r\n\t\t\t\t\t\t\tfor (x in options.favorites) {\r\n\t\t\t\t\t\t\t\tif (tripwire.systems[options.favorites[x]].regionID >= 11000000 || tripwire.systems[node.child.systemID].regionID >= 11000000)\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t\t\t\tvar jumps = guidance.findShortestPath(tripwire.map.shortest, [options.favorites[x] - 30000000, node.child.systemID - 30000000]).length - 1;\r\n\r\n\t\t\t\t\t\t\t\tvar calcNode = {};\r\n\t\t\t\t\t\t\t\tcalcNode.life = \"Gate\";\r\n\t\t\t\t\t\t\t\tcalcNode.parent = {};\r\n\t\t\t\t\t\t\t\tcalcNode.parent.id = node.child.id;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.systemID = node.child.systemID;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.name = node.child.name;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.type = node.child.type;\r\n\t\t\t\t\t\t\t\tcalcNode.parent.nth = node.child.nth;\r\n\r\n\t\t\t\t\t\t\t\tcalcNode.child = {};\r\n\t\t\t\t\t\t\t\tcalcNode.child.id = ++childID;\r\n\t\t\t\t\t\t\t\tcalcNode.child.systemID = options.favorites[x];\r\n\t\t\t\t\t\t\t\tcalcNode.child.name = tripwire.systems[options.favorites[x]].name;\r\n\t\t\t\t\t\t\t\tcalcNode.child.nth = null;\r\n\t\t\t\t\t\t\t\tcalcNode.child.jumps = jumps;\r\n\r\n\t\t\t\t\t\t\t\tchainLinks.push(calcNode);\r\n\t\t\t\t\t\t\t\tchainList.push([0, childID]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($(\"#chainTabs .current\").length > 0) {\r\n\t\t\tvar systems = $(\"#chainTabs .current .name\").data(\"tab\").toString().split(\",\");\r\n\t\t\tvar chainList = [];\r\n\t\t\tvar chainData = map;\r\n\t\t\tvar chainLinks = [];\r\n\t\t\tvar usedLinks = [];\r\n\r\n\t\t\tif (systems == 0) {\r\n\t\t\t\tvar i = 0;\r\n\t\t\t\tfor (var x in map) {\r\n\t\t\t\t\tvar parent = tripwire.client.signatures[map[x].initialID];\r\n\t\t\t\t\tvar child = tripwire.client.signatures[map[x].secondaryID];\r\n\t\t\t\t\tif (typeof(tripwire.systems[parent.systemID].class) == \"undefined\") {\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t// usedLinks[parent.systemID] = [];\r\n\t\t\t\t\t\tchain.rows.push({c: [topLevel(parent.systemID, i), {v: null}]});\r\n\t\t\t\t\t\tchainList.push([parent.systemID, i, parent.systemID]);\r\n\t\t\t\t\t} else if (tripwire.systems[child.systemID] && typeof(tripwire.systems[child.systemID].class) == \"undefined\") {\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t// usedLinks[child.systemID] = [];\r\n\t\t\t\t\t\tchain.rows.push({c: [topLevel(child.systemID, i), {v: null}]});\r\n\t\t\t\t\t\tchainList.push([child.systemID, i, child.systemID]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor (var x in systems) {\r\n\t\t\t\t\t// usedLinks[systems[x]] = [];\r\n\t\t\t\t\tchain.rows.push({c: [topLevel(systems[x], parseInt(x) + 1), {v: null}]});\r\n\t\t\t\t\tchainList.push([systems[x], parseInt(x) + 1, systems[x]]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0; i < chainList.length; i++) {\r\n\t\t\t\tfindLinks(chainList[i]);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t$(\"#chainError\").hide();\r\n\r\n\t\t\tvar row = {c: []};\r\n\t\t\tvar systemID = viewingSystemID;\r\n\r\n\t\t\trow.c.push(topLevel(systemID, 1), {v: null});\r\n\r\n\t\t\tchain.rows.push(row);\r\n\r\n\t\t\tvar chainList = [[systemID, 1]];\r\n\t\t\tvar chainData = map;\r\n\t\t\tvar chainLinks = [];\r\n\t\t\tvar usedLinks = [];\r\n\r\n\t\t\tfor (var i = 0; i < chainList.length; ++i) {\r\n\t\t\t\tfindLinks(chainList[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var x in chainLinks) {\r\n\t\t\tvar node = chainLinks[x];\r\n\t\t\tvar row = {c: []};\r\n\r\n\t\t\t// System type switch\r\n\t\t\tvar systemType;\r\n\t\t\tvar nodeClass = tripwire.systems[node.child.systemID] ? tripwire.systems[node.child.systemID].class : null;\r\n\t\t\tvar nodeSecurity = tripwire.systems[node.child.systemID] ? tripwire.systems[node.child.systemID].security : null;\r\n\t\t\tvar leadsToPointer = typeof(node.child.systemID) === \"string\" && node.child.systemID.indexOf(\"|\") >= 0 ? tripwire.aSigSystems[node.child.systemID.substring(0, node.child.systemID.indexOf(\"|\"))] : null;\r\n\t\t\tif (nodeClass == 6 || leadsToPointer == \"Class-6\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Class 6\"))\r\n\t\t\t\tsystemType = \"<span class='wh'>C6</span>\";\r\n\t\t\telse if (nodeClass == 5 || leadsToPointer == \"Class-5\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Class 5\"))\r\n\t\t\t\tsystemType = \"<span class='wh'>C5</span>\";\r\n\t\t\telse if (nodeClass == 4 || leadsToPointer == \"Class-4\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Class 4\"))\r\n\t\t\t\tsystemType = \"<span class='wh'>C4</span>\";\r\n\t\t\telse if (nodeClass == 3 || leadsToPointer == \"Class-3\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Class 3\"))\r\n\t\t\t\tsystemType = \"<span class='wh'>C3</span>\";\r\n\t\t\telse if (nodeClass == 2 || leadsToPointer == \"Class-2\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Class 2\"))\r\n\t\t\t\tsystemType = \"<span class='wh'>C2</span>\";\r\n\t\t\telse if (nodeClass == 1 || leadsToPointer == \"Class-1\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Class 1\"))\r\n\t\t\t\tsystemType = \"<span class='wh'>C1</span>\";\r\n\t\t\telse if (nodeClass > 6)\r\n\t\t\t\tsystemType = \"<span class='wh'>C\" + nodeClass + \"</span>\";\r\n\t\t\telse if (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo.split(\" \").length > 1)\r\n\t\t\t\tsystemType = \"<span class='wh'>C\" + tripwire.wormholes[node.child.type].leadsTo.split(\" \")[1] + \"</span>\";\r\n\t\t\telse if (nodeSecurity >= 0.45 || leadsToPointer == \"High-Sec\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"High-Sec\" && !nodeSecurity))\r\n\t\t\t\tsystemType = \"<span class='hisec'>HS</span>\";\r\n\t\t\telse if (nodeSecurity > 0.0 || leadsToPointer == \"Low-Sec\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Low-Sec\" && !nodeSecurity))\r\n\t\t\t\tsystemType = \"<span class='lowsec'>LS</span>\";\r\n\t\t\telse if ((nodeSecurity <= 0.0 && nodeSecurity != null) || leadsToPointer == \"Null-Sec\" || (typeof(tripwire.wormholes[node.child.type]) != \"undefined\" && tripwire.wormholes[node.child.type].leadsTo == \"Null-Sec\"))\r\n\t\t\t\tsystemType = \"<span class='nullsec'>NS</span>\";\r\n\t\t\telse\r\n\t\t\t\tsystemType = \"<span>&nbsp;</span>\";\r\n\r\n\t\t\tvar effectClass = null, effect = null;\r\n\t\t\tif (typeof(tripwire.systems[node.child.systemID]) != \"undefined\") {\r\n\t\t\t\tswitch(tripwire.systems[node.child.systemID].effect) {\r\n\t\t\t\t\tcase \"Black Hole\":\r\n\t\t\t\t\t\teffectClass = \"blackhole\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Cataclysmic Variable\":\r\n\t\t\t\t\t\teffectClass = \"cataclysmic-variable\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Magnetar\":\r\n\t\t\t\t\t\teffectClass = \"magnetar\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Pulsar\":\r\n\t\t\t\t\t\teffectClass = \"pulsar\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Red Giant\":\r\n\t\t\t\t\t\teffectClass = \"red-giant\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Wolf-Rayet Star\":\r\n\t\t\t\t\t\teffectClass = \"wolf-rayet\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\teffectClass = null;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\teffect = tripwire.systems[node.child.systemID].effect;\r\n\t\t\t}\r\n\r\n\t\t\tvar child = {v: node.child.id};\r\n\t\t\tvar chainNode = \"<div id='node\"+node.child.id+\"' data-nodeid='\"+node.child.systemID+\"' data-sigid='\"+node.id+\"'>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='nodeIcons'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<div style='float: left;'>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<i class='whEffect' \"+(effectClass ? \"data-icon='\"+effectClass+\"' data-tooltip='\"+effect+\"'\" : null)+\"></i>\"\r\n\t\t\t\t\t\t\t+\t\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\t\"<div style='float: right;'>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<i data-icon='user' class='invisible'></i>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<span class='badge invisible'></span>\"\r\n\t\t\t\t\t\t\t+\t\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeClass'>\"+(systemType + sigFormat(node.child.classBM, \"class\"))+\"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeSystem'>\"\r\n\t\t\t\t\t\t\t+ \t(tripwire.systems[node.child.systemID] ? \"<a href='.?system=\"+tripwire.systems[node.child.systemID].name+\"'>\"+(node.parent.name ? node.parent.name : tripwire.systems[node.child.systemID].name)+\"</a>\" : (node.parent.name ? node.parent.name : \"<a class='invisible'>system</a>\"))\r\n\t\t\t\t\t\t\t+\t\"</h4>\"\r\n\t\t\t\t\t\t\t+\t(node.child.jumps ? \"<h4 class='nodeType'>\" + node.child.jumps + \"</h4>\" : (\"<h4 class='nodeType'>\"+(options.chain[\"node-reference\"] == \"id\" ? (node.child.signatureID ? node.child.signatureID.substring(0, 3) : \"&nbsp;\") : (node.child.type || \"&nbsp;\") + sigFormat(node.child.typeBM, \"type\") || \"&nbsp;\")+\"</h4>\"))\r\n\t\t\t\t\t\t\t+\t\"<div class='nodeActivity'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span>\"\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\"</div>\"\r\n\r\n\t\t\tchild.f = chainNode;\r\n\r\n\t\t\tvar parent = {v: node.parent.id};\r\n\r\n\t\t\trow.c.push(child, parent);\r\n\t\t\tchain.rows.push(row);\r\n\r\n\t\t\tif (node.life == \"critical\" && ($.inArray(node.parent.type, frigTypes) != -1 || $.inArray(node.child.type, frigTypes) != -1))\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"eol-frig\", node.id));\r\n\t\t\telse if (node.life == \"critical\" && node.mass == \"critical\")\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"eol-critical\", node.id));\r\n\t\t\telse if (node.life == \"critical\" && node.mass == \"destab\")\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"eol-destab\", node.id));\r\n\t\t\telse if ($.inArray(node.parent.type, frigTypes) != -1 || $.inArray(node.child.type, frigTypes) != -1)\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"frig\", node.id));\r\n\t\t\telse if (node.life == \"critical\")\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"eol\", node.id));\r\n\t\t\telse if (node.mass == \"critical\")\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"critical\", node.id));\r\n\t\t\telse if (node.mass == \"destab\")\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"destab\", node.id));\r\n\t\t\telse if (node.life == \"Gate\" || node.parent.type == \"GATE\" || node.child.type == \"GATE\")\r\n\t\t\t\tconnections.push(Array(child.v, parent.v, \"gate\", node.id));\r\n\t\t\t//else\r\n\t\t\t//\tconnections.push(Array(child.v, parent.v, \"\", node.id));\r\n\t\t}\r\n\r\n\t\t// Apply critical/destab line colors\r\n\t\tconnections.reverse(); // so we apply to outer systems first\r\n\r\n\t\t//this.data.map = chain;\r\n\t\t//this.data.lines = connections;\r\n\t\treturn {\"map\": chain, \"lines\": connections};\r\n\t}\r\n\r\n\tthis.redraw = function() {\r\n\t\tvar data = $.extend(true, {}, this.data);\r\n\t\tdata.map = $.extend(true, {}, data.rawMap);\r\n\r\n\t\tthis.draw(data);\r\n\t}\r\n\r\n\tthis.draw = function(data) {\r\n\t\tvar data = typeof(data) !== \"undefined\" ? data : {};\r\n\r\n\t\t// We need to make sure Google chart is ready and we have signature data for this system before we begin, otherwise delay\r\n\t\tif (!this.map || (Object.size(data.map) && !tripwire.client.signatures)) {\r\n\t\t\tsetTimeout(() => chain.draw(data), 100);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (data.map) {\r\n\t\t\tthis.drawing = true;\r\n\r\n\t\t\tthis.data.rawMap = $.extend(true, {}, data.map);\r\n\r\n\t\t\t// if (options.chain.active == null || (options.chain.tabs[options.chain.active] && options.chain.tabs[options.chain.active].evescout == false)) {\r\n\t\t\t// \tif (options.masks.active != \"273.0\") {\r\n\t\t\t// \t\tfor (var i in data.map) {\r\n\t\t\t// \t\t\tif (data.map[i].mask == \"273.0\") {\r\n\t\t\t// \t\t\t\tdelete data.map[i];\r\n\t\t\t// \t\t\t}\r\n\t\t\t// \t\t}\r\n\t\t\t// \t}\r\n\t\t\t// }\r\n\r\n\t\t\t// Sort so we keep the chain map order the same\r\n\t\t\tObject.sort(data.map, \"id\");\r\n\r\n\t\t\t$.extend(data, this.nodes(data.map)); // 250ms -> <100ms\r\n\t\t\t$.extend(this.data, data);\r\n\t\t\tthis.map.draw(this.newView(data.map), this.options); // 150ms\r\n\r\n\t\t\tif (options.chain.tabs[options.chain.active]) {\r\n\t\t\t\tfor (var x in options.chain.tabs[options.chain.active].collapsed) {\r\n\t\t\t\t\tvar node = $(\"#chainMap [data-nodeid='\"+options.chain.tabs[options.chain.active].collapsed[x]+\"']\").attr(\"id\");\r\n\r\n\t\t\t\t\tif (node) {\r\n\t\t\t\t\t\tnode = node.split(\"node\")[1];\r\n\t\t\t\t\t\tthis.map.collapse(node - 1, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.lines(data); // 300ms\r\n\t\t\tthis.grid(); // 4ms\r\n\r\n\t\t\t// Apply current system style\r\n\t\t\t$(\"#chainMap [data-nodeid='\"+viewingSystemID+\"']\").parent().addClass(\"currentNode\"); // 0.1ms\r\n\r\n\t\t\t// Remove old system effect tooltips and add current ones\r\n\t\t\tif (WormholeTypeToolTips.attachedElements && WormholeTypeToolTips.attachedElements.length > 0) {\r\n\t\t\t\tWormholeTypeToolTips.detach($(\"#chainMap .whEffect\"));\r\n\t\t\t}\r\n\t\t\tWormholeTypeToolTips.attach($(\"#chainMap .whEffect[data-icon]\")); // 0.30ms\r\n\r\n\t\t\tthis.drawing = false;\r\n\t\t}\r\n\r\n\t\t// Gather latest system activity\r\n\t\tif (!this.data.activity || new Date() > this.data.activity.expires) {\r\n\t\t\tdata.activity = {};\r\n\t\t\ttripwire.esi.universeJumps()\r\n\t\t\t\t.done(function(results, status, request) {\r\n\t\t\t\t\tdata.activity.expires = new Date(request.getResponseHeader(\"expires\"));\r\n\t\t\t\t\t$.each(results, function(x) {\r\n\t\t\t\t\t\tdata.activity[results[x].system_id] = {\r\n\t\t\t\t\t\t\tsystemID: results[x].system_id,\r\n\t\t\t\t\t\t\tshipJumps: results[x].ship_jumps\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.then(function() {\r\n\t\t\t\t\t return tripwire.esi.universeKills()\r\n\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t$.each(results, function(x) {\r\n\t\t\t\t\t\t\t\tif (data.activity[results[x].system_id]) {\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id].podKills = results[x].pod_kills;\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id].shipKills = results[x].ship_kills;\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id].npcKills = results[x].npc_kills;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id] = {\r\n\t\t\t\t\t\t\t\t\t\tsystemID: results[x].system_id,\r\n\t\t\t\t\t\t\t\t\t\tpodKills: results[x].pod_kills,\r\n\t\t\t\t\t\t\t\t\t\tshipKills: results[x].ship_kills,\r\n\t\t\t\t\t\t\t\t\t\tnpcKills: results[x].npc_kills,\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.then(function() {\r\n\t\t\t\t\tchain.data.activity = chain.activity(data.activity);\r\n\t\t\t\t});\r\n\t\t} else if (data.map) {\r\n\t\t\tchain.activity(this.data.activity);\r\n\t\t}\r\n\r\n\t\tif (data.occupied) { // 3ms\r\n\t\t\tthis.data.occupied = this.occupied(data.occupied);\r\n\t\t}\r\n\r\n\t\tif (data.flares) { // 20ms\r\n\t\t\tthis.data.flares = this.flares(data.flares);\r\n\t\t}\r\n\t}\r\n\r\n\tthis.collapse = function(c) {\r\n\t\tif (chain.drawing) return false;\r\n\r\n\t\tif (options.chain.tabs[options.chain.active]) {\r\n\t\t\tvar collapsed = chain.map.getCollapsedNodes();\r\n\t\t\toptions.chain.tabs[options.chain.active].collapsed = [];\r\n\t\t\tfor (x in collapsed) {\r\n\t\t\t\tvar systemID = $(\"#chainMap #node\"+(collapsed[x] +1)).data(\"nodeid\");\r\n\t\t\t\toptions.chain.tabs[options.chain.active].collapsed.push(systemID);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tchain.lines(chain.data);\r\n\r\n\t\t// Apply current system style\r\n\t\t$(\"#chainMap [data-nodeid='\"+viewingSystemID+\"']\").parent().addClass(\"currentNode\");\r\n\r\n\t\tif (WormholeTypeToolTips.attachedElements && WormholeTypeToolTips.attachedElements.length > 0) {\r\n\t\t\tWormholeTypeToolTips.detach($(\"#chainMap .whEffect\"));\r\n\t\t}\r\n\t\tWormholeTypeToolTips.attach($(\"#chainMap .whEffect[data-icon]\"));\r\n\r\n\t\tchain.activity(chain.data.activity);\r\n\r\n\t\tchain.occupied(chain.data.occupied);\r\n\r\n\t\tchain.flares(chain.data.flares);\r\n\r\n\t\tchain.grid();\r\n\r\n\t\toptions.save();\r\n\t}\r\n\r\n\tthis.init = function() {\r\n\t\tchain.map = new google.visualization.OrgChart(document.getElementById(\"chainMap\"));\r\n\t\tchain.options = {allowHtml: true, allowCollapse: true, size: \"medium\", nodeClass: \"node\"};\r\n\r\n\t\tgoogle.visualization.events.addListener(chain.map, \"collapse\", chain.collapse);\r\n\r\n\t\tchain.map.draw(new google.visualization.DataView(new google.visualization.DataTable({cols:[{label: \"System\", type: \"string\"}, {label: \"Parent\", type: \"string\"}]})), this.options);\r\n\t}\r\n\r\n\tgoogle.charts.setOnLoadCallback(this.init);\r\n}\r\n","var CKConfig = {\r\n\tskin: \"custom\",\r\n\theight: 100,\r\n\tallowedContent: true,\r\n\textraPlugins: \"toolbarswitch,autogrow,autolink\",\r\n\tenterMode: CKEDITOR.ENTER_BR,\r\n\tremoveDialogTabs: 'link:advanced',\r\n\tautoGrow_onStartup: true,\r\n\tautoGrow_minHeight: 100,\r\n\ttoolbar_minToolbar: [\r\n\t\t{name: \"basicstyles\", items: [\"Bold\", \"Italic\", \"Underline\", \"Strike\"]},\r\n\t\t{name: \"paragraph\", items: [\"BulletedList\", \"Outdent\", \"Indent\"]},\r\n\t\t{name: \"links\", items: [\"Link\"]},\r\n\t\t{name: \"colors\", items: [\"TextColor\", \"BGColor\"]},\r\n\t\t{name: \"styles\", items: [\"FontSize\"]},\r\n\t\t{name: \"tools\", items: [\"Toolbarswitch\"]}\r\n\t],\r\n\ttoolbar_maxToolbar: [\r\n\t\t{name: \"basicstyles\", items: [\"Bold\", \"Italic\", \"Underline\", \"Strike\", \"Subscript\", \"Superscript\"]},\r\n\t\t{name: \"paragraph\", items: [\"NumberedList\", \"BulletedList\", \"Outdent\", \"Indent\"]},\r\n\t\t{name: \"links\", items: [\"Link\"]},\r\n\t\t{name: \"colors\", items: [\"TextColor\", \"BGColor\"]},\r\n\t\t{name: \"styles\", items: [\"FontSize\", \"Font\"]},\r\n\t\t{name: \"tools\", items: [\"Source\", \"Toolbarswitch\"]}\r\n\t],\r\n\ttoolbar: \"minToolbar\",\r\n\tsmallToolbar: \"minToolbar\",\r\n\tmaximizedToolbar: \"maxToolbar\",\r\n\tfontSize_style: {\r\n\t    element:        'span',\r\n\t    styles:         { 'font-size': '#(size)' },\r\n\t    overrides:      [ { element :'font', attributes: { 'size': null } } ]\r\n\t}\r\n}\r\n\r\nCKEDITOR.on(\"instanceLoaded\", function(cke) {\r\n\tcke.editor.on(\"contentDom\", function() {\r\n\t\tcke.editor.on(\"key\", function(e) {\r\n\t\t\tif (e.data.keyCode == 27) {\r\n\t\t\t\t// escape key cancels\r\n\t\t\t\t$(cke.editor.element.$).closest(\".comment\").find(\".commentCancel\").click();\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (e.data.domEvent.$.altKey && e.data.domEvent.$.keyCode == 83) {\r\n\t\t\t\t// alt+s saves\r\n\t\t\t\t$(cke.editor.element.$).closest(\".comment\").find(\".commentSave\").click();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\t$(\".cke_combo__font a\")\r\n\t\t.removeClass(\"cke_combo_button\")\r\n\t\t.addClass(\"cke_button cke_button_off\")\r\n\t\t.html('<span class=\"cke_button_icon\">&nbsp;</span>')\r\n\r\n\t$(\".cke_combo__fontsize a\")\r\n\t\t.removeClass(\"cke_combo_button\")\r\n\t\t.addClass(\"cke_button cke_button_off\")\r\n\t\t.html('<span class=\"cke_button_icon\">&nbsp;</span>')\r\n});\r\n\r\nCKEDITOR.on(\"instanceReady\", function(cke) {\r\n\t// ensure focus on init\r\n\tcke.editor.focus();\r\n\r\n\tvar s = cke.editor.getSelection(); // getting selection\r\n\tvar selected_ranges = s.getRanges(); // getting ranges\r\n\tvar node = selected_ranges[0].startContainer; // selecting the starting node\r\n\tvar parents = node.getParents(true);\r\n\r\n\tnode = parents[parents.length - 2].getFirst();\r\n\r\n\tif (!node) return false;\r\n\r\n\twhile (true) {\r\n\t\tvar x = node.getNext();\r\n\t\tif (x == null) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tnode = x;\r\n\t}\r\n\r\n\ts.selectElement(node);\r\n\tselected_ranges = s.getRanges();\r\n\tselected_ranges[0].collapse(false);  //  false collapses the range to the end of the selected node, true before the node.\r\n\ts.selectRanges(selected_ranges);  // putting the current selection there\r\n});\r\n\r\nCKEDITOR.on(\"dialogDefinition\", function(ev) {\r\n\tif (ev.data.name == 'link') {\r\n\t\tev.data.definition.getContents('target').get('linkTargetType')['default'] = '_blank';\r\n\t}\r\n});\r\n","var guidance = (function (undefined) {\r\n\r\n\tvar extractKeys = function (obj) {\r\n\t\tvar keys = [];\r\n\r\n\t\tfor (var key in obj) {\r\n\t\t    Object.prototype.hasOwnProperty.call(obj,key) && keys.push(key);\r\n\t\t}\r\n\r\n\t\treturn keys;\r\n\t}\r\n\r\n\tvar sorter = function (a, b) {\r\n\t\treturn parseFloat (a) - parseFloat (b);\r\n\t}\r\n\r\n\tvar findPaths = function (map, start, end, infinity) {\r\n\t\tinfinity = infinity || Infinity;\r\n\r\n\t\tvar costs = {},\r\n\t\t    open = {'0': [start]},\r\n\t\t    predecessors = {},\r\n\t\t    keys;\r\n\r\n\t\tvar addToOpen = function (cost, vertex) {\r\n\t\t\tvar key = \"\" + cost;\r\n\t\t\tif (!open[key]) open[key] = [];\r\n\t\t\topen[key].push(vertex);\r\n\t\t}\r\n\r\n\t\tcosts[start] = 0;\r\n\r\n\t\twhile (open) {\r\n\t\t\tif(!(keys = extractKeys(open)).length) break;\r\n\r\n\t\t\tkeys.sort(sorter);\r\n\r\n\t\t\tvar key = keys[0],\r\n\t\t\t    bucket = open[key],\r\n\t\t\t    node = bucket.shift(),\r\n\t\t\t    currentCost = parseFloat(key),\r\n\t\t\t    adjacentNodes = map[node] || {};\r\n\r\n\t\t\tif (!bucket.length) delete open[key];\r\n\r\n\t\t\tfor (var vertex in adjacentNodes) {\r\n\t\t\t    if (Object.prototype.hasOwnProperty.call(adjacentNodes, vertex)) {\r\n\t\t\t\t\tvar cost = adjacentNodes[vertex],\r\n\t\t\t\t\t    totalCost = cost + currentCost,\r\n\t\t\t\t\t    vertexCost = costs[vertex];\r\n\r\n\t\t\t\t\tif ((vertexCost === undefined) || (vertexCost > totalCost)) {\r\n\t\t\t\t\t\tcosts[vertex] = totalCost;\r\n\t\t\t\t\t\taddToOpen(totalCost, vertex);\r\n\t\t\t\t\t\tpredecessors[vertex] = node;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (costs[end] === undefined) {\r\n\t\t\treturn null;\r\n\t\t} else {\r\n\t\t\treturn predecessors;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tvar extractShortest = function (predecessors, end) {\r\n\t\tvar nodes = [],\r\n\t\t    u = end;\r\n\r\n\t\twhile (u) {\r\n\t\t\tnodes.push(u);\r\n\t\t\tpredecessor = predecessors[u];\r\n\t\t\tu = predecessors[u];\r\n\t\t}\r\n\r\n\t\tnodes.reverse();\r\n\t\treturn nodes;\r\n\t}\r\n\r\n\tvar findShortestPath = function (map, nodes) {\r\n\t\tvar start = nodes.shift(),\r\n\t\t    end,\r\n\t\t    predecessors,\r\n\t\t    path = [],\r\n\t\t    shortest;\r\n\r\n\t\twhile (nodes.length) {\r\n\t\t\tend = nodes.shift();\r\n\t\t\tpredecessors = findPaths(map, start, end);\r\n\r\n\t\t\tif (predecessors) {\r\n\t\t\t\tshortest = extractShortest(predecessors, end);\r\n\t\t\t\tif (nodes.length) {\r\n\t\t\t\t\tpath.push.apply(path, shortest.slice(0, -1));\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn path.concat(shortest);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tstart = end;\r\n\t\t}\r\n\t}\r\n\r\n\tvar toArray = function (list, offset) {\r\n\t\ttry {\r\n\t\t\treturn Array.prototype.slice.call(list, offset);\r\n\t\t} catch (e) {\r\n\t\t\tvar a = [];\r\n\t\t\tfor (var i = offset || 0, l = list.length; i < l; ++i) {\r\n\t\t\t\ta.push(list[i]);\r\n\t\t\t}\r\n\t\t\treturn a;\r\n\t\t}\r\n\t}\r\n\r\n\tvar Guidance = function (map) {\r\n\t\tthis.map = map;\r\n\t}\r\n\r\n\tGuidance.prototype.findShortestPath = function (start, end) {\r\n\t\tvar result;\r\n\r\n\t\tif (Object.prototype.toString.call(start) === '[object Array]') {\r\n\t\t\tresult = findShortestPath(this.map, start);\r\n\t\t} else if (arguments.length === 2) {\r\n\t\t\tresult = findShortestPath(this.map, [start, end]);\r\n\t\t} else {\r\n\t\t\tresult = findShortestPath(this.map, toArray(arguments));\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tGuidance.findShortestPath = function (map, start, end) {\r\n\t\tif (Object.prototype.toString.call(start) === '[object Array]') {\r\n\t\t\treturn findShortestPath(map, start);\r\n\t\t} else if (arguments.length === 3) {\r\n\t\t\treturn findShortestPath(map, [start, end]);\r\n\t\t} else {\r\n\t\t\treturn findShortestPath(map, toArray(arguments, 1));\r\n\t\t}\r\n\t}\r\n\r\n\treturn Guidance;\r\n})();\r\n","$(\"#admin\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"disabled\")) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif (!$(\"#dialog-admin\").hasClass(\"ui-dialog-content\")) {\r\n\t\tvar refreshTimer = null;\r\n\t\tvar $total = null;\r\n\t\tvar $ajax = null;\r\n\r\n\t\tfunction refreshWindow() {\r\n\t\t\tif ($ajax) $ajax.abort();\r\n\t\t\t$total.html(\"Total: \" + $(\"#dialog-admin .window .hasFocus table tr[data-id]\").length);\r\n\r\n\t\t\t$ajax = $.ajax({\r\n\t\t\t\turl: \"admin.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: {mode: $(\"#dialog-admin .menu .active\").attr(\"data-window\")},\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tif (data && data.results) {\r\n\t\t\t\t\tvar rows = data.results;\r\n\t\t\t\t\tvar ids = [];\r\n\r\n\t\t\t\t\tfor (var i = 0, l = rows.length; i < l; i++) {\r\n\t\t\t\t\t\tvar $row = $(\"#dialog-admin .window .hasFocus tbody tr[data-id='\"+ rows[i].id +\"']\");\r\n\t\t\t\t\t\tids.push(rows[i].id);\r\n\r\n\t\t\t\t\t\tif ($row.length) {\r\n\t\t\t\t\t\t\tfor (col in rows[i]) {\r\n\t\t\t\t\t\t\t\tvar $col = $row.find(\"[data-col='\"+col+\"']\");\r\n\t\t\t\t\t\t\t\t$col.html(($col.attr(\"data-format\") == \"number\" ? numFormat(rows[i][col]) : rows[i][col]) || \"&nbsp;\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t$row = $(\"#dialog-admin .window .hasFocus table tr.hidden\").clone();\r\n\t\t\t\t\t\t\t$row.attr(\"data-id\", rows[i].id);\r\n\r\n\t\t\t\t\t\t\tfor (col in rows[i]) {\r\n\t\t\t\t\t\t\t\tvar $col = $row.find(\"[data-col='\"+col+\"']\");\r\n\t\t\t\t\t\t\t\t$col.html(($col.attr(\"data-format\") == \"number\" ? numFormat(rows[i][col]) : rows[i][col]) || \"&nbsp;\");\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t$row.removeClass(\"hidden\");\r\n\r\n\t\t\t\t\t\t\t$(\"#dialog-admin .window .hasFocus tbody\").append($row);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .window .hasFocus table tr[data-id]\").each(function() {\r\n\t\t\t\t\t\tif ($.inArray($(this).data(\"id\").toString(), ids) == -1) {\r\n\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .window .hasFocus table\").trigger(\"update\", [true]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#dialog-admin .window .hasFocus table tr[data-id]\").remove();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$total.html(\"Total: \" + $(\"#dialog-admin .window .hasFocus table tr[data-id]\").length);\r\n\t\t\t});\r\n\r\n\t\t\tif ($(\"#dialog-admin\").dialog(\"isOpen\") && $(\"#dialog-admin .menu .active\").attr(\"data-refresh\")) {\r\n\t\t\t\trefreshTimer = setTimeout(refreshWindow, $(\"#dialog-admin .menu .active\").attr(\"data-refresh\"));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t$(\"#dialog-admin\").dialog({\r\n\t\t\tautoOpen: true,\r\n\t\t\tmodal: true,\r\n\t\t\theight: 350,\r\n\t\t\twidth: 800,\r\n\t\t\tbuttons: {\r\n\t\t\t\tClose: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t// menu toggle\r\n\t\t\t\t$(\"#dialog-admin\").on(\"click\", \".menu li\", function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t$menuItem = $(this);\r\n\t\t\t\t\tclearTimeout(refreshTimer);\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .menu .active\").removeClass(\"active\");\r\n\t\t\t\t\t$menuItem.addClass(\"active\");\r\n\t\t\t\t\t$(\"div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane\").html(\"\");\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .window [data-window]\").removeClass(\"hasFocus\").hide();\r\n\t\t\t\t\t$(\"#dialog-admin .window [data-window='\"+ $menuItem.data(\"window\") +\"']\").addClass(\"hasFocus\").show();\r\n\r\n\t\t\t\t\trefreshWindow();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-admin [data-sortable='true']\").tablesorter({\r\n\t\t\t\t\tsortReset: true,\r\n\t\t\t\t\twidgets: ['saveSort'],\r\n\t\t\t\t\tsortList: [[0,0]]\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// dialog bottom tray\r\n\t\t\t\t$($(this)[0].parentElement).find(\".ui-dialog-buttonpane\").append(\"<div class='ui-dialog-traypane'></div>\");\r\n\t\t\t\t$total = $(\"div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane\");\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$menuItem = $(\"#dialog-admin .menu li.active\");\r\n\t\t\t\trefreshWindow();\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tclearTimeout(refreshTimer);\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-admin\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-admin\").dialog(\"open\");\r\n\t}\r\n});\r\n","// Dialog effects\r\n$(\"#wrapper\").addClass(\"transition\");\r\n\r\n$(document).on(\"dialogopen\", \".ui-dialog\", function (event, ui) {\r\n\t// Add additional full screen overlay for 2nd level dialog\r\n\tif ($(\".ui-dialog:visible\").length == 2 && $(this).hasClass(\"dialog-modal\"))\r\n\t\t$(\"body\").append($(\"<div id='overlay' class='overlay' />\").css(\"z-index\", $(this).css(\"z-index\") - 1));\r\n\telse if ($(\"#overlay\"))\r\n\t\t$(\"#overlay\").css(\"z-index\", $(this).css(\"z-index\") - 1);\r\n\r\n\tif (!$(this).hasClass(\"dialog-noeffect\"))\r\n\t\t$(\"#wrapper\").addClass(\"blur\");\r\n});\r\n\r\n$(document).on(\"dialogclose\", \".ui-dialog\", function (event, ui) {\r\n\tif (!$(\".ui-dialog\").is(\":visible\"))\r\n\t\t$(\"#wrapper\").removeClass(\"blur\");\r\n\r\n\tif ($(\".ui-dialog:visible\").length == 1)\r\n\t\t$(\"#overlay\").remove();\r\n\telse if ($(\"#overlay\"))\r\n\t\t$(\"#overlay\").css(\"z-index\", $(this).css(\"z-index\") - 2);\r\n\r\n\t//if ($(\".ui-dialog:visible\").length == 0 && options.buttons.follow && viewingSystemID != tripwire.client.EVE.systemID)\r\n\t//\twindow.location = \"?system=\"+tripwire.client.EVE.systemName;\r\n});\r\n\r\n// Signature overwrite\r\n$(document).on(\"click\", \"#overwrite\", function() {\r\n\tvar payload = {\"signatures\": {\"remove\": []}, \"systemID\": viewingSystemID};\r\n\tvar undo = [];\r\n\r\n\tvar signature = tripwire.client.signatures[$(this).data(\"id\")];\r\n\tif (signature.type != \"wormhole\") {\r\n\t\tundo.push(signature);\r\n\t\tpayload.signatures.remove.push(signature.id);\r\n\t} else {\r\n\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n\t\tundo.push({\"wormhole\": wormhole, \"signatures\": [tripwire.client.signatures[wormhole.initialID], tripwire.client.signatures[wormhole.secondaryID]]});\r\n\t\tpayload.signatures.remove.push(wormhole);\r\n\t}\r\n\r\n\t$(\"#overwrite\").attr(\"disable\", true);\r\n\r\n\tvar success = function(data) {\r\n\t\tif (data.resultSet && data.resultSet[0].result == true) {\r\n\t\t\tValidationTooltips.close();\r\n\r\n\t\t\t$(\"#undo\").removeClass(\"disabled\");\r\n\t\t\tif (viewingSystemID in tripwire.signatures.undo) {\r\n\t\t\t\ttripwire.signatures.undo[viewingSystemID].push({action: \"remove\", signatures: undo});\r\n\t\t\t} else {\r\n\t\t\t\ttripwire.signatures.undo[viewingSystemID] = [{action: \"remove\", signatures: undo}];\r\n\t\t\t}\r\n\r\n\t\t\tsessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n\r\n\t\t\tif ($(\"#dialog-signature\").parent().find(\":button:contains('Save')\")) {\r\n\t\t\t\t$(\"#dialog-signature\").parent().find(\":button:contains('Save')\").click();\r\n\t\t\t} else {\r\n\t\t\t\t$(\"#dialog-signature\").parent().find(\":button:contains('Add')\").click();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tvar always = function() {\r\n\t\t$(\"#overwrite\").removeAttr(\"disable\");\r\n\t}\r\n\r\n\ttripwire.refresh('refresh', payload, success, always);\r\n});\r\n","$(\".options\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"disabled\"))\r\n\t\treturn false;\r\n\r\n\t$(\"#dialog-options\").dialog({\r\n\t\tautoOpen: false,\r\n\t\twidth: 450,\r\n\t\tminHeight: 400,\r\n\t\tmodal: true,\r\n\t\tbuttons: {\r\n\t\t\tSave: function() {\r\n\t\t\t\t// Options\r\n\t\t\t\tvar data = {mode: \"set\", options: JSON.stringify(options)};\r\n\t\t\t\tvar maskChange = false;\r\n\r\n\t\t\t\t$(\"#dialog-options\").parent().find(\".ui-dialog-buttonpane button:contains('Save')\").attr(\"disabled\", true).addClass(\"ui-state-disabled\");\r\n\r\n\t\t\t\toptions.chain.typeFormat = $(\"#dialog-options #typeFormat\").val();\r\n\t\t\t\toptions.chain.classFormat = $(\"#dialog-options #classFormat\").val();\r\n\r\n\t\t\t\toptions.chain.gridlines = JSON.parse($(\"#dialog-options input[name=gridlines]:checked\").val());\r\n\r\n\t\t\t\toptions.chain[\"node-reference\"] = $(\"#dialog-options input[name=node-reference]:checked\").val();\r\n\r\n\t\t\t\toptions.signatures.editType = $(\"#dialog-options #editType\").val();\r\n\r\n\t\t\t\toptions.signatures.pasteLife = $(\"#dialog-options #pasteLife\").val();\r\n\r\n\t\t\t\toptions.signatures.copySeparator = $(\"#dialog-options #copySeparator\").val();\r\n\r\n\t\t\t\toptions.background = $(\"#dialog-options #background-image\").val();\r\n\r\n\t\t\t\toptions.uiscale = $(\"#dialog-options #uiscale-slider\").slider(\"value\");\r\n\r\n\t\t\t\tif (options.masks.active != $(\"#dialog-options input[name='mask']:checked\").val()) {\r\n\t\t\t\t\tmaskChange = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\toptions.masks.active = $(\"#dialog-options input[name='mask']:checked\").val();\r\n\r\n\t\t\t\toptions.apply();\r\n\t\t\t\toptions.save() // Performs AJAX\r\n\t\t\t\t\t.done(function() {\r\n\t\t\t\t\t\tif (maskChange) {\r\n\t\t\t\t\t\t\t// Reset signatures\r\n\t\t\t\t\t\t\t$(\"#sigTable span[data-age]\").countdown(\"destroy\");\r\n\t\t\t\t\t\t\t$(\"#sigTable tbody\").empty()\r\n\t\t\t\t\t\t\t$(\"#signature-count\").html(0);\r\n\t\t\t\t\t\t\ttripwire.signatures.list = {};\r\n\t\t\t\t\t\t\ttripwire.client.signatures = [];\r\n\r\n\t\t\t\t\t\t\ttripwire.refresh('change');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\r\n\t\t\t\t$(\"#dialog-options\").dialog(\"close\");\r\n\t\t\t\t$(\"#dialog-options\").parent().find(\".ui-dialog-buttonpane button:contains('Save')\").attr(\"disabled\", false).removeClass(\"ui-state-disabled\");\r\n\r\n\t\t\t\t// toggle mask admin icon\r\n\t\t\t\t$(\"#dialog-options input[name='mask']:checked\").data(\"admin\") ? $(\"#admin\").removeClass(\"disabled\") : $(\"#admin\").addClass(\"disabled\");\r\n\t\t\t},\r\n\t\t\tReset: function() {\r\n\t\t\t\t$(\"#dialog-confirm #msg\").html(\"Settings will be reset to defaults temporarily.<br/><br/><p><em>Save settings to make changes permanent.</em></p>\");\r\n\t\t\t\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tReset: function() {\r\n\t\t\t\t\t\t\toptions.reset();\r\n\t\t\t\t\t\t\toptions.apply();\r\n\r\n\t\t\t\t\t\t\t$(\"#dialog-options\").dialog(\"close\");\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}).dialog(\"open\");\r\n\t\t\t},\r\n\t\t\tClose: function() {\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t}\r\n\t\t},\r\n\t\topen: function() {\r\n\t\t\t// Get user stats data\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"user_stats.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tfor (i in data.stats) {\r\n\t\t\t\t\tfor (x in data.stats[i]) {\r\n\t\t\t\t\t\t$(\"#optionsAccordion #\"+ x).text(data.stats[i][x]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(\"#optionsAccordion #systems_visited\").text(data.system_visits);\r\n\t\t\t\t$(\"#optionsAccordion #logins\").text(data.account.logins);\r\n\t\t\t\t$(\"#optionsAccordion #lastLogin\").text(data.account.lastLogin);\r\n\t\t\t\t$(\"#optionsAccordion #username\").text(data.username);\r\n\t\t\t});\r\n\r\n\t\t\t// Get masks\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"masks.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(response) {\r\n\t\t\t\tif (response && response.masks) {\r\n\t\t\t\t\t$(\"#dialog-options #masks #default\").html(\"\");\r\n\t\t\t\t\t$(\"#dialog-options #masks #personal\").html(\"\");\r\n\t\t\t\t\t$(\"#dialog-options #masks #corporate\").html(\"\");\r\n\r\n\t\t\t\t\tfor (var x in response.masks) {\r\n\t\t\t\t\t\tvar mask = response.masks[x];\r\n\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t+ '<input type=\"radio\" name=\"mask\" id=\"mask'+x+'\" value=\"'+mask.mask+'\" class=\"selector\" data-owner=\"'+mask.owner+'\" data-admin=\"'+mask.admin+'\" />'\r\n\t\t\t\t\t\t\t+ '<label for=\"mask'+x+'\"><img src=\"'+mask.img+'\" />'\r\n\t\t\t\t\t\t\t+  (mask.optional ? '<i class=\"closeIcon\" onclick=\"return false;\" data-icon=\"red-giant\"><i data-icon=\"times\"></i></i>' : '')\r\n\t\t\t\t\t\t\t+ '<span class=\"selector_label\">'+mask.label+'</span></label>');\r\n\r\n\t\t\t\t\t\t$(\"#dialog-options #masks #\"+mask.type).append(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findp\" value=\"personal\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t+ '<label for=\"findp\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t$(\"#dialog-options #masks #personal\").append(node);\r\n\r\n\t\t\t\t\tif (init.admin == \"1\") {\r\n\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findc\" value=\"corporate\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t\t+ '<label for=\"findc\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t\t$(\"#dialog-options #masks #corporate\").append(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$(\"#dialog-options input[name='mask']\").filter(\"[value='\"+response.masks[response.active].mask+\"']\").attr(\"checked\", true).trigger(\"change\");\r\n\r\n\t\t\t\t\t// toggle mask admin icon\r\n\t\t\t\t\tresponse.masks[response.active].admin ? $(\"#admin\").removeClass(\"disabled\") : $(\"#admin\").addClass(\"disabled\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-options #editType\").val(options.signatures.editType);\r\n\t\t\t$(\"#dialog-options #pasteLife\").val(options.signatures.pasteLife);\r\n\t\t\t$(\"#dialog-options #copySeparator\").val(options.signatures.copySeparator);\r\n\t\t\t$(\"#dialog-options #typeFormat\").val(options.chain.typeFormat);\r\n\t\t\t$(\"#dialog-options #classFormat\").val(options.chain.classFormat);\r\n\t\t\t$(\"#dialog-options input[name='node-reference'][value='\"+options.chain[\"node-reference\"]+\"']\").prop(\"checked\", true);\r\n\t\t\t$(\"#dialog-options input[name='gridlines'][value='\"+options.chain.gridlines+\"']\").prop(\"checked\", true);\r\n\t\t\t$(\"#dialog-options #background-image\").val(options.background);\r\n\t\t},\r\n\t\tcreate: function() {\r\n\t\t\t$(\"#optionsAccordion\").accordion({heightStyle: \"content\", collapsible: true, active: false});\r\n\r\n\t\t\t$(\"#uiscale-slider\").slider({\r\n\t\t\t\tmin: 0.7,\r\n\t\t\t\tmax: 1.4,\r\n\t\t\t\tstep: 0.05,\r\n\t\t\t\tvalue: options.uiscale || 1.0,\r\n\t\t\t\tchange: function(e, ui) {\r\n\t\t\t\t\t$(\"body\").css(\"zoom\", ui.value);\r\n\t\t\t\t},\r\n\t\t\t\tslide: function(e, ui) {\r\n\t\t\t\t\t$(\"label[for='uiscale-slider']\").html(ui.value);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"label[for='uiscale-slider']\").html($(\"#uiscale-slider\").slider(\"value\"));\r\n\r\n\t\t\t$(\"#dialog-pwChange\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tresizable: false,\r\n\t\t\t\tminHeight: 0,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tSave: function() {\r\n\t\t\t\t\t\t$(\"#pwForm\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#pwForm input[name='password'], #pwForm input[name='confirm']\").val(\"\");\r\n\t\t\t\t\t$(\"#pwError\").text(\"\").hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#pwChange\").click(function() {\r\n\t\t\t\t$(\"#dialog-pwChange\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#pwForm\").submit(function(e) {\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t$(\"#pwError\").text(\"\").hide();\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: \"options.php\",\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t$(\"#dialog-msg #msg\").text(\"Password changed\");\r\n\t\t\t\t\t\t$(\"#dialog-msg\").dialog(\"open\");\r\n\r\n\t\t\t\t\t\t$(\"#dialog-pwChange\").dialog(\"close\");\r\n\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t$(\"#pwError\").text(response.error).show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#pwError\").text(\"Unknown error\").show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-usernameChange\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tresizable: false,\r\n\t\t\t\tminHeight: 0,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tSave: function() {\r\n\t\t\t\t\t\t$(\"#usernameForm\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\topen: function() {\r\n\t\t\t\t\t$(\"#usernameForm #username\").html($(\"#dialog-options #username\").html());\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#usernameForm [name='username']\").val(\"\");\r\n\t\t\t\t\t$(\"#usernameError\").text(\"\").hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#usernameChange\").click(function() {\r\n\t\t\t\t$(\"#dialog-usernameChange\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#usernameForm\").submit(function(e) {\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t$(\"#usernameError\").text(\"\").hide();\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: \"options.php\",\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t$(\"#dialog-msg #msg\").text(\"Username changed\");\r\n\t\t\t\t\t\t$(\"#dialog-msg\").dialog(\"open\");\r\n\r\n\t\t\t\t\t\t$(\"#dialog-options #username\").html(response.result);\r\n\r\n\t\t\t\t\t\t$(\"#dialog-usernameChange\").dialog(\"close\");\r\n\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t$(\"#usernameError\").text(response.error).show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#usernameError\").text(\"Unknown error\").show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Mask selections\r\n\t\t\t$(\"#masks\").on(\"change\", \"input.selector:checked\", function() {\r\n\t\t\t\tif ($(this).data(\"owner\")) {\r\n\t\t\t\t\t$(\"#maskControls #edit\").removeAttr(\"disabled\");\r\n\t\t\t\t\t$(\"#maskControls #delete\").removeAttr(\"disabled\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#maskControls #edit\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t\t$(\"#maskControls #delete\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($(this).val() != 0.0 && $(this).val().split(\".\")[1] == 0) {\r\n\t\t\t\t\t$(\"#dialog-options #leave\").removeAttr(\"disabled\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#dialog-options #leave\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Mask join\r\n\t\t\t$(\"#dialog-joinMask\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tresizable: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tAdd: function() {\r\n\t\t\t\t\t\tvar mask = $(\"#dialog-joinMask #results input:checked\");\r\n\t\t\t\t\t\tvar label = $(\"#dialog-joinMask #results input:checked+label\");\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: {mask: mask.val(), mode: \"join\"},\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\tlabel.css(\"width\", \"\");\r\n\t\t\t\t\t\t\t\tlabel.find(\".info\").remove();\r\n\t\t\t\t\t\t\t\tlabel.append('<i class=\"closeIcon\" onclick=\"return false;\" data-icon=\"red-giant\"><i data-icon=\"times\"></i></i>');\r\n\r\n\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #\"+response.type+\" input.selector:last\").before(mask).before(label);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-joinMask\").dialog(\"close\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#dialog-joinMask form\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$(\"#dialog-joinMask #results\").html(\"\");\r\n\t\t\t\t\t\t$(\"#dialog-joinMask #loading\").show();\r\n\t\t\t\t\t\t$(\"#dialog-joinMask input[type='submit']\").attr(\"disabled\", \"disabled\");\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).then(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.results && response.results.length) {\r\n\t\t\t\t\t\t\t\treturn tripwire.esi.fullLookup(response.eveIDs)\r\n\t\t\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\t\t\tif (results) {\r\n\t\t\t\t\t\t\t\t\t\t\tfor (var x in results) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar mask = response.results[x];\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"radio\" name=\"mask\" id=\"mask'+mask.mask+'\" value=\"'+mask.mask+'\" class=\"selector\" data-owner=\"false\" data-admin=\"'+mask.admin+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"mask'+mask.mask+'\" style=\"width: 100%; margin-left: -5px;\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"'+mask.img+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">'+mask.label+'</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name + '<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].category == \"character\" ? results[x].corporation.name +'<br/>' : null)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-joinMask #results\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(response.error);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unknown error\");\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).then(function() {\r\n\t\t\t\t\t\t\t$(\"#dialog-joinMask #loading\").hide();\r\n\t\t\t\t\t\t\t$(\"#dialog-joinMask input[type='submit']\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#dialog-joinMask #results\").html(\"\");\r\n\t\t\t\t\t$(\"#dialog-joinMask input[name='name']\").val(\"\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-options #masks\").on(\"click\", \"input[name='find']+label\", function() {\r\n\t\t\t\t$(\"#dialog-joinMask input[name='find']\").val($(this).prev().val());\r\n\t\t\t\t$(\"#dialog-joinMask\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// Mask leave\r\n\t\t\t$(\"#dialog-options #masks\").on(\"click\", \".closeIcon\", function() {\r\n\t\t\t\tvar mask = $(this).closest(\"input.selector+label\").prev();\r\n\r\n\t\t\t\t$(\"#dialog-confirm #msg\").text(\"Are you sure you want to remove this mask?\");\r\n\r\n\t\t\t\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tRemove: function() {\r\n\t\t\t\t\t\t\tvar send = {mode: \"leave\", mask: mask.val()};\r\n\r\n\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\t\tdata: send,\r\n\t\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t\tmask.next().remove();\r\n\t\t\t\t\t\t\t\t\tmask.remove();\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unable to delete\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}).dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// Mask delete\r\n\t\t\t$(\"#maskControls #delete\").click(function() {\r\n\t\t\t\tvar mask = $(\"#masks input.selector:checked\");\r\n\r\n\t\t\t\t$(\"#dialog-confirm #msg\").text(\"Are you sure you want to delete this mask?\");\r\n\t\t\t\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tDelete: function() {\r\n\t\t\t\t\t\t\tvar send = {mode: \"delete\", mask: mask.val()};\r\n\r\n\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\t\tdata: send,\r\n\t\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t\tmask.next().remove();\r\n\t\t\t\t\t\t\t\t\tmask.remove();\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unable to delete\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}).dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// User Create mask\r\n\t\t\t$(\"#dialog-createMask\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tCreate: function() {\r\n\t\t\t\t\t\t$(\"#dialog-createMask form\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#dialog-createMask #accessList\").on(\"click\", \"#create_add+label\", function() {\r\n\t\t\t\t\t\t$(\"#dialog-EVEsearch\").dialog(\"open\");\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-createMask form\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t// Get masks\r\n\t\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\t\t\tif (response && response.masks) {\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #default\").html(\"\");\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #personal\").html(\"\");\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #corporate\").html(\"\");\r\n\r\n\t\t\t\t\t\t\t\t\t\tfor (var x in response.masks) {\r\n\t\t\t\t\t\t\t\t\t\t\tvar mask = response.masks[x];\r\n\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"radio\" name=\"mask\" id=\"mask'+x+'\" value=\"'+mask.mask+'\" class=\"selector\" data-owner=\"'+mask.owner+'\" data-admin=\"'+mask.admin+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"mask'+x+'\"><img src=\"'+mask.img+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+  (mask.optional ? '<i class=\"closeIcon\" onclick=\"return false;\" data-icon=\"red-giant\"><i data-icon=\"times\"></i></i>' : '')\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<span class=\"selector_label\">'+mask.label+'</span></label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #\"+mask.type).append(node);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findp\" value=\"personal\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"findp\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #personal\").append(node);\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (init.admin == \"1\") {\r\n\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findc\" value=\"corporate\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"findc\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #corporate\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options input[name='mask']\").filter(\"[value='\"+response.masks[response.active].mask+\"']\").attr(\"checked\", true).trigger(\"change\");\r\n\r\n\t\t\t\t\t\t\t\t\t\t// toggle mask admin icon\r\n\t\t\t\t\t\t\t\t\t\tresponse.masks[response.active].admin ? $(\"#admin\").removeClass(\"disabled\") : $(\"#admin\").addClass(\"disabled\");\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t$(\"#dialog-createMask\").dialog(\"close\");\r\n\t\t\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(response.error);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unknown error\");\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-createMask select\").selectmenu({width: 100});\r\n\t\t\t\t},\r\n\t\t\t\topen: function() {\r\n\t\t\t\t\t$(\"#dialog-createMask input[name='name']\").val(\"\");\r\n\t\t\t\t\t$(\"#dialog-createMask #accessList :not(.static)\").remove();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#maskControls #create\").click(function() {\r\n\t\t\t\t$(\"#dialog-createMask\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-createMask #accessList\").on(\"click\", \".maskRemove\", function() {\r\n\t\t\t\t$(this).closest(\"input.selector+label\").prev().remove();\r\n\t\t\t\t$(this).closest(\"label\").remove();\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-editMask\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tSave: function() {\r\n\t\t\t\t\t\t$(\"#dialog-editMask form\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList\").on(\"click\", \".maskRemove\", function() {\r\n\t\t\t\t\t\t$(this).closest(\"input.selector+label\").prev().attr(\"name\", \"deletes[]\").hide();\r\n\t\t\t\t\t\t$(this).closest(\"label\").hide();\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList\").on(\"click\", \"#edit_add+label\", function() {\r\n\t\t\t\t\t\t$(\"#dialog-EVEsearch\").dialog(\"open\");\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-editMask form\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-editMask\").dialog(\"close\");\r\n\t\t\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(response.error);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unknown error\");\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\topen: function() {\r\n\t\t\t\t\tvar mask = $(\"#dialog-options input[name='mask']:checked\").val();\r\n\t\t\t\t\t$(\"#dialog-editMask input[name='mask']\").val(mask);\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList label.static\").hide();\r\n\t\t\t\t\t$(\"#dialog-editMask #loading\").show();\r\n\t\t\t\t\t$(\"#dialog-editMask #name\").text($(\"#dialog-options input[name='mask']:checked+label .selector_label\").text());\r\n\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\tdata: {mode: \"edit\", mask: mask},\r\n\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t}).then(function(response) {\r\n\t\t\t\t\t\tif (response && response.results && response.results.length) {\r\n\t\t\t\t\t\t\treturn tripwire.esi.fullLookup(response.results)\r\n\t\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\t\tif (results) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var x in results) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (results[x].category == \"character\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" checked=\"checked\" onclick=\"return false\" name=\"\" id=\"edit_'+results[x].id+'_1373\" value=\"'+results[x].id+'_1373\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"edit_'+results[x].id+'_1373\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Character/'+results[x].id+'_64.jpg\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Character</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name + '<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].corporation.name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t<input type=\"button\" class=\"maskRemove\" value=\"Remove\" style=\"position: absolute; bottom: 3px; right: 3px;\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-editMask #accessList .static:first\").before(node);\r\n\t\t\t\t\t\t\t\t\t\t\t} else if (results[x].category == \"corporation\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" checked=\"checked\" onclick=\"return false\" name=\"\" id=\"edit_'+results[x].id+'_2\" value=\"'+results[x].id+'_2\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"edit_'+results[x].id+'_2\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Corporation/'+results[x].id+'_64.png\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Corporation</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t<input type=\"button\" class=\"maskRemove\" value=\"Remove\" style=\"position: absolute; bottom: 3px; right: 3px;\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-editMask #accessList .static:first\").before(node);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).then(function(response) {\r\n\t\t\t\t\t\t$(\"#dialog-editMask #accessList label.static\").show();\r\n\t\t\t\t\t\t$(\"#dialog-editMask #loading\").hide();\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList :not(.static)\").remove();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#maskControls #edit\").click(function() {\r\n\t\t\t\t$(\"#dialog-editMask\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// EVE search dialog\r\n\t\t\t$(\"#dialog-EVEsearch\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tAdd: function() {\r\n\t\t\t\t\t\tif ($(\"#accessList input[value='\"+$(\"#EVESearchResults input\").val()+\"']\").length) {\r\n\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Already has access\");\r\n\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$(\"#EVESearchResults .info\").append('<input type=\"button\" class=\"maskRemove\" value=\"Remove\" style=\"position: absolute; bottom: 3px; right: 3px;\" />');\r\n\t\t\t\t\t\t$(\"#EVESearchResults input:checked\").attr(\"checked\", \"checked\");\r\n\t\t\t\t\t\t$(\"#EVESearchResults input:checked\").attr(\"onclick\", \"return false\");\r\n\r\n\t\t\t\t\t\tvar nodes = $(\"#EVESearchResults .maskNode:has(input:checked)\");\r\n\r\n\t\t\t\t\t\tif ($(\"#dialog-createMask\").dialog(\"isOpen\"))\r\n\t\t\t\t\t\t\t$(\"#dialog-createMask #accessList .static:first\").before(nodes);\r\n\t\t\t\t\t\telse if ($(\"#dialog-editMask\").dialog(\"isOpen\"))\r\n\t\t\t\t\t\t\t$(\"#dialog-editMask #accessList .static:first\").before(nodes);\r\n\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t},\r\n\t\t\t\t\tClose: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#EVEsearch\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\tif ($(\"#EVEsearch input[name='name']\").val() == \"\") {\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$(\"#EVESearchResults, #searchCount\").html(\"\");\r\n\t\t\t\t\t\t$(\"#EVEsearch #searchSpinner\").show();\r\n\t\t\t\t\t\t$(\"#EVEsearch input[type='submit']\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t\t\t$(\"#dialog-EVEsearch\").parent().find(\".ui-dialog-buttonpane button:contains('Add')\").attr(\"disabled\", true).addClass(\"ui-state-disabled\");\r\n\r\n\t\t\t\t\t\ttripwire.esi.search($(\"#EVEsearch input[name='name']\").val(), $(\"#EVEsearch input[name='category']:checked\").val(), $(\"#EVEsearch input[name='exact']\")[0].checked)\r\n\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\tif (results && (results.character || results.corporation)) {\r\n\t\t\t\t\t\t\t\t\t// limit results\r\n\t\t\t\t\t\t\t\t\tresults = $.merge(results.character || [], results.corporation || []);\r\n\t\t\t\t\t\t\t\t\ttotal = results.length;\r\n\t\t\t\t\t\t\t\t\tresults = results.slice(0, 10);\r\n\t\t\t\t\t\t\t\t\treturn tripwire.esi.fullLookup(results)\r\n\t\t\t\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#EVEsearch #searchCount\").html(\"Found: \"+total+\"<br/>Showing: \"+(total<10?total:10));\r\n\t\t\t\t\t\t\t\t\t\t\tif (results) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tfor (var x in results) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (results[x].category == \"character\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<div class=\"maskNode\"><input type=\"checkbox\" name=\"adds[]\" id=\"find_'+results[x].id+'_1373\" value=\"'+results[x].id+'_1373\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"find_'+results[x].id+'_1373\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Character/'+results[x].id+'_64.jpg\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Character</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name + '<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].corporation.name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label></div>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(\"#EVESearchResults\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (results[x].category == \"corporation\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<div class=\"maskNode\"><input type=\"checkbox\" name=\"adds[]\" id=\"find_'+results[x].id+'_2\" value=\"'+results[x].id+'_2\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"find_'+results[x].id+'_2\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Corporation/'+results[x].id+'_64.png\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Corporation</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label></div>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(\"#EVESearchResults\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}).always(function() {\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#EVEsearch #searchSpinner\").hide();\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#EVEsearch input[type='submit']\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-EVEsearch\").parent().find(\".ui-dialog-buttonpane button:contains('Add')\").removeAttr(\"disabled\").removeClass(\"ui-state-disabled\");\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"No Results\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#EVEsearch #searchSpinner\").hide();\r\n\t\t\t\t\t\t\t\t\t$(\"#EVEsearch input[type='submit']\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-EVEsearch\").parent().find(\".ui-dialog-buttonpane button:contains('Add')\").removeAttr(\"disabled\").removeClass(\"ui-state-disabled\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#EVEsearch input[name='name']\").val(\"\");\r\n\t\t\t\t\t$(\"#EVESearchResults, #searchCount\").html(\"\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\t$(\"#dialog-options\").dialog(\"open\");\r\n});\r\n","$(\"#signaturesWidget\").on(\"click\", \"#delete-signature\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).closest(\"tr\").attr(\"disabled\")) {\r\n\t\treturn false;\r\n\t} else if ($(\"#sigTable tr.selected\").length == 0) {\r\n\t\treturn false;\r\n\t} else if ($(\"#dialog-sigEdit\").hasClass(\"ui-dialog-content\") && $(\"#dialog-sigEdit\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-sigEdit\").parent().effect(\"shake\", 300);\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-deleteSig\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-deleteSig\").dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tDelete: function() {\r\n\t\t\t\t\t// Prevent duplicate submitting\r\n\t\t\t\t\t$(\"#dialog-deleteSig\").parent().find(\":button:contains('Delete')\").button(\"disable\");\r\n\t\t\t\t\tvar payload = {\"signatures\": {\"remove\": []}, \"systemID\": viewingSystemID};\r\n\t\t\t\t\tvar undo = [];\r\n\r\n\t\t\t\t\tvar signatures = $.map($(\"#sigTable tr.selected\"), function(n) {\r\n\t\t\t\t\t\tvar signature = tripwire.client.signatures[$(n).data(\"id\")];\r\n\t\t\t\t\t\tif (signature.type != \"wormhole\") {\r\n\t\t\t\t\t\t\tundo.push(signature);\r\n\t\t\t\t\t\t\treturn signature.id;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n\t\t\t\t\t\t\tundo.push({\"wormhole\": wormhole, \"signatures\": [tripwire.client.signatures[wormhole.initialID], tripwire.client.signatures[wormhole.secondaryID]]});\r\n\t\t\t\t\t\t\treturn wormhole;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tpayload.signatures.remove = signatures;\r\n\r\n\t\t\t\t\tvar success = function(data) {\r\n\t\t\t\t\t\tif (data.resultSet && data.resultSet[0].result == true) {\r\n\t\t\t\t\t\t\t$(\"#dialog-deleteSig\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t$(\"#undo\").removeClass(\"disabled\");\r\n\t\t\t\t\t\t\tif (viewingSystemID in tripwire.signatures.undo) {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[viewingSystemID].push({action: \"remove\", signatures: undo});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[viewingSystemID] = [{action: \"remove\", signatures: undo}];\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tsessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar always = function(data) {\r\n\t\t\t\t\t\t$(\"#dialog-deleteSig\").parent().find(\":button:contains('Delete')\").button(\"enable\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttripwire.refresh('refresh', payload, success, always);\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\t$(\"#sigTable tr.selected\").removeClass(\"selected\");\r\n\t\t\t\t//$(\"#sigTable .sigDelete\").removeClass(\"invisible\");\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-deleteSig\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-deleteSig\").dialog(\"open\");\r\n\t}\r\n});\r\n","$(\"#sigTable tbody\").on(\"dblclick\", \"tr\", {mode: \"dblclick-update\"}, openSignatureDialog);\r\n$(\"#edit-signature\").on(\"click\", {mode: \"update\"}, openSignatureDialog);\r\n$(\"#add-signature\").click({mode: \"add\"}, openSignatureDialog);\r\n\r\nfunction openSignatureDialog(e) {\r\n\te.preventDefault();\r\n\tmode = e.data.mode;\r\n\telement = this;\r\n\r\n\tif (mode == \"dblclick-update\") {\r\n\t\t$(\"#sigTable tr.selected\").removeClass(\"selected\");\r\n\t\t$(this).closest(\"tr\").addClass(\"selected\");\r\n\t\tmode = \"update\";\r\n\t} else if (mode == \"update\") {\r\n\t\tvar elements = $(\"#sigTable tbody tr.selected\");\r\n\t\tif (elements.length !== 1) {\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\telement = elements[0];\r\n\t\t}\r\n\t}\r\n\r\n\tif (!$(\"#dialog-signature\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-signature\").dialog({\r\n\t\t\tautoOpen: true,\r\n\t\t\tresizable: false,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tposition: {my: \"center\", at: \"center\", of: $(\"#signaturesWidget\")},\r\n\t\t\tbuttons: {\r\n\t\t\t\tSave: function() {\r\n\t\t\t\t\t$(\"#form-signature\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tAdd: function() {\r\n\t\t\t\t\t$(\"#form-signature\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\tvar aSigWormholes = $.map(tripwire.wormholes, function(item, index) { return index;});\r\n\t\t\t\taSigWormholes.splice(26, 0, \"K162\");\r\n\t\t\t\taSigWormholes.push(\"GATE\");\r\n\t\t\t\taSigWormholes.push(\"SML\");\r\n\t\t\t\taSigWormholes.push(\"MED\");\r\n\t\t\t\taSigWormholes.push(\"LRG\");\r\n\t\t\t\taSigWormholes.push(\"XLG\");\r\n\r\n\t\t\t\t$(\"#dialog-signature [name='signatureType'], #dialog-signature [name='signatureLife']\").selectmenu({width: 100});\r\n\t\t\t\t$(\"#dialog-signature [name='wormholeLife'], #dialog-signature [name='wormholeMass']\").selectmenu({width: 80});\r\n\t\t\t\t$(\"#dialog-signature [data-autocomplete='sigSystems']\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0});\r\n\t\t\t\t$(\"#dialog-signature [data-autocomplete='sigType']\").inlinecomplete({source: aSigWormholes, maxSize: 10, delay: 0});\r\n\r\n\t\t\t\t$(\"#dialog-signature #durationPicker\").durationPicker();\r\n\t\t\t\t$(\"#dialog-signature #durationPicker\").on(\"change\", function() {\r\n\t\t\t\t\t// prevent negative values\r\n\t\t\t\t\tif (this.value < 0) {\r\n\t\t\t\t\t\tthis.value = 0;\r\n\t\t\t\t\t\t$(this).change();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Ensure first signature ID field only accepts letters\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID_Alpha'], #dialog-signature [name='signatureID2_Alpha']\").on(\"input\", function() {\r\n\t\t\t\t\twhile (!/^[a-zA-Z?]*$/g.test(this.value)) {\r\n\t\t\t\t\t\tthis.value = this.value.substring(0, this.value.length -1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Move to the numeric ID after filling out alpha ID\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID_Alpha']\").on(\"input\", function() {\r\n\t\t\t\t\tif (this.value.length === 3) {\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureID_Numeric']\").select();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID2_Alpha']\").on(\"input\", function() {\r\n\t\t\t\t\tif (this.value.length === 3) {\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureID2_Numeric']\").select();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Ensure second signature ID field only accepts numbers\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID_Numeric'], #dialog-signature [name='signatureID2_Numeric']\").on(\"input\", function() {\r\n\t\t\t\t\twhile (!/^[0-9?]*$/g.test(this.value)) {\r\n\t\t\t\t\t\tthis.value = this.value.substring(0, this.value.length -1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Select value on click\r\n\t\t\t\t$(\"#dialog-signature .signatureID, #dialog-signature .wormholeType\").on(\"click\", function() {\r\n\t\t\t\t\t$(this).select();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Auto fill opposite side wormhole w/ K162\r\n\t\t\t\t$(\"#dialog-signature .wormholeType\").on(\"input, change\", function() {\r\n\t\t\t\t\tif (this.value.length > 0 && $.inArray(this.value.toUpperCase(), aSigWormholes) != -1 && this.value.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature .wormholeType\").not(this).val(\"K162\");\r\n\r\n\t\t\t\t\t\t// Also auto calculate duration\r\n\t\t\t\t\t\tif (tripwire.wormholes[this.value.toUpperCase()]) {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature #durationPicker\").val(tripwire.wormholes[this.value.toUpperCase()].life.substring(0, 2) * 60 * 60).change();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (this.value.toUpperCase() === \"K162\") {\r\n\t\t\t\t\t\tif ($.inArray($(\"#dialog-signature .wormholeType\").not(this).val(), aSigWormholes) != -1) {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature .wormholeType\").not(this).val(\"????\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (this.value == \"????\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature .wormholeType\").not(this).val(\"K162\");\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Toggle between wormhole and regular signatures\r\n\t\t\t\t$(\"#dialog-signature\").on(\"selectmenuchange\", \"[name='signatureType']\", function() {\r\n\t\t\t\t\tif (this.value == \"wormhole\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature #site\").slideUp(200, function() { $(this).hide(0); });\r\n\t\t\t\t\t\t$(\"#dialog-signature #wormhole\").slideDown(200, function() { $(this).show(200); });\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#dialog-signature #site\").slideDown(200, function() { $(this).show(200); });\r\n\t\t\t\t\t\t$(\"#dialog-signature #wormhole\").slideUp(200, function() { $(this).hide(0); });\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tValidationTooltips.close();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#form-signature\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar form = $(this).serializeObject();\r\n\t\t\t\t\tvar valid = true;\r\n\t\t\t\t\tValidationTooltips.close();\r\n\r\n\t\t\t\t\t// Validate full signature ID fields (blank | 3 characters)\r\n\t\t\t\t\t$.each($(\"#dialog-signature .signatureID:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && this.value.length < 3) {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Must be 3 characters in length!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate full signature ID doesn't already exist in current system\r\n\t\t\t\t\tif (form.signatureID_Alpha.length === 3 && form.signatureID_Numeric.length === 3 && Object.find(tripwire.client.signatures, \"signatureID\", form.signatureID_Alpha + form.signatureID_Numeric, true) != false && Object.find(tripwire.client.signatures, \"signatureID\", form.signatureID_Alpha + form.signatureID_Numeric, true).id != $(\"#dialog-signature\").data(\"signatureid\")) {\r\n\t\t\t\t\t\tvar existingSignature = Object.find(tripwire.client.signatures, \"signatureID\", form.signatureID_Alpha + form.signatureID_Numeric);\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-signature .signatureID:first\")}).setContent(\"Signature ID already exists! <input type='button' autofocus='true' id='overwrite' value='Overwrite' style='margin-bottom: -4px; margin-top: -4px; font-size: 0.8em;' data-id='\"+ existingSignature.id +\"' />\");\r\n\t\t\t\t\t\t$(\"#overwrite\").focus();\r\n\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate wormhole types (blank | wormhole)\r\n\t\t\t\t\t$.each($(\"#dialog-signature .wormholeType:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && $.inArray(this.value.toUpperCase(), aSigWormholes) == -1 && this.value != \"????\") {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Must be a valid wormhole type!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate leads to system (blank | system)\r\n\t\t\t\t\t$.each($(\"#dialog-signature .leadsTo:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && tripwire.aSigSystems.findIndex((item) => this.value.toLowerCase() === item.toLowerCase()) == -1) {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Must be a valid leads to system!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate leads to isn't the viewing system which causes a inner loop\r\n\t\t\t\t\t$.each($(\"#dialog-signature .leadsTo:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && this.value.toLowerCase() === viewingSystem.toLowerCase()) {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Wormhole cannot lead to the same system it comes from!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\tvar payload = {};\r\n\t\t\t\t\tvar undo = [];\r\n\t\t\t\t\tif (form.signatureType === \"wormhole\") {\r\n\t\t\t\t\t\tvar signature = {\r\n\t\t\t\t\t\t\t\"signatureID\": form.signatureID_Alpha + form.signatureID_Numeric,\r\n\t\t\t\t\t\t\t\"systemID\": viewingSystemID,\r\n\t\t\t\t\t\t\t\"type\": \"wormhole\",\r\n\t\t\t\t\t\t\t\"name\": form.wormholeName,\r\n\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tvar leadsTo = null;\r\n\t\t\t\t\t\tif (Object.index(tripwire.systems, \"name\", form.leadsTo, true)) {\r\n\t\t\t\t\t\t\t// Leads To is a normal EVE system, so use the sytem ID\r\n\t\t\t\t\t\t\tleadsTo = Object.index(tripwire.systems, \"name\", form.leadsTo, true)\r\n\t\t\t\t\t\t} else if (tripwire.wormholes[form.wormholeType.toUpperCase()]) {\r\n\t\t\t\t\t\t\t// Leads To can be determined by the wormhole type, so lets use what we know it leads to\r\n\t\t\t\t\t\t\tif (tripwire.aSigSystems.findIndex((item) => tripwire.wormholes[form.wormholeType.toUpperCase()].leadsTo.replace(' ', '-').toLowerCase() === item.toLowerCase()) > -1) {\r\n\t\t\t\t\t\t\t\tleadsTo = tripwire.aSigSystems.findIndex((item) => tripwire.wormholes[form.wormholeType.toUpperCase()].leadsTo.replace(' ', '-').toLowerCase() === item.toLowerCase());\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (tripwire.aSigSystems.findIndex((item) => form.leadsTo.toLowerCase() === item.toLowerCase()) !== -1) {\r\n\t\t\t\t\t\t\t// Leads To is one of the valid types we allow, so use of of those indexes as reference\r\n\t\t\t\t\t\t\tleadsTo = tripwire.aSigSystems.findIndex((item) => form.leadsTo.toLowerCase() === item.toLowerCase());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar signature2 = {\r\n\t\t\t\t\t\t\t\"signatureID\": form.signatureID2_Alpha + form.signatureID2_Numeric,\r\n\t\t\t\t\t\t\t\"systemID\": leadsTo,\r\n\t\t\t\t\t\t\t\"type\": \"wormhole\",\r\n\t\t\t\t\t\t\t\"name\": form.wormholeName2,\r\n\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tvar type = null;\r\n\t\t\t\t\t\tvar parent = null;\r\n\t\t\t\t\t\tif (form.wormholeType.length > 0 && $.inArray(form.wormholeType.toUpperCase(), aSigWormholes) != -1 && form.wormholeType.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t\tparent = \"initial\";\r\n\t\t\t\t\t\t\ttype = form.wormholeType.toUpperCase();\r\n\t\t\t\t\t\t} else if (form.wormholeType2.length > 0 && $.inArray(form.wormholeType2.toUpperCase(), aSigWormholes) != -1 && form.wormholeType2.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t\tparent = \"secondary\";\r\n\t\t\t\t\t\t\ttype = form.wormholeType2.toUpperCase();\r\n\t\t\t\t\t\t} else if (form.wormholeType.toUpperCase() == \"K162\") {\r\n\t\t\t\t\t\t\tparent = \"secondary\";\r\n\t\t\t\t\t\t\ttype = \"????\";\r\n\t\t\t\t\t\t} else if (form.wormholeType2.toUpperCase() == \"K162\") {\r\n\t\t\t\t\t\t\tparent = \"initial\";\r\n\t\t\t\t\t\t\ttype = \"????\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar wormhole = {\r\n\t\t\t\t\t\t\t\"type\": type,\r\n\t\t\t\t\t\t\t\"parent\": parent,\r\n\t\t\t\t\t\t\t\"life\": form.wormholeLife,\r\n\t\t\t\t\t\t\t\"mass\": form.wormholeMass\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tif (mode == \"update\") {\r\n\t\t\t\t\t\t\tsignature.id = $(\"#dialog-signature\").data(\"signatureid\");\r\n\t\t\t\t\t\t\tsignature2.id = $(\"#dialog-signature\").data(\"signature2id\");\r\n\t\t\t\t\t\t\twormhole.id = $(\"#dialog-signature\").data(\"wormholeid\");\r\n\r\n\t\t\t\t\t\t\t// Update the initial and type based on which side of the wormhole we are editing\r\n\t\t\t\t\t\t\tif (tripwire.client.wormholes[wormhole.id]) {\r\n\t\t\t\t\t\t\t\tif (form.wormholeType.length > 0 && $.inArray(form.wormholeType.toUpperCase(), aSigWormholes) != -1 && form.wormholeType.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t\t\t\twormhole.parent = tripwire.client.wormholes[wormhole.id].initialID == signature.id ? \"initial\" : \"secondary\";\r\n\t\t\t\t\t\t\t\t\twormhole.type = form.wormholeType.toUpperCase();\r\n\t\t\t\t\t\t\t\t} else if (form.wormholeType2.length > 0 && $.inArray(form.wormholeType2.toUpperCase(), aSigWormholes) != -1 && form.wormholeType2.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t\t\t\twormhole.parent = tripwire.client.wormholes[wormhole.id].initialID == signature.id ? \"secondary\" : \"initial\";\r\n\t\t\t\t\t\t\t\t\twormhole.type = form.wormholeType2.toUpperCase();\r\n\t\t\t\t\t\t\t\t} else if (form.wormholeType.toUpperCase() == \"K162\") {\r\n\t\t\t\t\t\t\t\t\twormhole.parent = tripwire.client.wormholes[wormhole.id].initialID == signature.id ? \"secondary\" : \"initial\";\r\n\t\t\t\t\t\t\t\t\twormhole.type = \"????\";\r\n\t\t\t\t\t\t\t\t} else if (form.wormholeType2.toUpperCase() == \"K162\") {\r\n\t\t\t\t\t\t\t\t\twormhole.parent = tripwire.client.wormholes[wormhole.id].initialID == signature.id ? \"initial\" : \"secondary\";\r\n\t\t\t\t\t\t\t\t\twormhole.type = \"????\";\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"update\": [{\"wormhole\": wormhole, \"signatures\": [signature, signature2]}]}};\r\n\r\n\t\t\t\t\t\t\tif (tripwire.client.wormholes[wormhole.id]) {\r\n\t\t\t\t\t\t\t\t\t//used to be a wormhole\r\n\t\t\t\t\t\t\t\t\tundo.push({\"wormhole\": tripwire.client.wormholes[wormhole.id], \"signatures\": [tripwire.client.signatures[signature.id], tripwire.client.signatures[signature2.id]]});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t// used to be just a regular signature\r\n\t\t\t\t\t\t\t\t\tundo.push(tripwire.client.signatures[signature.id]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"add\": [{\"wormhole\": wormhole, \"signatures\": [signature, signature2]}]}};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (mode == \"update\") {\r\n\t\t\t\t\t\t\tvar signature = {\r\n\t\t\t\t\t\t\t\t\"id\": $(\"#dialog-signature\").data(\"signatureid\"),\r\n\t\t\t\t\t\t\t\t\"signatureID\": form.signatureID_Alpha + form.signatureID_Numeric,\r\n\t\t\t\t\t\t\t\t\"systemID\": viewingSystemID,\r\n\t\t\t\t\t\t\t\t\"type\": form.signatureType,\r\n\t\t\t\t\t\t\t\t\"name\": form.signatureName,\r\n\t\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"update\": [signature]}};\r\n\r\n\t\t\t\t\t\t\tif (tripwire.client.signatures[signature.id].type == \"wormhole\") {\r\n\t\t\t\t\t\t\t\t//used to be a wormhole\r\n\t\t\t\t\t\t\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n\t\t\t\t\t\t\t\tvar signature2 = signature.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t\t\t\t\tundo.push({\"wormhole\": tripwire.client.wormholes[wormhole.id], \"signatures\": [tripwire.client.signatures[signature.id], tripwire.client.signatures[signature2.id]]});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t// used to be just a regular signature\r\n\t\t\t\t\t\t\t\tundo.push(tripwire.client.signatures[signature.id]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar signature = {\r\n\t\t\t\t\t\t\t\t\"signatureID\": form.signatureID_Alpha + form.signatureID_Numeric,\r\n\t\t\t\t\t\t\t\t\"systemID\": viewingSystemID,\r\n\t\t\t\t\t\t\t\t\"type\": form.signatureType,\r\n\t\t\t\t\t\t\t\t\"name\": form.signatureName,\r\n\t\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"add\": [signature]}};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\":button:contains('Save')\").button(\"disable\");\r\n\r\n\t\t\t\t\tvar success = function(data) {\r\n\t\t\t\t\t\tif (data.resultSet && data.resultSet[0].result == true) {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t$(\"#undo\").removeClass(\"disabled\");\r\n\r\n\t\t\t\t\t\t\tif (mode == \"add\") {\r\n\t\t\t\t\t\t\t\tundo = data.results;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (viewingSystemID in tripwire.signatures.undo) {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[viewingSystemID].push({action: mode, signatures: undo});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[viewingSystemID] = [{action: mode, signatures: undo}];\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tsessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar always = function() {\r\n\t\t\t\t\t\t$(\"#sigEditForm input[type=submit]\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t$(\"#dialog-signature\").parent().find(\":button:contains('Save')\").button(\"enable\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttripwire.refresh('refresh', payload, success, always);\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$(\"#dialog-signature\").data(\"signatureid\", \"\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"signature2id\", \"\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"wormholeid\", \"\");\r\n\r\n\t\t\t\t$(\"#dialog-signature input\").val(\"\");\r\n\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(\"unknown\").selectmenu(\"refresh\");\r\n\r\n\t\t\t\t$(\"#dialog-signature [name='wormholeLife']\").val(\"stable\").selectmenu(\"refresh\");\r\n\t\t\t\t$(\"#dialog-signature [name='wormholeMass']\").val(\"stable\").selectmenu(\"refresh\");\r\n\r\n\t\t\t\t$(\"#dialog-signature #site\").show();\r\n\t\t\t\t$(\"#dialog-signature #wormhole\").hide();\r\n\r\n\t\t\t\t// Side labels\r\n\t\t\t\t$(\"#dialog-signature .sideLabel:first\").html(viewingSystem + \" Side\");\r\n\t\t\t\t$(\"#dialog-signature .sideLabel:last\").html(\"Other Side\");\r\n\r\n\t\t\t\t// Default signature life\r\n\t\t\t\t$(\"#dialog-signature #durationPicker\").val(options.signatures.pasteLife * 60 * 60).change();\r\n\r\n\t\t\t\tif (mode == \"update\" && $(element).data(\"id\") && tripwire.client.signatures[$(element).data(\"id\")]) {\r\n\t\t\t\t\tvar id = $(element).data(\"id\");\r\n\t\t\t\t\tvar signature = tripwire.client.signatures[id];\r\n\t\t\t\t\t$(\"#dialog-signature\").data(\"signatureid\", id);\r\n\r\n\t\t\t\t\t// Change the dialog buttons\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Add')\").hide();\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Save')\").show();\r\n\r\n\t\t\t\t\t// Change the dialog title\r\n\t\t\t\t\t$(\"#dialog-signature\").dialog(\"option\", \"title\", \"Edit Signature\");\r\n\r\n\t\t\t\t\tif (signature.type == \"wormhole\") {\r\n\t\t\t\t\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == id || wormhole.secondaryID == id) return wormhole; })[0];\r\n\t\t\t\t\t\tvar otherSignature = id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t\t\t$(\"#dialog-signature\").data(\"signature2id\", otherSignature.id);\r\n\t\t\t\t\t\t$(\"#dialog-signature\").data(\"wormholeid\", wormhole.id);\r\n\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Alpha']\").val(signature.signatureID ? signature.signatureID.substr(0, 3) : \"???\");\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Numeric']\").val(signature.signatureID ? signature.signatureID.substr(3, 5) : \"\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(signature.type).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeName']\").val(signature.name);\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='leadsTo']\").val(tripwire.systems[otherSignature.systemID] ? tripwire.systems[otherSignature.systemID].name : (tripwire.aSigSystems[otherSignature.systemID] ? tripwire.aSigSystems[otherSignature.systemID] : \"\"));\r\n\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID2_Alpha']\").val(otherSignature.signatureID ? otherSignature.signatureID.substr(0, 3) : \"???\");\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID2_Numeric']\").val(otherSignature.signatureID ? otherSignature.signatureID.substr(3, 5) : \"\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeName2']\").val(otherSignature.name);\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeLife']\").val(wormhole.life).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeMass']\").val(wormhole.mass).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\r\n\t\t\t\t\t\tif (wormhole[wormhole.parent+\"ID\"] == signature.id) {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature input[name='wormholeType']\").val(wormhole.type).change();\r\n\t\t\t\t\t\t} else if (wormhole[wormhole.parent+\"ID\"] == otherSignature.id) {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature input[name='wormholeType2']\").val(wormhole.type).change();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$(\"#dialog-signature #durationPicker\").val(signature.lifeLength).change();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Alpha']\").val(signature.signatureID ? signature.signatureID.substr(0, 3) : \"???\");\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Numeric']\").val(signature.signatureID ? signature.signatureID.substr(3, 5) : \"\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(signature.type).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureName']\").val(signature.name);\r\n\t\t\t\t\t\t$(\"#dialog-signature #durationPicker\").val(signature.lifeLength).change();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Heightlight first ID section\r\n\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Alpha']\").select();\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Change the dialog buttons\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Add')\").show();\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Save')\").hide();\r\n\r\n\t\t\t\t\t// Change the dialog title\r\n\t\t\t\t\t$(\"#dialog-signature\").dialog(\"option\", \"title\", \"Add Signature\");\r\n\r\n\t\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(options.signatures.editType || \"unknown\").selectmenu(\"refresh\")\r\n\t\t\t\t\tif ($(\"#dialog-signature [name='signatureType']\").val() === \"wormhole\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature #site\").hide();\r\n\t\t\t\t\t\t$(\"#dialog-signature #wormhole\").show();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tValidationTooltips.close();\r\n\t\t\t\t$(\"#sigTable tr.selected\").removeClass(\"selected\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"signatureid\", \"\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"signature2id\", \"\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"wormholeid\", \"\");\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-signature\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-signature\").dialog(\"open\");\r\n\t}\r\n};\r\n"]}