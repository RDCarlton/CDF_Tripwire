Object.sort=function(e,r){var t,i;do{for(var o in t=!1,i=null,e){if(i&&Number(e[o][r])<Number(e[i][r])){var s=e[o];e[o]=e[i],e[i]=s,t=!0}i=o}}while(t)},Object.index=function(e,r,t,i){for(var o in e){if(!i&&e[o][r]==t)return o;if(e[o][r]&&e[o][r].toLowerCase()==t.toLowerCase())return o}},Object.find=function(e,r,t,i){for(var o in e){if(!i&&e[o][r]==t)return e[o];if(e[o][r]&&e[o][r].toLowerCase()==t.toLowerCase())return e[o]}return!1},Object.maxTime=function(e,r){var t,i="";for(var o in e)(!t||t<new Date(e[o][r]))&&(t=new Date(e[o][r]),i=e[o][r]);return i},Object.size=function(e){var r,t=0;for(r in e)e.hasOwnProperty(r)&&t++;return t},Object.time=function(e){var r,t=[];for(r in e)t.push(new Date(e[r].time));return t.length?t.sort()[t.length-1].getTime()/1e3:0},function(e){e.fn.serializeObject=function(){var r=this,t={},i={},o={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,key:/[a-zA-Z0-9_]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9_]+$/};return this.build=function(e,r,t){return e[r]=t,e},this.push_counter=function(e){return void 0===i[e]&&(i[e]=0),i[e]++},e.each(e(this).serializeArray(),function(){if(o.validate.test(this.name)){for(var i,s=this.name.match(o.key),n=this.value,a=this.name;void 0!==(i=s.pop());)a=a.replace(new RegExp("\\["+i+"\\]$"),""),i.match(o.push)?n=r.build([],r.push_counter(a),n):i.match(o.fixed)?n=r.build([],i,n):i.match(o.named)&&(n=r.build({},i,n));t=e.extend(!0,t,n)}}),t}}(jQuery);var numFormat=function(e){var r=e.toString().split(".");return r[0]=r[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),r.join(".")},letterToNumbers=function(e){e=e.toUpperCase();var r,t="ABCDEFGHIJKLMNOPQRSTUVWXYZ",i=0;for(r=0;r<e.length;r++)i+=Math.pow(t.length,r)*(t.indexOf(e.substr(-1*(r+1),1))+1);return i},sigFormat=function(e,r){if(!e)return"";for(var t=/^[a-zA-Z]+$/,i=/^[0-9]+$/,o="type"==r?options.chain.typeFormat||"":options.chain.classFormat||"",s=0,n=o.length;s<n;s++)if(o[s].match(t)){if("B"==o[s].toUpperCase()&&"a"==e)return"";o=o[s]==o[s].toUpperCase()?o.substr(0,s)+e.toUpperCase()+o.substr(s+1,n):o.substr(0,s)+e+o.substr(s+1,n)}else if(o[s].match(i)){if(2==o[s]&&"a"==e)return"";o=o.substr(0,s)+letterToNumbers(e)+o.substr(s+1,n)}return o},sigClass=function(e,r){var t=$.map(tripwire.systems,function(r,t){return r.name==e?t:null})[0],i=e,o=t?tripwire.systems[t].class:null,s=t?tripwire.systems[t].security:null,n=r,a=null;return 6==o||"Class-6"==i||void 0!==tripwire.wormholes[n]&&"Class 6"==tripwire.wormholes[n].leadsTo?a="C6":5==o||"Class-5"==i||void 0!==tripwire.wormholes[n]&&"Class 5"==tripwire.wormholes[n].leadsTo?a="C5":4==o||"Class-4"==i||void 0!==tripwire.wormholes[n]&&"Class 4"==tripwire.wormholes[n].leadsTo?a="C4":3==o||"Class-3"==i||void 0!==tripwire.wormholes[n]&&"Class 3"==tripwire.wormholes[n].leadsTo?a="C3":2==o||"Class-2"==i||void 0!==tripwire.wormholes[n]&&"Class 2"==tripwire.wormholes[n].leadsTo?a="C2":1==o||"Class-1"==i||void 0!==tripwire.wormholes[n]&&"Class 1"==tripwire.wormholes[n].leadsTo?a="C1":s>=.45||"High-Sec"==i||void 0!==tripwire.wormholes[n]&&"High-Sec"==tripwire.wormholes[n].leadsTo&&!s?a="HS":s>0||"Low-Sec"==i||void 0!==tripwire.wormholes[n]&&"Low-Sec"==tripwire.wormholes[n].leadsTo&&!s?a="LS":(s<=0&&null!=s||"Null-Sec"==i||void 0!==tripwire.wormholes[n]&&"Null-Sec"==tripwire.wormholes[n].leadsTo)&&(a="NS"),a},isEmpty=function(e){for(var r in e)if(e.hasOwnProperty(r))return!1;return!0},getCookie=function(e){var r=document.cookie,t=r.indexOf(" "+e+"=");if(-1==t&&(t=r.indexOf(e+"=")),-1==t)r=null;else{t=r.indexOf("=",t)+1;var i=r.indexOf(";",t);-1==i&&(i=r.length),r=unescape(r.substring(t,i))}return r},setCookie=function(e,r,t){var i=new Date;i.setDate(i.getDate()+t);var o=escape(r)+(null==t?"":"; expires="+i.toUTCString());document.cookie=e+"="+o+";"+("https:"==document.location.protocol?"secure;":"")};
var viewingSystem=$("meta[name=system]").attr("content"),viewingSystemID=$("meta[name=systemID]").attr("content"),server=$("meta[name=server]").attr("content"),app_name=$("meta[name=app_name]").attr("content"),version=$("meta[name=version]").attr("content");"true"==getCookie("loadedFromBrowserCache")&&$("#pageTime").html("Page is Cached");
var options=new function(){var t=["grid"],i=JSON.parse(localStorage.getItem("tripwire_options"));this.userID=init.userID,this.character={id:init.characterID,name:init.characterName},this.background=null,this.uiscale=1,this.favorites=[],this.grid={},this.tracking={active:"new"},this.masks={active:init.corporationID+".2"},this.chain={typeFormat:null,classFormat:null,gridlines:!0,active:0,tabs:[],"node-reference":"type"},this.signatures={pasteLife:72,alignment:{sigID:"centerAlign",sigType:"centerAlign",sigAge:"centerAlign",leadsTo:"centerAlign",sigLife:"centerAlign",sigMass:"centerAlign"}},this.buttons={follow:!1,chainWidget:{viewing:!1,favorites:!1},signaturesWidget:{autoMapper:!1}},this.save=function(){var t=JSON.stringify(this.get());return localStorage.setItem("tripwire_options",t),$.ajax({url:"options.php",data:{mode:"set",options:t},type:"POST",dataType:"JSON"})},this.load=function(t){t&&void 0!==t?this.set(this,t):i&&this.set(this,i),this.apply()},this.get=function(){var t={};for(var i in this)"function"!=typeof this[i]&&(t[i]=this[i]);return t},this.set=function(t,i){for(var s in i)i[s]&&i[s].constructor&&i[s].constructor===Object?t&&this.set(t[s],i[s]):t&&void 0!==t[s]&&(t[s]=i[s])},this.reset=function(){for(var t in this)"function"!=typeof this[t]&&(this[t]=JSON.parse(JSON.stringify(this.reset.defaults[t])))},this.apply=function(){if(i)for(key in t)this[t[key]]=i[t[key]];if(this.grid.hasOwnProperty("oog")&&!isEmpty(this.grid.oog)?$.each(this.grid.oog,function(){$("#"+this.id).attr({"data-col":this.col,"data-row":this.row,"data-sizex":this.size_x,"data-sizey":this.size_y}).css({width:this.width,height:this.height})}):isEmpty(this.grid)||$.each(this.grid,function(){$("#"+this.id).attr({"data-col":this.col,"data-row":this.row,"data-sizex":this.size_x,"data-sizey":this.size_y}).css({width:this.width,height:this.height})}),this.favorites=$.map(this.favorites,function(t){return parseInt(t)}),this.buttons.follow&&$("#follow").addClass("active"),this.buttons.chainWidget.home&&$("#home").addClass("active"),this.buttons.chainWidget.kspace&&$("#k-space").addClass("active"),this.buttons.chainWidget.viewing&&$("#show-viewing").addClass("active"),this.buttons.chainWidget.favorites&&$("#show-favorite").addClass("active"),this.buttons.chainWidget.evescout&&$("#eve-scout").addClass("active"),-1!==$.inArray(parseInt(viewingSystemID),this.favorites)&&$("#system-favorite").attr("data-icon","star").addClass("active"),this.buttons.signaturesWidget.autoMapper&&$("#toggle-automapper").addClass("active"),this.uiscale&&$("body").css("zoom",this.uiscale),this.background){var s=$("<a>",{href:this.background})[0];$("#wrapper").attr("style","background-image: url(https://"+s.hostname+s.pathname+s.search+");")}else $("#wrapper").attr("style","");for(var a in $("#dialog-options #characters").html("<img src='https://image.eveonline.com/Character/"+init.characterID+"_64.jpg' />"),$("#dialog-options input[name='mask']").filter("[value='"+this.masks.active+"']").attr("checked",!0),$("#chainTabs").html(""),this.chain.tabs)if(this.chain.tabs[a]){var e=$("#chainTab .tab").clone();e.attr("id",a).find(".name").data("tab",this.chain.tabs[a].systemID).html(this.chain.tabs[a].name),a==this.chain.active&&e.addClass("current"),$("#chainTabs").append(e)}"undefined"!=typeof tripwire&&chain.redraw()},this.reset.defaults=JSON.parse(JSON.stringify(this.get())),this.load(init&&init.options?init.options:null)};
var grid=$(".gridster ul").gridster({widget_selector:"li.gridWidget",avoid_overlapped_widgets:!1,widget_base_dimensions:[50,50],widget_margins:[5,5],autogrow_cols:!0,helper:"clone",draggable:{start:function(i,e){$("div.gridster").width($("div.gridster ul").width())}},resize:{enabled:!0,handle_class:"grid-resize",max_size:[30,30],min_size:[4,4],start:function(i){$("div.gridster").width($("div.gridster ul").width())},stop:function(i,e,s){switch(s.attr("id")){case"infoWidget":setTimeout("activity.redraw();",300)}}},serialize_params:function(i,e){return{id:i.attr("id"),col:e.col,row:e.row,size_x:e.size_x,size_y:e.size_y,width:i.width(),height:i.height()}}}).data("gridster").disable();grid.disable_resize(),$(".grid-resize").addClass("hidden").attr("data-icon","resize"),$(".gridster").css({visibility:"visible"}),$(".gridster > *").addClass("gridster-transition"),$("#layout").click(function(){$(this).hasClass("active")?(grid.disable(),grid.disable_resize(),$(".grid-resize").addClass("hidden"),$(this).removeClass("active"),options.grid=grid.serialize(),options.save()):(grid.enable(),grid.enable_resize(),$(".grid-resize").removeClass("hidden"),$(this).addClass("active"))});
var tripwire=new function(){this.timer,this.xhr,this.version=version,this.client={signatures:{},wormholes:{}},this.server={signatures:{},wormholes:{}},this.signatures={list:{},undo:JSON.parse(sessionStorage.getItem("tripwire_undo"))||{},redo:JSON.parse(sessionStorage.getItem("tripwire_redo"))||{}},this.activity={},this.data={tracking:{},esi:{}},this.refreshRate=5e3,this.connected=!0,this.ageFormat="HM",this.instance=window.name?window.name:((new Date).getTime(),window.name=(new Date).getTime()/1e3),this.stop=function(){return clearTimeout(this.timer),this.timer},this.start=function(){return this.sync()},this.setAgeFormat=function(e){e=void 0!==e?e:this.ageFormat;return $("span[data-age]").each(function(){$(this).countdown("option",{format:e})}),!0},this.serverTime=function(){this.time,this.serverTime.getTime=function(){return tripwire.serverTime.time}},this.serverTime(),this.chainMap=function(){this.chainMap.parse=function(e){chain.draw(e)}},this.chainMap(),this.pastEOL=function(){var e={since:$(this).countdown("option","until"),format:"HM",layout:"-{hnn}{sep}{mnn}&nbsp;"};$(this).countdown("option",e)},this.whTooltip=function(e){if(viewingSystemID==e.systemID)if($.inArray(e.type,$.map(tripwire.wormholes,function(e,t){return t}))>=0)var t=e.type,i="";else i="<b>Type:</b> "+(t=e.sig2Type)+"<br/>";else if($.inArray(e.sig2Type,$.map(tripwire.wormholes,function(e,t){return t}))>=0)t=e.sig2Type,i="";else i="<b>Type:</b> "+(t=e.type)+"<br/>";if($.inArray(t,$.map(tripwire.wormholes,function(e,t){return t}))>=0)var s=!0;else s=!1;if(i+="<b>Life:</b> "+(s?tripwire.wormholes[t].life:"Unknown")+"<br/>",s)switch(tripwire.wormholes[t].leadsTo.split(" ")[0]){case"High-Sec":i+="<b>Leads To:</b> <span class='hisec'>"+tripwire.wormholes[t].leadsTo+"</span><br/>";break;case"Low-Sec":i+="<b>Leads To:</b> <span class='lowsec'>"+tripwire.wormholes[t].leadsTo+"</span><br/>";break;case"Null-Sec":i+="<b>Leads To:</b> <span class='nullsec'>"+tripwire.wormholes[t].leadsTo+"</span><br/>";break;case"Class":i+="<b>Leads To:</b> <span class='wh'>"+tripwire.wormholes[t].leadsTo+"</span><br/>";break;default:i+="<b>Leads To:</b> <span>"+tripwire.wormholes[t].leadsTo+"</span><br/>"}else i+="<b>Leads To:</b> <span>Unknown</span><br/>";return i+="<b>Max Mass</b>: "+(s?numFormat(tripwire.wormholes[t].mass):"Unknown")+" Kg<br/>",i+="<b>Max Jumpable</b>: "+(s?numFormat(tripwire.wormholes[t].jump):"Unknown")+" Kg<br/>"},this.ageTooltip=function(e){var t=new Date(e.lifeTime),i='<table class="age-tooltip-table"><tr><th>Created:</th><td>'+(t.getMonth()+1)+"/"+t.getDate()+" "+(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+"</td><td>"+e.createdByName+"</td></tr>";return e.lifeTime!=e.modifiedTime&&(i+="<tr><th>Last Modified:</th><td>"+((t=new Date(e.modifiedTime)).getMonth()+1)+"/"+t.getDate()+" "+(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+"</td><td>"+e.modifiedByName+"</td></tr>"),i+="</table>"},this.refresh=function(e,t,i,s){e=e||"refresh";this.sync(e,t,i,s)}};
$("body").on("click","a[href^='.?system=']",function(e){e.preventDefault();var t=$(this).attr("href").replace(".?system=",""),a=Object.index(tripwire.systems,"name",t);tripwire.systemChange(a)}),$("body").on("submit","#systemSearch",function(e){e.preventDefault();var t=$(this).find("[name='system']").val(),a=Object.index(tripwire.systems,"name",t,!0)||!1;!1!==a&&(tripwire.systemChange(a),$(this).find("[name='system']").val(""),$("#search").click())}),$("body").on("click","#undo:not(.disabled)",function(){tripwire.undo()}),$("body").on("click","#redo:not(.disabled)",function(){tripwire.redo()}),$(document).keydown(function(e){$(document.activeElement).is("textarea, input")||(!e.metaKey&&!e.ctrlKey||89!=e.keyCode&&90!=e.keyCode?46==e.keyCode&&$("#sigTable tr.selected").length>0&&$("#delete-signature").click():(e.preventDefault(),89!=e.keyCode||$("#redo").hasClass("disabled")?90!=e.keyCode||$("#undo").hasClass("disabled")||($("#undo").click(),Notify.trigger("Undoing last action")):($("#redo").click(),Notify.trigger("Redoing last undo"))))}),$("#follow").click(function(e){e.preventDefault(),$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),options.buttons.follow=$(this).hasClass("active"),options.save()}),$("#show-viewing").click(function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),chain.redraw(),options.buttons.chainWidget.viewing=$(this).hasClass("active"),options.save()}),$("#show-favorite").click(function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),chain.redraw(),options.buttons.chainWidget.favorites=$(this).hasClass("active"),options.save()}),$("#system-favorite").click(function(){$(this).hasClass("active")?($(this).removeClass("active").attr("data-icon","star-empty"),options.favorites.splice(options.favorites.indexOf(parseInt(viewingSystemID)),1)):($(this).attr("data-icon","star").addClass("active"),options.favorites.push(parseInt(viewingSystemID))),$("#show-favorite").hasClass("active")&&chain.redraw(),options.save()}),$("#search").click(function(e){$("#searchSpan").toggle(),$(this).hasClass("active")?($(this).removeClass("active"),tripwire.client.EVE&&tripwire.client.EVE.systemName&&$("#currentSpan").show()):($(this).addClass("active"),$("#currentSpan").hide(),$("#searchSpan input[name=system]").focus().select())}),$("#toggle-automapper").click(function(e){e.preventDefault(),$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),options.buttons.signaturesWidget.autoMapper=$(this).hasClass("active"),options.save()}),$("#track").on("click",".tracking-clone",function(){var e=$(this).attr("data-characterid");$("#tracking .tracking-clone").removeClass("active"),options.tracking.active==e?(options.tracking.active=null,tripwire.EVE(!1,!0),$("#removeESI").attr("disabled","disabled")):(options.tracking.active=e,tripwire.esi.characters[options.tracking.active]&&($("#tracking .tracking-clone[data-characterid='"+options.tracking.active+"']").addClass("active"),tripwire.EVE(tripwire.esi.characters[options.tracking.active],!0)),$("#removeESI").removeAttr("disabled")),options.save()}),$("#login").on("click","#removeESI",function(){var e=options.tracking.active;options.tracking.active=null,tripwire.EVE(!1,!0),options.save(),$("#tracking .tracking-clone[data-characterid='"+e+"']").remove(),$("#removeESI").attr("disabled","disabled"),tripwire.data.esi.delete=e}),$("#user").click(function(e){e.preventDefault(),$(this).hasClass("active")?($(this).removeClass("active"),$("#login > #panel").css({display:"none"})):($(this).addClass("active"),$("#login > #panel").css({display:"inline"}),$("#loginForm input[name=username]").focus().select(),$("#wrapper").click(function(e){$("#login > #panel").css({display:"none"}),$("#user").removeClass("active")}),$("#login").click(function(e){e.stopPropagation()}))}),$("#logout").click(function(){window.location="logout.php"});var Notify=new function(){this.trigger=function(e,t,a,i){t=void 0!==t?t:"blue",a=void 0!==a?a:1e4,i=void 0!==i?i:null;new jBox("Notice",{id:i,content:e,offset:{y:35},animation:"flip",color:t,autoClose:a})}},ValidationTooltips=new jBox("Tooltip",{trigger:null,addClass:"validation-tooltip",animation:"flip",fade:0}),Tooltips=new jBox("Tooltip",{attach:$("[data-tooltip]"),getContent:"data-tooltip",position:{x:"right",y:"center"},outside:"x"}),WormholeTypeToolTips=new jBox("Tooltip",{attach:$(".whEffect[data-tooltip]"),getContent:"data-tooltip",position:{x:"left",y:"center"},outside:"x"}),OccupiedToolTips=new jBox("Tooltip",{pointer:"top:-3",position:{x:"right",y:"center"},outside:"x",animation:"move",repositionOnOpen:!0,onOpen:function(){var e=this,t=$(this.source).closest("[data-nodeid]").data("nodeid");e.setContent("&nbsp;"),$.ajax({url:"occupants.php",dataType:"JSON",data:"systemID="+t,cache:!1}).done(function(t){var a="<table>";for(var i in t.occupants)a+="<tr><td>"+t.occupants[i].characterName+"</td><td style='padding-left: 10px;'>"+(t.occupants[i].shipTypeName?t.occupants[i].shipTypeName:"")+"</td></tr>";a+="</table>",e.setContent(a)})}});function linkSig(e){return["Average Frontier Deposit","Unexceptional Frontier Deposit","Common Perimeter Deposit","Exceptional Core Deposit","Infrequent Core Deposit","Unusual Core Deposit","Rarified Core Deposit","Isolated Core Deposit","Ordinary Permiter Deposit","Uncommon Core Deposit","Barren Perimeter Reservoir","Minor Perimeter Reservoir","Ordinary Perimeter Reservoir","Sizeable Perimeter Reservoir","Token Perimeter Reservoir","Bountiful Frontier Reservoir","Vast Frontier Reservoir","Instrumental Core Reservoir","Vital Core Reservoir","Perimeter Ambush Point","Perimeter Camp","Phase Catalyst Node","The Line","Forgotten Perimeter Coronation Platform","Forgotten Perimeter Power Array","Unsecured Perimeter Amplifier","Unsecured Perimeter Information Center","Perimeter Checkpoint","Perimeter Hangar","The Ruins of Enclave Cohort 27","Sleeper Data Sanctuary","Forgotten Perimeter Gateway","Forgotten Perimeter Habitation Coils","Unsecured Perimeter Comms Relay","Unsecured Perimeter Transponder Farm","Fortification Frontier Stronghold","Outpost Frontier Stronghold","Solar Cell","The Oruze Construct","Forgotten Frontier Quarantine Outpost","Forgotten Frontier Recursive Depot","Unsecured Frontier Database","Unsecured Frontier Receiver","Frontier Barracks","Frontier Command Post","Integrated Terminus","Sleeper Information Sanctum","Forgotten Frontier Conversion Module","Forgotten Frontier Evacuation Center","Unsecured Frontier Digital Nexus","Unsecured Frontier Trinary Hub","Core Garrison","Core Stronghold","Oruze Osobnyk","Quarantine Area","Forgotten Core Data Field","Forgotten Core Information Pen","Unsecured Frontier Enclave Relay","Unsecured Frontier Server Bank","Core Citadel","Core Bastion","Strange Energy Readings","The Mirror","Forgotten Core Assembly Hall","Forgotten Core Circuitry Disassembler","Unsecured Core Backup Array","Unsecured Core Emergence"].indexOf(e)>-1?'<a href="http://eve-survival.org/wikka.php?wakka='+e.replace(/ /g,"")+'" target="_blank" class="siteLink">'+e+"</a>":e}$("#chainTabs").sortable({items:"> .tab",axis:"x",delay:150,tolerance:"pointer",containment:"parent",update:function(e,t){var a=$("#chainTabs").sortable("toArray"),i=[];for(var s in a)i.push(options.chain.tabs[a[s]]),$("#chainTabs .tab:eq("+s+")").attr("id",s);options.chain.active=$(".tab.current").index(),options.chain.tabs=i,options.save()}}),$("#chainTabs").on("click",".tab",function(e){e.preventDefault(),$(this).hasClass("current")?($("#chainTabs .tab").removeClass("current"),options.chain.active=null):($("#chainTabs .tab").removeClass("current"),$(this).addClass("current"),options.chain.active=$(this).index()),options.save(),chain.redraw(),tripwire.parse(tripwire.client,"refresh")}),$("#chainTabs").on("click",".closeTab",function(e){e.stopPropagation();var t=$(this).closest(".tab");$("#dialog-confirm #msg").html("This tab will be removed, are you sure?"),$("#dialog-confirm").dialog("option",{buttons:{"Remove Tab":function(){var e=t.index();options.chain.active=$(".tab.current").index(),options.chain.tabs.splice(e,1),options.save(),t.remove(),0==$("#chainTabs .tab.current").length&&$("#chainTabs .tab:last").click();for(var a=0,i=$("#chainTabs .tab").length;a<i;a++)$("#chainTabs .tab:eq("+a+")").attr("id",a);$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}).dialog("open")}),$("#newTab").on("click",function(){$("#dialog-newTab").hasClass("ui-dialog-content")?$("#dialog-newTab").dialog("isOpen")||$("#dialog-newTab").dialog("open"):$("#dialog-newTab").dialog({resizable:!1,minHeight:0,dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{OK:function(){$("#newTab_form").submit()},Cancel:function(){$(this).dialog("close")}},open:function(){$("#dialog-newTab .name").val(viewingSystem).focus(),$("#dialog-newTab .sigSystemsAutocomplete").val(viewingSystem)},close:function(){ValidationTooltips.close()},create:function(){$("#dialog-newTab .sigSystemsAutocomplete").inlinecomplete({source:tripwire.aSigSystems,maxSize:10,delay:0}),$("#newTab_form").submit(function(e){e.preventDefault();var t=$("#chainTab .tab").clone(),a=$("#dialog-newTab .name").val(),i=Object.index(tripwire.systems,"name",$("#dialog-newTab .sigSystemsAutocomplete").val()),s=!!$("#tabThera")[0].checked;return a?!i&&$("#tabType1")[0].checked?(ValidationTooltips.open({target:$("#dialog-newTab .sigSystemsAutocomplete")}).setContent("Must have a valid system!"),!1):($("#tabType2")[0].checked&&(i=0),t.attr("id",$("#chainTabs .tab").length).find(".name").data("tab",i).html(a),options.chain.tabs.push({systemID:i,name:a,evescout:s}),options.save(),$("#chainTabs").append(t),void $("#dialog-newTab").dialog("close")):(ValidationTooltips.open({target:$("#dialog-newTab .name")}).setContent("Must have a name!"),!1)}),$("#dialog-newTab .sigSystemsAutocomplete").click(function(e){$("#dialog-newTab #tabType1").click()})}})}),$("#chainTabs").on("click",".editTab",function(e){e.stopPropagation(),$("#dialog-editTab").hasClass("ui-dialog-content")?$("#dialog-editTab").dialog("isOpen")||$("#dialog-editTab").dialog("open"):$("#dialog-editTab").dialog({resizable:!1,minHeight:0,dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{OK:function(){$("#editTab_form").submit()},Cancel:function(){$(this).dialog("close")}},open:function(){$("#dialog-editTab .name").val(options.chain.tabs[options.chain.active].name).focus(),$("#dialog-editTab .sigSystemsAutocomplete").val(options.chain.tabs[options.chain.active].systemID>0?tripwire.systems[options.chain.tabs[options.chain.active].systemID].name:""),options.chain.tabs[options.chain.active].systemID>0?$("#dialog-editTab #editTabType1")[0].checked=!0:$("#dialog-editTab #editTabType2")[0].checked=!0,$("#dialog-editTab #editTabThera")[0].checked=options.chain.tabs[options.chain.active].evescout},close:function(){ValidationTooltips.close()},create:function(){$("#dialog-editTab .sigSystemsAutocomplete").inlinecomplete({source:tripwire.aSigSystems,maxSize:10,delay:0}),$("#editTab_form").submit(function(e){e.preventDefault();var t=$("#chainTabs .tab").eq([options.chain.active]),a=$("#dialog-editTab .name").val(),i=Object.index(tripwire.systems,"name",$("#dialog-editTab .sigSystemsAutocomplete").val()),s=!!$("#editTabThera")[0].checked;return a?!i&&$("#editTabType1")[0].checked?(ValidationTooltips.open({target:$("#dialog-editTab .sigSystemsAutocomplete")}).setContent("Must have a valid system!"),!1):($("#editTabType2")[0].checked&&(i=0),t.attr("id",$("#chainTabs .tab").length).find(".name").data("tab",i).html(a),options.chain.tabs[options.chain.active]={systemID:i,name:a,evescout:s},options.save(),chain.redraw(),tripwire.parse(tripwire.client,"refresh"),void $("#dialog-editTab").dialog("close")):(ValidationTooltips.open({target:$("#dialog-editTab .name")}).setContent("Must have a name!"),!1)}),$("#dialog-editTab .sigSystemsAutocomplete").click(function(e){$("#dialog-editTab #editTabType1").click()})}})}),$("#signaturesWidget #sigTable thead").contextmenu({delegate:"th.sortable",menu:"#signatureColumnMenu",position:function(e,t){return{my:"left top",at:"center",of:t.target}},select:function(e,t){var a=$(t.target).parent().parent().children().index($(t.target).parent())+1;switch(a){case 1:colName="sigID";break;case 2:colName="sigType";break;case 3:colName="sigAge";break;case 4:colName="leadsTo";break;case 5:colName="sigLife";break;case 6:colName="sigMass"}switch(t.cmd){case"leftAlign":$("#signaturesWidget #sigTable tbody td:nth-child("+a+")").removeClass("centerAlign rightAlign").addClass("leftAlign"),options.signatures.alignment[colName]="leftAlign";break;case"centerAlign":$("#signaturesWidget #sigTable tbody td:nth-child("+a+")").removeClass("leftAlign rightAlign").addClass("centerAlign"),options.signatures.alignment[colName]="centerAlign";break;case"rightAlign":$("#signaturesWidget #sigTable tbody td:nth-child("+a+")").removeClass("centerAlign leftAlign").addClass("rightAlign"),options.signatures.alignment[colName]="rightAlign"}options.save()},beforeOpen:function(e,t){switch($(t.target).parent().parent().children().index($(t.target).parent())+1){case 1:colName="sigID";break;case 2:colName="sigType";break;case 3:colName="sigAge";break;case 4:colName="leadsTo";break;case 5:colName="sigLife";break;case 6:colName="sigMass"}$(this).contextmenu("enableEntry","leftAlign",!0),$(this).contextmenu("enableEntry","centerAlign",!0),$(this).contextmenu("enableEntry","rightAlign",!0),$(this).contextmenu("enableEntry",options.signatures.alignment[colName],!1)}}),$("#chainMap").contextmenu({delegate:".node a",position:function(e,t){return{my:"left top-1",at:"right top",of:t.target}},menu:"#chainMenu",show:{effect:"slideDown",duration:150},select:function(e,t){var a=$(t.target[0]).closest("[data-nodeid]").data("nodeid"),i=$(t.target[0]).closest("[data-nodeid]").attr("id").replace("node","")-1;switch(t.cmd){case"showInfo":tripwire.esi.showInfo(a,options.tracking.active);break;case"setDest":tripwire.esi.setDestination(a,options.tracking.active);break;case"addWay":tripwire.esi.setDestination(a,options.tracking.active,!1);break;case"showMap":break;case"red":$(t.target[0]).closest("td").hasClass("redNode")?$(this).contextmenu("removeFlare",a,t):$(this).contextmenu("setFlare",a,t.cmd,t);break;case"yellow":$(t.target[0]).closest("td").hasClass("yellowNode")?$(this).contextmenu("removeFlare",a,t):$(this).contextmenu("setFlare",a,t.cmd,t);break;case"green":$(t.target[0]).closest("td").hasClass("greenNode")?$(this).contextmenu("removeFlare",a,t):$(this).contextmenu("setFlare",a,t.cmd,t);break;case"mass":$("#dialog-mass").data("id",$(t.target[0]).closest("[data-nodeid]").data("sigid")).data("systemID",$(t.target[0]).closest("[data-nodeid]").data("nodeid")).dialog("open");break;case"collapse":var s=!options.chain.tabs[options.chain.active]||-1==$.inArray(a,options.chain.tabs[options.chain.active].collapsed);chain.map.collapse(i,s)}},beforeOpen:function(e,t){var a=$(t.target[0]).closest("[data-nodeid]").data("sigid")||null,i=$(t.target[0]).closest("[data-nodeid]").data("nodeid");tripwire.systems[i].class||!tripwire.esi.characters[options.tracking.active]?($(this).contextmenu("enableEntry","setDest",!1),$(this).contextmenu("enableEntry","addWay",!1),$(this).contextmenu("enableEntry","showMap",!1)):($(this).contextmenu("enableEntry","setDest",!0),$(this).contextmenu("enableEntry","addWay",!0),$(this).contextmenu("enableEntry","showMap",!1)),a?$(this).contextmenu("enableEntry","mass",!0):$(this).contextmenu("enableEntry","mass",!1)},create:function(e,t){$("#dialog-mass").dialog({autoOpen:!1,width:"auto",height:"auto",dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{Close:function(){$(this).dialog("close")}},open:function(){var e=$(this).data("id"),t=$(this).data("systemID"),a=tripwire.client.wormholes[e],i=tripwire.client.signatures[a.initialID],s=tripwire.client.signatures[a.secondaryID];$("#dialog-mass").dialog("option","title","From "+tripwire.systems[i.systemID].name+" to "+tripwire.systems[s.systemID].name),$("#dialog-mass #massTable tbody tr").remove();var o={wormholeID:a.id};$.ajax({url:"mass.php",type:"POST",data:o,dataType:"JSON"}).done(function(e){if(e&&e.mass){var a=0;for(x in e.mass)a+=parseFloat(e.mass[x].mass),$("#dialog-mass #massTable tbody").append("<tr><td>"+e.mass[x].characterName+"</td><td>"+(e.mass[x].toID==t?"In":"Out")+"</td><td>"+e.mass[x].shipType+"</td><td>"+numFormat(e.mass[x].mass)+"Kg</td><td>"+e.mass[x].time+"</td></tr>");$("#dialog-mass #massTable tbody").append("<tr><td></td><td></td><td></td><th>"+numFormat(a)+"Kg</th><td></td></tr>")}})}}),$.moogle.contextmenu.prototype.setFlare=function(e,t,a){var i={systemID:e,flare:t};$.ajax({url:"flares.php",type:"POST",data:i,dataType:"JSON"}).done(function(a){a&&a.result&&(chain.data.flares.flares.push({systemID:e,flare:t,time:null}),chain.flares(chain.data.flares))})},$.moogle.contextmenu.prototype.removeFlare=function(e,t){var a={systemID:e};$.ajax({url:"flares.php",type:"POST",data:a,dataType:"JSON"}).done(function(t){t&&t.result&&(chain.data.flares.flares.splice(Object.index(chain.data.flares.flares,"systemID",e),1),chain.flares(chain.data.flares))})}}}),$.widget("custom.inlinecomplete",$.ui.autocomplete,{_create:function(){return this.element.is("input")||this._selectInit(),this._super()},_value:function(){var e=this._superApply(arguments);return this.element.change(),e},_suggest:function(e){return this._super(e)},_initSource:function(){if(!$.isArray(this.options.source))return this._super();this.source=function(e,t){for(var a=new RegExp("^"+$.ui.autocomplete.escapeRegex(e.term),"i"),i=new Array,s=this.options.source,o=this.options.maxSize||25,n=0,r=s.length;n<r&&!(a.test(s[n])&&(i.push(s[n]),o&&i.length>o));n++);t(i)}},_close:function(e){return this.options.source=this.options.input_source?this.options.input_source:this.options.source,this._super(e)},_selectInit:function(){this.element.addClass("custom-combobox"),this.wrapper=this.element,this.element=this.wrapper.find("input:first"),this.select=this.wrapper.find("select:first").remove(),this.options.input_source=this.options.source,this.options.select_source=this.select.children("option[value!='']").map(function(){return $.trim(this.text)}).toArray(),this._createShowAllButton()},_createShowAllButton:function(){var e=this,t=!1;$("<a>").attr("tabIndex",e.element.prop("tabindex")).attr("title","").appendTo(e.wrapper).button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).removeClass("ui-corner-all").addClass("custom-combobox-toggle ui-corner-right").on("mousedown",function(){t=e.widget().is(":visible")}).on("click",function(){e.element.trigger("focus"),t||(e.options.source=e.options.select_source,e._search(""))})}}),$("#sigTable").tablesorter({sortReset:!0,widgets:["saveSort"],textExtraction:{2:function(e){return $(e).find("span").data("age")}}}),$("#sigTable tbody").on("click","tr",function(e){$(this).hasClass("selected")?$(this).removeClass("selected"):$(this).addClass("selected"),$("#signaturesWidget #delete-signature").trigger("delete:refresh")}),$("#signaturesWidget #delete-signature").on("delete:refresh",function(e){0==$("#sigTable tr.selected").length?$("#signaturesWidget #delete-signature").addClass("disabled"):$("#signaturesWidget #delete-signature").removeClass("disabled")}),$("#dialog-error").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Ok:function(){$(this).dialog("close")}},create:function(){$(this).dialog("option","show",{effect:"shake",duration:150,easing:"easeOutElastic"})}}),$("#dialog-msg").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Ok:function(){$(this).dialog("close")}}}),$("#dialog-confirm").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Cancel:function(){$(this).dialog("close")}}}),-1!=window.location.href.indexOf("galileo")&&Notify.trigger("This is the test version of Tripwire.<br/>Please use <a href='https://tripwire.cloud-things.com'>Tripwire</a>");
tripwire.active=function(t){var i=[],a=[];for(var e in t){var d=JSON.parse(t[e].activity);i.push(parseInt(d.editSig)),a.push(parseInt(d.editComment)),d.editSig&&$("#sigTable tr[data-id='"+d.editSig+"']").addClass("editing").find("td").animate({backgroundColor:"#001b47"},1e3),d.editComment&&$("#commentWrapper .comment[data-id='"+d.editComment+"'] .cke").length>0&&$("#commentWrapper .comment[data-id='"+d.editComment+"']").addClass("editing").find(".commentStatus").html(t[e].characterName+" is editing").fadeIn()}$("#sigTable tr.editing").each(function(){-1==$.inArray($(this).data("id"),i)&&$("#sigTable tr[data-id='"+$(this).data("id")+"']").removeClass("editing").find("td").animate({backgroundColor:"#111"},1e3,null,function(){$(this).css({backgroundColor:""})})}),$("#commentWrapper .editing").each(function(){-1==$.inArray($(this).data("id"),a)&&$("#commentWrapper .editing[data-id='"+$(this).data("id")+"']").removeClass("editing").find(".commentStatus").fadeOut(function(){$(this).html("")})})};
tripwire.addSig=function(t,i,s){var e=void 0===(i=i||{}).animate||i.animate,a=(s=s||!1,{});if("wormhole"==t.type){a=$.map(tripwire.client.wormholes,function(i){if(i.initialID==t.id||i.secondaryID==t.id)return i})[0];var n=t.id==a.initialID?tripwire.client.signatures[a.secondaryID]:tripwire.client.signatures[a.initialID];t.name?leadsTo=tripwire.systems[n.systemID]?"<a href='.?system="+tripwire.systems[n.systemID].name+"'>"+t.name+"</a>":t.name:tripwire.aSigSystems[n.systemID]?leadsTo=tripwire.aSigSystems[n.systemID]:tripwire.systems[n.systemID]?leadsTo="<a href='.?system="+tripwire.systems[n.systemID].name+"'>"+tripwire.systems[n.systemID].name+"</a>":leadsTo="";var o="<tr data-id='"+t.id+"' data-tooltip='' "+(s?'disabled="disabled"':"")+"><td class='"+options.signatures.alignment.sigID+"'>"+(t.signatureID?t.signatureID.substring(0,3)+"-"+(t.signatureID.substring(3,6)||"###"):"???-###")+"</td><td class='type-tooltip "+options.signatures.alignment.sigType+"' data-tooltip=\""+this.whTooltip(a)+'">'+(a[a.parent+"ID"]==t.id?a.type||"":a.parent?"K162":"")+'</td><td class="age-tooltip '+options.signatures.alignment.sigAge+"\" data-tooltip='"+this.ageTooltip(t)+"'><span data-age='"+t.lifeTime+"'></span></td><td class='"+options.signatures.alignment.leadsTo+"'>"+(leadsTo||"")+"</td><td class='"+a.life+" "+options.signatures.alignment.sigLife+"'>"+a.life+"</td><td class='"+a.mass+" "+options.signatures.alignment.sigMass+"'>"+a.mass+"</td></tr>",r=$(o)}else o="<tr data-id='"+t.id+"' data-tooltip='' "+(s?'disabled="disabled"':"")+"><td class='"+options.signatures.alignment.sigID+"'>"+(t.signatureID?t.signatureID.substring(0,3)+"-"+(t.signatureID.substring(3,6)||"###"):"???-###")+"</td><td class='"+options.signatures.alignment.sigType+"'>"+t.type+"</td><td class='age-tooltip "+options.signatures.alignment.sigAge+"' data-tooltip='"+this.ageTooltip(t)+"'><span data-age='"+t.lifeTime+"'></span></td><td class='"+options.signatures.alignment.leadsTo+"' colspan='3'>"+(t.name?linkSig(t.name):"")+"</td></tr>",r=$(o);Tooltips.attach($(r).find("[data-tooltip]")),$("#sigTable").append(r),$("#sigTable").trigger("update"),"critical"==a.life?$(r).find("span[data-age]").countdown({until:moment.utc(t.lifeLeft).toDate(),onExpiry:this.pastEOL,alwaysExpire:!0,compact:!0,format:this.ageFormat,serverSync:this.serverTime.getTime}).addClass("critical"):$(r).find("span[data-age]").countdown({since:moment.utc(t.lifeTime).toDate(),compact:!0,format:this.ageFormat,serverSync:this.serverTime.getTime}),e&&($(r).find("td").wrapInner('<div class="hidden" />').parent().find("td > div").slideDown(700,function(){$set=$(this),$set.replaceWith($set.contents())}),$(r).find("td").animate({backgroundColor:"#004D16"},1e3).delay(1e3).animate({backgroundColor:"#111"},1e3,null,function(){$(this).css({backgroundColor:""})}))};
tripwire.API=function(){this.indicator,this.APIrefresh,this.API.expire=function(){var e={since:tripwire.API.APIrefresh,until:null,format:"MS",layout:"-{mnn}{sep}{snn}"};$("#APItimer").countdown("option",e)},this.API.refresh=function(){$.ajax({url:"api_update.php",cache:!1,dataType:"JSON",data:"indicator="+tripwire.API.indicator}).done(function(e){if(e&&e.APIrefresh){tripwire.API.indicator=e.indicator,tripwire.API.APIrefresh=new Date(e.APIrefresh),activity.refresh();var i={until:tripwire.API.APIrefresh,since:null,layout:"{mnn}{sep}{snn}"};$("#APItimer").countdown("option",i),setTimeout("tripwire.API.refresh();",$.countdown.periodsToSeconds($("#APItimer").countdown("getTimes"))-30)}else"-{mnn}{sep}{snn}"!==$("#APItimer").countdown("option","layout")&&$.countdown.periodsToSeconds($("#APItimer").countdown("getTimes"))>120?setTimeout("tripwire.API.refresh();",1e3*($.countdown.periodsToSeconds($("#APItimer").countdown("getTimes"))-30)):setTimeout("tripwire.API.refresh();",15e3)})},this.API.init=function(){$.ajax({url:"api_update.php",cache:!0,dataType:"JSON",data:"init=true"}).done(function(e){tripwire.API.indicator=e.indicator,tripwire.API.APIrefresh=new Date(e.APIrefresh),$("#APItimer").countdown({until:tripwire.API.APIrefresh,onExpiry:tripwire.API.expire,alwaysExpire:!0,compact:!0,format:"MS",serverSync:tripwire.serverTime.getTime,onTick:function(e){$("#APIclock").val(e[5]+1).trigger("change")}});var i="-{mnn}{sep}{snn}"===$("#APItimer").countdown("option","layout")?15:$.countdown.periodsToSeconds($("#APItimer").countdown("getTimes"))-30;setTimeout("tripwire.API.refresh();",1e3*i)})},this.API.init()};
tripwire.autoMapper=function(i,e){var t=[];if(!tripwire.systems[i]||!tripwire.systems[e])return!1;if(!$("#toggle-automapper").hasClass("active")||$("#toggle-automapper").hasClass("disabled"))return!1;if($.inArray(parseInt(tripwire.client.EVE.shipTypeID),[33328,670])>=0)return!1;if(void 0!==tripwire.map.shortest[i-3e7]&&void 0!==tripwire.map.shortest[i-3e7][e-3e7])return!1;if($.map(tripwire.client.wormholes,function(t){return tripwire.client.signatures[t.initialID].systemID==i&&tripwire.client.signatures[t.secondaryID].systemID==e||tripwire.client.signatures[t.initialID].systemID==e&&tripwire.client.signatures[t.secondaryID].systemID==i?t:null}).length>0)return!1;var s,r={signatures:{add:[],update:[]}},n=null;if(n=tripwire.systems[e].class?"Class "+tripwire.systems[e].class:tripwire.systems[e].security>=.45?"High-Sec":tripwire.systems[e].security>0?"Low-Sec":"Null-Sec",(s=$.map(tripwire.client.wormholes,function(e){if(tripwire.client.signatures[e.initialID].systemID==i&&!tripwire.systems[tripwire.client.signatures[e.secondaryID].systemID]){if(tripwire.aSigSystems[tripwire.client.signatures[e.secondaryID].systemID]==n)return e;if(e.type&&tripwire.wormholes[e.type]&&tripwire.wormholes[e.type].leadsTo==n)return e}})).length)if(s.length>1)$("#dialog-msg").dialog({autoOpen:!0,title:"Which Signature?",buttons:{Cancel:function(){$(this).dialog("close")},Ok:function(){var i=$("#dialog-msg #msg [name=sig]:checked").val(),n=s[i],a=tripwire.client.signatures[n.initialID],u=tripwire.client.signatures[n.secondaryID];r.signatures.update.push({wormhole:{id:n.id},signatures:[{id:a.id},{id:u.id,systemID:e}]});tripwire.refresh("refresh",r,function(i){i.resultSet&&1==i.resultSet[0].result&&(t.push({wormhole:n,signatures:[a,u]}),$("#dialog-msg").dialog("close"))})}},open:function(){$("#dialog-msg #msg").html("Which signature would you like to update?<br/><br/>"),$.each(s,function(i){$("#dialog-msg #msg").append("<input type='radio' name='sig' value='"+i+"' />"+tripwire.client.signatures[s[i].initialID].signatureID+"<br/>")})}});else{var a=s[0],u=tripwire.client.signatures[a.initialID],l=tripwire.client.signatures[a.secondaryID];r.signatures.update.push({wormhole:{id:a.id},signatures:[{id:u.id},{id:l.id,systemID:e}]}),t.push({wormhole:a,signatures:[u,l]})}if(0==s.length)if((s=$.map(tripwire.client.wormholes,function(e){if(tripwire.client.signatures[e.initialID].systemID==i&&!tripwire.systems[tripwire.client.signatures[e.secondaryID].systemID]&&!tripwire.client.signatures[e.secondaryID].systemID)return e})).length)if(s.length>1)$("#dialog-msg").dialog({autoOpen:!0,title:"Which Signature?",buttons:{Cancel:function(){$(this).dialog("close")},Ok:function(){var i=$("#dialog-msg #msg [name=sig]:checked").val(),n=s[i],a=tripwire.client.signatures[n.initialID],u=tripwire.client.signatures[n.secondaryID];r.signatures.update.push({wormhole:{id:n.id},signatures:[{id:a.id},{id:u.id,systemID:e}]});tripwire.refresh("refresh",r,function(i){i.resultSet&&1==i.resultSet[0].result&&(t.push({wormhole:n,signatures:[a,u]}),$("#dialog-msg").dialog("close"))})}},open:function(){$("#dialog-msg #msg").html("Which signature would you like to update?<br/><br/>"),$.each(s,function(i){$("#dialog-msg #msg").append("<input type='radio' name='sig' value='"+i+"' />"+tripwire.client.signatures[s[i].initialID].signatureID+"<br/>")})}});else{a=s[0],u=tripwire.client.signatures[a.initialID],l=tripwire.client.signatures[a.secondaryID];r.signatures.update.push({wormhole:{id:a.id},signatures:[{id:u.id},{id:l.id,systemID:e}]}),t.push({wormhole:a,signatures:[u,l]})}else r.signatures.add.push({wormhole:{type:null,parent:"initial",life:"stable",mass:"stable"},signatures:[{signatureID:null,systemID:i,type:"wormhole",name:null},{signatureID:null,systemID:e,type:"wormhole",name:null}]});if(r.signatures.add.length||r.signatures.update.length){tripwire.refresh("refresh",r,function(i){i.resultSet&&1==i.resultSet[0].result&&($("#undo").removeClass("disabled"),i.results&&(viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"add",signatures:i.results}):tripwire.signatures.undo[viewingSystemID]=[{action:"add",signatures:i.results}]),t.length&&(viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"update",signatures:t}):tripwire.signatures.undo[viewingSystemID]=[{action:"update",signatures:t}]),sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))})}};
tripwire.comments=function(){this.comments.data={},this.comments.parse=function(t){for(var e in t){var m=t[e].id;if(Object.find(tripwire.comments.data,"id",m)||0!=$(".comment[data-id='"+m+"']").length){if(Object.find(tripwire.comments.data,"id",m)&&Object.find(tripwire.comments.data,"id",m).modified!=t[e].modified){i=$(".comment[data-id='"+m+"']");try{i.find(".commentBody").html(t[e].comment)}catch(t){i.find(".commentFooter").show(),i.find(".commentStatus").html("<span class='critical'>"+t.constructor.name+": "+t.message+"</span>"),i.find(".commentFooter .commentControls").hide()}i.find(".commentModified").html("Edited by "+t[e].modifiedByName+" at "+t[e].modified),i.find(".commentSticky").addClass(t[e].sticky?"active":"")}}else{var i=$(".comment:last").clone(),o=$(".comment:visible:last .commentBody").attr("id")?$(".comment:visible:last .commentBody").attr("id").replace("comment","")+1:0;$(".comment:last").before(i),i.attr("data-id",m);try{i.find(".commentBody").html(t[e].comment)}catch(t){i.find(".commentFooter").show(),i.find(".commentStatus").html("<span class='critical'>"+t.constructor.name+": "+t.message+"</span>"),i.find(".commentFooter .commentControls").hide()}i.find(".commentModified").html("Edited by "+t[e].modifiedByName+" at "+t[e].modified),i.find(".commentCreated").html("Posted by "+t[e].createdByName+" at "+t[e].created),i.find(".commentBody").attr("id","comment"+o),i.find(".commentSticky").addClass(t[e].sticky?"active":""),i.removeClass("hidden"),Tooltips.attach(i.find("[data-tooltip]"))}}for(var e in tripwire.comments.data){m=tripwire.comments.data[e].id;if(!Object.find(t,"id",m))(i=$(".comment[data-id='"+m+"']")).remove()}tripwire.comments.data=t}},tripwire.comments();
tripwire.deleteSig=function(e){var t=$("#sigTable tr[data-id='"+e+"']");$(t).removeClass("selected"),$("#delete-signature").trigger("delete:refresh"),$(t).find("td:empty, a:empty").append("&nbsp;"),$(t).find("td").wrapInner("<div />").parent().find("td > div").animate({backgroundColor:"#4D0000"},1e3).delay(1e3).animate({backgroundColor:"#111"},1e3).slideUp(700,function(){$(t).find("span[data-age]").countdown("destroy"),$(this).parent().parent().remove(),$("#sigTable").trigger("update")})};
tripwire.editSig=function(t,s){s=s||!1;var i={};if("wormhole"==t.type){i=$.map(tripwire.client.wormholes,function(s){if(s.initialID==t.id||s.secondaryID==t.id)return s})[0];var e=t.id==i.initialID?tripwire.client.signatures[i.secondaryID]:tripwire.client.signatures[i.initialID];t.name?leadsTo=tripwire.systems[e.systemID]?"<a href='.?system="+tripwire.systems[e.systemID].name+"'>"+t.name+"</a>":t.name:tripwire.aSigSystems[e.systemID]?leadsTo=tripwire.aSigSystems[e.systemID]:tripwire.systems[e.systemID]?leadsTo="<a href='.?system="+tripwire.systems[e.systemID].name+"'>"+tripwire.systems[e.systemID].name+"</a>":leadsTo="";var a="<tr data-id='"+t.id+"' data-tooltip='' "+(s?'disabled="disabled"':"")+"><td class='"+options.signatures.alignment.sigID+"'>"+(t.signatureID?t.signatureID.substring(0,3)+"-"+(t.signatureID.substring(3,6)||"###"):"???-###")+"</td><td class='type-tooltip "+options.signatures.alignment.sigType+"' data-tooltip=\""+this.whTooltip(i)+'">'+(i[i.parent+"ID"]==t.id?i.type||"":i.parent?"K162":"")+'</td><td class="age-tooltip '+options.signatures.alignment.sigAge+"\" data-tooltip='"+this.ageTooltip(t)+"'><span data-age='"+t.lifeTime+"'></span></td><td class='"+options.signatures.alignment.leadsTo+"'>"+(leadsTo||"")+"</td><td class='"+i.life+" "+options.signatures.alignment.sigLife+"'>"+i.life+"</td><td class='"+i.mass+" "+options.signatures.alignment.sigMass+"'>"+i.mass+"</td></tr>",n=$(a)}else a="<tr data-id='"+t.id+"' data-tooltip='' "+(s?'disabled="disabled"':"")+"><td class='"+options.signatures.alignment.sigID+"'>"+(t.signatureID?t.signatureID.substring(0,3)+"-"+(t.signatureID.substring(3,6)||"###"):"???-###")+"</td><td class='"+options.signatures.alignment.sigType+"'>"+t.type+"</td><td class='age-tooltip "+options.signatures.alignment.sigAge+"' data-tooltip='"+this.ageTooltip(t)+"'><span data-age='"+t.lifeTime+"'></span></td><td class='"+options.signatures.alignment.leadsTo+"' colspan='3'>"+(t.name?linkSig(t.name):"")+"</td></tr>",n=$(a);Tooltips.attach($(n).find("[data-tooltip]")),$("#sigTable tr[data-id='"+t.id+"']").find("span[data-age]").countdown("destroy"),$("#sigTable tr[data-id='"+t.id+"']").replaceWith(n),$("#sigTable").trigger("update"),"critical"==i.life?$(n).find("span[data-age]").countdown({until:moment.utc(t.lifeLeft).toDate(),onExpiry:this.pastEOL,alwaysExpire:!0,compact:!0,format:this.ageFormat,serverSync:this.serverTime.getTime}).addClass("critical"):$(n).find("span[data-age]").countdown({since:moment.utc(t.lifeTime).toDate(),compact:!0,format:this.ageFormat,serverSync:this.serverTime.getTime}),$(n).effect("pulsate")};
tripwire.esi=function(){var e="https://esi.tech.ccp.is",a="Tripwire Client "+tripwire.version+" ("+window.location.hostname+") - "+window.navigator.userAgent;this.esi.connection=!0,this.esi.characters={};var t=function(){for(characterID in t.timer,clearTimeout(t.timer),tripwire.esi.characters){var i=tripwire.esi.characters[characterID];moment(i.tokenExpire).subtract(5,"minutes").isBefore(moment())?tripwire.data.esi={expired:!0}:$.ajax({url:e+"/v1/characters/"+characterID+"/location/?"+$.param({token:i.accessToken,user_agent:a}),type:"GET",dataType:"JSON",characterID:characterID}).done(function(e,a,t){var i=tripwire.esi.characters[this.characterID];i&&(i.locationDate=moment(t.getResponseHeader("last-modified"),"ddd, DD MMMM YYYY HH:mm:ss").format(),i.systemID!=e.solar_system_id&&(i.systemID=e.solar_system_id||null,i.systemName=tripwire.systems[e.solar_system_id]?tripwire.systems[e.solar_system_id].name:null,$("#tracking .tracking-clone[data-characterid='"+this.characterID+"']").find(".system").html(i.systemName||"&nbsp;"),tripwire.data.tracking[this.characterID]={characterID:i.characterID,characterName:i.characterName,systemID:i.systemID,systemName:i.systemName,stationID:i.stationID,stationName:i.stationName,shipID:i.shipID,shipName:i.shipName,shipTypeID:i.shipTypeID,shipTypeName:i.shipTypeName}),i.stationID!=e.station_id&&(i.stationID=e.station_id||null,e.station_id?tripwire.esi.stationLookup(e.station_id,this.characterID).always(function(e){var a=tripwire.esi.characters[this.reference];a.stationName=e.name||null,$("#tracking .tracking-clone[data-characterid='"+this.reference+"']").find(".station").html(e.name.substring(0,17)+"..."||"&nbsp;").attr("data-tooltip",e.name),Tooltips.attach($("#tracking .tracking-clone[data-characterid='"+this.reference+"'] .station[data-tooltip]")),tripwire.data.tracking[characterID]={characterID:a.characterID,characterName:a.characterName,systemID:a.systemID,systemName:a.systemName,stationID:a.stationID,stationName:a.stationName,shipID:a.shipID,shipName:a.shipName,shipTypeID:a.shipTypeID,shipTypeName:a.shipTypeName}}):(i.stationName=null,Tooltips.detach($("#tracking .tracking-clone[data-characterid='"+this.characterID+"'] .station[data-tooltip]")),tripwire.data.tracking[this.characterID]={characterID:i.characterID,characterName:i.characterName,systemID:i.systemID,systemName:i.systemName,stationID:i.stationID,stationName:i.stationName,shipID:i.shipID,shipName:i.shipName,shipTypeID:i.shipTypeID,shipTypeName:i.shipTypeName})),options.tracking.active==this.characterID&&tripwire.EVE(tripwire.esi.characters[options.tracking.active]))}).fail(function(e){403==e.status&&tripwire.refresh("refresh",{esi:{expired:!0}})}).always(function(e,a){"success"!=a&&"abort"!=a&&1==tripwire.esi.connection?(tripwire.esi.connection=!1,$("#esiConnectionSuccess, #esiConnectionError").click(),Notify.trigger("ESI Connection Failed","red",!1,"esiConnectionError")):"success"==a&&0==tripwire.esi.connection&&(tripwire.esi.connection=!0,$("#esiConnectionSuccess, #esiConnectionError").click(),Notify.trigger("ESI Connection Resumed","green",5e3,"esiConnectionSuccess"))})}t.timer=setTimeout(t,5e3)},i=function(){for(characterID in i.timer,clearTimeout(i.timer),tripwire.esi.characters){var t=tripwire.esi.characters[characterID];moment(t.tokenExpire).subtract(5,"minutes").isBefore(moment())?tripwire.data.esi={expired:!0}:$.ajax({url:e+"/v1/characters/"+characterID+"/ship/?"+$.param({token:t.accessToken,user_agent:a}),type:"GET",dataType:"JSON",characterID:characterID}).done(function(e,a,t){var i=tripwire.esi.characters[this.characterID];i&&(i.shipDate=moment(t.getResponseHeader("last-modified"),"ddd, DD MMMM YYYY HH:mm:ss").format(),i.shipID!=e.ship_item_id&&(i.shipID=e.ship_item_id||null,tripwire.data.tracking[this.characterID]={characterID:i.characterID,characterName:i.characterName,systemID:i.systemID,systemName:i.systemName,stationID:i.stationID,stationName:i.stationName,shipID:i.shipID,shipName:i.shipName,shipTypeID:i.shipTypeID,shipTypeName:i.shipTypeName}),i.shipName!=e.ship_name&&(i.shipName=e.ship_name||null,$("#tracking .tracking-clone[data-characterid='"+this.characterID+"']").find(".shipname").html(e.ship_name||"&nbsp;"),tripwire.data.tracking[this.characterID]={characterID:i.characterID,characterName:i.characterName,systemID:i.systemID,systemName:i.systemName,stationID:i.stationID,stationName:i.stationName,shipID:i.shipID,shipName:i.shipName,shipTypeID:i.shipTypeID,shipTypeName:i.shipTypeName}),i.shipTypeID!=e.ship_type_id&&(i.shipTypeID=e.ship_type_id||null,e.ship_type_id?tripwire.esi.typeLookup(e.ship_type_id,this.characterID).always(function(e){var a=tripwire.esi.characters[this.reference];a.shipTypeName=e.name||null,$("#tracking .tracking-clone[data-characterid='"+this.reference+"']").find(".ship").html(e.name||"&nbsp;"),tripwire.data.tracking[this.characterID]={characterID:a.characterID,characterName:a.characterName,systemID:a.systemID,systemName:a.systemName,stationID:a.stationID,stationName:a.stationName,shipID:a.shipID,shipName:a.shipName,shipTypeID:a.shipTypeID,shipTypeName:a.shipTypeName}}):(i.shipTypeName=null,$("#tracking .tracking-clone[data-characterid='"+this.characterID+"']").find(".ship").html("&nbsp;"),tripwire.data.tracking[this.characterID]={characterID:i.characterID,characterName:i.characterName,systemID:i.systemID,systemName:i.systemName,stationID:i.stationID,stationName:i.stationName,shipID:i.shipID,shipName:i.shipName,shipTypeID:i.shipTypeID,shipTypeName:i.shipTypeName})))}).fail(function(e){403==e.status&&tripwire.refresh("refresh",{esi:{expired:!0}})}).always(function(e,a){"success"!=a&&"abort"!=a&&1==tripwire.esi.connection?(tripwire.esi.connection=!1,$("#esiConnectionSuccess, #esiConnectionError").click(),Notify.trigger("ESI Connection Failed","red",!1,"esiConnectionError")):"success"==a&&0==tripwire.esi.connection&&(tripwire.esi.connection=!0,$("#esiConnectionSuccess, #esiConnectionError").click(),Notify.trigger("ESI Connection Resumed","green",5e3,"esiConnectionSuccess"))})}i.timer=setTimeout(i,5e3)},r=function(){for(characterID in r.timer,clearTimeout(r.timer),tripwire.esi.characters){var e=tripwire.esi.characters[characterID];tripwire.esi.characterStatus(e.characterID,e).done(function(e){e?$("#tracking .tracking-clone[data-characterid='"+this.reference.characterID+"']").find(".online").removeClass("critical").addClass("stable"):$("#tracking .tracking-clone[data-characterid='"+this.reference.characterID+"']").find(".online").removeClass("stable").addClass("critical")}).fail(function(e){var a;e&&403==e.status&&(a=this.reference.characterID,$("#tracking .tracking-clone[data-characterid='"+a+"']").find(".alert").show()),$("#tracking .tracking-clone[data-characterid='"+this.reference.characterID+"']").find(".online").removeClass("stable").addClass("critical")})}r.timer=setTimeout(r,6e4)};this.esi.typeLookup=function(t,i){return $.ajax({url:e+"/v2/universe/types/"+t+"/?"+$.param({user_agent:a}),type:"GET",dataType:"JSON",reference:i})},this.esi.stationLookup=function(t,i){return $.ajax({url:e+"/v2/universe/stations/"+t+"/?"+$.param({user_agent:a}),type:"GET",dataType:"JSON",reference:i})},this.esi.setDestination=function(t,i,r,s){return r=r||!1,s=s||!1,$.ajax({url:e+"/v2/ui/autopilot/waypoint/?"+$.param({destination_id:t,clear_other_waypoints:r,add_to_beginning:s}),headers:{Authorization:"Bearer "+tripwire.esi.characters[i].accessToken,"X-User-Agent":a},type:"POST",dataType:"JSON"})},this.esi.showInfo=function(t,i){return $.ajax({url:e+"/v1/ui/openwindow/information/?"+$.param({target_id:t}),headers:{Authorization:"Bearer "+tripwire.esi.characters[i].accessToken,"X-User-Agent":a},type:"POST",dataType:"JSON"})},this.esi.characterStatus=function(t,i){return $.ajax({url:e+"/v1/characters/"+t+"/online/?"+$.param({token:tripwire.esi.characters[t].accessToken,user_agent:a}),type:"GET",dataType:"JSON",reference:i})},this.esi.eveStatus=function(){return $.ajax({url:e+"/v1/status/?"+$.param({user_agent:a}),type:"GET",dataType:"JSON"})},this.esi.idLookup=function(t){return $.ajax({url:e+"/v2/universe/names/?"+$.param({user_agent:a}),type:"POST",dataType:"JSON",contentType:"application/json",processData:!1,data:JSON.stringify(t)})},this.esi.characterLookup=function(t,i,r){r=void 0===r||r;return $.ajax({url:e+"/v4/characters/"+t+"/?"+$.param({user_agent:a}),type:"GET",dataType:"JSON",async:r,eveID:t,reference:i})},this.esi.corporationLookup=function(t,i,r){r=void 0===r||r;return $.ajax({url:e+"/v4/corporations/"+t+"/?"+$.param({user_agent:a}),type:"GET",dataType:"JSON",async:r,eveID:t,reference:i})},this.esi.allianceLookup=function(t,i,r){r=void 0===r||r;return $.ajax({url:e+"/v3/alliances/"+t+"/?"+$.param({user_agent:a}),type:"GET",dataType:"JSON",async:r,eveID:t,reference:i})},this.esi.search=function(t,i,r){return $.ajax({url:e+"/v2/search/?"+$.param({user_agent:a}),type:"GET",dataType:"JSON",contentType:"application/json",data:{search:t,categories:i,strict:r}})},this.esi.universeJumps=function(){return $.ajax({url:e+"/v1/universe/system_jumps/?"+$.param({user_agent:a}),type:"GET",dataType:"JSON"})},this.esi.universeKills=function(){return $.ajax({url:e+"/v2/universe/system_kills/?"+$.param({user_agent:a}),type:"GET",dataType:"JSON"})},this.esi.fullLookup=function(e){var a=$.Deferred();return tripwire.esi.idLookup(e).done(function(e){for(item in e)"character"==e[item].category?tripwire.esi.characterLookup(e[item].id,e[item],!1).done(function(a){$.extend(e[item],a),tripwire.esi.corporationLookup(a.corporation_id,this.reference,!1).done(function(a){e[item].corporation=a,a.alliance_id&&tripwire.esi.allianceLookup(a.alliance_id,this.reference,!1).done(function(a){e[item].alliance=a})})}):"corporation"==e[item].category&&tripwire.esi.corporationLookup(e[item].id,e[item],!1).done(function(a){$.extend(e[item],a),a.alliance_id&&tripwire.esi.allianceLookup(a.alliance_id,this.reference,!1).done(function(a){e[item].alliance=a})});a.resolve(e)}),a},this.esi.parse=function(e){for(characterID in tripwire.esi.characters)characterID in e||(delete tripwire.esi.characters[characterID],$("#tracking .tracking-clone[data-characterid='"+characterID+"']").remove(),options.tracking.active==characterID&&(tripwire.EVE(!1,!0),$("#removeESI").attr("disabled","disabled")));for(characterID in e){if("new"==options.tracking.active&&(options.tracking.active=characterID),!(characterID in tripwire.esi.characters)){var a=$("#tracking-clone").clone();a.attr("data-characterid",characterID),a.find(".avatar img").attr("src","https://image.eveonline.com/Character/"+characterID+"_32.jpg"),a.find(".name").html(e[characterID].characterName),a.removeAttr("id"),a.removeClass("hidden"),a.addClass("tracking-clone"),options.tracking.active==characterID&&(a.addClass("active"),$("#removeESI").removeAttr("disabled")),$("#tracking").append(a)}tripwire.esi.characters[characterID]=e[characterID]}i(),t(),r()}},tripwire.esi();
tripwire.EVE=function(t,e){var s=this.client.EVE&&this.client.EVE.systemChange||!1;t?(e||(this.client.EVE&&this.client.EVE.systemID!=t.systemID||1==s)&&(s=!0,moment(t.locationDate).isAfter(moment(this.client.EVE.shipDate))&&(s=!1,tripwire.autoMapper(this.client.EVE.systemID,t.systemID))),!e&&options.buttons.follow&&this.client.EVE&&this.client.EVE.systemID!=t.systemID&&0==$(".ui-dialog:visible").length&&tripwire.systemChange(t.systemID),$("#search").hasClass("active")||$("#currentSpan").show(),$("#toggle-automapper").removeClass("disabled"),t.systemID&&$("#EVEsystem").html(tripwire.systems[t.systemID].name).attr("href",".?system="+tripwire.systems[t.systemID].name)):($("#EVEsystem").html(""),$("#currentSpan").hide(),$("#toggle-automapper").addClass("disabled")),this.client.EVE={characterID:t.characterID,characterName:t.characterName,systemID:t.systemID,systemName:t.systemName,shipTypeID:t.shipTypeID,shipTypeName:t.shipTypeName,stationID:t.stationID,stationName:t.stationName,locationDate:t.locationDate,shipDate:t.shipDate,systemChange:s}};
tripwire.parse=function(i,s){var t=$.extend(!0,{},i);if((null==options.chain.active||options.chain.tabs[options.chain.active]&&1!=options.chain.tabs[options.chain.active].evescout)&&"273.0"!=options.masks.active)for(var e in t.signatures)"273.0"==t.signatures[e].mask&&delete t.signatures[e];if("refresh"==s){for(var e in this.client=i,t.signatures)if(t.signatures[e].systemID==viewingSystemID){var n="273.0"==t.signatures[e].mask&&"273.0"!=options.masks.active;if(tripwire.signatures.list[e]){if(tripwire.signatures.list[e].modifiedTime!==t.signatures[e].modifiedTime){var a=!1;for(column in t.signatures[e])t.signatures[e][column]!=tripwire.signatures.list[e][column]&&"editing"!=column&&(a=!0);a&&this.editSig(t.signatures[e],n)}}else this.addSig(t.signatures[e],{animate:!0},n)}for(var e in tripwire.signatures.list)t.signatures[e]||this.deleteSig(e)}else if("init"==s||"change"==s)for(var e in this.client=i,t.signatures)if(t.signatures[e].systemID==viewingSystemID){n="273.0"==t.signatures[e].mask&&"273.0"!=options.masks.active;this.addSig(t.signatures[e],{animate:!1},n),t.signatures[e].editing&&this.sigEditing(t.signatures[e])}tripwire.signatures.list=t.signatures;var r=0;$.map(t.signatures,function(i){i.systemID==viewingSystemID&&r++}),$("#signature-count").html(r)};
tripwire.pasteSignatures=function(){var e=!1,i=function(e){var i={},t=e.split("\t"),s=["Cosmic Signature","Cosmic Anomaly","Kosmische Anomalie","Kosmische Signatur","Источники сигналов","Космическая аномалия"],r={"Gas Site":"Gas","Data Site":"Data","Relic Site":"Relic","Ore Site":"Ore","Combat Site":"Combat",Wormhole:"Wormhole",Gasgebiet:"Gas",Datengebiet:"Data",Reliktgebiet:"Relic",Mineraliengebiet:"Ore",Kampfgebiet:"Combat",Wurmloch:"Wormhole","ГАЗ: район добычи газа":"Gas","ДАННЫЕ: район сбора данных":"Data","АРТЕФАКТЫ: район поиска артефактов":"Relic","РУДА: район добычи руды":"Ore","ОПАСНО: район повышенной опасности":"Combat","Червоточина":"Wormhole"};for(var n in t)t[n].match(/^([A-Z]{3}[-]\d{3})$/)?i.id=t[n].split("-"):t[n].match(/(\d([.|,]\d)?[ ]?(%))/)||t[n].match(/(\d[.|,]?\d+\s(AU|AE|km|m|а.е.|км|м))/i)||(-1==$.inArray(t[n],s)?r[t[n]]?i.type=r[t[n]]:""!=t[n]&&(i.name=t[n]):i.scanGroup=t[n]);return!(!i.id||2!==i.id.length)&&i};this.pasteSignatures.parsePaste=function(t){t=t.split("\n");var s={signatures:{add:[],update:[]},systemID:viewingSystemID},r=[];for(var n in e=!0,t){var a=i(t[n]);if(a.id){var u=$.map(tripwire.client.signatures,function(e){if(e.signatureID&&e.signatureID.toUpperCase()==a.id[0]+a.id[1])return e})[0];if(u)if("Wormhole"==a.type&&"wormhole"!=u.type){var o=$.map(tripwire.client.wormholes,function(e){if(e.initialID==u.id||e.secondaryID==u.id)return e})[0]||{},l=o.id?u.id==o.initialID?tripwire.client.signatures[o.secondaryID]:tripwire.client.signatures[o.initialID]:{};s.signatures.update.push({wormhole:{id:o.id||null,type:o.type||null,life:o.life||"stable",mass:o.mass||"stable"},signatures:[{id:u.id,signatureID:u.signatureID,systemID:viewingSystemID,type:"wormhole",name:u.name},{id:l.id||null,signatureID:l.signatureID||null,systemID:l.systemID||null,type:"wormhole",name:l.name}]}),tripwire.client.wormholes[o.id]?r.push({wormhole:tripwire.client.wormholes[o.id],signatures:[tripwire.client.signatures[u.id],tripwire.client.signatures[l.id]]}):r.push(tripwire.client.signatures[u.id])}else"wormhole"!=u.type&&(a.type&&a.type.toLowerCase()!=u.type||a.name&&a.name!=u.name)&&(s.signatures.update.push({id:u.id,systemID:viewingSystemID,type:a.type||"unknown",name:a.name,lifeLength:60*options.signatures.pasteLife*60}),r.push(tripwire.client.signatures[u.id]));else"Wormhole"==a.type?s.signatures.add.push({wormhole:{type:null,parent:"initial",life:"stable",mass:"stable"},signatures:[{signatureID:a.id[0]+a.id[1],systemID:viewingSystemID,type:"wormhole",name:null},{signatureID:null,systemID:null,type:"wormhole",name:null}]}):s.signatures.add.push({signatureID:a.id[0]+a.id[1],systemID:viewingSystemID,type:a.type||"unknown",name:a.name,lifeLength:60*options.signatures.pasteLife*60})}}if(s.signatures.add.length||s.signatures.update.length){tripwire.refresh("refresh",s,function(e){e.resultSet&&1==e.resultSet[0].result&&($("#undo").removeClass("disabled"),e.results&&(viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"add",signatures:e.results}):tripwire.signatures.undo[viewingSystemID]=[{action:"add",signatures:e.results}]),r.length&&(viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"update",signatures:r}):tripwire.signatures.undo[viewingSystemID]=[{action:"update",signatures:r}]),sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))},function(i){e=!1})}else e=!1},this.pasteSignatures.init=function(){$(document).keydown(function(i){if((i.metaKey||i.ctrlKey)&&(86==i.keyCode||91==i.keyCode)&&!e){if($(document.activeElement).is("textarea, input"))return;$("#clipboard").focus()}}),$("body").on("click","#fullPaste",function(e){e.preventDefault();var t=$(this).data("paste").split("\n"),s=[],r=[],n=[];for(var a in t)(scan=i(t[a]))&&s.push((scan.id[0]+scan.id[1]).toLowerCase());for(var a in tripwire.client.signatures){var u=tripwire.client.signatures[a];if(u.systemID==viewingSystemID&&(!u.signatureID||-1===$.inArray(u.signatureID.toLowerCase(),s)))if("wormhole"==u.type){var o=$.map(tripwire.client.wormholes,function(e){if(e.initialID==u.id||e.secondaryID==u.id)return e})[0]||{},l=o.id?u.id==o.initialID?tripwire.client.signatures[o.secondaryID]:tripwire.client.signatures[o.initialID]:{};"GATE"!==o.type&&(r.push(o),n.push({wormhole:o,signatures:[u,l]}))}else r.push(u.id),n.push(u)}if(r.length>0){var p={signatures:{remove:r}};tripwire.refresh("refresh",p,function(e){e.resultSet&&1==e.resultSet[0].result&&($("#undo").removeClass("disabled"),viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"remove",signatures:n}):tripwire.signatures.undo[viewingSystemID]=[{action:"remove",signatures:n}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))})}}),$("#clipboard").on("paste",function(e){e.preventDefault();var i=window.clipboardData?window.clipboardData.getData("Text"):(e.originalEvent||e).clipboardData.getData("text/plain");$("#clipboard").blur(),Notify.trigger("Paste detected<br/>(<a id='fullPaste' href=''>Click to delete missing sigs</a>)"),$("#fullPaste").data("paste",i),tripwire.pasteSignatures.parsePaste(i)})},this.pasteSignatures.init()},tripwire.pasteSignatures();
tripwire.redo=function(){if(tripwire.signatures.redo[viewingSystemID].length>0){$("#redo").addClass("disabled");var i=tripwire.signatures.redo[viewingSystemID].length-1,e={systemID:viewingSystemID,signatures:{add:[],remove:[],update:[]}},r=tripwire.signatures.redo[viewingSystemID][i],t=$.map(r.signatures,function(i){if(i.wormhole&&tripwire.client.wormholes[i.wormhole.id])return{wormhole:tripwire.client.wormholes[i.wormhole.id],signatures:[tripwire.client.signatures[i.signatures[0].id],tripwire.client.signatures[i.signatures[1].id]]};if(tripwire.client.signatures[i.id]&&"wormhole"==tripwire.client.signatures[i.id].type){var e=$.map(tripwire.client.wormholes,function(e){if(e.initialID==i.id||e.secondaryID==i.id)return e})[0];return{wormhole:e,signatures:[tripwire.client.signatures[e.initialID],tripwire.client.signatures[e.secondaryID]]}}return i.wormhole&&tripwire.client.signatures[i.signatures[0].id]?tripwire.client.signatures[i.signatures[0].id]:tripwire.client.signatures[i.id]});switch(r.action){case"add":e.signatures.add=e.signatures.add.concat(r.signatures);break;case"remove":e.signatures.remove=e.signatures.remove.concat($.map(r.signatures,function(i){return i.wormhole?i.wormhole:i.id}));break;case"update":e.signatures.update=e.signatures.update.concat(r.signatures)}tripwire.refresh("refresh",e,function(i){i.resultSet&&1==i.resultSet[0].result&&(tripwire.signatures.redo[viewingSystemID].pop(),$("#undo").removeClass("disabled"),viewingSystemID in tripwire.signatures.undo?"add"==r.action?tripwire.signatures.undo[viewingSystemID].push({action:r.action,signatures:i.results}):"update"==r.action?tripwire.signatures.undo[viewingSystemID].push({action:r.action,signatures:t}):tripwire.signatures.undo[viewingSystemID].push({action:r.action,signatures:r.signatures}):"add"==r.action?tripwire.signatures.undo[viewingSystemID]=[{action:r.action,signatures:i.results}]:"update"==r.action?tripwire.signatures.undo[viewingSystemID]=[{action:r.action,signatures:t}]:tripwire.signatures.undo[viewingSystemID]=[{action:r.action,signatures:r.signatures}],sessionStorage.setItem("tripwire_redo",JSON.stringify(tripwire.signatures.redo)),sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))},function(i){tripwire.signatures.redo[viewingSystemID].length>0&&$("#redo").removeClass("disabled")})}};
tripwire.serverStatus=function(){this.data,this.timer,clearTimeout(tripwire.serverStatus.timer),tripwire.esi.eveStatus().always(function(t){t&&t.players&&t.players>0?(tripwire.serverStatus.data&&tripwire.serverStatus.data.players===t.players||($("#serverStatus").html("<span class='"+(t.players>0?"stable":"critical")+"'>TQ</span>: "+numFormat(t.players)),tripwire.serverStatus.data&&$("#serverStatus").effect("pulsate",{times:5})),tripwire.serverStatus.data=t):$("#serverStatus").html("<span class='critical'>TQ</span>"),tripwire.serverStatus.timer=setTimeout("tripwire.serverStatus();",15e3)})},tripwire.serverStatus();
tripwire.sync=function(e,i,t,r){i="object"==typeof i?$.extend(!0,{},i):{};return $.extend(!0,i,tripwire.data),this.timer&&clearTimeout(this.timer),this.xhr&&this.xhr.abort(),"refresh"==e||"change"==e?(i.signatureCount=Object.size(this.client.signatures),i.signatureTime=Object.maxTime(this.client.signatures,"modifiedTime"),i.flareCount=chain.data.flares?chain.data.flares.flares.length:0,i.flareTime=chain.data.flares?chain.data.flares.last_modified:0,i.commentCount=Object.size(this.comments.data),i.commentTime=Object.maxTime(this.comments.data,"modified"),i.activity=this.activity):($.extend(this,appData),this.aSystems=$.map(this.systems,function(e){return e.name}),this.aSigSystems=["Null-Sec","Low-Sec","High-Sec","Class-1","Class-2","Class-3","Class-4","Class-5","Class-6"],$.merge(this.aSigSystems,this.aSystems.slice()),$(".systemsAutocomplete").inlinecomplete({source:this.aSystems,maxSize:10,delay:0})),i.mode="init"!=e?"refresh":"init",i.systemID=viewingSystemID,i.systemName=viewingSystem,i.instance=tripwire.instance,i.version=tripwire.version,this.xhr=$.ajax({url:"refresh.php",data:i,type:"POST",dataType:"JSON",cache:!1}).done(function(i){i&&(tripwire.server=i,i.esi&&tripwire.esi.parse(i.esi),i.sync&&(tripwire.serverTime.time=new Date(i.sync)),i.signatures&&tripwire.parse(i,e),i.wormholes||i.occupied||i.flares?tripwire.chainMap.parse({map:i.wormholes||null,occupied:i.occupied||null,flares:i.flares||null}):chain.data.occupied&&chain.data.occupied.length&&!i.occupied&&tripwire.chainMap.parse({occupied:[]}),i.comments&&tripwire.comments.parse(i.comments),tripwire.active(i.activity),i.notify&&!$("#serverNotification")[0]&&Notify.trigger(i.notify,"yellow",!1,"serverNotification")),tripwire.data={tracking:{},esi:{}},t&&t(i)}).always(function(e,i){tripwire.timer=setTimeout("tripwire.refresh();",tripwire.refreshRate),r&&r(e),403==e.status?window.location.href=".":"success"!=i&&"abort"!=i&&1==tripwire.connected?(tripwire.connected=!1,$("#ConnectionSuccess").click(),Notify.trigger("Error syncing with server","red",!1,"connectionError")):"success"==i&&0==tripwire.connected&&(tripwire.connected=!0,$("#connectionError").click(),Notify.trigger("Successfully reconnected with server","green",5e3,"connectionSuccess"))}),!0},tripwire.sync("init");
tripwire.systemChange=function(e,s){if("init"!=s&&($("#infoSecurity").removeClass(),$("#infoStatics").empty(),viewingSystem=tripwire.systems[e].name,viewingSystemID=e,activity.refresh(!0),$("#sigTable span[data-age]").countdown("destroy"),$("#sigTable tbody").empty(),$("#signature-count").html(0),tripwire.signatures.list={},tripwire.client.signatures=null,chain.redraw(),$("#notesWidget .content .comment:visible").remove(),tripwire.comments.data=null,history.replaceState(null,null,"?system="+viewingSystem),tripwire.refresh("change")),document.title=tripwire.systems[e].name+" - "+app_name,$("#infoSystem").text(tripwire.systems[e].name),-1!=$.inArray(parseInt(viewingSystemID),options.favorites)?$("#system-favorite").attr("data-icon","star").addClass("active"):$("#system-favorite").attr("data-icon","star-empty").removeClass("active"),tripwire.systems[e].class){if($("#infoSecurity").html("<span class='wh pointer'>Class "+tripwire.systems[e].class+"</span>"),tripwire.systems[e].effect){var t='<table cellpadding="0" cellspacing="1">';for(var i in tripwire.effects[tripwire.systems[e].effect]){var r=tripwire.effects[tripwire.systems[e].effect][i].name,a=tripwire.effects[tripwire.systems[e].effect][i].base,n=tripwire.effects[tripwire.systems[e].effect][i].bad,c=tripwire.systems[e].class>6?6:tripwire.systems[e].class,l=0;switch(Math.abs(a)){case 15:l=a>0?7:-7;break;case 30:l=a>0?14:-14;break;case 60:l=a>0?28:-28}t+="<tr><td>"+r+'</td><td style="padding-left: 25px; text-align: right;" class="'+(n?"critical":"stable")+'">',t+=a+l*(c-1)+"%</td></tr>"}t+="</table>",$("#infoSecurity").append("&nbsp;<span class='pointer' data-tooltip='"+t+"'>"+tripwire.systems[e].effect+"</span>"),Tooltips.attach($("#infoSecurity [data-tooltip]"))}for(var i in tripwire.systems[e].statics){var p=tripwire.systems[e].statics[i],o=tripwire.wormholes[p],d="wh";switch(o.leadsTo){case"High-Sec":d="hisec";break;case"Low-Sec":d="lowsec";break;case"Null-Sec":d="nullsec"}$("#infoStatics").append("<div><span class='"+d+"'>&#9679;</span> <b>"+o.leadsTo+"</b> via <span class='"+d+"'>"+p+"</span></div>")}$("#infoFaction").html("&nbsp;")}else tripwire.systems[e].security>=.45?$("#infoSecurity").addClass("hisec").text("High-Sec "+tripwire.systems[e].security):tripwire.systems[e].security>0?$("#infoSecurity").addClass("lowsec").text("Low-Sec "+tripwire.systems[e].security):$("#infoSecurity").addClass("nullsec").text("Null-Sec "+tripwire.systems[e].security),$("#infoFaction").html(tripwire.systems[e].factionID?tripwire.factions[tripwire.systems[e].factionID].name:"&nbsp;");$("#infoRegion").text(tripwire.regions[tripwire.systems[e].regionID].name),$("#infoWidget .infoLink").each(function(){this.href=$(this).data("href").replace(/\$systemName/gi,tripwire.systems[e].name).replace(/\$systemID/gi,e)}),tripwire.signatures.undo[e]&&tripwire.signatures.undo[e].length>0?$("#undo").removeClass("disabled"):$("#undo").addClass("disabled"),tripwire.signatures.redo[e]&&tripwire.signatures.redo[e].length>0?$("#redo").removeClass("disabled"):$("#redo").addClass("disabled"),0==$("#sigTable tr.selected").length?$("#signaturesWidget #delete-signature").addClass("disabled"):$("#signaturesWidget #delete-signature").removeClass("disabled")},tripwire.systemChange(viewingSystemID,"init");
var tutorial;$("#infoWidget .tutorial").click(function(){tutorial=introJs().setOptions({showStepNumbers:!1,steps:[{element:document.querySelector("#infoWidget"),intro:"<h4>System information widget</h4><br/><p>Displays information on the currently <b>selected</b> Tripwire system.</p>"},{element:document.querySelector("#infoGeneral"),intro:"<p>This section includes:<br/>System Name<br/>Security Rating<br/>Region<br/>Owning Faction Name</p><br/><p>If the selected system is a wormhole with a system effect, that will also be shown - hover over it to view the effect breakdown.</p>"},{element:document.querySelector("#activityGraph"),intro:"<p>This is the graph containing historical ship jump and kill information from the EVE API.</p><br/><p>This data is only available for K-Space systems and not wormhole systems.</p><br/><p>The EVE API updates this data each hour, so this graph will update itself at the top of every hour.</p>"},{element:$("#activityGraph svg > g > g:nth-child(5)")[0],intro:"<p>Each category can be toggled by clicking these keys to drill down the graph into finer detail.</p>"},{element:document.querySelector("#activityGraphControls"),intro:"<p>Select different lengths of historical data to adjust the graph to display more or less information.</p>"},{element:document.querySelector("#infoStatics"),intro:"<p>If a wormhole system is selected, the publicaly known static wormholes will appear here.</p>"},{element:document.querySelector("#infoLinks"),intro:"<p>These are some quick links to various sites for this specific system.</p>"},{element:document.querySelector("#system-favorite"),intro:"<p>This toggles wether this is a 'favorite' system, orange is active.</p><br/><p>'Favorite' systems can be rendered in the chain map to be able to see how far away trade hub systems are from your wormhole chain K-Space exits.</p>"}]}).start()}),$("#signaturesWidget .tutorial").click(function(){tutorial=introJs().setOptions({showStepNumbers:!1,steps:[{element:document.querySelector("#signaturesWidget"),intro:"<h4>System signatures widget</h4><br/><p>Displays all signatures and wormholes in the currently <b>selected</b> Tripwire system.</p>"},{element:document.querySelector("#add-signature"),intro:"<p>Add new signatures and wormholes manually by clicking the + icon.</p><br/><p>Copy & Paste EVE scanner results anywhere once Tripwire has focus to add or update signatures, repeated pastes will only update with new information.</p>"},{element:document.querySelector("#delete-signature"),intro:"<p>Click here or use the keyboard shortcut <b>DELETE</b> to delete <b>selected</b> signatures from this system.</p><br/><p>Click on a row to select it, click multiple rows to delete multiple signatures at once, click a selected row again to unselect it.</p>"},{element:document.querySelector("#signature-count"),intro:"<p>This shows the current count of signatures, including wormholes, in the selected system.</p>"},{element:document.querySelector("#undo"),intro:"<p>Click here or use the keyboard shortcut <b>CTRL-Z</b> to undo the last changes you made in this sytem (this includes clipboard pasted changes).</p><br/><p>You can undo multiple times as history is kept in the browser.</p>"},{element:document.querySelector("#redo"),intro:"<p>Click here or use the keyboard shortcut <b>CTRL-Y</b> to redo the last changes you made in this system (this includes clipboard pasted changes).</p><br/><p>You can redo multiple times as history is kept in the browser.</p>"},{element:document.querySelector("#toggle-automapper"),intro:"<p>Click here to toggle the Auto-mapper feature on (orange) or off.</p><br/><p>This feature only works when an in-game character is being actively tracked, otherwise this icon appears disabled.</p><br/><p>The automapper will watch for a change in your in-game system not via a star gate and try to automatically add or update wormholes.</p><br/><p>First it tries to seach for wormholes already added but missing a leads to system, this includes via wormhole type (B274) or with a leads to of 'High-Sec' for example.</p><br/><p>Next it searches for wormholes without any type or leads to at all.</p><br/><p>Finally if there are no wormholes or they all have a leads to system already, it will add a new wormhole.</p><br/><p>If at any time if finds multiple wormholes it can update, a dialog window will appear asking which wormhole you want to update.</p>"},{element:document.querySelector("#sigTable"),intro:"<p>Each column can be sorted by clicking the column label, sort by multiple columns by holding the shift key.</p><br/><p>Right-click a column to change the text-alignment.</p>"}]}).start()}),$("#notesWidget .tutorial").click(function(t){t.preventDefault(),(tutorial=introJs().setOptions({showStepNumbers:!1,exitOnEsc:!1,exitOnOverlayClick:!1,skipLabel:"Abort",steps:[{element:document.querySelector("#notesWidget"),intro:"<h4>System notes widget</h4><br/><p>Displays comments based on the currently <b>selected</b> Tripwire system.</p><br/><p>The rest of this tutorial will guide you through actually adding a comment, but don't worry we will switch you to your private Tripwire mask so we don't disturb anyone else.</p><br/><p>When you finish or leave this tutorial we will switch you back to your previous Tripwire mask.</p>"},{element:document.querySelector("#add-comment"),intro:"<p>Now click the + icon to begin adding a new comment in this system ("+viewingSystem+").</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>Type some basic text now and click save.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>This is our newly created comment. Hover over the comment with your mouse to see additional information and controls.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>You can click the 'pin' or 'sticky' button to toggle showing this comment for every system, not just this system.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>Use the <b>Edit</b> to modify a comment and <b>Delete</b> to remove a comment.</p><br/><p>You can also quickly edit any comment by simply doubling clicking anywhere on it.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>Click on the <b>Edit</b> now on our comment.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>The toolbar at the top allows you to customize your notes.</p><br/><p>You can also click on the <b>Maximize/Minimize</b> button (the far right toolbar icon) to edit this comment in full screen mode.</p><br/><p>In full screen mode you will see 1 new button added to the toolbar to view the source code of the comment where you can write HTML, CSS, and even Javascript in your notes!</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>This concludes the tutorial, we will now switch you back to your previous Tripwire mask and delete the comment we created.</p>"}]}).start()).onchange(function(t){switch(tutorial._currentStep){case 1:$(".introjs-prevbutton, .introjs-nextbutton").hide(),console.log("switch mask to private"),tutorial.previousMask=options.masks.active,options.masks.active=options.character.id+".1",options.save(),tutorial.stepFunc=function(){setTimeout(function(){tutorial._options.steps[2].element=$("#notesWidget").find(".comment:has(.cke_toolbar)")[0],tutorial.setOption("steps",tutorial._options.steps),tutorial.exiting=!1,tutorial.exit().start().goToStep(3),tutorial.exiting=!0},200)},$("#notesWidget #add-comment").on("click",tutorial.stepFunc);break;case 2:$(".introjs-prevbutton, .introjs-nextbutton").hide(),$("#notesWidget #add-comment").off("click",tutorial.stepFunc),tutorial.stepFunc=function(){tutorial.comment=$(this).closest(".comment"),setTimeout(function(){tutorial._options.steps[3].element=tutorial.comment[0],tutorial._options.steps[4].element=tutorial.comment.find(".commentSticky")[0],tutorial._options.steps[5].element=tutorial.comment.find(".commentControls")[0],tutorial._options.steps[6].element=tutorial.comment.find(".commentControls")[0],tutorial.setOption("steps",tutorial._options.steps),tutorial.exiting=!1,tutorial.exit().start().goToStep(4),tutorial.exiting=!0},200)},$("#notesWidget").on("click",".commentSave",tutorial.stepFunc);break;case 6:$(".introjs-prevbutton, .introjs-nextbutton").hide(),$("#notesWidget").off("click",".commentSave",tutorial.stepFunc),tutorial.stepFunc=function(){setTimeout(function(){tutorial._options.steps[7].element=$("#notesWidget").find(".comment:has(.cke_toolbar)")[0],tutorial._options.steps[8].element=$("#notesWidget").find(".comment:has(.cke_toolbar)")[0],tutorial.setOption("steps",tutorial._options.steps),tutorial.exiting=!1,tutorial.exit().start().goToStep(8),tutorial.exiting=!0},200)},$("#notesWidget").on("click",".commentEdit",tutorial.stepFunc)}}),tutorial.onexit(function(){if(tutorial.exiting){if($(".commentCancel:visible").click(),tutorial.comment){var t={mode:"delete",commentID:tutorial.comment.data("id")};$.ajax({url:"comments.php",type:"POST",data:t,dataType:"JSON"}).done(function(t){t&&1==t.result&&tutorial.comment.remove()})}tutorial.previousMask&&setTimeout(function(){console.log("change mask back, delete comment",tutorial.previousMask),options.masks.active=tutorial.previousMask,options.save()},200),$("#notesWidget #add-comment").off("click",tutorial.stepFunc),$("#notesWidget").off("click",".commentSave",tutorial.stepFunc),$("#notesWidget").off("click",".commentEdit",tutorial.stepFunc),$("#notesWidget").off("click",".cke_toolgroup:has(.cke_button__toolbarswitch)",tutorial.stepFunc)}}),tutorial.previousMask,tutorial.comment,tutorial.stepFunc,tutorial.exiting=!0});
tripwire.undo=function(){if(tripwire.signatures.undo[viewingSystemID].length>0){$("#undo").addClass("disabled");var i=tripwire.signatures.undo[viewingSystemID].length-1,e={systemID:viewingSystemID,signatures:{add:[],remove:[],update:[]}},r=tripwire.signatures.undo[viewingSystemID][i],t=$.map(r.signatures,function(i){if(i.wormhole&&tripwire.client.wormholes[i.wormhole.id])return{wormhole:tripwire.client.wormholes[i.wormhole.id],signatures:[tripwire.client.signatures[i.signatures[0].id],tripwire.client.signatures[i.signatures[1].id]]};if(tripwire.client.signatures[i.id]&&"wormhole"==tripwire.client.signatures[i.id].type){var e=$.map(tripwire.client.wormholes,function(e){if(e.initialID==i.id||e.secondaryID==i.id)return e})[0];return{wormhole:e,signatures:[tripwire.client.signatures[e.initialID],tripwire.client.signatures[e.secondaryID]]}}return i.wormhole&&tripwire.client.signatures[i.signatures[0].id]?tripwire.client.signatures[i.signatures[0].id]:tripwire.client.signatures[i.id]});switch(r.action){case"add":e.signatures.remove=e.signatures.remove.concat($.map(r.signatures,function(i){return i.wormhole?i.wormhole:i.id}));break;case"remove":e.signatures.add=e.signatures.add.concat(r.signatures);break;case"update":e.signatures.update=e.signatures.update.concat(r.signatures)}tripwire.refresh("refresh",e,function(i){i.resultSet&&1==i.resultSet[0].result&&(tripwire.signatures.undo[viewingSystemID].pop(),$("#redo").removeClass("disabled"),viewingSystemID in tripwire.signatures.redo?"remove"==r.action?tripwire.signatures.redo[viewingSystemID].push({action:r.action,signatures:i.results}):"update"==r.action?tripwire.signatures.redo[viewingSystemID].push({action:r.action,signatures:t}):tripwire.signatures.redo[viewingSystemID].push({action:r.action,signatures:r.signatures}):"remove"==r.action?tripwire.signatures.redo[viewingSystemID]=[{action:r.action,signatures:i.results}]:"update"==r.action?tripwire.signatures.redo[viewingSystemID]=[{action:r.action,signatures:t}]:tripwire.signatures.redo[viewingSystemID]=[{action:r.action,signatures:r.signatures}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)),sessionStorage.setItem("tripwire_redo",JSON.stringify(tripwire.signatures.redo)))},function(i){tripwire.signatures.undo[viewingSystemID].length>0&&$("#undo").removeClass("disabled")})}};
var activity=new function(){this.graph,this.options,this.view,this.span=24,this.columns=[{id:"time",label:"Time",role:"domain",type:"string",calc:function(t,i){return t.getValue(i,0)+"h"}},{id:"jumps",label:"Jumps",role:"data",type:"number",sourceColumn:1,column:1,title:"Jumps"},{id:"podkills",label:"Pod Kills",role:"data",type:"number",sourceColumn:2,column:2,title:"Pod Kills"},{id:"shipkills",label:"Ship Kills",role:"data",type:"number",sourceColumn:3,column:3,title:"Ship Kills"},{id:"npckills",label:"NPC Kills",role:"data",type:"number",sourceColumn:4,column:4,title:"NPC Kills"}],this.getData=function(t,i){t=void 0!==t?t:this.span,i=void 0===i||i;return activity.graph?$.ajax({url:"activity_graph.php",data:{systemID:viewingSystemID,time:t},type:"GET",dataType:"JSON",cache:i}).done(function(t){t&&(t.rows.reverse(),activity.view=new google.visualization.DataView(new google.visualization.DataTable(t)),activity.view.setColumns(activity.columns),activity.graph.draw(activity.view,activity.options))}):(setTimeout(function(){activity.getData(t,i)},500),!1)},this.selectHandler=function(){var t=activity.graph.getSelection();if(t[0]&&null==t[0].row){var i=t[0].column;activity.columns[i].sourceColumn?(activity.columns[i].label=activity.columns[i].title+" (off)",delete activity.columns[i].sourceColumn):(activity.columns[i].sourceColumn=activity.columns[i].column,activity.columns[i].label=activity.columns[i].title),activity.view.setColumns(activity.columns),activity.options.animation.duration=0,activity.graph.draw(activity.view,activity.options),activity.options.animation.duration=500}},this.init=function(){activity.graph=new google.visualization.AreaChart(document.getElementById("activityGraph")),activity.options={isStacked:!1,backgroundColor:"transparent",hAxis:{textStyle:{color:"#999",fontName:"Verdana",fontSize:10},showTextEvery:3},vAxis:{textStyle:{color:"#666",fontName:"Verdana",fontSize:10},viewWindowMode:"maximized",viewWindow:{min:0},maxValue:5},gridlineColor:"#454545",pointSize:2,lineWidth:1,chartArea:{left:"10%",top:"5%",width:"88%",height:"85%"},legend:{position:"in",textStyle:{color:"#CCC",fontName:"Verdana",fontSize:8.5}},animation:{duration:500,easing:"inAndout"},tooltip:{showColorCode:!0},annotations:{style:"line",textStyle:{fontSize:12,color:"#ccc"},domain:0},focusTarget:"category"},google.visualization.events.addListener(activity.graph,"select",activity.selectHandler),activity.getData(activity.span)},this.time=function(t){switch(t){case 24:this.options.hAxis.showTextEvery=3;break;case 48:this.options.hAxis.showTextEvery=6;break;case 168:this.options.hAxis.showTextEvery=24}this.span=t,this.getData(t)},this.redraw=function(){this.graph.draw(this.view,this.options)},this.refresh=function(t){this.getData(this.span,t)},google.charts.setOnLoadCallback(this.init)};
var chain=new function(){this.map,this.view,this.options,this.drawing,this.data={},this.newView=function(i){return this.view=new google.visualization.DataView(new google.visualization.DataTable(i)),this.view},this.activity=function(i){return $("#chainMap .nodeActivity > span:not(.invisible)").addClass("invisible"),$("#chainMap [data-nodeid]").each(function(){var s=$(this).attr("data-nodeid");if(i[s]){var e=i[s].shipJumps,t=i[s].podKills,a=i[s].shipKills,n=i[s].npcKills,l=$(this).find(".nodeActivity");e>0&&l.find(".jumps").removeClass("invisible").attr("title",e+" Jumps"),t>0&&l.find(".pods").removeClass("invisible").attr("title",t+" Pod Kills"),a>0&&l.find(".ships").removeClass("invisible").attr("title",a+" Ship Kills"),n>0&&l.find(".npcs").removeClass("invisible").attr("title",n+" NPC Kills")}}),$("#chainMap .nodeActivity > span[title]").jBox("Tooltip",{position:{y:"bottom"}}),i},this.occupied=function(i){for(var s in $("#chainMap [data-icon='user'], #chainMap [data-icon='user'] + .badge").addClass("invisible"),i)$("#chainMap [data-nodeid='"+i[s].systemID+"'] [data-icon='user']").removeClass("invisible"),$("#chainMap [data-nodeid='"+i[s].systemID+"'] [data-icon='user'] + .badge").removeClass("invisible").html(i[s].count);return OccupiedToolTips.attach($("#chainMap [data-icon='user']:not(.invisible)")),i},this.flares=function(i){if($("#chainMap td.node").removeClass("redNode yellowNode greenNode"),$("#chainGrid tr").removeClass("red yellow green"),i)for(var s in i.flares){var e=i.flares[s].systemID,t=i.flares[s].flare,a=($("#chainMap [data-nodeid="+e+"]").parent().addClass(t+"Node").parent().index()-1)/3*2;a>0&&$("#chainGrid tr:eq("+a+")").addClass(t).next().addClass(t)}return i},this.grid=function(){if(0==options.chain.gridlines)return $("#chainGrid tr").addClass("hidden"),!1;$("#chainGrid tr").removeClass("hidden");var i=Math.max(0,2*$(".google-visualization-orgchart-table tr:has(.node)").length-1);$("#chainGrid tr:gt("+i+")").addClass("hidden")},this.lines=function(i){function s(s,e,t,a){var n=$("#chainMap #node"+s).parent();if(0==n.length)return!1;var l=Math.ceil((n[0].cellIndex+1)/2-1),r=$(n.parent().prev().children("td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright")[l]).addClass("left-"+t+" right-"+t),c=$("#chainMap #node"+e).parent();if(0==c.length||0==r.length)return!1;var d=0,p=r[0].cellIndex;n.parent().prev().find("td").each(function(i){if(d+=this.colSpan,i==p)return!1});for(var h=Math.ceil((c[0].cellIndex+1)/2-1),o=h,m=0;m<=h;m++){var y=0;n.parent().prev().prev().prev().find("td > [data-nodeid]").each(function(i){if(i==m)return y=$(this).attr("id").replace("node",""),!1}),$.map(i.map.rows,function(i){return i.c[1].v==y?i:null}).length<=0&&o--}h=o;var v=$(n.parent().prev().prev().children("td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright")[h]).addClass("left-"+t+" right-"+t),u=0,w=(e=!1,!1);n.parent().prev().prev().find("td").each(function(i,s){if(u+=this.colSpan,w&&e)return!1;if(void 0!==v[0]&&v[0].cellIndex==i){if(e=!0,$(this).addClass("left-"+t),w||u==d||$(this).addClass("bottom-"+t),d==u)return!1}else if(u==d)w=!0,$(this).addClass("bottom-"+t);else if(w||e){var a=0,l=!1,r=!1;if(n.parent().prev().find("td").each(function(i){if((a+=this.colSpan)==u&&($(this).hasClass("google-visualization-orgchart-lineleft")||$(this).hasClass("google-visualization-orgchart-lineright"))){if(0==e)return l=!0,v.removeClass("left-"+t+" right-"+t),!1;1==e&&(v.removeClass("left-"+t+" right-"+t),n.parent().prev().prev().find("td").each(function(i){i>=v[0].cellIndex&&$(this).removeClass("bottom-"+t)}),r=!0)}}),l)return!1;r||$(this).addClass("bottom-"+t)}})}for(var e in i.lines)s(i.lines[e][0],i.lines[e][1],i.lines[e][2],i.lines[e][3])},this.nodes=function(i){var s={cols:[{label:"System",type:"string"},{label:"Parent",type:"string"}],rows:[]},e=["Q003","E004","L005","Z006","M001","C008","G008","A009","SML","MED","LRG","XLG"],t=[];function a(i,s){if(!i||!tripwire.systems[i])return!1;var e;tripwire.systems[i].class?e="<span class='wh'>C"+tripwire.systems[i].class+"</span>":tripwire.systems[i].security>=.45?e="<span class='hisec'>HS</span>":tripwire.systems[i].security>0?e="<span class='lowsec'>LS</span>":tripwire.systems[i].security<=0&&(e="<span class='nullsec'>NS</span>");var t=null,a=null;if(tripwire.systems[i].class){switch(tripwire.systems[i].effect){case"Black Hole":t="blackhole";break;case"Cataclysmic Variable":t="cataclysmic-variable";break;case"Magnetar":t="magnetar";break;case"Pulsar":t="pulsar";break;case"Red Giant":t="red-giant";break;case"Wolf-Rayet Star":t="wolf-rayet"}a=tripwire.systems[i].effect}var n={v:s},l="<div id='node"+s+"' data-nodeid='"+i+"'><div class='nodeIcons'><div style='float: left;'><i class='whEffect' "+(t?"data-icon='"+t+"' data-tooltip='"+a+"'":null)+"></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'>"+e+"</h4><h4 class='nodeSystem'><a href='.?system="+tripwire.systems[i].name+"'>"+(options.chain.tabs[options.chain.active]&&0!=options.chain.tabs[options.chain.active].systemID?options.chain.tabs[options.chain.active].name:tripwire.systems[i].name)+"</a></h4><h4 class='nodeType'>&nbsp;</h4><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>";return n.f=l,n}function n(i){if(i[0]<=0)return!1;var s=parseInt(i[1]),e=r.length;for(var t in c){var a=c[t];if("secondary"==a.parent)var n=tripwire.client.signatures[a.secondaryID],l=tripwire.client.signatures[a.initialID];else n=tripwire.client.signatures[a.initialID],l=tripwire.client.signatures[a.secondaryID];if(-1==$.inArray(a.id,p))if(n.systemID==i[0]){if((o={}).id=a.id,o.life=a.life,o.mass=a.mass,o.time=n.modifiedTime,o.parent={},o.parent.id=s,o.parent.systemID=n.systemID,o.parent.name=n.name,o.parent.type="K162",o.parent.typeBM=null,o.parent.classBM=null,o.parent.nth=null,o.parent.signatureID=l.signatureID,o.child={},o.child.id=++e,o.child.systemID=l.systemID,o.child.name=l.name,o.child.type=a.type,o.child.typeBM=null,o.child.classBM=null,o.child.nth=null,o.child.signatureID=n.signatureID,d.push(o),r.push([o.child.systemID,o.child.id,i[2]]),p.push(o.id),$("#show-viewing").hasClass("active")&&tripwire.systems[o.child.systemID]&&!tripwire.systems[viewingSystemID].class&&!tripwire.systems[o.child.systemID].class){var h=guidance.findShortestPath(tripwire.map.shortest,[viewingSystemID-3e7,o.child.systemID-3e7]).length-1;(m={life:"Gate",parent:{}}).parent.id=o.child.id,m.parent.systemID=o.child.systemID,m.parent.name=o.child.name,m.parent.type=o.child.type,m.parent.nth=o.child.nth,m.child={},m.child.id=++e,m.child.systemID=viewingSystemID,m.child.name=tripwire.systems[viewingSystemID].name,m.child.type=h,m.child.nth=null,m.child.signatureID=h,d.push(m),r.push([0,e])}if($("#show-favorite").hasClass("active")&&tripwire.systems[o.child.systemID])for(t in options.favorites)if(!(tripwire.systems[options.favorites[t]].regionID>=11e6||tripwire.systems[o.child.systemID].regionID>=11e6)){h=guidance.findShortestPath(tripwire.map.shortest,[options.favorites[t]-3e7,o.child.systemID-3e7]).length-1;(m={life:"Gate",parent:{}}).parent.id=o.child.id,m.parent.systemID=o.child.systemID,m.parent.name=o.child.name,m.parent.type=o.child.type,m.parent.nth=o.child.nth,m.child={},m.child.id=++e,m.child.systemID=options.favorites[t],m.child.name=tripwire.systems[options.favorites[t]].name,m.child.type=h,m.child.nth=null,m.child.signatureID=h,d.push(m),r.push([0,e])}}else if(l.systemID==i[0]){var o;if((o={}).id=a.id,o.life=a.life,o.mass=a.mass,o.time=a.modifiedTime,o.parent={},o.parent.id=s,o.parent.systemID=l.systemID,o.parent.name=l.name,o.parent.type=a.type,o.parent.typeBM=null,o.parent.classBM=null,o.parent.nth=null,o.parent.signatureID=n.signatureID,o.child={},o.child.id=++e,o.child.systemID=n.systemID,o.child.name=n.name,o.child.type="K162",o.child.typeBM=null,o.child.classBM=null,o.child.nth=null,o.child.signatureID=l.signatureID,d.push(o),r.push([o.child.systemID,o.child.id,i[2]]),p.push(o.id),$("#show-viewing").hasClass("active")&&tripwire.systems[o.child.systemID]&&!tripwire.systems[viewingSystemID].class&&!tripwire.systems[o.child.systemID].class){h=guidance.findShortestPath(tripwire.map.shortest,[viewingSystemID-3e7,o.child.systemID-3e7]).length-1;(m={life:"Gate",parent:{}}).parent.id=o.child.id,m.parent.systemID=o.child.systemID,m.parent.name=o.child.name,m.parent.type=o.child.type,m.parent.nth=o.child.nth,m.child={},m.child.id=++e,m.child.systemID=viewingSystemID,m.child.name=tripwire.systems[viewingSystemID].name,m.child.type=h,m.child.nth=null,m.child.signatureID=h,d.push(m),r.push([0,e])}if($("#show-favorite").hasClass("active")&&tripwire.systems[o.child.systemID])for(t in options.favorites)if(!(tripwire.systems[options.favorites[t]].regionID>=11e6||tripwire.systems[o.child.systemID].regionID>=11e6)){var m;h=guidance.findShortestPath(tripwire.map.shortest,[options.favorites[t]-3e7,o.child.systemID-3e7]).length-1;(m={life:"Gate",parent:{}}).parent.id=o.child.id,m.parent.systemID=o.child.systemID,m.parent.name=o.child.name,m.parent.type=o.child.type,m.parent.nth=o.child.nth,m.child={},m.child.id=++e,m.child.systemID=options.favorites[t],m.child.name=tripwire.systems[options.favorites[t]].name,m.child.type=h,m.child.nth=null,m.child.signatureID=h,d.push(m),r.push([0,e])}}}}if($("#chainTabs .current").length>0){var l=$("#chainTabs .current .name").data("tab").toString().split(","),r=[],c=i,d=[],p=[];if(0==l){var h=0;for(var o in i){var m=tripwire.client.signatures[i[o].initialID],y=tripwire.client.signatures[i[o].secondaryID];void 0===tripwire.systems[m.systemID].class?(h++,s.rows.push({c:[a(m.systemID,h),{v:null}]}),r.push([m.systemID,h,m.systemID])):tripwire.systems[y.systemID]&&void 0===tripwire.systems[y.systemID].class&&(h++,s.rows.push({c:[a(y.systemID,h),{v:null}]}),r.push([y.systemID,h,y.systemID]))}}else for(var o in l)s.rows.push({c:[a(l[o],parseInt(o)+1),{v:null}]}),r.push([l[o],parseInt(o)+1,l[o]]);for(h=0;h<r.length;h++)n(r[h])}else{$("#chainError").hide();var v={c:[]},u=viewingSystemID;v.c.push(a(u,1),{v:null}),s.rows.push(v);for(r=[[u,1]],c=i,d=[],p=[],h=0;h<r.length;++h)n(r[h])}for(var o in d){var w,f=d[o],g=(v={c:[]},tripwire.systems[f.child.systemID]?tripwire.systems[f.child.systemID].class:null),I=tripwire.systems[f.child.systemID]?tripwire.systems[f.child.systemID].security:null;w=6==g||"Class-6"==tripwire.aSigSystems[f.child.systemID]||void 0!==tripwire.wormholes[f.child.type]&&"Class 6"==tripwire.wormholes[f.child.type].leadsTo?"<span class='wh'>C6</span>":5==g||"Class-5"==tripwire.aSigSystems[f.child.systemID]||void 0!==tripwire.wormholes[f.child.type]&&"Class 5"==tripwire.wormholes[f.child.type].leadsTo?"<span class='wh'>C5</span>":4==g||"Class-4"==tripwire.aSigSystems[f.child.systemID]||void 0!==tripwire.wormholes[f.child.type]&&"Class 4"==tripwire.wormholes[f.child.type].leadsTo?"<span class='wh'>C4</span>":3==g||"Class-3"==tripwire.aSigSystems[f.child.systemID]||void 0!==tripwire.wormholes[f.child.type]&&"Class 3"==tripwire.wormholes[f.child.type].leadsTo?"<span class='wh'>C3</span>":2==g||"Class-2"==tripwire.aSigSystems[f.child.systemID]||void 0!==tripwire.wormholes[f.child.type]&&"Class 2"==tripwire.wormholes[f.child.type].leadsTo?"<span class='wh'>C2</span>":1==g||"Class-1"==tripwire.aSigSystems[f.child.systemID]||void 0!==tripwire.wormholes[f.child.type]&&"Class 1"==tripwire.wormholes[f.child.type].leadsTo?"<span class='wh'>C1</span>":g>6?"<span class='wh'>C"+g+"</span>":void 0!==tripwire.wormholes[f.child.type]&&tripwire.wormholes[f.child.type].leadsTo.split(" ").length>1?"<span class='wh'>C"+tripwire.wormholes[f.child.type].leadsTo.split(" ")[1]+"</span>":I>=.45||"High-Sec"==tripwire.aSigSystems[f.child.systemID]||void 0!==tripwire.wormholes[f.child.type]&&"High-Sec"==tripwire.wormholes[f.child.type].leadsTo&&!I?"<span class='hisec'>HS</span>":I>0||"Low-Sec"==tripwire.aSigSystems[f.child.systemID]||void 0!==tripwire.wormholes[f.child.type]&&"Low-Sec"==tripwire.wormholes[f.child.type].leadsTo&&!I?"<span class='lowsec'>LS</span>":I<=0&&null!=I||"Null-Sec"==tripwire.aSigSystems[f.child.systemID]||void 0!==tripwire.wormholes[f.child.type]&&"Null-Sec"==tripwire.wormholes[f.child.type].leadsTo?"<span class='nullsec'>NS</span>":"<span>&nbsp;</span>";var D=null,b=null;if(void 0!==tripwire.systems[f.child.systemID]){switch(tripwire.systems[f.child.systemID].effect){case"Black Hole":D="blackhole";break;case"Cataclysmic Variable":D="cataclysmic-variable";break;case"Magnetar":D="magnetar";break;case"Pulsar":D="pulsar";break;case"Red Giant":D="red-giant";break;case"Wolf-Rayet Star":D="wolf-rayet";break;default:D=null}b=tripwire.systems[f.child.systemID].effect}y={v:f.child.id};var C="<div id='node"+f.child.id+"' data-nodeid='"+f.child.systemID+"' data-sigid='"+f.id+"'><div class='nodeIcons'><div style='float: left;'><i class='whEffect' "+(D?"data-icon='"+D+"' data-tooltip='"+b+"'":null)+"></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'>"+(w+sigFormat(f.child.classBM,"class"))+"</h4><h4 class='nodeSystem'>"+(tripwire.systems[f.child.systemID]?"<a href='.?system="+tripwire.systems[f.child.systemID].name+"'>"+(f.parent.name?f.parent.name:tripwire.systems[f.child.systemID].name)+"</a>":f.parent.name?f.parent.name:"<a class='invisible'>system</a>")+"</h4><h4 class='nodeType'>"+("id"==options.chain["node-reference"]?f.child.signatureID?f.child.signatureID.substring(0,3):"&nbsp;":(f.child.type||"&nbsp;")+sigFormat(f.child.typeBM,"type")||"&nbsp;")+"</h4><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>";y.f=C;m={v:f.parent.id};v.c.push(y,m),s.rows.push(v),"critical"!=f.life||-1==$.inArray(f.parent.type,e)&&-1==$.inArray(f.child.type,e)?"critical"==f.life&&"critical"==f.mass?t.push(Array(y.v,m.v,"eol-critical",f.id)):"critical"==f.life&&"destab"==f.mass?t.push(Array(y.v,m.v,"eol-destab",f.id)):-1!=$.inArray(f.parent.type,e)||-1!=$.inArray(f.child.type,e)?t.push(Array(y.v,m.v,"frig",f.id)):"critical"==f.life?t.push(Array(y.v,m.v,"eol",f.id)):"critical"==f.mass?t.push(Array(y.v,m.v,"critical",f.id)):"destab"==f.mass?t.push(Array(y.v,m.v,"destab",f.id)):"Gate"!=f.life&&"GATE"!=f.parent.type&&"GATE"!=f.child.type||t.push(Array(y.v,m.v,"gate",f.id)):t.push(Array(y.v,m.v,"eol-frig",f.id))}return t.reverse(),{map:s,lines:t}},this.redraw=function(){var i=$.extend(!0,{},this.data);i.map=$.extend(!0,{},i.rawMap),this.draw(i)},this.draw=function(i){i=void 0!==i?i:{};if(!this.map||Object.size(i.map)&&!tripwire.client.signatures)setTimeout(()=>chain.draw(i),100);else{if(i.map){if(this.drawing=!0,this.data.rawMap=$.extend(!0,{},i.map),Object.sort(i.map,"id"),$.extend(i,this.nodes(i.map)),$.extend(this.data,i),this.map.draw(this.newView(i.map),this.options),options.chain.tabs[options.chain.active])for(var s in options.chain.tabs[options.chain.active].collapsed){var e=$("#chainMap [data-nodeid='"+options.chain.tabs[options.chain.active].collapsed[s]+"']").attr("id");e&&(e=e.split("node")[1],this.map.collapse(e-1,!0))}this.lines(i),this.grid(),$("#chainMap [data-nodeid='"+viewingSystemID+"']").parent().addClass("currentNode"),WormholeTypeToolTips.attach($("#chainMap .whEffect")),this.drawing=!1}!this.data.activity||new Date>this.data.activity.expires?(i.activity={},tripwire.esi.universeJumps().done(function(s,e,t){i.activity.expires=new Date(t.getResponseHeader("expires")),$.each(s,function(e){i.activity[s[e].system_id]={systemID:s[e].system_id,shipJumps:s[e].ship_jumps}})}).then(function(){return tripwire.esi.universeKills().done(function(s){$.each(s,function(e){i.activity[s[e].system_id]?(i.activity[s[e].system_id].podKills=s[e].pod_kills,i.activity[s[e].system_id].shipKills=s[e].ship_kills,i.activity[s[e].system_id].npcKills=s[e].npc_kills):i.activity[s[e].system_id]={systemID:s[e].system_id,podKills:s[e].pod_kills,shipKills:s[e].ship_kills,npcKills:s[e].npc_kills}})})}).then(function(){chain.data.activity=chain.activity(i.activity)})):i.map&&chain.activity(this.data.activity),i.occupied&&(this.data.occupied=this.occupied(i.occupied)),i.flares&&(this.data.flares=this.flares(i.flares))}},this.collapse=function(i){if(chain.drawing)return!1;var s=chain.map.getCollapsedNodes();for(x in options.chain.tabs[options.chain.active].collapsed=[],s){var e=$("#chainMap #node"+(s[x]+1)).data("nodeid");options.chain.tabs[options.chain.active].collapsed.push(e)}chain.lines(chain.data),$("#chainMap [data-nodeid='"+viewingSystemID+"']").parent().addClass("currentNode"),WormholeTypeToolTips.attach($("#chainMap .whEffect")),chain.activity(chain.data.activity),chain.occupied(chain.data.occupied),chain.flares(chain.data.flares),chain.grid(),options.save()},this.init=function(){chain.map=new google.visualization.OrgChart(document.getElementById("chainMap")),chain.options={allowHtml:!0,allowCollapse:!0,size:"medium",nodeClass:"node"},google.visualization.events.addListener(chain.map,"collapse",chain.collapse),chain.map.draw(new google.visualization.DataView(new google.visualization.DataTable({cols:[{label:"System",type:"string"},{label:"Parent",type:"string"}]})),this.options)},google.charts.setOnLoadCallback(this.init)};
var CKConfig={skin:"custom",height:100,allowedContent:!0,extraPlugins:"toolbarswitch,autogrow,autolink",enterMode:CKEDITOR.ENTER_BR,removeDialogTabs:"link:advanced",autoGrow_onStartup:!0,autoGrow_minHeight:100,toolbar_minToolbar:[{name:"basicstyles",items:["Bold","Italic","Underline","Strike"]},{name:"paragraph",items:["BulletedList","Outdent","Indent"]},{name:"links",items:["Link"]},{name:"colors",items:["TextColor","BGColor"]},{name:"styles",items:["FontSize"]},{name:"tools",items:["Toolbarswitch"]}],toolbar_maxToolbar:[{name:"basicstyles",items:["Bold","Italic","Underline","Strike","Subscript","Superscript"]},{name:"paragraph",items:["NumberedList","BulletedList","Outdent","Indent"]},{name:"links",items:["Link"]},{name:"colors",items:["TextColor","BGColor"]},{name:"styles",items:["FontSize","Font"]},{name:"tools",items:["Source","Toolbarswitch"]}],toolbar:"minToolbar",smallToolbar:"minToolbar",maximizedToolbar:"maxToolbar",fontSize_style:{element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]}};CKEDITOR.on("instanceLoaded",function(e){e.editor.on("contentDom",function(){e.editor.on("key",function(t){return 27==t.data.keyCode?($(e.editor.element.$).closest(".comment").find(".commentCancel").click(),!1):t.data.domEvent.$.altKey&&83==t.data.domEvent.$.keyCode?($(e.editor.element.$).closest(".comment").find(".commentSave").click(),!1):void 0})}),$(".cke_combo__font a").removeClass("cke_combo_button").addClass("cke_button cke_button_off").html('<span class="cke_button_icon">&nbsp;</span>'),$(".cke_combo__fontsize a").removeClass("cke_combo_button").addClass("cke_button cke_button_off").html('<span class="cke_button_icon">&nbsp;</span>')}),CKEDITOR.on("instanceReady",function(e){e.editor.focus();var t=e.editor.getSelection(),o=t.getRanges(),n=o[0].startContainer,a=n.getParents(!0);if(!(n=a[a.length-2].getFirst()))return!1;for(;;){var i=n.getNext();if(null==i)break;n=i}t.selectElement(n),(o=t.getRanges())[0].collapse(!1),t.selectRanges(o)}),CKEDITOR.on("dialogDefinition",function(e){"link"==e.data.name&&(e.data.definition.getContents("target").get("linkTargetType").default="_blank")});
$("body").on("dblclick",".comment",function(e){e.preventDefault(),document.getSelection().removeAllRanges(),$(this).find(".commentEdit").click()}),$("body").on("click",".commentEdit",function(e){if(e.preventDefault(),$(".cke").length)return!1;var t=$(this).closest(".comment");t.find(".commentToolbar").hide(),CKEDITOR.replace(t.find(".commentBody").attr("id"),CKConfig).on("instanceReady",function(){t.find(".commentStatus").html(""),t.find(".commentFooter").show(),t.find(".commentFooter .commentControls").show()}),tripwire.activity.editComment=t.data("id"),tripwire.refresh("refresh")}),$("body").on("click",".commentSave, .commentCancel",function(e){e.preventDefault();var t=$(this);if(t.attr("disabled"))return!1;var o=t.closest(".comment");if(t.attr("disabled","true"),t.hasClass("commentSave")){var n={mode:"save",commentID:o.data("id"),systemID:o.find(".commentSticky").hasClass("active")?0:viewingSystemID,comment:CKEDITOR.instances[o.find(".commentBody").attr("id")].getData()};$.ajax({url:"comments.php",type:"POST",data:n,dataType:"JSON"}).done(function(e){e&&1==e.result&&(o.find(".commentModified").html("Edited by "+e.comment.modifiedByName+" at "+e.comment.modifiedDate),o.find(".commentCreated").html("Posted by "+e.comment.createdByName+" at "+e.comment.createdDate),Tooltips.attach(o.find("[data-tooltip]")),CKEDITOR.instances[o.find(".commentBody").attr("id")].destroy(!1),o.attr("data-id",e.comment.id),o.find(".commentToolbar").show(),o.find(".commentFooter").hide(),t.removeAttr("disabled"))})}else CKEDITOR.instances[o.find(".commentBody").attr("id")].destroy(!0),o.attr("data-id")?(o.find(".commentToolbar").show(),o.find(".commentFooter").hide(),t.removeAttr("disabled")):o.remove();o.find(".commentStatus").html(""),delete tripwire.activity.editComment,tripwire.refresh("refresh")}),$("body").on("click",".commentDelete",function(e){e.preventDefault();var t=$(this).closest(".comment");$("#dialog-deleteComment").hasClass("ui-dialog-content")?$("#dialog-deleteComment").dialog("isOpen")||$("#dialog-deleteComment").data("comment",t).dialog("open"):$("#dialog-deleteComment").data("comment",t).dialog({resizable:!1,minHeight:0,position:{my:"center",at:"center",of:$("#notesWidget")},dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{Delete:function(){$("#dialog-deleteComment").parent().find(":button:contains('Delete')").button("disable");var e=$(this).data("comment"),t={mode:"delete",commentID:e.data("id")};$.ajax({url:"comments.php",type:"POST",data:t,dataType:"JSON"}).done(function(t){t&&1==t.result&&($("#dialog-deleteComment").dialog("close"),e.remove())}).always(function(){$("#dialog-deleteComment").parent().find(":button:contains('Delete')").button("enable")})},Cancel:function(){$(this).dialog("close")}}})}),$("body").on("click","#add-comment",function(e){if(e.preventDefault(),$(".cke").length)return!1;var t=$(".comment:last").clone(),o=$(".comment:visible:last .commentBody").attr("id")?$(".comment:visible:last .commentBody").attr("id").replace("comment","")+1:0;$(".comment:last").before(t),t.find(".commentBody").attr("id","comment"+o),t.removeClass("hidden").find(".commentEdit").click()}),$("body").on("click",".commentSticky",function(e){e.preventDefault();var t=$(this).closest(".comment"),o={mode:"sticky",commentID:t.data("id"),systemID:t.find(".commentSticky").hasClass("active")?viewingSystemID:0};$.ajax({url:"comments.php",type:"POST",data:o,dataType:"JSON"}).done(function(e){e&&1==e.result&&(t.find(".commentSticky").hasClass("active")?t.find(".commentSticky").removeClass("active"):t.find(".commentSticky").addClass("active"))})});
var guidance=function(t){var r=function(t){var r=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&r.push(n);return r},n=function(t,r){return parseFloat(t)-parseFloat(r)},e=function(t,e,o,a){a=a||1/0;var i,c={},u={0:[e]},p={},l=function(t,r){var n=""+t;u[n]||(u[n]=[]),u[n].push(r)};for(c[e]=0;u&&(i=r(u)).length;){i.sort(n);var h=i[0],f=u[h],s=f.shift(),v=parseFloat(h),y=t[s]||{};for(var g in f.length||delete u[h],y)if(Object.prototype.hasOwnProperty.call(y,g)){var d=y[g]+v,b=c[g];(void 0===b||b>d)&&(c[g]=d,l(d,g),p[g]=s)}}return void 0===c[o]?null:p},o=function(t,r){for(var n=[],e=r;e;)n.push(e),predecessor=t[e],e=t[e];return n.reverse(),n},a=function(t,r){for(var n,a,i,c=r.shift(),u=[];r.length;){if(n=r.shift(),!(a=e(t,c,n)))return null;if(i=o(a,n),!r.length)return u.concat(i);u.push.apply(u,i.slice(0,-1)),c=n}},i=function(t,r){try{return Array.prototype.slice.call(t,r)}catch(a){for(var n=[],e=r||0,o=t.length;e<o;++e)n.push(t[e]);return n}},c=function(t){this.map=t};return c.prototype.findShortestPath=function(t,r){return"[object Array]"===Object.prototype.toString.call(t)?a(this.map,t):2===arguments.length?a(this.map,[t,r]):a(this.map,i(arguments))},c.findShortestPath=function(t,r,n){return"[object Array]"===Object.prototype.toString.call(r)?a(t,r):3===arguments.length?a(t,[r,n]):a(t,i(arguments,1))},c}();
$("#admin").click(function(a){if(a.preventDefault(),$(this).hasClass("disabled"))return!1;if($("#dialog-admin").hasClass("ui-dialog-content"))$("#dialog-admin").dialog("isOpen")||$("#dialog-admin").dialog("open");else{var i=null,d=null,t=null;function o(){t&&t.abort(),d.html("Total: "+$("#dialog-admin .window .hasFocus table tr[data-id]").length),t=$.ajax({url:"admin.php",type:"POST",data:{mode:$("#dialog-admin .menu .active").attr("data-window")},dataType:"JSON"}).done(function(a){if(a&&a.results){for(var i=a.results,t=[],o=0,e=i.length;o<e;o++){var n=$("#dialog-admin .window .hasFocus tbody tr[data-id='"+i[o].id+"']");if(t.push(i[o].id),n.length)for(col in i[o]){(l=n.find("[data-col='"+col+"']")).html(("number"==l.attr("data-format")?numFormat(i[o][col]):i[o][col])||"&nbsp;")}else{for(col in(n=$("#dialog-admin .window .hasFocus table tr.hidden").clone()).attr("data-id",i[o].id),i[o]){var l;(l=n.find("[data-col='"+col+"']")).html(("number"==l.attr("data-format")?numFormat(i[o][col]):i[o][col])||"&nbsp;")}n.removeClass("hidden"),$("#dialog-admin .window .hasFocus tbody").append(n)}}$("#dialog-admin .window .hasFocus table tr[data-id]").each(function(){-1==$.inArray($(this).data("id").toString(),t)&&$(this).remove()}),$("#dialog-admin .window .hasFocus table").trigger("update",[!0])}else $("#dialog-admin .window .hasFocus table tr[data-id]").remove();d.html("Total: "+$("#dialog-admin .window .hasFocus table tr[data-id]").length)}),$("#dialog-admin").dialog("isOpen")&&$("#dialog-admin .menu .active").attr("data-refresh")&&(i=setTimeout(o,$("#dialog-admin .menu .active").attr("data-refresh")))}$("#dialog-admin").dialog({autoOpen:!0,modal:!0,height:350,width:800,buttons:{Close:function(){$(this).dialog("close")}},create:function(){$("#dialog-admin").on("click",".menu li",function(a){a.preventDefault(),$menuItem=$(this),clearTimeout(i),$("#dialog-admin .menu .active").removeClass("active"),$menuItem.addClass("active"),$("div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane").html(""),$("#dialog-admin .window [data-window]").removeClass("hasFocus").hide(),$("#dialog-admin .window [data-window='"+$menuItem.data("window")+"']").addClass("hasFocus").show(),o()}),$("#dialog-admin [data-sortable='true']").tablesorter({sortReset:!0,widgets:["saveSort"],sortList:[[0,0]]}),$($(this)[0].parentElement).find(".ui-dialog-buttonpane").append("<div class='ui-dialog-traypane'></div>"),d=$("div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane")},open:function(){$menuItem=$("#dialog-admin .menu li.active"),o()},close:function(){clearTimeout(i)}})}});
$("#wrapper").addClass("transition"),$(document).on("dialogopen",".ui-dialog",function(i,e){2==$(".ui-dialog:visible").length&&$(this).hasClass("dialog-modal")?$("body").append($("<div id='overlay' class='overlay' />").css("z-index",$(this).css("z-index")-1)):$("#overlay")&&$("#overlay").css("z-index",$(this).css("z-index")-1),$(this).hasClass("dialog-noeffect")||$("#wrapper").addClass("blur")}),$(document).on("dialogclose",".ui-dialog",function(i,e){$(".ui-dialog").is(":visible")||$("#wrapper").removeClass("blur"),1==$(".ui-dialog:visible").length?$("#overlay").remove():$("#overlay")&&$("#overlay").css("z-index",$(this).css("z-index")-2)}),$(document).on("click","#overwrite",function(){var i={signatures:{remove:[]},systemID:viewingSystemID},e=[],s=tripwire.client.signatures[$(this).data("id")];if("wormhole"!=s.type)e.push(s),i.signatures.remove.push(s.id);else{var t=$.map(tripwire.client.wormholes,function(i){if(i.initialID==s.id||i.secondaryID==s.id)return i})[0];e.push({wormhole:t,signatures:[tripwire.client.signatures[t.initialID],tripwire.client.signatures[t.secondaryID]]}),i.signatures.remove.push(t)}$("#overwrite").attr("disable",!0);tripwire.refresh("refresh",i,function(i){i.resultSet&&1==i.resultSet[0].result&&(ValidationTooltips.close(),$("#undo").removeClass("disabled"),viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"remove",signatures:e}):tripwire.signatures.undo[viewingSystemID]=[{action:"remove",signatures:e}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)),$("#dialog-signature").parent().find(":button:contains('Save')")?$("#dialog-signature").parent().find(":button:contains('Save')").click():$("#dialog-signature").parent().find(":button:contains('Add')").click())},function(){$("#overwrite").removeAttr("disable")})});
$(".options").click(function(e){if(e.preventDefault(),$(this).hasClass("disabled"))return!1;$("#dialog-options").dialog({autoOpen:!1,width:450,minHeight:400,modal:!0,buttons:{Save:function(){JSON.stringify(options);var e=!1;$("#dialog-options").parent().find(".ui-dialog-buttonpane button:contains('Save')").attr("disabled",!0).addClass("ui-state-disabled"),options.chain.typeFormat=$("#dialog-options #typeFormat").val(),options.chain.classFormat=$("#dialog-options #classFormat").val(),options.chain.gridlines=JSON.parse($("#dialog-options input[name=gridlines]:checked").val()),options.chain["node-reference"]=$("#dialog-options input[name=node-reference]:checked").val(),options.signatures.pasteLife=$("#dialog-options #pasteLife").val(),options.background=$("#dialog-options #background-image").val(),options.uiscale=$("#dialog-options #uiscale-slider").slider("value"),options.masks.active!=$("#dialog-options input[name='mask']:checked").val()&&(e=!0),options.masks.active=$("#dialog-options input[name='mask']:checked").val(),options.apply(),options.save().done(function(){e&&($("#sigTable span[data-age]").countdown("destroy"),$("#sigTable tbody").empty(),$("#signature-count").html(0),tripwire.signatures.list={},tripwire.client.signatures=[],tripwire.refresh("change"))}),$("#dialog-options").dialog("close"),$("#dialog-options").parent().find(".ui-dialog-buttonpane button:contains('Save')").attr("disabled",!1).removeClass("ui-state-disabled"),$("#dialog-options input[name='mask']:checked").data("admin")?$("#admin").removeClass("disabled"):$("#admin").addClass("disabled")},Reset:function(){$("#dialog-confirm #msg").html("Settings will be reset to defaults temporarily.<br/><br/><p><em>Save settings to make changes permanent.</em></p>"),$("#dialog-confirm").dialog("option",{buttons:{Reset:function(){options.reset(),options.apply(),$("#dialog-options").dialog("close"),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}).dialog("open")},Close:function(){$(this).dialog("close")}},open:function(){$.ajax({url:"user_stats.php",type:"POST",dataType:"JSON"}).done(function(e){for(i in e.stats)for(x in e.stats[i])$("#optionsAccordion #"+x).text(e.stats[i][x]);$("#optionsAccordion #systems_visited").text(e.system_visits),$("#optionsAccordion #logins").text(e.account.logins),$("#optionsAccordion #lastLogin").text(e.account.lastLogin),$("#optionsAccordion #username").text(e.username)}),$.ajax({url:"masks.php",type:"POST",dataType:"JSON"}).done(function(e){if(e&&e.masks){for(var a in $("#dialog-options #masks #default").html(""),$("#dialog-options #masks #personal").html(""),$("#dialog-options #masks #corporate").html(""),e.masks){var o=e.masks[a],i=$('<input type="radio" name="mask" id="mask'+a+'" value="'+o.mask+'" class="selector" data-owner="'+o.owner+'" data-admin="'+o.admin+'" /><label for="mask'+a+'"><img src="'+o.img+'" />'+(o.optional?'<i class="closeIcon" onclick="return false;" data-icon="red-giant"><i data-icon="times"></i></i>':"")+'<span class="selector_label">'+o.label+"</span></label>");$("#dialog-options #masks #"+o.type).append(i)}i=$('<input type="checkbox" name="find" id="findp" value="personal" class="selector" disabled="disabled" /><label for="findp"><i data-icon="search" style="font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;"></i></label>');if($("#dialog-options #masks #personal").append(i),"1"==init.admin){i=$('<input type="checkbox" name="find" id="findc" value="corporate" class="selector" disabled="disabled" /><label for="findc"><i data-icon="search" style="font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;"></i></label>');$("#dialog-options #masks #corporate").append(i)}$("#dialog-options input[name='mask']").filter("[value='"+e.masks[e.active].mask+"']").attr("checked",!0).trigger("change"),e.masks[e.active].admin?$("#admin").removeClass("disabled"):$("#admin").addClass("disabled")}}),$("#dialog-options #pasteLife").val(options.signatures.pasteLife),$("#dialog-options #typeFormat").val(options.chain.typeFormat),$("#dialog-options #classFormat").val(options.chain.classFormat),$("#dialog-options input[name='node-reference'][value='"+options.chain["node-reference"]+"']").prop("checked",!0),$("#dialog-options input[name='gridlines'][value='"+options.chain.gridlines+"']").prop("checked",!0),$("#dialog-options #background-image").val(options.background)},create:function(){$("#optionsAccordion").accordion({heightStyle:"content",collapsible:!0,active:!1}),$("#uiscale-slider").slider({min:.7,max:1.4,step:.05,value:options.uiscale||1,change:function(e,a){$("body").css("zoom",a.value)},slide:function(e,a){$("label[for='uiscale-slider']").html(a.value)}}),$("label[for='uiscale-slider']").html($("#uiscale-slider").slider("value")),$("#dialog-pwChange").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Save:function(){$("#pwForm").submit()},Cancel:function(){$(this).dialog("close")}},close:function(){$("#pwForm input[name='password'], #pwForm input[name='confirm']").val(""),$("#pwError").text("").hide()}}),$("#pwChange").click(function(){$("#dialog-pwChange").dialog("open")}),$("#pwForm").submit(function(e){e.preventDefault(),$("#pwError").text("").hide(),$.ajax({url:"options.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).done(function(e){e&&e.result?($("#dialog-msg #msg").text("Password changed"),$("#dialog-msg").dialog("open"),$("#dialog-pwChange").dialog("close")):e&&e.error?$("#pwError").text(e.error).show("slide",{direction:"up"}):$("#pwError").text("Unknown error").show("slide",{direction:"up"})})}),$("#dialog-usernameChange").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Save:function(){$("#usernameForm").submit()},Cancel:function(){$(this).dialog("close")}},open:function(){$("#usernameForm #username").html($("#dialog-options #username").html())},close:function(){$("#usernameForm [name='username']").val(""),$("#usernameError").text("").hide()}}),$("#usernameChange").click(function(){$("#dialog-usernameChange").dialog("open")}),$("#usernameForm").submit(function(e){e.preventDefault(),$("#usernameError").text("").hide(),$.ajax({url:"options.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).done(function(e){e&&e.result?($("#dialog-msg #msg").text("Username changed"),$("#dialog-msg").dialog("open"),$("#dialog-options #username").html(e.result),$("#dialog-usernameChange").dialog("close")):e&&e.error?$("#usernameError").text(e.error).show("slide",{direction:"up"}):$("#usernameError").text("Unknown error").show("slide",{direction:"up"})})}),$("#masks").on("change","input.selector:checked",function(){$(this).data("owner")?($("#maskControls #edit").removeAttr("disabled"),$("#maskControls #delete").removeAttr("disabled")):($("#maskControls #edit").attr("disabled","disabled"),$("#maskControls #delete").attr("disabled","disabled")),0!=$(this).val()&&0==$(this).val().split(".")[1]?$("#dialog-options #leave").removeAttr("disabled"):$("#dialog-options #leave").attr("disabled","disabled")}),$("#dialog-joinMask").dialog({autoOpen:!1,resizable:!1,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Add:function(){var e=$("#dialog-joinMask #results input:checked"),a=$("#dialog-joinMask #results input:checked+label");$.ajax({url:"masks.php",type:"POST",data:{mask:e.val(),mode:"join"},dataType:"JSON"}).done(function(o){o&&o.result&&(a.css("width",""),a.find(".info").remove(),a.append('<i class="closeIcon" onclick="return false;" data-icon="red-giant"><i data-icon="times"></i></i>'),$("#dialog-options #masks #"+o.type+" input.selector:last").before(e).before(a),$("#dialog-joinMask").dialog("close"))})},Cancel:function(){$(this).dialog("close")}},create:function(){$("#dialog-joinMask form").submit(function(e){e.preventDefault(),$("#dialog-joinMask #results").html(""),$("#dialog-joinMask #loading").show(),$("#dialog-joinMask input[type='submit']").attr("disabled","disabled"),$.ajax({url:"masks.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).then(function(e){if(e&&e.results)return tripwire.esi.fullLookup(e.eveIDs).done(function(a){if(a)for(var o in a){var i=e.results[o],t=$('<input type="radio" name="mask" id="mask'+i.mask+'" value="'+i.mask+'" class="selector" data-owner="false" data-admin="'+i.admin+'" /><label for="mask'+i.mask+'" style="width: 100%; margin-left: -5px;">\t<img src="'+i.img+'" />\t<span class="selector_label">'+i.label+'</span>\t<div class="info">\t\t'+a[o].name+"<br/>\t\t"+a[o].corporation.name+"<br/>\t\t"+(a[o].alliance?a[o].alliance.name:"")+"<br/>\t</div></label>");$("#dialog-joinMask #results").append(t)}});e&&e.error?($("#dialog-error #msg").text(e.error),$("#dialog-error").dialog("open")):($("#dialog-error #msg").text("Unknown error"),$("#dialog-error").dialog("open"))}).then(function(){$("#dialog-joinMask #loading").hide(),$("#dialog-joinMask input[type='submit']").removeAttr("disabled")})})},close:function(){$("#dialog-joinMask #results").html(""),$("#dialog-joinMask input[name='name']").val("")}}),$("#dialog-options #masks").on("click","input[name='find']+label",function(){$("#dialog-joinMask input[name='find']").val($(this).prev().val()),$("#dialog-joinMask").dialog("open")}),$("#dialog-options #masks").on("click",".closeIcon",function(){var e=$(this).closest("input.selector+label").prev();$("#dialog-confirm #msg").text("Are you sure you want to remove this mask?"),$("#dialog-confirm").dialog("option",{buttons:{Remove:function(){var a={mode:"leave",mask:e.val()};$.ajax({url:"masks.php",type:"POST",data:a,dataType:"JSON"}).done(function(a){a&&a.result?(e.next().remove(),e.remove(),$("#dialog-confirm").dialog("close")):($("#dialog-confirm").dialog("close"),$("#dialog-error #msg").text("Unable to delete"),$("#dialog-error").dialog("open"))})},Cancel:function(){$(this).dialog("close")}}}).dialog("open")}),$("#maskControls #delete").click(function(){var e=$("#masks input.selector:checked");$("#dialog-confirm #msg").text("Are you sure you want to delete this mask?"),$("#dialog-confirm").dialog("option",{buttons:{Delete:function(){var a={mode:"delete",mask:e.val()};$.ajax({url:"masks.php",type:"POST",data:a,dataType:"JSON"}).done(function(a){a&&a.result?(e.next().remove(),e.remove(),$("#dialog-confirm").dialog("close")):($("#dialog-confirm").dialog("close"),$("#dialog-error #msg").text("Unable to delete"),$("#dialog-error").dialog("open"))})},Cancel:function(){$(this).dialog("close")}}}).dialog("open")}),$("#dialog-createMask").dialog({autoOpen:!1,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Create:function(){$("#dialog-createMask form").submit()},Cancel:function(){$(this).dialog("close")}},create:function(){$("#dialog-createMask #accessList").on("click","#create_add+label",function(){$("#dialog-EVEsearch").dialog("open")}),$("#dialog-createMask form").submit(function(e){e.preventDefault(),$.ajax({url:"masks.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).done(function(e){e&&e.result?($.ajax({url:"masks.php",type:"POST",dataType:"JSON"}).done(function(e){if(e&&e.masks){for(var a in $("#dialog-options #masks #default").html(""),$("#dialog-options #masks #personal").html(""),$("#dialog-options #masks #corporate").html(""),e.masks){var o=e.masks[a],i=$('<input type="radio" name="mask" id="mask'+a+'" value="'+o.mask+'" class="selector" data-owner="'+o.owner+'" data-admin="'+o.admin+'" /><label for="mask'+a+'"><img src="'+o.img+'" />'+(o.optional?'<i class="closeIcon" onclick="return false;" data-icon="red-giant"><i data-icon="times"></i></i>':"")+'<span class="selector_label">'+o.label+"</span></label>");$("#dialog-options #masks #"+o.type).append(i)}i=$('<input type="checkbox" name="find" id="findp" value="personal" class="selector" disabled="disabled" /><label for="findp"><i data-icon="search" style="font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;"></i></label>');if($("#dialog-options #masks #personal").append(i),"1"==init.admin){i=$('<input type="checkbox" name="find" id="findc" value="corporate" class="selector" disabled="disabled" /><label for="findc"><i data-icon="search" style="font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;"></i></label>');$("#dialog-options #masks #corporate").append(i)}$("#dialog-options input[name='mask']").filter("[value='"+e.masks[e.active].mask+"']").attr("checked",!0).trigger("change"),e.masks[e.active].admin?$("#admin").removeClass("disabled"):$("#admin").addClass("disabled")}}),$("#dialog-createMask").dialog("close")):e&&e.error?($("#dialog-error #msg").text(e.error),$("#dialog-error").dialog("open")):($("#dialog-error #msg").text("Unknown error"),$("#dialog-error").dialog("open"))})}),$("#dialog-createMask select").selectmenu({width:100})},open:function(){$("#dialog-createMask input[name='name']").val(""),$("#dialog-createMask #accessList :not(.static)").remove()}}),$("#maskControls #create").click(function(){$("#dialog-createMask").dialog("open")}),$("#dialog-createMask #accessList").on("click",".maskRemove",function(){$(this).closest("input.selector+label").prev().remove(),$(this).closest("label").remove()}),$("#dialog-editMask").dialog({autoOpen:!1,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Save:function(){$("#dialog-editMask form").submit()},Cancel:function(){$(this).dialog("close")}},create:function(){$("#dialog-editMask #accessList").on("click",".maskRemove",function(){$(this).closest("input.selector+label").prev().attr("name","deletes[]").hide(),$(this).closest("label").hide()}),$("#dialog-editMask #accessList").on("click","#edit_add+label",function(){$("#dialog-EVEsearch").dialog("open")}),$("#dialog-editMask form").submit(function(e){e.preventDefault(),$.ajax({url:"masks.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).done(function(e){e&&e.result?$("#dialog-editMask").dialog("close"):e&&e.error?($("#dialog-error #msg").text(e.error),$("#dialog-error").dialog("open")):($("#dialog-error #msg").text("Unknown error"),$("#dialog-error").dialog("open"))})})},open:function(){var e=$("#dialog-options input[name='mask']:checked").val();$("#dialog-editMask input[name='mask']").val(e),$("#dialog-editMask #accessList label.static").hide(),$("#dialog-editMask #loading").show(),$("#dialog-editMask #name").text($("#dialog-options input[name='mask']:checked+label .selector_label").text()),$.ajax({url:"masks.php",type:"POST",data:{mode:"edit",mask:e},dataType:"JSON"}).then(function(e){return tripwire.esi.fullLookup(e.results).done(function(e){if(e)for(var a in e)if("character"==e[a].category){var o=$('<input type="checkbox" checked="checked" onclick="return false" name="" id="edit_'+e[a].id+'_1373" value="'+e[a].id+'_1373" class="selector" /><label for="edit_'+e[a].id+'_1373">\t<img src="https://image.eveonline.com/Character/'+e[a].id+'_64.jpg" />\t<span class="selector_label">Character</span>\t<div class="info">\t\t'+e[a].name+"<br/>\t\t"+e[a].corporation.name+"<br/>\t\t"+(e[a].alliance?e[a].alliance.name:"")+'<br/>\t\t<input type="button" class="maskRemove" value="Remove" style="position: absolute; bottom: 3px; right: 3px;" />\t</div></label>');$("#dialog-editMask #accessList .static:first").before(o)}else if("corporation"==e[a].category){o=$('<input type="checkbox" checked="checked" onclick="return false" name="" id="edit_'+e[a].id+'_2" value="'+e[a].id+'_2" class="selector" /><label for="edit_'+e[a].id+'_2">\t<img src="https://image.eveonline.com/Corporation/'+e[a].id+'_64.png" />\t<span class="selector_label">Corporation</span>\t<div class="info">\t\t'+e[a].name+"<br/>\t\t"+(e[a].alliance?e[a].alliance.name:"")+'<br/>\t\t<input type="button" class="maskRemove" value="Remove" style="position: absolute; bottom: 3px; right: 3px;" />\t</div></label>');$("#dialog-editMask #accessList .static:first").before(o)}})}).then(function(e){$("#dialog-editMask #accessList label.static").show(),$("#dialog-editMask #loading").hide()})},close:function(){$("#dialog-editMask #accessList :not(.static)").remove()}}),$("#maskControls #edit").click(function(){$("#dialog-editMask").dialog("open")}),$("#dialog-EVEsearch").dialog({autoOpen:!1,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Add:function(){if($("#accessList input[value='"+$("#EVESearchResults input").val()+"']").length)return $("#dialog-error #msg").text("Already has access"),$("#dialog-error").dialog("open"),!1;$("#EVESearchResults .info").append('<input type="button" class="maskRemove" value="Remove" style="position: absolute; bottom: 3px; right: 3px;" />'),$("#EVESearchResults input:checked").attr("checked","checked"),$("#EVESearchResults input:checked").attr("onclick","return false");var e=$("#EVESearchResults .maskNode:has(input:checked)");$("#dialog-createMask").dialog("isOpen")?$("#dialog-createMask #accessList .static:first").before(e):$("#dialog-editMask").dialog("isOpen")&&$("#dialog-editMask #accessList .static:first").before(e),$(this).dialog("close")},Close:function(){$(this).dialog("close")}},create:function(){$("#EVEsearch").submit(function(e){if(e.preventDefault(),""==$("#EVEsearch input[name='name']").val())return!1;$("#EVESearchResults, #searchCount").html(""),$("#EVEsearch #searchSpinner").show(),$("#EVEsearch input[type='submit']").attr("disabled","disabled"),$("#dialog-EVEsearch").parent().find(".ui-dialog-buttonpane button:contains('Add')").attr("disabled",!0).addClass("ui-state-disabled"),tripwire.esi.search($("#EVEsearch input[name='name']").val(),$("#EVEsearch input[name='category']:checked").val(),$("#EVEsearch input[name='exact']")[0].checked).done(function(e){if(e&&(e.character||e.corporation))return e=$.merge(e.character||[],e.corporation||[]),total=e.length,e=e.slice(0,10),tripwire.esi.fullLookup(e).done(function(e){if($("#EVEsearch #searchCount").html("Found: "+total+"<br/>Showing: "+(total<10?total:10)),e)for(var a in e)if("character"==e[a].category){var o=$('<div class="maskNode"><input type="checkbox" name="adds[]" id="find_'+e[a].id+'_1373" value="'+e[a].id+'_1373" class="selector" /><label for="find_'+e[a].id+'_1373">\t<img src="https://image.eveonline.com/Character/'+e[a].id+'_64.jpg" />\t<span class="selector_label">Character</span>\t<div class="info">\t\t'+e[a].name+"<br/>\t\t"+e[a].corporation.name+"<br/>\t\t"+(e[a].alliance?e[a].alliance.name:"")+"<br/>\t</div></label></div>");$("#EVESearchResults").append(o)}else if("corporation"==e[a].category){o=$('<div class="maskNode"><input type="checkbox" name="adds[]" id="find_'+e[a].id+'_2" value="'+e[a].id+'_2" class="selector" /><label for="find_'+e[a].id+'_2">\t<img src="https://image.eveonline.com/Corporation/'+e[a].id+'_64.png" />\t<span class="selector_label">Corporation</span>\t<div class="info">\t\t'+e[a].name+"<br/>\t\t"+(e[a].alliance?e[a].alliance.name:"")+"<br/>\t</div></label></div>");$("#EVESearchResults").append(o)}}).always(function(){$("#EVEsearch #searchSpinner").hide(),$("#EVEsearch input[type='submit']").removeAttr("disabled"),$("#dialog-EVEsearch").parent().find(".ui-dialog-buttonpane button:contains('Add')").removeAttr("disabled").removeClass("ui-state-disabled")});$("#dialog-error #msg").text("No Results"),$("#dialog-error").dialog("open"),$("#EVEsearch #searchSpinner").hide(),$("#EVEsearch input[type='submit']").removeAttr("disabled"),$("#dialog-EVEsearch").parent().find(".ui-dialog-buttonpane button:contains('Add')").removeAttr("disabled").removeClass("ui-state-disabled")})})},close:function(){$("#EVEsearch input[name='name']").val(""),$("#EVESearchResults, #searchCount").html("")}})}}),$("#dialog-options").dialog("open")});
$("#signaturesWidget").on("click","#delete-signature",function(e){return e.preventDefault(),!$(this).closest("tr").attr("disabled")&&(0!=$("#sigTable tr.selected").length&&($("#dialog-sigEdit").hasClass("ui-dialog-content")&&$("#dialog-sigEdit").dialog("isOpen")?($("#dialog-sigEdit").parent().effect("shake",300),!1):void($("#dialog-deleteSig").hasClass("ui-dialog-content")?$("#dialog-deleteSig").dialog("isOpen")||$("#dialog-deleteSig").dialog("open"):$("#dialog-deleteSig").dialog({resizable:!1,minHeight:0,dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{Delete:function(){$("#dialog-deleteSig").parent().find(":button:contains('Delete')").button("disable");var e={signatures:{remove:[]},systemID:viewingSystemID},i=[],t=$.map($("#sigTable tr.selected"),function(e){var t=tripwire.client.signatures[$(e).data("id")];if("wormhole"!=t.type)return i.push(t),t.id;var n=$.map(tripwire.client.wormholes,function(e){if(e.initialID==t.id||e.secondaryID==t.id)return e})[0];return i.push({wormhole:n,signatures:[tripwire.client.signatures[n.initialID],tripwire.client.signatures[n.secondaryID]]}),n});e.signatures.remove=t;tripwire.refresh("refresh",e,function(e){e.resultSet&&1==e.resultSet[0].result&&($("#dialog-deleteSig").dialog("close"),$("#undo").removeClass("disabled"),viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"remove",signatures:i}):tripwire.signatures.undo[viewingSystemID]=[{action:"remove",signatures:i}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))},function(e){$("#dialog-deleteSig").parent().find(":button:contains('Delete')").button("enable")})},Cancel:function(){$(this).dialog("close")}},close:function(){}}))))});
function openSignatureDialog(e){e.preventDefault(),mode=e.data.mode,element=this,"update"==mode&&($("#sigTable tr.selected").removeClass("selected"),$(this).closest("tr").addClass("selected")),$("#dialog-signature").hasClass("ui-dialog-content")?$("#dialog-signature").dialog("isOpen")||$("#dialog-signature").dialog("open"):$("#dialog-signature").dialog({autoOpen:!0,resizable:!1,dialogClass:"dialog-noeffect ui-dialog-shadow",position:{my:"center",at:"center",of:$("#signaturesWidget")},buttons:{Save:function(){$("#form-signature").submit()},Add:function(){$("#form-signature").submit()},Cancel:function(){$(this).dialog("close")}},create:function(){var e=$.map(tripwire.wormholes,function(e,i){return i});e.splice(26,0,"K162"),e.push("GATE"),e.push("SML"),e.push("MED"),e.push("LRG"),e.push("XLG"),$("#dialog-signature [name='signatureType'], #dialog-signature [name='signatureLife']").selectmenu({width:100}),$("#dialog-signature [name='wormholeLife'], #dialog-signature [name='wormholeMass']").selectmenu({width:80}),$("#dialog-signature [data-autocomplete='sigSystems']").inlinecomplete({source:tripwire.aSigSystems,maxSize:10,delay:0}),$("#dialog-signature [data-autocomplete='sigType']").inlinecomplete({source:e,maxSize:10,delay:0}),$("#dialog-signature #durationPicker").durationPicker(),$("#dialog-signature [name='signatureID_Alpha'], #dialog-signature [name='signatureID2_Alpha']").on("input",function(){for(;!/^[a-zA-Z?]*$/g.test(this.value);)this.value=this.value.substring(0,this.value.length-1)}),$("#dialog-signature [name='signatureID_Numeric'], #dialog-signature [name='signatureID2_Numeric']").on("input",function(){for(;!/^[0-9?]*$/g.test(this.value);)this.value=this.value.substring(0,this.value.length-1)}),$("#dialog-signature .signatureID, #dialog-signature .wormholeType").on("click",function(){$(this).select()}),$("#dialog-signature .wormholeType").on("input, change",function(){this.value.length>0&&-1!=$.inArray(this.value.toUpperCase(),e)&&"K162"!=this.value.toUpperCase()?($("#dialog-signature .wormholeType").not(this).val("K162"),tripwire.wormholes[this.value.toUpperCase()]&&$("#dialog-signature #durationPicker").val(60*tripwire.wormholes[this.value.toUpperCase()].life.substring(0,2)*60).change()):"K162"===this.value.toUpperCase()?-1!=$.inArray($("#dialog-signature .wormholeType").not(this).val(),e)&&$("#dialog-signature .wormholeType").not(this).val("????"):"????"==this.value&&$("#dialog-signature .wormholeType").not(this).val("K162")}),$("#dialog-signature").on("selectmenuchange","[name='signatureType']",function(){"wormhole"==this.value?($("#dialog-signature #site").slideUp(200,function(){$(this).hide(0)}),$("#dialog-signature #wormhole").slideDown(200,function(){$(this).show(200)})):($("#dialog-signature #site").slideDown(200,function(){$(this).show(200)}),$("#dialog-signature #wormhole").slideUp(200,function(){$(this).hide(0)})),ValidationTooltips.close()}),$("#form-signature").submit(function(i){i.preventDefault();var t=$(this).serializeObject(),a=!0;if(ValidationTooltips.close(),$.each($("#dialog-signature .signatureID:visible"),function(){if(this.value.length>0&&this.value.length<3)return ValidationTooltips.open({target:$(this)}).setContent("Must be 3 characters in length!"),$(this).select(),a=!1,!1}),!a)return!1;if(3===t.signatureID_Alpha.length&&3===t.signatureID_Numeric.length&&0!=Object.find(tripwire.client.signatures,"signatureID",t.signatureID_Alpha+t.signatureID_Numeric,!0)&&Object.find(tripwire.client.signatures,"signatureID",t.signatureID_Alpha+t.signatureID_Numeric,!0).id!=$("#dialog-signature").data("signatureid")){var r=Object.find(tripwire.client.signatures,"signatureID",t.signatureID_Alpha+t.signatureID_Numeric);return ValidationTooltips.open({target:$("#dialog-signature .signatureID:first")}).setContent("Signature ID already exists! <input type='button' autofocus='true' id='overwrite' value='Overwrite' style='margin-bottom: -4px; margin-top: -4px; font-size: 0.8em;' data-id='"+r.id+"' />"),$("#overwrite").focus(),a=!1,!1}if(!a)return!1;if(isNaN(parseInt($("#dialog-signature #durationPicker").val()))||!(parseInt($("#dialog-signature #durationPicker").val())>=300))return ValidationTooltips.open({target:$("#dialog-signature #durationPicker + .bdp-input")}).setContent("Must be at least 5 minutes!"),$("#dialog-signature #durationPicker").select(),!1;if($.each($("#dialog-signature .wormholeType:visible"),function(){if(this.value.length>0&&-1==$.inArray(this.value.toUpperCase(),e)&&"????"!=this.value)return ValidationTooltips.open({target:$(this)}).setContent("Must be a valid wormhole type!"),$(this).select(),a=!1,!1}),!a)return!1;if($.each($("#dialog-signature .leadsTo:visible"),function(){if(this.value.length>0&&-1==tripwire.aSigSystems.findIndex(e=>this.value.toLowerCase()===e.toLowerCase()))return ValidationTooltips.open({target:$(this)}).setContent("Must be a valid leads to system!"),$(this).select(),a=!1,!1}),!a)return!1;if($.each($("#dialog-signature .leadsTo:visible"),function(){if(this.value.length>0&&this.value.toLowerCase()===viewingSystem.toLowerCase())return ValidationTooltips.open({target:$(this)}).setContent("Wormhole cannot lead to the same system it comes from!"),$(this).select(),a=!1,!1}),!a)return!1;var n={},s=[];if("wormhole"===t.signatureType){var o={signatureID:t.signatureID_Alpha+t.signatureID_Numeric,systemID:viewingSystemID,type:"wormhole",name:t.wormholeName,lifeLength:t.signatureLength},l=null;Object.index(tripwire.systems,"name",t.leadsTo,!0)?l=Object.index(tripwire.systems,"name",t.leadsTo,!0):tripwire.wormholes[t.wormholeType.toUpperCase()]?tripwire.aSigSystems.findIndex(e=>tripwire.wormholes[t.wormholeType.toUpperCase()].leadsTo.replace(" ","-").toLowerCase()===e.toLowerCase())>-1&&(l=tripwire.aSigSystems.findIndex(e=>tripwire.wormholes[t.wormholeType.toUpperCase()].leadsTo.replace(" ","-").toLowerCase()===e.toLowerCase())):-1!==tripwire.aSigSystems.findIndex(e=>t.leadsTo.toLowerCase()===e.toLowerCase())&&(l=tripwire.aSigSystems.findIndex(e=>t.leadsTo.toLowerCase()===e.toLowerCase()));var u={signatureID:t.signatureID2_Alpha+t.signatureID2_Numeric,systemID:l,type:"wormhole",name:t.wormholeName2,lifeLength:t.signatureLength},g=null,d=null;t.wormholeType.length>0&&-1!=$.inArray(t.wormholeType.toUpperCase(),e)&&"K162"!=t.wormholeType.toUpperCase()?(d="initial",g=t.wormholeType.toUpperCase()):t.wormholeType2.length>0&&-1!=$.inArray(t.wormholeType2.toUpperCase(),e)&&"K162"!=t.wormholeType2.toUpperCase()?(d="secondary",g=t.wormholeType2.toUpperCase()):"K162"==t.wormholeType.toUpperCase()?(d="secondary",g="????"):"K162"==t.wormholeType2.toUpperCase()&&(d="initial",g="????");var p={type:g,parent:d,life:t.wormholeLife,mass:t.wormholeMass};"update"==mode?(o.id=$("#dialog-signature").data("signatureid"),u.id=$("#dialog-signature").data("signature2id"),p.id=$("#dialog-signature").data("wormholeid"),tripwire.client.wormholes[p.id]&&(t.wormholeType.length>0&&-1!=$.inArray(t.wormholeType.toUpperCase(),e)&&"K162"!=t.wormholeType.toUpperCase()?(p.parent=tripwire.client.wormholes[p.id].initialID==o.id?"initial":"secondary",p.type=t.wormholeType.toUpperCase()):t.wormholeType2.length>0&&-1!=$.inArray(t.wormholeType2.toUpperCase(),e)&&"K162"!=t.wormholeType2.toUpperCase()?(p.parent=tripwire.client.wormholes[p.id].initialID==o.id?"secondary":"initial",p.type=t.wormholeType2.toUpperCase()):"K162"==t.wormholeType.toUpperCase()?(p.parent=tripwire.client.wormholes[p.id].initialID==o.id?"secondary":"initial",p.type="????"):"K162"==t.wormholeType2.toUpperCase()&&(p.parent=tripwire.client.wormholes[p.id].initialID==o.id?"initial":"secondary",p.type="????")),n={signatures:{update:[{wormhole:p,signatures:[o,u]}]}},tripwire.client.wormholes[p.id]?s.push({wormhole:tripwire.client.wormholes[p.id],signatures:[tripwire.client.signatures[o.id],tripwire.client.signatures[u.id]]}):s.push(tripwire.client.signatures[o.id])):n={signatures:{add:[{wormhole:p,signatures:[o,u]}]}}}else{if("update"==mode)if(n={signatures:{update:[o={id:$("#dialog-signature").data("signatureid"),signatureID:t.signatureID_Alpha+t.signatureID_Numeric,systemID:viewingSystemID,type:t.signatureType,name:t.signatureName,lifeLength:t.signatureLength}]}},"wormhole"==tripwire.client.signatures[o.id].type){p=$.map(tripwire.client.wormholes,function(e){if(e.initialID==o.id||e.secondaryID==o.id)return e})[0],u=o.id==p.initialID?tripwire.client.signatures[p.secondaryID]:tripwire.client.signatures[p.initialID];s.push({wormhole:tripwire.client.wormholes[p.id],signatures:[tripwire.client.signatures[o.id],tripwire.client.signatures[u.id]]})}else s.push(tripwire.client.signatures[o.id]);else n={signatures:{add:[o={signatureID:t.signatureID_Alpha+t.signatureID_Numeric,systemID:viewingSystemID,type:t.signatureType,name:t.signatureName,lifeLength:t.signatureLength}]}}}$("#dialog-signature").parent().find(":button:contains('Save')").button("disable");tripwire.refresh("refresh",n,function(e){e.resultSet&&1==e.resultSet[0].result&&($("#dialog-signature").dialog("close"),$("#undo").removeClass("disabled"),"add"==mode&&(s=e.results),viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:mode,signatures:s}):tripwire.signatures.undo[viewingSystemID]=[{action:mode,signatures:s}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))},function(){$("#sigEditForm input[type=submit]").removeAttr("disabled"),$("#dialog-signature").parent().find(":button:contains('Save')").button("enable")})})},open:function(){if($("#dialog-signature").data("signatureid",""),$("#dialog-signature").data("signature2id",""),$("#dialog-signature").data("wormholeid",""),$("#dialog-signature input").val(""),$("#dialog-signature [name='signatureType']").val("unknown").selectmenu("refresh"),$("#dialog-signature #site").show(),$("#dialog-signature #wormhole").hide(),$("#dialog-signature .sideLabel:first").html(viewingSystem+" Side"),$("#dialog-signature .sideLabel:last").html("Other Side"),$("#dialog-signature #durationPicker").val(60*options.signatures.pasteLife*60).change(),"update"==mode&&$(element).data("id")&&tripwire.client.signatures[$(element).data("id")]){var e=$(element).data("id"),i=tripwire.client.signatures[e];if($("#dialog-signature").data("signatureid",e),$("#dialog-signature").parent().find("button:contains('Add')").hide(),$("#dialog-signature").parent().find("button:contains('Save')").show(),$("#dialog-signature").dialog("option","title","Edit Signature"),"wormhole"==i.type){var t=$.map(tripwire.client.wormholes,function(i){if(i.initialID==e||i.secondaryID==e)return i})[0],a=e==t.initialID?tripwire.client.signatures[t.secondaryID]:tripwire.client.signatures[t.initialID];$("#dialog-signature").data("signature2id",a.id),$("#dialog-signature").data("wormholeid",t.id),$("#dialog-signature input[name='signatureID_Alpha']").val(i.signatureID?i.signatureID.substr(0,3):"???"),$("#dialog-signature input[name='signatureID_Numeric']").val(i.signatureID?i.signatureID.substr(3,5):""),$("#dialog-signature [name='signatureType']").val(i.type).selectmenu("refresh").trigger("selectmenuchange"),$("#dialog-signature [name='wormholeName']").val(i.name),$("#dialog-signature [name='leadsTo']").val(tripwire.systems[a.systemID]?tripwire.systems[a.systemID].name:tripwire.aSigSystems[a.systemID]?tripwire.aSigSystems[a.systemID]:""),$("#dialog-signature input[name='signatureID2_Alpha']").val(a.signatureID?a.signatureID.substr(0,3):"???"),$("#dialog-signature input[name='signatureID2_Numeric']").val(a.signatureID?a.signatureID.substr(3,5):""),$("#dialog-signature [name='wormholeName2']").val(a.name),$("#dialog-signature [name='wormholeLife']").val(t.life).selectmenu("refresh").trigger("selectmenuchange"),$("#dialog-signature [name='wormholeMass']").val(t.mass).selectmenu("refresh").trigger("selectmenuchange"),t[t.parent+"ID"]==i.id?$("#dialog-signature input[name='wormholeType']").val(t.type).change():t[t.parent+"ID"]==a.id&&$("#dialog-signature input[name='wormholeType2']").val(t.type).change(),$("#dialog-signature #durationPicker").val(i.lifeLength).change()}else $("#dialog-signature input[name='signatureID_Alpha']").val(i.signatureID?i.signatureID.substr(0,3):"???"),$("#dialog-signature input[name='signatureID_Numeric']").val(i.signatureID?i.signatureID.substr(3,5):""),$("#dialog-signature [name='signatureType']").val(i.type).selectmenu("refresh").trigger("selectmenuchange"),$("#dialog-signature [name='signatureName']").val(i.name),$("#dialog-signature #durationPicker").val(i.lifeLength).change()}else $("#dialog-signature").parent().find("button:contains('Add')").show(),$("#dialog-signature").parent().find("button:contains('Save')").hide(),$("#dialog-signature").dialog("option","title","Add Signature")},close:function(){ValidationTooltips.close(),$("#sigTable tr.selected").removeClass("selected"),$("#dialog-signature").data("signatureid",""),$("#dialog-signature").data("signature2id",""),$("#dialog-signature").data("wormholeid","")}})}$("#sigTable tbody").on("dblclick","tr",{mode:"update"},openSignatureDialog),$("#add-signature").click({mode:"add"},openSignatureDialog);
//# sourceMappingURL=app.min.js.map
