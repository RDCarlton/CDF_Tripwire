<html><head>Map rendering testbed</title>

<script>
const chain_map = 
{
  "cols": [
    {
      "label": "System",
      "type": "string"
    },
    {
      "label": "Parent",
      "type": "string"
    }
  ],
  "rows": [
    {
      "c": [
        {
          "v": 1,
          "f": "<div id='node1' data-nodeid='31001779'null class='node top-level'><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-4'>C4</span></h4><h4 class='nodeSystem'><a href='.?system=J172502'>J172502</a></h4><h4 class='nodeType'>&nbsp;</h4><div class='statics'><span class=\"class-3\" data-tooltip=\"Class 3 via C247\">3</span><span class=\"class-5\" data-tooltip=\"Class 5 via H900\">5</span></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": null
        }
      ]
    },
    {
      "c": [
        {
          "v": 2,
          "f": "<div id='node2' data-nodeid='31001168'null class='node  top-level'><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-3'>C3</span></h4><h4 class='nodeSystem'><a href='.?system=J101354'>J101354</a></h4><h4 class='nodeType'>&nbsp;</h4><div class='statics'><span class=\"hisec\" data-tooltip=\"High-Sec via D845\">H</span></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": null
        }
      ]
    },
    {
      "c": [
        {
          "v": 3,
          "f": "<div id='node3' data-nodeid='31002465'null class='node  top-level'><div class='nodeIcons'><div style='float: left;'><i class='whEffect' data-icon='wolf-rayet' data-tooltip='Wolf-Rayet Star'></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-6'>C6</span></h4><h4 class='nodeSystem'><a href='.?system=J164701'>J164701</a></h4><h4 class='nodeType'>&nbsp;</h4><div class='statics'><span class=\"class-5\" data-tooltip=\"Class 5 via V911\">5</span></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": null
        }
      ]
    },
    {
      "c": [
        {
          "v": 4,
          "f": "<div id='node4' data-nodeid='31002294' data-sigid='52998' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-5'>C5</span></h4><h4 class='nodeSystem'><a href='.?system=J103812'>2</a></h4><h4 class='nodeType'>gbr</h4><div class='statics'><span class=\"class-4\" data-tooltip=\"Class 4 via E175\">4</span></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 1
        }
      ]
    },
    {
      "c": [
        {
          "v": 5,
          "f": "<div id='node5' data-nodeid='31001328' data-sigid='52999' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-3'>C3</span></h4><h4 class='nodeSystem'><a href='.?system=J170144'>1</a></h4><h4 class='nodeType'>ktq</h4><div class='statics'><span class=\"lowsec\" data-tooltip=\"Low-Sec via U210\">L</span></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 1
        }
      ]
    },
    {
      "c": [
        {
          "v": 6,
          "f": "<div id='node6' data-nodeid='31000696' data-sigid='53001' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-2'>C2</span></h4><h4 class='nodeSystem'><a href='.?system=J223538'>3</a></h4><h4 class='nodeType'>zuy</h4><div class='statics'><span class=\"lowsec\" data-tooltip=\"Low-Sec via A239\">L</span><span class=\"class-2\" data-tooltip=\"Class 2 via D382\">2</span></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 1
        }
      ]
    },
    {
      "c": [
        {
          "v": 7,
          "f": "<div id='node7' data-nodeid='null|8971' data-sigid='52995' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'>&nbsp;</h4><h4 class='nodeSystem'>1 c45?</h4><h4 class='nodeType'>tot</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 2
        }
      ]
    },
    {
      "c": [
        {
          "v": 8,
          "f": "<div id='node8' data-nodeid='null|5338' data-sigid='52996' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'>&nbsp;</h4><h4 class='nodeSystem'>2 c23?</h4><h4 class='nodeType'>ruq</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 2
        }
      ]
    },
    {
      "c": [
        {
          "v": 9,
          "f": "<div id='node9' data-nodeid='30000057' data-sigid='52997' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='hisec'>HS</span></h4><h4 class='nodeSystem'><a href='.?system=Nikh'>Nikh</a></h4><h4 class='nodeType'>ktu</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 2
        }
      ]
    },
    {
      "c": [
        {
          "v": 10,
          "f": "<div id='node10' data-nodeid='null|5471' data-sigid='52838' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'>&nbsp;</h4><h4 class='nodeSystem'>&nbsp;</h4><h4 class='nodeType'>tqs</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 3
        }
      ]
    },
    {
      "c": [
        {
          "v": 11,
          "f": "<div id='node11' data-nodeid='31001596' data-sigid='52878' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-4'>C4</span></h4><h4 class='nodeSystem'><a href='.?system=J215935'>J215935</a></h4><h4 class='nodeType'>rxp</h4><div class='statics'><span class=\"class-5\" data-tooltip=\"Class 5 via H900\">5</span><span class=\"class-4\" data-tooltip=\"Class 4 via X877\">4</span></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 3
        }
      ]
    },
    {
      "c": [
        {
          "v": 12,
          "f": "<div id='node12' data-nodeid='null|3595' data-sigid='52879' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'>&nbsp;</h4><h4 class='nodeSystem'>&nbsp;</h4><h4 class='nodeType'>xxm</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 3
        }
      ]
    },
    {
      "c": [
        {
          "v": 13,
          "f": "<div id='node13' data-nodeid='7|4483' data-sigid='53034' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-5'>C5</span></h4><h4 class='nodeSystem'>&nbsp;</h4><h4 class='nodeType'>vnc</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 4
        }
      ]
    },
    {
      "c": [
        {
          "v": 14,
          "f": "<div id='node14' data-nodeid='31001985' data-sigid='53026' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-5'>C5</span></h4><h4 class='nodeSystem'><a href='.?system=J114019'>12</a></h4><h4 class='nodeType'>vut</h4><div class='statics'><span class=\"class-5\" data-tooltip=\"Class 5 via H296\">5</span></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 5
        }
      ]
    },
    {
      "c": [
        {
          "v": 15,
          "f": "<div id='node15' data-nodeid='30003594' data-sigid='53027' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='lowsec'>LS</span></h4><h4 class='nodeSystem'><a href='.?system=Heluene'>Heluene</a></h4><h4 class='nodeType'>nhm</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 5
        }
      ]
    },
    {
      "c": [
        {
          "v": 16,
          "f": "<div id='node16' data-nodeid='31001413' data-sigid='53030' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' data-icon='red-giant' data-tooltip='Red Giant'></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-4'>C4</span></h4><h4 class='nodeSystem'><a href='.?system=J113730'>J113730</a></h4><h4 class='nodeType'>eby</h4><div class='statics'><span class=\"class-5\" data-tooltip=\"Class 5 via H900\">5</span><span class=\"class-2\" data-tooltip=\"Class 2 via N766\">2</span></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 5
        }
      ]
    },
    {
      "c": [
        {
          "v": 17,
          "f": "<div id='node17' data-nodeid='30000163' data-sigid='53004' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='lowsec'>LS</span></h4><h4 class='nodeSystem'><a href='.?system=Akora'>Akora</a></h4><h4 class='nodeType'>ayv</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 6
        }
      ]
    },
    {
      "c": [
        {
          "v": 18,
          "f": "<div id='node18' data-nodeid='31000652' data-sigid='53005' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-2'>C2</span></h4><h4 class='nodeSystem'><a href='.?system=J162516'>J162516</a></h4><h4 class='nodeType'>ceh</h4><div class='statics'><span class=\"lowsec\" data-tooltip=\"Low-Sec via A239\">L</span><span class=\"class-2\" data-tooltip=\"Class 2 via D382\">2</span></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 6
        }
      ]
    },
    {
      "c": [
        {
          "v": 19,
          "f": "<div id='node19' data-nodeid='7|8600' data-sigid='53031' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-5'>C5</span></h4><h4 class='nodeSystem'>&nbsp;</h4><h4 class='nodeType'>qjy</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 14
        }
      ]
    },
    {
      "c": [
        {
          "v": 20,
          "f": "<div id='node20' data-nodeid='0|2288' data-sigid='53008' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='nullsec'>NS</span></h4><h4 class='nodeSystem'>&nbsp;</h4><h4 class='nodeType'>zcj</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 18
        }
      ]
    },
    {
      "c": [
        {
          "v": 21,
          "f": "<div id='node21' data-nodeid='4|4427' data-sigid='53009' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-2'>C2</span></h4><h4 class='nodeSystem'>&nbsp;</h4><h4 class='nodeType'>klp</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 18
        }
      ]
    },
    {
      "c": [
        {
          "v": 22,
          "f": "<div id='node22' data-nodeid='31000849' data-sigid='53010' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-2'>C2</span></h4><h4 class='nodeSystem'><a href='.?system=J232200'>J232200</a></h4><h4 class='nodeType'>egc</h4><div class='statics'><span class=\"hisec\" data-tooltip=\"High-Sec via B274\">H</span><span class=\"class-1\" data-tooltip=\"Class 1 via Z647\">1</span></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 18
        }
      ]
    },
    {
      "c": [
        {
          "v": 23,
          "f": "<div id='node23' data-nodeid='4|2937' data-sigid='53011' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-2'>C2</span></h4><h4 class='nodeSystem'>&nbsp;</h4><h4 class='nodeType'>sdm</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 18
        }
      ]
    },
    {
      "c": [
        {
          "v": 24,
          "f": "<div id='node24' data-nodeid='4|4635' data-sigid='53012' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-2'>C2</span></h4><h4 class='nodeSystem'>&nbsp;</h4><h4 class='nodeType'>mxm</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 18
        }
      ]
    },
    {
      "c": [
        {
          "v": 25,
          "f": "<div id='node25' data-nodeid='5|4560' data-sigid='53013' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-3'>C3</span></h4><h4 class='nodeSystem'>&nbsp;</h4><h4 class='nodeType'>nem</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 18
        }
      ]
    },
    {
      "c": [
        {
          "v": 26,
          "f": "<div id='node26' data-nodeid='30045353' data-sigid='53014' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='lowsec'>LS</span></h4><h4 class='nodeSystem'><a href='.?system=Pynekastoh'>Pynekastoh</a></h4><h4 class='nodeType'>mvl</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 18
        }
      ]
    },
    {
      "c": [
        {
          "v": 27,
          "f": "<div id='node27' data-nodeid='30000142' data-sigid='53041' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='hisec'>HS</span></h4><h4 class='nodeSystem'><a href='.?system=Jita'>Jita</a></h4><h4 class='nodeType'>&nbsp;</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 18
        }
      ]
    },
    {
      "c": [
        {
          "v": 28,
          "f": "<div id='node28' data-nodeid='31000325' data-sigid='53016' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-1'>C1</span></h4><h4 class='nodeSystem'><a href='.?system=J115823'>J115823</a></h4><h4 class='nodeType'>xdj</h4><div class='statics'><span class=\"hisec\" data-tooltip=\"High-Sec via N110\">H</span></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 22
        }
      ]
    },
    {
      "c": [
        {
          "v": 29,
          "f": "<div id='node29' data-nodeid='31002562' data-sigid='52869' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' data-icon='pulsar' data-tooltip='Pulsar'></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-5'>C5</span></h4><h4 class='nodeSystem'><a href='.?system=J003382'>J003382</a></h4><h4 class='nodeType'>&nbsp;</h4><div class='statics'><span class=\"lowsec\" data-tooltip=\"Low-Sec via U210\">L</span><span class=\"class-2\" data-tooltip=\"Class 2 via D364\">2</span></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 27
        }
      ]
    },
    {
      "c": [
        {
          "v": 30,
          "f": "<div id='node30' data-nodeid='5|5420' data-sigid='53018' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-3'>C3</span></h4><h4 class='nodeSystem'>&nbsp;</h4><h4 class='nodeType'>rrr</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 28
        }
      ]
    },
    {
      "c": [
        {
          "v": 31,
          "f": "<div id='node31' data-nodeid='5|9871' data-sigid='53019' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-3'>C3</span></h4><h4 class='nodeSystem'>&nbsp;</h4><h4 class='nodeType'>ejv</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 28
        }
      ]
    },
    {
      "c": [
        {
          "v": 32,
          "f": "<div id='node32' data-nodeid='0|5648' data-sigid='53020' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='nullsec'>NS</span></h4><h4 class='nodeSystem'>&nbsp;</h4><h4 class='nodeType'>mln</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 28
        }
      ]
    },
    {
      "c": [
        {
          "v": 33,
          "f": "<div id='node33' data-nodeid='30002633' data-sigid='53021' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='hisec'>HS</span></h4><h4 class='nodeSystem'><a href='.?system=Du Annes'>Du Annes</a></h4><h4 class='nodeType'>dqy</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 28
        }
      ]
    },
    {
      "c": [
        {
          "v": 34,
          "f": "<div id='node34' data-nodeid='30005127' data-sigid='53022' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='nullsec'>NS</span></h4><h4 class='nodeSystem'><a href='.?system=B9N2-2'>B9N2-2</a></h4><h4 class='nodeType'>sqc</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 28
        }
      ]
    },
    {
      "c": [
        {
          "v": 35,
          "f": "<div id='node35' data-nodeid='5|9285' data-sigid='53025' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-3'>C3</span></h4><h4 class='nodeSystem'>&nbsp;</h4><h4 class='nodeType'>uzp</h4><div class='statics'></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 28
        }
      ]
    },
    {
      "c": [
        {
          "v": 36,
          "f": "<div id='node36' data-nodeid='31001984' data-sigid='52868' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-5'>C5</span></h4><h4 class='nodeSystem'><a href='.?system=J153054'>J153054</a></h4><h4 class='nodeType'>&nbsp;</h4><div class='statics'><span class=\"class-5\" data-tooltip=\"Class 5 via H296\">5</span></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 29
        }
      ]
    },
    {
      "c": [
        {
          "v": 37,
          "f": "<div id='node37' data-nodeid='31002088' data-sigid='52867' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-5'>C5</span></h4><h4 class='nodeSystem'><a href='.?system=J114842'>J114842</a></h4><h4 class='nodeType'>&nbsp;</h4><div class='statics'><span class=\"class-6\" data-tooltip=\"Class 6 via V753\">6</span></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 36
        }
      ]
    },
    {
      "c": [
        {
          "v": 38,
          "f": "<div id='node38' data-nodeid='31002376' data-sigid='52866' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' null></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-6'>C6</span></h4><h4 class='nodeSystem'><a href='.?system=J133906'>J133906</a></h4><h4 class='nodeType'>&nbsp;</h4><div class='statics'><span class=\"class-6\" data-tooltip=\"Class 6 via W237\">6</span></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 37
        }
      ]
    },
    {
      "c": [
        {
          "v": 39,
          "f": "<div id='node39' data-nodeid='31002415' data-sigid='52865' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' data-icon='blackhole' data-tooltip='Black Hole'></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-6'>C6</span></h4><h4 class='nodeSystem'><a href='.?system=J165641'>J165641</a></h4><h4 class='nodeType'>&nbsp;</h4><div class='statics'><span class=\"class-6\" data-tooltip=\"Class 6 via W237\">6</span></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 38
        }
      ]
    },
    {
      "c": [
        {
          "v": 40,
          "f": "<div id='node40' data-nodeid='31002063' data-sigid='52871' class='node '><div class='nodeIcons'><div style='float: left;'><i class='whEffect' data-icon='wolf-rayet' data-tooltip='Wolf-Rayet Star'></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge invisible'></span></div></div><h4 class='nodeClass'><span class='wh class-5'>C5</span></h4><h4 class='nodeSystem'><a href='.?system=J154846'>J154846</a></h4><h4 class='nodeType'>&nbsp;</h4><div class='statics'><span class=\"class-6\" data-tooltip=\"Class 6 via V753\">6</span></div><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>"
        },
        {
          "v": 39
        }
      ]
    }
  ]
};
</script>
<link rel=stylesheet href=css/app.min.css />
</head>

<body>

<style>
#chainMap .node.top-level {
	border-radius:200px;
	padding: 10px;
	border: 4px #004080 solid;
	font-size: 120%;
}

#map-container {
	position: relative;
	width: 100%;
	height: 400px;
}

.map-chain-wrapper {
	position: absolute;
}

.map-inner-container {
	position: relative;
}

.map-inner-container .node-wrapper {
	position:absolute;
}

#chainMap .node-wrapper div.node {
	transform: translate(-50%, -50%);	/* centre around position */
}

.map-drawing {
	position: absolute;
	top: -300px;
	left: -300px;
	height: 600px;
	width: 600px;
/*	width: 100%;
	height: 100%;*/
	background: #000020;
}

div.node { display: inline-block; }
</style>

<div id="chainMap">
	<div id="map-container">
		<canvas id="map-drawing" />
	</div>
</div>

<pre id="json" />

<script>
const maps = [];
const nodesById = {};

// First pass: arrange nodes into rings
for(var ri = 0; ri < chain_map.rows.length; ri++) {
	const item = chain_map.rows[ri];
	const inNode = item.c[0], id = inNode.v, parent = item.c[1].v;
	
	const mapNode = { id: id, children: [], minArc: 0 };
	
	if(parent == null) {
		const newMap =  { circles: [ { arc: 0, nodes: [ mapNode ] } ] };
		mapNode.map = newMap;
		mapNode.circle = 0;
		maps.push(newMap);
	} else {
		const parentNode = nodesById[parent];
		if(!parentNode) { throw 'Parent id ' + parent + ' not on map yet'; }
		parentNode.children.push(mapNode);
		mapNode.parent = parentNode;
		mapNode.map = parentNode.map;
		mapNode.circle = parentNode.circle + 1;
		if(mapNode.map.circles.length <= mapNode.circle) {
			mapNode.map.circles.push({ arc: 0, nodes:[mapNode] });
		} else { mapNode.map.circles[mapNode.circle].nodes.push(mapNode); }
	}
	nodesById[id] = mapNode;
	mapNode.markup = inNode.f;
}

// Second pass - for each map, find the allocation of arc needed for each node
for(var mi = 0; mi < maps.length; mi++) {
	const map = maps[mi];
	for(var ci = map.circles.length - 1; ci >= 1; ci--) {	// don't need to calculate ring 0
		for(var ni = 0; ni < map.circles[ci].nodes.length; ni++) {
			const node = map.circles[ci].nodes[ni];
			node.minArc *= ci / (ci + 1.0);
			if(node.minArc < 1) { node.minArc = 1; }
			node.parent.minArc += node.minArc;
			map.circles[ci].arc += node.minArc;
		}
	}
}

// Third pass - lay out each ring based on the arc values
const CIRCLE_SIZE = { x: 90, y: 45 };
for(var mi = 0; mi < 1 /*maps.length*/; mi++) {
	const map = maps[mi];
	const mapDiv = document.createElement('div');
	mapDiv.style.top = '300px';
	mapDiv.style.left = '300px';
	mapDiv.id = "map" + mi;
	mapDiv.className = "map-chain-wrapper";
	mapDiv.innerHTML = '<div class="map-inner-container"><canvas class="map-drawing" id="map-canvas-' + mi + '" width=1200 height=1200/></div>';
	const innerContainer = mapDiv.firstChild;
	document.getElementById('map-container').appendChild(mapDiv);
	const canvas = innerContainer.getElementsByTagName('canvas')[0];
	const ctx = canvas.getContext('2d');
	ctx.scale(2, 2);
	ctx.translate(300, 300);
	
	for(var ci = map.circles.length - 1; ci >= 1; ci--) {	// don't need to draw ring 0
		ctx.beginPath();
		if(ctx.ellipse) {
			ctx.lineWidth = 0.5;
			ctx.ellipse(0, 0, ci * CIRCLE_SIZE.x, ci * CIRCLE_SIZE.y, 0, 0, Math.PI * 2);
		}
		ctx.strokeStyle = colourFromCssClass('grid-default');
		ctx.stroke();		
	}	
	
	renderCircle(innerContainer, 0, map.circles[0].nodes, 0, Math.PI * 2);
}

function renderCircle(innerContainer, ci, nodes, minRad, maxRad) {
	const totalArc = nodes.reduce(function(acc, x) { return acc + x.minArc; }, 0);
	const rads_per_arc = (maxRad - minRad) / totalArc;
	var rad_offset = minRad;
	var alignment_delta = 0;
	
	for(var ni = 0; ni < nodes.length; ni++) {
		const node = nodes[ni];	
		
		// Make the node
		const frag = document.createRange().createContextualFragment('<div class="node-wrapper">' + node.markup + '</div>');
		node.domNode = frag.firstChild;
		innerContainer.appendChild(node.domNode);
		
		// Position the node
		const dr = node.minArc * rads_per_arc;
		const rad_centre = rad_offset + (dr / 2);
		
		if(ci == 1 && ni == 0) { // First node on first ring should be axis aligned
			alignment_delta -= rad_centre;
		}
		
		node.position = { 
			x: ci * CIRCLE_SIZE.x * Math.sin(rad_centre + alignment_delta), 
			y: ci * CIRCLE_SIZE.y * Math.cos(rad_centre + alignment_delta)
		};
		
		node.domNode.style.left = node.position.x + 'px';
		node.domNode.style.top = node.position.y + 'px';
		
		if(node.parent) {
			const canvas = innerContainer.getElementsByTagName('canvas')[0];
			const ctx = canvas.getContext('2d');
			ctx.beginPath();
			ctx.lineWidth = 2;
			ctx.moveTo(node.position.x, node.position.y);
			ctx.lineTo(node.parent.position.x, node.parent.position.y);
			ctx.strokeStyle = 'white';
			ctx.stroke();
		}
		
		// Do the segment of the next circle
		renderCircle(innerContainer, ci + 1, node.children, rad_offset + alignment_delta, rad_offset + alignment_delta + dr);
		
		rad_offset += dr;
	}
}

/** https://stackoverflow.com/questions/40978050 */
function colourFromCssClass(className) {
	var elem = document.getElementById('temp-div-' + className);
	if(!elem) {
	  elem = document.createElement("div");
	  elem.id = 'temp-div-' + className;
	  elem.style.cssText = "position:fixed;left:-100px;top:-100px;width:1px;height:1px";
	  elem.className = className + ' temp';
	  document.body.appendChild(elem);  // required in some browsers
	  }
  const color = getComputedStyle(elem).getPropertyValue("color");
  //document.body.removeChild(tmp);
  return color;
}

//json.textContent = JSON.stringify(maps);
</script>

</body></html>